<!DOCTYPE html>


  <html class="light page-post">


<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>Android SystemServer启动(二) | Rouse</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="启动,">
  

  <meta name="description" content="Android init &amp;#x542F;&amp;#x52A8; Android Linux Zygote&amp;#x542F;&amp;#x52A8; Android Java Zygote&amp;#x542F;&amp;#x52A8; Android SystemServer&amp;#x542F;&amp;#x52A8;(&amp;#x4E00;) &amp;#x7EE7;&amp;#x7EED;&amp;#x4E0A;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#">
<meta name="keywords" content="启动">
<meta property="og:type" content="article">
<meta property="og:title" content="Android SystemServer启动(二)">
<meta property="og:url" content="https://www.rousetime.com/2021/01/04/Android-SystemServer启动-二/index.html">
<meta property="og:site_name" content="Rouse">
<meta property="og:description" content="Android init &amp;#x542F;&amp;#x52A8; Android Linux Zygote&amp;#x542F;&amp;#x52A8; Android Java Zygote&amp;#x542F;&amp;#x52A8; Android SystemServer&amp;#x542F;&amp;#x52A8;(&amp;#x4E00;) &amp;#x7EE7;&amp;#x7EED;&amp;#x4E0A;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2022-11-30T14:41:58.798Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android SystemServer启动(二)">
<meta name="twitter:description" content="Android init &amp;#x542F;&amp;#x52A8; Android Linux Zygote&amp;#x542F;&amp;#x52A8; Android Java Zygote&amp;#x542F;&amp;#x52A8; Android SystemServer&amp;#x542F;&amp;#x52A8;(&amp;#x4E00;) &amp;#x7EE7;&amp;#x7EED;&amp;#x4E0A;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#">

  

  
  <!-- <link href="/favicon.ico" rel="icon" type="image/x-icon"> -->
    <link rel="icon" href="/favicon.ico">
    <!-- <link href="favicon.ico" rel="shortcut icon" type="image/x-icon" /> -->
  

  <link href="/css/styles.css?v=c114cbe6" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?bd7ea96a22c9c7b90353962460fa0b8e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
</head>
</html>
<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">盒子</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/atom.xml"
            rel="noopener noreferrer"
            target="_blank"
            >
            RSS
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            搜索
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#run"><span class="toc-text">run</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SystemContext"><span class="toc-text">SystemContext</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SystemServiceManager"><span class="toc-text">SystemServiceManager</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#startBootstrapServices"><span class="toc-text">startBootstrapServices</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#startCoreServices"><span class="toc-text">startCoreServices</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#startOtherServices"><span class="toc-text">startOtherServices</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#项目"><span class="toc-text">项目</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-Android-SystemServer启动-二" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">Android SystemServer启动(二)</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2021.01.04</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>Rouse</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/android/">android</a>
  </span>



      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      

      
      
    </div>
  </header>

  <div class="article-content">
    
      <p><a href="https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484889&amp;idx=1&amp;sn=b39c8bc0a9925464022b77a341263cf0&amp;chksm=e8e0fc49df97755f598ef0082409c573d7715ce33bb27b1c98194410d487ae69adbeb2293d84&amp;token=1353481402&amp;lang=zh_CN#rd" target="_blank" rel="noopener">Android init &#x542F;&#x52A8;</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484889&amp;idx=1&amp;sn=b39c8bc0a9925464022b77a341263cf0&amp;chksm=e8e0fc49df97755f598ef0082409c573d7715ce33bb27b1c98194410d487ae69adbeb2293d84&amp;token=1204064574&amp;lang=zh_CN#rd" target="_blank" rel="noopener">Android Linux Zygote&#x542F;&#x52A8;</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484921&amp;idx=1&amp;sn=bf7251253d23c17c9148423f6f1e386e&amp;chksm=e8e0fc69df97757f2aec459954c07d0fc44be4bd6c6963dab2b5c5b01d8e8176c9069ddab12c&amp;token=757375240&amp;lang=zh_CN#rd" target="_blank" rel="noopener">Android Java Zygote&#x542F;&#x52A8;</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484938&amp;idx=1&amp;sn=027a7eb6902d8668d15008db0e2ac29a&amp;chksm=e8e0ff9adf97768cb5f77f6b1ffbb2e306a1ac6dea66a4aeeed0a7aed3c3ccb531db634df991&amp;token=757375240&amp;lang=zh_CN#rd" target="_blank" rel="noopener">Android SystemServer&#x542F;&#x52A8;(&#x4E00;)</a></p>
<p>&#x7EE7;&#x7EED;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x7684;SystemServer&#x542F;&#x52A8;&#x5206;&#x6790;&#x3002;</p>
<blockquote>
<p>&#x6B64;&#x6B21;&#x5206;&#x6790;&#x8FC7;&#x7A0B;&#x57FA;&#x4E8E;Android 10.0</p>
</blockquote>
<h2 id="run"><a href="#run" class="headerlink" title="run"></a>run</h2><p>&#x5728;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x5206;&#x6790;&#x5230;&#xFF0C;&#x901A;&#x8FC7;SystemServer&#x7684;run&#x65B9;&#x6CD5;&#x8FDB;&#x5165;&#x5230;SystemServer&#x5185;&#x90E8;&#x903B;&#x8F91;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x6765;&#x770B;run&#x65B9;&#x6CD5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">private void run() {</span><br><span class="line">    try {</span><br><span class="line">        traceBeginAndSlog(&quot;InitBeforeStartServices&quot;);</span><br><span class="line">        ...</span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line">        // &#x521B;&#x5EFA;Looper</span><br><span class="line">        Looper.prepareMainLooper();</span><br><span class="line">        Looper.getMainLooper().setSlowLogThresholdMs(</span><br><span class="line">                SLOW_DISPATCH_THRESHOLD_MS, SLOW_DELIVERY_THRESHOLD_MS);</span><br><span class="line"> </span><br><span class="line">        // &#x521D;&#x59CB;&#x5316;native service</span><br><span class="line">        System.loadLibrary(&quot;android_servers&quot;);</span><br><span class="line"> </span><br><span class="line">        performPendingShutdown();</span><br><span class="line"> </span><br><span class="line">        // &#x521B;&#x5EFA;system context</span><br><span class="line">        createSystemContext();</span><br><span class="line"> </span><br><span class="line">        // &#x521B;&#x5EFA;SystemServiceManager</span><br><span class="line">        mSystemServiceManager = new SystemServiceManager(mSystemContext);</span><br><span class="line">        mSystemServiceManager.setStartInfo(mRuntimeRestart,</span><br><span class="line">                mRuntimeStartElapsedTime, mRuntimeStartUptime);</span><br><span class="line">        </span><br><span class="line">        // &#x6DFB;&#x52A0;&#x5230;&#x672C;&#x5730;LocalServices&#x4E2D;&#xFF0C;&#x4EE5;&#x4FBF;&#x540E;&#x7EED;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;&#x670D;&#x52A1;&#x5BF9;&#x8C61;</span><br><span class="line">        LocalServices.addService(SystemServiceManager.class, mSystemServiceManager);</span><br><span class="line">        SystemServerInitThreadPool.get();</span><br><span class="line">    } finally {</span><br><span class="line">        traceEnd();  // InitBeforeStartServices</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;&#x5404;&#x9879;services</span><br><span class="line">    try {</span><br><span class="line">        traceBeginAndSlog(&quot;StartServices&quot;);</span><br><span class="line">        startBootstrapServices();</span><br><span class="line">        startCoreServices();</span><br><span class="line">        startOtherServices();</span><br><span class="line">        SystemServerInitThreadPool.shutdown();</span><br><span class="line">    } catch (Throwable ex) {</span><br><span class="line">        Slog.e(&quot;System&quot;, &quot;******************************************&quot;);</span><br><span class="line">        Slog.e(&quot;System&quot;, &quot;************ Failure starting system services&quot;, ex);</span><br><span class="line">        throw ex;</span><br><span class="line">    } finally {</span><br><span class="line">        traceEnd();</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    StrictMode.initVmDefaults(null);</span><br><span class="line"> </span><br><span class="line">    if (!mRuntimeRestart &amp;&amp; !isFirstBootOrUpgrade()) {</span><br><span class="line">        int uptimeMillis = (int) SystemClock.elapsedRealtime();</span><br><span class="line">        MetricsLogger.histogram(null, &quot;boot_system_server_ready&quot;, uptimeMillis);</span><br><span class="line">        final int MAX_UPTIME_MILLIS = 60 * 1000;</span><br><span class="line">        if (uptimeMillis &gt; MAX_UPTIME_MILLIS) {</span><br><span class="line">            Slog.wtf(SYSTEM_SERVER_TIMING_TAG,</span><br><span class="line">                    &quot;SystemServer init took too long. uptimeMillis=&quot; + uptimeMillis);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    // &#x5F00;&#x542F;loop&#x5FAA;&#x73AF;&#xFF0C;&#x7B49;&#x5F85;&#x6D88;&#x606F;&#x7684;&#x6765;&#x4E34;</span><br><span class="line">    Looper.loop();</span><br><span class="line">    throw new RuntimeException(&quot;Main thread loop unexpectedly exited&quot;);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5728;SystemServer&#x7684;run&#x65B9;&#x6CD5;&#x4E2D;&#x4E3B;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x662F;&#xFF1A;</p>
<ol>
<li>&#x521B;&#x5EFA;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684;Looper</li>
<li>&#x52A0;&#x8F7D;native services&#x539F;&#x751F;&#x5E93;android_servers</li>
<li>&#x521B;&#x5EFA;SystemContext&#xFF0C;&#x901A;&#x8FC7;ActivityThread&#x6765;&#x83B7;&#x53D6;SystemContext</li>
<li>&#x521B;&#x5EFA;SystemServiceManager&#xFF0C;&#x7528;&#x6765;&#x542F;&#x52A8;&#x540E;&#x7EED;&#x7684;&#x5404;&#x9879;&#x670D;&#x52A1;</li>
<li>&#x5F00;&#x542F;&#x5404;&#x9879;&#x670D;&#x52A1;</li>
<li>&#x5F00;&#x542F;Looper&#x5FAA;&#x73AF;&#xFF0C;&#x7B49;&#x5F85;&#x6D88;&#x606F;&#x7684;&#x6765;&#x4E34;&#x5E76;&#x6267;&#x884C;</li>
</ol>
<h3 id="SystemContext"><a href="#SystemContext" class="headerlink" title="SystemContext"></a>SystemContext</h3><p>&#x5176;&#x4E2D;SystemContext&#x7684;&#x521B;&#x5EFA;&#x662F;&#x901A;&#x8FC7;ActivityThread&#x6765;&#x83B7;&#x53D6;&#x7684;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">private void createSystemContext() {</span><br><span class="line">    ActivityThread activityThread = ActivityThread.systemMain();</span><br><span class="line">    mSystemContext = activityThread.getSystemContext();</span><br><span class="line">    mSystemContext.setTheme(DEFAULT_SYSTEM_THEME);</span><br><span class="line"> </span><br><span class="line">    final Context systemUiContext = activityThread.getSystemUiContext();</span><br><span class="line">    systemUiContext.setTheme(DEFAULT_SYSTEM_THEME);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6700;&#x7EC8;&#x83B7;&#x53D6;&#x5230;&#x7684;SystemContext&#x662F;&#x7531;ContextImpl&#x521B;&#x5EFA;&#x7684;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public ContextImpl getSystemContext() {</span><br><span class="line">    synchronized (this) {</span><br><span class="line">        if (mSystemContext == null) {</span><br><span class="line">            mSystemContext = ContextImpl.createSystemContext(this);</span><br><span class="line">        }</span><br><span class="line">        return mSystemContext;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="SystemServiceManager"><a href="#SystemServiceManager" class="headerlink" title="SystemServiceManager"></a>SystemServiceManager</h3><p>&#x5B83;&#x662F;SystemServer&#x7684;&#x670D;&#x52A1;&#x5927;&#x7BA1;&#x5BB6;&#xFF0C;&#x63D0;&#x4F9B;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x7684;&#x76F8;&#x5173;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x4E3B;&#x8981;&#x6D89;&#x53CA;&#x7684;&#x65B9;&#x6CD5;&#x6709;</p>
<ol>
<li>startService: &#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x521B;&#x5EFA;&#x76F8;&#x5173;&#x670D;&#x52A1;&#xFF0C;&#x5E76;&#x4E14;&#x8C03;&#x7528;&#x5BF9;&#x5E94;&#x670D;&#x52A1;&#x7684;onStart()&#x65B9;&#x6CD5;&#x6765;&#x5F00;&#x542F;&#x670D;&#x52A1;</li>
<li>startBootPhase: &#x5F00;&#x542F;&#x7279;&#x6B8A;&#x7684;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#xFF0C;&#x5404;&#x9879;&#x670D;&#x52A1;&#x4F1A;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#x6267;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x903B;&#x8F91;&#x3002;</li>
</ol>
<p>&#x542F;&#x52A8;&#x7684;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#x5206;&#x522B;&#x4E3A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// &#x542F;&#x52A8;&#x9636;&#x6BB5;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E9B;&#x9ED8;&#x8BA4;&#x5C55;&#x793A;</span><br><span class="line">public static final int PHASE_WAIT_FOR_DEFAULT_DISPLAY = 100;</span><br><span class="line"> </span><br><span class="line">// &#x8BE5;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x5C06;&#x4F1A;&#x9501;&#x5B9A;setting&#x6570;&#x636E;</span><br><span class="line">public static final int PHASE_LOCK_SETTINGS_READY = 480;</span><br><span class="line"> </span><br><span class="line">// &#x8BE5;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x5C06;&#x4F1A;&#x8C03;&#x7528;&#x6838;&#x5FC3;&#x7684;system services&#xFF0C;&#x4F8B;&#x5982;PowerManager&#x4E0E;PackageManager</span><br><span class="line">public static final int PHASE_SYSTEM_SERVICES_READY = 500;</span><br><span class="line"> </span><br><span class="line">// &#x8BE5;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x5C06;&#x4F1A;&#x8C03;&#x7528;&#x8BBE;&#x5907;&#x7279;&#x6B8A;&#x670D;&#x52A1;</span><br><span class="line">public static final int PHASE_DEVICE_SPECIFIC_SERVICES_READY = 520;</span><br><span class="line"> </span><br><span class="line">// &#x8BE5;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x5C06;&#x4F1A;&#x5C06;&#x4F1A;&#x53D1;&#x9001;&#x670D;&#x52A1;&#x5E7F;&#x64AD;</span><br><span class="line">public static final int PHASE_ACTIVITY_MANAGER_READY = 550;</span><br><span class="line"> </span><br><span class="line">// &#x8BE5;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x5C06;&#x4F1A;&#x542F;&#x52A8;&#x4E0D;&#x7ED1;&#x5B9A;&#x4E09;&#x65B9;app</span><br><span class="line">public static final int PHASE_THIRD_PARTY_APPS_CAN_START = 600;</span><br><span class="line"> </span><br><span class="line">// &#x8BE5;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x6807;&#x5FD7;&#x7740;&#x542F;&#x52A8;&#x5B8C;&#x6210;&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x8BBE;&#x5907;&#x4EA4;&#x4E92;&#xFF0C;&#x5E94;&#x7528;&#x684C;&#x9762;&#x5DF2;&#x7ECF;&#x542F;&#x52A8;</span><br><span class="line">public static final int PHASE_BOOT_COMPLETED = 1000;</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E9B;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x4F1A;&#x7A7F;&#x63D2;&#x5728;&#x5404;&#x9879;&#x7684;&#x670D;&#x52A1;&#x542F;&#x52A8;&#x5E8F;&#x5217;&#x4E2D;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#x7684;&#x63D2;&#x5165;&#xFF0C;&#x90FD;&#x4F1A;&#x4F34;&#x968F;&#x7740;&#x8BE5;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#x4E4B;&#x524D;&#x7684;&#x670D;&#x52A1;&#x6267;&#x884C;&#x76F8;&#x5173;&#x903B;&#x8F91;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#x76F8;&#x5BF9;&#x4E8E;&#x6807;&#x8BC6;&#x6216;&#x8005;&#x8BF4;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;&#x5373;&#x540E;&#x7EED;&#x7684;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x9700;&#x8981;&#x4F9D;&#x8D56;&#x4E8E;&#x524D;&#x9762;&#x67D0;&#x4E9B;&#x670D;&#x52A1;&#x7684;&#x7279;&#x8272;&#x5904;&#x7406;&#x903B;&#x8F91;&#x4E4B;&#x540E;&#x624D;&#x80FD;&#x8FDB;&#x884C;&#x3002;</p>
<p>&#x800C;&#x8FD9;&#x4E9B;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x7684;&#x8282;&#x70B9;&#x4F53;&#x73B0;&#x90FD;&#x5206;&#x5E03;&#x5728;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x4E2D;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">traceBeginAndSlog(&quot;StartServices&quot;);</span><br><span class="line">startBootstrapServices();</span><br><span class="line">startCoreServices();</span><br><span class="line">startOtherServices();</span><br></pre></td></tr></table></figure>
<p>&#x5177;&#x4F53;&#x7684;&#x8282;&#x70B9;&#x63D2;&#x5165;&#x65F6;&#x673A;&#x4E3A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">private void startBootstrapServices() {</span><br><span class="line">        mSystemServiceManager.startBootPhase(SystemService.PHASE_WAIT_FOR_DEFAULT_DISPLAY);</span><br><span class="line">}</span><br><span class="line">private void startCoreServices() {</span><br><span class="line">        ...</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">private void startOtherServices() {</span><br><span class="line">        mSystemServiceManager.startBootPhase(SystemService.PHASE_LOCK_SETTINGS_READY);</span><br><span class="line"> </span><br><span class="line">        mSystemServiceManager.startBootPhase(SystemService.PHASE_SYSTEM_SERVICES_READY);</span><br><span class="line"> </span><br><span class="line">        mSystemServiceManager.startBootPhase(SystemService.PHASE_DEVICE_SPECIFIC_SERVICES_READY);</span><br><span class="line"> </span><br><span class="line">        mActivityManagerService.systemReady(() -&gt; {</span><br><span class="line">            mSystemServiceManager.startBootPhase(</span><br><span class="line">                    SystemService.PHASE_ACTIVITY_MANAGER_READY);        </span><br><span class="line">             </span><br><span class="line">            mSystemServiceManager.startBootPhase(</span><br><span class="line">                    SystemService.PHASE_THIRD_PARTY_APPS_CAN_START);</span><br><span class="line">        }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5BF9;&#x5E94;&#x7684;&#x54CD;&#x5E94;&#x5404;&#x4E2A;&#x9636;&#x6BB5;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;&#x662F;&#x5728;&#x5BF9;&#x5E94;service&#x7684;onBootPhase()&#x65B9;&#x6CD5;&#x4E2D;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public void onBootPhase(int phase) {</span><br><span class="line">	...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x5404;&#x4E2A;&#x9636;&#x6BB5;&#x90FD;&#x542F;&#x52A8;&#x4E86;&#x54EA;&#x4E9B;&#x670D;&#x52A1;&#x3002;</p>
<h2 id="startBootstrapServices"><a href="#startBootstrapServices" class="headerlink" title="startBootstrapServices"></a>startBootstrapServices</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">private void startBootstrapServices() {</span><br><span class="line">    final String TAG_SYSTEM_CONFIG = &quot;ReadingSystemConfig&quot;;</span><br><span class="line">    traceBeginAndSlog(TAG_SYSTEM_CONFIG);</span><br><span class="line">    SystemServerInitThreadPool.get().submit(SystemConfig::getInstance, TAG_SYSTEM_CONFIG);</span><br><span class="line">    traceEnd();</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;Installer</span><br><span class="line">    Installer installer = mSystemServiceManager.startService(Installer.class);</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;DeviceIdentifiersPolicyService</span><br><span class="line">    mSystemServiceManager.startService(DeviceIdentifiersPolicyService.class);</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;ActivityManagerService</span><br><span class="line">    mActivityManagerService = mSystemServiceManager.startService(</span><br><span class="line">            ActivityManagerService.Lifecycle.class).getService();</span><br><span class="line">    mActivityManagerService.setSystemServiceManager(mSystemServiceManager);</span><br><span class="line">    mActivityManagerService.setInstaller(installer);</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;PowerManagerService</span><br><span class="line">    mPowerManagerService = mSystemServiceManager.startService(PowerManagerService.class);</span><br><span class="line"> </span><br><span class="line">    // &#x521D;&#x59CB;&#x5316;PowerManager</span><br><span class="line">    mActivityManagerService.initPowerManagement();</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;RecoverySystemService</span><br><span class="line">    mSystemServiceManager.startService(RecoverySystemService.class);</span><br><span class="line"> </span><br><span class="line">    RescueParty.noteBoot(mSystemContext);</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;LightsService</span><br><span class="line">    mSystemServiceManager.startService(LightsService.class);</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;SidekickService</span><br><span class="line">    if (SystemProperties.getBoolean(&quot;config.enable_sidekick_graphics&quot;, false)) {</span><br><span class="line">        mSystemServiceManager.startService(WEAR_SIDEKICK_SERVICE_CLASS);</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;DisplayManagerService</span><br><span class="line">    mDisplayManagerService = mSystemServiceManager.startService(DisplayManagerService.class);</span><br><span class="line"> </span><br><span class="line">    // &#x63D2;&#x5165;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#xFF0C;&#x6267;&#x884C;&#x5BF9;&#x5E94;&#x7684;&#x8282;&#x70B9;&#x903B;&#x8F91;</span><br><span class="line">    mSystemServiceManager.startBootPhase(SystemService.PHASE_WAIT_FOR_DEFAULT_DISPLAY);</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5728;&#x5F00;&#x59CB;&#x63D2;&#x5165;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#x4E4B;&#x524D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x79F0;&#x4E4B;&#x4E3A;BootPhase 0&#xFF0C;&#x542F;&#x52A8;&#x7684;&#x670D;&#x52A1;&#x6709;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Installer</span><br><span class="line">DeviceIdentifiersPolicyService</span><br><span class="line">UriGrantsManagerService</span><br><span class="line">ActivityManagerService</span><br><span class="line">PowerManagerService</span><br><span class="line">RecoverySystemService</span><br><span class="line">LightsService</span><br><span class="line">DisplayManagerService</span><br></pre></td></tr></table></figure>
<p>&#x7531;&#x4E8E;PackageManager&#x542F;&#x52A8;&#x9700;&#x8981;DisplayManagerService&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#xFF0C;&#x6240;&#x4EE5;&#x8BBE;&#x7F6E;BootPhase 100&#xFF0C;&#x6267;&#x884C;DisplayManagerService&#x4E2D;&#x7684;onBootPhase&#x65B9;&#x6CD5;&#x6765;&#x5904;&#x7406;BootPhase 100&#x7684;&#x903B;&#x8F91;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public void onBootPhase(int phase) {</span><br><span class="line">    if (phase == PHASE_WAIT_FOR_DEFAULT_DISPLAY) {</span><br><span class="line">        synchronized (mSyncRoot) {</span><br><span class="line">            long timeout = SystemClock.uptimeMillis()</span><br><span class="line">                    + mInjector.getDefaultDisplayDelayTimeout();</span><br><span class="line">            while (mLogicalDisplays.get(Display.DEFAULT_DISPLAY) == null ||</span><br><span class="line">                    mVirtualDisplayAdapter == null) {</span><br><span class="line">                long delay = timeout - SystemClock.uptimeMillis();</span><br><span class="line">                if (delay &lt;= 0) {</span><br><span class="line">                    throw new RuntimeException(&quot;Timeout waiting for default display &quot;</span><br><span class="line">                            + &quot;to be initialized. DefaultDisplay=&quot;</span><br><span class="line">                            + mLogicalDisplays.get(Display.DEFAULT_DISPLAY)</span><br><span class="line">                            + &quot;, mVirtualDisplayAdapter=&quot; + mVirtualDisplayAdapter);</span><br><span class="line">                }</span><br><span class="line">                if (DEBUG) {</span><br><span class="line">                    Slog.d(TAG, &quot;waitForDefaultDisplay: waiting, timeout=&quot; + delay);</span><br><span class="line">                }</span><br><span class="line">                try {</span><br><span class="line">                    mSyncRoot.wait(delay);</span><br><span class="line">                } catch (InterruptedException ex) {</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5904;&#x7406;&#x5B8C;&#x4E4B;&#x540E;&#x7EE7;&#x7EED;&#x542F;&#x52A8;PackageManagerService&#x4E0E;&#x5176;&#x4ED6;&#x7684;&#x670D;&#x52A1;&#x3002;</p>
<p>&#x4ECE;BootPhase 100&#x5230;BootPhase 480&#x4F1A;&#x542F;&#x52A8;&#x5927;&#x91CF;&#x7684;&#x670D;&#x52A1;&#x3002;</p>
<p>&#x5305;&#x62EC;&#x521D;&#x59CB;&#x5316;&#x7684;&#x670D;&#x52A1;&#x3001;&#x6838;&#x5FC3;&#x670D;&#x52A1;&#x4E0E;&#x5176;&#x4ED6;&#x670D;&#x52A1;&#x3002;&#x5206;&#x522B;&#x4ECE;startBootstrapServices&#x3001;startCoreServices&#x5230;startOtherServices&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">private void startBootstrapServices() {</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line"> </span><br><span class="line">    // BootPhase 100</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;PackageManagerService</span><br><span class="line">    try {</span><br><span class="line">        Watchdog.getInstance().pauseWatchingCurrentThread(&quot;packagemanagermain&quot;);</span><br><span class="line">        mPackageManagerService = PackageManagerService.main(mSystemContext, installer,</span><br><span class="line">                mFactoryTestMode != FactoryTest.FACTORY_TEST_OFF, mOnlyCore);</span><br><span class="line">    } finally {</span><br><span class="line">        Watchdog.getInstance().resumeWatchingCurrentThread(&quot;packagemanagermain&quot;);</span><br><span class="line">    }</span><br><span class="line">    mFirstBoot = mPackageManagerService.isFirstBoot();</span><br><span class="line">    mPackageManager = mSystemContext.getPackageManager();</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;UserManagerService&#xFF0C;&#x521B;&#x5EFA;/data/user/ &#x76EE;&#x5F55;</span><br><span class="line">    mSystemServiceManager.startService(UserManagerService.LifeCycle.class);</span><br><span class="line"> </span><br><span class="line">    // &#x8BBE;&#x7F6E;AMS</span><br><span class="line">    mActivityManagerService.setSystemProcess();</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;OverlayManagerService</span><br><span class="line">    mSystemServiceManager.startService(new OverlayManagerService(mSystemContext, installer));</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;SensorPrivacyService&#xFF0C;&#x4F20;&#x611F;&#x5668;</span><br><span class="line">    mSystemServiceManager.startService(new SensorPrivacyService(mSystemContext));</span><br><span class="line"> </span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5728;BootPhase 100&#x9636;&#x6BB5;&#xFF0C;startBootstrapServices&#x542F;&#x52A8;&#x4EE5;&#x4E0B;&#x670D;&#x52A1;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PackageManagerService</span><br><span class="line">UserManagerService</span><br><span class="line">OverlayManagerService</span><br><span class="line">SensorPrivacyService</span><br></pre></td></tr></table></figure>
<p>&#x968F;&#x540E;&#x8FDB;&#x5165;startCoreServices</p>
<h2 id="startCoreServices"><a href="#startCoreServices" class="headerlink" title="startCoreServices"></a>startCoreServices</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">private void startCoreServices() {</span><br><span class="line">    // &#x542F;&#x52A8;BatterService, &#x7BA1;&#x7406;&#x7535;&#x91CF;&#xFF0C;&#x9700;&#x8981;LightService</span><br><span class="line">    mSystemServiceManager.startService(BatteryService.class);</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;UsageStatsService&#xFF0C;&#x7EDF;&#x8BA1;&#x5E94;&#x7528;&#x4F7F;&#x7528;&#x60C5;&#x51B5;</span><br><span class="line">    mSystemServiceManager.startService(UsageStatsService.class);</span><br><span class="line">    mActivityManagerService.setUsageStatsManager(</span><br><span class="line">            LocalServices.getService(UsageStatsManagerInternal.class));</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;WebViewUpdateService, &#x7BA1;&#x7406;WebView&#x66F4;&#x65B0;</span><br><span class="line">    if (mPackageManager.hasSystemFeature(PackageManager.FEATURE_WEBVIEW)) {</span><br><span class="line">        mWebViewUpdateService = mSystemServiceManager.startService(WebViewUpdateService.class);</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;CachedDeviceStateService, &#x7F13;&#x5B58;&#x8BBE;&#x5907;&#x72B6;&#x6001;</span><br><span class="line">    mSystemServiceManager.startService(CachedDeviceStateService.class);</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;BinderCallsStatsService, &#x8BB0;&#x5F55;cpu&#x5728;binder&#x56DE;&#x8C03;&#x4E2D;&#x82B1;&#x8D39;&#x7684;&#x65F6;&#x95F4;</span><br><span class="line">    mSystemServiceManager.startService(BinderCallsStatsService.LifeCycle.class);</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;LooperStatsService, &#x8BB0;&#x5F55;&#x4F7F;&#x7528;handler message&#x82B1;&#x8D39;&#x7684;&#x65F6;&#x95F4;</span><br><span class="line">    mSystemServiceManager.startService(LooperStatsService.Lifecycle.class);</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;RollbackManagerService&#xFF0C;&#x7BA1;&#x7406;apk&#x56DE;&#x5377;</span><br><span class="line">    mSystemServiceManager.startService(RollbackManagerService.class);</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;BugreportManagerService, &#x6355;&#x83B7;bug&#x7684;&#x62A5;&#x544A;</span><br><span class="line">    mSystemServiceManager.startService(BugreportManagerService.class);</span><br><span class="line"> </span><br><span class="line">    // &#x542F;&#x52A8;GpuService, &#x7BA1;&#x7406;GPU</span><br><span class="line">    mSystemServiceManager.startService(GpuService.class);</span><br><span class="line"> </span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">// BootPhase 100 &#x542F;&#x52A8;&#x7684;&#x670D;&#x52A1;</span><br><span class="line">UsageStatsService</span><br><span class="line">WebViewUpdateService</span><br><span class="line">CachedDeviceStateService</span><br><span class="line">BinderCallsStatsService</span><br><span class="line">LooperStatsService</span><br><span class="line">RollbackManagerService</span><br><span class="line">BugreportManagerService</span><br><span class="line">GpuService</span><br></pre></td></tr></table></figure>
<p>&#x4EE5;&#x4E0A;&#x662F;&#x542F;&#x52A8;&#x7684;&#x6838;&#x5FC3;&#x670D;&#x52A1;&#xFF1B;&#x7EE7;&#x7EED;&#x8FDB;&#x5165;startOtherServices</p>
<h2 id="startOtherServices"><a href="#startOtherServices" class="headerlink" title="startOtherServices"></a>startOtherServices</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">private void startOtherServices() {</span><br><span class="line">    final Context context = mSystemContext; // &#x83B7;&#x53D6;Context</span><br><span class="line"> </span><br><span class="line">    try {</span><br><span class="line">        ServiceManager.addService(&quot;sec_key_att_app_id_provider&quot;,</span><br><span class="line">                new KeyAttestationApplicationIdProviderService(context));</span><br><span class="line"> </span><br><span class="line">        mSystemServiceManager.startService(KeyChainSystemService.class);</span><br><span class="line"> </span><br><span class="line">        ServiceManager.addService(&quot;scheduling_policy&quot;, new SchedulingPolicyService());</span><br><span class="line"> </span><br><span class="line">        mSystemServiceManager.startService(TelecomLoaderService.class);</span><br><span class="line"> </span><br><span class="line">        telephonyRegistry = new TelephonyRegistry(context);</span><br><span class="line">        ServiceManager.addService(&quot;telephony.registry&quot;, telephonyRegistry);</span><br><span class="line"> </span><br><span class="line">        mEntropyMixer = new EntropyMixer(context);</span><br><span class="line"> </span><br><span class="line">        mContentResolver = context.getContentResolver(); // &#x83B7;&#x53D6;ContentResolver</span><br><span class="line"> </span><br><span class="line">        mSystemServiceManager.startService(ACCOUNT_SERVICE_CLASS);</span><br><span class="line"> </span><br><span class="line">        mSystemServiceManager.startService(CONTENT_SERVICE_CLASS);</span><br><span class="line"> </span><br><span class="line">        mActivityManagerService.installSystemProviders(); // &#x5B89;&#x88C5;&#x7CFB;&#x7EDF;Provider</span><br><span class="line"> </span><br><span class="line">        ...</span><br><span class="line"> </span><br><span class="line">        mSystemServiceManager.startService(new AlarmManagerService(context)); // &#x95F9;&#x949F;&#x670D;&#x52A1;</span><br><span class="line"> </span><br><span class="line">        ...</span><br><span class="line"> </span><br><span class="line">        mActivityManagerService.setWindowManager(wm); // &#x8BBE;&#x7F6E;WindowManager</span><br><span class="line"> </span><br><span class="line">        ...</span><br><span class="line"> </span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    ...</span><br><span class="line"> </span><br><span class="line">    // &#x8FDB;&#x5165;&#x5B89;&#x5168;&#x6A21;&#x5F0F;</span><br><span class="line">    if (safeMode) {</span><br><span class="line">        mActivityManagerService.enterSafeMode();</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line"> </span><br><span class="line">    // BootPhase  480</span><br><span class="line">    mSystemServiceManager.startBootPhase(SystemService.PHASE_LOCK_SETTINGS_READY);</span><br><span class="line"> </span><br><span class="line">    // BootPhase 500</span><br><span class="line">    mSystemServiceManager.startBootPhase(SystemService.PHASE_SYSTEM_SERVICES_READY);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    // BootPhase 520</span><br><span class="line">    mSystemServiceManager.startBootPhase(SystemService.PHASE_DEVICE_SPECIFIC_SERVICES_READY);</span><br><span class="line"> </span><br><span class="line">    try {</span><br><span class="line">        wm.systemReady();</span><br><span class="line">    } catch (Throwable e) {</span><br><span class="line">        reportWtf(&quot;making Window Manager Service ready&quot;, e);</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    if (safeMode) {</span><br><span class="line">        mActivityManagerService.showSafeModeOverlay();</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    // &#x66F4;&#x65B0;Configuration</span><br><span class="line">    final Configuration config = wm.computeNewConfiguration(DEFAULT_DISPLAY);</span><br><span class="line">    DisplayMetrics metrics = new DisplayMetrics();</span><br><span class="line">    WindowManager w = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE);</span><br><span class="line">    w.getDefaultDisplay().getMetrics(metrics);</span><br><span class="line">    context.getResources().updateConfiguration(config, metrics);</span><br><span class="line"> </span><br><span class="line">    final Theme systemTheme = context.getTheme();</span><br><span class="line">    if (systemTheme.getChangingConfigurations() != 0) {</span><br><span class="line">        systemTheme.rebase();</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    try {</span><br><span class="line">        mPowerManagerService.systemReady(mActivityManagerService.getAppOpsService());</span><br><span class="line">    } catch (Throwable e) {</span><br><span class="line">        reportWtf(&quot;making Power Manager Service ready&quot;, e);</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    mSystemServiceManager.startService(PermissionPolicyService.class);</span><br><span class="line"> </span><br><span class="line">    mPackageManagerService.systemReady();</span><br><span class="line"> </span><br><span class="line">    ...</span><br><span class="line"> </span><br><span class="line">    mActivityManagerService.systemReady(() -&gt; {</span><br><span class="line">        </span><br><span class="line">        // BootPhase 550</span><br><span class="line">        mSystemServiceManager.startBootPhase(</span><br><span class="line">                SystemService.PHASE_ACTIVITY_MANAGER_READY);</span><br><span class="line"> </span><br><span class="line">        try {</span><br><span class="line">            mActivityManagerService.startObservingNativeCrashes();</span><br><span class="line">        } catch (Throwable e) {</span><br><span class="line">            reportWtf(&quot;observing native crashes&quot;, e);</span><br><span class="line">        }</span><br><span class="line"> </span><br><span class="line">        traceBeginAndSlog(&quot;MakeConnectivityServiceReady&quot;);</span><br><span class="line">        try {</span><br><span class="line">            if (connectivityF != null) {</span><br><span class="line">                connectivityF.systemReady();</span><br><span class="line">            }</span><br><span class="line">        } catch (Throwable e) {</span><br><span class="line">            reportWtf(&quot;making Connectivity Service ready&quot;, e);</span><br><span class="line">        }</span><br><span class="line"> </span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line">        // BootPhase 600</span><br><span class="line">        mSystemServiceManager.startBootPhase(</span><br><span class="line">                SystemService.PHASE_THIRD_PARTY_APPS_CAN_START);</span><br><span class="line"> </span><br><span class="line">        try {</span><br><span class="line">            if (locationF != null) {</span><br><span class="line">                locationF.systemRunning();</span><br><span class="line">            }</span><br><span class="line">        } catch (Throwable e) {</span><br><span class="line">            reportWtf(&quot;Notifying Location Service running&quot;, e);</span><br><span class="line">        }</span><br><span class="line"> </span><br><span class="line">        try {</span><br><span class="line">            if (countryDetectorF != null) {</span><br><span class="line">                countryDetectorF.systemRunning();</span><br><span class="line">            }</span><br><span class="line">        } catch (Throwable e) {</span><br><span class="line">            reportWtf(&quot;Notifying CountryDetectorService running&quot;, e);</span><br><span class="line">        }</span><br><span class="line"> </span><br><span class="line">        ...</span><br><span class="line"> </span><br><span class="line">    }, BOOT_TIMINGS_TRACE_LOG);</span><br><span class="line"> </span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5728;startOtherServices&#x4E2D;&#x542F;&#x52A8;&#x4E86;&#x5927;&#x91CF;&#x670D;&#x52A1;&#xFF0C;&#x603B;&#x5171;&#x5DEE;&#x4E0D;&#x591A;&#x6709;80&#x591A;&#x79CD;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x4E00;&#x4E00;&#x5217;&#x4E3E;&#x51FA;&#x6765;&#x3002;</p>
<p>&#x6211;&#x8FD9;&#x91CC;&#x5C06;&#x5176;&#x4E0E;BootPhase&#x505A;&#x4E86;&#x4E2A;&#x5F52;&#x603B;&#xFF0C;&#x6765;&#x770B;&#x4E00;&#x4E0B;&#x5404;&#x4E2A;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#x90FD;&#x542F;&#x52A8;&#x4E86;&#x54EA;&#x4E9B;&#x670D;&#x52A1;&#x4E0E;&#x5BF9;&#x5E94;&#x670D;&#x52A1;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">// BootPhase 100</span><br><span class="line">KeyAttestationApplicationIdProviderService (startOtherServices)</span><br><span class="line">KeyChainSystemService </span><br><span class="line">SchedulingPolicyService</span><br><span class="line">TelecomLoaderService</span><br><span class="line">TelephonyRegistry</span><br><span class="line">EntropyMixer</span><br><span class="line">AccountManagerService</span><br><span class="line">ContentService</span><br><span class="line"> </span><br><span class="line">...(&#x5927;&#x91CF;&#x670D;&#x52A1;)</span><br><span class="line"> </span><br><span class="line">AppBindingService</span><br><span class="line"> </span><br><span class="line">BootPhase 480</span><br><span class="line"> </span><br><span class="line">BootPhase 500</span><br><span class="line"> </span><br><span class="line">PermissionPolicyService</span><br><span class="line">DeviceSpecificServices(&#x5305;&#x542B;&#x5927;&#x91CF;Service)</span><br><span class="line"> </span><br><span class="line">// &#x51C6;&#x5907;&#x597D; Power&#x3001;Package&#x4E0E;Diaplay&#x670D;&#x52A1;</span><br><span class="line">PowerManagerService.systemReady</span><br><span class="line">PackageManagerService.systemReady</span><br><span class="line">DisplayManagerService.systemReady</span><br><span class="line"> </span><br><span class="line">BootPhase 520</span><br><span class="line"> </span><br><span class="line">BootPhase 550</span><br><span class="line"> </span><br><span class="line">CarServiceHelperService</span><br><span class="line">startSystemUi</span><br><span class="line"> </span><br><span class="line">// &#x51C6;&#x5907;&#x597D; Network&#x3001;Ip&#x3001;Connectivity&#x670D;&#x52A1;</span><br><span class="line">NetworkManagementService.systemReady</span><br><span class="line">NetworkPolicyManagerService.systemReady</span><br><span class="line">IpSecService.systemReady</span><br><span class="line">NetworkStatsService.systemReady</span><br><span class="line">ConnectivityService.systemReady</span><br><span class="line">NetworkPolicyService.systemReady</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">BootPhase 600</span><br><span class="line">  </span><br><span class="line">NetworkStack</span><br><span class="line"> </span><br><span class="line">// &#x8FD0;&#x884C;Location&#x3001;CountryDetection&#x3001;Network&#x3001;Input&#x3001;Telephoney&#x3001;Media&#x3001;Mms&#x3001;Incident&#x670D;&#x52A1;</span><br><span class="line">LocationService.systemRunning</span><br><span class="line">CountryDetectionService.systemRunning</span><br><span class="line">NetworkTimeUpdateService.systemRunning</span><br><span class="line">InputManagerService.systemRunning</span><br><span class="line">TelephonyRegistry.systemRunning</span><br><span class="line">MediaRouterService.systemRunning</span><br><span class="line">MmsServiceBroker.systemRunning</span><br><span class="line">IncidentDaemon.systemRunning</span><br></pre></td></tr></table></figure>
<p>&#x6700;&#x540E;&#x7ECF;&#x8FC7;&#x4EE5;&#x4E0A;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x670D;&#x52A1;&#x8C03;&#x7528;&#xFF0C;&#x4F1A;&#x8C03;&#x7528;ActivityManagerService&#x7684;finishBooting&#x65B9;&#x6CD5;&#x6765;&#x6267;&#x884C;&#x6700;&#x540E;&#x4E00;&#x4E2A;BootPhase 1000&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">final void finishBooting() {</span><br><span class="line">    ...</span><br><span class="line"> </span><br><span class="line">    // BootPhase 1000</span><br><span class="line">    mSystemServiceManager.startBootPhase(SystemService.PHASE_BOOT_COMPLETED);</span><br><span class="line"> </span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x81F3;&#x6B64;&#xFF0C;&#x7CFB;&#x7EDF;&#x670D;&#x52A1;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x5B8C;&#x6210;&#x5C31;&#x7EEA;&#xFF0C;system_server&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#x5B8C;&#x6210;&#x5219;&#x8FDB;&#x5165;Looper.loop()&#x72B6;&#x6001;&#xFF0C;&#x7B49;&#x5F85;&#x6D88;&#x606F;&#x961F;&#x5217;MessageQueue&#x4E2D;&#x7684;&#x6D88;&#x606F;&#x5230;&#x6765;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;&#x5BF9;&#x5E94;&#x7684;Message&#x3002;</p>
<p>&#x4EE5;&#x4E0A;&#x662F;SystemService&#x7684;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#xFF0C;&#x4E3B;&#x8981;&#x901A;&#x8FC7;BootPhase 0 ~ BootPhase 1000&#x6765;&#x5206;&#x522B;&#x542F;&#x52A8;&#x4E0D;&#x540C;&#x7684;Service&#xFF0C;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;BootPhase&#xFF0C;&#x76F8;&#x5E94;&#x7684;Service&#x6267;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x903B;&#x8F91;&#x3002;&#x540E;&#x7EED;Service&#x542F;&#x52A8;&#x903B;&#x8F91;&#x4E0E;&#x6267;&#x884C;&#x903B;&#x8F91;&#x53EF;&#x80FD;&#x4F9D;&#x8D56;&#x4E8E;&#x4E4B;&#x524D;&#x7684;Service&#xFF0C;&#x800C;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x4F9D;&#x8D56;&#x7BA1;&#x7406;&#x662F;&#x901A;&#x8FC7;BootPhase&#x6765;&#x5EFA;&#x7ACB;&#x7684;&#x3002;</p>
<h2 id="&#x9879;&#x76EE;"><a href="#&#x9879;&#x76EE;" class="headerlink" title="&#x9879;&#x76EE;"></a>&#x9879;&#x76EE;</h2><p><a href="https://github.com/idisfkj/android-startup" target="_blank" rel="noopener">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>
<p><a href="https://github.com/idisfkj/AwesomeGithub" target="_blank" rel="noopener">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>
<p><a href="https://github.com/idisfkj/flutter_github" target="_blank" rel="noopener">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>
<p><a href="https://github.com/idisfkj/android-api-analysis" target="_blank" rel="noopener">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>
<p><a href="https://github.com/idisfkj/daily_algorithm" target="_blank" rel="noopener">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>

    
  </div>
</article>


   
  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">支持一下</span>
      <div class="donation-body">
        <div class="tip text-center">赞赏是一门艺术</div>
        <ul class="theme.donation.items.length">
        
          <li class="item">
            <img src="/images/rouse_wechat.png" alt="">
          </li>
        
          <li class="item">
            <img src="/images/rouse_alipay.png" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>


   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2020/12/31/Android-SystemServer启动-一/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2021/01/07/一文彻底搞懂Kotlin-inline/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              友链
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/atom.xml"
              rel="noopener noreferrer"
              target="_blank"
              >
              RSS
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              搜索
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
    <div class="fexo-comments comments-post">
  

  

  

  
  <div id="gitment-comments"></div>
  <link rel="stylesheet" href="https://jjeejj.github.io/css/gitment.css">
  <script src="https://jjeejj.github.io/js/gitment.js"></script>
  <script>
    (function () {
      var gitment = new Gitment({
        owner: 'idisfkj',
        repo: 'idisfkj.github.io',
        id: 'Mon Jan 04 2021 22:36:24 GMT+0800',
        oauth: {
          client_id: 'dafb1df02ea9f875bb78',
          client_secret: 'e9873d78aa5eaed5ce61d1d865a5af501dae377a'
        },
        
        
        
        
        
        
        
        
      })
      gitment.render('gitment-comments')
    })()
  </script>

  
  
</div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
