[{"title":"突破自定义View性能瓶颈","url":"https://www.rousetime.com/2023/05/29/突破自定义View性能瓶颈/","content":"<p>&#x5728;Android&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x81EA;&#x5B9A;&#x4E49;View&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x5E38;&#x89C1;&#x7684;&#x9700;&#x6C42;&#x3002;&#x81EA;&#x5B9A;&#x4E49;View&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x60A8;&#x521B;&#x5EFA;&#x72EC;&#x7279;&#x7684;UI&#x5143;&#x7D20;&#xFF0C;&#x4EE5;&#x6EE1;&#x8DB3;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x7279;&#x5B9A;&#x9700;&#x6C42;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x81EA;&#x5B9A;&#x4E49;View&#x4E5F;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x6027;&#x80FD;&#x95EE;&#x9898;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5728;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x9700;&#x8981;&#x5904;&#x7406;&#x5927;&#x91CF;&#x81EA;&#x5B9A;&#x4E49;View&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x3002;</p>\n<p>&#x5728;&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x63A2;&#x8BA8;&#x4E00;&#x4E9B;Android&#x81EA;&#x5B9A;&#x4E49;View&#x6027;&#x80FD;&#x4F18;&#x5316;&#x7684;&#x6280;&#x5DE7;&#xFF0C;&#x4EE5;&#x786E;&#x4FDD;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x5904;&#x7406;&#x81EA;&#x5B9A;&#x4E49;View&#x65F6;&#x4FDD;&#x6301;&#x9AD8;&#x6548;&#x548C;&#x7A33;&#x5B9A;&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x4ECE;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x65B9;&#x9762;&#x8FDB;&#x884C;&#x8BA8;&#x8BBA;&#xFF1A;</p>\n<h2 id=\"1-&#x4F7F;&#x7528;&#x6B63;&#x786E;&#x7684;&#x5E03;&#x5C40;\"><a href=\"#1-&#x4F7F;&#x7528;&#x6B63;&#x786E;&#x7684;&#x5E03;&#x5C40;\" class=\"headerlink\" title=\"1. &#x4F7F;&#x7528;&#x6B63;&#x786E;&#x7684;&#x5E03;&#x5C40;\"></a>1. &#x4F7F;&#x7528;&#x6B63;&#x786E;&#x7684;&#x5E03;&#x5C40;</h2><p>&#x5728;&#x521B;&#x5EFA;&#x81EA;&#x5B9A;&#x4E49;View&#x65F6;&#xFF0C;&#x6B63;&#x786E;&#x7684;&#x5E03;&#x5C40;&#x662F;&#x81F3;&#x5173;&#x91CD;&#x8981;&#x7684;&#x3002;&#x4F7F;&#x7528;&#x6B63;&#x786E;&#x7684;&#x5E03;&#x5C40;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x60A8;&#x6700;&#x5927;&#x9650;&#x5EA6;&#x5730;&#x51CF;&#x5C11;&#x5E03;&#x5C40;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x9AD8;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x6027;&#x80FD;&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5177;&#x6709;&#x591A;&#x4E2A;&#x5B50;&#x89C6;&#x56FE;&#x7684;&#x81EA;&#x5B9A;&#x4E49;View&#xFF0C;&#x4F7F;&#x7528;ConstraintLayout&#x4EE3;&#x66FF;RelativeLayout&#x548C;LinearLayout&#x53EF;&#x4EE5;&#x7B80;&#x5316;&#x5E03;&#x5C40;&#x5E76;&#x51CF;&#x5C11;&#x5D4C;&#x5957;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">androidx.constraintlayout.widget.ConstraintLayout</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:android</span>=<span class=\"string\">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">&quot;match_parent&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">&quot;match_parent&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &#x6DFB;&#x52A0;&#x60A8;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x89C6;&#x56FE;&#x7EC4;&#x4EF6;&#x548C;&#x7EA6;&#x675F;&#x6761;&#x4EF6; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>&#x53E6;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x5E03;&#x5C40;&#x6280;&#x5DE7;&#x662F;&#x4F7F;&#x7528;ViewStub&#x3002;ViewStub&#x662F;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x89C6;&#x56FE;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x7528;&#x4F5C;&#x5360;&#x4F4D;&#x7B26;&#xFF0C;&#x76F4;&#x5230;&#x9700;&#x8981;&#x771F;&#x6B63;&#x7684;&#x89C6;&#x56FE;&#x65F6;&#x624D;&#x5145;&#x6C14;&#x3002;&#x8FD9;&#x53EF;&#x4EE5;&#x5927;&#x5927;&#x51CF;&#x5C11;&#x5E03;&#x5C40;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x5E76;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#x3002;</p>\n<h2 id=\"2-&#x7F13;&#x5B58;&#x89C6;&#x56FE;\"><a href=\"#2-&#x7F13;&#x5B58;&#x89C6;&#x56FE;\" class=\"headerlink\" title=\"2. &#x7F13;&#x5B58;&#x89C6;&#x56FE;\"></a>2. &#x7F13;&#x5B58;&#x89C6;&#x56FE;</h2><p>&#x7F13;&#x5B58;&#x89C6;&#x56FE;&#x662F;&#x53E6;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x6027;&#x80FD;&#x4F18;&#x5316;&#x6280;&#x5DE7;&#x3002;&#x5F53;&#x60A8;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;View&#x65F6;&#xFF0C;&#x901A;&#x5E38;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x591A;&#x4E2A;&#x5B9E;&#x4F8B;&#x3002;&#x5982;&#x679C;&#x60A8;&#x6CA1;&#x6709;&#x6B63;&#x786E;&#x5730;&#x7F13;&#x5B58;&#x8FD9;&#x4E9B;&#x5B9E;&#x4F8B;&#xFF0C;&#x90A3;&#x4E48;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x80FD;&#x4F1A;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x6162;&#x3002;</p>\n<p>&#x4E3A;&#x4E86;&#x7F13;&#x5B58;&#x89C6;&#x56FE;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Android&#x7684;ViewHolder&#x6A21;&#x5F0F;&#x6216;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7F13;&#x5B58;&#x5BF9;&#x8C61;&#x3002;ViewHolder&#x6A21;&#x5F0F;&#x662F;Android&#x5F00;&#x53D1;&#x8005;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#x7684;&#x4E00;&#x79CD;&#x6280;&#x672F;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x5217;&#x8868;&#x6216;&#x7F51;&#x683C;&#x89C6;&#x56FE;&#x4E2D;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#x3002;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7F13;&#x5B58;&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x5730;&#x63A7;&#x5236;&#x89C6;&#x56FE;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x5E76;&#x51CF;&#x5C11;&#x89C6;&#x56FE;&#x7684;&#x521B;&#x5EFA;&#x548C;&#x9500;&#x6BC1;&#x3002;</p>\n<p>&#x4EE5;&#x4E0B;&#x662F;ViewHolder&#x6A21;&#x5F0F;&#x7684;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CustomView</span></span>(context: Context) : View(context) {</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ViewHolder</span> </span>{</span><br><span class=\"line\">        <span class=\"comment\">// &#x7F13;&#x5B58;&#x89C6;&#x56FE;</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> textView: TextView? = <span class=\"literal\">null</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> imageView: ImageView? = <span class=\"literal\">null</span></span><br><span class=\"line\">        <span class=\"comment\">// &#x6DFB;&#x52A0;&#x5176;&#x4ED6;&#x89C6;&#x56FE;&#x7EC4;&#x4EF6;</span></span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">var</span> viewHolder: ViewHolder? = <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">init</span> {</span><br><span class=\"line\">        <span class=\"comment\">// &#x521D;&#x59CB;&#x5316;ViewHolder</span></span><br><span class=\"line\">        viewHolder = ViewHolder()</span><br><span class=\"line\">        <span class=\"comment\">// &#x67E5;&#x627E;&#x89C6;&#x56FE;&#x5E76;&#x5173;&#x8054;&#x5230;ViewHolder</span></span><br><span class=\"line\">        viewHolder?.textView = findViewById(R.id.text_view)</span><br><span class=\"line\">        viewHolder?.imageView = findViewById(R.id.image_view)</span><br><span class=\"line\">        <span class=\"comment\">// &#x6DFB;&#x52A0;&#x5176;&#x4ED6;&#x89C6;&#x56FE;&#x7EC4;&#x4EF6;&#x7684;&#x67E5;&#x627E;&#x548C;&#x5173;&#x8054;</span></span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onDraw</span><span class=\"params\">(canvas: <span class=\"type\">Canvas</span>)</span></span> {</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDraw(canvas)</span><br><span class=\"line\">        <span class=\"comment\">// &#x7ED8;&#x5236;&#x89C6;&#x56FE;</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-&#x907F;&#x514D;&#x8FC7;&#x591A;&#x7684;&#x7ED8;&#x5236;&#x64CD;&#x4F5C;\"><a href=\"#3-&#x907F;&#x514D;&#x8FC7;&#x591A;&#x7684;&#x7ED8;&#x5236;&#x64CD;&#x4F5C;\" class=\"headerlink\" title=\"3. &#x907F;&#x514D;&#x8FC7;&#x591A;&#x7684;&#x7ED8;&#x5236;&#x64CD;&#x4F5C;\"></a>3. &#x907F;&#x514D;&#x8FC7;&#x591A;&#x7684;&#x7ED8;&#x5236;&#x64CD;&#x4F5C;</h2><p>&#x7ED8;&#x5236;&#x64CD;&#x4F5C;&#x662F;&#x81EA;&#x5B9A;&#x4E49;View&#x4E2D;&#x6700;&#x91CD;&#x8981;&#x7684;&#x6027;&#x80FD;&#x95EE;&#x9898;&#x4E4B;&#x4E00;&#x3002;&#x5982;&#x679C;&#x60A8;&#x7684;&#x81EA;&#x5B9A;&#x4E49;View&#x9700;&#x8981;&#x5927;&#x91CF;&#x7684;&#x7ED8;&#x5236;&#x64CD;&#x4F5C;&#xFF0C;&#x90A3;&#x4E48;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x80FD;&#x4F1A;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x6162;&#x3002;</p>\n<p>&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x8FC7;&#x591A;&#x7684;&#x7ED8;&#x5236;&#x64CD;&#x4F5C;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;View&#x7684;setWillNotDraw&#x65B9;&#x6CD5;&#x6765;&#x7981;&#x7528;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x7ED8;&#x5236;&#x3002;&#x60A8;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Canvas&#x7684;clipRect&#x65B9;&#x6CD5;&#x6765;&#x9650;&#x5236;&#x7ED8;&#x5236;&#x64CD;&#x4F5C;&#x7684;&#x533A;&#x57DF;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x60A8;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x786C;&#x4EF6;&#x52A0;&#x901F;&#x6765;&#x52A0;&#x901F;&#x7ED8;&#x5236;&#x64CD;&#x4F5C;&#x3002;</p>\n<p>&#x4EE5;&#x4E0B;&#x662F;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CustomView</span></span>(context: Context) : View(context) {</span><br><span class=\"line\">    <span class=\"keyword\">init</span> {</span><br><span class=\"line\">        setWillNotDraw(<span class=\"literal\">true</span>) <span class=\"comment\">// &#x7981;&#x7528;&#x7ED8;&#x5236;</span></span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onDraw</span><span class=\"params\">(canvas: <span class=\"type\">Canvas</span>)</span></span> {</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDraw(canvas)</span><br><span class=\"line\">        <span class=\"comment\">// &#x7ED8;&#x5236;&#x64CD;&#x4F5C;</span></span><br><span class=\"line\">        canvas.clipRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, width, height) <span class=\"comment\">// &#x9650;&#x5236;&#x7ED8;&#x5236;&#x533A;&#x57DF;</span></span><br><span class=\"line\">        <span class=\"comment\">// &#x6DFB;&#x52A0;&#x5176;&#x4ED6;&#x7ED8;&#x5236;&#x64CD;&#x4F5C;</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-&#x4F7F;&#x7528;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;\"><a href=\"#4-&#x4F7F;&#x7528;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;\" class=\"headerlink\" title=\"4. &#x4F7F;&#x7528;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;\"></a>4. &#x4F7F;&#x7528;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;</h2><p>&#x5982;&#x679C;&#x60A8;&#x7684;&#x81EA;&#x5B9A;&#x4E49;View&#x9700;&#x8981;&#x6267;&#x884C;&#x8017;&#x65F6;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x4F8B;&#x5982;&#x4ECE;&#x7F51;&#x7EDC;&#x52A0;&#x8F7D;&#x56FE;&#x50CF;&#x6216;&#x5904;&#x7406;&#x5927;&#x91CF;&#x6570;&#x636E;&#xFF0C;&#x90A3;&#x4E48;&#x60A8;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x6765;&#x6267;&#x884C;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x3002;&#x8FD9;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x6267;&#x884C;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x65F6;&#x4FDD;&#x6301;&#x54CD;&#x5E94;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x4F1A;&#x963B;&#x585E;&#x7528;&#x6237;&#x754C;&#x9762;&#x3002;</p>\n<p>&#x4EE5;&#x4E0B;&#x662F;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x52A0;&#x8F7D;&#x56FE;&#x50CF;&#x7684;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CustomView</span></span>(context: Context) : View(context) {</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">var</span> image: Bitmap? = <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">loadImageAsync</span><span class=\"params\">(imageUrl: <span class=\"type\">String</span>)</span></span> {</span><br><span class=\"line\">        <span class=\"keyword\">val</span> asyncTask = <span class=\"keyword\">object</span> : AsyncTask&lt;<span class=\"built_in\">Void</span>, <span class=\"built_in\">Void</span>, Bitmap&gt;() {</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">doInBackground</span><span class=\"params\">(<span class=\"keyword\">vararg</span> params: <span class=\"type\">Void</span>?)</span></span>: Bitmap {</span><br><span class=\"line\">                <span class=\"comment\">// &#x6267;&#x884C;&#x8017;&#x65F6;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x4ECE;&#x7F51;&#x7EDC;&#x52A0;&#x8F7D;&#x56FE;&#x50CF;</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> loadImageFromUrl(imageUrl)</span><br><span class=\"line\">            }</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onPostExecute</span><span class=\"params\">(result: <span class=\"type\">Bitmap</span>)</span></span> {</span><br><span class=\"line\">                <span class=\"keyword\">super</span>.onPostExecute(result)</span><br><span class=\"line\">                <span class=\"comment\">// &#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x66F4;&#x65B0;UI</span></span><br><span class=\"line\">                image = result</span><br><span class=\"line\">                invalidate() <span class=\"comment\">// &#x5237;&#x65B0;&#x89C6;&#x56FE;</span></span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        asyncTask.execute()</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onDraw</span><span class=\"params\">(canvas: <span class=\"type\">Canvas</span>)</span></span> {</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDraw(canvas)</span><br><span class=\"line\">        <span class=\"comment\">// &#x7ED8;&#x5236;&#x56FE;&#x50CF;</span></span><br><span class=\"line\">        image?.let {</span><br><span class=\"line\">            canvas.drawBitmap(it, <span class=\"number\">0f</span>, <span class=\"number\">0f</span>, <span class=\"literal\">null</span>)</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"comment\">// &#x6DFB;&#x52A0;&#x5176;&#x4ED6;&#x7ED8;&#x5236;&#x64CD;&#x4F5C;</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"5-&#x4F7F;&#x7528;&#x9002;&#x5F53;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;\"><a href=\"#5-&#x4F7F;&#x7528;&#x9002;&#x5F53;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;\" class=\"headerlink\" title=\"5. &#x4F7F;&#x7528;&#x9002;&#x5F53;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;\"></a>5. &#x4F7F;&#x7528;&#x9002;&#x5F53;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;</h2><p>&#x5728;&#x81EA;&#x5B9A;&#x4E49;View&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;&#x9002;&#x5F53;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x53EF;&#x4EE5;&#x5927;&#x5927;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x9700;&#x8981;&#x7ED8;&#x5236;&#x5927;&#x91CF;&#x7684;&#x70B9;&#x6216;&#x7EBF;&#xFF0C;&#x90A3;&#x4E48;&#x4F7F;&#x7528;FloatBuffer&#x6216;ByteBuffer&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#x3002;&#x5982;&#x679C;&#x60A8;&#x9700;&#x8981;&#x5904;&#x7406;&#x5927;&#x91CF;&#x7684;&#x56FE;&#x50CF;&#x6570;&#x636E;&#xFF0C;&#x90A3;&#x4E48;&#x4F7F;&#x7528;BitmapFactory.Options&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x91CF;&#x3002;</p>\n<p>&#x4EE5;&#x4E0B;&#x662F;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;FloatBuffer&#x7ED8;&#x5236;&#x70B9;&#x7684;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CustomView</span></span>(context: Context) : View(context) {</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">var</span> pointBuffer: FloatBuffer? = <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">init</span> {</span><br><span class=\"line\">        <span class=\"comment\">// &#x521D;&#x59CB;&#x5316;&#x70B9;&#x7684;&#x6570;&#x636E;</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> points = floatArrayOf(<span class=\"number\">0f</span>, <span class=\"number\">0f</span>, <span class=\"number\">100f</span>, <span class=\"number\">100f</span>, <span class=\"number\">200f</span>, <span class=\"number\">200f</span>)</span><br><span class=\"line\">        pointBuffer = ByteBuffer.allocateDirect(points.size * <span class=\"number\">4</span>)</span><br><span class=\"line\">            .order(ByteOrder.nativeOrder())</span><br><span class=\"line\">            .asFloatBuffer()</span><br><span class=\"line\">        pointBuffer?.put(points)</span><br><span class=\"line\">        pointBuffer?.position(<span class=\"number\">0</span>)</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onDraw</span><span class=\"params\">(canvas: <span class=\"type\">Canvas</span>)</span></span> {</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDraw(canvas)</span><br><span class=\"line\">        <span class=\"comment\">// &#x7ED8;&#x5236;&#x70B9;</span></span><br><span class=\"line\">        pointBuffer?.let {</span><br><span class=\"line\">            canvas.drawPoints(it, paint)</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"comment\">// &#x6DFB;&#x52A0;&#x5176;&#x4ED6;&#x7ED8;&#x5236;&#x64CD;&#x4F5C;</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x7ED3;&#x8BBA;\"><a href=\"#&#x7ED3;&#x8BBA;\" class=\"headerlink\" title=\"&#x7ED3;&#x8BBA;\"></a>&#x7ED3;&#x8BBA;</h2><p>&#x5728;&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x63A2;&#x8BA8;&#x4E86;&#x4E00;&#x4E9B;Android&#x81EA;&#x5B9A;&#x4E49;View&#x6027;&#x80FD;&#x4F18;&#x5316;&#x7684;&#x6280;&#x5DE7;&#x3002;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x6B63;&#x786E;&#x7684;&#x5E03;&#x5C40;&#xFF0C;&#x7F13;&#x5B58;&#x89C6;&#x56FE;&#xFF0C;&#x907F;&#x514D;&#x8FC7;&#x591A;&#x7684;&#x7ED8;&#x5236;&#x64CD;&#x4F5C;&#xFF0C;&#x4F7F;&#x7528;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x548C;&#x9002;&#x5F53;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x5904;&#x7406;&#x81EA;&#x5B9A;&#x4E49;View&#x65F6;&#x4FDD;&#x6301;&#x9AD8;&#x6548;&#x548C;&#x7A33;&#x5B9A;&#x3002;</p>\n<p>&#x8BF7;&#x8BB0;&#x4F4F;&#xFF0C;&#x4F18;&#x5316;&#x81EA;&#x5B9A;&#x4E49;View&#x7684;&#x6027;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x6301;&#x7EED;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x60A8;&#x5E94;&#x8BE5;&#x7ECF;&#x5E38;&#x68C0;&#x67E5;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x6700;&#x65B0;&#x7684;&#x6280;&#x672F;&#x548C;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x6765;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#x3002;</p>\n<h2 id=\"&#x63A8;&#x8350;\"><a href=\"#&#x63A8;&#x8350;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;\"></a>&#x63A8;&#x8350;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack\\&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["自定义view"]},{"title":"Android 自定义 View 独家技巧","url":"https://www.rousetime.com/2023/05/27/Android-自定义-View-独家技巧/","content":"<p>&#x5728;Android&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x81EA;&#x5B9A;&#x4E49;View&#x662F;&#x975E;&#x5E38;&#x5E38;&#x89C1;&#x7684;&#x9700;&#x6C42;&#x3002;&#x81EA;&#x5B9A;&#x4E49;View&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x6216;&#x8005;&#x8BA9;&#x6211;&#x4EEC;&#x7684;&#x5E94;&#x7528;&#x66F4;&#x52A0;&#x7F8E;&#x89C2;&#x3002;&#x672C;&#x6587;&#x5C06;&#x4ECB;&#x7ECD;Android&#x81EA;&#x5B9A;&#x4E49;View&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#x3002;</p>\n<h2 id=\"&#x6B65;&#x9AA4;&#x4E00;&#xFF1A;&#x7EE7;&#x627F;View&#x6216;&#x8005;&#x5176;&#x5B50;&#x7C7B;\"><a href=\"#&#x6B65;&#x9AA4;&#x4E00;&#xFF1A;&#x7EE7;&#x627F;View&#x6216;&#x8005;&#x5176;&#x5B50;&#x7C7B;\" class=\"headerlink\" title=\"&#x6B65;&#x9AA4;&#x4E00;&#xFF1A;&#x7EE7;&#x627F;View&#x6216;&#x8005;&#x5176;&#x5B50;&#x7C7B;\"></a>&#x6B65;&#x9AA4;&#x4E00;&#xFF1A;&#x7EE7;&#x627F;View&#x6216;&#x8005;&#x5176;&#x5B50;&#x7C7B;</h2><p>&#x8981;&#x81EA;&#x5B9A;&#x4E49;View&#xFF0C;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7C7B;&#xFF0C;&#x5E76;&#x8BA9;&#x5B83;&#x7EE7;&#x627F;&#x81EA;View&#x6216;&#x8005;&#x5176;&#x5B50;&#x7C7B;&#x3002;View&#x662F;&#x6240;&#x6709;&#x63A7;&#x4EF6;&#x7684;&#x57FA;&#x7C7B;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7EE7;&#x627F;View&#x6765;&#x521B;&#x5EFA;&#x81EA;&#x5B9A;&#x4E49;&#x63A7;&#x4EF6;&#x3002;</p>\n<p>&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;MyView&#x7684;&#x7C7B;&#xFF0C;&#x5E76;&#x8BA9;&#x5B83;&#x7EE7;&#x627F;&#x81EA;View&#xFF1A;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyView</span> <span class=\"keyword\">extends</span> <span class=\"title\">View</span> </span>{</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x6B65;&#x9AA4;&#x4E8C;&#xFF1A;&#x5B9E;&#x73B0;&#x6784;&#x9020;&#x65B9;&#x6CD5;\"><a href=\"#&#x6B65;&#x9AA4;&#x4E8C;&#xFF1A;&#x5B9E;&#x73B0;&#x6784;&#x9020;&#x65B9;&#x6CD5;\" class=\"headerlink\" title=\"&#x6B65;&#x9AA4;&#x4E8C;&#xFF1A;&#x5B9E;&#x73B0;&#x6784;&#x9020;&#x65B9;&#x6CD5;\"></a>&#x6B65;&#x9AA4;&#x4E8C;&#xFF1A;&#x5B9E;&#x73B0;&#x6784;&#x9020;&#x65B9;&#x6CD5;</h2><p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E3A;&#x81EA;&#x5B9A;&#x4E49;View&#x5B9E;&#x73B0;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x3002;&#x5728;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5B8C;&#x6210;&#x4E00;&#x4E9B;&#x521D;&#x59CB;&#x5316;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982;&#x8BBE;&#x7F6E;&#x753B;&#x7B14;&#x989C;&#x8272;&#x3001;&#x521D;&#x59CB;&#x5316;&#x5C5E;&#x6027;&#x7B49;&#x3002;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyView</span><span class=\"params\">(Context context, AttributeSet attrs)</span> </span>{</span><br><span class=\"line\">    <span class=\"keyword\">super</span>(context, attrs);</span><br><span class=\"line\">    <span class=\"comment\">// ... &#x521D;&#x59CB;&#x5316;&#x5DE5;&#x4F5C;</span></span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x6B65;&#x9AA4;&#x4E09;&#xFF1A;&#x5B9E;&#x73B0;onDraw&#x65B9;&#x6CD5;\"><a href=\"#&#x6B65;&#x9AA4;&#x4E09;&#xFF1A;&#x5B9E;&#x73B0;onDraw&#x65B9;&#x6CD5;\" class=\"headerlink\" title=\"&#x6B65;&#x9AA4;&#x4E09;&#xFF1A;&#x5B9E;&#x73B0;onDraw&#x65B9;&#x6CD5;\"></a>&#x6B65;&#x9AA4;&#x4E09;&#xFF1A;&#x5B9E;&#x73B0;onDraw&#x65B9;&#x6CD5;</h2><p>onDraw&#x65B9;&#x6CD5;&#x662F;&#x81EA;&#x5B9A;&#x4E49;View&#x4E2D;&#x6700;&#x91CD;&#x8981;&#x7684;&#x65B9;&#x6CD5;&#x4E4B;&#x4E00;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x753B;&#x7B14;&#x7ED8;&#x5236;&#x81EA;&#x5DF1;&#x60F3;&#x8981;&#x7684;&#x56FE;&#x5F62;&#x3002;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onDraw</span><span class=\"params\">(Canvas canvas)</span> </span>{</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.onDraw(canvas);</span><br><span class=\"line\">    <span class=\"comment\">// ... &#x7ED8;&#x5236;&#x56FE;&#x5F62;</span></span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x5B9E;&#x73B0;onDraw&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x6280;&#x5DE7;&#xFF1A;</p>\n<ul>\n<li>&#x4F7F;&#x7528;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#xFF1A;&#x5728;onDraw&#x65B9;&#x6CD5;&#x4E2D;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x548C;&#x53D8;&#x91CF;&#x4F1A;&#x589E;&#x52A0;&#x5185;&#x5B58;&#x5206;&#x914D;&#x548C;&#x5783;&#x573E;&#x56DE;&#x6536;&#x7684;&#x8D1F;&#x62C5;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5728;onDraw&#x65B9;&#x6CD5;&#x4E2D;&#x4F7F;&#x7528;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#x3002;</li>\n<li>&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#xFF1A;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x9891;&#x7E41;&#x91CD;&#x7ED8;&#x7684;&#x81EA;&#x5B9A;&#x4E49;View&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x6765;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Bitmap&#x6216;&#x8005;Canvas&#x6765;&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#x3002;</li>\n<li>&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#xFF1A;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x8017;&#x65F6;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x3001;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x7B49;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6765;&#x907F;&#x514D;&#x963B;&#x585E;UI&#x7EBF;&#x7A0B;&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;AsyncTask&#x6216;&#x8005;Handler&#x6765;&#x5F00;&#x542F;&#x7EBF;&#x7A0B;&#x3002;</li>\n</ul>\n<p>&#x4EE5;&#x4E0B;&#x662F;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x548C;&#x7F13;&#x5B58;&#x7684;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyView</span> <span class=\"keyword\">extends</span> <span class=\"title\">View</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Paint mPaint; <span class=\"comment\">// &#x753B;&#x7B14;</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Bitmap mBitmap; <span class=\"comment\">// &#x7F13;&#x5B58;&#x7684;Bitmap</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Canvas mCanvas; <span class=\"comment\">// &#x7F13;&#x5B58;&#x7684;Canvas</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyView</span><span class=\"params\">(Context context, AttributeSet attrs)</span> </span>{</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(context, attrs);</span><br><span class=\"line\">        init();</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>{</span><br><span class=\"line\">        mPaint = <span class=\"keyword\">new</span> Paint();</span><br><span class=\"line\">        mPaint.setColor(Color.RED);</span><br><span class=\"line\">        mPaint.setStrokeWidth(<span class=\"number\">5</span>);</span><br><span class=\"line\">        mPaint.setStyle(Paint.Style.STROKE);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onDraw</span><span class=\"params\">(Canvas canvas)</span> </span>{</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDraw(canvas);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mBitmap == <span class=\"keyword\">null</span>) {</span><br><span class=\"line\">            <span class=\"comment\">// &#x521B;&#x5EFA;&#x7F13;&#x5B58;&#x7684;Bitmap&#x548C;Canvas</span></span><br><span class=\"line\">            mBitmap = Bitmap.createBitmap(getWidth(), getHeight(), Bitmap.Config.ARGB_8888);</span><br><span class=\"line\">            mCanvas = <span class=\"keyword\">new</span> Canvas(mBitmap);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"comment\">// &#x7ED8;&#x5236;&#x56FE;&#x5F62;&#x5230;&#x7F13;&#x5B58;&#x7684;Canvas&#x4E0A;</span></span><br><span class=\"line\">        mCanvas.drawCircle(getWidth() / <span class=\"number\">2</span>, getHeight() / <span class=\"number\">2</span>, getWidth() / <span class=\"number\">2</span> - <span class=\"number\">5</span>, mPaint);</span><br><span class=\"line\">        <span class=\"comment\">// &#x5C06;&#x7F13;&#x5B58;&#x7684;Bitmap&#x7ED8;&#x5236;&#x5230;View&#x7684;Canvas&#x4E0A;</span></span><br><span class=\"line\">        canvas.drawBitmap(mBitmap, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x6B65;&#x9AA4;&#x56DB;&#xFF1A;&#x5904;&#x7406;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;\"><a href=\"#&#x6B65;&#x9AA4;&#x56DB;&#xFF1A;&#x5904;&#x7406;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;\" class=\"headerlink\" title=\"&#x6B65;&#x9AA4;&#x56DB;&#xFF1A;&#x5904;&#x7406;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;\"></a>&#x6B65;&#x9AA4;&#x56DB;&#xFF1A;&#x5904;&#x7406;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;</h2><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x7684;&#x81EA;&#x5B9A;&#x4E49;View&#x9700;&#x8981;&#x652F;&#x6301;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onTouchEvent</span><span class=\"params\">(MotionEvent event)</span> </span>{</span><br><span class=\"line\">    <span class=\"comment\">// ... &#x5904;&#x7406;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">super</span>.onTouchEvent(event);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x5904;&#x7406;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x6280;&#x5DE7;&#xFF1A;</p>\n<ul>\n<li>&#x4F7F;&#x7528;GestureDetector&#xFF1A;GestureDetector&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x68C0;&#x6D4B;&#x624B;&#x52BF;&#xFF0C;&#x6BD4;&#x5982;&#x5355;&#x51FB;&#x3001;&#x53CC;&#x51FB;&#x3001;&#x957F;&#x6309;&#x3001;&#x6ED1;&#x52A8;&#x7B49;&#x3002;</li>\n<li>&#x4F7F;&#x7528;VelocityTracker&#xFF1A;VelocityTracker&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x8BA1;&#x7B97;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;&#x7684;&#x901F;&#x5EA6;&#x548C;&#x65B9;&#x5411;&#xFF0C;&#x6BD4;&#x5982;&#x6ED1;&#x52A8;&#x7684;&#x901F;&#x5EA6;&#x548C;&#x65B9;&#x5411;&#x3002;</li>\n<li>&#x4F7F;&#x7528;Scroller&#xFF1A;Scroller&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x5E73;&#x6ED1;&#x7684;&#x6EDA;&#x52A8;&#x6548;&#x679C;&#xFF0C;&#x6BD4;&#x5982;ListView&#x548C;ScrollView&#x4E2D;&#x7684;&#x6EDA;&#x52A8;&#x6548;&#x679C;&#x3002;</li>\n</ul>\n<p>&#x4EE5;&#x4E0B;&#x662F;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;GestureDetector&#x7684;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyView</span> <span class=\"keyword\">extends</span> <span class=\"title\">View</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> GestureDetector mGestureDetector;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyView</span><span class=\"params\">(Context context, AttributeSet attrs)</span> </span>{</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(context, attrs);</span><br><span class=\"line\">        init();</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>{</span><br><span class=\"line\">        mGestureDetector = <span class=\"keyword\">new</span> GestureDetector(getContext(), <span class=\"keyword\">new</span> GestureDetector.SimpleOnGestureListener() {</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onSingleTapUp</span><span class=\"params\">(MotionEvent e)</span> </span>{</span><br><span class=\"line\">                <span class=\"comment\">// &#x5904;&#x7406;&#x5355;&#x51FB;&#x4E8B;&#x4EF6;</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">super</span>.onSingleTapUp(e);</span><br><span class=\"line\">            }</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onLongPress</span><span class=\"params\">(MotionEvent e)</span> </span>{</span><br><span class=\"line\">                <span class=\"comment\">// &#x5904;&#x7406;&#x957F;&#x6309;&#x4E8B;&#x4EF6;</span></span><br><span class=\"line\">                <span class=\"keyword\">super</span>.onLongPress(e);</span><br><span class=\"line\">            }</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onScroll</span><span class=\"params\">(MotionEvent e1, MotionEvent e2, <span class=\"keyword\">float</span> distanceX, <span class=\"keyword\">float</span> distanceY)</span> </span>{</span><br><span class=\"line\">                <span class=\"comment\">// &#x5904;&#x7406;&#x6ED1;&#x52A8;&#x4E8B;&#x4EF6;</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">super</span>.onScroll(e1, e2, distanceX, distanceY);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        });</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onTouchEvent</span><span class=\"params\">(MotionEvent event)</span> </span>{</span><br><span class=\"line\">        <span class=\"comment\">// &#x5C06;&#x4E8B;&#x4EF6;&#x4EA4;&#x7ED9;GestureDetector&#x5904;&#x7406;</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> mGestureDetector.onTouchEvent(event);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x6B65;&#x9AA4;&#x4E94;&#xFF1A;&#x5904;&#x7406;&#x6D4B;&#x91CF;&#x548C;&#x5E03;&#x5C40;\"><a href=\"#&#x6B65;&#x9AA4;&#x4E94;&#xFF1A;&#x5904;&#x7406;&#x6D4B;&#x91CF;&#x548C;&#x5E03;&#x5C40;\" class=\"headerlink\" title=\"&#x6B65;&#x9AA4;&#x4E94;&#xFF1A;&#x5904;&#x7406;&#x6D4B;&#x91CF;&#x548C;&#x5E03;&#x5C40;\"></a>&#x6B65;&#x9AA4;&#x4E94;&#xFF1A;&#x5904;&#x7406;&#x6D4B;&#x91CF;&#x548C;&#x5E03;&#x5C40;</h2><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x7684;&#x81EA;&#x5B9A;&#x4E49;View&#x9700;&#x8981;&#x652F;&#x6301;&#x81EA;&#x9002;&#x5E94;&#x5927;&#x5C0F;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x5904;&#x7406;&#x6D4B;&#x91CF;&#x548C;&#x5E03;&#x5C40;&#x3002;&#x5728;&#x6D4B;&#x91CF;&#x9636;&#x6BB5;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6D4B;&#x91CF;&#x81EA;&#x5B9A;&#x4E49;View&#x7684;&#x5927;&#x5C0F;&#xFF1B;&#x5728;&#x5E03;&#x5C40;&#x9636;&#x6BB5;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6839;&#x636E;&#x6D4B;&#x91CF;&#x7ED3;&#x679C;&#x6765;&#x786E;&#x5B9A;&#x81EA;&#x5B9A;&#x4E49;View&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onMeasure</span><span class=\"params\">(<span class=\"keyword\">int</span> widthMeasureSpec, <span class=\"keyword\">int</span> heightMeasureSpec)</span> </span>{</span><br><span class=\"line\">    <span class=\"comment\">// ... &#x6D4B;&#x91CF;&#x81EA;&#x5B9A;&#x4E49;View&#x7684;&#x5927;&#x5C0F;</span></span><br><span class=\"line\">    <span class=\"keyword\">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onLayout</span><span class=\"params\">(<span class=\"keyword\">boolean</span> changed, <span class=\"keyword\">int</span> left, <span class=\"keyword\">int</span> top, <span class=\"keyword\">int</span> right, <span class=\"keyword\">int</span> bottom)</span> </span>{</span><br><span class=\"line\">    <span class=\"comment\">// ... &#x786E;&#x5B9A;&#x81EA;&#x5B9A;&#x4E49;View&#x7684;&#x4F4D;&#x7F6E;</span></span><br><span class=\"line\">    <span class=\"keyword\">super</span>.onLayout(changed, left, top, right, bottom);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x5904;&#x7406;&#x6D4B;&#x91CF;&#x548C;&#x5E03;&#x5C40;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x6280;&#x5DE7;&#xFF1A;</p>\n<ul>\n<li>&#x4F7F;&#x7528;MeasureSpec&#xFF1A;MeasureSpec&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x6D4B;&#x91CF;&#x81EA;&#x5B9A;&#x4E49;View&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x5B83;&#x5305;&#x542B;&#x4E86;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF1A;spec&#x548C;size&#x3002;spec&#x7528;&#x4E8E;&#x8868;&#x793A;&#x6D4B;&#x91CF;&#x6A21;&#x5F0F;&#xFF0C;size&#x7528;&#x4E8E;&#x8868;&#x793A;&#x6D4B;&#x91CF;&#x5927;&#x5C0F;&#x3002;</li>\n<li>&#x4F7F;&#x7528;LayoutParams&#xFF1A;LayoutParams&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x8BBE;&#x7F6E;&#x81EA;&#x5B9A;&#x4E49;View&#x7684;&#x5E03;&#x5C40;&#x53C2;&#x6570;&#xFF0C;&#x6BD4;&#x5982;&#x5BBD;&#x5EA6;&#x3001;&#x9AD8;&#x5EA6;&#x3001;&#x4F4D;&#x7F6E;&#x7B49;&#x3002;</li>\n<li>&#x4F7F;&#x7528;MeasureSpec&#x548C;LayoutParams&#x7ED3;&#x5408;&#x4F7F;&#x7528;&#xFF1A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;MeasureSpec&#x548C;LayoutParams&#x7ED3;&#x5408;&#x4F7F;&#x7528;&#x6765;&#x5B9E;&#x73B0;&#x81EA;&#x5B9A;&#x4E49;View&#x7684;&#x81EA;&#x9002;&#x5E94;&#x5927;&#x5C0F;&#x548C;&#x4F4D;&#x7F6E;&#x3002;</li>\n</ul>\n<p>&#x4EE5;&#x4E0B;&#x662F;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;MeasureSpec&#x548C;LayoutParams&#x7ED3;&#x5408;&#x4F7F;&#x7528;&#x7684;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyView</span> <span class=\"keyword\">extends</span> <span class=\"title\">View</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Paint mPaint; <span class=\"comment\">// &#x753B;&#x7B14;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyView</span><span class=\"params\">(Context context, AttributeSet attrs)</span> </span>{</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(context, attrs);</span><br><span class=\"line\">        init();</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>{</span><br><span class=\"line\">        mPaint = <span class=\"keyword\">new</span> Paint();</span><br><span class=\"line\">        mPaint.setColor(Color.RED);</span><br><span class=\"line\">        mPaint.setStrokeWidth(<span class=\"number\">5</span>);</span><br><span class=\"line\">        mPaint.setStyle(Paint.Style.STROKE);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onMeasure</span><span class=\"params\">(<span class=\"keyword\">int</span> widthMeasureSpec, <span class=\"keyword\">int</span> heightMeasureSpec)</span> </span>{</span><br><span class=\"line\">        <span class=\"comment\">// &#x6307;&#x5B9A;&#x81EA;&#x5B9A;&#x4E49;View&#x7684;&#x5927;&#x5C0F;&#x4E3A;200dp x 200dp</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> width = MeasureSpec.makeMeasureSpec(dp2px(<span class=\"number\">200</span>), MeasureSpec.EXACTLY);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> height = MeasureSpec.makeMeasureSpec(dp2px(<span class=\"number\">200</span>), MeasureSpec.EXACTLY);</span><br><span class=\"line\">        setMeasuredDimension(width, height);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onLayout</span><span class=\"params\">(<span class=\"keyword\">boolean</span> changed, <span class=\"keyword\">int</span> left, <span class=\"keyword\">int</span> top, <span class=\"keyword\">int</span> right, <span class=\"keyword\">int</span> bottom)</span> </span>{</span><br><span class=\"line\">        <span class=\"comment\">// &#x5728;&#x7236;&#x5BB9;&#x5668;&#x7684;&#x4E2D;&#x592E;&#x653E;&#x7F6E;&#x81EA;&#x5B9A;&#x4E49;View</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> parentWidth = ((ViewGroup) getParent()).getWidth();</span><br><span class=\"line\">        <span class=\"keyword\">int</span> parentHeight = ((ViewGroup) getParent()).getHeight();</span><br><span class=\"line\">        <span class=\"keyword\">int</span> viewWidth = getMeasuredWidth();</span><br><span class=\"line\">        <span class=\"keyword\">int</span> viewHeight = getMeasuredHeight();</span><br><span class=\"line\">        <span class=\"keyword\">int</span> x = (parentWidth - viewWidth) / <span class=\"number\">2</span>;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> y = (parentHeight - viewHeight) / <span class=\"number\">2</span>;</span><br><span class=\"line\">        setLeft(x);</span><br><span class=\"line\">        setTop(y);</span><br><span class=\"line\">        setRight(x + viewWidth);</span><br><span class=\"line\">        setBottom(y + viewHeight);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> <span class=\"title\">dp2px</span><span class=\"params\">(<span class=\"keyword\">int</span> dp)</span> </span>{</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"keyword\">int</span>) (dp * getResources().getDisplayMetrics().density + <span class=\"number\">0.5f</span>);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x7ED3;&#x8BBA;\"><a href=\"#&#x7ED3;&#x8BBA;\" class=\"headerlink\" title=\"&#x7ED3;&#x8BBA;\"></a>&#x7ED3;&#x8BBA;</h2><p>&#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;Android&#x81EA;&#x5B9A;&#x4E49;View&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x5E76;&#x52A0;&#x5165;&#x4E86;&#x4E00;&#x4E9B;&#x5F00;&#x53D1;&#x6280;&#x5DE7;&#xFF0C;&#x5305;&#x62EC;&#x4F7F;&#x7528;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x3001;&#x7F13;&#x5B58;&#x3001;&#x7EBF;&#x7A0B;&#x3001;GestureDetector&#x3001;VelocityTracker&#x3001;Scroller&#x3001;MeasureSpec&#x548C;LayoutParams&#x7B49;&#x3002;&#x5E0C;&#x671B;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x5230;&#x4F60;&#xFF0C;&#x8BA9;&#x4F60;&#x66F4;&#x597D;&#x5730;&#x638C;&#x63E1;&#x81EA;&#x5B9A;&#x4E49;View&#x7684;&#x6280;&#x5DE7;&#x3002; &#x540C;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x6027;&#x80FD;&#x548C;&#x5185;&#x5B58;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4EE5;&#x53CA;&#x4E0E;&#x5176;&#x4ED6;&#x63A7;&#x4EF6;&#x7684;&#x4EA4;&#x4E92;&#x548C;&#x517C;&#x5BB9;&#x6027;&#x3002;</p>\n<h2 id=\"&#x63A8;&#x8350;\"><a href=\"#&#x63A8;&#x8350;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;\"></a>&#x63A8;&#x8350;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["自定义View"]},{"title":"Android必备：ASM字节码操作","url":"https://www.rousetime.com/2023/05/27/Android必备：ASM字节码操作/","content":"<p>&#x5728;Android&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;ASM&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x6982;&#x5FF5;&#x3002;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#xFF08;Runtime&#xFF09;&#x4FEE;&#x6539;&#x5DF2;&#x6709;&#x7C7B;&#x6216;&#x52A8;&#x6001;&#x751F;&#x6210;&#x65B0;&#x7C7B;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4E3A;&#x5F00;&#x53D1;&#x8005;&#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x591A;&#x7684;&#x7075;&#x6D3B;&#x6027;&#x548C;&#x63A7;&#x5236;&#x6743;&#x3002;</p>\n<h2 id=\"&#x4EC0;&#x4E48;&#x662F;ASM&#xFF1F;\"><a href=\"#&#x4EC0;&#x4E48;&#x662F;ASM&#xFF1F;\" class=\"headerlink\" title=\"&#x4EC0;&#x4E48;&#x662F;ASM&#xFF1F;\"></a>&#x4EC0;&#x4E48;&#x662F;ASM&#xFF1F;</h2><p>ASM&#x5168;&#x79F0;&#x4E3A;&#x201C;Java&#x5B57;&#x8282;&#x7801;&#x64CD;&#x4F5C;&#x6846;&#x67B6;&#xFF08;Java Bytecode Manipulation Framework&#xFF09;&#x201D;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x751F;&#x6210;&#x548C;&#x8F6C;&#x6362;Java&#x5B57;&#x8282;&#x7801;&#x7684;&#x6846;&#x67B6;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x8BA9;&#x4F60;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x52A8;&#x6001;&#x5730;&#x751F;&#x6210;&#x3001;&#x4FEE;&#x6539;&#x548C;&#x8F6C;&#x6362;Java&#x5B57;&#x8282;&#x7801;&#xFF0C;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#x8BF8;&#x5982;&#x5728;&#x7C7B;&#x52A0;&#x8F7D;&#x65F6;&#x52A8;&#x6001;&#x4FEE;&#x6539;&#x5B57;&#x8282;&#x7801;&#xFF0C;&#x6216;&#x8005;&#x5728;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x52A8;&#x6001;&#x751F;&#x6210;&#x65B0;&#x7684;&#x7C7B;&#x7B49;&#x7B49;&#x3002;</p>\n<p>ASM&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x5B83;&#x7684;&#x4F53;&#x79EF;&#x4E0D;&#x5230;100KB&#xFF0C;&#x4F46;&#x662F;&#x5374;&#x5177;&#x6709;&#x975E;&#x5E38;&#x5F3A;&#x5927;&#x7684;&#x529F;&#x80FD;&#x3002;&#x5B83;&#x4E0D;&#x4EC5;&#x53EF;&#x4EE5;&#x751F;&#x6210;&#x7C7B;&#x6587;&#x4EF6;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x5DF2;&#x6709;&#x7684;&#x7C7B;&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5199;&#x5165;&#x6587;&#x4EF6;&#x3002;</p>\n<h2 id=\"ASM&#x4E0E;&#x53CD;&#x5C04;&#x7684;&#x533A;&#x522B;\"><a href=\"#ASM&#x4E0E;&#x53CD;&#x5C04;&#x7684;&#x533A;&#x522B;\" class=\"headerlink\" title=\"ASM&#x4E0E;&#x53CD;&#x5C04;&#x7684;&#x533A;&#x522B;\"></a>ASM&#x4E0E;&#x53CD;&#x5C04;&#x7684;&#x533A;&#x522B;</h2><p>&#x5728;Java&#x4E2D;&#xFF0C;&#x53CD;&#x5C04;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x5E38;&#x7528;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x8BA9;&#x6211;&#x4EEC;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x83B7;&#x53D6;&#x7C7B;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x4E14;&#x52A8;&#x6001;&#x5730;&#x8C03;&#x7528;&#x7C7B;&#x7684;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;&#x3002;&#x867D;&#x7136;ASM&#x548C;&#x53CD;&#x5C04;&#x90FD;&#x662F;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x8FD8;&#x662F;&#x6709;&#x5F88;&#x5927;&#x7684;&#x533A;&#x522B;&#x7684;&#x3002;</p>\n<p>&#x9996;&#x5148;&#xFF0C;&#x53CD;&#x5C04;&#x662F;&#x5728;&#x5DF2;&#x6709;&#x7684;&#x7C7B;&#x4E0A;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;ASM&#x53EF;&#x4EE5;&#x52A8;&#x6001;&#x751F;&#x6210;&#x65B0;&#x7684;&#x7C7B;&#x6216;&#x8005;&#x4FEE;&#x6539;&#x5DF2;&#x6709;&#x7684;&#x7C7B;&#x3002;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;ASM&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x53EF;&#x4EE5;&#x6BD4;&#x53CD;&#x5C04;&#x66F4;&#x52A0;&#x7075;&#x6D3B;&#x548C;&#x5F3A;&#x5927;&#x3002;</p>\n<p>&#x5176;&#x6B21;&#xFF0C;ASM&#x64CD;&#x4F5C;&#x7684;&#x662F;&#x5B57;&#x8282;&#x7801;&#xFF0C;&#x800C;&#x53CD;&#x5C04;&#x64CD;&#x4F5C;&#x7684;&#x662F;&#x7C7B;&#x7684;&#x5143;&#x6570;&#x636E;&#x3002;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;ASM&#x53EF;&#x4EE5;&#x505A;&#x5230;&#x4E00;&#x4E9B;&#x53CD;&#x5C04;&#x65E0;&#x6CD5;&#x505A;&#x5230;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x6BD4;&#x5982;&#x4FEE;&#x6539;&#x7C7B;&#x7684;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#x3001;&#x4FEE;&#x6539;&#x7C7B;&#x7684;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x7B49;&#x7B49;&#x3002;</p>\n<h2 id=\"ASM&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;\"><a href=\"#ASM&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;\" class=\"headerlink\" title=\"ASM&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;\"></a>ASM&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;</h2><p>ASM&#x53EF;&#x4EE5;&#x7528;&#x5728;&#x5F88;&#x591A;&#x573A;&#x666F;&#x4E2D;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p>\n<ul>\n<li>&#x4EE3;&#x7801;&#x6CE8;&#x5165;</li>\n<li>AOP&#xFF08;&#x9762;&#x5411;&#x5207;&#x9762;&#x7F16;&#x7A0B;&#xFF09;</li>\n<li>&#x52A8;&#x6001;&#x4EE3;&#x7406;</li>\n<li>&#x5B57;&#x8282;&#x7801;&#x52A0;&#x5BC6;&#x548C;&#x6DF7;&#x6DC6;</li>\n<li>&#x52A8;&#x6001;&#x751F;&#x6210;&#x7C7B;&#x548C;&#x65B9;&#x6CD5;</li>\n</ul>\n<p>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;ASM&#x8FD8;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x505A;&#x6027;&#x80FD;&#x4F18;&#x5316;&#x3002;&#x901A;&#x8FC7;&#x5BF9;&#x5B57;&#x8282;&#x7801;&#x7684;&#x4FEE;&#x6539;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BA9;&#x7A0B;&#x5E8F;&#x5728;&#x6267;&#x884C;&#x65F6;&#x66F4;&#x52A0;&#x9AD8;&#x6548;&#x3002;&#x6BD4;&#x5982;&#x53EF;&#x4EE5;&#x5C06;&#x5FAA;&#x73AF;&#x5C55;&#x5F00;&#x3001;&#x5C06;&#x65B9;&#x6CD5;&#x5185;&#x8054;&#x3001;&#x5C06;&#x5E38;&#x91CF;&#x63D0;&#x53D6;&#x7B49;&#x7B49;&#x3002;</p>\n<h2 id=\"ASM&#x7684;&#x57FA;&#x672C;&#x6982;&#x5FF5;\"><a href=\"#ASM&#x7684;&#x57FA;&#x672C;&#x6982;&#x5FF5;\" class=\"headerlink\" title=\"ASM&#x7684;&#x57FA;&#x672C;&#x6982;&#x5FF5;\"></a>ASM&#x7684;&#x57FA;&#x672C;&#x6982;&#x5FF5;</h2><p>&#x5728;&#x4F7F;&#x7528;ASM&#x65F6;&#xFF0C;&#x6709;&#x4E00;&#x4E9B;&#x57FA;&#x672C;&#x6982;&#x5FF5;&#x9700;&#x8981;&#x4E86;&#x89E3;&#xFF1A;</p>\n<h3 id=\"ClassVisitor\"><a href=\"#ClassVisitor\" class=\"headerlink\" title=\"ClassVisitor\"></a>ClassVisitor</h3><p>ClassVisitor&#x662F;ASM&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x6838;&#x5FC3;&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x7528;&#x4E8E;&#x8BBF;&#x95EE;&#x7C7B;&#x7684;&#x7ED3;&#x6784;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B9E;&#x73B0;ClassVisitor&#x6765;&#x4FEE;&#x6539;&#x7C7B;&#x7684;&#x7ED3;&#x6784;&#x3002;</p>\n<h3 id=\"MethodVisitor\"><a href=\"#MethodVisitor\" class=\"headerlink\" title=\"MethodVisitor\"></a>MethodVisitor</h3><p>MethodVisitor&#x662F;ClassVisitor&#x7684;&#x5B50;&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x7528;&#x4E8E;&#x8BBF;&#x95EE;&#x65B9;&#x6CD5;&#x7684;&#x7ED3;&#x6784;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B9E;&#x73B0;MethodVisitor&#x6765;&#x4FEE;&#x6539;&#x65B9;&#x6CD5;&#x7684;&#x7ED3;&#x6784;&#x3002;</p>\n<h3 id=\"FieldVisitor\"><a href=\"#FieldVisitor\" class=\"headerlink\" title=\"FieldVisitor\"></a>FieldVisitor</h3><p>FieldVisitor&#x662F;ClassVisitor&#x7684;&#x5B50;&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x7528;&#x4E8E;&#x8BBF;&#x95EE;&#x5B57;&#x6BB5;&#x7684;&#x7ED3;&#x6784;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B9E;&#x73B0;FieldVisitor&#x6765;&#x4FEE;&#x6539;&#x5B57;&#x6BB5;&#x7684;&#x7ED3;&#x6784;&#x3002;</p>\n<h3 id=\"Type\"><a href=\"#Type\" class=\"headerlink\" title=\"Type\"></a>Type</h3><p>Type&#x662F;ASM&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x6838;&#x5FC3;&#x7C7B;&#xFF0C;&#x5B83;&#x7528;&#x4E8E;&#x8868;&#x793A;Java&#x4E2D;&#x7684;&#x7C7B;&#x578B;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Type&#x6765;&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x6BD4;&#x5982;&#x7C7B;&#x7684;&#x540D;&#x79F0;&#x3001;&#x7C7B;&#x7684;&#x65B9;&#x6CD5;&#x3001;&#x7C7B;&#x7684;&#x5B57;&#x6BB5;&#x7B49;&#x7B49;&#x3002;</p>\n<h3 id=\"ASMifier\"><a href=\"#ASMifier\" class=\"headerlink\" title=\"ASMifier\"></a>ASMifier</h3><p>ASMifier&#x662F;ASM&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x5DE5;&#x5177;&#x7C7B;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x5C06;&#x4E00;&#x4E2A;&#x5DF2;&#x6709;&#x7684;&#x7C7B;&#x8F6C;&#x6362;&#x6210;ASM&#x7684;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x7C7B;&#x975E;&#x5E38;&#x6709;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x7406;&#x89E3;ASM&#x7684;&#x4F7F;&#x7528;&#x3002;</p>\n<h2 id=\"ASM&#x7684;&#x5B9E;&#x4F8B;\"><a href=\"#ASM&#x7684;&#x5B9E;&#x4F8B;\" class=\"headerlink\" title=\"ASM&#x7684;&#x5B9E;&#x4F8B;\"></a>ASM&#x7684;&#x5B9E;&#x4F8B;</h2><p>&#x8BA9;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x4E00;&#x4E9B;&#x5B9E;&#x4F8B;&#x6765;&#x4E86;&#x89E3;ASM&#x7684;&#x4F7F;&#x7528;&#x3002;</p>\n<h3 id=\"1-&#x4EE3;&#x7801;&#x6CE8;&#x5165;\"><a href=\"#1-&#x4EE3;&#x7801;&#x6CE8;&#x5165;\" class=\"headerlink\" title=\"1. &#x4EE3;&#x7801;&#x6CE8;&#x5165;\"></a>1. &#x4EE3;&#x7801;&#x6CE8;&#x5165;</h3><p>&#x4F7F;&#x7528;ASM&#x8FDB;&#x884C;&#x4EE3;&#x7801;&#x6CE8;&#x5165;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x52A8;&#x6001;&#x5730;&#x5411;&#x5DF2;&#x6709;&#x7684;&#x65B9;&#x6CD5;&#x4E2D;&#x52A0;&#x5165;&#x4E00;&#x4E9B;&#x65B0;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x6BD4;&#x5982;&#x5728;&#x65B9;&#x6CD5;&#x7684;&#x5F00;&#x5934;&#x52A0;&#x5165;&#x4E00;&#x4E9B;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x3001;&#x5728;&#x65B9;&#x6CD5;&#x7684;&#x7ED3;&#x5C3E;&#x52A0;&#x5165;&#x4E00;&#x4E9B;&#x7EDF;&#x8BA1;&#x4EE3;&#x7801;&#x7B49;&#x7B49;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4EE3;&#x7801;&#x6CE8;&#x5165;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClassVisitor</span> <span class=\"keyword\">extends</span> <span class=\"title\">ClassVisitor</span> </span>{</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyClassVisitor</span><span class=\"params\">(ClassWriter classWriter)</span> </span>{</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(Opcodes.ASM5, classWriter);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> MethodVisitor <span class=\"title\">visitMethod</span><span class=\"params\">(<span class=\"keyword\">int</span> access, String name, String descriptor, String signature, String[] exceptions)</span> </span>{</span><br><span class=\"line\">        MethodVisitor mv = <span class=\"keyword\">super</span>.visitMethod(access, name, descriptor, signature, exceptions);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">&quot;test&quot;</span>.equals(name)) {</span><br><span class=\"line\">            mv = <span class=\"keyword\">new</span> MethodVisitor(Opcodes.ASM5, mv) {</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">visitCode</span><span class=\"params\">()</span> </span>{</span><br><span class=\"line\">                    <span class=\"keyword\">super</span>.visitCode();</span><br><span class=\"line\">                     mv.visitFieldInsn(Opcodes.GETSTATIC, <span class=\"string\">&quot;java/lang/System&quot;</span>, <span class=\"string\">&quot;out&quot;</span>, <span class=\"string\">&quot;Ljava/io/PrintStream;&quot;</span>);</span><br><span class=\"line\">                    mv.visitLdcInsn(<span class=\"string\">&quot;Entering method test&quot;</span>);</span><br><span class=\"line\">                     mv.visitMethodInsn(Opcodes.INVOKEVIRTUAL, <span class=\"string\">&quot;java/io/PrintStream&quot;</span>, <span class=\"string\">&quot;println&quot;</span>, <span class=\"string\">&quot;(Ljava/lang/String;)V&quot;</span>, <span class=\"keyword\">false</span>);</span><br><span class=\"line\">                }</span><br><span class=\"line\"> </span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">visitInsn</span><span class=\"params\">(<span class=\"keyword\">int</span> opcode)</span> </span>{</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (opcode == Opcodes.RETURN) {</span><br><span class=\"line\">                         mv.visitFieldInsn(Opcodes.GETSTATIC, <span class=\"string\">&quot;java/lang/System&quot;</span>, <span class=\"string\">&quot;out&quot;</span>, <span class=\"string\">&quot;Ljava/io/PrintStream;&quot;</span>);</span><br><span class=\"line\">                        mv.visitLdcInsn(<span class=\"string\">&quot;Exiting method test&quot;</span>);</span><br><span class=\"line\">                         mv.visitMethodInsn(Opcodes.INVOKEVIRTUAL, <span class=\"string\">&quot;java/io/PrintStream&quot;</span>, <span class=\"string\">&quot;println&quot;</span>, <span class=\"string\">&quot;(Ljava/lang/String;)V&quot;</span>, <span class=\"keyword\">false</span>);</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                    <span class=\"keyword\">super</span>.visitInsn(opcode);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            };</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mv;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;MyClassVisitor&#x7C7B;&#xFF0C;&#x7EE7;&#x627F;&#x4E86;ClassVisitor&#x3002;&#x5728;visitMethod&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x5224;&#x65AD;&#x65B9;&#x6CD5;&#x540D;&#x662F;&#x5426;&#x4E3A;&#x201C;test&#x201D;&#xFF0C;&#x6765;&#x83B7;&#x53D6;&#x65B9;&#x6CD5;&#x7684;MethodVisitor&#x3002;&#x5728;MethodVisitor&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x65B9;&#x6CD5;&#x7684;&#x5F00;&#x5934;&#x52A0;&#x5165;&#x4E86;&#x4E00;&#x6761;&#x8F93;&#x51FA;&#x201C;Entering method test&#x201D;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5728;&#x65B9;&#x6CD5;&#x7684;&#x7ED3;&#x5C3E;&#x52A0;&#x5165;&#x4E86;&#x4E00;&#x6761;&#x8F93;&#x51FA;&#x201C;Exiting method test&#x201D;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x6837;&#x6BCF;&#x6B21;&#x8C03;&#x7528;test&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x90FD;&#x4F1A;&#x8F93;&#x51FA;&#x8FD9;&#x4E24;&#x6761;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;&#x3002;</p>\n<h3 id=\"2-AOP&#xFF08;&#x9762;&#x5411;&#x5207;&#x9762;&#x7F16;&#x7A0B;&#xFF09;\"><a href=\"#2-AOP&#xFF08;&#x9762;&#x5411;&#x5207;&#x9762;&#x7F16;&#x7A0B;&#xFF09;\" class=\"headerlink\" title=\"2. AOP&#xFF08;&#x9762;&#x5411;&#x5207;&#x9762;&#x7F16;&#x7A0B;&#xFF09;\"></a>2. AOP&#xFF08;&#x9762;&#x5411;&#x5207;&#x9762;&#x7F16;&#x7A0B;&#xFF09;</h3><p>AOP&#x662F;&#x4E00;&#x79CD;&#x7F16;&#x7A0B;&#x601D;&#x60F3;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x5C06;&#x4E00;&#x4E9B;&#x6A2A;&#x5207;&#x6027;&#x7684;&#x529F;&#x80FD;&#xFF08;&#x6BD4;&#x5982;&#x65E5;&#x5FD7;&#x3001;&#x6743;&#x9650;&#x3001;&#x4E8B;&#x52A1;&#x7B49;&#xFF09;&#x7EDF;&#x4E00;&#x5730;&#x5E94;&#x7528;&#x5230;&#x591A;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#x3002;&#x4F7F;&#x7528;ASM&#x8FDB;&#x884C;AOP&#x7F16;&#x7A0B;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x52A8;&#x6001;&#x5730;&#x5C06;&#x8FD9;&#x4E9B;&#x6A2A;&#x5207;&#x6027;&#x7684;&#x529F;&#x80FD;&#x52A0;&#x5165;&#x5230;&#x591A;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;AOP&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClassVisitor</span> <span class=\"keyword\">extends</span> <span class=\"title\">ClassVisitor</span> </span>{</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyClassVisitor</span><span class=\"params\">(ClassWriter classWriter)</span> </span>{</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(Opcodes.ASM5, classWriter);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> MethodVisitor <span class=\"title\">visitMethod</span><span class=\"params\">(<span class=\"keyword\">int</span> access, String name, String descriptor, String signature, String[] exceptions)</span> </span>{</span><br><span class=\"line\">        MethodVisitor mv = <span class=\"keyword\">super</span>.visitMethod(access, name, descriptor, signature, exceptions);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">&quot;test&quot;</span>.equals(name)) {</span><br><span class=\"line\">            mv = <span class=\"keyword\">new</span> MethodVisitor(Opcodes.ASM5, mv) {</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">visitCode</span><span class=\"params\">()</span> </span>{</span><br><span class=\"line\">                    mv.visitMethodInsn(Opcodes.INVOKESTATIC, <span class=\"string\">&quot;com/example/LogInterceptor&quot;</span>, <span class=\"string\">&quot;before&quot;</span>, <span class=\"string\">&quot;()V&quot;</span>, <span class=\"keyword\">false</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">super</span>.visitCode();</span><br><span class=\"line\">                }</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">visitInsn</span><span class=\"params\">(<span class=\"keyword\">int</span> opcode)</span> </span>{</span><br><span class=\"line\">                    <span class=\"keyword\">super</span>.visitInsn(opcode);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (opcode == Opcodes.RETURN) {</span><br><span class=\"line\">                        mv.visitMethodInsn(Opcodes.INVOKESTATIC, <span class=\"string\">&quot;com/example/LogInterceptor&quot;</span>, <span class=\"string\">&quot;after&quot;</span>, <span class=\"string\">&quot;()V&quot;</span>, <span class=\"keyword\">false</span>);</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }</span><br><span class=\"line\">            };</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mv;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;MyClassVisitor&#x7C7B;&#xFF0C;&#x7EE7;&#x627F;&#x4E86;ClassVisitor&#x3002;&#x5728;visitMethod&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x5224;&#x65AD;&#x65B9;&#x6CD5;&#x540D;&#x662F;&#x5426;&#x4E3A;&#x201C;test&#x201D;&#xFF0C;&#x6765;&#x83B7;&#x53D6;&#x65B9;&#x6CD5;&#x7684;MethodVisitor&#x3002;&#x5728;MethodVisitor&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x65B9;&#x6CD5;&#x7684;&#x5F00;&#x5934;&#x52A0;&#x5165;&#x4E86;&#x4E00;&#x6761;&#x8C03;&#x7528;&#x201C;com/example/LogInterceptor&#x201D;&#x7684;before&#x65B9;&#x6CD5;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5728;&#x65B9;&#x6CD5;&#x7684;&#x7ED3;&#x5C3E;&#x52A0;&#x5165;&#x4E86;&#x4E00;&#x6761;&#x8C03;&#x7528;&#x201C;com/example/LogInterceptor&#x201D;&#x7684;after&#x65B9;&#x6CD5;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x6837;&#x6BCF;&#x6B21;&#x8C03;&#x7528;test&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x90FD;&#x4F1A;&#x5148;&#x8C03;&#x7528;before&#x65B9;&#x6CD5;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;test&#x65B9;&#x6CD5;&#xFF0C;&#x6700;&#x540E;&#x8C03;&#x7528;after&#x65B9;&#x6CD5;&#x3002;</p>\n<h3 id=\"3-&#x52A8;&#x6001;&#x4EE3;&#x7406;\"><a href=\"#3-&#x52A8;&#x6001;&#x4EE3;&#x7406;\" class=\"headerlink\" title=\"3. &#x52A8;&#x6001;&#x4EE3;&#x7406;\"></a>3. &#x52A8;&#x6001;&#x4EE3;&#x7406;</h3><p>&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x662F;&#x4E00;&#x79CD;&#x5E38;&#x7528;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x8BA9;&#x6211;&#x4EEC;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x52A8;&#x6001;&#x5730;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x3002;&#x4F7F;&#x7528;ASM&#x8FDB;&#x884C;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x52A8;&#x6001;&#x5730;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;&#x4E86;&#x6307;&#x5B9A;&#x63A5;&#x53E3;&#x7684;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClassVisitor</span> <span class=\"keyword\">extends</span> <span class=\"title\">ClassVisitor</span> </span>{</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String className;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String interfaceName;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyClassVisitor</span><span class=\"params\">(ClassWriter classWriter, String className, String interfaceName)</span> </span>{</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(Opcodes.ASM5, classWriter);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.className = className;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.interfaceName = interfaceName;</span><br><span class=\"line\">    }</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">visit</span><span class=\"params\">(<span class=\"keyword\">int</span> version, <span class=\"keyword\">int</span> access, String name, String signature, String superName, String[] interfaces)</span> </span>{</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.visit(version, access, className, signature, <span class=\"string\">&quot;java/lang/Object&quot;</span>, <span class=\"keyword\">new</span> String[]{interfaceName});</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> MethodVisitor <span class=\"title\">visitMethod</span><span class=\"params\">(<span class=\"keyword\">int</span> access, String name, String descriptor, String signature, String[] exceptions)</span> </span>{</span><br><span class=\"line\">        MethodVisitor mv = <span class=\"keyword\">super</span>.visitMethod(access, name, descriptor, signature, exceptions);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">&quot;invoke&quot;</span>.equals(name)) {</span><br><span class=\"line\">            mv = <span class=\"keyword\">new</span> MethodVisitor(Opcodes.ASM5, mv) {</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">visitCode</span><span class=\"params\">()</span> </span>{</span><br><span class=\"line\">                    <span class=\"keyword\">super</span>.visitCode();</span><br><span class=\"line\">                    mv.visitVarInsn(Opcodes.ALOAD, <span class=\"number\">0</span>);</span><br><span class=\"line\">                    mv.visitFieldInsn(Opcodes.GETFIELD, className, <span class=\"string\">&quot;handler&quot;</span>, <span class=\"string\">&quot;Ljava/lang/Object;&quot;</span>);</span><br><span class=\"line\">                    mv.visitTypeInsn(Opcodes.CHECKCAST, interfaceName);</span><br><span class=\"line\">                    mv.visitVarInsn(Opcodes.ALOAD, <span class=\"number\">1</span>);</span><br><span class=\"line\">                    mv.visitVarInsn(Opcodes.ALOAD, <span class=\"number\">2</span>);</span><br><span class=\"line\">                     mv.visitMethodInsn(Opcodes.INVOKEINTERFACE, interfaceName, <span class=\"string\">&quot;invoke&quot;</span>, <span class=\"string\">&quot;(Ljava/lang/Object;Ljava/lang/reflect/Method;[Ljava/lang/Object;)Ljava/lang/Object;&quot;</span>, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">                    mv.visitInsn(Opcodes.ARETURN);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            };</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mv;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;MyClassVisitor&#x7C7B;&#xFF0C;&#x7EE7;&#x627F;&#x4E86;ClassVisitor&#x3002;&#x5728;visit&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x7C7B;&#x7684;&#x540D;&#x79F0;&#x4FEE;&#x6539;&#x4E3A;&#x6307;&#x5B9A;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x5C06;&#x7C7B;&#x5B9E;&#x73B0;&#x7684;&#x63A5;&#x53E3;&#x4FEE;&#x6539;&#x4E3A;&#x6307;&#x5B9A;&#x7684;&#x63A5;&#x53E3;&#x3002;&#x5728;visitMethod&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x5224;&#x65AD;&#x65B9;&#x6CD5;&#x540D;&#x662F;&#x5426;&#x4E3A;&#x201C;invoke&#x201D;&#xFF0C;&#x6765;&#x83B7;&#x53D6;&#x65B9;&#x6CD5;&#x7684;MethodVisitor</p>\n<h3 id=\"&#x4F7F;&#x7528;ASM&#x8FDB;&#x884C;&#x5B57;&#x8282;&#x7801;&#x52A0;&#x5BC6;&#x548C;&#x6DF7;&#x6DC6;\"><a href=\"#&#x4F7F;&#x7528;ASM&#x8FDB;&#x884C;&#x5B57;&#x8282;&#x7801;&#x52A0;&#x5BC6;&#x548C;&#x6DF7;&#x6DC6;\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;ASM&#x8FDB;&#x884C;&#x5B57;&#x8282;&#x7801;&#x52A0;&#x5BC6;&#x548C;&#x6DF7;&#x6DC6;\"></a>&#x4F7F;&#x7528;ASM&#x8FDB;&#x884C;&#x5B57;&#x8282;&#x7801;&#x52A0;&#x5BC6;&#x548C;&#x6DF7;&#x6DC6;</h3><p>&#x4F7F;&#x7528;ASM&#x53EF;&#x4EE5;&#x5BF9;&#x5B57;&#x8282;&#x7801;&#x8FDB;&#x884C;&#x52A0;&#x5BC6;&#x548C;&#x6DF7;&#x6DC6;&#xFF0C;&#x589E;&#x5F3A;&#x4EE3;&#x7801;&#x7684;&#x5B89;&#x5168;&#x6027;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4FEE;&#x6539;&#x5E38;&#x91CF;&#x6C60;&#x3001;&#x4FEE;&#x6539;&#x65B9;&#x6CD5;&#x540D;&#x548C;&#x5B57;&#x6BB5;&#x540D;&#x7B49;&#x65B9;&#x5F0F;&#x6765;&#x8FBE;&#x5230;&#x52A0;&#x5BC6;&#x548C;&#x6DF7;&#x6DC6;&#x7684;&#x6548;&#x679C;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5B57;&#x8282;&#x7801;&#x52A0;&#x5BC6;&#x548C;&#x6DF7;&#x6DC6;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClassVisitor</span> <span class=\"keyword\">extends</span> <span class=\"title\">ClassVisitor</span> </span>{</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String key;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyClassVisitor</span><span class=\"params\">(ClassWriter classWriter, String key)</span> </span>{</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(Opcodes.ASM5, classWriter);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.key = key;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> FieldVisitor <span class=\"title\">visitField</span><span class=\"params\">(<span class=\"keyword\">int</span> access, String name, String descriptor, String signature, Object value)</span> </span>{</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((access &amp; (Opcodes.ACC_PUBLIC | Opcodes.ACC_PROTECTED)) != <span class=\"number\">0</span>) {</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">super</span>.visitField(access, name, descriptor, signature, value);</span><br><span class=\"line\">        } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">            FieldVisitor fv = <span class=\"keyword\">super</span>.visitField(access, name + <span class=\"string\">&quot;_&quot;</span> + key, descriptor, signature, value);</span><br><span class=\"line\">            fv.visitAnnotation(<span class=\"string\">&quot;Lcom/example/Encrypted;&quot;</span>, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> fv;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> MethodVisitor <span class=\"title\">visitMethod</span><span class=\"params\">(<span class=\"keyword\">int</span> access, String name, String descriptor, String signature, String[] exceptions)</span> </span>{</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((access &amp; (Opcodes.ACC_PUBLIC | Opcodes.ACC_PROTECTED)) != <span class=\"number\">0</span>) {</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">super</span>.visitMethod(access, name, descriptor, signature, exceptions);</span><br><span class=\"line\">        } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">            MethodVisitor mv = <span class=\"keyword\">super</span>.visitMethod(access, name + <span class=\"string\">&quot;_&quot;</span> + key, descriptor, signature, exceptions);</span><br><span class=\"line\">            mv.visitAnnotation(<span class=\"string\">&quot;Lcom/example/Obfuscated;&quot;</span>, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> mv;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">visitEnd</span><span class=\"params\">()</span> </span>{</span><br><span class=\"line\">        AnnotationVisitor av = <span class=\"keyword\">super</span>.visitAnnotation(<span class=\"string\">&quot;Lcom/example/EncryptedClass;&quot;</span>, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">        av.visit(<span class=\"string\">&quot;key&quot;</span>, key);</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.visitEnd();</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;MyClassVisitor&#x7C7B;&#xFF0C;&#x7EE7;&#x627F;&#x4E86;ClassVisitor&#x3002;&#x5728;visitField&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5224;&#x65AD;&#x5B57;&#x6BB5;&#x662F;&#x5426;&#x4E3A;&#x516C;&#x6709;&#x6216;&#x8005;&#x53D7;&#x4FDD;&#x62A4;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x662F;&#xFF0C;&#x5219;&#x4E0D;&#x505A;&#x5904;&#x7406;&#xFF1B;&#x5982;&#x679C;&#x4E0D;&#x662F;&#xFF0C;&#x5219;&#x5C06;&#x5B57;&#x6BB5;&#x540D;&#x52A0;&#x4E0A;&#x6307;&#x5B9A;&#x7684;key&#xFF0C;&#x5E76;&#x4E14;&#x52A0;&#x4E0A;&#x6CE8;&#x89E3;&#x201C;@Encrypted&#x201D;&#x3002;&#x5728;visitMethod&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x540C;&#x6837;&#x5730;&#x5224;&#x65AD;&#x65B9;&#x6CD5;&#x662F;&#x5426;&#x4E3A;&#x516C;&#x6709;&#x6216;&#x8005;&#x53D7;&#x4FDD;&#x62A4;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x662F;&#xFF0C;&#x5219;&#x4E0D;&#x505A;&#x5904;&#x7406;&#xFF1B;&#x5982;&#x679C;&#x4E0D;&#x662F;&#xFF0C;&#x5219;&#x5C06;&#x65B9;&#x6CD5;&#x540D;&#x52A0;&#x4E0A;&#x6307;&#x5B9A;&#x7684;key&#xFF0C;&#x5E76;&#x4E14;&#x52A0;&#x4E0A;&#x6CE8;&#x89E3;&#x201C;@Obfuscated&#x201D;&#x3002;&#x5728;visitEnd&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x52A0;&#x4E0A;&#x6CE8;&#x89E3;&#x201C;@EncryptedClass&#x201D;&#xFF0C;&#x5E76;&#x4E14;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x201C;key&#x201D;&#xFF0C;&#x4EE3;&#x8868;&#x52A0;&#x5BC6;&#x7684;key&#x3002;</p>\n<h3 id=\"&#x4F7F;&#x7528;ASM&#x52A8;&#x6001;&#x751F;&#x6210;&#x7C7B;&#x548C;&#x65B9;&#x6CD5;\"><a href=\"#&#x4F7F;&#x7528;ASM&#x52A8;&#x6001;&#x751F;&#x6210;&#x7C7B;&#x548C;&#x65B9;&#x6CD5;\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;ASM&#x52A8;&#x6001;&#x751F;&#x6210;&#x7C7B;&#x548C;&#x65B9;&#x6CD5;\"></a>&#x4F7F;&#x7528;ASM&#x52A8;&#x6001;&#x751F;&#x6210;&#x7C7B;&#x548C;&#x65B9;&#x6CD5;</h3><p>&#x4F7F;&#x7528;ASM&#x53EF;&#x4EE5;&#x52A8;&#x6001;&#x751F;&#x6210;&#x7C7B;&#x548C;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x662F;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x3001;AOP&#x7B49;&#x529F;&#x80FD;&#x7684;&#x57FA;&#x7840;&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;ASM&#x751F;&#x6210;&#x7684;&#x7C7B;&#xFF0C;&#x7EE7;&#x627F;&#x5DF2;&#x6709;&#x7684;&#x7C7B;&#x6216;&#x8005;&#x5B9E;&#x73B0;&#x6307;&#x5B9A;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x5177;&#x5907;&#x4E0E;&#x539F;&#x7C7B;&#x76F8;&#x4F3C;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x52A8;&#x6001;&#x751F;&#x6210;&#x7C7B;&#x548C;&#x65B9;&#x6CD5;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClassWriter</span> <span class=\"keyword\">extends</span> <span class=\"title\">ClassWriter</span> </span>{</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyClassWriter</span><span class=\"params\">()</span> </span>{</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(ClassWriter.COMPUTE_MAXS);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">generateClass</span><span class=\"params\">()</span> </span>{</span><br><span class=\"line\">        visit(Opcodes.V1_8, Opcodes.ACC_PUBLIC, <span class=\"string\">&quot;com/example/DynamicClass&quot;</span>, <span class=\"keyword\">null</span>, <span class=\"string\">&quot;java/lang/Object&quot;</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"comment\">// &#x6DFB;&#x52A0;&#x5B57;&#x6BB5;</span></span><br><span class=\"line\">        visitField(Opcodes.ACC_PRIVATE, <span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;Ljava/lang/String;&quot;</span>, <span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>).visitEnd();</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"comment\">// &#x6DFB;&#x52A0;&#x6784;&#x9020;&#x65B9;&#x6CD5;</span></span><br><span class=\"line\">        MethodVisitor constructorVisitor = visitMethod(Opcodes.ACC_PUBLIC, <span class=\"string\">&quot;&lt;init&gt;&quot;</span>, <span class=\"string\">&quot;()V&quot;</span>, <span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">        constructorVisitor.visitCode();</span><br><span class=\"line\">        constructorVisitor.visitVarInsn(Opcodes.ALOAD, <span class=\"number\">0</span>);</span><br><span class=\"line\">         constructorVisitor.visitMethodInsn(Opcodes.INVOKESPECIAL, <span class=\"string\">&quot;java/lang/Object&quot;</span>, <span class=\"string\">&quot;&lt;init&gt;&quot;</span>, <span class=\"string\">&quot;()V&quot;</span>, <span class=\"keyword\">false</span>);</span><br><span class=\"line\">        constructorVisitor.visitInsn(Opcodes.RETURN);</span><br><span class=\"line\">        constructorVisitor.visitMaxs(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        constructorVisitor.visitEnd();</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"comment\">// &#x6DFB;&#x52A0;setName&#x65B9;&#x6CD5;</span></span><br><span class=\"line\">        MethodVisitor setNameVisitor = visitMethod(Opcodes.ACC_PUBLIC, <span class=\"string\">&quot;setName&quot;</span>, <span class=\"string\">&quot;(Ljava/lang/String;)V&quot;</span>, <span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">        setNameVisitor.visitCode();</span><br><span class=\"line\">        setNameVisitor.visitVarInsn(Opcodes.ALOAD, <span class=\"number\">0</span>);</span><br><span class=\"line\">        setNameVisitor.visitVarInsn(Opcodes.ALOAD, <span class=\"number\">1</span>);</span><br><span class=\"line\">        setNameVisitor.visitFieldInsn(Opcodes.PUTFIELD, <span class=\"string\">&quot;com/example/DynamicClass&quot;</span>, <span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;Ljava/lang/String;&quot;</span>);</span><br><span class=\"line\">        setNameVisitor.visitInsn(Opcodes.RETURN);</span><br><span class=\"line\">        setNameVisitor.visitMaxs(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        setNameVisitor.visitEnd();</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"comment\">// &#x6DFB;&#x52A0;getName&#x65B9;&#x6CD5;</span></span><br><span class=\"line\">        MethodVisitor getNameVisitor = visitMethod(Opcodes.ACC_PUBLIC, <span class=\"string\">&quot;getName&quot;</span>, <span class=\"string\">&quot;()Ljava/lang/String;&quot;</span>, <span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">        getNameVisitor.visitCode();</span><br><span class=\"line\">        getNameVisitor.visitVarInsn(Opcodes.ALOAD, <span class=\"number\">0</span>);</span><br><span class=\"line\">        getNameVisitor.visitFieldInsn(Opcodes.GETFIELD, <span class=\"string\">&quot;com/example/DynamicClass&quot;</span>, <span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;Ljava/lang/String;&quot;</span>);</span><br><span class=\"line\">        getNameVisitor.visitInsn(Opcodes.ARETURN);</span><br><span class=\"line\">        getNameVisitor.visitMaxs(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        getNameVisitor.visitEnd();</span><br><span class=\"line\"> </span><br><span class=\"line\">        visitEnd();</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;MyClassWriter&#x7C7B;&#xFF0C;&#x7EE7;&#x627F;&#x4E86;ClassWriter&#x3002;&#x5728;generateClass&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;visit&#x65B9;&#x6CD5;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;&#x201C;com/example/DynamicClass&#x201D;&#x7684;&#x7C7B;&#xFF0C;&#x7EE7;&#x627F;&#x81EA;Object&#x7C7B;&#x3002;&#x63A5;&#x7740;&#xFF0C;&#x6211;&#x4EEC;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x79C1;&#x6709;&#x5B57;&#x6BB5;&#x201C;name&#x201D;&#xFF0C;&#x4E00;&#x4E2A;&#x516C;&#x6709;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x548C;&#x4E24;&#x4E2A;&#x516C;&#x6709;&#x7684;&#x65B9;&#x6CD5;&#x201C;setName&#x201D;&#x548C;&#x201C;getName&#x201D;&#x3002;&#x5728;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;visitFieldInsn&#x7B49;&#x65B9;&#x6CD5;&#xFF0C;&#x8BBF;&#x95EE;&#x4E86;&#x5B57;&#x6BB5;&#x201C;name&#x201D;&#x7684;&#x503C;&#xFF0C;&#x5E76;&#x4E14;&#x8FD4;&#x56DE;&#x4E86;&#x5B83;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x901A;&#x8FC7;ASM&#x52A8;&#x6001;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x7C7B;&#x548C;&#x5176;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<h2 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h2><p>&#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;ASM&#x7684;&#x57FA;&#x672C;&#x6982;&#x5FF5;&#x3001;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x4EE5;&#x53CA;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5B9E;&#x4F8B;&#x3002;&#x867D;&#x7136;ASM&#x7684;&#x4F7F;&#x7528;&#x9700;&#x8981;&#x4E00;&#x5B9A;&#x7684;&#x5B66;&#x4E60;&#x6210;&#x672C;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x53EF;&#x4EE5;&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x66F4;&#x52A0;&#x7075;&#x6D3B;&#x548C;&#x5F3A;&#x5927;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x89E3;&#x51B3;&#x4E00;&#x4E9B;&#x96BE;&#x9898;&#x3002;&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x8FC7;ASM&#xFF0C;&#x6211;&#x5EFA;&#x8BAE;&#x4F60;&#x53BB;&#x5C1D;&#x8BD5;&#x4E00;&#x4E0B;&#xFF0C;&#x76F8;&#x4FE1;&#x4F60;&#x4F1A;&#x6709;&#x65B0;&#x7684;&#x53D1;&#x73B0;</p>\n<h2 id=\"&#x63A8;&#x8350;\"><a href=\"#&#x63A8;&#x8350;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;\"></a>&#x63A8;&#x8350;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["ASM"]},{"title":"MotionLayout进阶动画必修课","url":"https://www.rousetime.com/2022/12/16/MotionLayout进阶动画必修课/","content":"<p>MotionLayout&#x80FD;&#x591F;&#x66F4;&#x597D;&#x7684;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x901A;&#x8FC7;xml&#x5B9E;&#x73B0;&#x52A8;&#x753B;&#xFF0C;&#x9664;&#x4E86;&#x5165;&#x95E8;&#x7EA7;&#x7684;ConstraintSet&#x3001;CustomAttribute&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x7531;&#x4E00;&#x4E2A;start&#xFF0C;&#x5230;&#x4E00;&#x4E2A;end&#x7684;&#x8FC7;&#x6E21;&#x52A8;&#x753B;&#x3002;&#x867D;&#x7136;&#x5B83;&#x4EEC;&#x80FD;&#x5B9E;&#x73B0;&#x6211;&#x4EEC;&#x65E5;&#x5E38;&#x4E2D;90%&#x7684;&#x52A8;&#x753B;&#x6548;&#x679C;&#xFF0C;&#x4F46;&#x590D;&#x6742;&#x7075;&#x6D3B;&#x7684;&#x52A8;&#x753B;&#xFF0C;&#x8FD8;&#x662F;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x66F4;&#x9AD8;&#x7EA7;&#x7684;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x5B9E;&#x73B0;&#x3002;</p>\n<p>&#x4ECA;&#x5929;&#x5C31;&#x6765;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;MotionLayout&#x7684;&#x8FDB;&#x9636;&#x73A9;&#x6CD5;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x672C;&#x6B21;&#x7684;&#x76EE;&#x6807;&#x662F;&#x641E;&#x660E;&#x767D;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x7684;&#x7528;&#x6CD5;&#x4E0E;&#x4F5C;&#x7528;&#xFF1A;</p>\n<ol>\n<li>KeyFrameSet</li>\n<li>KeyPositon</li>\n<li>keyPositonType</li>\n<li>pathMotionArc</li>\n<li>transitionEasing</li>\n<li>KeyAttribute</li>\n</ol>\n<h2 id=\"KeyFrameSet\"><a href=\"#KeyFrameSet\" class=\"headerlink\" title=\"KeyFrameSet\"></a>KeyFrameSet</h2><p>&#x4ECA;&#x5929;&#x7684;&#x4E3B;&#x89D2;&#x90FD;&#x5728;KeyFrameSet&#x91CC;&#x9762;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x81EA;&#x7531;&#x64CD;&#x4F5C;&#x52A8;&#x753B;&#x6BCF;&#x4E00;&#x5E27;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5230;KeyFrameSet&#x6807;&#x7B7E;&#x3002;</p>\n<p>&#x5B83;&#x4E0E;&#x4E4B;&#x524D;&#x7684;ConstraintSet&#x7C7B;&#x4F3C;&#xFF0C;&#x5185;&#x90E8;&#x63D0;&#x4F9B;&#x4E86;&#x57FA;&#x4E8E;&#x5E27;&#x7684;&#x52A8;&#x753B;&#x64CD;&#x4F5C;&#x6807;&#x7B7E;&#xFF0C;&#x65B9;&#x4FBF;&#x5F00;&#x53D1;&#x8005;&#x8FDB;&#x884C;&#x52A8;&#x753B;&#x9AD8;&#x5EA6;&#x81EA;&#x5B9A;&#x4E49;&#x3002;</p>\n<p>&#x4E0E;ConstraintSet&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;KeyFrameSet&#x5FC5;&#x987B;&#x5B9A;&#x4E49;&#x5728;TranSiton&#x4E2D;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Transition</span><br><span class=\"line\">    app:constraintSetStart=&quot;@+id/start&quot;</span><br><span class=\"line\">    app:duration=&quot;3000&quot;</span><br><span class=\"line\">    app:pathMotionArc=&quot;none&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;KeyFrameSet&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;/KeyFrameSet&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;OnSwipe</span><br><span class=\"line\">        app:dragDirection=&quot;dragDown&quot;</span><br><span class=\"line\">        app:touchAnchorId=&quot;@id/tv&quot;</span><br><span class=\"line\">        app:touchAnchorSide=&quot;bottom&quot; /&gt;</span><br><span class=\"line\">&lt;/Transition&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x5C31;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;KeyFrameSet&#x6807;&#x7B7E;&#x3002;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x6765;&#x4F7F;&#x7528;&#x5B83;&#x7684;&#x5E27;&#x6807;&#x7B7E;&#x6765;&#x505A;&#x4E2A;&#x7B80;&#x5355;&#x793A;&#x8303;&#x3002;</p>\n<h2 id=\"KeyPosition\"><a href=\"#KeyPosition\" class=\"headerlink\" title=\"KeyPosition\"></a>KeyPosition</h2><p>KeyPosition&#x662F;&#x63D0;&#x4F9B;&#x4EE5;&#x6BCF;&#x5E27;&#x7684;&#x4F4D;&#x7F6E;&#x505A;&#x5177;&#x4F53;&#x52A8;&#x753B;&#x7684;&#x80FD;&#x529B;&#x3002;&#x5B83;&#x4E3B;&#x8981;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x5C5E;&#x6027;&#xFF1A;</p>\n<ol>\n<li>motionTarget&#xFF1A;&#x4F5C;&#x7528;&#x7684;view&#x5BF9;&#x5E94;&#x7684;id</li>\n<li>framePostion&#xFF1A;&#x5177;&#x4F53;&#x5E27;&#x4F4D;&#x7F6E;&#xFF0C;&#x5F00;&#x59CB;&#x5230;&#x7ED3;&#x675F;&#xFF0C;&#x503C;&#x8303;&#x56F4;&#x4E3A;0~100&#x3002;</li>\n<li>percentX/Y&#xFF1A;&#x57FA;&#x4E8E;&#x5F53;&#x524D;&#x5750;&#x6807;&#x7CFB;&#x7684;&#x6BD4;&#x4F8B;&#xFF0C;&#x503C;&#x4E3A; -1 ~ 1</li>\n<li>keyPositionType&#xFF1A;&#x5F53;&#x524D;&#x4EE5;&#x4F7F;&#x7528;&#x7684;&#x5750;&#x6807;&#x7CFB;&#xFF0C;&#x76EE;&#x524D;&#x652F;&#x6301;&#x7684;&#x6709;&#xFF0C;parentRelative&#x3001;deltaRelative&#x3001;pathRelative&#x3002;</li>\n</ol>\n<p>&#x5728;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x4F7F;&#x7528;ConstraintSet&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x6709;&#x5DE6;&#x4E0A;&#x89D2;&#x5230;&#x53F3;&#x4E0B;&#x89D2;&#x7684;&#x7B80;&#x5355;&#x52A8;&#x753B;&#x3002;</p>\n<p><img src=\"/2022/12/16/MotionLayout&#x8FDB;&#x9636;&#x52A8;&#x753B;&#x5FC5;&#x4FEE;&#x8BFE;/1.gif\" alt></p>\n<p>&#x7531;&#x4E8E;ConstraintSet&#x7684;&#x6027;&#x8D28;&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x6CA1;&#x6709;&#x5B9A;&#x4E49;&#x5B83;&#x4E2D;&#x95F4;&#x7684;&#x8FD0;&#x52A8;&#x8F68;&#x8FF9;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x7684;&#x8F68;&#x8FF9;&#x662F;&#x5E73;&#x6ED1;&#x7684;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6765;&#x4F7F;&#x7528;KeyPositon&#x6765;&#x7B80;&#x5355;&#x6539;&#x53D8;&#x5B83;&#x7684;&#x8FD0;&#x884C;&#x8F68;&#x8FF9;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Transition</span><br><span class=\"line\">    app:constraintSetStart=&quot;@+id/start&quot;</span><br><span class=\"line\">    app:duration=&quot;3000&quot;</span><br><span class=\"line\">    app:pathMotionArc=&quot;none&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;KeyFrameSet&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;KeyPosition</span><br><span class=\"line\">            app:framePosition=&quot;10&quot;</span><br><span class=\"line\">            app:keyPositionType=&quot;parentRelative&quot;</span><br><span class=\"line\">            app:motionTarget=&quot;@id/tv&quot;</span><br><span class=\"line\">            app:percentX=&quot;0.2&quot;</span><br><span class=\"line\">            app:percentY=&quot;0.35&quot; /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;KeyPosition</span><br><span class=\"line\">            app:framePosition=&quot;80&quot;</span><br><span class=\"line\">            app:keyPositionType=&quot;parentRelative&quot;</span><br><span class=\"line\">            app:motionTarget=&quot;@id/tv&quot;</span><br><span class=\"line\">            app:percentX=&quot;0.6&quot;</span><br><span class=\"line\">            app:percentY=&quot;0.8&quot; /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;/KeyFrameSet&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;OnSwipe</span><br><span class=\"line\">        app:dragDirection=&quot;dragDown&quot;</span><br><span class=\"line\">        app:touchAnchorId=&quot;@id/tv&quot;</span><br><span class=\"line\">        app:touchAnchorSide=&quot;bottom&quot; /&gt;</span><br><span class=\"line\">&lt;/Transition&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E86;&#x4E09;&#x4E2A;KeyPosition&#xFF0C;&#x5206;&#x522B;&#x5728;&#x5B83;&#x8FD0;&#x52A8;&#x7684;10&#x3001;80&#x4F4D;&#x7F6E;&#x8FDB;&#x884C;&#x6539;&#x53D8;&#x5B83;&#x7684;&#x8F68;&#x8FF9;&#x3002;&#x8F68;&#x8FF9;&#x5177;&#x4F53;&#x7684;&#x6539;&#x53D8;&#x901A;&#x8FC7;percentX/Y&#x6765;&#x8FDB;&#x884C;&#x3002;</p>\n<p><img src=\"/2022/12/16/MotionLayout&#x8FDB;&#x9636;&#x52A8;&#x753B;&#x5FC5;&#x4FEE;&#x8BFE;/2.gif\" alt></p>\n<p>&#x8F68;&#x8FF9;&#x4E0A;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x4E24;&#x4E2A;&#x62D0;&#x70B9;&#xFF0C;&#x901A;&#x8FC7;KeyPosition&#x6211;&#x4EEC;&#x6210;&#x529F;&#x5B9A;&#x4E49;&#x4E86;&#x52A8;&#x753B;&#x8FD0;&#x884C;&#x6548;&#x679C;&#x3002;</p>\n<h2 id=\"keyPositionType\"><a href=\"#keyPositionType\" class=\"headerlink\" title=\"keyPositionType\"></a>keyPositionType</h2><p>&#x6CE8;&#x610F;&#x770B;keyPositionType&#x5C5E;&#x6027;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x662F;parentRelative&#xFF0C;&#x53E6;&#x5916;&#x8FD8;&#x6709;deltaRelative&#x3001;pathRelative&#x3002;</p>\n<p>&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x5B9A;&#x4E49;&#x5750;&#x6807;&#x7CFB;&#xFF0C;&#x6211;&#x4EEC;&#x9ED8;&#x8BA4;&#x7684;&#x5750;&#x6807;&#x7CFB;&#x5C31;&#x662F;parentRelative&#x3002;</p>\n<h3 id=\"parentRelative\"><a href=\"#parentRelative\" class=\"headerlink\" title=\"parentRelative\"></a>parentRelative</h3><p>&#x5B83;&#x7684;&#x5750;&#x6807;&#x7CFB;&#x662F;&#x76F8;&#x5BF9;&#x4E8E;&#x7236;&#x5BB9;&#x5668;&#x7684;&#x3002;</p>\n<p><img src=\"/2022/12/16/MotionLayout&#x8FDB;&#x9636;&#x52A8;&#x753B;&#x5FC5;&#x4FEE;&#x8BFE;/3.png\" alt></p>\n<p>&#x8FD9;&#x79CD;&#x662F;&#x6211;&#x4EEC;&#x6BD4;&#x8F83;&#x5E38;&#x6709;&#x7684;&#x5750;&#x6807;&#x7CFB;&#xFF0C;&#x505A;&#x52A8;&#x753B;&#x65F6;&#xFF0C;&#x4EE5;&#x7236;&#x5BB9;&#x5668;&#x4E3A;&#x57FA;&#x51C6;&#xFF0C;&#x66F4;&#x7B26;&#x5408;&#x5E38;&#x89C4;&#x7684;&#x52A8;&#x753B;&#x64CD;&#x4F5C;&#x3002;</p>\n<blockquote>\n<p>&#x66F4;&#x5F62;&#x8C61;&#x7684;&#x5176;&#x5B9E;&#x662F;&#x4EE5;&#x5DE6;&#x4E0A;&#x89D2;&#x4E3A;&#x539F;&#x70B9;&#xFF0C;&#x4E5F;&#x662F;&#x6211;&#x4EEC;view&#x7684;&#x5750;&#x6807;&#x7CFB;&#x3002;</p>\n</blockquote>\n<h3 id=\"deltaRelative\"><a href=\"#deltaRelative\" class=\"headerlink\" title=\"deltaRelative\"></a>deltaRelative</h3><p>&#x8FD9;&#x4E2A;&#x5750;&#x6807;&#x7CFB;&#x662F;&#x4EE5;&#x5F53;&#x524D;&#x505A;&#x52A8;&#x753B;&#x7684;view&#x7684;start&#x4E3A;&#x539F;&#x70B9;(0,0)&#xFF0C;end(1,1)&#x4E3A;&#x7EC8;&#x70B9;&#x6765;&#x5EFA;&#x7ACB;&#x7684;&#x3002;</p>\n<p><img src=\"/2022/12/16/MotionLayout&#x8FDB;&#x9636;&#x52A8;&#x753B;&#x5FC5;&#x4FEE;&#x8BFE;/4.png\" alt></p>\n<p>&#x8FD9;&#x79CD;&#x5750;&#x6807;&#x7CFB;&#x4E5F;&#x662F;&#x6BD4;&#x8F83;&#x76F4;&#x89C2;&#x7684;&#xFF0C;&#x7528;&#x5904;&#x4E5F;&#x6BD4;&#x8F83;&#x5E38;&#x89C1;&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#xFF0C;&#x4F60;&#x8981;&#x505A;start&#x5230;end&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x505A;&#x4E00;&#x4E2A;&#x6C34;&#x5E73;&#x6216;&#x8005;&#x5782;&#x76F4;&#x7684;&#x52A8;&#x753B;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x5750;&#x6807;&#x7CFB;&#x5C31;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3002;&#x56E0;&#x4E3A;&#x4F60;&#x53EA;&#x8981;&#x64CD;&#x4F5C;x/y&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x5373;&#x53EF;&#x3002;</p>\n<h3 id=\"pathRelative\"><a href=\"#pathRelative\" class=\"headerlink\" title=\"pathRelative\"></a>pathRelative</h3><p>&#x5B83;&#x662F;&#x57FA;&#x4E8E;start&#x4E0E;end&#x4F5C;&#x4E3A;x&#x8F74;&#x7684;&#x5750;&#x6807;&#x7CFB;&#x3002;</p>\n<p><img src=\"/2022/12/16/MotionLayout&#x8FDB;&#x9636;&#x52A8;&#x753B;&#x5FC5;&#x4FEE;&#x8BFE;/5.png\" alt></p>\n<p>&#x770B;&#x5B83;&#x7684;&#x5750;&#x6807;&#x7CFB;&#x5C31;&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x5B83;&#x6BD4;&#x8F83;&#x9002;&#x5408;&#x505A;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;&#x81EA;&#x8EAB;start&#x4E0E;end&#x7684;&#x5F27;&#x7EBF;&#x3001;&#x66F2;&#x7EBF;&#x52A8;&#x753B;&#x3002;</p>\n<h2 id=\"pathMotionArc\"><a href=\"#pathMotionArc\" class=\"headerlink\" title=\"pathMotionArc\"></a>pathMotionArc</h2><p>&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86;pathMotionArc&#xFF0C;&#x5E76;&#x4E14;&#x5C06;&#x5B83;&#x7684;&#x503C;&#x8BBE;&#x7F6E;&#x4E3A;none&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x7684;&#x6548;&#x679C;&#x5C31;&#x662F;start&#x5230;&#x5E27;&#x4F4D;&#x7F6E;&#x3001;&#x6216;&#x8005;&#x5E27;&#x4F4D;&#x7F6E;&#x5230;&#x5E27;&#x4F4D;&#x7F6E;&#x3001;&#x4EA6;&#x6216;&#x8005;&#x5E27;&#x4F4D;&#x7F6E;&#x5230;end&#xFF0C;&#x5B83;&#x4EEC;&#x76F4;&#x63A5;&#x7684;&#x52A8;&#x753B;&#x66F2;&#x7EBF;&#x662F;&#x4E24;&#x70B9;&#x76F4;&#x7EBF;&#x7684;&#x8FDE;&#x7EBF;&#x3002;</p>\n<p>&#x8FD9;&#x5C31;&#x662F;pathMotionArc&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x5B83;&#x80FD;&#x591F;&#x6539;&#x53D8;&#x8DEF;&#x5F84;&#x4E2D;&#x7684;&#x5173;&#x952E;&#x70B9;&#x76F4;&#x63A5;&#x7684;&#x8FD0;&#x52A8;&#x66F2;&#x7EBF;&#x65B9;&#x5F0F;&#x3002;</p>\n<p>&#x9664;&#x4E86;none&#x4EE5;&#x4E3A;&#x5B83;&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x5176;&#x4ED6;&#x7684;&#x51E0;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x8D77;&#x6765;&#x4F53;&#x9A8C;&#x4E00;&#x4E0B;&#x3002;</p>\n<h3 id=\"startVertical\"><a href=\"#startVertical\" class=\"headerlink\" title=\"startVertical\"></a>startVertical</h3><p>&#x57FA;&#x4E8E;&#x7AD6;&#x76F4;&#x65B9;&#x5411;&#x7684;&#x5F27;&#x7EBF;&#x66F2;&#x7EBF;</p>\n<p><img src=\"/2022/12/16/MotionLayout&#x8FDB;&#x9636;&#x52A8;&#x753B;&#x5FC5;&#x4FEE;&#x8BFE;/6.gif\" alt></p>\n<h3 id=\"startHorizontal\"><a href=\"#startHorizontal\" class=\"headerlink\" title=\"startHorizontal\"></a>startHorizontal</h3><p>&#x57FA;&#x4E8E;&#x6C34;&#x5E73;&#x65B9;&#x5411;&#x7684;&#x5F27;&#x7EBF;&#x66F2;&#x7EBF;</p>\n<p><img src=\"/2022/12/16/MotionLayout&#x8FDB;&#x9636;&#x52A8;&#x753B;&#x5FC5;&#x4FEE;&#x8BFE;/7.gif\" alt></p>\n<h3 id=\"filp\"><a href=\"#filp\" class=\"headerlink\" title=\"filp\"></a>filp</h3><p>&#x57FA;&#x4E8E;&#x7FFB;&#x8F6C;&#x7684;&#x5F27;&#x7EBF;&#x66F2;&#x7EBF;</p>\n<p><img src=\"/2022/12/16/MotionLayout&#x8FDB;&#x9636;&#x52A8;&#x753B;&#x5FC5;&#x4FEE;&#x8BFE;/8.gif\" alt></p>\n<p>&#x5982;&#x679C;&#x4F60;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x7684;&#x5E27;&#x9009;&#x62E9;&#x4E0D;&#x540C;&#x7684;pathMotionArc&#x503C;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x7684;&#x52A8;&#x753B;&#x66F2;&#x7EBF;&#x6709;&#x4F1A;&#x66F4;&#x52A0;&#x4E30;&#x5BCC;&#x3002;</p>\n<h2 id=\"transitionEasing\"><a href=\"#transitionEasing\" class=\"headerlink\" title=\"transitionEasing\"></a>transitionEasing</h2><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8981;&#x64CD;&#x4F5C;&#x5B83;&#x7684;&#x8FD0;&#x52A8;&#x901F;&#x5EA6;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x7528;&#x5230;transitionEasing&#xFF0C;&#x5B83;&#x80FD;&#x591F;&#x6539;&#x53D8;&#x66F2;&#x7EBF;&#x7684;&#x8FD0;&#x52A8;&#x901F;&#x5EA6;&#x3002;</p>\n<p>&#x76EE;&#x524D;&#x652F;&#x6301;&#x7684;&#x6709;&#xFF1A;</p>\n<ol>\n<li>linear</li>\n<li>standard</li>\n<li>accelerate</li>\n<li>decelerate</li>\n</ol>\n<p>&#x5982;&#x679C;&#x4F60;&#x60F3;&#x81EA;&#x5B9A;&#x4E49;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;cubic&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app:transitionEasing=&quot;cubic(0.41, 1.97, 0.48, -1.12)&quot;</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x5BF9;&#x5E94;&#x7684;&#x901F;&#x5EA6;&#x66F2;&#x7EBF;&#x662F;&#xFF1A;</p>\n<p><img src=\"/2022/12/16/MotionLayout&#x8FDB;&#x9636;&#x52A8;&#x753B;&#x5FC5;&#x4FEE;&#x8BFE;/9.png\" alt></p>\n<p>&#x4E2D;&#x95F4;&#x901F;&#x5EA6;&#x6709;&#x4E00;&#x4E2A;&#x53CD;&#x5411;&#x8FC7;&#x7A0B;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x7684;&#x52A8;&#x753B;&#x6548;&#x679C;&#x5C31;&#x662F;&#x5728;&#x4E2D;&#x95F4;&#x65F6;&#x523B;&#x6709;&#x4E2A;&#x5F80;&#x8FD4;&#x6548;&#x679C;</p>\n<p><img src=\"/2022/12/16/MotionLayout&#x8FDB;&#x9636;&#x52A8;&#x753B;&#x5FC5;&#x4FEE;&#x8BFE;/10.gif\" alt></p>\n<h2 id=\"KeyAttribute\"><a href=\"#KeyAttribute\" class=\"headerlink\" title=\"KeyAttribute\"></a>KeyAttribute</h2><p>&#x5728;KeyPosition&#x4E2D;&#x6211;&#x4EEC;&#x80FD;&#x64CD;&#x4F5C;&#x7684;&#x5C5E;&#x6027;&#x9650;&#x5236;&#x5728;x&#x4E0E;y&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8981;&#x64CD;&#x4F5C;&#x4E00;&#x4E9B;&#x522B;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5230;KeyAttribute&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x5728;&#x5173;&#x952E;&#x5E27;&#x505A;&#x4E00;&#x4E2A;&#x7F29;&#x653E;&#x6548;&#x679C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;KeyFrameSet&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;KeyAttribute</span><br><span class=\"line\">        app:framePosition=&quot;10&quot;</span><br><span class=\"line\">        app:keyPositionType=&quot;parentRelative&quot;</span><br><span class=\"line\">        app:motionTarget=&quot;@id/tv&quot;</span><br><span class=\"line\">        android:scaleY=&quot;1.5&quot;</span><br><span class=\"line\">        android:scaleX=&quot;1.5&quot; /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;KeyAttribute</span><br><span class=\"line\">        app:framePosition=&quot;80&quot;</span><br><span class=\"line\">        app:keyPositionType=&quot;parentRelative&quot;</span><br><span class=\"line\">        app:motionTarget=&quot;@id/tv&quot;</span><br><span class=\"line\">        android:scaleY=&quot;0.5&quot;</span><br><span class=\"line\">        android:scaleX=&quot;0.5&quot; /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/KeyFrameSet&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2022/12/16/MotionLayout&#x8FDB;&#x9636;&#x52A8;&#x753B;&#x5FC5;&#x4FEE;&#x8BFE;/11.gif\" alt></p>\n<p>&#x9664;&#x4E86;&#x7F29;&#x653E;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x63A7;&#x5236;&#x5B83;&#x7684;alpha&#x3001;visibility&#x3001;rotation&#x3001;translation&#x7B49;&#x3002;</p>\n<p>&#x6709;&#x4E86;&#x4EE5;&#x4E0A;&#x8FD9;&#x4E9B;&#x4F7F;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x4E00;&#x4E9B;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x52A8;&#x753B;&#xFF0C;&#x8BA9;&#x52A8;&#x753B;&#x7684;&#x5B9E;&#x73B0;&#x6709;&#x4E86;&#x66F4;&#x591A;&#x7684;&#x9009;&#x62E9;&#x4E0E;&#x7A7A;&#x95F4;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x638C;&#x63E1;&#x4E86;&#x8FD9;&#x4E9B;&#xFF0C;&#x90A3;&#x4E48;MotionLayout&#x57FA;&#x672C;&#x4E0A;&#x5C31;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x4F60;&#x6240;&#x9700;&#x7684;99%&#x7684;&#x52A8;&#x753B;&#x6548;&#x679C;&#x3002;&#x81F3;&#x4E8E;&#x5269;&#x4E0B;&#x7684;1%&#xFF0C;&#x5F52;&#x5C5E;&#x4E8E;MotionaLayout&#x7684;&#x7EC8;&#x6781;&#x8FD0;&#x7528;&#x3002;</p>\n<p>&#x9488;&#x5BF9;&#x4E00;&#x5757;&#x7531;&#x4E8E;&#x65E5;&#x5E38;&#x4F7F;&#x7528;&#x592A;&#x5C11;&#xFF0C;&#x5927;&#x5BB6;&#x57FA;&#x672C;&#x90FD;&#x4F7F;&#x7528;&#x4E0D;&#x5230;&#xFF0C;&#x5C31;&#x4E0D;&#x5230;&#x8FD9;&#x91CC;&#x7EC6;&#x8BF4;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x611F;&#x5174;&#x8DA3;&#x53EF;&#x4EE5;&#x7ED9;&#x6211;&#x7559;&#x8A00;&#xFF0C;&#x5982;&#x679C;&#x7559;&#x8A00;&#x4E0D;&#x8F83;&#x591A;&#xFF0C;&#x6211;&#x4E5F;&#x4F1A;&#x9488;&#x5BF9;&#x6027;&#x7684;&#x51FA;&#x4E00;&#x7BC7;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x7AE0;&#x3002;</p>\n<h2 id=\"&#x1F411;&#x1F411;&#x1F411;\"><a href=\"#&#x1F411;&#x1F411;&#x1F411;\" class=\"headerlink\" title=\"&#x1F411;&#x1F411;&#x1F411;\"></a>&#x1F411;&#x1F411;&#x1F411;</h2><p>&#x6700;&#x540E;&#x6765;&#x4E2A;&#x6709;&#x8DA3;&#x7684;&#x95EE;&#x7B54;&#xFF0C;&#x6211;&#x6709;&#x671B;&#x8FDB;8&#x5F3A;&#xFF0C;&#x4F60;&#x80FD;&#x633A;&#x8FDB;&#x51E0;&#x5F3A;&#xFF0C;&#x6709;&#x671B;&#x8FDB;&#x51B3;&#x8D5B;&#x5417;&#xFF1F;</p>\n<p><img src=\"/2022/12/16/MotionLayout&#x8FDB;&#x9636;&#x52A8;&#x753B;&#x5FC5;&#x4FEE;&#x8BFE;/12.png\" alt></p>\n<h2 id=\"&#x63A8;&#x8350;\"><a href=\"#&#x63A8;&#x8350;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;\"></a>&#x63A8;&#x8350;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["MotionLayout"]},{"title":"MotionLayout教你轻松玩转动画","url":"https://www.rousetime.com/2022/12/13/MotionLayout让你轻松玩转动画/","content":"<p>&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;MotionLayout&#xFF0C;&#x4EA6;&#x6216;&#x8005;&#x4F60;&#x77E5;&#x9053;&#x4F46;&#x4E00;&#x76F4;&#x90FD;&#x6CA1;&#x5B9E;&#x9645;&#x7528;&#x8FC7;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x8FD9;&#x91CC;&#x5C06;&#x5E26;&#x4F60;&#x5168;&#x9762;&#x4F53;&#x9A8C;MotionLayout&#x7684;&#x795E;&#x5947;&#x3001;&#x7B80;&#x5355;&#x4E0E;&#x9AD8;&#x6548;&#x3002;</p>\n<p>&#x76F8;&#x4FE1;&#x4F60;&#x4E4B;&#x540E;&#x505A;&#x52A8;&#x753B;&#x5C31;&#x4F1A;&#x5BF9;&#x5B83;&#x604B;&#x604B;&#x4E0D;&#x820D;&#x3002;</p>\n<p>&#x901A;&#x8FC7;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x4F60;&#x5C06;&#x4F1A;&#x660E;&#x767D;&#x5173;&#x4E8E;MotionLayout&#x7684;&#x5982;&#x4E0B;&#x51E0;&#x4E2A;&#x8981;&#x70B9;&#xFF1A;</p>\n<ol>\n<li>MotionLayout&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</li>\n<li>&#x5C06;MotionLayout&#x6DFB;&#x52A0;&#x5230;&#x9879;&#x76EE;&#x4E2D;&#x5E76;&#x4F7F;&#x7528;</li>\n<li>MotionScene</li>\n<li>ConstraintSet</li>\n<li>Transition</li>\n<li>CustomAttribute</li>\n</ol>\n<h2 id=\"MotionLayout&#x662F;&#x4EC0;&#x4E48;\"><a href=\"#MotionLayout&#x662F;&#x4EC0;&#x4E48;\" class=\"headerlink\" title=\"MotionLayout&#x662F;&#x4EC0;&#x4E48;\"></a>MotionLayout&#x662F;&#x4EC0;&#x4E48;</h2><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x6765;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;MotionLayout&#xFF0C;&#x5B83;&#x662F;google&#x63A8;&#x51FA;&#x7684;&#x4E00;&#x79CD;&#x5B9E;&#x73B0;&#x52A8;&#x753B;&#x7684;&#x5E03;&#x5C40;view&#xFF0C;&#x57FA;&#x4E8E;ConstraintLayout&#x4E3A;&#x57FA;&#x7840;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x5F00;&#x53D1;&#x8005;&#x76F4;&#x63A5;&#x901A;&#x8FC7;xml&#x5E03;&#x5C40;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x8F7B;&#x677E;&#x5B9E;&#x73B0;&#x52A8;&#x753B;&#x3002;</p>\n<p>&#x8FD9;&#x91CC;&#x53EF;&#x80FD;&#x5C31;&#x6709;&#x4EBA;&#x4F1A;&#x95EE;&#xFF0C;&#x5B83;&#x4E0E;&#x4F20;&#x7EDF;&#x7684;&#x52A8;&#x753B;&#x53C8;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#x5462;&#xFF0C;&#x6216;&#x8005;&#x5B83;&#x7684;&#x4F18;&#x52BF;&#x5728;&#x54EA;&#x91CC;&#xFF1F;</p>\n<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x4F20;&#x7EDF;&#x7684;&#x52A8;&#x753B;&#x4F1A;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;&#xFF1A;</p>\n<ol>\n<li>&#x77E2;&#x91CF;&#x52A8;&#x753B;</li>\n<li>&#x5C5E;&#x6027;&#x52A8;&#x753B;</li>\n<li>LayoutTransition&#x52A8;&#x753B;</li>\n<li>&#x4E00;&#x4E9B;&#x5C01;&#x88C5;&#x63A7;&#x4EF6;&#x63D0;&#x4F9B;&#x7684;&#x52A8;&#x753B;&#x80FD;&#x529B;&#xFF0C;&#x4F8B;&#x5982;CoordinatorLayout</li>\n</ol>\n<p>&#x8FD9;&#x4E9B;&#x53EF;&#x80FD;&#x662F;&#x6211;&#x4EEC;&#x7528;&#x7684;&#x6BD4;&#x8F83;&#x591A;&#x7684;&#xFF0C;&#x5404;&#x81EA;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;&#xFF0C;&#x4F46;MotionLayout&#x5374;&#x57FA;&#x672C;&#x517C;&#x5BB9;&#x4E86;&#x5B83;&#x4EEC;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;MotionLayout&#x662F;&#x5B83;&#x4EEC;&#x7684;&#x7ED3;&#x5408;&#x4F53;&#x3002;</p>\n<p>&#x5B83;&#x80FD;&#x591F;&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;&#xFF0C;&#x6765;&#x5B9E;&#x73B0;&#x5C5E;&#x6027;&#x52A8;&#x753B;&#x7684;&#x7279;&#x5F81;&#xFF1B;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;TransitionManager&#x6765;&#x5B9E;&#x73B0;&#x754C;&#x9762;&#x7684;&#x8FC7;&#x6E21;&#x52A8;&#x753B;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x7ED3;&#x5408;CoordinatorLayout&#xFF0C;&#x6765;&#x5B9E;&#x73B0;&#x7279;&#x6548;&#x52A8;&#x753B;&#x3002;</p>\n<p>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;MotionLayout&#x5728;Android Studio&#x4E2D;&#x505A;&#x4E86;&#x5B8C;&#x7F8E;&#x4F18;&#x5316;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x5B83;&#x4E13;&#x6709;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x80FD;&#x8BA9;&#x5F00;&#x53D1;&#x8005;&#x901A;&#x8FC7;&#x754C;&#x9762;&#x5316;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x66F4;&#x597D;&#x7684;&#x5B9E;&#x73B0;&#x52A8;&#x753B;&#x6548;&#x679C;&#x3002;</p>\n<p><img src=\"/2022/12/13/MotionLayout&#x8BA9;&#x4F60;&#x8F7B;&#x677E;&#x73A9;&#x8F6C;&#x52A8;&#x753B;/1.gif\" alt></p>\n<p>&#x5F53;&#x7136;&#x5B83;&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x5C40;&#x9650;&#x6027;&#xFF0C;&#x4F8B;&#x5982;</p>\n<p>MotionLayout&#x53EA;&#x80FD;&#x9488;&#x5BF9;&#x81EA;&#x5DF1;&#x7684;&#x76F4;&#x63A5;&#x5B50;view&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x4E0E;TransitionManager&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;TransitionManager&#x53EF;&#x4EE5;&#x4F5C;&#x7528;&#x4E8E;&#x5176;&#x4ED6;&#x7684;&#x5D4C;&#x5957;&#x5E03;&#x5C40;&#xFF0C;&#x7075;&#x6D3B;&#x6027;&#x66F4;&#x9AD8;&#x3002;</p>\n<h2 id=\"&#x5C06;MotionLayout&#x6DFB;&#x52A0;&#x5230;&#x9879;&#x76EE;&#x4E2D;&#x5E76;&#x4F7F;&#x7528;\"><a href=\"#&#x5C06;MotionLayout&#x6DFB;&#x52A0;&#x5230;&#x9879;&#x76EE;&#x4E2D;&#x5E76;&#x4F7F;&#x7528;\" class=\"headerlink\" title=\"&#x5C06;MotionLayout&#x6DFB;&#x52A0;&#x5230;&#x9879;&#x76EE;&#x4E2D;&#x5E76;&#x4F7F;&#x7528;\"></a>&#x5C06;MotionLayout&#x6DFB;&#x52A0;&#x5230;&#x9879;&#x76EE;&#x4E2D;&#x5E76;&#x4F7F;&#x7528;</h2><p>&#x5982;&#x679C;&#x4F60;&#x9879;&#x76EE;&#x4E2D;&#x5DF2;&#x7ECF;&#x4F7F;&#x7528;&#x4E86;ConstraintLayout&#xFF0C;&#x53EA;&#x8981;&#x7248;&#x672C;&#x4E0D;&#x662F;&#x5F88;&#x4F4E;&#x5C31;&#x65E0;&#x9700;&#x65B0;&#x589E;&#x4F9D;&#x8D56;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7684;&#x8BDD;&#xFF0C;&#x9700;&#x8981;&#x589E;&#x52A0;&#x4E00;&#x4E0B;&#x4F9D;&#x8D56;:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">androidx.constraintlayout:constraintlayout:2.1.4</span><br></pre></td></tr></table></figure>\n<p>&#x7531;&#x4E8E;MotionLayout&#x662F;&#x57FA;&#x4E8E;ConstraintLayout&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x6709;ConstraintLayout&#x4F9D;&#x8D56;&#x5373;&#x53EF;&#x3002; </p>\n<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;androidx.constraintlayout.motion.widget.MotionLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class=\"line\">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class=\"line\">    android:layout_width=&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height=&quot;match_parent&quot;</span><br><span class=\"line\">    app:layoutDescription=&quot;@xml/activity_motion_layout_scene&quot;</span><br><span class=\"line\">    app:showPaths=&quot;true&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:id=&quot;@+id/tv&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:gravity=&quot;center&quot;</span><br><span class=\"line\">        android:background=&quot;@color/colorAccent&quot;</span><br><span class=\"line\">        android:text=&quot;@string/app_name&quot;</span><br><span class=\"line\">        android:textColor=&quot;@android:color/white&quot;</span><br><span class=\"line\">        app:layout_constraintStart_toStartOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/androidx.constraintlayout.motion.widget.MotionLayout&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x4F7F;&#x7528;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5982;&#x679C;&#x9700;&#x8981;&#x505A;&#x52A8;&#x753B;&#xFF0C;&#x9700;&#x8981;&#x5F15;&#x7528;&#x52A8;&#x753B;&#x7684;xml&#xFF0C;&#x901A;&#x8FC7;layoutDescription&#x6765;&#x5F15;&#x7528;&#x3002;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;activity_motion_layout_scene&#x6587;&#x4EF6;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x6587;&#x4EF6;&#x5177;&#x4F53;&#x5185;&#x5BB9;</p>\n<h2 id=\"MotionScene\"><a href=\"#MotionScene\" class=\"headerlink\" title=\"MotionScene\"></a>MotionScene</h2><p>&#x5728;MotionLayout&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x505A;&#x52A8;&#x753B;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;MotionScene&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x4F60;&#x7684;&#x52A8;&#x753B;&#x5B9A;&#x4E49;&#x90FD;&#x9700;&#x8981;&#x5728;MotionScene&#x4E2D;&#x3002;</p>\n<p>&#x5B83;&#x4E3B;&#x8981;&#x5305;&#x62EC;&#x5982;&#x4E0B;&#x51E0;&#x4E2A;&#x52A8;&#x753B;&#x64CD;&#x4F5C;&#x6807;&#x7B7E;</p>\n<ol>\n<li>ConstraintSets</li>\n<li>Transition</li>\n<li>CustomAttribute</li>\n<li>KeyFramesSet</li>\n</ol>\n<p>&#x6211;&#x4EEC;&#x6765;&#x7ED9;&#x4E0A;&#x9762;&#x7684;TextView&#x505A;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x79FB;&#x52A8;&#x52A8;&#x753B;&#xFF1A;&#x4ECE;&#x5DE6;&#x4E0A;&#x89D2;&#x79FB;&#x52A8;&#x5230;&#x53F3;&#x4E0B;&#x89D2;&#x3002;</p>\n<p>&#x9488;&#x5BF9;&#x8FD9;&#x79CD;&#x7B80;&#x5355;&#x7684;&#x5E73;&#x79FB;&#x52A8;&#x753B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;ConstraintSet&#x6765;&#x5B9A;&#x4E49;&#x52A8;&#x753B;&#x7684;start&#x4E0E;end&#x3002;</p>\n<h2 id=\"ConstraintSet\"><a href=\"#ConstraintSet\" class=\"headerlink\" title=\"ConstraintSet\"></a>ConstraintSet</h2><p>&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x70B9;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;ConstraintSet&#x4E2D;&#x7684;&#x7EA6;&#x675F;&#x4F1A;&#x76F4;&#x63A5;&#x5F71;&#x54CD;&#x5230;&#x6211;&#x4EEC;&#x5916;&#x9762;&#x7684;layout&#x5E03;&#x5C40;&#x7684;&#x7EA6;&#x675F;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;MotionScene xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class=\"line\">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;ConstraintSet android:id=&quot;@+id/start&quot;&gt;</span><br><span class=\"line\">        &lt;Constraint</span><br><span class=\"line\">            android:id=&quot;@+id/tv&quot;</span><br><span class=\"line\">            android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">            android:layout_height=&quot;50dp&quot;</span><br><span class=\"line\">            app:layout_constraintStart_toStartOf=&quot;parent&quot;</span><br><span class=\"line\">            app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;</span><br><span class=\"line\">    &lt;/ConstraintSet&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;ConstraintSet android:id=&quot;@+id/end&quot;&gt;</span><br><span class=\"line\">        &lt;Constraint</span><br><span class=\"line\">            android:id=&quot;@id/tv&quot;</span><br><span class=\"line\">            android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">            android:layout_height=&quot;50dp&quot;</span><br><span class=\"line\">            app:layout_constraintBottom_toBottomOf=&quot;parent&quot;</span><br><span class=\"line\">            app:layout_constraintEnd_toEndOf=&quot;parent&quot; /&gt;</span><br><span class=\"line\">    &lt;/ConstraintSet&gt;</span><br><span class=\"line\">   </span><br><span class=\"line\">&lt;/MotionScene&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E86;&#x4E24;&#x4E2A;ConstraintSet, &#x5206;&#x522B;&#x662F;start&#x4E0E;end&#xFF0C;&#x5176;&#x4E2D;start&#x4EE3;&#x8868;&#x7684;&#x662F;&#x52A8;&#x753B;&#x5F00;&#x59CB;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;TextView&#x5F00;&#x59CB;&#x7684;&#x5C55;&#x793A;&#x65B9;&#x5F0F;&#x3002;</p>\n<p>&#x5305;&#x62EC;&#x5B83;&#x7684;&#x5BBD;&#x9AD8;&#xFF0C;&#x5E03;&#x5C40;&#x7EA6;&#x675F;&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x4F1A;&#x76F4;&#x63A5;&#x8986;&#x76D6;layout&#x4E2D;&#x7684;&#x5BBD;&#x9AD8;&#x4E0E;&#x7EA6;&#x675F;&#x3002;</p>\n<p>&#x53E6;&#x4E00;&#x4E2A;end&#xFF0C;&#x4EE3;&#x8868;&#x7684;&#x662F;&#xFF0C;&#x52A8;&#x753B;&#x7ED3;&#x675F;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;TextView&#x7ED3;&#x675F;&#x4E4B;&#x540E;&#x7684;&#x5C55;&#x793A;&#x65B9;&#x5F0F;&#x3002;</p>\n<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5C06;&#x5B83;&#x7684;&#x7EA6;&#x675F;&#x7531;&#x4E4B;&#x524D;&#x7684;&#x5DE6;&#x4E0A;&#x89D2;&#xFF0C;&#x6539;&#x6210;&#x4E86;&#x53F3;&#x4E0B;&#x89D2;&#x3002;</p>\n<p>&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x52A8;&#x753B;&#x7684;&#x5F00;&#x59CB;&#x4E0E;&#x7ED3;&#x675F;&#x5C31;&#x5DF2;&#x7ECF;&#x5B9A;&#x4F4D;&#x5B8C;&#x6210;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5E94;&#x7528;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x7684;start&#x4E0E;end&#xFF0C;&#x8BA9;&#x52A8;&#x753B;&#x751F;&#x6548;&#x3002;</p>\n<blockquote>\n<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x91CC;&#x5B9A;&#x4E49;&#x7684;id&#x662F;&#x9700;&#x8981;&#x5173;&#x8054;&#x6211;&#x4EEC;layout&#x4E2D;&#x7684;id&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x80FD;&#x8BA9;MotionLayout&#x8FDB;&#x884C;&#x5339;&#x914D;&#x90A3;&#x4E2A;View&#x9700;&#x8981;&#x8FDB;&#x884C;&#x52A8;&#x753B;&#x3002;</p>\n</blockquote>\n<h2 id=\"Transition\"><a href=\"#Transition\" class=\"headerlink\" title=\"Transition\"></a>Transition</h2><p>&#x4E3A;&#x4E86;&#x8BA9;&#x52A8;&#x753B;&#x751F;&#x6548;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5230;Transition&#x6765;&#x5B9A;&#x4E49;&#x5B83;&#x7684;&#x52A8;&#x753B;&#x6267;&#x884C;&#x65B9;&#x5F0F;&#x3002;<br>&#x6211;&#x4EEC;&#x5728;MotionScene&#x4E2D;&#x518D;&#x6DFB;&#x52A0;Transition</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Transition</span><br><span class=\"line\">        app:constraintSetEnd=&quot;@id/end&quot;</span><br><span class=\"line\">        app:constraintSetStart=&quot;@+id/start&quot;</span><br><span class=\"line\">        app:duration=&quot;3000&quot;&gt;</span><br><span class=\"line\">&lt;/Transition&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x7684;id&#xFF0C;&#x5C31;&#x662F;&#x524D;&#x9762;ConstraintSet&#x4E2D;&#x5B9A;&#x4E49;&#x7684;id&#x3002;</p>\n<p>&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x7684;&#x52A8;&#x753B;&#x5C31;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x8D77;&#x6765;&#x3002;&#x4E00;&#x4E2A;&#x5E73;&#x79FB;&#x52A8;&#x753B;&#x5C31;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x4EFB;&#x4F55;java&#x6216;&#x8005;kotlin&#x4EE3;&#x7801;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;xml&#x5373;&#x53EF;&#x3002;</p>\n<p>&#x540C;&#x65F6;Android Studio&#x63D0;&#x4F9B;&#x4E86;&#x56FE;&#x5F62;&#x5316;&#x64CD;&#x4F5C;&#xFF0C;&#x8FD9;&#x6837;&#x4F60;&#x8FDE;xml&#x90FD;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x5199;&#x3002;</p>\n<p><img src=\"/2022/12/13/MotionLayout&#x8BA9;&#x4F60;&#x8F7B;&#x677E;&#x73A9;&#x8F6C;&#x52A8;&#x753B;/2.gif\" alt></p>\n<p>&#x770B;&#x53F3;&#x8FB9;&#x7684;&#x66F2;&#x7EBF;&#x56FE;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x7EBF;&#x6027;&#x7684;interpolator&#x3002;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x5B83;&#x7684;&#x8FD0;&#x52A8;&#x65B9;&#x5F0F;&#xFF0C;&#x4F8B;&#x5982;&#x4F7F;&#x7528;&#x7CFB;&#x7EDF;&#x63D0;&#x4F9B;&#x7684;easeInOut</p>\n<p><img src=\"/2022/12/13/MotionLayout&#x8BA9;&#x4F60;&#x8F7B;&#x677E;&#x73A9;&#x8F6C;&#x52A8;&#x753B;/3.png\" alt></p>\n<p>&#x9664;&#x4E86;motioninterpolator&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x5176;&#x4ED6;&#x5C5E;&#x6027;&#x8BBE;&#x7F6E;&#xFF0C;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x52A8;&#x753B;&#x8DEF;&#x7EBF;&#xFF0C;&#x4F7F;&#x7528;pathMotionArc&#xFF0C;&#x8BBE;&#x7F6E;&#x4E3A;startVertical</p>\n<p><img src=\"/2022/12/13/MotionLayout&#x8BA9;&#x4F60;&#x8F7B;&#x677E;&#x73A9;&#x8F6C;&#x52A8;&#x753B;/4.gif\" alt></p>\n<p>&#x73B0;&#x5728;&#x5B83;&#x7684;&#x8FD0;&#x52A8;&#x66F2;&#x7EBF;&#x5C31;&#x53D8;&#x6210;&#x4E86;&#x57FA;&#x4E8E;&#x7AD6;&#x76F4;&#x65B9;&#x5411;&#x4E0A;&#x7684;&#x4E00;&#x4E2A;&#x5F27;&#x7EBF;&#x3002;</p>\n<p>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x4E3A;&#x52A8;&#x753B;&#x6DFB;&#x52A0;&#x624B;&#x52BF;&#x64CD;&#x4F5C;&#xFF0C;&#x4F8B;&#x5982;OnSwipe</p>\n<p><img src=\"/2022/12/13/MotionLayout&#x8BA9;&#x4F60;&#x8F7B;&#x677E;&#x73A9;&#x8F6C;&#x52A8;&#x753B;/5.png\" alt></p>\n<p>&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x6ED1;&#x52A8;&#x624B;&#x52BF;&#xFF0C;&#x624B;&#x52BF;&#x65B9;&#x5411;&#x662F;dragDown&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x6ED1;&#x52A8;id&#x662F;&#x6211;&#x4EEC;&#x7684;tv&#xFF0C;&#x4E5F;&#x5C31;&#x662F;TextView&#xFF0C;&#x4F5C;&#x7528;&#x4E8E;TextView&#x7684;&#x6ED1;&#x52A8;&#x9762;&#x662F;bottom&#x3002;</p>\n<p><img src=\"/2022/12/13/MotionLayout&#x8BA9;&#x4F60;&#x8F7B;&#x677E;&#x73A9;&#x8F6C;&#x52A8;&#x753B;/6.gif\" alt></p>\n<p>&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#x5C42;&#x9762;&#x90FD;&#x662F;&#x5728;xml&#x4E2D;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Transition</span><br><span class=\"line\">    app:constraintSetEnd=&quot;@id/end&quot;</span><br><span class=\"line\">    app:constraintSetStart=&quot;@+id/start&quot;</span><br><span class=\"line\">    app:duration=&quot;3000&quot;</span><br><span class=\"line\">    app:motionInterpolator=&quot;easeInOut&quot;</span><br><span class=\"line\">    app:pathMotionArc=&quot;startVertical&quot;&gt;</span><br><span class=\"line\">    &lt;OnSwipe</span><br><span class=\"line\">        app:dragDirection=&quot;dragDown&quot;</span><br><span class=\"line\">        app:touchAnchorId=&quot;@id/tv&quot;</span><br><span class=\"line\">        app:touchAnchorSide=&quot;bottom&quot; /&gt;</span><br><span class=\"line\">&lt;/Transition&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;OnClick&#xFF0C;&#x8BA9;&#x52A8;&#x753B;&#x7684;&#x542F;&#x52A8;&#x901A;&#x8FC7;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x6765;&#x89E6;&#x53D1;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Transition</span><br><span class=\"line\">    app:constraintSetEnd=&quot;@id/end&quot;</span><br><span class=\"line\">    app:constraintSetStart=&quot;@+id/start&quot;</span><br><span class=\"line\">    app:duration=&quot;3000&quot;</span><br><span class=\"line\">    app:motionInterpolator=&quot;easeInOut&quot;</span><br><span class=\"line\">    app:pathMotionArc=&quot;startVertical&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;OnClick</span><br><span class=\"line\">        app:clickAction=&quot;toggle&quot;</span><br><span class=\"line\">        app:targetId=&quot;@id/tv&quot; /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/Transition&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x70B9;&#x51FB;TextView&#x5C31;&#x80FD;&#x5B9E;&#x73B0;&#x52A8;&#x753B;&#x7684;&#x6765;&#x56DE;&#x5207;&#x6362;&#x3002;</p>\n<h2 id=\"CustomAttribute\"><a href=\"#CustomAttribute\" class=\"headerlink\" title=\"CustomAttribute\"></a>CustomAttribute</h2><p>&#x5728;ConstraintSet&#x9664;&#x4E86;&#x4F4D;&#x7F6E;&#x8FB9;&#x754C;&#x5C5E;&#x6027;&#x8BBE;&#x7F6E;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x5305;&#x542B;&#x4E86;&#x5176;&#x5B83;&#x7684;&#x5185;&#x7F6E;&#x5C5E;&#x6027;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>\n<ol>\n<li>alpha</li>\n<li>visibility</li>\n<li>elevation</li>\n<li>rotation</li>\n<li>translation</li>\n<li>scale</li>\n</ol>\n<p>&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#x90FD;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x62FF;&#x6765;&#x505A;&#x52A8;&#x753B;&#x4F7F;&#x7528;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x4F5C;&#x7528;&#x4E8E;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5230;CustomAttribute&#xFF0C;&#x8DDF;&#x6211;&#x4EEC;&#x7684;&#x4F20;&#x7EDF;&#x52A8;&#x753B;ObjectAnimator&#x4E00;&#x6837;&#xFF0C;&#x53EA;&#x8981;&#x4F60;&#x4E3A;&#x9700;&#x8981;&#x505A;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;&#x63D0;&#x4F9B;&#x5BF9;&#x5E94;&#x7684;get/set&#x65B9;&#x6CD5;&#x5373;&#x53EF;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6765;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x4F8B;&#x5982;&#x6539;&#x53D8;view&#x7684;&#x80CC;&#x666F;&#x8272;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x4F7F;&#x7528;backgroundColor&#x5C5E;&#x6027;&#xFF0C;&#x7531;&#x4E8E;backgroundColor&#x5C5E;&#x6027;&#x5DF2;&#x7ECF;&#x652F;&#x6301;set/get&#x65B9;&#x6CD5;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x62FF;&#x6765;&#x7528;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;MotionScene xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class=\"line\">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;ConstraintSet android:id=&quot;@+id/start&quot;&gt;</span><br><span class=\"line\">        &lt;Constraint</span><br><span class=\"line\">            android:id=&quot;@+id/tv&quot;</span><br><span class=\"line\">            android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">            android:layout_height=&quot;50dp&quot;</span><br><span class=\"line\">            app:layout_constraintStart_toStartOf=&quot;parent&quot;</span><br><span class=\"line\">            app:layout_constraintTop_toTopOf=&quot;parent&quot;&gt;</span><br><span class=\"line\">            &lt;CustomAttribute</span><br><span class=\"line\">                app:attributeName=&quot;backgroundColor&quot;</span><br><span class=\"line\">                app:customColorValue=&quot;@color/colorAccent&quot; /&gt;</span><br><span class=\"line\">        &lt;/Constraint&gt;</span><br><span class=\"line\">    &lt;/ConstraintSet&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;ConstraintSet android:id=&quot;@+id/end&quot;&gt;</span><br><span class=\"line\">        &lt;Constraint</span><br><span class=\"line\">            android:id=&quot;@id/tv&quot;</span><br><span class=\"line\">            android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">            android:layout_height=&quot;50dp&quot;</span><br><span class=\"line\">            app:layout_constraintBottom_toBottomOf=&quot;parent&quot;</span><br><span class=\"line\">            app:layout_constraintEnd_toEndOf=&quot;parent&quot;&gt;</span><br><span class=\"line\">            &lt;CustomAttribute</span><br><span class=\"line\">                app:attributeName=&quot;backgroundColor&quot;</span><br><span class=\"line\">                app:customColorValue=&quot;@color/colorPrimary&quot; /&gt;</span><br><span class=\"line\">        &lt;/Constraint&gt;</span><br><span class=\"line\">    &lt;/ConstraintSet&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;Transition</span><br><span class=\"line\">        app:constraintSetEnd=&quot;@id/end&quot;</span><br><span class=\"line\">        app:constraintSetStart=&quot;@+id/start&quot;</span><br><span class=\"line\">        app:duration=&quot;3000&quot;</span><br><span class=\"line\">        app:motionInterpolator=&quot;easeInOut&quot;</span><br><span class=\"line\">        app:pathMotionArc=&quot;startVertical&quot;&gt;</span><br><span class=\"line\">        &lt;OnSwipe</span><br><span class=\"line\">            app:dragDirection=&quot;dragDown&quot;</span><br><span class=\"line\">            app:touchAnchorId=&quot;@id/tv&quot;</span><br><span class=\"line\">            app:touchAnchorSide=&quot;bottom&quot; /&gt;</span><br><span class=\"line\">    &lt;/Transition&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/MotionScene&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2022/12/13/MotionLayout&#x8BA9;&#x4F60;&#x8F7B;&#x677E;&#x73A9;&#x8F6C;&#x52A8;&#x753B;/7.gif\" alt></p>\n<p>&#x5C5E;&#x6027;&#x540D;&#x79F0;&#x662F;backgroundColor&#xFF0C;&#x5C5E;&#x6027;&#x503C;&#x4F7F;&#x7528;&#x7684;&#x662F;customColorValue&#xFF0C;&#x8FD9;&#x91CC;&#x6839;&#x636E;&#x81EA;&#x8EAB;&#x7684;&#x5C5E;&#x6027;&#x503C;&#x6765;&#x51B3;&#x5B9A;&#x4F7F;&#x7528;&#x54EA;&#x79CD;&#xFF0C;&#x76EE;&#x524D;&#x652F;&#x6301;&#x7684;&#x6709;&#x5982;&#x4E0B;&#x51E0;&#x79CD;&#x3002;</p>\n<ol>\n<li>customColorValue</li>\n<li>customIntegerValue</li>\n<li>customFloatValue</li>\n<li>customStringValue</li>\n<li>customDimension</li>\n<li>customBoolean</li>\n<li>customReference</li>\n<li>customPixelDimension</li>\n</ol>\n<p>&#x6709;&#x4E86;&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x8BF4;&#x57FA;&#x672C;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x6211;&#x4EEC;&#x65E5;&#x5E38;&#x9700;&#x8981;&#x7684;90%&#x7684;&#x52A8;&#x753B;&#x9700;&#x6C42;&#x3002;</p>\n<p>&#x81F3;&#x4E8E;&#x5269;&#x4E0B;&#x7684;10%&#xFF0C;&#x6D89;&#x53CA;&#x7684;&#x90FD;&#x662F;&#x590D;&#x6742;&#x7684;&#x52A8;&#x753B;&#x5B9E;&#x73B0;&#x3002;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x7684;&#x52A8;&#x753B;&#x5B9E;&#x73B0;&#x90FD;&#x662F;&#x7ED9;&#x4E2A;start&#x4E0E;end&#xFF0C;&#x4E2D;&#x95F4;&#x7684;&#x52A8;&#x753B;&#x8FC7;&#x7A0B;&#x6211;&#x4EEC;&#x90FD;&#x6CA1;&#x6709;&#x8FDB;&#x884C;&#x5E72;&#x6D89;&#x3002;&#x4E00;&#x65E6;&#x6D89;&#x53CA;&#x5230;&#x66F4;&#x7075;&#x6D3B;&#x66F4;&#x590D;&#x6742;&#x7684;&#x52A8;&#x753B;&#x9700;&#x6C42;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x624B;&#x52A8;&#x8BBE;&#x7F6E;&#x52A8;&#x753B;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x8FDB;&#x5EA6;&#x7684;&#x503C;&#x3002;</p>\n<p>&#x9488;&#x5BF9;&#x5B9A;&#x5236;&#x5316;&#x7684;&#x52A8;&#x753B;&#xFF0C;MotionLayout&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x671F;&#x5F85;&#x4E4B;&#x540E;&#x7684;&#x6587;&#x7AE0;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x6765;&#x4E2A;&#x8C03;&#x67E5;&#xFF1A;<code>&#x4F60;&#x662F;&#x5426;&#x89C9;&#x5F97;MotionLayout&#x8BA9;&#x52A8;&#x753B;&#x5B9E;&#x73B0;&#x66F4;&#x52A0;&#x8D8B;&#x4E8E;&#x7B80;&#x5355;&#x4E86;&#x5462;&#xFF1F;</code></p>\n<h2 id=\"&#x63A8;&#x8350;\"><a href=\"#&#x63A8;&#x8350;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;\"></a>&#x63A8;&#x8350;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["MotionLayout"]},{"title":"Android OpenGL ES 纹理","url":"https://www.rousetime.com/2022/02/26/Android-OpenGL-ES-纹理/","content":"<h2 id=\"OpenGL-ES-&#x7CFB;&#x5217;\"><a href=\"#OpenGL-ES-&#x7CFB;&#x5217;\" class=\"headerlink\" title=\"OpenGL ES &#x7CFB;&#x5217;\"></a>OpenGL ES &#x7CFB;&#x5217;</h2><p><a href=\"https://www.rousetime.com/2022/02/14/Android-OpenGL-ES-%E5%9F%BA%E7%A1%80%E5%8E%9F%E7%90%86/\">Android OpenGL ES &#x57FA;&#x7840;&#x539F;&#x7406;</a></p>\n<p><a href=\"https://www.rousetime.com/2022/02/25/Android-OpenGL-ES-%E6%B8%B2%E6%9F%93%E6%A8%A1%E5%BC%8F/\">Android OpenGL ES &#x6E32;&#x67D3;&#x6A21;&#x5F0F;</a></p>\n<p>&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x4E00;&#x76F4;&#x90FD;&#x662F;&#x5728;&#x7ED8;&#x5236;&#x7B80;&#x5355;&#x7684;&#x56FE;&#x5F62;&#x4E0E;&#x989C;&#x8272;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x4E00;&#x5F20;&#x56FE;&#x7247;&#x8BE5;&#x5982;&#x4F55;&#x901A;&#x8FC7;OpenGL ES&#x8FDB;&#x884C;&#x6E32;&#x67D3;&#x51FA;&#x6765;&#x5462;&#xFF1F;</p>\n<p>OpenGL ES&#x7684;&#x6E32;&#x67D3;&#x65B9;&#x5F0F;&#x662F;&#x901A;&#x8FC7;&#x7EB9;&#x7406;&#x6765;&#x7ED8;&#x5236;&#x51FA;&#x56FE;&#x7247;&#xFF0C;&#x901A;&#x8FC7;&#x7EB9;&#x7406;&#x5C06;&#x56FE;&#x7247;&#x50CF;&#x7D20;&#x503C;&#x4F20;&#x9012;&#x5230;&#x5BF9;&#x5E94;&#x4F4D;&#x7F6E;&#xFF0C;&#x6700;&#x7EC8;&#x6E32;&#x67D3;&#x51FA;&#x6765;&#x3002;</p>\n<h2 id=\"&#x7740;&#x8272;&#x5668;&#x6E90;&#x7801;\"><a href=\"#&#x7740;&#x8272;&#x5668;&#x6E90;&#x7801;\" class=\"headerlink\" title=\"&#x7740;&#x8272;&#x5668;&#x6E90;&#x7801;\"></a>&#x7740;&#x8272;&#x5668;&#x6E90;&#x7801;</h2><p>&#x8FD8;&#x662F;&#x8001;&#x89C4;&#x77E9;&#xFF0C;&#x9996;&#x5148;&#x5B9A;&#x4E49;&#x9876;&#x70B9;&#x4E0E;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;&#x6E90;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private const val VERTEX_SHADER_SOURCE =</span><br><span class=\"line\">    &quot;attribute vec4 a_Position;\\n&quot; +</span><br><span class=\"line\">            &quot;attribute vec2 a_textureCoordinate;\\n&quot; +</span><br><span class=\"line\">            &quot;varying vec2 v_textureCoordinate;\\n&quot; +</span><br><span class=\"line\">            &quot;void main() {\\n&quot; +</span><br><span class=\"line\">            &quot;   v_textureCoordinate = a_textureCoordinate;\\n&quot; +</span><br><span class=\"line\">            &quot;   gl_Position = a_Position;\\n&quot; +</span><br><span class=\"line\">            &quot;}&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">private const val FRAGMENT_SHADER_SOURCE =</span><br><span class=\"line\">    &quot;precision mediump float;\\n&quot; +</span><br><span class=\"line\">            &quot;uniform sampler2D u_texture;\\n&quot; +</span><br><span class=\"line\">            &quot;varying vec2 v_textureCoordinate;\\n&quot; +</span><br><span class=\"line\">            &quot;void main() {\\n&quot; +</span><br><span class=\"line\">            &quot;   gl_FragColor = texture2D(u_texture, v_textureCoordinate);\\n&quot; +</span><br><span class=\"line\">            &quot;}&quot;</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E86;a_textureCoordinate&#x7EB9;&#x7406;&#x7684;&#x5750;&#x6807;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E0E;&#x4E4B;&#x524D;&#x989C;&#x8272;&#x540C;&#x7406;&#xFF1B;&#x7136;&#x540E;&#x662F;u_texture&#xFF0C;&#x4EE3;&#x8868;&#x4E8C;&#x7EF4;&#x7EB9;&#x7406;&#x53E5;&#x67C4;&#xFF0C;&#x901A;&#x8FC7;&#x5916;&#x754C;&#x5C06;&#x7EB9;&#x7406;&#x4F20;&#x9012;&#x7ED9;GL&#x7A0B;&#x5E8F;&#xFF0C;&#x6700;&#x7EC8;&#x901A;&#x8FC7;texture2D&#x6765;&#x8F6C;&#x5316;&#x6210;&#x5BF9;&#x5E94;&#x7684;&#x989C;&#x8272;&#x503C;&#x3002;</p>\n<h2 id=\"&#x7EB9;&#x7406;&#x5750;&#x6807;\"><a href=\"#&#x7EB9;&#x7406;&#x5750;&#x6807;\" class=\"headerlink\" title=\"&#x7EB9;&#x7406;&#x5750;&#x6807;\"></a>&#x7EB9;&#x7406;&#x5750;&#x6807;</h2><p>&#x8981;&#x7ED8;&#x5236;&#x7EB9;&#x7406;&#xFF0C;&#x81EA;&#x7136;&#x8981;&#x6709;&#x7EB9;&#x7406;&#x5750;&#x6807;&#xFF0C;&#x8981;&#x77E5;&#x9053;&#x5728;&#x54EA;&#x4E9B;&#x4F4D;&#x7F6E;&#x8FDB;&#x884C;&#x7ED8;&#x5236;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x6765;&#x5B9A;&#x4E49;&#x7EB9;&#x7406;&#x7684;&#x5750;&#x6807;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x6574;&#x4E2A;&#x89C6;&#x56FE;</span><br><span class=\"line\">private val mVertexData = floatArrayOf(</span><br><span class=\"line\">    -1.0f, 1.0f, -1.0f, -1.0f, 1.0f, -1.0f,</span><br><span class=\"line\">    -1.0f, 1.0f, 1.0f, 1.0f, 1.0f, -1.0f</span><br><span class=\"line\">)</span><br><span class=\"line\"> </span><br><span class=\"line\">// &#x6574;&#x4E2A;&#x7EB9;&#x7406;</span><br><span class=\"line\">private val mTextureData = floatArrayOf(</span><br><span class=\"line\">    0.0f, 0.0f, 0.0f, 1.0f, 1.0f, 1.0f,</span><br><span class=\"line\">    0.0f, 0.0f, 1.0f, 0.0f, 1.0f, 1.0f</span><br><span class=\"line\">)</span><br><span class=\"line\"> </span><br><span class=\"line\">private const val TEXTURE_DIMENSION_SIZE = 2</span><br></pre></td></tr></table></figure>\n<p>&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x63D0;&#x5230;&#x9876;&#x70B9;&#x7684;&#x5750;&#x6807;&#x539F;&#x70B9;&#x662F;&#x5728;&#x4E2D;&#x5FC3;&#xFF0C;&#x4E14;&#x5750;&#x6807;&#x8303;&#x56F4;&#x662F;-1~1&#x3002;&#x800C;&#x7EB9;&#x7406;&#x7684;&#x5750;&#x6807;&#x539F;&#x70B9;&#x662F;&#x5728;&#x5DE6;&#x4E0B;&#x89D2;&#xFF0C;&#x4E14;&#x5750;&#x6807;&#x8303;&#x56F4;&#x662F;0~1&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x9876;&#x70B9;&#x5750;&#x6807;&#x4E0E;&#x7EB9;&#x7406;&#x5750;&#x6807;&#x662F;&#x4E0A;&#x4E0B;&#x98A0;&#x5012;&#x7684;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x6709;&#x7684;&#x540C;&#x5B66;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x7591;&#x95EE;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x98A0;&#x5012;&#x5462;&#xFF1F;&#x90FD;&#x98A0;&#x5012;&#x4E86;&#x7ED8;&#x5236;&#x51FA;&#x6765;&#x7684;&#x56FE;&#x7247;&#x4E0D;&#x662F;&#x4E5F;&#x662F;&#x98A0;&#x5012;&#x7684;&#x5417;&#xFF1F;</p>\n<p>&#x6211;&#x53EF;&#x4EE5;&#x5F88;&#x660E;&#x786E;&#x7684;&#x8BF4;&#xFF0C;&#x4E0D;&#x4F1A;&#x7684;&#x3002;&#x8BA9;&#x6211;&#x5148;&#x4E70;&#x4E2A;&#x5173;&#x5B50;&#xFF0C;&#x539F;&#x56E0;&#x540E;&#x9762;&#x518D;&#x8BF4;&#x3002;</p>\n<p>&#x6709;&#x4E86;&#x5750;&#x6807;&#x6570;&#x636E;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x662F;&#x5E72;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x5982;&#x679C;&#x4F60;&#x770B;&#x4E86;&#x524D;&#x9762;&#x51E0;&#x7BC7;&#x6587;&#x7AE0;&#x5C31;&#x4E0D;&#x964C;&#x751F;&#x4E86;&#x3002;</p>\n<p>&#x5C06;&#x6570;&#x636E;&#x586B;&#x5145;&#x5230;Buffer&#x4E2D;&#xFF0C;&#x5E76;&#x4F20;&#x9012;&#x5230;GL&#x7A0B;&#x5E8F;&#x4E2D;&#x3002;</p>\n<h2 id=\"&#x586B;&#x5145;&#x7EB9;&#x7406;&#x5750;&#x6807;&#x6570;&#x636E;\"><a href=\"#&#x586B;&#x5145;&#x7EB9;&#x7406;&#x5750;&#x6807;&#x6570;&#x636E;\" class=\"headerlink\" title=\"&#x586B;&#x5145;&#x7EB9;&#x7406;&#x5750;&#x6807;&#x6570;&#x636E;\"></a>&#x586B;&#x5145;&#x7EB9;&#x7406;&#x5750;&#x6807;&#x6570;&#x636E;</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x52A0;&#x8F7D;&#x7EB9;&#x7406;&#x6570;&#x636E;</span><br><span class=\"line\">val textureBuffer = ByteBuffer.allocateDirect(mTextureData.size * Float.SIZE_BYTES)</span><br><span class=\"line\">    .order(ByteOrder.nativeOrder())</span><br><span class=\"line\">    .asFloatBuffer()</span><br><span class=\"line\">textureBuffer.put(mTextureData)</span><br><span class=\"line\">textureBuffer.position(0)</span><br><span class=\"line\">  </span><br><span class=\"line\">// &#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7EB9;&#x7406;&#x53C2;&#x6570;&#x4F4D;&#x7F6E;</span><br><span class=\"line\">val textureCoordinateLocation = GLES20.glGetAttribLocation(programId, &quot;a_textureCoordinate&quot;)</span><br><span class=\"line\">  </span><br><span class=\"line\">// &#x542F;&#x52A8;&#x5BF9;&#x5E94;&#x7EB9;&#x7406;&#x53C2;&#x6570;&#x4F4D;&#x7F6E;</span><br><span class=\"line\">GLES20.glEnableVertexAttribArray(textureCoordinateLocation)</span><br><span class=\"line\">  </span><br><span class=\"line\">// &#x586B;&#x5145;&#x5BF9;&#x5E94;&#x9876;&#x70B9;&#x5904;&#x7EB9;&#x7406;&#x4F4D;&#x7F6E;&#x6570;&#x636E;</span><br><span class=\"line\">GLES20.glVertexAttribPointer(textureCoordinateLocation, TEXTURE_DIMENSION_SIZE, GLES20.GL_FLOAT, false, 0, textureBuffer)</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x7684;&#x7EB9;&#x7406;&#x7ED8;&#x5236;&#x533A;&#x57DF;&#x5C31;&#x786E;&#x5B9A;&#x4E86;&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x8DDF;&#x9876;&#x70B9;&#x4E0E;&#x989C;&#x8272;&#x7684;&#x6570;&#x636E;&#x586B;&#x5145;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#xFF0C;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x770B;&#x5B83;&#x4EEC;&#x5728;&#x6E90;&#x7801;&#x4E2D;&#x7684;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x5C31;&#x80FD;&#x660E;&#x767D;&#x8FD9;&#x4E00;&#x70B9;&#x3002;&#x56E0;&#x4E3A;&#x6700;&#x7EC8;&#x76EE;&#x7684;&#x90FD;&#x662F;&#x5411;GL&#x7A0B;&#x5E8F;&#x8FDB;&#x884C;&#x586B;&#x5145;&#x6570;&#x636E;&#x3002;&#x638C;&#x63E1;&#x5230;&#x8FD9;&#x4E00;&#x70B9;&#x4EE5;&#x540E;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#x7684;&#x586B;&#x5145;&#x90FD;&#x662F;&#x7C7B;&#x4F3C;&#x7684;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;GL&#x7A0B;&#x5E8F;&#x7684;&#x5957;&#x8DEF;&#x6240;&#x5728;&#x3002;</p>\n<h2 id=\"&#x521B;&#x5EFA;&#x7EB9;&#x7406;\"><a href=\"#&#x521B;&#x5EFA;&#x7EB9;&#x7406;\" class=\"headerlink\" title=\"&#x521B;&#x5EFA;&#x7EB9;&#x7406;\"></a>&#x521B;&#x5EFA;&#x7EB9;&#x7406;</h2><p>&#x65E2;&#x7136;&#x7EB9;&#x7406;&#x533A;&#x57DF;&#x786E;&#x5B9A;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5C31;&#x8981;&#x6765;&#x521B;&#x5EFA;&#x7EB9;&#x7406;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x521B;&#x5EFA;&#x7EB9;&#x7406;</span><br><span class=\"line\">val textures = IntArray(1)</span><br><span class=\"line\">GLES20.glGenTextures(textures.size, textures, 0)</span><br><span class=\"line\">GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, textures[0])</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x9700;&#x8981;&#x83B7;&#x5F97;&#x7684;&#x662F;&#x7EB9;&#x7406;&#x53E5;&#x67C4;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C06;&#x521B;&#x5EFA;&#x7684;&#x7EB9;&#x7406;&#x53E5;&#x67C4;&#x4FDD;&#x5B58;&#x5230;textures&#x4E2D;&#xFF0C;&#x540C;&#x65F6;&#x6307;&#x5B9A;&#x8BE5;&#x7EB9;&#x7406;&#x5728;GL&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x901A;&#x9053;&#x7D22;&#x5F15;&#xFF0C;&#x8FD9;&#x91CC;&#x4E3A;0&#x3002;</p>\n<p>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6307;&#x5B9A;&#x901A;&#x9053;&#xFF0C;&#x56E0;&#x4E3A;&#x7EB9;&#x7406;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#xFF0C;&#x5F53;&#x4F60;&#x53BB;&#x7ED8;&#x5236;&#x7684;&#x65F6;&#x5019;&#x9700;&#x8981;&#x9009;&#x62E9;&#x6307;&#x5B9A;&#x7684;&#x901A;&#x9053;&#xFF0C;&#x624D;&#x80FD;&#x7ED8;&#x5236;&#x51FA;&#x81EA;&#x5DF1;&#x60F3;&#x8981;&#x7684;&#x7EB9;&#x7406;&#x3002;&#x53E6;&#x5916;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7ED8;&#x5236;&#x7684;&#x662F;&#x4E8C;&#x7EF4;&#x56FE;&#x7247;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C06;&#x7EB9;&#x7406;&#x6307;&#x5B9A;&#x4E3A;GL_TEXTURE_2D&#x4E8C;&#x7EF4;&#x3002;</p>\n<h2 id=\"&#x7EB9;&#x7406;&#x53C2;&#x6570;\"><a href=\"#&#x7EB9;&#x7406;&#x53C2;&#x6570;\" class=\"headerlink\" title=\"&#x7EB9;&#x7406;&#x53C2;&#x6570;\"></a>&#x7EB9;&#x7406;&#x53C2;&#x6570;</h2><p>&#x521B;&#x5EFA;&#x7EB9;&#x7406;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x8BBE;&#x7F6E;&#x7EB9;&#x7406;&#x7684;&#x53C2;&#x6570;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x8BBE;&#x7F6E;&#x7EB9;&#x7406;&#x53C2;&#x6570;</span><br><span class=\"line\">GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MIN_FILTER, GLES20.GL_LINEAR)</span><br><span class=\"line\">GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MAG_FILTER, GLES20.GL_LINEAR)</span><br><span class=\"line\">GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_WRAP_T, GLES20.GL_CLAMP_TO_EDGE)</span><br><span class=\"line\">GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_WRAP_S, GLES20.GL_CLAMP_TO_EDGE)</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;GL_TEXTURE_MIN_FILTER&#x4E0E;GL_TEXTURE_MAG_FILTER&#x662F;&#x7EB9;&#x7406;&#x7684;&#x8FC7;&#x6EE4;&#x53C2;&#x6570;&#xFF0C;&#x4F5C;&#x7528;&#x662F;&#x5F53;&#x7EB9;&#x7406;&#x6E32;&#x67D3;&#x65F6;&#x6BD4;&#x539F;&#x7406;&#x7684;&#x7EB9;&#x7406;&#x5C0F;&#x6216;&#x8005;&#x5927;&#x65F6;&#x8981;&#x5982;&#x4F55;&#x5904;&#x7406;&#xFF0C;GL_LINEAR&#x662F;&#x7EBF;&#x6027;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#xFF0C;&#x5C55;&#x793A;&#x7684;&#x6548;&#x679C;&#x662F;&#x66F4;&#x5E73;&#x6ED1;&#xFF1B;&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x662F;GL_NEAREST&#xFF0C;&#x5B83;&#x4F1A;&#x9009;&#x62E9;&#x4E0E;&#x6700;&#x8FD1;&#x7684;&#x50CF;&#x7D20;&#xFF0C;&#x6240;&#x4EE5;&#x5C55;&#x793A;&#x7684;&#x6548;&#x679C;&#x6709;&#x952F;&#x9F7F;&#x611F;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5C06;&#x9876;&#x70B9;&#x5750;&#x6807;&#x6269;&#x5927;5&#x500D;&#x770B;&#x4E0B;&#x4E24;&#x79CD;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x7684;&#x6548;&#x679C;&#x3002;</p>\n<div align=\"center\"><br><img src=\"/2022/02/26/Android-OpenGL-ES-&#x7EB9;&#x7406;/linear.jpeg\" width=\"375\" height=\"750\"><br></div>\n\n<div align=\"center\"><br><img src=\"/2022/02/26/Android-OpenGL-ES-&#x7EB9;&#x7406;/nearest.jpeg\" width=\"375\" height=\"750\"><br></div>\n\n<p>GL_TEXTURE_WRAP_T&#x4E0E;GL_TEXTURE_WRAP_S&#x662F;&#x7EB9;&#x7406;&#x5750;&#x6807;&#x8D85;&#x51FA;&#x7EB9;&#x7406;&#x8303;&#x56F4;&#x7684;&#x5904;&#x7406;&#x53C2;&#x6570;&#x3002;</p>\n<p>GL_CLAMP_TO_EDGE&#x4EE5;&#x586B;&#x5145;&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</p>\n<p>GL_REPEAT&#x4EE5;&#x91CD;&#x590D;&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5C06;&#x7EB9;&#x7406;&#x5750;&#x6807;&#x6269;&#x5927;5&#x500D;&#x770B;&#x4E0B;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x7684;&#x5904;&#x7406;&#x6548;&#x679C;&#x3002;</p>\n<div align=\"center\"><br><img src=\"/2022/02/26/Android-OpenGL-ES-&#x7EB9;&#x7406;/clamp.jpeg\" width=\"375\" height=\"750\"><br></div>\n\n<div align=\"center\"><br><img src=\"/2022/02/26/Android-OpenGL-ES-&#x7EB9;&#x7406;/repeat.jpeg\" width=\"375\" height=\"750\"><br></div>\n\n<h2 id=\"&#x586B;&#x5145;&#x4E0E;&#x7ED1;&#x5B9A;&#x7EB9;&#x7406;\"><a href=\"#&#x586B;&#x5145;&#x4E0E;&#x7ED1;&#x5B9A;&#x7EB9;&#x7406;\" class=\"headerlink\" title=\"&#x586B;&#x5145;&#x4E0E;&#x7ED1;&#x5B9A;&#x7EB9;&#x7406;\"></a>&#x586B;&#x5145;&#x4E0E;&#x7ED1;&#x5B9A;&#x7EB9;&#x7406;</h2><p>&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x52A0;&#x8F7D;&#x672C;&#x5730;&#x7684;&#x4E00;&#x79CD;&#x56FE;&#x7247;&#xFF0C;&#x5C06;&#x5176;&#x901A;&#x8FC7;OpenGL &#x8FDB;&#x884C;&#x6E32;&#x67D3;&#x51FA;&#x6765;&#x3002;</p>\n<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5C06;&#x672C;&#x5730;&#x7684;&#x56FE;&#x7247;&#x8F6C;&#x5316;&#x6210;Bitmap&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x5C06;&#x8D44;&#x6E90;&#x56FE;&#x7247;&#x89E3;&#x7801;&#x6210;bitmap</span><br><span class=\"line\">val bitmap = BitmapFactory.decodeResource(context.resources, R.drawable.yaodaoji)</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x5C06;Bitmap&#x586B;&#x5145;&#x5230;Buffer&#x4E2D;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x5C06;bitmap&#x586B;&#x5145;&#x5230;&#x7EB9;&#x7406;&#x4E2D;</span><br><span class=\"line\">val bitmapBuffer = ByteBuffer.allocateDirect(bitmap.width * bitmap.height * 4)</span><br><span class=\"line\">    .order(ByteOrder.nativeOrder())</span><br><span class=\"line\">bitmap.copyPixelsToBuffer(bitmapBuffer)</span><br><span class=\"line\">bitmapBuffer.position(0)</span><br><span class=\"line\">GLES20.glTexImage2D(</span><br><span class=\"line\">    GLES20.GL_TEXTURE_2D,</span><br><span class=\"line\">    0,</span><br><span class=\"line\">    GLES20.GL_RGBA,</span><br><span class=\"line\">    bitmap.width,</span><br><span class=\"line\">    bitmap.height,</span><br><span class=\"line\">    0,</span><br><span class=\"line\">    GLES20.GL_RGBA,</span><br><span class=\"line\">    GLES20.GL_UNSIGNED_BYTE,</span><br><span class=\"line\">    bitmapBuffer</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E00;&#x6B65;&#x518D;&#x719F;&#x6089;&#x4E0D;&#x8FC7;&#x4E86;&#xFF0C;&#x5C06;Bitmap&#x6570;&#x636E;&#x586B;&#x5145;&#x5230;Buffer&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;glTexImage2D&#x5C06;&#x5176;&#x586B;&#x5145;&#x5230;&#x7EB9;&#x7406;&#x4E2D;&#x3002;</p>\n<p>&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x8BF4;&#x5230;&#x7EB9;&#x7406;&#x5750;&#x6807;&#x4E0E;&#x9876;&#x70B9;&#x5750;&#x6807;&#x4E0A;&#x4E0B;&#x98A0;&#x5012;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x4F1A;&#x9020;&#x6210;&#x6E32;&#x67D3;&#x51FA;&#x6765;&#x7684;&#x56FE;&#x7247;&#x4E0A;&#x4E0B;&#x98A0;&#x5012;&#x3002;</p>\n<p>&#x7B54;&#x6848;&#x5C31;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x6E32;&#x67D3;&#x56FE;&#x7247;&#x4F7F;&#x7528;&#x7684;&#x662F;Bitmap&#x7684;&#x6570;&#x636E;&#xFF0C;&#x800C;Bitmap&#x7684;&#x6570;&#x636E;&#x5750;&#x6807;&#x662F;&#x5728;&#x5DE6;&#x4E0A;&#x89D2;&#xFF0C;&#x6240;&#x4EE5;&#x6B64;&#x65F6;&#x52A0;&#x8F7D;&#x7684;Bitmap&#x6570;&#x636E;&#x662F;&#x4E0E;&#x7EB9;&#x7406;&#x8FDB;&#x884C;&#x4E86;&#x4E0A;&#x4E0B;&#x98A0;&#x5012;&#x7684;&#x3002;&#x800C;&#x7EB9;&#x7406;&#x53C8;&#x4E0E;&#x9876;&#x70B9;&#x4E0A;&#x4E0B;&#x98A0;&#x5012;&#xFF0C;&#x8FD9;&#x4E00;&#x6765;&#x4E00;&#x56DE;&#x5C31;&#x521A;&#x597D;&#x62E8;&#x6B63;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x771F;&#x6B63;&#x6E32;&#x67D3;&#x51FA;&#x6765;&#x7684;&#x56FE;&#x7247;&#x5C31;&#x521A;&#x597D;&#x662F;&#x6B63;&#x786E;&#x7684;&#x65B9;&#x5411;&#x3002;</p>\n<p>&#x7EB9;&#x7406;&#x6570;&#x636E;&#x6709;&#x4E86;&#xFF0C;&#x518D;&#x6765;&#x5C06;&#x5176;&#x7ED1;&#x5B9A;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x7EB9;&#x7406;&#x4E0A;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x7ED1;&#x5B9A;&#x7279;&#x5B9A;&#x7D22;&#x5F15;&#x7EB9;&#x7406;</span><br><span class=\"line\">val textureLocation = GLES20.glGetUniformLocation(programId, &quot;u_texture&quot;)</span><br><span class=\"line\">GLES20.glUniform1i(textureLocation, 0)</span><br></pre></td></tr></table></figure>\n<p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684;0&#xFF0C;&#x5C31;&#x662F;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x7EB9;&#x7406;&#x65F6;&#x6307;&#x5B9A;&#x7684;&#x901A;&#x9053;&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x80FD;&#x5C06;&#x5176;&#x7ED1;&#x5B9A;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x7EB9;&#x7406;&#x901A;&#x9053;&#x4E0A;&#x3002;</p>\n<h2 id=\"&#x6E32;&#x67D3;\"><a href=\"#&#x6E32;&#x67D3;\" class=\"headerlink\" title=\"&#x6E32;&#x67D3;\"></a>&#x6E32;&#x67D3;</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x8BBE;&#x7F6E;&#x6E05;&#x5C4F;&#x989C;&#x8272;</span><br><span class=\"line\">GLES20.glClearColor(1.0f, 1.0f, 1.0f, 1.0f)</span><br><span class=\"line\">// &#x6E05;&#x5C4F;&#x5904;&#x7406;</span><br><span class=\"line\">GLES20.glClear(GLES20.GL_COLOR_BUFFER_BIT)</span><br><span class=\"line\">// &#x8BBE;&#x7F6E;&#x89C6;&#x56FE;&#x5927;&#x5C0F;</span><br><span class=\"line\">GLES20.glViewport(0, 0, mSurfaceViewWidth, mSurfaceViewHeight)</span><br><span class=\"line\">// &#x6E32;&#x67D3;</span><br><span class=\"line\">GLES20.glDrawArrays(GLES20.GL_TRIANGLES, 0, mVertexData.size / VERTEX_DIMENSION_SIZE)</span><br></pre></td></tr></table></figure>\n<p>&#x6765;&#x770B;&#x4E0B;&#x6E32;&#x67D3;&#x51FA;&#x6765;&#x7684;&#x6548;&#x679C;</p>\n<div align=\"center\"><br><img src=\"/2022/02/26/Android-OpenGL-ES-&#x7EB9;&#x7406;/result.jpeg\" width=\"375\" height=\"750\"><br></div>\n\n<h2 id=\"&#x4F18;&#x5316;\"><a href=\"#&#x4F18;&#x5316;\" class=\"headerlink\" title=\"&#x4F18;&#x5316;\"></a>&#x4F18;&#x5316;</h2><p>&#x6709;&#x51E0;&#x4E2A;&#x70B9;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x4F18;&#x5316;&#x3002;</p>\n<h3 id=\"&#x51CF;&#x5C11;&#x6570;&#x636E;\"><a href=\"#&#x51CF;&#x5C11;&#x6570;&#x636E;\" class=\"headerlink\" title=\"&#x51CF;&#x5C11;&#x6570;&#x636E;\"></a>&#x51CF;&#x5C11;&#x6570;&#x636E;</h3><p>&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x662F;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x662F;GL_TRIANGLES&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x6E32;&#x67D3;&#xFF0C;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x8FD9;&#x79CD;&#x6E32;&#x67D3;&#x65B9;&#x5F0F;&#x662F;&#x4E0D;&#x4F1A;&#x5171;&#x7528;&#x9876;&#x70B9;&#x7684;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x9876;&#x70B9;&#x6570;&#x91CF;&#x8FC7;&#x591A;&#xFF0C;&#x5360;&#x7528;&#x7684;&#x5185;&#x5B58;&#x8FC7;&#x5927;&#x3002;</p>\n<p>&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x5185;&#x5B58;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;GL_TRIANGLE_STRIP&#x65B9;&#x5F0F;&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x8C03;&#x6574;&#x9876;&#x70B9;&#x4E0E;&#x7EB9;&#x7406;&#x5750;&#x6807;&#x4E86;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x6574;&#x4E2A;&#x89C6;&#x56FE;</span><br><span class=\"line\">// ---&gt;</span><br><span class=\"line\">//  \\</span><br><span class=\"line\">//   \\</span><br><span class=\"line\">// ---&gt;</span><br><span class=\"line\">private val mVertexData = floatArrayOf(</span><br><span class=\"line\">    -1.0f, -1.0f,</span><br><span class=\"line\">    1.0f, -1.0f,</span><br><span class=\"line\">    -1.0f, 1.0f,</span><br><span class=\"line\">    1.0f, 1.0f</span><br><span class=\"line\">)</span><br><span class=\"line\"> </span><br><span class=\"line\">// &#x6574;&#x4E2A;&#x7EB9;&#x7406;</span><br><span class=\"line\">// ---&gt;</span><br><span class=\"line\">//   /</span><br><span class=\"line\">//  /</span><br><span class=\"line\">// ---&gt;</span><br><span class=\"line\">private val mTextureData = floatArrayOf(</span><br><span class=\"line\">    0.0f, 1.0f,</span><br><span class=\"line\">    1.0f, 1.0f,</span><br><span class=\"line\">    0.0f, 0.0f,</span><br><span class=\"line\">    1.0f, 0.0f</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>&#x4E4B;&#x524D;&#x90FD;&#x662F;6&#x4E2A;&#x9876;&#x70B9;&#xFF0C;&#x73B0;&#x5728;&#x5C06;&#x5B83;&#x4EEC;&#x90FD;&#x4FEE;&#x6539;&#x6210;4&#x4E2A;&#x5373;&#x53EF;&#x3002;</p>\n<p>&#x901A;&#x8FC7;GL_TRIANGLE_STRIP&#x7684;&#x7279;&#x6027;&#xFF0C;&#x5408;&#x7406;&#x5B9A;&#x4E49;&#x56DB;&#x4E2A;&#x9876;&#x70B9;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5B8C;&#x5168;&#x8986;&#x76D6;&#x6574;&#x4E2A;&#x5C4F;&#x5E55;&#xFF0C;&#x5373;&#x56DB;&#x4E2A;&#x9876;&#x70B9;&#x7ED8;&#x5236;&#x4E24;&#x4E2A;&#x4E09;&#x89D2;&#x5F62;&#xFF0C;&#x800C;&#x8FD9;&#x4E24;&#x4E2A;&#x4E09;&#x89D2;&#x5F62;&#x521A;&#x597D;&#x80FD;&#x591F;&#x7EC4;&#x5408;&#x6210;&#x5C4F;&#x5E55;&#x7684;&#x5168;&#x90E8;&#x5185;&#x5BB9;&#x3002;</p>\n<p>&#x6CE8;&#x610F;&#x89C6;&#x56FE;&#x4E0E;&#x7EB9;&#x7406;&#x7684;&#x5750;&#x6807;&#x98A0;&#x5012;&#x6027;&#xFF0C;&#x8FD8;&#x6709;&#x7ED8;&#x5236;&#x7684;&#x65B9;&#x5411;&#x6027;&#x3002;</p>\n<p>&#x8FD0;&#x884C;&#x4E4B;&#x540E;&#xFF0C;&#x6548;&#x679C;&#x8FD8;&#x662F;&#x4E00;&#x81F4;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x518D;&#x5C55;&#x793A;&#x4E86;&#x3002;</p>\n<h3 id=\"&#x9632;&#x6B62;&#x53D8;&#x5F62;\"><a href=\"#&#x9632;&#x6B62;&#x53D8;&#x5F62;\" class=\"headerlink\" title=\"&#x9632;&#x6B62;&#x53D8;&#x5F62;\"></a>&#x9632;&#x6B62;&#x53D8;&#x5F62;</h3><p>&#x800C;&#x53E6;&#x4E00;&#x4E2A;&#x662F;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x6548;&#x679C;&#x56FE;&#x7247;&#x53D8;&#x5F62;&#x4E86;&#x3002;</p>\n<p>&#x8FD9;&#x662F;&#x7531;&#x4E8E;&#x539F;&#x56FE;&#x7247;&#x7684;&#x5BBD;&#x9AD8;&#x5C3A;&#x5BF8;&#x6BD4;&#x4F8B;&#x4E0E;&#x5C55;&#x793A;&#x7684;&#x5C4F;&#x5E55;&#x5BBD;&#x9AD8;&#x5C3A;&#x5BF8;&#x6BD4;&#x4F8B;&#x4E0D;&#x4E00;&#x81F4;&#x3002;</p>\n<p>&#x77E5;&#x9053;&#x539F;&#x56E0;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x5C31;&#x6709;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x56FE;&#x7247;&#x7EB9;&#x7406;&#x4E0E;&#x6E32;&#x67D3;&#x7684;&#x5C4F;&#x5E55;&#x8FDB;&#x884C;&#x4E00;&#x4E2A;&#x5BBD;&#x9AD8;&#x7F29;&#x653E;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x80FD;&#x4FDD;&#x8BC1;&#x6E32;&#x67D3;&#x51FA;&#x6765;&#x7684;&#x56FE;&#x7247;&#x80FD;&#x591F;&#x4E0D;&#x53D8;&#x5F62;&#x5C55;&#x793A;&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x4E0E;&#x6211;&#x4EEC;&#x6B63;&#x5E38;&#x4E3A;&#x4E00;&#x4E2A;ImageView&#x8BBE;&#x7F6E;&#x4E0D;&#x53D8;&#x5F62;&#x7684;&#x505A;&#x6CD5;&#x4E00;&#x81F4;&#x3002;&#x53EA;&#x4E0D;&#x8FC7;&#x662F;ImageView&#x5185;&#x90E8;&#x63D0;&#x4F9B;&#x4E86;&#x8BBE;&#x7F6E;ScaleType&#x7684;&#x65B9;&#x5F0F;&#x3002;</p>\n<p>&#x5177;&#x4F53;&#x7684;&#x7F29;&#x653E;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x5C31;&#x4E0D;&#x8D34;&#x6E90;&#x4EE3;&#x7801;&#x4E86;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x53BB;&#x67E5;&#x770B;&#x6E90;&#x7801;&#x3002;</p>\n<p>&#x6211;&#x8FD9;&#x91CC;&#x53EA;&#x8BF4;&#x4E00;&#x4E0B;&#x6700;&#x7EC8;&#x7684;&#x5904;&#x7406;&#x4F4D;&#x7F6E;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x5C06;Bitmap&#x52A0;&#x8F7D;&#x5230;&#x7EB9;&#x7406;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FDB;&#x884C;&#x7EB9;&#x7406;&#x7F29;&#x653E;&#x5904;&#x7406;&#x5373;&#x53EF;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x52A0;&#x8F7D;&#x7EB9;&#x7406;&#x6570;&#x636E;</span><br><span class=\"line\">val textureBuffer = ByteBuffer.allocateDirect(mTextureData.size * Float.SIZE_BYTES)</span><br><span class=\"line\">    .order(ByteOrder.nativeOrder())</span><br><span class=\"line\">    .asFloatBuffer()</span><br><span class=\"line\">// textureBuffer.put(mTextureData)</span><br><span class=\"line\">textureBuffer.put(</span><br><span class=\"line\">    // &#x6839;&#x636E;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x7EB9;&#x7406;&#x7F29;&#x653E;</span><br><span class=\"line\">    Utils.adapterCoordinate(</span><br><span class=\"line\">        mTextureData,</span><br><span class=\"line\">        glSurfaceView.width,</span><br><span class=\"line\">        glSurfaceView.height,</span><br><span class=\"line\">        bitmap.width,</span><br><span class=\"line\">        bitmap.height,</span><br><span class=\"line\">        ScaleType.CENTER_FIT</span><br><span class=\"line\">    )</span><br><span class=\"line\">)</span><br><span class=\"line\">textureBuffer.position(0)</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x5C45;&#x4E2D;&#x7B49;&#x6BD4;&#x7F29;&#x653E;&#xFF0C;&#x518D;&#x6765;&#x770B;&#x4E0B;&#x5904;&#x7406;&#x540E;&#x7684;&#x6548;&#x679C;&#x3002;</p>\n<div align=\"center\"><br><img src=\"/2022/02/26/Android-OpenGL-ES-&#x7EB9;&#x7406;/f_result.jpeg\" width=\"375\" height=\"750\"><br></div>\n\n<p>&#x7EB9;&#x7406;&#x5904;&#x7406;&#x7684;&#x65B9;&#x5F0F;&#x4E5F;&#x5E76;&#x4E0D;&#x96BE;&#xFF0C;&#x76F8;&#x4FE1;&#x4E00;&#x8DEF;&#x8D70;&#x4E0B;&#x6765;&#x7684;&#x540C;&#x5B66;&#x90FD;&#x6709;&#x6240;&#x4F53;&#x4F1A;</p>\n<p>&#x8FD9;&#x4E5F;&#x8FDB;&#x4E00;&#x6B65;&#x8BF4;&#x660E;OpenGL ES&#x4E5F;&#x6CA1;&#x6709;&#x5F88;&#x96BE;&#xFF0C;&#x53EA;&#x662F;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x5BF9;&#x5B83;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x4E0D;&#x719F;&#x6089;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4E0E;&#x6211;&#x4EEC;&#x6B63;&#x5E38;&#x7684;&#x5C55;&#x793A;&#x4E00;&#x5F20;&#x56FE;&#x7247;&#x7684;&#x65B9;&#x5F0F;&#x5B8C;&#x5168;&#x4E0D;&#x540C;&#xFF0C;&#x4F46;&#x660E;&#x767D;&#x5B83;&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x4E5F;&#x662F;&#x6709;&#x89C4;&#x5F8B;&#x53EF;&#x5FAA;&#x7684;&#xFF0C;&#x6BD5;&#x7ADF;&#x5BF9;&#x5E94;&#x7684;API&#x662F;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x592A;&#x591A;&#x7684;&#x5DEE;&#x5F02;&#x7684;&#x3002;&#x4E5F;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x5927;&#x5BB6;&#x5BF9;OpenGL ES&#x6709;&#x4E00;&#x4E2A;&#x5168;&#x9762;&#x7684;&#x4E86;&#x89E3;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x9644;&#x4E0A;&#x6E90;&#x7801;&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/idisfkj/android-api-analysis/tree/feat_opengles_dev\" target=\"_blank\" rel=\"noopener\">OpenGL ES</a></p>\n<h2 id=\"&#x63A8;&#x8350;\"><a href=\"#&#x63A8;&#x8350;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;\"></a>&#x63A8;&#x8350;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["opengl"]},{"title":"Android OpenGL ES 渲染模式","url":"https://www.rousetime.com/2022/02/25/Android-OpenGL-ES-渲染模式/","content":"<h2 id=\"OpenGL-ES-&#x7CFB;&#x5217;\"><a href=\"#OpenGL-ES-&#x7CFB;&#x5217;\" class=\"headerlink\" title=\"OpenGL ES &#x7CFB;&#x5217;\"></a>OpenGL ES &#x7CFB;&#x5217;</h2><p><a href=\"https://www.rousetime.com/2022/02/14/Android-OpenGL-ES-%E5%9F%BA%E7%A1%80%E5%8E%9F%E7%90%86/\">Android OpenGL ES &#x57FA;&#x7840;&#x539F;&#x7406;</a></p>\n<h2 id=\"&#x52A8;&#x6001;&#x8272;&#x503C;\"><a href=\"#&#x52A8;&#x6001;&#x8272;&#x503C;\" class=\"headerlink\" title=\"&#x52A8;&#x6001;&#x8272;&#x503C;\"></a>&#x52A8;&#x6001;&#x8272;&#x503C;</h2><p>&#x5728;&#x8BF4;&#x6E32;&#x67D3;&#x6A21;&#x5F0F;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x7B80;&#x5355;&#x4E86;&#x89E3;&#x4E0B;&#x52A8;&#x6001;&#x8272;&#x503C;&#x7684;&#x586B;&#x5145;&#x65B9;&#x5F0F;&#x3002;</p>\n<p>&#x5728;<a href=\"https://www.rousetime.com/2022/02/14/Android-OpenGL-ES-%E5%9F%BA%E7%A1%80%E5%8E%9F%E7%90%86/\">OpenGL ES &#x57FA;&#x7840;&#x539F;&#x7406;</a>&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x662F;&#x5BF9;&#x9876;&#x70B9;&#x505A;&#x4E86;&#x7B80;&#x5355;&#x7684;&#x586B;&#x5145;&#x8BBE;&#x7F6E;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x5BF9;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;&#x4E2D;&#x7684;&#x989C;&#x8272;&#x505A;&#x81EA;&#x5B9A;&#x4E49;&#x3002;</p>\n<div align=\"center\"><br><img src=\"/2022/02/25/Android-OpenGL-ES-&#x6E32;&#x67D3;&#x6A21;&#x5F0F;/effect.jpeg\" width=\"375\" height=\"750/\"><br></div>\n\n<p>&#x8FD9;&#x662F;&#x73B0;&#x6709;&#x7684;&#x6837;&#x5F0F;&#xFF0C;&#x8272;&#x503C;&#x5728;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;&#x4E2D;&#x662F;&#x4E00;&#x4E2A;&#x5199;&#x6B7B;&#x7684;&#x503C;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5C06;&#x5B83;&#x53D8;&#x4E3A;&#x52A8;&#x6001;&#x8BBE;&#x7F6E;&#x7684;&#x503C;&#xFF0C;&#x5C06;&#x8FD9;&#x4E2A;&#x4E24;&#x4E2A;&#x4E09;&#x89D2;&#x5F62;&#x7684;&#x989C;&#x8272;&#x503C;&#x8BBE;&#x7F6E;&#x4E3A;&#x7EA2;&#x3001;&#x7EFF;&#x3001;&#x84DD;&#x7684;&#x6DF7;&#x5408;&#x8272;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x4E09;&#x89D2;&#x5F62;&#x7684;&#x4E09;&#x4E2A;&#x9876;&#x70B9;&#xFF0C;&#x5206;&#x522B;&#x8BBE;&#x7F6E;&#x7EA2;&#x7EFF;&#x84DD;&#xFF0C;&#x989C;&#x8272;&#x518D;&#x4ECE;&#x9876;&#x70B9;&#x5411;&#x4E2D;&#x95F4;&#x6269;&#x6563;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x662F;&#x5B9E;&#x9645;&#x64CD;&#x4F5C;</p>\n<h3 id=\"&#x4FEE;&#x6539;&#x7740;&#x8272;&#x5668;&#x6E90;&#x7801;\"><a href=\"#&#x4FEE;&#x6539;&#x7740;&#x8272;&#x5668;&#x6E90;&#x7801;\" class=\"headerlink\" title=\"&#x4FEE;&#x6539;&#x7740;&#x8272;&#x5668;&#x6E90;&#x7801;\"></a>&#x4FEE;&#x6539;&#x7740;&#x8272;&#x5668;&#x6E90;&#x7801;</h3><p>&#x8981;&#x52A8;&#x6001;&#x8BBE;&#x7F6E;&#x989C;&#x8272;&#x503C;&#xFF0C;&#x9700;&#x8981;&#x5B9A;&#x4E49;&#x989C;&#x8272;&#x53D8;&#x91CF;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private const val VERTEX_SHADER_SOURCE =</span><br><span class=\"line\">    &quot;attribute vec4 a_Position;\\n&quot; +</span><br><span class=\"line\">            &quot;attribute vec4 a_Color;\\n&quot; +</span><br><span class=\"line\">            &quot;varying vec4 v_Color;\\n&quot; +</span><br><span class=\"line\">            &quot;void main() {\\n&quot; +</span><br><span class=\"line\">            &quot;   v_Color = a_Color;\\n&quot; +</span><br><span class=\"line\">            &quot;   gl_Position = a_Position;\\n&quot; +</span><br><span class=\"line\">            &quot;}&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">private const val FRAGMENT_SHADER_SOURCE =</span><br><span class=\"line\">    &quot;precision mediump float;\\n&quot; +</span><br><span class=\"line\">            &quot;varying vec4 v_Color;\\n&quot; +</span><br><span class=\"line\">            &quot;void main() {\\n&quot; +</span><br><span class=\"line\">            &quot;   gl_FragColor = v_Color;\\n&quot; +</span><br><span class=\"line\">            &quot;}&quot;</span><br></pre></td></tr></table></figure>\n<p>&#x4E4B;&#x524D;&#x7684;a_Position&#x4E0D;&#x52A8;&#xFF0C;&#x65B0;&#x589E;a_Color&#x4E0E;v_Color&#x53D8;&#x91CF;&#xFF0C;&#x6CE8;&#x610F;v_Color&#x88AB;varying&#x58F0;&#x660E;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x80FD;&#x591F;&#x4F20;&#x9012;&#x5230;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;&#x4E2D;&#xFF0C;&#x6700;&#x540E;&#x518D;&#x5C06;&#x5B83;&#x8D4B;&#x503C;&#x7ED9;gl_FragColor</p>\n<h3 id=\"&#x5B9A;&#x4E49;&#x989C;&#x8272;&#x6570;&#x636E;&#x6E90;\"><a href=\"#&#x5B9A;&#x4E49;&#x989C;&#x8272;&#x6570;&#x636E;&#x6E90;\" class=\"headerlink\" title=\"&#x5B9A;&#x4E49;&#x989C;&#x8272;&#x6570;&#x636E;&#x6E90;\"></a>&#x5B9A;&#x4E49;&#x989C;&#x8272;&#x6570;&#x636E;&#x6E90;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private val mColorData = floatArrayOf(</span><br><span class=\"line\">    1.0f, 0.0f, 0.0f, 1.0f,</span><br><span class=\"line\">    0.0f, 1.0f, 0.0f, 1.0f,</span><br><span class=\"line\">    0.0f, 0.0f, 1.0f, 1.0f,</span><br><span class=\"line\">    1.0f, 0.0f, 0.0f, 1.0f,</span><br><span class=\"line\">    0.0f, 1.0f, 0.0f, 1.0f,</span><br><span class=\"line\">    0.0f, 0.0f, 1.0f, 1.0f</span><br><span class=\"line\">)</span><br><span class=\"line\"> </span><br><span class=\"line\">private const val COLOR_DIMENSION_SIZE = 4</span><br></pre></td></tr></table></figure>\n<p>&#x5206;&#x522B;&#x4E3A;&#x4E24;&#x4E2A;&#x4E09;&#x89D2;&#x5F62;&#x7684;&#x516D;&#x4E2A;&#x9876;&#x70B9;&#x8BBE;&#x7F6E;&#x7EA2;&#x7EFF;&#x84DD;&#x8BBE;&#x7F6E;&#xFF0C;&#x989C;&#x8272;&#x7EF4;&#x5EA6;&#x4E3A;4&#xFF0C;&#x4E0D;&#x8981;&#x5FD8;&#x4E86;&#x8FD8;&#x6709;&#x900F;&#x660E;&#x5EA6;&#x3002;</p>\n<h3 id=\"&#x52A0;&#x8F7D;&#x989C;&#x8272;&#x6570;&#x636E;\"><a href=\"#&#x52A0;&#x8F7D;&#x989C;&#x8272;&#x6570;&#x636E;\" class=\"headerlink\" title=\"&#x52A0;&#x8F7D;&#x989C;&#x8272;&#x6570;&#x636E;\"></a>&#x52A0;&#x8F7D;&#x989C;&#x8272;&#x6570;&#x636E;</h3><p>&#x8FD9;&#x4E00;&#x70B9;&#x4E0E;&#x9876;&#x70B9;&#x6570;&#x636E;&#x7684;&#x52A0;&#x8F7D;&#x65B9;&#x5F0F;&#x4E00;&#x6837;&#xFF0C;&#x5BF9;&#x4E8E;GL&#x7A0B;&#x5E8F;&#x6765;&#x8BF4;&#x4ED6;&#x4EEC;&#x53EA;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x800C;&#x53D8;&#x91CF;&#x7684;&#x6570;&#x636E;&#x586B;&#x5145;&#x65B9;&#x5F0F;&#x90FD;&#x662F;&#x4E00;&#x81F4;&#x7684;&#x3002;&#x660E;&#x767D;&#x8FD9;&#x4E00;&#x70B9;&#x5C31;&#x7B80;&#x5355;&#x591A;&#x4E86;&#xFF0C;&#x6309;&#x7167;&#x9876;&#x70B9;&#x6570;&#x636E;&#x586B;&#x5145;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x3002;</p>\n<p>&#x5C06;&#x989C;&#x8272;&#x6570;&#x636E;&#x586B;&#x5145;&#x5230;Buffer&#x4E2D;&#xFF0C;&#x5E76;&#x5C06;&#x7D22;&#x5F15;&#x4F4D;&#x7F6E;&#x79FB;&#x52A8;&#x5230;0&#x4F4D;&#x7F6E;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x52A0;&#x8F7D;&#x989C;&#x8272;&#x6570;&#x636E;</span><br><span class=\"line\">val colorBuffer = ByteBuffer.allocateDirect(mColorData.size * Float.SIZE_BYTES)</span><br><span class=\"line\">    .order(ByteOrder.nativeOrder())</span><br><span class=\"line\">    .asFloatBuffer()</span><br><span class=\"line\">colorBuffer.put(mColorData)</span><br><span class=\"line\">colorBuffer.position(0)</span><br></pre></td></tr></table></figure>\n<p>&#x7EE7;&#x7EED;&#x83B7;&#x53D6;a_Color&#x5728;GL&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x53C2;&#x6570;&#x4F4D;&#x7F6E;&#x7D22;&#x5F15;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x83B7;&#x53D6;&#x5BF9;&#x5E94;color&#x53C2;&#x6570;&#x4F4D;&#x7F6E;</span><br><span class=\"line\">val colorLocation = GLES20.glGetAttribLocation(programId, &quot;a_Color&quot;)</span><br></pre></td></tr></table></figure>\n<p>&#x968F;&#x540E;&#x6FC0;&#x6D3B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x542F;&#x52A8;&#x5BF9;&#x5E94;color&#x53C2;&#x6570;&#x4F4D;&#x7F6E;</span><br><span class=\"line\">GLES20.glEnableVertexAttribArray(colorLocation)</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x586B;&#x5145;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x586B;&#x5145;&#x5BF9;&#x5E94;&#x9876;&#x70B9;&#x5904;color&#x6570;&#x636E;</span><br><span class=\"line\">GLES20.glVertexAttribPointer(colorLocation, COLOR_DIMENSION_SIZE, GLES20.GL_FLOAT, false, 0, colorBuffer)</span><br></pre></td></tr></table></figure>\n<p>&#x518D;&#x8D70;&#x4E00;&#x904D;&#x8FD9;&#x4E9B;&#x6D41;&#x7A0B;&#xFF0C;&#x7406;&#x89E3;&#x8D77;&#x6765;&#x76F8;&#x4FE1;&#x7B80;&#x5355;&#x4E86;&#x8BB8;&#x591A;&#x3002;</p>\n<p>&#x6E32;&#x67D3;&#x90E8;&#x5206;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x8FD9;&#x4E2A;&#x6CA1;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6765;&#x770B;&#x4E0B;&#x8FD0;&#x884C;&#x7684;&#x6548;&#x679C;</p>\n<div align=\"center\"><br><img src=\"/2022/02/25/Android-OpenGL-ES-&#x6E32;&#x67D3;&#x6A21;&#x5F0F;/g_effect.jpeg\" width=\"375\" height=\"750/\"><br></div>\n\n<p>&#x8FBE;&#x5230;&#x9884;&#x671F;&#xFF0C;&#x5927;&#x529F;&#x544A;&#x6210;&#x3002;</p>\n<h2 id=\"&#x6E32;&#x67D3;&#x6A21;&#x5F0F;\"><a href=\"#&#x6E32;&#x67D3;&#x6A21;&#x5F0F;\" class=\"headerlink\" title=\"&#x6E32;&#x67D3;&#x6A21;&#x5F0F;\"></a>&#x6E32;&#x67D3;&#x6A21;&#x5F0F;</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x6E32;&#x67D3;</span><br><span class=\"line\">GLES20.glDrawArrays(GLES20.GL_TRIANGLES, 0, mVertexData.size / VERTEX_DIMENSION_SIZE)</span><br></pre></td></tr></table></figure>\n<p>GL_TRIANGLES&#x662F;&#x4E09;&#x89D2;&#x5F62;&#x6E32;&#x67D3;&#x7684;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x4E00;&#x5171;&#x6709;&#x4E09;&#x79CD;&#x3002;</p>\n<h3 id=\"GL-TRIANGLES\"><a href=\"#GL-TRIANGLES\" class=\"headerlink\" title=\"GL_TRIANGLES\"></a>GL_TRIANGLES</h3><p>&#x4EE5;&#x6BCF;&#x4E09;&#x4E2A;&#x9876;&#x70B9;&#x4E3A;&#x4E09;&#x89D2;&#x5F62;&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x6E32;&#x67D3;&#xFF0C;&#x9876;&#x70B9;&#x4E0D;&#x91CD;&#x590D;&#xFF0C;&#x5373;(v0,v1,v2)&#x3001;(v3,v4,v5)&#x7B49;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x76EE;&#x524D;&#x7528;&#x5230;&#x7684;&#x6E32;&#x67D3;&#x65B9;&#x5F0F;&#x90FD;&#x662F;&#x8FD9;&#x79CD;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;6&#x4E2A;&#x9876;&#x70B9;&#xFF0C;&#x6309;&#x7167;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x6211;&#x4EEC;&#x5C31;&#x4F1A;&#x7ED8;&#x5236;&#x51FA;&#x4E24;&#x4E2A;&#x5B8C;&#x5168;&#x4E0D;&#x4EA4;&#x53C9;&#x7684;&#x4E09;&#x89D2;&#x5F62;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x7684;&#x9876;&#x70B9;&#x5E76;&#x6CA1;&#x6709;&#x4EA4;&#x96C6;&#x3002;</p>\n<h3 id=\"GL-TRIANGLE-STRIP\"><a href=\"#GL-TRIANGLE-STRIP\" class=\"headerlink\" title=\"GL_TRIANGLE_STRIP\"></a>GL_TRIANGLE_STRIP</h3><p>&#x9009;&#x62E9;&#x7ED8;&#x5236;&#x4E09;&#x89D2;&#x5F62;&#x7684;&#x9876;&#x70B9;&#x4E0D;&#x540C;&#xFF0C;&#x9876;&#x70B9;&#x4F1A;&#x91CD;&#x590D;&#x4F7F;&#x7528;&#xFF0C;&#x5373;(v0,v1,v2)&#x3001;(v2,v1,v3)&#x3001;(v2,v3,v4)&#x3001;(v4,v3,v5)</p>\n<p>&#x7B80;&#x5355;&#x7684;&#x6765;&#x770B;&#xFF0C;&#x5C31;&#x662F;&#x5B83;&#x4F1A;&#x590D;&#x7528;&#x4E4B;&#x524D;&#x7684;&#x4E24;&#x4E2A;&#x9876;&#x70B9;&#xFF0C;&#x4F46;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x5B83;&#x7684;&#x7ED8;&#x5236;&#x987A;&#x5E8F;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x7B80;&#x5355;&#x7684;&#x76F4;&#x63A5;&#x6309;&#x7167;&#x76F4;&#x63A5;&#x7684;&#x987A;&#x5E8F;&#x8FDB;&#x884C;&#x590D;&#x7528;&#x3002;</p>\n<p>&#x8FD9;&#x91CC;&#x7684;&#x987A;&#x5E8F;&#x903B;&#x8F91;&#x662F;&#xFF1A;</p>\n<ol>\n<li>&#x5982;&#x679C;&#x5F53;&#x524D;&#x9876;&#x70B9;&#x662F;&#x5076;&#x6570;&#xFF0C;&#x5219;&#x4E3A;(n-2,n-1,n)</li>\n<li>&#x5982;&#x679C;&#x5F53;&#x524D;&#x9876;&#x70B9;&#x662F;&#x5947;&#x6570;&#xFF0C;&#x5219;&#x4E3A;(n-1,n-2,n)</li>\n</ol>\n<p>&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x7ED8;&#x5236;&#x7684;&#x6BCF;&#x4E2A;&#x4E09;&#x89D2;&#x5F62;&#x7684;&#x987A;&#x5E8F;&#x662F;&#x4E00;&#x81F4;&#x7684;&#x3002;</p>\n<div align=\"center\"><br><img src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/f/f8/Triangles_Strip_In_OpenGL.svg/2560px-Triangles_Strip_In_OpenGL.svg.png\" width=\"375\" height=\"750/\"><br></div>\n\n\n<p>&#x90A3;&#x4E48;&#x8FD9;&#x79CD;&#x6E32;&#x67D3;&#x6A21;&#x5F0F;&#x7684;&#x597D;&#x5904;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x76F8;&#x540C;&#x7684;&#x9876;&#x70B9;&#x6570;&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x7ED8;&#x5236;&#x51FA;&#x6765;&#x7684;&#x4E09;&#x89D2;&#x5F62;&#x4E2A;&#x6570;&#x6BD4;GL_TRIANGLES&#x8981;&#x591A;&#x3002;</p>\n<p>&#x5BF9;&#x5E94;&#x7684;&#x6211;&#x4EEC;&#x5C31;&#x80FD;&#x53D1;&#x73B0;&#xFF0C;&#x5982;&#x679C;&#x7ED8;&#x5236;&#x76F8;&#x540C;&#x7684;&#x56FE;&#x5F62;GL_TRIANGLE_STRIP&#x6240;&#x8981;&#x52A0;&#x8F7D;&#x7684;&#x9876;&#x70B9;&#x6570;&#x4F1A;&#x66F4;&#x5C11;&#xFF0C;&#x8FD9;&#x6837;&#x5728;OpenGL&#x7ED8;&#x5236;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x5360;&#x7528;&#x7684;&#x5185;&#x5B58;&#x4E5F;&#x5C31;&#x8D8A;&#x4F4E;&#xFF0C;&#x6240;&#x4EE5;&#x4E5F;&#x5C31;&#x66F4;&#x6709;&#x6548;&#x3002;</p>\n<p>&#x539F;&#x7406;&#x660E;&#x767D;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5C06;&#x4F8B;&#x5B50;&#x4E2D;&#x7684;&#x7ED8;&#x5236;&#x65B9;&#x5F0F;&#x4FEE;&#x6539;&#x6210;GL_TRIANGLE_STRIP&#xFF0C;&#x770B;&#x4E0B;&#x6548;&#x679C;&#x662F;&#x600E;&#x4E48;&#x6837;&#x7684;&#x3002;</p>\n<div align=\"center\"><br><img src=\"/2022/02/25/Android-OpenGL-ES-&#x6E32;&#x67D3;&#x6A21;&#x5F0F;/m_effect.jpeg\" width=\"375\" height=\"750/\"><br></div>\n\n<h3 id=\"GL-TRIANGLE-FAN\"><a href=\"#GL-TRIANGLE-FAN\" class=\"headerlink\" title=\"GL_TRIANGLE_FAN\"></a>GL_TRIANGLE_FAN</h3><p>&#x4EE5;&#x6247;&#x5F62;&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#xFF0C;&#x5B83;&#x4F1A;&#x5171;&#x7528;&#x4E00;&#x4E2A;&#x9876;&#x70B9;&#xFF0C;&#x56F4;&#x7ED5;&#x5B83;&#x8FDB;&#x884C;&#x6247;&#x5F62;&#x7ED8;&#x5236;&#xFF0C;(v0,v1,v2)&#x3001;(v3,v0,v2)&#x3001;(v4,v0,v3)&#x3001;&#xFF08;v5,v0,v4&#xFF09;</p>\n<p>&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x5F88;&#x9002;&#x5408;&#x7528;&#x6765;&#x7ED8;&#x5236;&#x591A;&#x8FB9;&#x5F62;&#xFF0C;&#x4EE5;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;&#x9876;&#x70B9;&#x4E3A;&#x4E2D;&#x5FC3;&#x8FDB;&#x884C;&#x6247;&#x5F62;&#x7ED8;&#x5236;&#x3002;</p>\n<p><img src=\"https://upload.wikimedia.org/wikipedia/commons/5/59/Trianglefan.png\" alt></p>\n<p>&#x6211;&#x4EEC;&#x518D;&#x5C06;&#x4F8B;&#x5B50;&#x4E2D;&#x7684;&#x7ED8;&#x5236;&#x65B9;&#x5F0F;&#x6539;&#x6210;GL_TRIANGLE_FAN&#xFF0C;&#x770B;&#x4E0B;&#x6548;&#x679C;&#x5982;&#x4F55;&#x3002;</p>\n<div align=\"center\"><br><img src=\"/2022/02/25/Android-OpenGL-ES-&#x6E32;&#x67D3;&#x6A21;&#x5F0F;/f_effect.jpeg\" width=\"375\" height=\"750/\"><br></div>\n\n<p>&#x5982;&#x679C;&#x4E0D;&#x592A;&#x660E;&#x767D;&#x7684;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x52A8;&#x624B;&#x753B;&#x4E00;&#x753B;&#xFF0C;&#x539F;&#x7406;&#x5E76;&#x4E0D;&#x96BE;&#x3002;</p>\n<p>&#x540E;&#x9762;&#x6211;&#x4F1A;&#x7EE7;&#x7EED;&#x804A;&#x804A;&#x5BF9;&#x7EB9;&#x7406;&#x65B9;&#x9762;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x656C;&#x8BF7;&#x671F;&#x5F85;&#x3002;</p>\n<p>&#x6E90;&#x7801;&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/idisfkj/android-api-analysis/tree/feat_opengles_dev\" target=\"_blank\" rel=\"noopener\">OpenGL ES</a></p>\n<h2 id=\"&#x63A8;&#x8350;\"><a href=\"#&#x63A8;&#x8350;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;\"></a>&#x63A8;&#x8350;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["opengl"]},{"title":"Android OpenGL ES 基础原理","url":"https://www.rousetime.com/2022/02/14/Android-OpenGL-ES-基础原理/","content":"<p>&#x7531;&#x4E8E;5G&#x7684;&#x53D1;&#x5C55;&#xFF0C;&#x73B0;&#x5728;&#x97F3;&#x89C6;&#x9891;&#x8D8A;&#x6765;&#x8D8A;&#x6D41;&#x884C;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x751F;&#x6D3B;&#x5DF2;&#x7ECF;&#x5B8C;&#x5168;&#x88AB;&#x6296;&#x97F3;&#x3001;&#x89C6;&#x9891;&#x53F7;&#x3001;B&#x7AD9;&#x7B49;&#x89C6;&#x9891;&#x5E94;&#x7528;&#x6240;&#x5305;&#x56F4;&#x3002;&#x4ECE;&#x8FD9;&#x4E00;&#x70B9;&#x4E5F;&#x80FD;&#x770B;&#x5230;&#x97F3;&#x89C6;&#x9891;&#x7684;&#x91CD;&#x8981;&#x6027;&#x3002;</p>\n<p>&#x800C;&#x4F5C;&#x4E3A;&#x4E00;&#x540D;Android&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x662F;&#x65F6;&#x5019;&#x6765;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x5173;&#x4E8E;Android&#x65B9;&#x9762;&#x6E32;&#x67D3;&#x65B9;&#x9762;&#x7684;&#x77E5;&#x8BC6;&#x3002;&#x97F3;&#x89C6;&#x9891;&#x7684;&#x5E94;&#x7528;&#x90FD;&#x79BB;&#x4E0D;&#x5F00;OpenGL ES&#x7684;&#x5904;&#x7406;&#x3002;&#x5BF9;&#x4E8E;&#x89C6;&#x9891;&#x7684;&#x9AD8;&#x6548;&#x6E32;&#x67D3;&#x4E0E;&#x878D;&#x5408;&#x64CD;&#x4F5C;&#x662F;&#x81F3;&#x5173;&#x91CD;&#x8981;&#x7684;&#x3002;</p>\n<p><img src=\"https://github.com/Tencent/vap/raw/master/images/anim1.gif\" alt></p>\n<p>&#x4E0A;&#x9762;&#x7684;&#x8FD9;&#x79CD;&#x52A8;&#x753B;&#x76F8;&#x4FE1;&#x5927;&#x5BB6;&#x90FD;&#x5F88;&#x719F;&#x6089;&#xFF0C;&#x7C7B;&#x4F3C;&#x7684;&#x52A8;&#x753B;&#x5728;&#x5404;&#x5927;&#x76F4;&#x64AD;&#x95F4;&#x90FD;&#x4F1A;&#x51FA;&#x73B0;&#x3002;&#x90A3;&#x4E48;&#x8FD9;&#x70AB;&#x9177;&#x7684;&#x539F;&#x7406;&#x5B9E;&#x73B0;&#x5185;&#x90E8;&#x90FD;&#x79BB;&#x4E0D;&#x5F00;OpenGL ES&#x7684;&#x9AD8;&#x6548;&#x6E32;&#x67D3;&#x4E0E;&#x66F4;&#x9AD8;&#x7EA7;&#x7684;&#x878D;&#x5408;&#x5904;&#x7406;&#x3002;</p>\n<p>&#x591A;&#x7684;&#x5C31;&#x5148;&#x4E0D;&#x8BF4;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5C31;&#x6765;&#x8BA4;&#x8BC6;&#x4E00;&#x4E0B;OpenGL ES&#x3002;</p>\n<h2 id=\"&#x57FA;&#x672C;&#x6982;&#x5FF5;\"><a href=\"#&#x57FA;&#x672C;&#x6982;&#x5FF5;\" class=\"headerlink\" title=\"&#x57FA;&#x672C;&#x6982;&#x5FF5;\"></a>&#x57FA;&#x672C;&#x6982;&#x5FF5;</h2><p>Android&#x53EF;&#x4EE5;&#x901A;&#x8FC7;OpenGL&#x6765;&#x652F;&#x6301;&#x9AD8;&#x6548;&#x7684;2D&#x548C;3D&#x56FE;&#x5F62;&#xFF0C;&#x540C;&#x65F6;OpenGL&#x662F;&#x4E00;&#x79CD;&#x8DE8;&#x5E73;&#x53F0;&#x7684;&#x56FE;&#x5F62;API&#x3002;&#x5176;&#x4E2D;OpenGL ES&#x662F;OpenGL&#x89C4;&#x8303;&#x7684;&#x4E00;&#x79CD;&#x5F62;&#x5F0F;&#xFF0C;&#x9002;&#x7528;&#x4E8E;&#x5D4C;&#x5165;&#x5F0F;&#x8BBE;&#x5907;&#x3002;</p>\n<p>Android&#x652F;&#x6301;&#x591A;&#x79CD;&#x7248;&#x672C;&#x7684;OpenGL ES API&#xFF1A;</p>\n<ol>\n<li>1.0&amp;1.1 Android1.0&#x53CA;&#x4EE5;&#x4E0A;</li>\n<li>2.0 Android2.2&#x53CA;&#x4EE5;&#x4E0A;</li>\n<li>3.0 Android4.3&#x53CA;&#x4EE5;&#x4E0A;</li>\n<li>3.1 Android5.0&#x53CA;&#x4EE5;&#x4E0A;</li>\n</ol>\n<p>&#x6211;&#x4EEC;&#x7684;&#x5185;&#x5BB9;&#x4E3B;&#x8981;&#x662F;&#x57FA;&#x4E8E;OpenGL ES 2.0&#x6765;&#x8FDB;&#x884C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8FDB;&#x884C;&#x4E8C;&#x7EF4;&#x7684;&#x56FE;&#x5F62;&#x6E32;&#x67D3;&#x3002;</p>\n<h3 id=\"&#x5750;&#x6807;\"><a href=\"#&#x5750;&#x6807;\" class=\"headerlink\" title=\"&#x5750;&#x6807;\"></a>&#x5750;&#x6807;</h3><p>&#x5728;Android&#x4E2D;&#x901A;&#x8FC7;Canvas&#x8FDB;&#x884C;&#x7ED8;&#x5236;&#x7684;&#x5750;&#x6807;&#x539F;&#x70B9;&#x662F;&#x5728;&#x5C4F;&#x5E55;&#x7684;&#x5DE6;&#x4E0A;&#x89D2;&#xFF0C;&#x540C;&#x65F6;&#x5B83;&#x7684;&#x5750;&#x6807;&#x8303;&#x56F4;&#x90FD;&#x662F;&#x4EE5;&#x5C4F;&#x5E55;&#x7684;&#x5BBD;&#x9AD8;&#x6765;&#x5B9A;&#x4E49;&#x3002;</p>\n<p>OpenGL ES&#x5219;&#x4E0D;&#x540C;&#xFF0C;&#x5B83;&#x662F;&#x4EE5;&#x7ED8;&#x5236;&#x533A;&#x57DF;&#x7684;&#x4E2D;&#x5FC3;&#x4E3A;&#x539F;&#x70B9;&#xFF0C;&#x540C;&#x65F6;&#x5B83;&#x7684;&#x5750;&#x6807;&#x8303;&#x56F4;&#x662F;-1.0 ~ 1.0&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5B83;&#x7684;&#x5750;&#x6807;&#x90FD;&#x662F;&#x57FA;&#x4E8E;&#x53EF;&#x7ED8;&#x5236;&#x533A;&#x57DF;&#x8FDB;&#x884C;&#x6BD4;&#x4F8B;&#x6362;&#x7B97;&#x3002;&#x5E76;&#x4E0D;&#x662F;&#x771F;&#x6B63;&#x7684;&#x503C;&#x3002;</p>\n<p><img src=\"/2022/02/14/Android-OpenGL-ES-&#x57FA;&#x7840;&#x539F;&#x7406;/coordinate.png\" alt></p>\n<h3 id=\"&#x5F62;&#x72B6;&#x4E0E;&#x65B9;&#x5411;\"><a href=\"#&#x5F62;&#x72B6;&#x4E0E;&#x65B9;&#x5411;\" class=\"headerlink\" title=\"&#x5F62;&#x72B6;&#x4E0E;&#x65B9;&#x5411;\"></a>&#x5F62;&#x72B6;&#x4E0E;&#x65B9;&#x5411;</h3><p>&#x5728;OpenGL ES&#x4E2D;&#xFF0C;&#x7ED8;&#x5236;&#x7684;&#x5F62;&#x72B6;&#x90FD;&#x662F;&#x4EE5;&#x4E09;&#x89D2;&#x5F62;&#x4E3A;&#x57FA;&#x7840;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5B83;&#x5FC5;&#x987B;&#x7531;3&#x4E2A;&#x6216;&#x8005;&#x4EE5;&#x4E0A;&#x7684;&#x70B9;&#x6765;&#x8FDB;&#x884C;&#x7ED8;&#x5236;&#x3002;&#x6240;&#x4EE5;&#x5B83;&#x662F;&#x7531;&#x591A;&#x4E2A;&#x4E09;&#x89D2;&#x5F62;&#x8FDB;&#x884C;&#x7EC4;&#x5408;&#x6210;&#x7279;&#x5B9A;&#x7684;&#x5F62;&#x72B6;&#xFF0C;&#x8FDB;&#x8FC7;&#x4E0D;&#x540C;&#x7A0B;&#x5EA6;&#x7684;&#x4EA4;&#x53C9;&#x4E0E;&#x91CD;&#x53E0;&#x6765;&#x8FBE;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x5F62;&#x72B6;&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#x4EE5;&#x4E8C;&#x7EF4;&#x7A7A;&#x95F4;&#x6765;&#x5B9A;&#x4E49;</p>\n<p><img src=\"/2022/02/14/Android-OpenGL-ES-&#x57FA;&#x7840;&#x539F;&#x7406;/triggle.png\" alt></p>\n<p>&#x540C;&#x65F6;&#x8FD8;&#x5B58;&#x5728;&#x7ED8;&#x5236;&#x987A;&#x5E8F;&#xFF0C;&#x6240;&#x8C13;&#x7684;&#x7ED8;&#x5236;&#x987A;&#x5E8F;&#x4E5F;&#x662F;&#x4EE5;&#x4E09;&#x89D2;&#x5F62;&#x4E3A;&#x57FA;&#x7840;&#xFF0C;&#x901A;&#x8FC7;&#x4E09;&#x89D2;&#x5F62;&#x7684;&#x4E09;&#x4E2A;&#x9876;&#x70B9;&#x8FDB;&#x884C;&#x73AF;&#x7ED5;&#x7ED8;&#x5236;&#x3002;&#x9ED8;&#x8BA4;&#x662F;&#x4EE5;&#x9006;&#x65F6;&#x9488;&#x8FDB;&#x884C;&#x7ED8;&#x5236;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x4E8C;&#x7EF4;&#x56FE;&#x50CF;&#x53EF;&#x80FD;&#x7ED8;&#x5236;&#x987A;&#x5E8F;&#x6CA1;&#x90A3;&#x4E48;&#x91CD;&#x8981;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x4E09;&#x7EF4;&#x56FE;&#x50CF;&#x5C31;&#x5F88;&#x91CD;&#x8981;&#x4E86;&#x3002;&#x4E09;&#x7EF4;&#x56FE;&#x50CF;&#x662F;&#x7531;&#x4E8E;&#x89C6;&#x89D2;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4F1A;&#x5B58;&#x5728;&#x6B63;&#x53CD;&#x9762;&#x7684;&#x5173;&#x7CFB;&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#x4E00;&#x6B3E;3D&#x6E38;&#x620F;&#xFF0C;&#x6E38;&#x620F;&#x4E2D;&#x6709;&#x4E00;&#x8F86;&#x6C7D;&#x8F66;&#xFF0C;&#x6B63;&#x5BF9;&#x6211;&#x4EEC;&#x7684;&#x4E3A;&#x6B63;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x4E0D;&#x5230;&#x7684;&#x4E00;&#x9762;&#x4E3A;&#x53CD;&#x9762;&#xFF0C;&#x867D;&#x7136;&#x53CD;&#x9762;&#x770B;&#x4E0D;&#x5230;&#xFF0C;&#x4F46;OpenGL ES&#x8FD8;&#x662F;&#x4F1A;&#x8FDB;&#x884C;&#x7ED8;&#x5236;&#x3002;&#x4E3A;&#x4E86;&#x5BF9;&#x53CD;&#x9762;&#x4E0D;&#x505A;&#x65E0;&#x7528;&#x7684;&#x7ED8;&#x5236;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;OpenGL&#x7684;&#x9762;&#x5254;&#x9664;&#x64CD;&#x4F5C;&#xFF0C;&#x8BE5;&#x64CD;&#x4F5C;&#x5141;&#x8BB8;&#x6E32;&#x67D3;&#x7BA1;&#x9053;&#x5FFD;&#x7565;&#x5F62;&#x72B6;&#x7684;&#x53CD;&#x9762;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x8282;&#x7EA6;&#x65F6;&#x95F4;&#x4E0E;&#x5185;&#x5B58;&#x5E76;&#x7F29;&#x77ED;&#x5904;&#x7406;&#x5468;&#x671F;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x8FD9;&#x91CC;&#x7684;&#x6B63;&#x9762;&#x5C31;&#x662F;&#x6CBF;&#x9006;&#x65F6;&#x9488;&#x7ED8;&#x5236;&#x7684;&#x9762;&#x3002;</p>\n<h2 id=\"GL&#x7A0B;&#x5E8F;\"><a href=\"#GL&#x7A0B;&#x5E8F;\" class=\"headerlink\" title=\"GL&#x7A0B;&#x5E8F;\"></a>GL&#x7A0B;&#x5E8F;</h2><p>OpenGL ES&#x6E32;&#x67D3;&#x9700;&#x8981;&#x501F;&#x52A9;GL&#x7A0B;&#x5E8F;&#xFF0C;&#x901A;&#x8FC7;&#x521B;&#x5EFA;GL&#x7A0B;&#x5E8F;&#x3001;&#x9876;&#x70B9;&#x4E0E;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;&#x3001;&#x52A0;&#x8F7D;&#x7740;&#x8272;&#x5668;&#x4EE3;&#x7801;&#x3001;&#x7F16;&#x8BD1;&#x4EE3;&#x7801;&#x3001;&#x5E94;&#x7528;&#x3001;&#x6570;&#x636E;&#x586B;&#x5145;&#xFF0C;&#x6700;&#x7EC8;&#x8FDB;&#x884C;&#x6E32;&#x67D3;&#x3002;</p>\n<p>&#x5728;&#x521B;&#x5EFA;GL&#x7A0B;&#x5E8F;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x4E86;&#x89E3;&#x9876;&#x70B9;&#x7740;&#x8272;&#x5668;&#x4E0E;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;&#x3002;</p>\n<h3 id=\"&#x7740;&#x8272;&#x5668;&#x6E90;&#x7801;\"><a href=\"#&#x7740;&#x8272;&#x5668;&#x6E90;&#x7801;\" class=\"headerlink\" title=\"&#x7740;&#x8272;&#x5668;&#x6E90;&#x7801;\"></a>&#x7740;&#x8272;&#x5668;&#x6E90;&#x7801;</h3><p>GL&#x7A0B;&#x5E8F;&#x6E32;&#x67D3;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x9700;&#x8981;&#x786E;&#x8BA4;&#x9876;&#x70B9;&#x4F4D;&#x7F6E;&#x4E0E;&#x5BF9;&#x5E94;&#x7684;&#x989C;&#x8272;&#xFF0C;&#x800C;&#x8FD9;&#x4E24;&#x4E2A;&#x90E8;&#x5206;&#x5206;&#x522B;&#x501F;&#x52A9;&#x4E8E;&#x9876;&#x70B9;&#x4E0E;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;&#x6765;&#x5B9E;&#x73B0;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x9876;&#x70B9;</span><br><span class=\"line\">private const val VERTEX_SHADER_SOURCE =</span><br><span class=\"line\">    &quot;attribute vec4 a_Position;\\n&quot; +</span><br><span class=\"line\">            &quot;void main() {\\n&quot; +</span><br><span class=\"line\">            &quot;   gl_Position = a_Position;\\n&quot; +</span><br><span class=\"line\">            &quot;}&quot;</span><br><span class=\"line\">// &#x7247;&#x6BB5;</span><br><span class=\"line\">private const val FRAGMENT_SHADER_SOURCE =</span><br><span class=\"line\">    &quot;precision mediump float;\\n&quot; +</span><br><span class=\"line\">            &quot;void main() {\\n&quot; +</span><br><span class=\"line\">            &quot;   gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\\n&quot; +</span><br><span class=\"line\">            &quot;}&quot;</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x5206;&#x522B;&#x662F;&#x9876;&#x70B9;&#x7740;&#x8272;&#x5668;&#x4E0E;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;&#x7684;&#x6E90;&#x7801;&#x3002;attribute&#x662F;&#x53D8;&#x91CF;&#x4FEE;&#x9970;&#x7B26;&#xFF0C;&#x7528;&#x7684;&#x6BD4;&#x8F83;&#x591A;&#x7684;&#x662F;&#x4EE5;&#x4E0B;&#x4E09;&#x79CD;&#x3002;</p>\n<ol>\n<li>attribute:&#x8868;&#x793A;&#x53EA;&#x8BFB;&#x7684;&#x9876;&#x70B9;&#x6570;&#x636E;&#xFF0C;&#x5E94;&#x7528;&#x5728;&#x9876;&#x70B9;&#x7740;&#x8272;&#x5668;&#x4E2D;&#x3002;&#x53EF;&#x4FEE;&#x9970;&#x58F0;&#x660E;&#x9876;&#x70B9;&#x3001;&#x989C;&#x8272;&#x7B49;&#x6570;&#x636E;</li>\n<li>uniform:&#x9876;&#x70B9;&#x7740;&#x8272;&#x5668;&#x4E0E;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;&#x7684;&#x5171;&#x4EAB;&#x6570;&#x636E;&#xFF0C;&#x5728;&#x7A0B;&#x5E8F;&#x4E2D;&#x503C;&#x7684;&#x4E0D;&#x53D8;&#x7684;&#xFF0C;&#x521D;&#x59CB;&#x503C;&#x7531;&#x7A0B;&#x5E8F;&#x5916;&#x90E8;&#x4F20;&#x5165;</li>\n<li>varying:&#x9876;&#x70B9;&#x7740;&#x8272;&#x5668;&#x8F93;&#x5165;&#xFF0C;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;&#x8F93;&#x51FA;&#xFF1B;&#x7531;&#x9876;&#x70B9;&#x7740;&#x8272;&#x5668;&#x4F20;&#x8F93;&#x7ED9;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;&#x4E2D;&#x7684;&#x63D2;&#x503C;&#x6570;&#x636E;</li>\n</ol>\n<p>vec4&#x662F;&#x53D8;&#x91CF;&#x7C7B;&#x578B;&#xFF0C;&#x53D8;&#x91CF;&#x4E3B;&#x8981;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;</p>\n<p><img src=\"/2022/02/14/Android-OpenGL-ES-&#x57FA;&#x7840;&#x539F;&#x7406;/1.jpg\" alt></p>\n<p>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#x8FD8;&#x6709;&#x6570;&#x7EC4;&#x4E0E;&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x7528;&#x6765;&#x5B9E;&#x73B0;&#x590D;&#x6742;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x5C06;&#x5B9A;&#x4E49;&#x7684;a_Position&#x8D4B;&#x503C;&#x7ED9;gl_Position&#xFF0C;&#x8FD9;&#x6837;GL&#x7A0B;&#x5E8F;&#x5C31;&#x4F1A;&#x4F7F;&#x7528;&#x5B9A;&#x4E49;&#x7684;&#x9876;&#x70B9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x6E32;&#x67D3;&#x3002;</p>\n<p>&#x540C;&#x7406;gl_FragColor&#x4E5F;&#x662F;&#x4E00;&#x6837;&#xFF0C;&#x4EE3;&#x8868;&#x5BF9;&#x5E94;&#x6E32;&#x67D3;&#x9876;&#x70B9;&#x4F4D;&#x7F6E;&#x65F6;&#x7684;&#x989C;&#x8272;&#xFF0C;&#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x5199;&#x6B7B;&#x4E86;&#x4E00;&#x4E2A;&#x84DD;&#x8272;&#x3002;</p>\n<h3 id=\"&#x521B;&#x5EFA;GL&#x7A0B;&#x5E8F;\"><a href=\"#&#x521B;&#x5EFA;GL&#x7A0B;&#x5E8F;\" class=\"headerlink\" title=\"&#x521B;&#x5EFA;GL&#x7A0B;&#x5E8F;\"></a>&#x521B;&#x5EFA;GL&#x7A0B;&#x5E8F;</h3><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x8981;&#x521B;&#x5EFA;GL&#x7A0B;&#x5E8F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x521B;&#x5EFA;GL&#x7A0B;&#x5E8F;</span><br><span class=\"line\">val programId = GLES20.glCreateProgram()</span><br></pre></td></tr></table></figure>\n<p>&#x62FF;&#x5230;programId&#xFF0C;&#x4E3A;&#x4E4B;&#x540E;&#x7684;&#x7A0B;&#x5E8F;&#x64CD;&#x4F5C;&#x505A;&#x51C6;&#x5907;</p>\n<h3 id=\"&#x6DFB;&#x52A0;&#x9876;&#x70B9;&#x4E0E;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;\"><a href=\"#&#x6DFB;&#x52A0;&#x9876;&#x70B9;&#x4E0E;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;\" class=\"headerlink\" title=\"&#x6DFB;&#x52A0;&#x9876;&#x70B9;&#x4E0E;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;\"></a>&#x6DFB;&#x52A0;&#x9876;&#x70B9;&#x4E0E;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;</h3><p>&#x9996;&#x5148;&#x521B;&#x5EFA;&#x9876;&#x70B9;&#x4E0E;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x521B;&#x5EFA;&#x9876;&#x70B9;&#x4E0E;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;</span><br><span class=\"line\">val vertexShader = GLES20.glCreateShader(GLES20.GL_VERTEX_SHADER)</span><br><span class=\"line\">val fragmentShader = GLES20.glCreateShader(GLES20.GL_FRAGMENT_SHADER)</span><br></pre></td></tr></table></figure>\n<p>&#x5C06;&#x4E4B;&#x524D;&#x5B9A;&#x4E49;&#x7684;&#x7740;&#x8272;&#x5668;&#x6E90;&#x7801;&#x52A0;&#x8F7D;&#x5230;&#x7740;&#x8272;&#x5668;&#x4E2D;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x52A0;&#x8F7D;&#x9876;&#x70B9;&#x4E0E;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;&#x4EE3;&#x7801;</span><br><span class=\"line\">GLES20.glShaderSource(vertexShader, VERTEX_SHADER_SOURCE)</span><br><span class=\"line\">GLES20.glShaderSource(fragmentShader, FRAGMENT_SHADER_SOURCE)</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;GL&#x7A0B;&#x5E8F;&#x8FDB;&#x884C;&#x7F16;&#x8BD1;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x7F16;&#x8BD1;&#x9876;&#x70B9;&#x4E0E;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;&#x4EE3;&#x7801;</span><br><span class=\"line\">GLES20.glCompileShader(vertexShader)</span><br><span class=\"line\">GLES20.glCompileShader(fragmentShader)</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x5C06;&#x7F16;&#x8BD1;&#x5B8C;&#x7684;&#x9876;&#x70B9;&#x4E0E;&#x7247;&#x6BB5;&#x7740;&#x8272;&#x5668;&#x6DFB;&#x52A0;&#x5230;&#x6307;&#x5B9A;&#x7684;GL&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x7B2C;&#x4E00;&#x6B65;&#x521B;&#x5EFA;&#x7684;GL&#x7A0B;&#x5E8F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x6DFB;&#x52A0;&#x5230;GL&#x7A0B;&#x5E8F;&#x4E2D;</span><br><span class=\"line\">GLES20.glAttachShader(programId, vertexShader)</span><br><span class=\"line\">GLES20.glAttachShader(programId, fragmentShader)</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x94FE;&#x63A5;&#x4E0E;&#x5E94;&#x7528;\"><a href=\"#&#x94FE;&#x63A5;&#x4E0E;&#x5E94;&#x7528;\" class=\"headerlink\" title=\"&#x94FE;&#x63A5;&#x4E0E;&#x5E94;&#x7528;\"></a>&#x94FE;&#x63A5;&#x4E0E;&#x5E94;&#x7528;</h3><p>&#x7740;&#x8272;&#x5668;&#x88C5;&#x8F7D;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#xFF0C;&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F;&#x5C06;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x7684;GL&#x7A0B;&#x5E8F;&#x8FDB;&#x884C;&#x94FE;&#x63A5;&#x4E0E;&#x5E94;&#x7528;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x94FE;&#x63A5;GL&#x7A0B;&#x5E8F;</span><br><span class=\"line\">GLES20.glLinkProgram(programId)</span><br><span class=\"line\">// &#x5E94;&#x7528;GL&#x7A0B;&#x5E8F;</span><br><span class=\"line\">GLES20.glUseProgram(programId)</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x7684;GL&#x7A0B;&#x5E8F;&#x624D;&#x7B97;&#x771F;&#x6B63;&#x7684;&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x5C31;&#x662F;&#x6570;&#x636E;&#x7684;&#x586B;&#x5145;&#x4E0E;&#x6E32;&#x67D3;&#x64CD;&#x4F5C;&#x3002;</p>\n<h2 id=\"&#x6570;&#x636E;&#x586B;&#x5145;\"><a href=\"#&#x6570;&#x636E;&#x586B;&#x5145;\" class=\"headerlink\" title=\"&#x6570;&#x636E;&#x586B;&#x5145;\"></a>&#x6570;&#x636E;&#x586B;&#x5145;</h2><p>&#x5728;&#x9876;&#x70B9;&#x7740;&#x8272;&#x5668;&#x6E90;&#x7801;&#x5B9A;&#x4E49;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E86;a_Position&#x53D8;&#x91CF;&#xFF0C;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x4ECE;&#x5916;&#x90E8;&#x5C06;&#x6570;&#x636E;&#x6DFB;&#x52A0;&#x5230;a_Position&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x80FD;&#x771F;&#x6B63;&#x5E94;&#x7528;&#x5230;gl_Position&#x4E2D;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x7684;&#x586B;&#x5145;</p>\n<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x586B;&#x5145;&#x7684;&#x9876;&#x70B9;&#x6570;&#x636E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private val mVertexData = floatArrayOf(0.0f, 0.5f, -0.5f, -0.5f, 0.5f, -0.5f, -0.5f, 1.0f, -1.0f, 0.5f, 0f, 0.5f)</span><br><span class=\"line\"> </span><br><span class=\"line\">private const val VERTEX_DIMENSION_SIZE = 2</span><br></pre></td></tr></table></figure>\n<p>&#x9876;&#x70B9;&#x7EF4;&#x5EA6;&#x662F;&#x4E8C;&#x7EF4;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;mVertexData&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;6&#x4E2A;&#x9876;&#x70B9;&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;2&#x4E2A;&#x4E09;&#x89D2;&#x5F62;&#x7684;&#x6570;&#x636E;&#x3002;&#x7B2C;&#x4E00;&#x4E2A;&#x5728;&#x5DE6;&#x4E0A;&#x89D2;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x5728;&#x4E2D;&#x95F4;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x5C06;&#x6570;&#x636E;&#x6DFB;&#x52A0;&#x5230;Buffer&#x4E2D;&#xFF0C;&#x5E76;&#x5C06;&#x7D22;&#x5F15;&#x4F4D;&#x7F6E;&#x5B9A;&#x4E49;&#x5230;&#x5F00;&#x59CB;&#x4F4D;&#x7F6E;0</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x52A0;&#x8F7D;&#x9876;&#x70B9;&#x6570;&#x636E;</span><br><span class=\"line\">val vertexBuffer = ByteBuffer.allocateDirect(mVertexData.size * Float.SIZE_BYTES)</span><br><span class=\"line\">    .order(ByteOrder.nativeOrder())</span><br><span class=\"line\">    .asFloatBuffer()</span><br><span class=\"line\">vertexBuffer.put(mVertexData)</span><br><span class=\"line\">vertexBuffer.position(0)</span><br></pre></td></tr></table></figure>\n<p>&#x7EE7;&#x7EED;&#x83B7;&#x53D6;a_Position&#x5728;GL&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x53C2;&#x6570;&#x4F4D;&#x7F6E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x53C2;&#x6570;&#x4F4D;&#x7F6E;</span><br><span class=\"line\">val positionLocation = GLES20.glGetAttribLocation(programId, &quot;a_Position&quot;)</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E00;&#x70B9;&#x4E0E;&#x6211;&#x4EEC;&#x5E73;&#x5E38;&#x7684;&#x7F16;&#x7A0B;&#x4E0D;&#x540C;&#xFF0C;&#x5728;GL&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x83B7;&#x53D6;&#x5176;&#x4E2D;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x662F;&#x76F4;&#x63A5;&#x62FF;&#x5230;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x672C;&#x8EAB;&#xFF0C;&#x800C;&#x662F;&#x901A;&#x8FC7;&#x62FF;&#x5230;&#x5B83;&#x5728;GL&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x4F4D;&#x7F6E;&#x7D22;&#x5F15;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x4F4D;&#x7F6E;&#x7D22;&#x5F15;&#x8FDB;&#x884C;&#x53D8;&#x91CF;&#x64CD;&#x4F5C;&#x3002;</p>\n<p>&#x83B7;&#x53D6;&#x4E4B;&#x540E;&#x8FD8;&#x8981;&#x8FDB;&#x884C;&#x542F;&#x52A8;&#x6FC0;&#x6D3B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x542F;&#x52A8;&#x5BF9;&#x5E94;&#x53C2;&#x6570;&#x4F4D;&#x7F6E;</span><br><span class=\"line\">GLES20.glEnableVertexAttribArray(positionLocation)</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x5C31;&#x662F;&#x586B;&#x5145;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x586B;&#x5145;&#x9876;&#x70B9;&#x6570;&#x636E;</span><br><span class=\"line\">GLES20.glVertexAttribPointer(positionLocation, VERTEX_DIMENSION_SIZE, GLES20.GL_FLOAT, false, 0, vertexBuffer)</span><br></pre></td></tr></table></figure>\n<p>VERTEX_DIMENSION_SIZE&#x4EE3;&#x8868;&#x7684;&#x662F;&#x586B;&#x5145;&#x4E00;&#x4E2A;&#x4E8C;&#x7EF4;&#x7684;&#x9876;&#x70B9;&#x6570;&#x636E;&#xFF0C;&#x7C7B;&#x578B;&#x4E3A;GLES20.GL_FLOAT&#x3002;</p>\n<h2 id=\"&#x6E32;&#x67D3;\"><a href=\"#&#x6E32;&#x67D3;\" class=\"headerlink\" title=\"&#x6E32;&#x67D3;\"></a>&#x6E32;&#x67D3;</h2><p>GL&#x7A0B;&#x5E8F;&#x4E0E;&#x9876;&#x70B9;&#x6570;&#x636E;&#x90FD;&#x5DF2;&#x7ECF;&#x51C6;&#x5907;&#x5B8C;&#x6BD5;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x662F;&#x6700;&#x540E;&#x4E00;&#x6B65;&#x6E32;&#x67D3;&#x3002;</p>\n<p>&#x5728;&#x6E32;&#x67D3;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5BF9;&#x5C4F;&#x5E55;&#x8FDB;&#x884C;&#x6E05;&#x5C4F;&#x64CD;&#x4F5C;&#xFF0C;&#x9ED8;&#x8BA4;&#x5C4F;&#x5E55;&#x662F;&#x9ED1;&#x8272;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x9700;&#x8981;&#x7684;&#x6E05;&#x5C4F;&#x540E;&#x7684;&#x989C;&#x8272;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x8BBE;&#x7F6E;&#x6E05;&#x5C4F;&#x989C;&#x8272;</span><br><span class=\"line\">GLES20.glClearColor(1.0f, 1.0f, 1.0f, 1.0f)</span><br><span class=\"line\">// &#x6E05;&#x5C4F;&#x5904;&#x7406;</span><br><span class=\"line\">GLES20.glClear(GLES20.GL_COLOR_BUFFER_BIT)</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x6307;&#x5B9A;&#x6E05;&#x5C4F;&#x989C;&#x8272;&#x4E3A;&#x767D;&#x8272;</p>\n<p>&#x5728;&#x6E32;&#x67D3;&#x4E4B;&#x524D;&#x8BBE;&#x7F6E;&#x6E32;&#x67D3;&#x7684;&#x89C6;&#x56FE;&#x4F4D;&#x7F6E;&#x4E0E;&#x5927;&#x5C0F;&#xFF0C;&#x6700;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x6E32;&#x67D3;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x8BBE;&#x7F6E;&#x89C6;&#x56FE;&#x5927;&#x5C0F;</span><br><span class=\"line\">GLES20.glViewport(0, 0, mSurfaceViewWidth, mSurfaceViewHeight)</span><br><span class=\"line\">// &#x6E32;&#x67D3;</span><br><span class=\"line\">GLES20.glDrawArrays(GLES20.GL_TRIANGLES, 0, mVertexData.size / VERTEX_DIMENSION_SIZE)</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x6E32;&#x67D3;&#x64CD;&#x4F5C;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;GLES20.GL_TRIANGLES&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x6E32;&#x67D3;&#x65B9;&#x5F0F;&#xFF0C;&#x5B83;&#x4EE3;&#x8868;&#x4F1A;&#x4EE5;&#x6BCF;3&#x4E2A;&#x9876;&#x70B9;&#x4E3A;&#x4E00;&#x7EC4;&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x4E09;&#x89D2;&#x5F62;&#x6E32;&#x67D3;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8FD0;&#x884C;&#x4E4B;&#x540E;&#x5C31;&#x80FD;&#x770B;&#x5230;2&#x4E2A;&#x4E09;&#x89D2;&#x5F62;&#x3002;</p>\n<p>&#x53C2;&#x6570;0&#x4E0E;mVertexData.size / VERTEX_DIMENSION_SIZE&#x4EE3;&#x8868;&#x6709;6&#x4E2A;&#x9876;&#x70B9;&#x4E14;&#x4ECE;&#x7B2C;0&#x4E2A;&#x4F4D;&#x7F6E;&#x5F00;&#x59CB;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x7B2C;&#x4E00;&#x4E2A;&#x9876;&#x70B9;&#x4F4D;&#x7F6E;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x4E0B;&#x8FD0;&#x884C;&#x540E;&#x7684;&#x6548;&#x679C;</p>\n<div align=\"center\"><br><img src=\"/2022/02/14/Android-OpenGL-ES-&#x57FA;&#x7840;&#x539F;&#x7406;/effect.jpeg\" width=\"350\" height=\"680/\"><br></div>\n\n<p>&#x5927;&#x529F;&#x544A;&#x6210;&#xFF0C;&#x4E0E;&#x6211;&#x4EEC;&#x7684;&#x9884;&#x671F;&#x5B8C;&#x5168;&#x4E00;&#x6837;&#x3002;</p>\n<p>&#x540E;&#x7EED;&#x4F1A;&#x7EE7;&#x7EED;&#x804A;&#x804A;&#x989C;&#x8272;&#x7684;&#x52A8;&#x6001;&#x586B;&#x5145;&#x3001;&#x6E32;&#x67D3;&#x7684;&#x4E09;&#x79CD;&#x65B9;&#x5F0F;&#x4E0E;&#x7EB9;&#x7406;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x656C;&#x8BF7;&#x671F;&#x5F85;&#x3002;</p>\n<p>&#x6E90;&#x7801;&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/idisfkj/android-api-analysis/tree/feat_opengles_dev\" target=\"_blank\" rel=\"noopener\">OpenGL ES</a></p>\n<h2 id=\"&#x63A8;&#x8350;\"><a href=\"#&#x63A8;&#x8350;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;\"></a>&#x63A8;&#x8350;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["opengl"]},{"title":"为了能够摸鱼，我走上了歧路","url":"https://www.rousetime.com/2021/05/28/为了能够摸鱼，我走上了歧路/","content":"<h2 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h2><p>&#x6BCF;&#x5929;&#x90FD;&#x662F;&#x91CD;&#x590D;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4E0D;&#x884C;&#xFF0C;&#x5DF2;&#x7ECF;&#x4E25;&#x91CD;&#x5F71;&#x54CD;&#x6211;&#x7684;&#x65E5;&#x5E38;&#x6478;&#x9C7C;&#xFF0C;&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x81EA;&#x5DF1;&#x65E5;&#x5E38;&#x7684;&#x5F00;&#x53D1;&#x65F6;&#x95F4;&#xFF0C;&#x6211;&#x51B3;&#x5B9A;&#x8D70;&#x4E00;&#x6761;&#x6B67;&#x8DEF;&#xFF0C;&#x94E4;&#x800C;&#x8D70;&#x9669;&#xFF0C;&#x5C06;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x5404;&#x79CD;&#x624B;&#x52A8;&#x57CB;&#x70B9;&#x7EDF;&#x8BA1;&#x66FF;&#x6362;&#x6210;&#x81EA;&#x52A8;&#x5316;&#x57CB;&#x70B9;&#x3002;&#x4EE5;&#x540E;&#x518D;&#x4E5F;&#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#x6CA1;&#x65F6;&#x95F4;&#x6478;&#x9C7C;&#x4E86;~</p>\n<p>&#x4F5C;&#x4E3A;Android&#x5C4A;&#x5F00;&#x53D1;&#x7684;&#x4E00;&#x5458;&#xFF0C;&#x4ECA;&#x5929;&#x6211;&#x51B3;&#x5B9A;&#x5C06;&#x6478;&#x9C7C;&#x65B9;&#x6848;&#x5206;&#x4EAB;&#x7ED9;&#x5927;&#x5BB6;&#xFF0C;&#x5E0C;&#x671B;&#x66F4;&#x591A;&#x7684;&#x5E7F;&#x5927;&#x7FA4;&#x4F17;&#x80FD;&#x591F;&#x7684;&#x52A0;&#x5165;&#x5230;&#x6478;&#x9C7C;&#x7684;&#x884C;&#x5217;&#x4E2D;~</p>\n<p>&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x7406;&#x89E3;&#x4E0E;&#x7B80;&#x5316;&#x5B9E;&#x73B0;&#x6B65;&#x9AA4;&#xFF0C;&#x6211;&#x5C06;&#x4F1A;&#x7ED3;&#x5408;<a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484600&amp;idx=1&amp;sn=d0b0546d81aa28ba82d65f3451a01595&amp;chksm=e8e0fd28df97743ef4e998d2ceda9d4358360c398c4d090827cfda165dadf8369ed20580e473&amp;token=1002670919&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x5206;&#x6790;&#x4E0E;&#x4EFF;Retrofit&#x5B9E;&#x8DF5;</a>&#x4E2D;&#x57CB;&#x70B9;Demo&#x6765;&#x8FDB;&#x884C;&#x62C6;&#x89E3;&#xFF0C;&#x6BD5;&#x7ADF;&#x5B9E;&#x9645;&#x9879;&#x76EE;&#x6BD4;&#x8FD9;&#x8981;&#x590D;&#x6742;&#xFF0C;&#x901A;&#x8FC7;&#x7B80;&#x5355;&#x7684;Demo&#x6765;&#x4E86;&#x89E3;&#x6838;&#x5FC3;&#x70B9;&#x5373;&#x53EF;&#x3002;</p>\n<p>&#x5728;&#x771F;&#x6B63;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x6CE8;&#x5165;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x6B63;&#x5E38;&#x624B;&#x52A8;&#x6253;&#x70B9;&#x7684;&#x6B65;&#x9AA4;.</p>\n<p>&#x5728;<a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484600&amp;idx=1&amp;sn=d0b0546d81aa28ba82d65f3451a01595&amp;chksm=e8e0fd28df97743ef4e998d2ceda9d4358360c398c4d090827cfda165dadf8369ed20580e473&amp;token=1002670919&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x5206;&#x6790;&#x4E0E;&#x4EFF;Retrofit&#x5B9E;&#x8DF5;</a>&#x4E2D;&#x5DF2;&#x7ECF;&#x5C06;&#x6253;&#x70B9;&#x7684;&#x6B65;&#x9AA4;&#x8FDB;&#x884C;&#x4E86;&#x7B80;&#x5316;&#x3002;</p>\n<blockquote>\n<p>&#x6CA1;&#x770B;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x6587;&#x7AE0;&#x4E5F;&#x4E0D;&#x5F71;&#x54CD;&#x63A5;&#x4E0B;&#x7684;&#x9605;&#x8BFB;</p>\n</blockquote>\n<ol>\n<li>&#x58F0;&#x660E;&#x6253;&#x70B9;&#x7684;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface StatisticService {</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Scan(ProxyActivity.PAGE_NAME)</span><br><span class=\"line\">    fun buttonScan(@Content(StatisticTrack.Parameter.NAME) name: String)</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Click(ProxyActivity.PAGE_NAME)</span><br><span class=\"line\">    fun buttonClick(@Content(StatisticTrack.Parameter.NAME) name: String, @Content(StatisticTrack.Parameter.TIME) clickTime: Long)</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Scan(ProxyActivity.PAGE_NAME)</span><br><span class=\"line\">    fun textScan(@Content(StatisticTrack.Parameter.NAME) name: String)</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Click(ProxyActivity.PAGE_NAME)</span><br><span class=\"line\">    fun textClick(@Content(StatisticTrack.Parameter.NAME) name: String, @Content(StatisticTrack.Parameter.TIME) clickTime: Long)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<ol>\n<li>&#x901A;&#x8FC7;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x83B7;&#x53D6;StatisticService&#x63A5;&#x53E3;&#x5F15;&#x7528;</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private val mStatisticService = Statistic.instance.create(StatisticService::class.java)</span><br></pre></td></tr></table></figure>\n<ol>\n<li>&#x5728;&#x5408;&#x9002;&#x7684;&#x57CB;&#x70B9;&#x4F4D;&#x7F6E;&#x8FDB;&#x884C;&#x57CB;&#x70B9;&#x7EDF;&#x8BA1;&#xFF0C;&#x4F8B;&#x5982;Click&#x57CB;&#x70B9;</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun onClick(view: View) {</span><br><span class=\"line\">    if (view.id == R.id.button) {</span><br><span class=\"line\">        mStatisticService.buttonClick(BUTTON, System.currentTimeMillis() / 1000)</span><br><span class=\"line\">    } else if (view.id == R.id.text) {</span><br><span class=\"line\">        mStatisticService.textClick(TEXT, System.currentTimeMillis() / 1000)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;2&#x3001;3&#x6B65;&#x9AA4;&#x90FD;&#x662F;&#x5728;&#x5BF9;&#x5E94;&#x57CB;&#x70B9;&#x7684;&#x7C7B;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x8FD9;&#x91CC;&#x5BF9;&#x5E94;&#x7684;&#x662F;ProxyActivity</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ProxyActivity : AppCompatActivity() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x6B65;&#x9AA4;2</span><br><span class=\"line\">    private val mStatisticService = Statistic.instance.create(StatisticService::class.java)</span><br><span class=\"line\"> </span><br><span class=\"line\">    companion object {</span><br><span class=\"line\">        private const val BUTTON = &quot;statistic_button&quot;</span><br><span class=\"line\">        private const val TEXT = &quot;statistic_text&quot;</span><br><span class=\"line\">        const val PAGE_NAME = &quot;ProxyActivity&quot;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) {</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        val extraData = getExtraData()</span><br><span class=\"line\">        setContentView(extraData.layoutId)</span><br><span class=\"line\">        title = extraData.title</span><br><span class=\"line\"> </span><br><span class=\"line\">        // &#x6B65;&#x9AA4;3 =&gt; &#x66DD;&#x5149;&#x70B9;</span><br><span class=\"line\">        mStatisticService.buttonScan(BUTTON)</span><br><span class=\"line\">        mStatisticService.textScan(TEXT)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    private fun getExtraData(): MainModel =</span><br><span class=\"line\">            intent?.extras?.getParcelable(ActivityUtils.EXTRA_DATA)</span><br><span class=\"line\">                    ?: throw NullPointerException(&quot;intent or extras is null&quot;)</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x6B65;&#x9AA4;3 =&gt; &#x70B9;&#x51FB;&#x70B9;</span><br><span class=\"line\">    fun onClick(view: View) {</span><br><span class=\"line\">        if (view.id == R.id.button) {</span><br><span class=\"line\">            mStatisticService.buttonClick(BUTTON, System.currentTimeMillis() / 1000)</span><br><span class=\"line\">        } else if (view.id == R.id.text) {</span><br><span class=\"line\">            mStatisticService.textClick(TEXT, System.currentTimeMillis() / 1000)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6B65;&#x9AA4;1&#x662F;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x7C7B;&#xFF0C;&#x4E0D;&#x5728;&#x4EE3;&#x7801;&#x6CE8;&#x5165;&#x7684;&#x8303;&#x56F4;&#x4E4B;&#x5185;&#x3002;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7C7B;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6CE8;&#x89E3;+process+JavaPoet&#x6765;&#x5B9E;&#x73B0;&#x3002;&#x7C7B;&#x4F3C;&#x4E8E;ButterKnife&#x3001;Dagger2&#x3001;Room&#x7B49;&#x3002;&#x4E4B;&#x524D;&#x6211;&#x4E5F;&#x6709;&#x5199;&#x8FC7;&#x76F8;&#x5173;&#x7684;demo&#x4E0E;&#x6587;&#x7AE0;&#x3002;&#x7531;&#x4E8E;&#x4E0D;&#x5728;&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x8303;&#x56F4;&#x4E4B;&#x5185;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x53BB;&#x4E86;&#x89E3;&#x3002;</p>\n<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x505A;&#x7684;&#x662F;&#xFF1A;&#x9700;&#x8981;&#x5728;ProxyActiviy&#x4E2D;&#x5C06;2&#x3001;3&#x6B65;&#x9AA4;&#x7684;&#x4EE3;&#x7801;&#x8F6C;&#x6210;&#x81EA;&#x52A8;&#x6CE8;&#x5165;&#x3002;</p>\n<p>&#x81EA;&#x52A8;&#x6CE8;&#x5165;&#x5C31;&#x662F;&#x5728;&#x73B0;&#x6709;&#x7684;&#x7C7B;&#x4E2D;&#x81EA;&#x52A8;&#x52A0;&#x5165;&#x6211;&#x4EEC;&#x9884;&#x671F;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x989D;&#x5916;&#x7684;&#x8FDB;&#x884C;&#x7F16;&#x5199;&#x3002;</p>\n<p>&#x65E2;&#x7136;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x4E86;&#x9700;&#x8981;&#x6CE8;&#x5165;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x90A3;&#x4E48;&#x63A5;&#x4E0B;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x8FDB;&#x884C;&#x6CE8;&#x5165;&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#x3002;</p>\n<p>&#x8FD9;&#x5C31;&#x6D89;&#x53CA;&#x5230;Android&#x6784;&#x5EFA;&#x4E0E;&#x6253;&#x5305;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;Android&#x4F7F;&#x7528;Gradle&#x8FDB;&#x884C;&#x6784;&#x5EFA;&#x4E0E;&#x6253;&#x5305;&#xFF0C;</p>\n<p><img src=\"/2021/05/28/&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x6478;&#x9C7C;&#xFF0C;&#x6211;&#x8D70;&#x4E0A;&#x4E86;&#x6B67;&#x8DEF;/1.webp\" alt></p>\n<p>&#x5728;&#x6253;&#x5305;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x5C06;&#x6E90;&#x6587;&#x4EF6;&#x8F6C;&#x5316;&#x6210;.class&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5C06;.class&#x6587;&#x4EF6;&#x8F6C;&#x6210;Android&#x80FD;&#x8BC6;&#x522B;&#x7684;.dex&#x6587;&#x4EF6;&#xFF0C;&#x6700;&#x7EC8;&#x5C06;&#x6240;&#x6709;&#x7684;.dex&#x6587;&#x4EF6;&#x7EC4;&#x5408;&#x6210;&#x4E00;&#x4E2A;.apk&#x6587;&#x4EF6;&#xFF0C;&#x63D0;&#x4F9B;&#x7528;&#x6237;&#x4E0B;&#x8F7D;&#x4E0E;&#x5B89;&#x88C5;&#x3002;</p>\n<p>&#x800C;&#x5728;&#x5C06;&#x6E90;&#x6587;&#x4EF6;&#x8F6C;&#x5316;&#x6210;.class&#x6587;&#x4EF6;&#x4E4B;&#x540E;&#xFF0C;Google&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;Transform&#x673A;&#x5236;&#xFF0C;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x5728;&#x6253;&#x5305;&#x4E4B;&#x524D;&#x5BF9;.class&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x3002;</p>\n<p>&#x8FD9;&#x4E2A;&#x4FEE;&#x6539;&#x65F6;&#x673A;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4EE3;&#x7801;&#x81EA;&#x52A8;&#x6CE8;&#x5165;&#x7684;&#x65F6;&#x673A;&#x3002;</p>\n<p>transform&#x662F;&#x7531;gradle&#x63D0;&#x4F9B;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x65E5;&#x5E38;&#x7684;&#x6784;&#x5EFA;&#x8FC7;&#x7A0B;&#x4E2D;&#x4E5F;&#x4F1A;&#x770B;&#x5230;&#x7CFB;&#x7EDF;&#x81EA;&#x8EAB;&#x7684;transform&#x8EAB;&#x5F71;&#xFF0C;gradle&#x7531;&#x5404;&#x79CD;task&#x7EC4;&#x6210;&#xFF0C;transform&#x5C31;&#x7A7F;&#x63D2;&#x5728;&#x8FD9;&#x4E9B;task&#x4E2D;&#x3002;</p>\n<p><img src=\"/2021/05/28/&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x6478;&#x9C7C;&#xFF0C;&#x6211;&#x8D70;&#x4E0A;&#x4E86;&#x6B67;&#x8DEF;/2.png\" alt></p>\n<p>&#x56FE;&#x4E2D;&#x9AD8;&#x4EAE;&#x7684;&#x90E8;&#x5206;&#x5C31;&#x662F;&#x672C;&#x6B21;&#x81EA;&#x5B9A;&#x4E49;&#x7684;TraceTransform&#xFF0C; &#x5B83;&#x4F1A;&#x5728;.class&#x8F6C;&#x5316;&#x6210;.dex&#x4E4B;&#x524D;&#x8FDB;&#x884C;&#x6267;&#x884C;&#xFF0C;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x4FEE;&#x6539;&#x76EE;&#x6807;.class&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x3002;</p>\n<p>Transform&#x7684;&#x5B9E;&#x73B0;&#x9700;&#x8981;&#x7ED3;&#x5408;Gradle Plugin&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x3002;&#x6240;&#x4EE5;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Plugin&#x3002;</p>\n<h2 id=\"&#x521B;&#x5EFA;Plugin\"><a href=\"#&#x521B;&#x5EFA;Plugin\" class=\"headerlink\" title=\"&#x521B;&#x5EFA;Plugin\"></a>&#x521B;&#x5EFA;Plugin</h2><p>&#x5728;app&#x7684;build.gradle&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x770B;&#x5230;&#x4EE5;&#x4E0B;&#x7C7B;&#x4F3C;&#x7684;&#x63D2;&#x4EF6;&#x5F15;&#x7528;&#x65B9;&#x5F0F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply plugin: &apos;com.android.application&apos;</span><br><span class=\"line\"> </span><br><span class=\"line\">apply plugin: &apos;kotlin-android&apos;</span><br><span class=\"line\"> </span><br><span class=\"line\">apply plugin: &apos;kotlin-android-extensions&apos;</span><br><span class=\"line\"> </span><br><span class=\"line\">apply plugin: &apos;kotlin-kapt&apos;</span><br><span class=\"line\"> </span><br><span class=\"line\">apply plugin: &quot;androidx.navigation.safeargs.kotlin&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">apply plugin: &apos;trace_plugin&apos;</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x7684;&#x63D2;&#x4EF6;&#x5305;&#x62EC;&#x7CFB;&#x7EDF;&#x81EA;&#x5E26;&#x3001;&#x7B2C;&#x4E09;&#x65B9;&#x7684;&#x4E0E;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x3002;&#x5176;&#x4E2D;trace_plugin&#x5C31;&#x662F;&#x672C;&#x6B21;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x63D2;&#x4EF6;&#x3002;&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x8BA9;&#x9879;&#x76EE;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x63D2;&#x4EF6;&#xFF0C;Gradle&#x63D0;&#x4F9B;&#x4E86;&#x4E09;&#x79CD;&#x6253;&#x5305;&#x63D2;&#x4EF6;&#x7684;&#x65B9;&#x5F0F;</p>\n<ol>\n<li>Build Script: &#x5C06;&#x63D2;&#x4EF6;&#x7684;&#x6E90;&#x4EE3;&#x7801;&#x76F4;&#x63A5;&#x5305;&#x542B;&#x5728;&#x6784;&#x5EFA;&#x811A;&#x672C;&#x4E2D;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x597D;&#x5904;&#x662F;&#xFF0C;&#x65E0;&#x9700;&#x6267;&#x884C;&#x4EFB;&#x4F55;&#x64CD;&#x4F5C;&#x5373;&#x53EF;&#x81EA;&#x52A8;&#x7F16;&#x8BD1;&#x63D2;&#x4EF6;&#x5E76;&#x5C06;&#x5176;&#x5305;&#x542B;&#x5728;&#x6784;&#x5EFA;&#x811A;&#x672C;&#x7684;&#x7C7B;&#x8DEF;&#x5F84;&#x4E2D;&#x3002;&#x4F46;&#x7F3A;&#x70B9;&#x662F;&#x5B83;&#x5728;&#x6784;&#x5EFA;&#x811A;&#x672C;&#x4E4B;&#x5916;&#x4E0D;&#x53EF;&#x89C1;&#xFF0C;&#x5E38;&#x7528;&#x5728;&#x811A;&#x672C;&#x81EA;&#x52A8;&#x6784;&#x5EFA;&#x4E2D;&#x3002;</li>\n<li>buildSrc project&#xFF1A;gradle&#x4F1A;&#x81EA;&#x52A8;&#x8BC6;&#x522B;buildSrc&#x76EE;&#x5F55;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x5C06;plugin&#x653E;&#x5230;buildSrc&#x76EE;&#x5F55;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x5176;&#x5B83;&#x7684;&#x6784;&#x5EFA;&#x811A;&#x672C;&#x5C31;&#x80FD;&#x81EA;&#x52A8;&#x8BC6;&#x522B;&#x8FD9;&#x4E2A;plugin, &#x591A;&#x7528;&#x4E8E;&#x81EA;&#x8EAB;&#x9879;&#x76EE;&#xFF0C;&#x5BF9;&#x5916;&#x4E0D;&#x5171;&#x4EAB;&#x3002;</li>\n<li>Standalone project: &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;plugin&#x9879;&#x76EE;&#xFF0C;&#x901A;&#x8FC7;&#x5BF9;&#x5916;&#x53D1;&#x5E03;Jar&#x4E0E;&#x5916;&#x90E8;&#x5171;&#x4EAB;&#x4F7F;&#x7528;&#x3002;</li>\n</ol>\n<p>&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7B2C;&#x4E09;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x521B;&#x5EFA;Plugin&#x3002;&#x6240;&#x4EE5;&#x521B;&#x5EFA;&#x5B8C;&#x4E4B;&#x540E;&#x7684;&#x76EE;&#x5F55;&#x7ED3;&#x6784;&#x5927;&#x6982;&#x662F;&#x8FD9;&#x6837;&#x7684;</p>\n<p><img src=\"/2021/05/28/&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x6478;&#x9C7C;&#xFF0C;&#x6211;&#x8D70;&#x4E0A;&#x4E86;&#x6B67;&#x8DEF;/3.png\" alt></p>\n<p>&#x4E3A;&#x4E86;&#x8BA9;&#x522B;&#x7684;&#x9879;&#x76EE;&#x80FD;&#x591F;&#x5F15;&#x7528;&#x8FD9;&#x4E2A;Plugin&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5BF9;&#x5916;&#x58F0;&#x660E;&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x5E03;&#x5230;maven&#x4E2D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x672C;&#x5730;&#x58F0;&#x660E;&#xFF0C;&#x4E3A;&#x4E86;&#x7B80;&#x4FBF;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x672C;&#x5730;&#x58F0;&#x660E;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply plugin: &apos;groovy&apos;</span><br><span class=\"line\">apply plugin: &apos;maven&apos;</span><br><span class=\"line\">apply plugin: &apos;kotlin&apos;</span><br><span class=\"line\">apply plugin: &apos;java-gradle-plugin&apos;</span><br><span class=\"line\"> </span><br><span class=\"line\">dependencies {</span><br><span class=\"line\">    implementation gradleApi()</span><br><span class=\"line\">    implementation localGroovy()</span><br><span class=\"line\">    implementation &apos;com.android.tools.build:gradle:3.4.1&apos;</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">gradlePlugin {</span><br><span class=\"line\">    plugins {</span><br><span class=\"line\">        version {</span><br><span class=\"line\">            // &#x5728; app &#x6A21;&#x5757;&#x9700;&#x8981;&#x901A;&#x8FC7; id &#x5F15;&#x7528;&#x8FD9;&#x4E2A;&#x63D2;&#x4EF6;</span><br><span class=\"line\">            id = &apos;trace_plugin&apos;</span><br><span class=\"line\">            // &#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x63D2;&#x4EF6;&#x7684;&#x7C7B;&#x7684;&#x8DEF;&#x5F84;</span><br><span class=\"line\">            implementationClass = &apos;com.rousetime.trace_plugin.TracePlugin&apos;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8BE5;Plugin&#x7684;id&#x4E3A;trace_plugin&#xFF0C;&#x5B9E;&#x73B0;&#x5165;&#x53E3;&#x4E3A;com.rousetime.trace_plugin.TracePlugin&#x3002;</p>\n<p>&#x58F0;&#x660E;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x9879;&#x76EE;&#x7684;&#x6839;&#x76EE;&#x5F55;&#x4E0B;&#x7684;build.gradle&#x4E2D;&#x5F15;&#x5165;&#x8BE5;id</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins {</span><br><span class=\"line\">    id &quot;trace_plugin&quot; apply false</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E3A;&#x4E86;&#x80FD;&#x5728;app&#x9879;&#x76EE;&#x4E2D;apply&#x8FD9;&#x4E2A;plugin&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;META-INF.gradle-plugins&#x76EE;&#x5F55;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x4F4D;&#x7F6E;&#x5982;&#x4E0B;</p>\n<p><img src=\"/2021/05/28/&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x6478;&#x9C7C;&#xFF0C;&#x6211;&#x8D70;&#x4E0A;&#x4E86;&#x6B67;&#x8DEF;/4.png\" alt></p>\n<p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684;trace_plugin.properties&#x6587;&#x4EF6;&#x540D;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF0C;&#x524D;&#x9762;&#x7684;trace_plugin&#x5C31;&#x4EE3;&#x8868;&#x4F60;&#x5728;build.gradle&#x4E2D;apply&#x7684;&#x63D2;&#x4EF6;&#x540D;&#x79F0;&#x3002;</p>\n<p>&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x884C;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;TracePlugin&#x7684;&#x5B9E;&#x73B0;&#x5165;&#x53E3;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">implementation-class=com.rousetime.trace_plugin.TracePlugin</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x90FD;&#x51C6;&#x5907;&#x5C31;&#x7EEA;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5728;build.gradle&#x8FDB;&#x884C;apply plugin</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply plugin: &apos;trace_plugin&apos;</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;plugin&#x5C31;&#x5F15;&#x5165;&#x5230;&#x9879;&#x76EE;&#x4E2D;&#x4E86;&#x3002;</p>\n<p>&#x518D;&#x56DE;&#x5230;&#x521A;&#x521A;&#x7684;Plugin&#x5165;&#x53E3;TracePlugin&#xFF0C;&#x6765;&#x770B;&#x4E0B;&#x5B83;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class TracePlugin : Plugin&lt;Project&gt; {</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun apply(target: Project) {</span><br><span class=\"line\">        println(&quot;Trace Plugin start to apply&quot;)</span><br><span class=\"line\">        if (target.plugins.hasPlugin(AppPlugin::class.java)) {</span><br><span class=\"line\">            val appExtension = target.extensions.getByType(AppExtension::class.java)</span><br><span class=\"line\">            appExtension.registerTransform(TraceTransform())</span><br><span class=\"line\">        }</span><br><span class=\"line\">        val methodVisitorConfig = target.extensions.create(&quot;methodVisitor&quot;, MethodVisitorConfig::class.java)</span><br><span class=\"line\">        LocalConfig.methodVisitorConfig = methodVisitorConfig</span><br><span class=\"line\">        target.afterEvaluate {</span><br><span class=\"line\">            println(methodVisitorConfig.name)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;apply&#xFF0C;&#x5728;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x6211;&#x4EEC;&#x6253;&#x5370;&#x4E00;&#x884C;&#x6587;&#x672C;&#xFF0C;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x9879;&#x76EE;&#xFF0C;&#x5728;build&#x8F93;&#x51FA;&#x7A97;&#x53E3;&#x5C31;&#x80FD;&#x770B;&#x5230;&#x8FD9;&#x884C;&#x6587;&#x672C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">....</span><br><span class=\"line\">&gt; Configure project :app</span><br><span class=\"line\">Trace Plugin start to apply</span><br><span class=\"line\">mehtodVisitorConfig</span><br><span class=\"line\">Deprecated Gradle features were used in this build, making it incompatible with Gradle 6.0.</span><br><span class=\"line\">Use &apos;--warning-mode all&apos; to show the individual deprecation warnings.</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>&#x5230;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;plugin&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x6210;&#x529F;&#xFF0C;&#x5E76;&#x4E14;&#x5DF2;&#x7ECF;&#x96C6;&#x6210;&#x5230;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x4E2D;&#x3002;</p>\n<p>&#x7B2C;&#x4E00;&#x6B65;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x3002;&#x4E0B;&#x9762;&#x8FDB;&#x5165;&#x7B2C;&#x4E8C;&#x6B65;&#x3002;</p>\n<h2 id=\"&#x5B9E;&#x73B0;Transform\"><a href=\"#&#x5B9E;&#x73B0;Transform\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;Transform\"></a>&#x5B9E;&#x73B0;Transform</h2><p>&#x5728;TracePlugin&#x7684;apply&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x5BF9;&#x9879;&#x76EE;&#x7684;appExtension&#x6CE8;&#x518C;&#x4E86;&#x4E00;&#x4E2A;TraceTransform&#x3002;&#x91CD;&#x70B9;&#x6765;&#x4E86;&#xFF0C;&#x8FD9;&#x4E2A;TraceTransform&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x5728;gradle&#x6784;&#x5EFA;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x63D2;&#x5165;&#x7684;Transform,&#x4E5F;&#x5C31;&#x662F;&#x6CE8;&#x5165;&#x4EE3;&#x7801;&#x7684;&#x5165;&#x53E3;&#x3002;&#x6765;&#x770B;&#x4E0B;&#x5B83;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class TraceTransform : Transform() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun getName(): String = this::class.java.simpleName</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun getInputTypes(): MutableSet&lt;QualifiedContent.ContentType&gt; = TransformManager.CONTENT_JARS</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun isIncremental(): Boolean = true</span><br><span class=\"line\">    override fun getScopes(): MutableSet&lt;in QualifiedContent.Scope&gt; = TransformManager.SCOPE_FULL_PROJECT</span><br><span class=\"line\">    override fun transform(transformInvocation: TransformInvocation?) {</span><br><span class=\"line\">        TransformProxy(transformInvocation, object : TransformProcess {</span><br><span class=\"line\">            override fun process(entryName: String, sourceClassByte: ByteArray): ByteArray? {</span><br><span class=\"line\">                // use ams to inject</span><br><span class=\"line\">                return if (ClassUtils.checkClassName(entryName)) {</span><br><span class=\"line\">                    TraceInjectDelegate().inject(sourceClassByte)</span><br><span class=\"line\">                } else {</span><br><span class=\"line\">                    null</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }).apply {</span><br><span class=\"line\">            transform()</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4EE3;&#x7801;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x51E0;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<ol>\n<li>getName: Transform&#x5BF9;&#x5916;&#x663E;&#x793A;&#x7684;&#x540D;&#x79F0;</li>\n<li>getInputTypes: &#x626B;&#x63CF;&#x7684;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#xFF0C;CONENT_JARS&#x4EE3;&#x8868;CLASSES&#x4E0E;RESOURCES</li>\n<li>isIncremental: &#x662F;&#x5426;&#x5F00;&#x542F;&#x589E;&#x91CF;&#xFF0C;&#x5F00;&#x542F;&#x540E;&#x4F1A;&#x63D0;&#x9AD8;&#x6784;&#x5EFA;&#x901F;&#x5EA6;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x9700;&#x8981;&#x624B;&#x52A8;&#x5904;&#x7406;&#x589E;&#x91CF;&#x7684;&#x903B;&#x8F91;</li>\n<li>getScopes: &#x626B;&#x63CF;&#x4F5C;&#x7528;&#x8303;&#x56F4;&#xFF0C;SCOPE_FULL_PROJECT&#x4EE3;&#x8868;&#x6574;&#x4E2A;&#x9879;&#x76EE;</li>\n<li>transform: &#x9700;&#x8981;&#x8F6C;&#x6362;&#x7684;&#x903B;&#x8F91;&#x90FD;&#x5728;&#x8FD9;&#x91CC;&#x5904;&#x7406;</li>\n</ol>\n<p>transform&#x662F;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6765;.class&#x6587;&#x4EF6;&#x7684;&#x5165;&#x53E3;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6709;&#x4E2A;&#x53C2;&#x6570;TransformInvocation&#xFF0C;&#x8BE5;&#x53C2;&#x6570;&#x63D0;&#x4F9B;&#x4E86;&#x4E0A;&#x9762;&#x5B9A;&#x4E49;&#x8303;&#x56F4;&#x5185;&#x626B;&#x63CF;&#x5230;&#x7684;&#x6240;&#x7528;jar&#x6587;&#x4EF6;&#x4E0E;directory&#x6587;&#x4EF6;&#x3002;</p>\n<p>&#x5728;transform&#x4E2D;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5728;&#x8FD9;&#x4E9B;jar&#x4E0E;directory&#x4E2D;&#x89E3;&#x6790;&#x51FA;.class&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x662F;&#x627E;&#x5230;&#x76EE;&#x6807;.class&#x7684;&#x7B2C;&#x4E00;&#x6B65;&#x3002;&#x53EA;&#x6709;&#x89E3;&#x6790;&#x51FA;&#x4E86;&#x6240;&#x6709;&#x7684;.class&#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x624D;&#x80FD;&#x8FDB;&#x4E00;&#x6B65;&#x8FC7;&#x6EE4;&#x51FA;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6CE8;&#x5165;&#x4EE3;&#x7801;&#x7684;.class&#x6587;&#x4EF6;&#x3002;</p>\n<p>&#x800C;transform&#x7684;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#x662F;&#xFF1A;&#x89E3;&#x6790;.class&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x8FC7;&#x6EE4;&#x51FA;&#x9700;&#x8981;&#x5904;&#x7406;&#x7684;.class&#x6587;&#x4EF6;&#xFF0C;&#x5199;&#x5165;&#x5BF9;&#x5E94;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5C06;&#x5904;&#x7406;&#x8FC7;&#x7684;.class&#x6587;&#x4EF6;&#x91CD;&#x65B0;&#x62F7;&#x8D1D;&#x5230;&#x4E4B;&#x524D;&#x7684;jar&#x6216;&#x8005;directory&#x4E2D;&#x3002;</p>\n<p>&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x89E3;&#x6790;&#x3001;&#x5904;&#x7406;&#x4E0E;&#x62F7;&#x8D1D;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5B9E;&#x73B0;&#x5077;&#x5929;&#x6362;&#x65E5;&#x7684;&#x6548;&#x679C;&#x3002;</p>\n<p>&#x65E2;&#x7136;&#x6709;&#x4E00;&#x5957;&#x56FA;&#x5B9A;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x90A3;&#x4E48;&#x81EA;&#x7136;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x4E00;&#x5957;&#x56FA;&#x5B9A;&#x662F;&#x5B9E;&#x73B0;&#x3002;&#x5728;&#x8FD9;&#x4E09;&#x4E2A;&#x6B65;&#x9AA4;&#x4E2D;&#xFF0C;&#x771F;&#x6B63;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x7684;&#x662F;&#x5904;&#x7406;&#x903B;&#x8F91;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x9879;&#x76EE;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;&#xFF0C;</p>\n<p>&#x5BF9;&#x4E8E;&#x89E3;&#x6790;&#x4E0E;&#x62F7;&#x8D1D;&#x64CD;&#x4F5C;&#xFF0C;&#x5DF2;&#x7ECF;&#x6709;&#x76F8;&#x5BF9;&#x5B8C;&#x6574;&#x7684;&#x4E00;&#x5957;&#x901A;&#x7528;&#x5B9E;&#x73B0;&#x65B9;&#x6848;&#x3002;&#x5982;&#x679C;&#x4F60;&#x7684;&#x9879;&#x76EE;&#x4E2D;&#x6709;&#x591A;&#x4E2A;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x7684;Transform&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x62BD;&#x79BB;&#x51FA;&#x6765;&#x5355;&#x4E2A;module&#xFF0C;&#x589E;&#x52A0;&#x590D;&#x7528;&#x6027;&#x3002;</p>\n<h3 id=\"&#x89E3;&#x6790;&#x4E0E;&#x62F7;&#x8D1D;\"><a href=\"#&#x89E3;&#x6790;&#x4E0E;&#x62F7;&#x8D1D;\" class=\"headerlink\" title=\"&#x89E3;&#x6790;&#x4E0E;&#x62F7;&#x8D1D;\"></a>&#x89E3;&#x6790;&#x4E0E;&#x62F7;&#x8D1D;</h3><p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x4E0B;&#x5B83;&#x7684;&#x6838;&#x5FC3;&#x5B9E;&#x73B0;&#x6B65;&#x9AA4;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun transform() {</span><br><span class=\"line\">    if (!isIncremental) {</span><br><span class=\"line\">    \t// &#x4E0D;&#x662F;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#xFF0C;&#x5C06;&#x4E4B;&#x524D;&#x7684;&#x8F93;&#x51FA;&#x76EE;&#x5F55;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x5168;&#x90E8;&#x5220;&#x9664;</span><br><span class=\"line\">        outputProvider?.deleteAll()</span><br><span class=\"line\">    }</span><br><span class=\"line\">    inputs?.forEach {</span><br><span class=\"line\">        // jar</span><br><span class=\"line\">        it.jarInputs.forEach { jarInput -&gt;</span><br><span class=\"line\">            transformJar(jarInput)</span><br><span class=\"line\">        }</span><br><span class=\"line\">        // directory</span><br><span class=\"line\">        it.directoryInputs.forEach { directoryInput -&gt;</span><br><span class=\"line\">            transformDirectory(directoryInput)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    executor?.invokeAll(tasks)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>transform&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5206;&#x522B;&#x904D;&#x5386;jar&#x4E0E;directory&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x5728;&#x8FD9;&#x4E24;&#x5927;&#x79CD;&#x7C7B;&#x4E2D;&#x5206;&#x522B;&#x89E3;&#x6790;&#x51FA;.class&#x6587;&#x4EF6;&#x3002;</p>\n<p>&#x4F8B;&#x5982;jar&#x7684;&#x89E3;&#x6790;transformJar</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private fun transformJar(jarInput: JarInput) {</span><br><span class=\"line\">    val status = jarInput.status</span><br><span class=\"line\">    var destName = jarInput.file.name</span><br><span class=\"line\">    if (destName.endsWith(&quot;.jar&quot;)) {</span><br><span class=\"line\">        destName = destName.substring(0, destName.length - 4)</span><br><span class=\"line\">    }</span><br><span class=\"line\">    // &#x91CD;&#x547D;&#x540D;, &#x53EF;&#x80FD;&#x540C;&#x540D;&#x88AB;&#x8986;&#x76D6;</span><br><span class=\"line\">    val hexName = DigestUtils.md2Hex(jarInput.file.absolutePath).substring(0, 8)</span><br><span class=\"line\">    // &#x8F93;&#x51FA;&#x6587;&#x4EF6;</span><br><span class=\"line\">    val dest = outputProvider?.getContentLocation(destName + &quot;_&quot; + hexName, jarInput.contentTypes, jarInput.scopes, Format.JAR)</span><br><span class=\"line\">    if (isIncremental) { // &#x589E;&#x91CF;</span><br><span class=\"line\">        when (status) {</span><br><span class=\"line\">            Status.NOTCHANGED -&gt; {</span><br><span class=\"line\">                // nothing to do</span><br><span class=\"line\">            }</span><br><span class=\"line\">            Status.ADDED, Status.CHANGED -&gt; {</span><br><span class=\"line\">                foreachJar(jarInput, dest)</span><br><span class=\"line\">            }</span><br><span class=\"line\">            Status.REMOVED -&gt; {</span><br><span class=\"line\">                if (dest?.exists() == true) {</span><br><span class=\"line\">                    FileUtils.forceDelete(dest)</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">            else -&gt; {</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        foreachJar(jarInput, dest)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x662F;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#xFF0C;&#x5C31;&#x5206;&#x522B;&#x5904;&#x7406;&#x589E;&#x91CF;&#x7684;&#x4E0D;&#x540C;&#x64CD;&#x4F5C;&#xFF0C;&#x4E3B;&#x8981;&#x7684;&#x662F;ADDED&#x4E0E;CHANGED&#x64CD;&#x4F5C;&#x3002;&#x8FD9;&#x4E2A;&#x5904;&#x7406;&#x903B;&#x8F91;&#x4E0E;&#x975E;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#x7684;&#x65F6;&#x5019;&#x4E00;&#x6837;&#xFF0C;&#x90FD;&#x662F;&#x53BB;&#x904D;&#x5386;jar&#xFF0C;&#x4ECE;&#x4E2D;&#x89E3;&#x6790;&#x51FA;&#x5BF9;&#x5E94;&#x7684;.class&#x6587;&#x4EF6;&#x3002;</p>\n<p>&#x904D;&#x5386;&#x7684;&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#x5982;&#x4E0B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">while (enumeration.hasMoreElements()) {</span><br><span class=\"line\">    val jarEntry = enumeration.nextElement()</span><br><span class=\"line\">    val inputStream = originalFile.getInputStream(jarEntry)</span><br><span class=\"line\"> </span><br><span class=\"line\">    val entryName = jarEntry.name</span><br><span class=\"line\">    // &#x6784;&#x5EFA;zipEntry</span><br><span class=\"line\">    val zipEntry = ZipEntry(entryName)</span><br><span class=\"line\">    jarOutputStream.putNextEntry(zipEntry)</span><br><span class=\"line\"> </span><br><span class=\"line\">    var modifyClassByte: ByteArray? = null</span><br><span class=\"line\">    val sourceClassByte = IOUtils.toByteArray(inputStream)</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (entryName.endsWith(&quot;.class&quot;)) {</span><br><span class=\"line\">        modifyClassByte = transformProcess.process(entryName, sourceClassByte)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (modifyClassByte == null) {</span><br><span class=\"line\">        jarOutputStream.write(sourceClassByte)</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        jarOutputStream.write(modifyClassByte)</span><br><span class=\"line\">    }</span><br><span class=\"line\">    inputStream.close()</span><br><span class=\"line\">    jarOutputStream.closeEntry()</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;entryName&#x7684;&#x540E;&#x7F00;&#x662F;.class&#x8BF4;&#x660E;&#x5F53;&#x524D;&#x662F;.class&#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5355;&#x72EC;&#x62FF;&#x51FA;&#x6765;&#x8FDB;&#x884C;&#x540E;&#x7EED;&#x7684;&#x5904;&#x7406;&#x3002;</p>\n<p>&#x540E;&#x7EED;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;&#x4EA4;&#x7ED9;&#x4E86;transformProcess.process&#x3002;&#x5177;&#x4F53;&#x5904;&#x7406;&#x5148;&#x653E;&#x4E00;&#x653E;&#x3002;</p>\n<p>&#x5904;&#x7406;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x518D;&#x5C06;&#x5904;&#x7406;&#x540E;&#x7684;&#x5B57;&#x8282;&#x7801;&#x62F7;&#x8D1D;&#x4FDD;&#x5B58;&#x5230;&#x4E4B;&#x524D;&#x7684;jar&#x4E2D;&#x3002;</p>\n<p>&#x5BF9;&#x5E94;&#x7684;directory&#x4E5F;&#x662F;&#x7C7B;&#x4F3C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private fun foreachFile(dir: File, dest: File?) {</span><br><span class=\"line\">    if (dir.isDirectory) {</span><br><span class=\"line\">        FileUtils.copyDirectory(dir, dest)</span><br><span class=\"line\">        getAllFiles(dir).forEach {</span><br><span class=\"line\">            if (it.name.endsWith(&quot;.class&quot;)) {</span><br><span class=\"line\">                val task = Callable {</span><br><span class=\"line\">                    val absolutePath = it.absolutePath.replace(dir.absolutePath + File.separator, &quot;&quot;)</span><br><span class=\"line\">                    val className = ClassUtils.path2Classname(absolutePath)</span><br><span class=\"line\">                    val bytes = IOUtils.toByteArray(it.inputStream())</span><br><span class=\"line\">                    val modifyClassByte = process(className ?: &quot;&quot;, bytes)</span><br><span class=\"line\">                    // &#x4FDD;&#x5B58;&#x4FEE;&#x6539;&#x7684;classFile</span><br><span class=\"line\">                    modifyClassByte?.let { byte -&gt; saveClassFile(byte, dest, absolutePath) }</span><br><span class=\"line\">                }</span><br><span class=\"line\">                tasks.add(task)</span><br><span class=\"line\">                executor?.submit(task)</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x540C;&#x6837;&#x662F;&#x8FC7;&#x6EE4;&#x51FA;.class&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x4EA4;&#x7ED9;process&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x7EDF;&#x4E00;&#x5904;&#x7406;&#x3002;&#x6700;&#x540E;&#x5C06;&#x5904;&#x7406;&#x5B8C;&#x7684;&#x5B57;&#x8282;&#x7801;&#x62F7;&#x8D1D;&#x4FDD;&#x5B58;&#x5230;&#x539F;&#x8DEF;&#x5F84;&#x4E2D;&#x3002;</p>\n<p>&#x4EE5;&#x4E0A;&#x5C31;&#x662F;Transform&#x7684;&#x89E3;&#x6790;&#x4E0E;&#x62F7;&#x8D1D;&#x7684;&#x6838;&#x5FC3;&#x5904;&#x7406;&#x3002;</p>\n<h3 id=\"&#x5904;&#x7406;\"><a href=\"#&#x5904;&#x7406;\" class=\"headerlink\" title=\"&#x5904;&#x7406;\"></a>&#x5904;&#x7406;</h3><p>&#x4E0A;&#x9762;&#x63D0;&#x5230;.class&#x7684;&#x5904;&#x7406;&#x90FD;&#x8F6C;&#x4EA4;&#x7ED9;process&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x5728;TraceTransform&#x7684;transform&#x65B9;&#x6CD5;&#x4E2D;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun transform(transformInvocation: TransformInvocation?) {</span><br><span class=\"line\">    TransformProxy(transformInvocation, object : TransformProcess {</span><br><span class=\"line\">        override fun process(entryName: String, sourceClassByte: ByteArray): ByteArray? {</span><br><span class=\"line\">            // use ams to inject</span><br><span class=\"line\">            return if (ClassUtils.checkClassName(entryName)) {</span><br><span class=\"line\">                TraceInjectDelegate().inject(sourceClassByte)</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                null</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }).apply {</span><br><span class=\"line\">        transform()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;process&#x4E2D;&#x4F7F;&#x7528;TraceInjectDelegate&#x7684;inject&#x6765;&#x5904;&#x7406;&#x8FC7;&#x6EE4;&#x51FA;&#x6765;&#x7684;&#x5B57;&#x8282;&#x7801;&#x3002;&#x6700;&#x7EC8;&#x7684;&#x5904;&#x7406;&#x4F1A;&#x6765;&#x5230;modifyClassByte&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class TraceAsmInject : Inject {</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun modifyClassByte(byteArray: ByteArray): ByteArray {</span><br><span class=\"line\">        val classWriter = ClassWriter(ClassWriter.COMPUTE_MAXS)</span><br><span class=\"line\">        val classFilterVisitor = ClassFilterVisitor(classWriter)</span><br><span class=\"line\">        val classReader = ClassReader(byteArray)</span><br><span class=\"line\">        classReader.accept(classFilterVisitor, ClassReader.EXPAND_FRAMES)</span><br><span class=\"line\">        return classWriter.toByteArray()</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x7684;ClassWriter&#x3001;ClassFilterVisitor&#x3001;ClassReader&#x90FD;&#x662F;ASM&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x4E5F;&#x662F;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6765;&#x5B9E;&#x73B0;&#x81EA;&#x52A8;&#x6CE8;&#x5165;&#x4EE3;&#x7801;&#x7684;&#x91CD;&#x70B9;&#x3002;</p>\n<h2 id=\"ASM\"><a href=\"#ASM\" class=\"headerlink\" title=\"ASM\"></a>ASM</h2><p>ASM&#x662F;&#x64CD;&#x4F5C;Java&#x5B57;&#x8282;&#x7801;&#x7684;&#x4E00;&#x4E2A;&#x5DE5;&#x5177;&#x3002;</p>\n<p>&#x5176;&#x5B9E;&#x64CD;&#x4F5C;&#x5B57;&#x8282;&#x7801;&#x7684;&#x9664;&#x4E86;ASM&#x8FD8;&#x6709;javassist&#xFF0C;&#x4F46;&#x4E2A;&#x4EBA;&#x89C9;&#x5F97;ASM&#x66F4;&#x65B9;&#x4FBF;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x6709;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x8F85;&#x52A9;&#x5DE5;&#x5177;&#xFF0C;&#x80FD;&#x66F4;&#x597D;&#x7684;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x7684;&#x6CE8;&#x5165;&#x3002;</p>\n<p>&#x5728;&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5F97;&#x5230;&#x4E86;.class&#x7684;&#x5B57;&#x8282;&#x7801;&#x6587;&#x4EF6;&#x3002;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x626B;&#x63CF;&#x6574;&#x4E2A;&#x5B57;&#x8282;&#x7801;&#x6587;&#x4EF6;&#xFF0C;&#x5224;&#x65AD;&#x662F;&#x5426;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6CE8;&#x5165;&#x7684;&#x6587;&#x4EF6;&#x3002;</p>\n<p>&#x8FD9;&#x91CC;&#x6211;&#x5C06;&#x8FD9;&#x4E9B;&#x903B;&#x8F91;&#x5C01;&#x88C5;&#x5230;&#x4E86;ClassFilterVisitor&#x6587;&#x4EF6;&#x4E2D;&#x3002;</p>\n<p>ASM&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;ClassVisitor&#x3001;MethodVisitor&#x3001;FieldVisitor&#x7B49;API&#x3002;&#x6BCF;&#x5F53;ASM&#x626B;&#x63CF;&#x7C7B;&#x7684;&#x5B57;&#x8282;&#x7801;&#x65F6;&#xFF0C;&#x90FD;&#x4F1A;&#x8C03;&#x7528;&#x5B83;&#x7684;visit&#x3001;visitField&#x3001;visitMethod&#x4E0E;visitAnnotation&#x7B49;&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x6709;&#x4E86;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5224;&#x65AD;&#x5E76;&#x5904;&#x7406;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x5B57;&#x8282;&#x7801;&#x6587;&#x4EF6;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ClassFilterVisitor(cv: ClassVisitor?) : ClassVisitor(Opcodes.ASM5, cv) {</span><br><span class=\"line\">    override fun visit(version: Int, access: Int, name: String?, signature: String?, superName: String?, interfaces: Array&lt;out String&gt;?) {</span><br><span class=\"line\">        super.visit(version, access, name, signature, superName, interfaces)</span><br><span class=\"line\">        // &#x626B;&#x63CF;&#x5F53;&#x524D;&#x7C7B;&#x7684;&#x4FE1;&#x606F;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    override fun visitMethod(access: Int, name: String?, desc: String?, signature: String?, exceptions: Array&lt;out String&gt;?): MethodVisitor {</span><br><span class=\"line\">        // &#x626B;&#x63CF;&#x7C7B;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun visitField(access: Int, name: String?, desc: String?, signature: String?, value: Any?): FieldVisitor {</span><br><span class=\"line\">        // &#x626B;&#x63CF;&#x7C7B;&#x4E2D;&#x7684;&#x5B57;&#x6BB5;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x662F;&#x51E0;&#x4E2A;&#x4E3B;&#x8981;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4E5F;&#x662F;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x91CD;&#x70B9;&#x7528;&#x5230;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A;&#x660E;&#x767D;&#x4E86;&#x5176;&#x5B83;&#x7684;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun bindData(value: MainModel, position: Int) {</span><br><span class=\"line\">    itemView.content.apply {</span><br><span class=\"line\">        text = value.content</span><br><span class=\"line\">        setOnClickListener {</span><br><span class=\"line\">            // &#x81EA;&#x52A8;&#x6CE8;&#x5165;&#x8FD9;&#x884C;&#x4EE3;&#x7801;</span><br><span class=\"line\">            LogUtils.d(&quot;inject success.&quot;)</span><br><span class=\"line\">            if (position == 0) {</span><br><span class=\"line\">                requestPermission(context, value)</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                navigationPage(context, value)</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;onClickListener&#x4E2D;&#x6CE8;&#x5165;LogUtils.d&#x8FD9;&#x4E2A;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x672C;&#x8D28;&#x5C31;&#x662F;&#x5728;&#x70B9;&#x51FB;&#x7684;&#x65F6;&#x5019;&#x8F93;&#x51FA;&#x4E00;&#x884C;&#x65E5;&#x5FD7;&#x3002;</p>\n<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x660E;&#x767D;&#xFF0C;setOnClickListener&#x672C;&#x8D28;&#x662F;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;OnClickListener&#x63A5;&#x53E3;&#x7684;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x5728;&#x626B;&#x63CF;&#x7C7B;&#x7684;&#x65F6;&#x5019;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5B9E;&#x73B0;&#x4E86;OnClickListener&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x5982;&#x679C;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x53BB;&#x5339;&#x914D;&#x5B83;&#x7684;onClick&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x5B83;&#x7684;onClick&#x65B9;&#x6CD5;&#x4E2D;&#x8FDB;&#x884C;&#x6CE8;&#x5165;&#x4EE3;&#x7801;&#x3002;</p>\n<p>&#x800C;&#x7C7B;&#x7684;&#x626B;&#x63CF;&#x4E0E;&#x65B9;&#x6CD5;&#x626B;&#x63CF;&#x5206;&#x522B;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;visit&#x4E0E;visitMethod</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun visit(version: Int, access: Int, name: String?, signature: String?, superName: String?, interfaces: Array&lt;out String&gt;?) {</span><br><span class=\"line\">    super.visit(version, access, name, signature, superName, interfaces)</span><br><span class=\"line\">    // &#x63A5;&#x53E3;&#x540D;</span><br><span class=\"line\">    mInterface = interfaces</span><br><span class=\"line\">}</span><br><span class=\"line\">override fun visitMethod(access: Int, name: String?, desc: String?, signature: String?, exceptions: Array&lt;out String&gt;?): MethodVisitor {</span><br><span class=\"line\">    // &#x5224;&#x65AD;&#x5F53;&#x524D;&#x7C7B;&#x662F;&#x5426;&#x5B9E;&#x73B0;&#x4E86;onClickListener</span><br><span class=\"line\">    if (mInterface != null &amp;&amp; mInterface?.size ?: 0 &gt; 0) {</span><br><span class=\"line\">        mInterface?.forEach {</span><br><span class=\"line\">            // &#x5224;&#x65AD;&#x5F53;&#x524D;&#x626B;&#x63CF;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x5426;&#x662F;onClick</span><br><span class=\"line\">            if ((name + desc) == &quot;onClick(Landroid/view/View;)V&quot; &amp;&amp; it == &quot;android/view/View\\$OnClickListener&quot;) {</span><br><span class=\"line\">                val mv = cv.visitMethod(access, name, desc, signature, exceptions)</span><br><span class=\"line\">                return object : AdviceAdapter(Opcodes.ASM5, mv, access, name, desc) {</span><br><span class=\"line\">                    override fun onMethodEnter() {</span><br><span class=\"line\">                        super.onMethodEnter()</span><br><span class=\"line\">                        mv.visitFieldInsn(GETSTATIC, &quot;com/idisfkj/androidapianalysis/utils/LogUtils&quot;, &quot;INSTANCE&quot;, &quot;Lcom/idisfkj/androidapianalysis/utils/LogUtils;&quot;)</span><br><span class=\"line\">                        mv.visitLdcInsn(&quot;inject success.&quot;)</span><br><span class=\"line\">                        mv.visitMethodInsn(INVOKEVIRTUAL, &quot;com/idisfkj/androidapianalysis/utils/LogUtils&quot;, &quot;d&quot;, &quot;(Ljava/lang/String;)V&quot;, false)</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return super.visitMethod(access, name, desc, signature, exceptions)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;visit&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4FDD;&#x5B58;&#x5F53;&#x524D;&#x7C7B;&#x5B9E;&#x73B0;&#x7684;&#x63A5;&#x53E3;&#xFF1B;&#x5728;visitMethod&#x4E2D;&#x518D;&#x5BF9;&#x5F53;&#x524D;&#x63A5;&#x53E3;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#xFF0C;&#x770B;&#x5B83;&#x662F;&#x5426;&#x6709;onClick&#x65B9;&#x6CD5;&#x3002;</p>\n<blockquote>\n<p>name&#x4E0E;desc&#x5206;&#x522B;&#x4E3A;onClick&#x65B9;&#x6CD5;&#x7684;&#x65B9;&#x6CD5;&#x540D;&#x79F0;&#x4E0E;&#x65B9;&#x6CD5;&#x53C2;&#x6570;&#x63CF;&#x8FF0;&#x3002;&#x8FD9;&#x662F;&#x5B57;&#x8282;&#x7801;&#x5339;&#x914D;&#x65B9;&#x6CD5;&#x7684;&#x4E00;&#x79CD;&#x89C4;&#x8303;&#x3002;</p>\n</blockquote>\n<p>&#x5982;&#x679C;&#x6709;&#x7684;&#x8BDD;&#xFF0C;&#x8BF4;&#x660E;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x63D2;&#x5165;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x8FD4;&#x56DE;AdviceAdapter&#x3002;&#x5B83;&#x662F;ASM&#x63D0;&#x4F9B;&#x7684;&#x4FBF;&#x6377;&#x9488;&#x5BF9;&#x65B9;&#x6CD5;&#x6CE8;&#x5165;&#x7684;&#x7C7B;&#x3002;&#x6211;&#x4EEC;&#x91CD;&#x5199;&#x5B83;&#x7684;onMethodEnter&#x65B9;&#x6CD5;&#x3002;&#x4EE3;&#x8868;&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x65B9;&#x6CD5;&#x7684;&#x5F00;&#x5934;&#x6CE8;&#x5165;&#x4EE3;&#x7801;&#x3002;</p>\n<p>onMethodEnter&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x662F;LogUtils.d&#x7684;ASM&#x6CE8;&#x5165;&#x5B9E;&#x73B0;&#x3002;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x8BF4;&#x8FD9;&#x4E2A;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x5B8C;&#x5168;&#x770B;&#x4E0D;&#x61C2;&#xFF0C;&#x66F4;&#x522B;&#x8BF4;&#x5199;&#x5B57;&#x8282;&#x7801;&#x6CE8;&#x5165;&#x4E86;&#x3002;</p>\n<p>&#x522B;&#x6025;&#xFF0C;&#x4E0B;&#x9762;&#x5C31;&#x662F;ASM&#x7684;&#x65B9;&#x4FBF;&#x4E4B;&#x5904;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x5728;Android Studio&#x4E2D;&#x4E0B;&#x8F7D;ASM Bytecode Viewer Support Kotlin&#x63D2;&#x4EF6;&#x3002;</p>\n<p><img src=\"/2021/05/28/&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x6478;&#x9C7C;&#xFF0C;&#x6211;&#x8D70;&#x4E0A;&#x4E86;&#x6B67;&#x8DEF;/5.png\" alt></p>\n<p>&#x8BE5;&#x63D2;&#x4EF6;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x67E5;&#x770B;kotlin&#x5B57;&#x8282;&#x7801;&#xFF0C;&#x53EA;&#x9700;&#x53F3;&#x952E;&#x5F39;&#x7A97;&#x4E2D;&#x9009;&#x62E9;ASM Bytecode Viewer&#x3002;&#x7A0D;&#x540E;&#x5C31;&#x4F1A;&#x5F39;&#x51FA;&#x8F6C;&#x5316;&#x540E;&#x7684;&#x5B57;&#x8282;&#x7801;&#x5F39;&#x7A97;&#x3002;</p>\n<p><img src=\"/2021/05/28/&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x6478;&#x9C7C;&#xFF0C;&#x6211;&#x8D70;&#x4E0A;&#x4E86;&#x6B67;&#x8DEF;/6.png\" alt></p>\n<p>&#x5728;&#x5F39;&#x7A97;&#x4E2D;&#x627E;&#x5230;&#x9700;&#x8981;&#x6CE8;&#x5165;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5177;&#x4F53;&#x5C31;&#x662F;&#x4E0B;&#x9762;&#x8FD9;&#x51E0;&#x884C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">methodVisitor.visitFieldInsn(GETSTATIC, &quot;com/idisfkj/androidapianalysis/utils/LogUtils&quot;, &quot;INSTANCE&quot;, &quot;Lcom/idisfkj/androidapianalysis/utils/LogUtils;&quot;);</span><br><span class=\"line\">methodVisitor.visitLdcInsn(&quot;inject success.&quot;);</span><br><span class=\"line\">methodVisitor.visitMethodInsn(INVOKEVIRTUAL, &quot;com/idisfkj/androidapianalysis/utils/LogUtils&quot;, &quot;d&quot;, &quot;(Ljava/lang/String;)V&quot;, false);</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x5C31;&#x662F;LogUtils.d&#x7684;&#x6CE8;&#x5165;&#x4EE3;&#x7801;&#xFF0C;&#x76F4;&#x63A5;copy&#x5230;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684;onMethodEnter&#x65B9;&#x6CD5;&#x4E2D;&#x3002;&#x8FD9;&#x6837;&#x6CE8;&#x5165;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x60F3;&#x67E5;&#x770B;&#x662F;&#x5426;&#x6CE8;&#x5165;&#x6210;&#x529F;&#xFF0C;&#x9664;&#x4E86;&#x8FD0;&#x884C;&#x9879;&#x76EE;&#xFF0C;&#x67E5;&#x770B;&#x6548;&#x679C;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x67E5;&#x770B;&#x6CE8;&#x5165;&#x7684;&#x6E90;&#x7801;&#x3002;</p>\n<p>&#x5728;&#x9879;&#x76EE;&#x7684;build/intermediates/transforms&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x627E;&#x5230;&#x81EA;&#x5B9A;&#x4E49;&#x7684;TraceTransform&#xFF0C;&#x518D;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x6CE8;&#x5165;&#x6587;&#x4EF6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x6CE8;&#x5165;&#x6E90;&#x7801;&#x3002;</p>\n<p>&#x5176;&#x5B9E;&#x5230;&#x8FD9;&#x6765;&#x6838;&#x5FC3;&#x5185;&#x5BB9;&#x57FA;&#x672C;&#x5DF2;&#x7ECF;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x4E0D;&#x7BA1;&#x662F;&#x6CE8;&#x5165;&#x4EC0;&#x4E48;&#x4EE3;&#x7801;&#x90FD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x6CE8;&#x5165;&#x7684;ASM&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x53EA;&#x662F;&#x6CE8;&#x5165;&#x7684;&#x65F6;&#x673A;&#x5224;&#x65AD;&#x3002;</p>\n<p>&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x5B9E;&#x73B0;&#x5F00;&#x5934;&#x7684;&#x81EA;&#x52A8;&#x57CB;&#x70B9;&#x3002;</p>\n<h2 id=\"&#x5B9E;&#x73B0;\"><a href=\"#&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;\"></a>&#x5B9E;&#x73B0;</h2><p>&#x4E3A;&#x4E86;&#x8BA9;&#x81EA;&#x52A8;&#x5316;&#x57CB;&#x70B9;&#x80FD;&#x591F;&#x7075;&#x6D3B;&#x7684;&#x4F20;&#x9012;&#x6253;&#x70B9;&#x6570;&#x636E;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x4F20;&#x9012;&#x5177;&#x4F53;&#x7684;&#x57CB;&#x70B9;&#x6570;&#x636E;&#x4E0E;&#x7C7B;&#x578B;&#x3002;</p>\n<ol>\n<li>TrackClickData: &#x70B9;&#x51FB;&#x7684;&#x6570;&#x636E;</li>\n<li>TrackScanData: &#x66DD;&#x5149;&#x7684;&#x6570;&#x636E;</li>\n<li>TrackScan: &#x66DD;&#x5149;&#x70B9;</li>\n<li>TrackClick: &#x70B9;&#x51FB;&#x70B9;</li>\n</ol>\n<p>&#x6709;&#x4E86;&#x8FD9;&#x4E9B;&#x6CE8;&#x89E3;&#xFF0C;&#x5269;&#x4E0B;&#x6211;&#x4EEC;&#x8981;&#x505A;&#x7684;&#x5C31;&#x5F88;&#x7B80;&#x5355;&#x4E86;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ProxyActivity : AppCompatActivity() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    @TrackClickData</span><br><span class=\"line\">    private var mTrackModel = TrackModel()</span><br><span class=\"line\"> </span><br><span class=\"line\">    @TrackScanData</span><br><span class=\"line\">    private var mTrackScanData = mutableListOf&lt;TrackModel&gt;()</span><br><span class=\"line\"> </span><br><span class=\"line\">    companion object {</span><br><span class=\"line\">        private const val BUTTON = &quot;statistic_button&quot;</span><br><span class=\"line\">        private const val TEXT = &quot;statistic_text&quot;</span><br><span class=\"line\">        const val PAGE_NAME = &quot;ProxyActivity&quot;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) {</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        ..</span><br><span class=\"line\">        onScan()</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @TrackScan</span><br><span class=\"line\">    fun onScan() {</span><br><span class=\"line\">        mTrackScanData.add(TrackModel(name = BUTTON))</span><br><span class=\"line\">        mTrackScanData.add(TrackModel(name = TEXT))</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @TrackClick</span><br><span class=\"line\">    fun onClick(view: View) {</span><br><span class=\"line\">        mTrackModel.time = System.currentTimeMillis() / 1000</span><br><span class=\"line\">        mTrackModel.name = if (view.id == R.id.button) BUTTON else TEXT</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;TrackClickData&#x4E0E;TrackScanData&#x58F0;&#x660E;&#x6253;&#x70B9;&#x7684;&#x6570;&#x636E;&#xFF1B;&#x4F7F;&#x7528;TrackScan&#x4E0E;TrackClick&#x58F0;&#x660E;&#x6253;&#x70B9;&#x7684;&#x7C7B;&#x578B;&#x4E0E;&#x81EA;&#x52A8;&#x5316;&#x63D2;&#x5165;&#x4EE3;&#x7801;&#x7684;&#x5165;&#x53E3;&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x518D;&#x56DE;&#x5230;&#x6CE8;&#x5165;&#x4EE3;&#x7801;&#x7684;&#x7C7B;ClassFilterVisitor&#xFF0C;&#x6765;&#x5B9E;&#x73B0;&#x5177;&#x4F53;&#x7684;&#x57CB;&#x70B9;&#x4EE3;&#x7801;&#x7684;&#x6CE8;&#x5165;&#x3002;</p>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x505A;&#x7684;&#x662F;&#x89E3;&#x6790;&#x58F0;&#x660E;&#x7684;&#x6CE8;&#x89E3;&#xFF0C;&#x62FF;&#x5230;&#x6253;&#x70B9;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x4E14;&#x58F0;&#x660E;&#x7684;TrackScan&#x4E0E;TrackClick&#x65B9;&#x6CD5;&#x4E2D;&#x63D2;&#x5165;&#x57CB;&#x70B9;&#x7684;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun visit(version: Int, access: Int, name: String?, signature: String?, superName: String?, interfaces: Array&lt;out String&gt;?) {</span><br><span class=\"line\">    super.visit(version, access, name, signature, superName, interfaces)</span><br><span class=\"line\">    mInterface = interfaces</span><br><span class=\"line\">    mClassName = name</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;visit&#x65B9;&#x6CD5;&#x6765;&#x626B;&#x63CF;&#x5177;&#x4F53;&#x7684;&#x7C7B;&#x6587;&#x4EF6;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x4FDD;&#x5B58;&#x5F53;&#x524D;&#x626B;&#x63CF;&#x7684;&#x7C7B;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x4E3A;&#x4E4B;&#x540E;&#x6CE8;&#x5165;&#x4EE3;&#x7801;&#x505A;&#x51C6;&#x5907;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun visitField(access: Int, name: String?, desc: String?, signature: String?, value: Any?): FieldVisitor {</span><br><span class=\"line\">    val filterVisitor = super.visitField(access, name, desc, signature, value)</span><br><span class=\"line\">    return object : FieldVisitor(Opcodes.ASM5, filterVisitor) {</span><br><span class=\"line\">        override fun visitAnnotation(annotationDesc: String?, visible: Boolean): AnnotationVisitor {</span><br><span class=\"line\">            if (annotationDesc == TRACK_CLICK_DATA_DESC) {  // TrackClickData &#x6CE8;&#x89E3;</span><br><span class=\"line\">                mTrackDataName = name</span><br><span class=\"line\">                mTrackDataValue = value</span><br><span class=\"line\">                mTrackDataDesc = desc</span><br><span class=\"line\">                createFiled()</span><br><span class=\"line\">            } else if (annotationDesc == TRACK_SCAN_DATA_DESC) { // TrackScanData&#x6CE8;&#x89E3;</span><br><span class=\"line\">                mTrackScanDataName = name</span><br><span class=\"line\">                mTrackScanDataDesc = desc</span><br><span class=\"line\">                createFiled()</span><br><span class=\"line\">            }</span><br><span class=\"line\">            return super.visitAnnotation(annotationDesc, visible)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>visitFiled&#x65B9;&#x6CD5;&#x7528;&#x6765;&#x626B;&#x63CF;&#x7C7B;&#x6587;&#x4EF6;&#x4E2D;&#x58F0;&#x660E;&#x7684;&#x5B57;&#x6BB5;&#x3002;&#x5728;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8FD4;&#x56DE;&#x5E76;&#x5B9E;&#x73B0;FieldVisitor&#xFF0C;&#x5E76;&#x91CD;&#x65B0;&#x5B83;&#x7684;visitAnnotation&#x65B9;&#x6CD5;&#xFF0C;&#x76EE;&#x7684;&#x662F;&#x627E;&#x5230;&#x4E4B;&#x524D;TrackClickData&#x4E0E;TrackScanData&#x58F0;&#x660E;&#x7684;&#x57CB;&#x70B9;&#x5B57;&#x6BB5;&#x3002;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;mTrackModel&#x4E0E;mTrackScanData&#x3002;</p>\n<p>&#x4E3B;&#x8981;&#x5305;&#x62EC;&#x5B57;&#x6BB5;&#x540D;&#x79F0;name&#x4E0E;&#x5B57;&#x6BB5;&#x7684;&#x63CF;&#x8FF0;desc&#xFF0C;&#x4E3A;&#x6211;&#x4EEC;&#x4E4B;&#x540E;&#x6CE8;&#x5165;&#x57CB;&#x70B9;&#x6570;&#x636E;&#x505A;&#x51C6;&#x5907;&#x3002;</p>\n<p>&#x53E6;&#x5916;&#x4E00;&#x65E6;&#x5339;&#x914D;&#x5230;&#x57CB;&#x70B9;&#x6570;&#x636E;&#x7684;&#x6CE8;&#x89E3;&#xFF0C;&#x8BF4;&#x660E;&#x8BE5;&#x7C7B;&#x4E2D;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x81EA;&#x52A8;&#x5316;&#x57CB;&#x70B9;&#xFF0C;&#x6240;&#x4EE5;&#x8FD8;&#x9700;&#x8981;&#x81EA;&#x52A8;&#x521B;&#x5EFA;StatisticService&#x3002;&#x8FD9;&#x662F;&#x6253;&#x70B9;&#x7684;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#xFF0C;&#x5177;&#x4F53;&#x6253;&#x70B9;&#x7684;&#x90FD;&#x662F;&#x901A;&#x8FC7;StatisticService&#x6765;&#x5B9E;&#x73B0;&#x3002;</p>\n<p>&#x5728;visitField&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;createFiled&#x65B9;&#x6CD5;&#x6765;&#x521B;&#x5EFA;StatisticService&#x7C7B;&#x578B;&#x7684;&#x5B57;&#x6BB5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private fun createFiled() {</span><br><span class=\"line\">    if (!mFieldPresent) {</span><br><span class=\"line\">        mFieldPresent = true</span><br><span class=\"line\">        // &#x6CE8;&#x5165;&#xFF1A;statisticService &#x5B57;&#x6BB5;</span><br><span class=\"line\">        val fieldVisitor = cv.visitField(ACC_PRIVATE or ACC_FINAL, statisticServiceField.name, statisticServiceField.desc, null, null)</span><br><span class=\"line\">        fieldVisitor.visitEnd()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;statisticServiceField&#x662F;&#x5C01;&#x88C5;&#x597D;&#x7684;StatisticService&#x5B57;&#x6BB5;&#x4FE1;&#x606F;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">companion object {</span><br><span class=\"line\">    const val OWNER = &quot;com/idisfkj/androidapianalysis/proxy/StatisticService&quot;</span><br><span class=\"line\">    const val DESC = &quot;Lcom/idisfkj/androidapianalysis/proxy/StatisticService;&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">    val INSTANCE = StatisticService()</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">val statisticService = FieldConfig(</span><br><span class=\"line\">        Opcodes.PUTFIELD,</span><br><span class=\"line\">        &quot;&quot;,</span><br><span class=\"line\">        &quot;mStatisticService&quot;,</span><br><span class=\"line\">        DESC</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>&#x521B;&#x5EFA;&#x7684;&#x5B57;&#x6BB5;&#x540D;&#x4E3A;mStatisticService&#xFF0C;&#x5B83;&#x7684;&#x7C7B;&#x578B;&#x662F;StatisticService</p>\n<p>&#x5230;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x62FF;&#x5230;&#x4E86;&#x57CB;&#x70B9;&#x7684;&#x6570;&#x636E;&#x5B57;&#x6BB5;&#xFF0C;&#x5E76;&#x521B;&#x5EFA;&#x4E86;&#x57CB;&#x70B9;&#x7684;&#x8C03;&#x7528;&#x5B57;&#x6BB5;mStatisticService&#xFF1B;&#x63A5;&#x4E0B;&#x6765;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x6CE8;&#x5165;&#x57CB;&#x70B9;&#x4EE3;&#x7801;&#x3002;</p>\n<p>&#x6838;&#x5FC3;&#x6CE8;&#x5165;&#x4EE3;&#x7801;&#x5728;visitMethod&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7528;&#x6765;&#x626B;&#x63CF;&#x7C7B;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x6240;&#x4EE5;&#x7C7B;&#x4E2D;&#x58F0;&#x660E;&#x7684;&#x65B9;&#x6CD5;&#x90FD;&#x4F1A;&#x5728;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#x8FDB;&#x884C;&#x626B;&#x63CF;&#x56DE;&#x8C03;&#x3002;</p>\n<p>&#x5728;visitMethod&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x627E;&#x5230;&#x76EE;&#x6807;&#x7684;&#x57CB;&#x70B9;&#x65B9;&#x6CD5;&#xFF0C;&#x5373;&#x4E4B;&#x524D;&#x58F0;&#x660E;&#x7684;&#x65B9;&#x6CD5;&#x6CE8;&#x89E3;TrackScan&#x4E0E;TrackClick&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun visitMethod(access: Int, name: String?, desc: String?, signature: String?, exceptions: Array&lt;out String&gt;?): MethodVisitor {</span><br><span class=\"line\">    val mv = cv.visitMethod(access, name, desc, signature, exceptions)</span><br><span class=\"line\">    return object : AdviceAdapter(Opcodes.ASM5, mv, access, name, desc) {</span><br><span class=\"line\"> </span><br><span class=\"line\">        private var mMethodAnnotationDesc: String? = null</span><br><span class=\"line\"> </span><br><span class=\"line\">        override fun visitAnnotation(desc: String?, visible: Boolean): AnnotationVisitor {</span><br><span class=\"line\">            LocalConfig.methodVisitorConfig?.visitAnnotation?.invoke(desc, visible)</span><br><span class=\"line\">            mMethodAnnotationDesc = desc</span><br><span class=\"line\">            return super.visitAnnotation(desc, visible)</span><br><span class=\"line\">        }</span><br><span class=\"line\">        override fun onMethodExit(opcode: Int) {</span><br><span class=\"line\">            super.onMethodExit(opcode)</span><br><span class=\"line\">            LocalConfig.methodVisitorConfig?.onMethodExit?.invoke(opcode)</span><br><span class=\"line\">            // &#x9ED8;&#x8BA4;&#x6784;&#x9020;&#x65B9;&#x6CD5;init</span><br><span class=\"line\">            if (name == INIT_METHOD_NAME /** &amp;&amp; desc == INIT_METHOD_DESC **/ &amp;&amp; mFieldPresent) {</span><br><span class=\"line\">                // &#x6CE8;&#x5165;&#xFF1A;&#x5411;&#x9ED8;&#x8BA4;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x5B9E;&#x4F8B;&#x5316;statisticService</span><br><span class=\"line\">                injectStatisticService(mv, Statistic.INSTANCE, statisticServiceField.copy(owner = mClassName ?: &quot;&quot;))</span><br><span class=\"line\">            } else if (mMethodAnnotationDesc == TRACK_CLICK_DESC &amp;&amp; !mTrackDataName.isNullOrEmpty()) {</span><br><span class=\"line\">                // &#x6CE8;&#x5165;&#xFF1A;&#x65E5;&#x5FD7;</span><br><span class=\"line\">                injectLogUtils(mv, defaultLogUtilsConfig.copy(ldc = &quot;inject track click success.&quot;))</span><br><span class=\"line\">                // &#x6CE8;&#x5165;&#xFF1A;trackClick &#x70B9;&#x51FB;</span><br><span class=\"line\">                injectTrackClick(mv, TrackModel.INSTANCE, StatisticService.INSTANCE)</span><br><span class=\"line\">            } else if (mMethodAnnotationDesc == TRACK_SCAN_DESC &amp;&amp; !mTrackScanDataName.isNullOrEmpty()) {</span><br><span class=\"line\">                when (mTrackScanDataDesc) {</span><br><span class=\"line\">                    // &#x6570;&#x636E;&#x7C7B;&#x578B;&#x4E3A;List&lt;*&gt;</span><br><span class=\"line\">                    LIST_DESC -&gt; {</span><br><span class=\"line\">                        // &#x6CE8;&#x5165;&#xFF1A;&#x65E5;&#x5FD7;</span><br><span class=\"line\">                        injectLogUtils(mv, defaultLogUtilsConfig.copy(ldc = &quot;inject track scan success.&quot;))</span><br><span class=\"line\">                        // &#x6CE8;&#x5165;&#xFF1A;List &#x7C7B;&#x578B;&#x7684;TrackScan &#x66DD;&#x5149;</span><br><span class=\"line\">                        injectListTrackScan(mv, TrackModel.INSTANCE, StatisticService.INSTANCE)</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                    // &#x6570;&#x636E;&#x7C7B;&#x578B;&#x4E3A;TrackModel</span><br><span class=\"line\">                    TrackModel.DESC -&gt; {</span><br><span class=\"line\">                        // &#x6CE8;&#x5165;&#xFF1A;&#x65E5;&#x5FD7;</span><br><span class=\"line\">                        injectLogUtils(mv, defaultLogUtilsConfig.copy(ldc = &quot;inject track scan success.&quot;))</span><br><span class=\"line\">                        // &#x6CE8;&#x5165;: TrackScan &#x66DD;&#x5149;</span><br><span class=\"line\">                        injectTrackScan(mv, TrackModel.INSTANCE, StatisticService.INSTANCE)</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                    else -&gt; {</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD4;&#x56DE;&#x5E76;&#x5B9E;&#x73B0;AdviceAdapter&#xFF0C;&#x91CD;&#x5199;&#x5B83;&#x7684;visitAnnotation&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x81EA;&#x52A8;&#x626B;&#x63CF;&#x65B9;&#x6CD5;&#x7684;&#x6CE8;&#x89E3;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BE5;&#x65B9;&#x6CD5;&#x6765;&#x4FDD;&#x5B58;&#x5F53;&#x524D;&#x65B9;&#x6CD5;&#x7684;&#x6CE8;&#x89E3;&#x3002;</p>\n<p>&#x7136;&#x540E;&#x5728;onMethodExit&#x4E2D;&#xFF0C;&#x5373;&#x65B9;&#x6CD5;&#x7684;&#x5F00;&#x5934;&#x5904;&#x8FDB;&#x884C;&#x6CE8;&#x5165;&#x4EE3;&#x7801;&#x3002;</p>\n<p>&#x5728;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x4E3B;&#x8981;&#x505A;&#x4E09;&#x4EF6;&#x4E8B;</p>\n<ol>\n<li>&#x5411;&#x9ED8;&#x8BA4;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x5B9E;&#x4F8B;&#x5316;statisticService</li>\n<li>&#x6CE8;&#x5165;TrackClick &#x70B9;&#x51FB;</li>\n<li>&#x6CE8;&#x5165;TrackScan &#x66DD;&#x5149;</li>\n</ol>\n<p>&#x5177;&#x4F53;&#x7684;ASM&#x6CE8;&#x5165;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E4B;&#x524D;&#x8BF4;&#x7684;SM Bytecode Viewer Support Kotlin&#x63D2;&#x4EF6;&#x83B7;&#x53D6;&#x3002;</p>\n<p>&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x518D;&#x6765;&#x8FD0;&#x884C;&#x8FD0;&#x884C;&#x4E3B;&#x9879;&#x76EE;&#xFF0C;&#x4F60;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x57CB;&#x70B9;&#x4EE3;&#x7801;&#x5DF2;&#x7ECF;&#x81EA;&#x52A8;&#x6CE8;&#x5165;&#x6210;&#x529F;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x53CD;&#x7F16;&#x8BD1;&#x4E00;&#x4E0B;.class&#x6587;&#x4EF6;&#xFF0C;&#x6765;&#x770B;&#x4E0B;&#x6CE8;&#x5165;&#x540E;&#x7684;java&#x4EE3;&#x7801;</p>\n<h3 id=\"StatisticService&#x521D;&#x59CB;&#x5316;\"><a href=\"#StatisticService&#x521D;&#x59CB;&#x5316;\" class=\"headerlink\" title=\"StatisticService&#x521D;&#x59CB;&#x5316;\"></a>StatisticService&#x521D;&#x59CB;&#x5316;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public ProxyActivity() {</span><br><span class=\"line\">   boolean var2 = false;</span><br><span class=\"line\">   List var3 = (List)(new ArrayList());</span><br><span class=\"line\">   this.mTrackScanData = var3;</span><br><span class=\"line\">   // &#x4EE5;&#x4E0B;&#x662F;&#x6CE8;&#x5165;&#x4EE3;&#x7801;</span><br><span class=\"line\">   this.mStatisticService = (StatisticService)Statistic.Companion.getInstance().create(StatisticService.class);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x66DD;&#x5149;&#x57CB;&#x70B9;\"><a href=\"#&#x66DD;&#x5149;&#x57CB;&#x70B9;\" class=\"headerlink\" title=\"&#x66DD;&#x5149;&#x57CB;&#x70B9;\"></a>&#x66DD;&#x5149;&#x57CB;&#x70B9;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@TrackScan</span><br><span class=\"line\">public final void onScan() {</span><br><span class=\"line\">   this.mTrackScanData.add(new TrackModel(&quot;statistic_button&quot;, 0L, 2, (DefaultConstructorMarker)null));</span><br><span class=\"line\">   this.mTrackScanData.add(new TrackModel(&quot;statistic_text&quot;, 0L, 2, (DefaultConstructorMarker)null));</span><br><span class=\"line\">   // &#x4EE5;&#x4E0B;&#x662F;&#x6CE8;&#x5165;&#x4EE3;&#x7801;</span><br><span class=\"line\">   LogUtils.INSTANCE.d(&quot;inject track scan success.&quot;);</span><br><span class=\"line\">   Iterator var2 = this.mTrackScanData.iterator();</span><br><span class=\"line\"> </span><br><span class=\"line\">   while(var2.hasNext()) {</span><br><span class=\"line\">      TrackModel var1 = (TrackModel)var2.next();</span><br><span class=\"line\">      this.mStatisticService.trackScan(var1.getName());</span><br><span class=\"line\">   }</span><br><span class=\"line\"> </span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x70B9;&#x51FB;&#x57CB;&#x70B9;\"><a href=\"#&#x70B9;&#x51FB;&#x57CB;&#x70B9;\" class=\"headerlink\" title=\"&#x70B9;&#x51FB;&#x57CB;&#x70B9;\"></a>&#x70B9;&#x51FB;&#x57CB;&#x70B9;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@TrackClick</span><br><span class=\"line\">public final void onClick(@NotNull View view) {</span><br><span class=\"line\">   Intrinsics.checkParameterIsNotNull(view, &quot;view&quot;);</span><br><span class=\"line\">   this.mTrackModel.setTime(System.currentTimeMillis() / (long)1000);</span><br><span class=\"line\">   this.mTrackModel.setName(view.getId() == 2131230792 ? &quot;statistic_button&quot; : &quot;statistic_text&quot;);</span><br><span class=\"line\">   // &#x4EE5;&#x4E0B;&#x662F;&#x6CE8;&#x5165;&#x4EE3;&#x7801;</span><br><span class=\"line\">   LogUtils.INSTANCE.d(&quot;inject track click success.&quot;);</span><br><span class=\"line\">   this.mStatisticService.trackClick(this.mTrackModel.getName(), this.mTrackModel.getTime());</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4EE5;&#x4E0A;&#x81EA;&#x52A8;&#x5316;&#x57CB;&#x70B9;&#x4EE3;&#x7801;&#x5C31;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x4E86;&#x3002;</p>\n<p>&#x7B80;&#x5355;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#xFF0C;&#x6240;&#x7528;&#x5230;&#x7684;&#x6280;&#x672F;&#x6709;</p>\n<ol>\n<li>gradle plugin&#x63D2;&#x4EF6;&#x7684;&#x81EA;&#x5B9A;&#x4E49;</li>\n<li>gradle transform&#x63D0;&#x4F9B;&#x7F16;&#x8BD1;&#x4E2D;&#x5B57;&#x8282;&#x7801;&#x7684;&#x4FEE;&#x6539;&#x5165;&#x53E3;</li>\n<li>asm&#x63D0;&#x4F9B;&#x4EE3;&#x7801;&#x7684;&#x6CE8;&#x5165;&#x5B9E;&#x73B0;</li>\n</ol>\n<p>&#x5176;&#x4E2D;1&#x3001;2&#x90FD;&#x6709;&#x73B0;&#x6210;&#x7684;&#x5B9E;&#x73B0;&#x5957;&#x8DEF;&#xFF0C;&#x6211;&#x4EEC;&#x771F;&#x6B63;&#x9700;&#x8981;&#x505A;&#x7684;&#x5F88;&#x5C11;&#xFF0C;&#x6838;&#x5FC3;&#x90E8;&#x5206;&#x8FD8;&#x662F;&#x901A;&#x8FC7;asm&#x6765;&#x7F16;&#x5199;&#x9700;&#x8981;&#x6CE8;&#x5165;&#x7684;&#x4EE3;&#x7801;&#x903B;&#x8F91;&#x3002;&#x4E0D;&#x7BA1;&#x662F;&#x76F4;&#x63A5;&#x6CE8;&#x5165;&#xFF0C;&#x8FD8;&#x662F;&#x501F;&#x52A9;&#x6CE8;&#x89E3;&#x6765;&#x6CE8;&#x5165;&#xFF0C;&#x672C;&#x8D28;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>\n<p>&#x53EA;&#x8981;&#x638C;&#x63E1;&#x4EE5;&#x4E0A;&#x51E0;&#x70B9;&#xFF0C;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x4EFB;&#x610F;&#x7684;&#x81EA;&#x52A8;&#x5316;&#x4EE3;&#x7801;&#x6CE8;&#x5165;&#x3002;&#x4ECE;&#x6B64;&#x4EE5;&#x540E;&#x200B;&#x8BA9;&#x6211;&#x4EEC;&#x8FDB;&#x5165;&#x6478;&#x9C7C;&#x65F6;&#x4EE3;&#xFF0C;&#x4EE5;&#x540E;&#x518D;&#x4E5F;&#x4E0D;&#x7528;&#x52A0;&#x73ED;&#x5566;~</p>\n<p>&#x53E6;&#x5916;&#x6587;&#x7AE0;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x53EF;&#x4EE5;&#x5230;Github&#x7684;android-api-analysis&#x9879;&#x76EE;&#x4E2D;&#x67E5;&#x770B;&#x3002;</p>\n<blockquote>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/android-api-analysis</a></p>\n</blockquote>\n<p>&#x67E5;&#x770B;&#x65F6;&#x8BF7;&#x5C06;&#x5206;&#x652F;&#x5207;&#x6362;&#x5230;feat_transform_dev</p>\n<h2 id=\"&#x63A8;&#x8350;\"><a href=\"#&#x63A8;&#x8350;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;\"></a>&#x63A8;&#x8350;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["android"]},{"title":"Binder: ServiceManager的创建","url":"https://www.rousetime.com/2021/02/01/Binder-ServiceManager的创建/","content":"<p>&#x627F;&#x63A5;<a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247485610&amp;idx=1&amp;sn=2ef38084699d2fcc5241a6cc57772751&amp;chksm=e8e0f13adf97782c65cb0b8204ad75d11e53b05ea361f66c01a5b352869aa7cf09fcd3168193&amp;token=963105090&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Binder: addService&#x521D;&#x63A2;</a>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;Client&#x7AEF;&#x901A;&#x8FC7;BpBinder&#x7684;transact&#x65B9;&#x6CD5;&#x4E0E;service&#x7AEF;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF0C;&#x5728;BpBinder&#x7684;transact&#x65B9;&#x6CD5;&#x4E2D;&#x53C8;&#x901A;&#x8FC7;IPCThreadState&#x7684;transact&#x65B9;&#x6CD5;&#x5C06;&#x6570;&#x636E;&#x4F20;&#x9012;&#x5230;service&#x7AEF;&#x3002;</p>\n<p>&#x6700;&#x7EC8;&#x6765;&#x5230;IPCThreadState&#x7684;writeTransactionData&#x65B9;&#x6CD5;</p>\n<blockquote>\n<p>frameworks/native/libs/binder/IPCThreadState.cpp</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">status_t IPCThreadState::writeTransactionData(int32_t cmd, uint32_t binderFlags,</span><br><span class=\"line\">    int32_t handle, uint32_t code, const Parcel&amp; data, status_t* statusBuffer)</span><br><span class=\"line\">{</span><br><span class=\"line\">    binder_transaction_data tr;</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x5C06;&#x6570;&#x636E;&#x5C01;&#x88C5;&#x5230;tr&#x4E2D;</span><br><span class=\"line\">    tr.target.ptr = 0;</span><br><span class=\"line\">    tr.target.handle = handle; // handle = 0, &#x5B9A;&#x4F4D;&#x5230;ServiceManager</span><br><span class=\"line\">    tr.code = code; // &#x64CD;&#x4F5C;&#x7801; ADD_SERVICE_TRANSACTION</span><br><span class=\"line\">    tr.flags = binderFlags;</span><br><span class=\"line\">    tr.cookie = 0;</span><br><span class=\"line\">    tr.sender_pid = 0;</span><br><span class=\"line\">    tr.sender_euid = 0;</span><br><span class=\"line\"> </span><br><span class=\"line\">    const status_t err = data.errorCheck();</span><br><span class=\"line\">    if (err == NO_ERROR) {</span><br><span class=\"line\">        tr.data_size = data.ipcDataSize();</span><br><span class=\"line\">        tr.data.ptr.buffer = data.ipcData();</span><br><span class=\"line\">        tr.offsets_size = data.ipcObjectsCount()*sizeof(binder_size_t);</span><br><span class=\"line\">        tr.data.ptr.offsets = data.ipcObjects();</span><br><span class=\"line\">    } else if (statusBuffer) {</span><br><span class=\"line\">        tr.flags |= TF_STATUS_CODE;</span><br><span class=\"line\">        *statusBuffer = err;</span><br><span class=\"line\">        tr.data_size = sizeof(status_t);</span><br><span class=\"line\">        tr.data.ptr.buffer = reinterpret_cast&lt;uintptr_t&gt;(statusBuffer);</span><br><span class=\"line\">        tr.offsets_size = 0;</span><br><span class=\"line\">        tr.data.ptr.offsets = 0;</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        return (mLastError = err);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    mOut.writeInt32(cmd); // &#x6307;&#x4EE4;&#x7801; BC_TRANSACTION</span><br><span class=\"line\">    // &#x5199;&#x5165;&#x6570;&#x636E;&#xFF0C;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x4F20;&#x9012;</span><br><span class=\"line\">    mOut.write(&amp;tr, sizeof(tr));</span><br><span class=\"line\"> </span><br><span class=\"line\">    return NO_ERROR;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x4F20;&#x9012;&#x6570;&#x636E;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;handle = 0&#x6765;&#x5B9A;&#x4F4D;&#x5230;service&#x7684;service_manager&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x5206;&#x6790;&#x4E00;&#x4E0B;ServiceManager&#x7684;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;&#x3002;</p>\n<h2 id=\"ServiceManager\"><a href=\"#ServiceManager\" class=\"headerlink\" title=\"ServiceManager\"></a>ServiceManager</h2><p>ServiceManager&#x662F;&#x4F34;&#x968F;&#x7740;Android init &#x542F;&#x52A8;&#x4E00;&#x8D77;&#x88AB;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x5728;init.rc&#x6587;&#x4EF6;&#x4E2D;&#x8FDB;&#x884C;&#x58F0;&#x660E;&#x7684;&#x3002;</p>\n<p>&#x5176;&#x6240;&#x5BF9;&#x5E94;&#x7684;&#x53EF;&#x6267;&#x884C;&#x7A0B;&#x5E8F;&#x662F;/system/bin/servicemanager&#xFF0C;&#x6240;&#x5BF9;&#x5E94;&#x7684;&#x6E90;&#x6587;&#x4EF6;&#x662F;service_manager.c&#xFF0C;&#x8FDB;&#x7A0B;&#x540D;&#x4E3A;/system/bin/servicemanager&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service servicemanager /system/bin/servicemanager</span><br><span class=\"line\">    class core</span><br><span class=\"line\">    user system</span><br><span class=\"line\">    group system</span><br><span class=\"line\">    critical</span><br><span class=\"line\">    onrestart restart healthd</span><br><span class=\"line\">    onrestart restart zygote</span><br><span class=\"line\">    onrestart restart media</span><br><span class=\"line\">    onrestart restart surfaceflinger</span><br><span class=\"line\">    onrestart restart drm</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x542F;&#x52A8;ServiceManager&#x7684;&#x5165;&#x53E3;&#x5728;service_manager.c&#x7684;main&#x65B9;&#x6CD5;&#x4E2D;</p>\n<h3 id=\"main\"><a href=\"#main\" class=\"headerlink\" title=\"main\"></a>main</h3><blockquote>\n<p>frameworks/native/cmds/servicemanager/service_manager.c</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int main(int argc, char** argv)</span><br><span class=\"line\">{</span><br><span class=\"line\">    struct binder_state *bs;</span><br><span class=\"line\">    union selinux_callback cb;</span><br><span class=\"line\">    char *driver;</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (argc &gt; 1) {</span><br><span class=\"line\">        driver = argv[1];</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        driver = &quot;/dev/binder&quot;;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x6253;&#x5F00;binder&#x9A71;&#x52A8;</span><br><span class=\"line\">    bs = binder_open(driver, 128*1024);</span><br><span class=\"line\">  </span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x5C06;ServiceManager&#x8BBE;&#x7F6E;&#x6210;binder&#x7684;&#x5B88;&#x62A4;&#x8005;</span><br><span class=\"line\">    if (binder_become_context_manager(bs)) {</span><br><span class=\"line\">        ALOGE(&quot;cannot become context manager (%s)\\n&quot;, strerror(errno));</span><br><span class=\"line\">        return -1;</span><br><span class=\"line\">    }</span><br><span class=\"line\">  </span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x5F00;&#x542F;binder&#x5FAA;&#x73AF;&#xFF0C;&#x76D1;&#x542C;&#x6570;&#x636E;&#x7684;&#x5230;&#x6765;</span><br><span class=\"line\">    binder_loop(bs, svcmgr_handler);</span><br><span class=\"line\">  </span><br><span class=\"line\">    return 0;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;main&#x65B9;&#x6CD5;&#x4E2D;&#x4E3B;&#x8981;&#x505A;&#x4E86;&#x4E09;&#x4EF6;&#x4E8B;</p>\n<ol>\n<li>&#x901A;&#x8FC7;binder_open&#x6253;&#x5F00;binder&#x9A71;&#x52A8;&#xFF0C;&#x7533;&#x8BF7;128kb&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x7A7A;&#x95F4;</li>\n<li>&#x901A;&#x8FC7;binder_become_context_manager&#x5C06;ServiceManager&#x8BBE;&#x7F6E;&#x6210;binder&#x7684;&#x5B88;&#x62A4;&#x8005;</li>\n<li>&#x901A;&#x8FC7;binder_loop&#x5F00;&#x542F;binder&#x5FAA;&#x73AF;&#xFF0C;&#x76D1;&#x542C;&#x6570;&#x636E;</li>\n</ol>\n<h2 id=\"binder-open\"><a href=\"#binder-open\" class=\"headerlink\" title=\"binder_open\"></a>binder_open</h2><blockquote>\n<p>frameworks/native/cmds/servicemanager/binder.c</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">struct binder_state *binder_open(const char* driver, size_t mapsize)</span><br><span class=\"line\">{</span><br><span class=\"line\">    struct binder_state *bs;</span><br><span class=\"line\">    struct binder_version vers;</span><br><span class=\"line\"> </span><br><span class=\"line\">    bs = malloc(sizeof(*bs));</span><br><span class=\"line\">    if (!bs) {</span><br><span class=\"line\">        errno = ENOMEM;</span><br><span class=\"line\">        return NULL;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x5F00;&#x542F;binder&#x9A71;&#x52A8;</span><br><span class=\"line\">    bs-&gt;fd = open(driver, O_RDWR | O_CLOEXEC);</span><br><span class=\"line\">    if (bs-&gt;fd &lt; 0) {</span><br><span class=\"line\">        fprintf(stderr,&quot;binder: cannot open %s (%s)\\n&quot;,</span><br><span class=\"line\">                driver, strerror(errno));</span><br><span class=\"line\">        goto fail_open;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x83B7;&#x53D6;binder&#x7248;&#x672C;&#x4FE1;&#x606F;</span><br><span class=\"line\">    if ((ioctl(bs-&gt;fd, BINDER_VERSION, &amp;vers) == -1) ||</span><br><span class=\"line\">        (vers.protocol_version != BINDER_CURRENT_PROTOCOL_VERSION)) {</span><br><span class=\"line\">        fprintf(stderr,</span><br><span class=\"line\">                &quot;binder: kernel driver version (%d) differs from user space version (%d)\\n&quot;,</span><br><span class=\"line\">                vers.protocol_version, BINDER_CURRENT_PROTOCOL_VERSION);</span><br><span class=\"line\">        goto fail_open;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x8BBE;&#x7F6E;mmap&#x6620;&#x5C04;&#x5927;&#x5C0F;128kb</span><br><span class=\"line\">    bs-&gt;mapsize = mapsize;</span><br><span class=\"line\">    // &#x8BBE;&#x7F6E;&#x5185;&#x5B58;&#x6620;&#x5C04;&#x5730;&#x5740;</span><br><span class=\"line\">    bs-&gt;mapped = mmap(NULL, mapsize, PROT_READ, MAP_PRIVATE, bs-&gt;fd, 0);</span><br><span class=\"line\">    if (bs-&gt;mapped == MAP_FAILED) {</span><br><span class=\"line\">        fprintf(stderr,&quot;binder: cannot map device (%s)\\n&quot;,</span><br><span class=\"line\">                strerror(errno));</span><br><span class=\"line\">        goto fail_map;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    return bs;</span><br><span class=\"line\"> </span><br><span class=\"line\">fail_map:</span><br><span class=\"line\">    close(bs-&gt;fd);</span><br><span class=\"line\">fail_open:</span><br><span class=\"line\">    free(bs);</span><br><span class=\"line\">    return NULL;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x5BF9;bs&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x4E09;&#x4E2A;&#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x8D4B;&#x503C;&#xFF0C;&#x5B83;&#x662F;binder_state&#x7C7B;&#x578B;&#x7684;&#x7ED3;&#x6784;&#x4F53;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">struct binder_state</span><br><span class=\"line\">{</span><br><span class=\"line\">    int fd; // dev/binder &#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;</span><br><span class=\"line\">    void *mapped; // &#x6620;&#x5C04;&#x7684;&#x5185;&#x5B58;&#x5730;&#x5740;</span><br><span class=\"line\">    size_t mapsize; // &#x6620;&#x5C04;&#x7684;&#x5927;&#x5C0F;</span><br><span class=\"line\">};</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;binder_open&#x4E3B;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x662F;</p>\n<ol>\n<li>&#x6253;&#x5F00;binder&#x9A71;&#x52A8;</li>\n<li>&#x9A8C;&#x8BC1;binder&#x7248;&#x672C;&#x4FE1;&#x606F;</li>\n<li>&#x8BBE;&#x7F6E;mmap&#x5185;&#x5B58;&#x6620;&#x5C04;&#x5927;&#x5C0F;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;128kb</li>\n<li>&#x8BBE;&#x7F6E;mmap&#x5185;&#x5B58;&#x6620;&#x5C04;&#x7684;&#x5730;&#x5740;</li>\n</ol>\n<h2 id=\"binder-become-context-manager\"><a href=\"#binder-become-context-manager\" class=\"headerlink\" title=\"binder_become_context_manager\"></a>binder_become_context_manager</h2><blockquote>\n<p>frameworks/native/cmds/servicemanager/binder.c</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int binder_become_context_manager(struct binder_state *bs)</span><br><span class=\"line\">{</span><br><span class=\"line\">    struct flat_binder_object obj;</span><br><span class=\"line\">    // &#x521D;&#x59CB;&#x5316;obj</span><br><span class=\"line\">    memset(&amp;obj, 0, sizeof(obj));</span><br><span class=\"line\">    obj.flags = FLAT_BINDER_FLAG_TXN_SECURITY_CTX;</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x4E0E;binder&#x9A71;&#x52A8;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x901A;&#x4FE1;</span><br><span class=\"line\">    int result = ioctl(bs-&gt;fd, BINDER_SET_CONTEXT_MGR_EXT, &amp;obj);</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (result != 0) {</span><br><span class=\"line\">        android_errorWriteLog(0x534e4554, &quot;121035042&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        // &#x4E0E;binder&#x9A71;&#x52A8;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x901A;&#x4FE1;</span><br><span class=\"line\">        result = ioctl(bs-&gt;fd, BINDER_SET_CONTEXT_MGR, 0);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return result;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;binder_become_context_manager&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;ioctl&#x4E0E;binder&#x9A71;&#x52A8;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF0C;&#x5E76;&#x4F20;&#x5165;&#x6570;&#x636E;0&#x4F5C;&#x4E3A;&#x6807;&#x8BC6;&#xFF0C;&#x5C06;ServiceManager&#x8BBE;&#x7F6E;&#x4E3A;binder&#x7684;&#x5B88;&#x62A4;&#x8005;&#xFF0C;&#x7528;&#x6765;&#x7EDF;&#x4E00;&#x5904;&#x7406;binder&#x7684;&#x6570;&#x636E;&#x4F20;&#x8F93;&#x3002;</p>\n<h2 id=\"binder-loop\"><a href=\"#binder-loop\" class=\"headerlink\" title=\"binder_loop\"></a>binder_loop</h2><blockquote>\n<p>frameworks/native/cmds/servicemanager/binder.c</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void binder_loop(struct binder_state *bs, binder_handler func)</span><br><span class=\"line\">{</span><br><span class=\"line\">  int res;</span><br><span class=\"line\">  struct binder_write_read bwr;</span><br><span class=\"line\">  uint32_t readbuf[32];</span><br><span class=\"line\"> </span><br><span class=\"line\">  bwr.write_size = 0;</span><br><span class=\"line\">  bwr.write_consumed = 0;</span><br><span class=\"line\">  bwr.write_buffer = 0;</span><br><span class=\"line\"> </span><br><span class=\"line\">  readbuf[0] = BC_ENTER_LOOPER;</span><br><span class=\"line\">  // &#x5199;&#x5165;&#x6570;&#x636E;</span><br><span class=\"line\">  binder_write(bs, readbuf, sizeof(uint32_t));</span><br><span class=\"line\"> </span><br><span class=\"line\">  // &#x5F00;&#x542F;&#x5FAA;&#x73AF;&#xFF0C;&#x76D1;&#x542C;&#x6570;&#x636E;&#x7684;&#x5230;&#x6765;</span><br><span class=\"line\">  for (;;) {</span><br><span class=\"line\">      bwr.read_size = sizeof(readbuf);</span><br><span class=\"line\">      bwr.read_consumed = 0;</span><br><span class=\"line\">      bwr.read_buffer = (uintptr_t) readbuf;</span><br><span class=\"line\"> </span><br><span class=\"line\">      // &#x83B7;&#x53D6;binder&#x9A71;&#x52A8;&#x4E2D;&#x7684;&#x6570;&#x636E;</span><br><span class=\"line\">      res = ioctl(bs-&gt;fd, BINDER_WRITE_READ, &amp;bwr);</span><br><span class=\"line\"> </span><br><span class=\"line\">      if (res &lt; 0) {</span><br><span class=\"line\">          ALOGE(&quot;binder_loop: ioctl failed (%s)\\n&quot;, strerror(errno));</span><br><span class=\"line\">          break;</span><br><span class=\"line\">      }</span><br><span class=\"line\"> </span><br><span class=\"line\">      // &#x89E3;&#x6790;&#x6570;&#x636E;</span><br><span class=\"line\">      res = binder_parse(bs, 0, (uintptr_t) readbuf, bwr.read_consumed, func);</span><br><span class=\"line\">      if (res == 0) {</span><br><span class=\"line\">          ALOGE(&quot;binder_loop: unexpected reply?!\\n&quot;);</span><br><span class=\"line\">          break;</span><br><span class=\"line\">      }</span><br><span class=\"line\">      if (res &lt; 0) {</span><br><span class=\"line\">          ALOGE(&quot;binder_loop: io error %d %s\\n&quot;, res, strerror(errno));</span><br><span class=\"line\">          break;</span><br><span class=\"line\">      }</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;binder_loop&#x4E2D;&#x4E3B;&#x8981;&#x505A;&#x4E86;&#x4E09;&#x4EF6;&#x4E8B;&#xFF1A;</p>\n<ol>\n<li>&#x9996;&#x5148;&#x901A;&#x8FC7;binder_write&#x4F20;&#x9012;BC_ENTER_LOOPER&#x6307;&#x4EE4;&#x7801;&#xFF0C;&#x544A;&#x8BC9;binder&#x8FDB;&#x5165;&#x5FAA;&#x73AF;</li>\n<li>&#x5F00;&#x542F;&#x5FAA;&#x5E8F;&#xFF0C;&#x901A;&#x8FC7;ioctl&#x76D1;&#x542C;&#x5E76;&#x8BFB;&#x53D6;&#x6570;&#x636E;</li>\n<li>&#x4E00;&#x65E6;&#x8BFB;&#x53D6;&#x5230;&#x6570;&#x636E;&#xFF0C;&#x5C06;&#x901A;&#x8FC7;binder_parse&#x6765;&#x8FDB;&#x4E00;&#x6B65;&#x89E3;&#x6790;</li>\n</ol>\n<h3 id=\"binder-write\"><a href=\"#binder-write\" class=\"headerlink\" title=\"binder_write\"></a>binder_write</h3><blockquote>\n<p>frameworks/native/cmds/servicemanager/binder.c</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int binder_write(struct binder_state *bs, void *data, size_t len)</span><br><span class=\"line\">{</span><br><span class=\"line\">  struct binder_write_read bwr;</span><br><span class=\"line\">  int res;</span><br><span class=\"line\"> </span><br><span class=\"line\">  // &#x5C06;&#x6570;&#x636E;&#x586B;&#x5145;&#x5230;bwr&#x4E2D;</span><br><span class=\"line\">  bwr.write_size = len;</span><br><span class=\"line\">  bwr.write_consumed = 0;</span><br><span class=\"line\">  bwr.write_buffer = (uintptr_t) data;</span><br><span class=\"line\">  bwr.read_size = 0;</span><br><span class=\"line\">  bwr.read_consumed = 0;</span><br><span class=\"line\">  bwr.read_buffer = 0;</span><br><span class=\"line\">  // &#x4F20;&#x8F93;&#x6570;&#x636E;</span><br><span class=\"line\">  res = ioctl(bs-&gt;fd, BINDER_WRITE_READ, &amp;bwr);</span><br><span class=\"line\">  if (res &lt; 0) {</span><br><span class=\"line\">      fprintf(stderr,&quot;binder_write: ioctl failed (%s)\\n&quot;,</span><br><span class=\"line\">              strerror(errno));</span><br><span class=\"line\">  }</span><br><span class=\"line\">  return res;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x662F;&#x5C06;&#x6570;&#x636E;&#x7EDF;&#x4E00;&#x5C01;&#x88C5;&#x5230;bwr&#x4E2D;&#xFF0C;bwr&#x662F;binder_write_read&#x7684;&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x5F53;&#x5199;&#x6570;&#x636E;&#x65F6;&#x4F1A;&#x5C06;&#x6570;&#x636E;&#x5199;&#x5165;&#x5230;write_buffer&#x4E2D;&#xFF0C;&#x800C;&#x5F53;&#x8BFB;&#x6570;&#x636E;&#x65F6;&#x4F1A;&#x4ECE;read_buffer&#x4E2D;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x652F;&#x6301;&#x53CC;&#x5411;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x7684;&#x6570;&#x636E;&#x6E90;&#x3002;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;ioctl&#x4E0E;binder&#x9A71;&#x52A8;&#x8FDB;&#x884C;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x3002;</p>\n<p>&#x7531;&#x4E8E;&#x662F;&#x9996;&#x6B21;&#x8FDB;&#x5165;&#x4E14;&#x5373;&#x5C06;&#x8FDB;&#x5165;&#x5FAA;&#x5E8F;&#x64CD;&#x4F5C;&#xFF0C;&#x6240;&#x4EE5;&#x7B2C;&#x4E00;&#x6B21;&#x4F1A;&#x4F20;&#x9012;BC_ENTER_LOOPER&#x6307;&#x4EE4;&#x7801;&#xFF0C;&#x901A;&#x77E5;binder&#x8FDB;&#x884C;&#x5FAA;&#x73AF;&#x64CD;&#x4F5C;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x901A;&#x8FC7;ioctl&#x53D1;&#x9001;BINDER_WRITE_READ&#x7684;&#x901A;&#x4FE1;code&#xFF0C;&#x5C06;bwr&#x4F20;&#x9012;&#x7ED9;binder&#x9A71;&#x52A8;&#x3002;</p>\n<h3 id=\"binder-parse\"><a href=\"#binder-parse\" class=\"headerlink\" title=\"binder_parse\"></a>binder_parse</h3><blockquote>\n<p>frameworks/native/cmds/servicemanager/binder.c</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int binder_parse(struct binder_state *bs, struct binder_io *bio,</span><br><span class=\"line\">               uintptr_t ptr, size_t size, binder_handler func)</span><br><span class=\"line\">{</span><br><span class=\"line\">  int r = 1;</span><br><span class=\"line\">  // &#x83B7;&#x53D6;&#x6570;&#x636E;&#x622A;&#x6B62;&#x4F4D;&#x7684;&#x5185;&#x5B58;&#x5730;&#x5740;</span><br><span class=\"line\">  uintptr_t end = ptr + (uintptr_t) size;</span><br><span class=\"line\">  while (ptr &lt; end) {</span><br><span class=\"line\">      uint32_t cmd = *(uint32_t *) ptr;</span><br><span class=\"line\">      ptr += sizeof(uint32_t);</span><br><span class=\"line\">      switch(cmd) {</span><br><span class=\"line\"> </span><br><span class=\"line\">      ...</span><br><span class=\"line\"> </span><br><span class=\"line\">      case BR_TRANSACTION: {</span><br><span class=\"line\">          struct binder_transaction_data_secctx txn;</span><br><span class=\"line\"> </span><br><span class=\"line\">          ...</span><br><span class=\"line\"> </span><br><span class=\"line\">          if (func) {</span><br><span class=\"line\">              unsigned rdata[256/4];</span><br><span class=\"line\">              struct binder_io msg;</span><br><span class=\"line\">              struct binder_io reply;</span><br><span class=\"line\">              int res;</span><br><span class=\"line\"> </span><br><span class=\"line\">              bio_init(&amp;reply, rdata, sizeof(rdata), 4);</span><br><span class=\"line\">              bio_init_from_txn(&amp;msg, &amp;txn.transaction_data);</span><br><span class=\"line\"> </span><br><span class=\"line\">              // &#x8C03;&#x7528;func&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x662F;svcmgr_handler</span><br><span class=\"line\">              res = func(bs, &amp;txn, &amp;msg, &amp;reply);</span><br><span class=\"line\">              if (txn.transaction_data.flags &amp; TF_ONE_WAY) {</span><br><span class=\"line\">                  binder_free_buffer(bs, txn.transaction_data.data.ptr.buffer);</span><br><span class=\"line\">              } else {</span><br><span class=\"line\">                  // &#x53D1;&#x9001;reply</span><br><span class=\"line\">                  binder_send_reply(bs, &amp;reply, txn.transaction_data.data.ptr.buffer, res);</span><br><span class=\"line\">              }</span><br><span class=\"line\">          }</span><br><span class=\"line\">          break;</span><br><span class=\"line\">      }</span><br><span class=\"line\"> </span><br><span class=\"line\">      ...</span><br><span class=\"line\"> </span><br><span class=\"line\">      case BR_REPLY: {</span><br><span class=\"line\"> </span><br><span class=\"line\">          ...</span><br><span class=\"line\"> </span><br><span class=\"line\">          break;</span><br><span class=\"line\">      }</span><br><span class=\"line\">      default:</span><br><span class=\"line\">          ALOGE(&quot;parse: OOPS %d\\n&quot;, cmd);</span><br><span class=\"line\">          return -1;</span><br><span class=\"line\">      }</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  return r;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>binder_parse&#x4E2D;&#x4E3B;&#x8981;&#x662F;&#x89E3;&#x6790;binder&#x4FE1;&#x606F;&#xFF0C;&#x53C2;&#x6570;ptr&#x6307;&#x5411;BC_ENTER_LOOPER&#xFF0C;func&#x6307;&#x5411;svcmgr_handler&#x3002;&#x6240;&#x4EE5;&#x4E00;&#x65E6;&#x8BF7;&#x6C42;&#x5230;&#x6765;&#xFF0C;&#x4F1A;&#x8C03;&#x7528;svcmgr_handler&#xFF0C;&#x5E76;&#x5C06;&#x5904;&#x7406;&#x7684;&#x7ED3;&#x6784;&#x901A;&#x8FC7;binder_send_reply&#x8FD4;&#x56DE;&#x4F1A;&#x7ED9;client&#x7AEF;&#x3002;&#x8FD9;&#x4E2A;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;&#x4E4B;&#x524D;&#x6587;&#x7AE0;&#x4E2D;&#x8BF4;&#x7684;BC_REPLAY&#x3002;</p>\n<p>&#x8FD9;&#x4E2A;svcmgr_handler&#x662F;&#x5728;&#x6700;&#x5916;&#x9762;&#x7684;binder_loop&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;&#x3002;</p>\n<h3 id=\"svcmgr-handler\"><a href=\"#svcmgr-handler\" class=\"headerlink\" title=\"svcmgr_handler\"></a>svcmgr_handler</h3><blockquote>\n<p>frameworks/native/cmds/servicemanager/service_manager.c</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int svcmgr_handler(struct binder_state *bs,</span><br><span class=\"line\">                   struct binder_transaction_data_secctx *txn_secctx,</span><br><span class=\"line\">                   struct binder_io *msg,</span><br><span class=\"line\">                   struct binder_io *reply)</span><br><span class=\"line\">{</span><br><span class=\"line\">    struct svcinfo *si;</span><br><span class=\"line\">    uint16_t *s;</span><br><span class=\"line\">    size_t len;</span><br><span class=\"line\">    uint32_t handle;</span><br><span class=\"line\">    uint32_t strict_policy;</span><br><span class=\"line\">    int allow_isolated;</span><br><span class=\"line\">    uint32_t dumpsys_priority;</span><br><span class=\"line\"> </span><br><span class=\"line\">    struct binder_transaction_data *txn = &amp;txn_secctx-&gt;transaction_data;</span><br><span class=\"line\"> </span><br><span class=\"line\">    switch(txn-&gt;code) {</span><br><span class=\"line\">    case SVC_MGR_GET_SERVICE:</span><br><span class=\"line\">    case SVC_MGR_CHECK_SERVICE:</span><br><span class=\"line\">        s = bio_get_string16(msg, &amp;len);</span><br><span class=\"line\">        if (s == NULL) {</span><br><span class=\"line\">            return -1;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        // &#x67E5;&#x627E;service</span><br><span class=\"line\">        handle = do_find_service(s, len, txn-&gt;sender_euid, txn-&gt;sender_pid,</span><br><span class=\"line\">                                 (const char*) txn_secctx-&gt;secctx);</span><br><span class=\"line\">        if (!handle)</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        bio_put_ref(reply, handle);</span><br><span class=\"line\">        return 0;</span><br><span class=\"line\"> </span><br><span class=\"line\">    case SVC_MGR_ADD_SERVICE:</span><br><span class=\"line\">        s = bio_get_string16(msg, &amp;len);</span><br><span class=\"line\">        if (s == NULL) {</span><br><span class=\"line\">            return -1;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        handle = bio_get_ref(msg);</span><br><span class=\"line\">        allow_isolated = bio_get_uint32(msg) ? 1 : 0;</span><br><span class=\"line\">        dumpsys_priority = bio_get_uint32(msg);</span><br><span class=\"line\"> </span><br><span class=\"line\">        // &#x6CE8;&#x518C;service</span><br><span class=\"line\">        if (do_add_service(bs, s, len, handle, txn-&gt;sender_euid, allow_isolated, dumpsys_priority,</span><br><span class=\"line\">                           txn-&gt;sender_pid, (const char*) txn_secctx-&gt;secctx))</span><br><span class=\"line\">            return -1;</span><br><span class=\"line\">        break;</span><br><span class=\"line\">    case SVC_MGR_LIST_SERVICES: {</span><br><span class=\"line\">        uint32_t n = bio_get_uint32(msg);</span><br><span class=\"line\">        uint32_t req_dumpsys_priority = bio_get_uint32(msg);</span><br><span class=\"line\">        if (!svc_can_list(txn-&gt;sender_pid, (const char*) txn_secctx-&gt;secctx, txn-&gt;sender_euid)) {</span><br><span class=\"line\">            ALOGE(&quot;list_service() uid=%d - PERMISSION DENIED\\n&quot;,</span><br><span class=\"line\">                    txn-&gt;sender_euid);</span><br><span class=\"line\">            return -1;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        si = svclist;</span><br><span class=\"line\"> </span><br><span class=\"line\">        // &#x904D;&#x5386;service</span><br><span class=\"line\">        while (si) {</span><br><span class=\"line\">            if (si-&gt;dumpsys_priority &amp; req_dumpsys_priority) {</span><br><span class=\"line\">                if (n == 0) break;</span><br><span class=\"line\">                n--;</span><br><span class=\"line\">            }</span><br><span class=\"line\">            si = si-&gt;next;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        if (si) {</span><br><span class=\"line\">            bio_put_string16(reply, si-&gt;name);</span><br><span class=\"line\">            return 0;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        return -1;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    default:</span><br><span class=\"line\">        ALOGE(&quot;unknown code %d\\n&quot;, txn-&gt;code);</span><br><span class=\"line\">        return -1;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    bio_put_uint32(reply, 0);</span><br><span class=\"line\">    return 0;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>svcmgr_handler&#x4E3B;&#x8981;&#x662F;&#x5BF9;service&#x7684;&#x64CD;&#x4F5C;&#x5904;&#x7406;&#xFF0C;&#x4F8B;&#x5982;&#x4E4B;&#x524D;&#x6587;&#x7AE0;&#x4E2D;&#x63D0;&#x5230;&#x7684;addService&#x64CD;&#x4F5C;&#xFF0C;&#x6700;&#x7EC8;&#x90FD;&#x4F1A;&#x5728;SVC_MGR_ADD_SERVICE&#x4E2D;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</p>\n<p>&#x5728;SVC_MGR_ADD_SERVICE&#x4E2D;&#x4F1A;&#x901A;&#x8FC7;do_add_service&#x65B9;&#x6CD5;&#x6765;&#x6CE8;&#x518C;service&#x3002;</p>\n<h3 id=\"do-add-service\"><a href=\"#do-add-service\" class=\"headerlink\" title=\"do_add_service\"></a>do_add_service</h3><blockquote>\n<p>frameworks/native/cmds/servicemanager/service_manager.c</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int do_add_service(struct binder_state *bs, const uint16_t *s, size_t len, uint32_t handle,</span><br><span class=\"line\">                   uid_t uid, int allow_isolated, uint32_t dumpsys_priority, pid_t spid, const char* sid) {</span><br><span class=\"line\">    struct svcinfo *si;</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (!handle || (len == 0) || (len &gt; 127))</span><br><span class=\"line\">        return -1;</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x68C0;&#x67E5;&#x662F;&#x5426;&#x80FD;&#x591F;&#x6CE8;&#x518C;&#x8BE5;service</span><br><span class=\"line\">    if (!svc_can_register(s, len, spid, sid, uid)) {</span><br><span class=\"line\">        ALOGE(&quot;add_service(&apos;%s&apos;,%x) uid=%d - PERMISSION DENIED\\n&quot;,</span><br><span class=\"line\">             str8(s, len), handle, uid);</span><br><span class=\"line\">        return -1;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x67E5;&#x627E;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x6CE8;&#x518C;&#x4E86;</span><br><span class=\"line\">    si = find_svc(s, len);</span><br><span class=\"line\">    if (si) { //&#x5DF2;&#x7ECF;&#x6CE8;&#x518C;</span><br><span class=\"line\">        if (si-&gt;handle) {</span><br><span class=\"line\">            ALOGE(&quot;add_service(&apos;%s&apos;,%x) uid=%d - ALREADY REGISTERED, OVERRIDE\\n&quot;,</span><br><span class=\"line\">                 str8(s, len), handle, uid);</span><br><span class=\"line\">            svcinfo_death(bs, si);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        si-&gt;handle = handle;</span><br><span class=\"line\">    } else { //&#x6CA1;&#x6709;&#x6CE8;&#x518C;</span><br><span class=\"line\">        // &#x7533;&#x8BF7;&#x5185;&#x5B58;</span><br><span class=\"line\">        si = malloc(sizeof(*si) + (len + 1) * sizeof(uint16_t));</span><br><span class=\"line\">        if (!si) {</span><br><span class=\"line\">            ALOGE(&quot;add_service(&apos;%s&apos;,%x) uid=%d - OUT OF MEMORY\\n&quot;,</span><br><span class=\"line\">                 str8(s, len), handle, uid);</span><br><span class=\"line\">            return -1;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        si-&gt;handle = handle;</span><br><span class=\"line\">        si-&gt;len = len;</span><br><span class=\"line\">        memcpy(si-&gt;name, s, (len + 1) * sizeof(uint16_t));</span><br><span class=\"line\">        si-&gt;name[len] = &apos;\\0&apos;;</span><br><span class=\"line\">        si-&gt;death.func = (void*) svcinfo_death;</span><br><span class=\"line\">        si-&gt;death.ptr = si;</span><br><span class=\"line\">        si-&gt;allow_isolated = allow_isolated;</span><br><span class=\"line\">        si-&gt;dumpsys_priority = dumpsys_priority;</span><br><span class=\"line\">        si-&gt;next = svclist;</span><br><span class=\"line\">        // &#x4FDD;&#x5B58;&#x5230;svclist&#x8868;&#x4E2D;</span><br><span class=\"line\">        svclist = si;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    binder_acquire(bs, handle);</span><br><span class=\"line\">    binder_link_to_death(bs, handle, &amp;si-&gt;death);</span><br><span class=\"line\">    return 0;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;do_add_service&#x4E2D;&#x9996;&#x5148;&#x4F1A;&#x68C0;&#x67E5;&#x8BE5;&#x6CE8;&#x518C;&#x7684;service&#x662F;&#x5426;&#x80FD;&#x591F;&#x6CE8;&#x518C;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x51FA;&#x67E5;&#x8BE2;&#x73B0;&#x6709;&#x7684;svclist&#x4E2D;&#x662F;&#x5426;&#x5B58;&#x5728;&#x8BE5;service&#xFF1B;&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#x5C31;&#x4E3A;&#x8BE5;service&#x7533;&#x8BF7;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#xFF0C;&#x6700;&#x540E;&#x5728;&#x52A0;&#x5165;&#x5230;svclist&#x6CE8;&#x518C;&#x8868;&#x4E2D;&#x3002;</p>\n<p>&#x81F3;&#x6B64;&#x6574;&#x4E2A;ServiceManager&#x7684;&#x6D41;&#x7A0B;&#x5C31;&#x5206;&#x6790;&#x5B8C;&#x4E86;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x505A;&#x4E2A;&#x603B;&#x7ED3;&#xFF1A;</p>\n<ol>\n<li>&#x901A;&#x8FC7;binder_open&#x6253;&#x5F00;binder&#x9A71;&#x52A8;&#xFF0C;&#x5E76;&#x8C03;&#x7528;mmap&#x5206;&#x914D;128kb&#x7684;&#x5185;&#x5B58;&#x6620;&#x5C04;&#x5730;&#x5740;&#x7A7A;&#x95F4;</li>\n<li>&#x901A;&#x8FC7;binder_become_context_manager&#x5C06;ServiceManager&#x8BBE;&#x7F6E;&#x4E3A;binder&#x9A71;&#x52A8;&#x7684;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#xFF0C;&#x901A;&#x8FC7;0&#x6765;&#x6807;&#x8BC6;</li>\n<li>&#x901A;&#x8FC7;binder_loop&#x5F00;&#x542F;&#x5FAA;&#x73AF;&#xFF0C;&#x7B49;&#x5F85;&#x4E0E;&#x76D1;&#x542C;client&#x7AEF;&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;&#x6570;&#x636E;</li>\n<li>&#x5728;&#x6570;&#x636E;&#x76D1;&#x542C;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;binder_write&#x901A;&#x77E5;binder&#x8FDB;&#x884C;&#x5FAA;&#x73AF;</li>\n<li>&#x901A;&#x8FC7;ioctl&#x6765;&#x4E0E;binder&#x9A71;&#x52A8;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x8BFB;&#x5199;</li>\n<li>&#x901A;&#x8FC7;binder_parse&#x6765;&#x89E3;&#x6790;&#x76D1;&#x542C;&#x5230;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6839;&#x636E;BR_&#x6307;&#x4EE4;&#x7801;&#x6765;&#x533A;&#x522B;&#x4E0D;&#x540C;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;reply&#x4E0E;BC_&#x6307;&#x4EE4;&#x7801;&#x7684;&#x65B9;&#x5F0F;&#x56DE;&#x9988;&#x7ED9;client&#x7AEF;</li>\n<li>&#x5C06;&#x89E3;&#x6790;&#x7684;&#x6570;&#x636E;&#x56DE;&#x8C03;&#x7ED9;svcmgr_handler&#x8FDB;&#x884C;&#x7EDF;&#x4E00;&#x903B;&#x8F91;&#x5904;&#x7406;&#xFF0C;&#x5305;&#x62EC;service&#x7684;&#x6CE8;&#x518C;&#x3001;&#x67E5;&#x627E;&#x3001;&#x9A8C;&#x8BC1;&#x7B49;&#x64CD;&#x4F5C;</li>\n<li>&#x6700;&#x7EC8;ServiceManager&#x4F1A;&#x5C06;&#x6CE8;&#x518C;&#x7684;service&#x4FDD;&#x5B58;&#x5230;svclist&#x6CE8;&#x518C;&#x8868;&#x4E2D;&#xFF0C;&#x4EE5;&#x4FBF;&#x4E4B;&#x540E;&#x7684;&#x9A8C;&#x8BC1;&#x4E0E;&#x67E5;&#x8BE2;</li>\n</ol>\n<h2 id=\"&#x63A8;&#x8350;\"><a href=\"#&#x63A8;&#x8350;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;\"></a>&#x63A8;&#x8350;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["binder"]},{"title":"Binder: addService初探","url":"https://www.rousetime.com/2021/01/26/Binder-addService初探/","content":"<p>&#x5728;<a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247485536&amp;idx=1&amp;sn=ede4bc6f83ae86e482015f435da1f825&amp;chksm=e8e0f1f0df9778e601e615e1622984b195aa0ea952117988fa2367b87d9063febda1a4b57fc7&amp;token=1132740062&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Binder: ServiceManager&#x7684;&#x83B7;&#x53D6;</a>&#x6587;&#x7AE0;&#x4E2D;&#xFF0C;&#x5206;&#x6790;&#x4E86;ProcessState&#x4E0E;IPCThreadState&#x7684;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;&#x3002;&#x6700;&#x540E;&#x5728;defaultServiceManager&#x4E2D;&#xFF0C;&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x6301;&#x6709;BpBinder&#x7684;BpServiceManager&#x5BF9;&#x8C61;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int main(int argc __unused, char **argv __unused)</span><br><span class=\"line\"> {</span><br><span class=\"line\">     signal(SIGPIPE, SIG_IGN);</span><br><span class=\"line\"> </span><br><span class=\"line\">     sp&lt;ProcessState&gt; proc(ProcessState::self());</span><br><span class=\"line\">     sp&lt;IServiceManager&gt; sm(defaultServiceManager()); // BpServiceManager</span><br><span class=\"line\">     ALOGI(&quot;ServiceManager: %p&quot;, sm.get());</span><br><span class=\"line\">     AIcu_initializeIcuOrDie();</span><br><span class=\"line\">     MediaPlayerService::instantiate();</span><br><span class=\"line\">     ResourceManagerService::instantiate();</span><br><span class=\"line\">     registerExtensions();</span><br><span class=\"line\">     ProcessState::self()-&gt;startThreadPool();</span><br><span class=\"line\">     IPCThreadState::self()-&gt;joinThreadPool();</span><br><span class=\"line\"> }</span><br><span class=\"line\"> void MediaPlayerService::instantiate() {</span><br><span class=\"line\">     defaultServiceManager()-&gt;addService(</span><br><span class=\"line\">             String16(&quot;media.player&quot;), new MediaPlayerService());</span><br><span class=\"line\"> }</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x5728;instantiate&#x65B9;&#x6CD5;&#x4E2D;&#x8C03;&#x7528;&#x7684;addService&#x5176;&#x5B9E;&#x662F;BpServiceManager&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5C06;&#x540D;&#x79F0;&#x4E3A;media.player&#x7684;MediaPlayerService&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x6CE8;&#x518C;</p>\n<h2 id=\"addService\"><a href=\"#addService\" class=\"headerlink\" title=\"addService\"></a>addService</h2><p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x770B;BpServiceManager&#x4E2D;&#x7684;addService&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">virtual status_t addService(const String16&amp; name, const sp&lt;IBinder&gt;&amp; service,</span><br><span class=\"line\">                          bool allowIsolated, int dumpsysPriority) {</span><br><span class=\"line\">  // &#x5C01;&#x88C5;&#x6210;Parcel&#x5BF9;&#x8C61;</span><br><span class=\"line\">  Parcel data, reply;</span><br><span class=\"line\">  data.writeInterfaceToken(IServiceManager::getInterfaceDescriptor());</span><br><span class=\"line\">  data.writeString16(name);</span><br><span class=\"line\">  data.writeStrongBinder(service);</span><br><span class=\"line\">  data.writeInt32(allowIsolated ? 1 : 0);</span><br><span class=\"line\">  data.writeInt32(dumpsysPriority);</span><br><span class=\"line\">  // &#x53D1;&#x9001;&#x6570;&#x636E;&#x5230;&#x8FDC;&#x7AEF;</span><br><span class=\"line\">  status_t err = remote()-&gt;transact(ADD_SERVICE_TRANSACTION, data, &amp;reply);</span><br><span class=\"line\">  return err == NO_ERROR ? reply.readExceptionCode() : err;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x5C06;&#x6570;&#x636E;&#x7EDF;&#x4E00;&#x5C01;&#x88C5;&#x5230;Parcel&#x5BF9;&#x8C61;&#x4E2D;&#xFF0C;&#x6700;&#x540E;&#x901A;&#x8FC7;remote()&#x7684;transact&#x65B9;&#x6CD5;&#x5C06;&#x6570;&#x636E;&#x4F20;&#x8F93;&#x5230;&#x8FDC;&#x7AEF;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;code&#x4E3A;ADD_SERVICE_TRANSACTION&#x3002;</p>\n<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5728;&#x6765;&#x770B;&#x4E0B;remote()&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x3002;</p>\n<p>&#x5B83;&#x662F;BpServiceManager&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6765;&#x81EA;&#x4E8E;&#x5B83;&#x7684;&#x7236;&#x7C7B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class BpServiceManager : public BpInterface&lt;IServiceManager&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">public:</span><br><span class=\"line\">  explicit BpServiceManager(const sp&lt;IBinder&gt;&amp; impl) // BpBinder(0)</span><br><span class=\"line\">      : BpInterface&lt;IServiceManager&gt;(impl) {}</span><br><span class=\"line\">  </span><br><span class=\"line\">inline BpInterface&lt;INTERFACE&gt;::BpInterface(const sp&lt;IBinder&gt;&amp; remote) : BpRefBase(remote)</span><br><span class=\"line\">  </span><br><span class=\"line\">BpRefBase::BpRefBase(const sp&lt;IBinder&gt;&amp; o) : mRemote(o.get()), mRefs(nullptr), mState(0)</span><br><span class=\"line\"> </span><br><span class=\"line\">class BpRefBase : public virtual RefBase</span><br><span class=\"line\">{</span><br><span class=\"line\">protected:</span><br><span class=\"line\">  explicit                BpRefBase(const sp&lt;IBinder&gt;&amp; o);</span><br><span class=\"line\">  virtual                 ~BpRefBase();</span><br><span class=\"line\">  virtual void            onFirstRef();</span><br><span class=\"line\">  virtual void            onLastStrongRef(const void* id);</span><br><span class=\"line\">  virtual bool            onIncStrongAttempted(uint32_t flags, const void* id);</span><br><span class=\"line\"> </span><br><span class=\"line\">  inline  IBinder*        remote()                { return mRemote; }</span><br><span class=\"line\">  inline  IBinder*        remote() const          { return mRemote; }</span><br><span class=\"line\"> </span><br><span class=\"line\">private:</span><br><span class=\"line\">                          BpRefBase(const BpRefBase&amp; o);</span><br><span class=\"line\">  BpRefBase&amp;              operator=(const BpRefBase&amp; o);</span><br><span class=\"line\"> </span><br><span class=\"line\">  IBinder* const          mRemote;</span><br><span class=\"line\">  RefBase::weakref_type*  mRefs;</span><br><span class=\"line\">  std::atomic&lt;int32_t&gt;    mState;</span><br><span class=\"line\">};</span><br></pre></td></tr></table></figure>\n<p>&#x4ECE;&#x4E0A;&#x9762;&#x7EE7;&#x627F;&#x6D41;&#x7A0B;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x8FD9;&#x4E2A;remote()&#x8FD4;&#x56DE;&#x7684;&#x5C31;&#x662F;mRemote&#xFF0C;&#x800C;mRemote&#x5176;&#x5B9E;&#x662F;&#x6700;&#x5F00;&#x59CB;&#x7684;&#x53C2;&#x6570;BpBinder(0)&#x3002;&#x8BF4;&#x660E;&#x8FD9;&#x91CC;&#x8C03;&#x7528;&#x7684;&#x662F;BpBinder&#x7684;transact&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">status_t BpBinder::transact(</span><br><span class=\"line\">  uint32_t code, const Parcel&amp; data, Parcel* reply, uint32_t flags)</span><br><span class=\"line\">{</span><br><span class=\"line\">  // Once a binder has died, it will never come back to life.</span><br><span class=\"line\">  if (mAlive) {</span><br><span class=\"line\">      status_t status = IPCThreadState::self()-&gt;transact(</span><br><span class=\"line\">          mHandle, code, data, reply, flags);</span><br><span class=\"line\">      if (status == DEAD_OBJECT) mAlive = 0;</span><br><span class=\"line\">      return status;</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  return DEAD_OBJECT;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FDB;&#x5165;BpBinder&#x53D1;&#x73B0;&#x53C8;&#x8F6C;&#x8C03;&#x5230;IPCThreadState&#x7684;transact&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">status_t IPCThreadState::transact(int32_t handle,</span><br><span class=\"line\">                                uint32_t code, const Parcel&amp; data,</span><br><span class=\"line\">                                Parcel* reply, uint32_t flags)</span><br><span class=\"line\">{</span><br><span class=\"line\"> </span><br><span class=\"line\">  ...</span><br><span class=\"line\"> </span><br><span class=\"line\">  // &#x4F20;&#x8F93;&#x6570;&#x636E;</span><br><span class=\"line\">  err = writeTransactionData(BC_TRANSACTION, flags, handle, code, data, nullptr);</span><br><span class=\"line\"> </span><br><span class=\"line\">  if ((flags &amp; TF_ONE_WAY) == 0) {</span><br><span class=\"line\"> </span><br><span class=\"line\">      ...</span><br><span class=\"line\">      </span><br><span class=\"line\">      if (reply) {</span><br><span class=\"line\">          // &#x7B49;&#x5F85;&#x8FDC;&#x7A0B;&#x6570;&#x636E;&#x7684;&#x8FD4;&#x56DE;</span><br><span class=\"line\">          err = waitForResponse(reply);</span><br><span class=\"line\">      } else {</span><br><span class=\"line\">          Parcel fakeReply;</span><br><span class=\"line\">          err = waitForResponse(&amp;fakeReply);</span><br><span class=\"line\">      }</span><br><span class=\"line\"> </span><br><span class=\"line\">  } else {</span><br><span class=\"line\">      err = waitForResponse(nullptr, nullptr);</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  return err;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x505A;&#x7684;&#x5C31;&#x4E24;&#x4EF6;&#x4E8B;</p>\n<ol>\n<li>&#x901A;&#x8FC7;writeTransactionData&#x5C06;&#x6570;&#x636E;&#x5199;&#x5165;&#x5230;Parcel&#x4E2D;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;cmd&#x547D;&#x4EE4;&#x4E3A;BC_TRANSACTION&#xFF0C;&#x8FD9;&#x662F;&#x8BF7;&#x6C42;&#x7801;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x90FD;&#x662F;&#x4EE5;BC_&#x5F00;&#x5934;&#x547D;&#x540D;&#xFF0C;&#x5728;service&#x7AEF;&#x4F1A;&#x901A;&#x8FC7;&#x8FD9;&#x4E9B;&#x8BF7;&#x6C42;&#x7801;&#x505A;&#x4E0D;&#x540C;&#x7684;&#x903B;&#x8F91;&#x5904;&#x7406;&#x3002;</li>\n<li>&#x901A;&#x8FC7;waitForResponse&#x6765;&#x7B49;&#x5F85;&#x8FDC;&#x7AEF;&#x7684;&#x6570;&#x636E;&#x8FD4;&#x56DE;&#xFF0C;&#x8FD9;&#x91CC;&#x4E5F;&#x6709;&#x4E00;&#x4E2A;cmd&#x547D;&#x4EE4;&#x884C;&#xFF0C;&#x4F8B;&#x5982;BR_REPLY&#xFF0C;&#x8FD9;&#x662F;&#x8FD4;&#x56DE;&#x7801;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x90FD;&#x662F;&#x4EE5;BR_&#x5F00;&#x5934;&#x547D;&#x540D;&#x7684;&#xFF0C;&#x5728;client&#x4E5F;&#x4F1A;&#x901A;&#x8FC7;&#x8FD9;&#x4E9B;&#x8FD4;&#x56DE;&#x7801;&#x505A;&#x4E0D;&#x540C;&#x7684;&#x903B;&#x8F91;&#x5904;&#x7406;&#x3002;</li>\n</ol>\n<p>&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x4E0D;&#x7814;&#x7A76;&#x8FD9;&#x51E0;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x540E;&#x7EED;&#x6587;&#x7AE0;&#x4F1A;&#x4E13;&#x95E8;&#x5206;&#x6790;&#x6570;&#x636E;&#x7684;&#x4EA4;&#x4E92;&#x3002;</p>\n<p>&#x5230;&#x8FD9;&#x91CC;MediaPlayerService&#x5DF2;&#x7ECF;&#x6CE8;&#x518C;&#x5B8C;&#x6BD5;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6700;&#x524D;&#x9762;&#x7684;main&#x65B9;&#x6CD5;&#x7EE7;&#x7EED;&#x5F80;&#x4E0B;&#x8D70;&#x3002;</p>\n<h2 id=\"startThreadPool\"><a href=\"#startThreadPool\" class=\"headerlink\" title=\"startThreadPool\"></a>startThreadPool</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ProcessState::self()-&gt;startThreadPool();</span><br></pre></td></tr></table></figure>\n<p>&#x53C8;&#x662F;ProcessState&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x8FDB;&#x5165;startThreadPooll&#x4E2D;&#x770B;&#x4E00;&#x4E0B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void ProcessState::startThreadPool()</span><br><span class=\"line\">{</span><br><span class=\"line\">  AutoMutex _l(mLock);</span><br><span class=\"line\">  if (!mThreadPoolStarted) {</span><br><span class=\"line\">      mThreadPoolStarted = true;</span><br><span class=\"line\">      spawnPooledThread(true);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">void ProcessState::spawnPooledThread(bool isMain)</span><br><span class=\"line\">{</span><br><span class=\"line\">  if (mThreadPoolStarted) {</span><br><span class=\"line\">      String8 name = makeBinderThreadName();</span><br><span class=\"line\">      // &#x5F00;&#x542F;binder&#x7EBF;&#x7A0B;&#x6C60;</span><br><span class=\"line\">      sp&lt;Thread&gt; t = new PoolThread(isMain);</span><br><span class=\"line\">      t-&gt;run(name.string());</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;spawnPooledThread&#x65B9;&#x6CD5;&#x4E2D;&#x521B;&#x5EFA;&#x4E86;PoolThread&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5B83;&#x7EE7;&#x627F;&#x4E8E;Thread&#xFF0C;&#x6700;&#x540E;&#x8C03;&#x7528;&#x4E86;&#x7EBF;&#x7A0B;&#x7684;run&#x65B9;&#x6CD5;</p>\n<h2 id=\"joinThreadPool\"><a href=\"#joinThreadPool\" class=\"headerlink\" title=\"joinThreadPool\"></a>joinThreadPool</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">IPCThreadState::self()-&gt;joinThreadPool();</span><br></pre></td></tr></table></figure>\n<p>&#x7EE7;&#x7EED;&#x770B;joinThreadPooll&#x65B9;&#x6CD5;, &#x5B83;&#x5728;IPCThreadState&#x4E2D;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void IPCThreadState::joinThreadPool(bool isMain)</span><br><span class=\"line\">{</span><br><span class=\"line\"> </span><br><span class=\"line\">  mOut.writeInt32(isMain ? BC_ENTER_LOOPER : BC_REGISTER_LOOPER);</span><br><span class=\"line\"> </span><br><span class=\"line\">  status_t result;</span><br><span class=\"line\">  do {</span><br><span class=\"line\">      processPendingDerefs();</span><br><span class=\"line\">      // &#x7B49;&#x5F85;&#x547D;&#x4EE4;&#x884C;&#x7684;&#x5230;&#x6765;</span><br><span class=\"line\">      result = getAndExecuteCommand();</span><br><span class=\"line\">  } while (result != -ECONNREFUSED &amp;&amp; result != -EBADF);</span><br><span class=\"line\"> </span><br><span class=\"line\">  mOut.writeInt32(BC_EXIT_LOOPER);</span><br><span class=\"line\">  // &#x4E0E;binder&#x9A71;&#x52A8;&#x901A;&#x4FE1;</span><br><span class=\"line\">  talkWithDriver(false);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x7684;&#x65B9;&#x6CD5;&#x662F;getAndExecuteCommand()&#xFF0C;&#x5B83;&#x662F;&#x7528;&#x6765;&#x5904;&#x7406;&#x63A5;&#x6536;service&#x7AEF;&#x53D1;&#x9001;&#x8FC7;&#x6765;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x56E0;&#x4E3A;service&#x4E0E;client&#x662F;&#x53EF;&#x4EE5;&#x4E92;&#x76F8;&#x53D1;&#x8D77;&#x6570;&#x636E;&#x7684;&#x4EA4;&#x4E92;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;client&#x5C31;&#x76F8;&#x5F53;&#x4E8E;service&#xFF0C;&#x5B83;&#x5F00;&#x542F;&#x8F6E;&#x8BE2;&#x4E0D;&#x65AD;&#x5730;&#x76D1;&#x542C;service&#x53D1;&#x8FC7;&#x6765;&#x7684;&#x6570;&#x636E;&#x3002;&#x6700;&#x7EC8;&#x5B83;&#x4F1A;&#x8C03;&#x7528;executeCommand&#x6765;&#x7EDF;&#x4E00;&#x5904;&#x7406;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">status_t IPCThreadState::executeCommand(int32_t cmd)</span><br><span class=\"line\">{</span><br><span class=\"line\"> </span><br><span class=\"line\">  switch ((uint32_t)cmd) {</span><br><span class=\"line\"> </span><br><span class=\"line\">  ...</span><br><span class=\"line\"> </span><br><span class=\"line\">  case BR_TRANSACTION_SEC_CTX:</span><br><span class=\"line\">  case BR_TRANSACTION:</span><br><span class=\"line\">      {</span><br><span class=\"line\">          ...</span><br><span class=\"line\"> </span><br><span class=\"line\">          if (tr.target.ptr) {</span><br><span class=\"line\">              if (reinterpret_cast&lt;RefBase::weakref_type*&gt;(</span><br><span class=\"line\">                      tr.target.ptr)-&gt;attemptIncStrong(this)) {</span><br><span class=\"line\">                  // BBinder</span><br><span class=\"line\">                  error = reinterpret_cast&lt;BBinder*&gt;(tr.cookie)-&gt;transact(tr.code, buffer,</span><br><span class=\"line\">                          &amp;reply, tr.flags);</span><br><span class=\"line\">                  reinterpret_cast&lt;BBinder*&gt;(tr.cookie)-&gt;decStrong(this);</span><br><span class=\"line\">              } else {</span><br><span class=\"line\">                  error = UNKNOWN_TRANSACTION;</span><br><span class=\"line\">              }</span><br><span class=\"line\">          } else {</span><br><span class=\"line\">              error = the_context_object-&gt;transact(tr.code, buffer, &amp;reply, tr.flags);</span><br><span class=\"line\">          }</span><br><span class=\"line\">          </span><br><span class=\"line\">          ...</span><br><span class=\"line\"> </span><br><span class=\"line\">          if ((tr.flags &amp; TF_ONE_WAY) == 0) {</span><br><span class=\"line\">              // &#x5411;&#x670D;&#x52A1;&#x7AEF;&#x53D1;&#x9001;&#x56DE;&#x5E94;reply&#xFF0C;&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684;0&#xFF0C;&#x7279;&#x5B9A;&#x6807;&#x8BC6;&#xFF1B;</span><br><span class=\"line\">              sendReply(reply, 0);</span><br><span class=\"line\">          } else {</span><br><span class=\"line\">              LOG_ONEWAY(&quot;NOT sending reply to %d!&quot;, mCallingPid);</span><br><span class=\"line\">          }</span><br><span class=\"line\"> </span><br><span class=\"line\">          ...</span><br><span class=\"line\"> </span><br><span class=\"line\">      }</span><br><span class=\"line\">      break;</span><br><span class=\"line\"> </span><br><span class=\"line\">  ...</span><br><span class=\"line\"> </span><br><span class=\"line\">  default:</span><br><span class=\"line\">      ALOGE(&quot;*** BAD COMMAND %d received from Binder driver\\n&quot;, cmd);</span><br><span class=\"line\">      result = UNKNOWN_ERROR;</span><br><span class=\"line\">      break;</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  if (result != NO_ERROR) {</span><br><span class=\"line\">      mLastError = result;</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  return result;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E3A;&#x4E86;&#x7B80;&#x5316;&#x4EE3;&#x7801;&#x53EA;&#x5C55;&#x793A;&#x4E86;&#x4E3B;&#x8981;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#xFF0C;BR_TRANSACTION&#x7C7B;&#x4F3C;&#x4E8E;&#x4E0A;&#x9762;&#x6240;&#x8BF4;&#x7684;BC_TRANSACTION&#xFF0C;&#x8FD9;&#x91CC;&#x4EE3;&#x8868;&#x7684;&#x662F;&#x4ECE;&#x670D;&#x52A1;&#x7AEF;&#x6709;&#x6570;&#x636E;&#x53D1;&#x9001;&#x8FC7;&#x6765;&#xFF0C;&#x8BF4;&#x660E;&#x670D;&#x52A1;&#x7AEF;&#x4E3B;&#x52A8;&#x4F20;&#x8F93;&#x6570;&#x636E;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5C31;&#x4E0E;service&#x7AEF;&#x5EFA;&#x7ACB;&#x4E86;&#x901A;&#x4FE1;&#x3002;</p>\n<p>&#x81F3;&#x6B64;&#x5728;client&#x7AEF;&#x7684;&#x6570;&#x636E;&#x4EA4;&#x4E92;&#x6D41;&#x7A0B;&#x5DF2;&#x7ECF;&#x5206;&#x6790;&#x5B8C;&#x6BD5;&#xFF0C;&#x540E;&#x7EED;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;binder&#x4F20;&#x8F93;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;service&#x7AEF;&#xFF0C;&#x770B;&#x5B83;&#x662F;&#x5982;&#x4F55;&#x63A5;&#x6536;&#x4E0E;&#x5904;&#x7406;&#x6570;&#x636E;&#x7684;&#x3002;</p>\n<h2 id=\"&#x63A8;&#x8350;\"><a href=\"#&#x63A8;&#x8350;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;\"></a>&#x63A8;&#x8350;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["binder"]},{"title":"Binder: ServiceManager的获取","url":"https://www.rousetime.com/2021/01/26/Binder-ServiceManager的获取/","content":"<p>&#x5728;<a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247485503&amp;idx=1&amp;sn=170681578f1e2aa1991463103084b32b&amp;chksm=e8e0f1afdf9778b9fadd0dfc1265211e0b0305077f007fd085ebd2e54d6ea28a7fc5d49b07df&amp;token=2134605925&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Binder&#x7EAF;&#x7406;&#x8BBA;&#x5206;&#x6790;</a>&#x4E2D;&#x4ECB;&#x7ECD;&#x4E86;Binder&#x7684;&#x6574;&#x4E2A;&#x901A;&#x4FE1;&#x6D41;&#x7A0B;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x901A;&#x8FC7;Service&#x7684;&#x6CE8;&#x518C;&#x6765;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;Binder&#x7684;&#x5177;&#x4F53;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x4EE5;MediaService&#x4E3A;&#x4F8B;&#xFF0C;&#x6765;&#x770B;&#x4E0B;service&#x7684;&#x6CE8;&#x518C;&#x8FC7;&#x7A0B;&#x3002;MediaService&#x5BF9;&#x5E94;&#x7684;&#x542F;&#x52A8;&#x6587;&#x4EF6;&#x5728;main_mediaserver.cpp&#x4E2D;&#x7684;main&#x65B9;&#x6CD5;&#x3002;</p>\n<blockquote>\n<p>frameworks/av/media/mediaserver/main_mediaserver.cpp</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int main(int argc __unused, char **argv __unused)</span><br><span class=\"line\">{</span><br><span class=\"line\">    signal(SIGPIPE, SIG_IGN);</span><br><span class=\"line\"> </span><br><span class=\"line\">    sp&lt;ProcessState&gt; proc(ProcessState::self());</span><br><span class=\"line\">    sp&lt;IServiceManager&gt; sm(defaultServiceManager());</span><br><span class=\"line\">    ALOGI(&quot;ServiceManager: %p&quot;, sm.get());</span><br><span class=\"line\">    MediaPlayerService::instantiate();</span><br><span class=\"line\">    ResourceManagerService::instantiate();</span><br><span class=\"line\">    registerExtensions();</span><br><span class=\"line\">    ::android::hardware::configureRpcThreadpool(16, false);</span><br><span class=\"line\">    ProcessState::self()-&gt;startThreadPool();</span><br><span class=\"line\">    IPCThreadState::self()-&gt;joinThreadPool();</span><br><span class=\"line\">    ::android::hardware::joinRpcThreadpool();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"ProcessState\"><a href=\"#ProcessState\" class=\"headerlink\" title=\"ProcessState\"></a>ProcessState</h2><p>&#x9996;&#x5148;&#x521B;&#x5EFA;&#x4E86;ProcessState&#xFF0C;&#x5B83;&#x4F7F;&#x7528;&#x4E86;sp&#x7684;&#x5F3A;&#x5F15;&#x7528;&#x7C7B;&#x578B;&#x3002;</p>\n<p>ProcessState::self&#x5185;&#x90E8;&#x662F;&#x4E00;&#x4E2A;&#x5355;&#x4F8B;&#xFF0C;&#x5982;&#x679C;&#x4E3A;&#x7A7A;&#x5B83;&#x4F1A;&#x521B;&#x5EFA;ProcessState&#x5BF9;&#x8C61;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ProcessState::ProcessState(const char *driver)</span><br><span class=\"line\">    : mDriverName(String8(driver))</span><br><span class=\"line\">    , mDriverFD(open_driver(driver)) // &#x542F;&#x52A8;binder&#x9A71;&#x52A8;</span><br><span class=\"line\">    , mVMStart(MAP_FAILED)</span><br><span class=\"line\">    , mThreadCountLock(PTHREAD_MUTEX_INITIALIZER)</span><br><span class=\"line\">    , mThreadCountDecrement(PTHREAD_COND_INITIALIZER)</span><br><span class=\"line\">    , mExecutingThreadsCount(0)</span><br><span class=\"line\">    , mWaitingForThreads(0)</span><br><span class=\"line\">    , mMaxThreads(DEFAULT_MAX_BINDER_THREADS) // &#x8BBE;&#x7F6E;&#x6700;&#x5927;&#x7EBF;&#x7A0B;&#x6570;</span><br><span class=\"line\">    , mStarvationStartTimeMs(0)</span><br><span class=\"line\">    , mThreadPoolStarted(false)</span><br><span class=\"line\">    , mThreadPoolSeq(1)</span><br><span class=\"line\">    , mCallRestriction(CallRestriction::NONE)</span><br><span class=\"line\">{</span><br><span class=\"line\">    if (mDriverFD &gt;= 0) {</span><br><span class=\"line\">        // &#x6620;&#x5C04;&#x865A;&#x62DF;&#x5185;&#x5B58;&#x5730;&#x5740;</span><br><span class=\"line\">        mVMStart = mmap(nullptr, BINDER_VM_SIZE, PROT_READ, MAP_PRIVATE | MAP_NORESERVE, mDriverFD, 0);</span><br><span class=\"line\">        if (mVMStart == MAP_FAILED) {</span><br><span class=\"line\">            // *sigh*</span><br><span class=\"line\">            ALOGE(&quot;Using %s failed: unable to mmap transaction memory.\\n&quot;, mDriverName.c_str());</span><br><span class=\"line\">            close(mDriverFD);</span><br><span class=\"line\">            mDriverFD = -1;</span><br><span class=\"line\">            mDriverName.clear();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    LOG_ALWAYS_FATAL_IF(mDriverFD &lt; 0, &quot;Binder driver &apos;%s&apos; could not be opened.  Terminating.&quot;, driver);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x662F;ProcessState&#x7684;&#x5B9E;&#x4F8B;&#x5316;&#x8FC7;&#x7A0B;&#xFF0C;&#x4E3B;&#x8981;&#x6709;&#x4EE5;&#x4E0B;&#x4E09;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x8BBE;&#x7F6E;&#x3002;</p>\n<ol>\n<li>open_driver(driver): &#x542F;&#x52A8;binder&#x9A71;&#x52A8;</li>\n<li>mMaxThreads(DEFAULT_MAX_BINDER_THREADS): &#x8BBE;&#x7F6E;&#x6700;&#x5927;&#x7EBF;&#x7A0B;&#x6570;16</li>\n<li>mmap: &#x6620;&#x5C04;&#x865A;&#x62DF;&#x5185;&#x5B58;&#x5730;&#x5740;</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static int open_driver(const char *driver)</span><br><span class=\"line\">{</span><br><span class=\"line\">\t// &#x6253;&#x5F00;binder&#x9A71;&#x52A8;</span><br><span class=\"line\">    int fd = open(driver, O_RDWR | O_CLOEXEC);</span><br><span class=\"line\">    if (fd &gt;= 0) {</span><br><span class=\"line\">        int vers = 0;</span><br><span class=\"line\">        // &#x901A;&#x8FC7;ioctl&#x4E0E;binder&#x9A71;&#x52A8;&#x4EA4;&#x4E92;&#xFF0C;&#x83B7;&#x53D6;binder&#x7248;&#x672C;&#x4FE1;&#x606F;</span><br><span class=\"line\">        status_t result = ioctl(fd, BINDER_VERSION, &amp;vers);</span><br><span class=\"line\">        if (result == -1) {</span><br><span class=\"line\">            ALOGE(&quot;Binder ioctl to obtain version failed: %s&quot;, strerror(errno));</span><br><span class=\"line\">            close(fd);</span><br><span class=\"line\">            fd = -1;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        if (result != 0 || vers != BINDER_CURRENT_PROTOCOL_VERSION) {</span><br><span class=\"line\">          ALOGE(&quot;Binder driver protocol(%d) does not match user space protocol(%d)! ioctl() return value: %d&quot;,</span><br><span class=\"line\">                vers, BINDER_CURRENT_PROTOCOL_VERSION, result);</span><br><span class=\"line\">            close(fd);</span><br><span class=\"line\">            fd = -1;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        // &#x8BBE;&#x7F6E;&#x6700;&#x5927;&#x7EBF;&#x7A0B;&#x6570;</span><br><span class=\"line\">        size_t maxThreads = DEFAULT_MAX_BINDER_THREADS;</span><br><span class=\"line\">        result = ioctl(fd, BINDER_SET_MAX_THREADS, &amp;maxThreads);</span><br><span class=\"line\">        if (result == -1) {</span><br><span class=\"line\">            ALOGE(&quot;Binder ioctl to set max threads failed: %s&quot;, strerror(errno));</span><br><span class=\"line\">        }</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        ALOGW(&quot;Opening &apos;%s&apos; failed: %s\\n&quot;, driver, strerror(errno));</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return fd;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;open_driver&#x4E2D;&#x901A;&#x8FC7;open&#x6253;&#x5F00;binder&#x9A71;&#x52A8;&#xFF0C;&#x5728;binder&#x9A71;&#x52A8;&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#x662F;binder_open&#xFF0C;&#x5B83;&#x4F1A;&#x521B;&#x5EFA;binder_proc&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x5C06;&#x8FDB;&#x7A0B;&#x7B49;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x4FDD;&#x5B58;&#x5230;binder_proc&#x5BF9;&#x8C61;&#x4E2D;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;fd&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x3002;</p>\n<p>&#x5728;Linux&#x4E2D;&#x901A;&#x8FC7;ioctl&#x65B9;&#x6CD5;&#x4E0E;&#x8BBE;&#x5907;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#xFF0C;&#x83B7;&#x53D6;binder&#x7684;&#x7248;&#x672C;&#x4FE1;&#x606F;&#xFF0C;&#x540C;&#x65F6;&#x8BBE;&#x7F6E;binder&#x7684;&#x6700;&#x5927;&#x7EBF;&#x7A0B;&#x6570;16&#x3002;&#x5728;binder&#x9A71;&#x52A8;&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x662F;binder_ioctl&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x901A;&#x8FC7;fd&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x3001;ioctl&#x547D;&#x4EE4;&#x4E0E;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x6765;&#x4F20;&#x9012;&#x6570;&#x636E;&#x3002;</p>\n<p>&#x5728;ProcessState&#x521B;&#x5EFA;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x4F1A;&#x901A;&#x8FC7;mmap&#x65B9;&#x6CD5;&#xFF0C;&#x5728;binder&#x9A71;&#x52A8;&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x662F;binder_mmap&#x65B9;&#x6CD5;&#xFF0C;&#x5C06;&#x5185;&#x6838;&#x4E2D;&#x540C;&#x4E00;&#x5757;&#x7269;&#x7406;&#x5185;&#x5B58;&#x5206;&#x522B;&#x6620;&#x5C04;&#x5230;&#x5185;&#x6838;&#x7684;&#x865A;&#x62DF;&#x5185;&#x5B58;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x4E0E;&#x7528;&#x6237;&#x7684;&#x865A;&#x62DF;&#x5185;&#x5B58;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#xFF0C;&#x4FDD;&#x8BC1;&#x5185;&#x6838;&#x7A7A;&#x95F4;buffer&#x4E0E;&#x7528;&#x6237;&#x7A7A;&#x95F4;buffer&#x7684;&#x540C;&#x6B65;&#x64CD;&#x4F5C;&#x3002;</p>\n<p>&#x4EE5;&#x4E0A;&#x5C31;&#x662F;ProcessState&#x7684;&#x4E3B;&#x8981;&#x6D41;&#x7A0B;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x7EE7;&#x7EED;main&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x4E0B;&#x4E00;&#x6B65;&#x64CD;&#x4F5C;&#x3002;</p>\n<h2 id=\"BpServiceManager\"><a href=\"#BpServiceManager\" class=\"headerlink\" title=\"BpServiceManager\"></a>BpServiceManager</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sp&lt;IServiceManager&gt; sm(defaultServiceManager());</span><br></pre></td></tr></table></figure>\n<p>&#x83B7;&#x53D6;IServiceManager&#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8FDB;&#x5165;defaultServiceManager&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sp&lt;IServiceManager&gt; defaultServiceManager()</span><br><span class=\"line\"> {</span><br><span class=\"line\">     std::call_once(gSmOnce, []() {</span><br><span class=\"line\">         sp&lt;AidlServiceManager&gt; sm = nullptr;</span><br><span class=\"line\">         while (sm == nullptr) {</span><br><span class=\"line\">             // &#x91CD;&#x8981;&#x65B9;&#x6CD5;&#xFF0C;&#x83B7;&#x53D6;ServiceManager</span><br><span class=\"line\">             sm = interface_cast&lt;AidlServiceManager&gt;(ProcessState::self()-&gt;getContextObject(nullptr));</span><br><span class=\"line\">             if (sm == nullptr) {</span><br><span class=\"line\">                 ALOGE(&quot;Waiting 1s on context object on %s.&quot;, ProcessState::self()-&gt;getDriverName().c_str());</span><br><span class=\"line\">                 sleep(1);</span><br><span class=\"line\">             }</span><br><span class=\"line\">         }</span><br><span class=\"line\">         gDefaultServiceManager = new ServiceManagerShim(sm);</span><br><span class=\"line\">     });</span><br><span class=\"line\">     return gDefaultServiceManager;</span><br><span class=\"line\"> }</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x5B83;&#x4F1A;&#x901A;&#x8FC7;interface_cast&#x6765;&#x83B7;&#x53D6;sm&#xFF0C;&#x8FD9;&#x91CC;&#x7684;AidlServiceManager&#x672C;&#x8D28;&#x5C31;&#x662F;IServiceManager&#x3002;&#x6211;&#x4EEC;&#x5148;&#x628A;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x653E;&#x4E00;&#x653E;&#xFF0C;&#x5148;&#x770B;&#x4E0B;&#x5B83;&#x7684;&#x53C2;&#x6570;&#x83B7;&#x53D6;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ProcessState::self()-&gt;getContextObject(nullptr)</span><br></pre></td></tr></table></figure>\n<p>&#x55EF;&#xFF0C;&#x53C8;&#x770B;&#x5230;&#x4E86;ProcessState::self()&#xFF0C;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x5206;&#x6790;&#x4E86;&#xFF0C;&#x5B83;&#x5C31;&#x662F;&#x4E00;&#x4E2A;ProcessState&#x5355;&#x4F8B;&#xFF0C;&#x6240;&#x4EE5;&#x76F4;&#x63A5;&#x770B;getContextObject&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sp&lt;IBinder&gt; ProcessState::getContextObject(const sp&lt;IBinder&gt;&amp; /*caller*/)</span><br><span class=\"line\">{</span><br><span class=\"line\">    sp&lt;IBinder&gt; context = getStrongProxyForHandle(0);</span><br><span class=\"line\">    if (context == nullptr) {</span><br><span class=\"line\">       ALOGW(&quot;Not able to get context object on %s.&quot;, mDriverName.c_str());</span><br><span class=\"line\">    }</span><br><span class=\"line\">    internal::Stability::tryMarkCompilationUnit(context.get());</span><br><span class=\"line\">    return context;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD4;&#x56DE;&#x4E86;IBinder&#xFF0C;&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x7B2C;&#x4E00;&#x6B21;&#x770B;&#x5230;IBinder&#xFF0C;&#x611F;&#x89C9;&#x6709;&#x70B9;&#x7709;&#x76EE;&#x4E86;&#xFF0C;&#x7EE7;&#x7EED;&#x770B;getStrongProxyForHandle(0)&#xFF0C;&#x6CE8;&#x610F;&#x5B83;&#x8FD9;&#x91CC;&#x4F20;&#x4E86;&#x4E00;&#x4E2A;&#x53C2;&#x6570;0</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sp&lt;IBinder&gt; ProcessState::getStrongProxyForHandle(int32_t handle)</span><br><span class=\"line\"> {</span><br><span class=\"line\">     sp&lt;IBinder&gt; result;</span><br><span class=\"line\">     AutoMutex _l(mLock);</span><br><span class=\"line\">     handle_entry* e = lookupHandleLocked(handle);</span><br><span class=\"line\">     if (e != nullptr) {</span><br><span class=\"line\">         IBinder* b = e-&gt;binder;</span><br><span class=\"line\">         if (b == nullptr || !e-&gt;refs-&gt;attemptIncWeak(this)) {</span><br><span class=\"line\">             if (handle == 0) {</span><br><span class=\"line\">                 Parcel data;</span><br><span class=\"line\">                 // &#x6570;&#x636E;&#x4F20;&#x8F93;</span><br><span class=\"line\">                 status_t status = IPCThreadState::self()-&gt;transact(</span><br><span class=\"line\">                         0, IBinder::PING_TRANSACTION, data, nullptr, 0);</span><br><span class=\"line\">                 if (status == DEAD_OBJECT)</span><br><span class=\"line\">                    return nullptr;</span><br><span class=\"line\">             }</span><br><span class=\"line\">             // &#x521B;&#x5EFA;BpBinder</span><br><span class=\"line\">             b = BpBinder::create(handle);</span><br><span class=\"line\">             e-&gt;binder = b;</span><br><span class=\"line\">             if (b) e-&gt;refs = b-&gt;getWeakRefs();</span><br><span class=\"line\">             result = b;</span><br><span class=\"line\">         } else {</span><br><span class=\"line\">             result.force_set(b);</span><br><span class=\"line\">             e-&gt;refs-&gt;decWeak(this);</span><br><span class=\"line\">         }</span><br><span class=\"line\">     }</span><br><span class=\"line\">     return result;</span><br><span class=\"line\"> }</span><br></pre></td></tr></table></figure>\n<p>IPCThreadState::self()&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x5355;&#x4F8B;&#xFF0C;&#x901A;&#x8FC7;&#x5B83;&#x7684;transact&#x65B9;&#x6CD5;&#x5411;&#x8FDC;&#x7AEF;&#x53D1;&#x9001;&#x6570;&#x636E;&#xFF0C;&#x5173;&#x4E8E;&#x6570;&#x636E;&#x7684;&#x53D1;&#x9001;&#x672C;&#x671F;&#x4E0D;&#x5206;&#x6790;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x6682;&#x4E14;&#x8DF3;&#x8FC7;&#x3002;</p>\n<p>&#x7EE7;&#x7EED;&#xFF0C;&#x521B;&#x5EFA;&#x4E86;BpBinder&#xFF0C;&#x5E76;&#x5C06;handler = 0&#x4F20;&#x7ED9;&#x5B83;&#xFF0C;&#x6700;&#x7EC8;&#x901A;&#x8FC7;result&#x8FD4;&#x56DE;&#x7684;&#x5C31;&#x662F;BpBinder(0)&#xFF0C;&#x6B64;&#x65F6;&#x5DF2;&#x7ECF;&#x83B7;&#x53D6;&#x5230;&#x4E86;IBinder&#xFF0C;&#x4F5C;&#x4E3A;&#x8DE8;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;&#x7684;&#x8F7D;&#x4F53;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5411;&#x4E0A;&#x56DE;&#x9000;&#xFF0C;&#x56DE;&#x5230;&#x6700;&#x521D;&#x7684;&#x5730;&#x65B9;interface_cast&#xFF0C;&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x5B83;&#x7684;&#x53C2;&#x6570;&#x5176;&#x5B9E;&#x5C31;&#x662F;BpBinder(0)&#xFF0C;&#x5373;interface_cast(BpBinder(0))&#x3002;</p>\n<p>&#x73B0;&#x5728;&#x5C31;&#x53EA;&#x5269;&#x4E0B;interface_cast&#x4E86;&#xFF0C;&#x53EA;&#x8981;&#x6211;&#x4EEC;&#x89E3;&#x5F00;&#x5B83;&#x5C31;&#x80FD;&#x77E5;&#x9053;ServiceManager&#x662F;&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x5E76;&#x83B7;&#x53D6;&#x7684;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">template&lt;typename INTERFACE&gt;</span><br><span class=\"line\">inline sp&lt;INTERFACE&gt; interface_cast(const sp&lt;IBinder&gt;&amp; obj)</span><br><span class=\"line\">{</span><br><span class=\"line\">    return INTERFACE::asInterface(obj);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x53D1;&#x73B0;&#x5B83;&#x8C03;&#x7528;&#x4E86;INTERFACE&#x7684;asInterface&#x65B9;&#x6CD5;&#xFF0C;&#x90A3;&#x4E48;INTERFACE&#x53C8;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p>\n<p>&#x627E;&#x4E86;&#x4E00;&#x5708;&#x53D1;&#x73B0;&#x5B83;&#x5C45;&#x7136;&#x662F;&#x4E00;&#x4E2A;&#x6A21;&#x677F;&#xFF0C;&#x58F0;&#x660E;&#x5982;&#x4E0B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#define DECLARE_META_INTERFACE(INTERFACE)                               </span><br><span class=\"line\"> public:                                                                 </span><br><span class=\"line\">     static const ::android::String16 descriptor;                        </span><br><span class=\"line\">     static ::android::sp&lt;I##INTERFACE&gt; asInterface(                    </span><br><span class=\"line\">             const ::android::sp&lt;::android::IBinder&gt;&amp; obj);              </span><br><span class=\"line\">     virtual const ::android::String16&amp; getInterfaceDescriptor() const;  </span><br><span class=\"line\">     I##INTERFACE();                                                     </span><br><span class=\"line\">     virtual ~I##INTERFACE();                                           </span><br><span class=\"line\">     static bool setDefaultImpl(std::unique_ptr&lt;I##INTERFACE&gt; impl);    </span><br><span class=\"line\">     static const std::unique_ptr&lt;I##INTERFACE&gt;&amp; getDefaultImpl();      </span><br><span class=\"line\"> private:                                                                </span><br><span class=\"line\">     static std::unique_ptr&lt;I##INTERFACE&gt; default_impl</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x7684;INTERFACE&#x5C31;&#x662F;ServiceManager&#xFF0C;&#x5728;&#x6A21;&#x677F;&#x58F0;&#x660E;&#x4E2D;&#x770B;&#x5230;&#x4E86;&#x6211;&#x4EEC;&#x6240;&#x8981;&#x7684;asInterface&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x518D;&#x770B;&#x6A21;&#x677F;&#x51FD;&#x6570;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">IMPLEMENT_META_INTERFACE(ServiceManager, &quot;android.os.IServiceManager&quot;);</span><br><span class=\"line\"> #define IMPLEMENT_META_INTERFACE(INTERFACE, NAME)</span><br><span class=\"line\">      const ::android::StaticString16                                     </span><br><span class=\"line\">          I##INTERFACE##_descriptor_static_str16(__IINTF_CONCAT(u, NAME));</span><br><span class=\"line\">      const ::android::String16 I##INTERFACE::descriptor(                 </span><br><span class=\"line\">          I##INTERFACE##_descriptor_static_str16);                        </span><br><span class=\"line\">      const ::android::String16&amp;                                          </span><br><span class=\"line\">              I##INTERFACE::getInterfaceDescriptor() const {              </span><br><span class=\"line\">          return I##INTERFACE::descriptor;                                </span><br><span class=\"line\">      }                                                                   </span><br><span class=\"line\">      ::android::sp&lt;I##INTERFACE&gt; I##INTERFACE::asInterface(              </span><br><span class=\"line\">              const ::android::sp&lt;::android::IBinder&gt;&amp; obj)               </span><br><span class=\"line\">      {                                                                   </span><br><span class=\"line\">          ::android::sp&lt;I##INTERFACE&gt; intr;                               </span><br><span class=\"line\">          if (obj != nullptr) {                                           </span><br><span class=\"line\">              intr = static_cast&lt;I##INTERFACE*&gt;(                          </span><br><span class=\"line\">                  obj-&gt;queryLocalInterface(                               </span><br><span class=\"line\">                         I##INTERFACE::descriptor).get());               </span><br><span class=\"line\">             if (intr == nullptr) {                                      </span><br><span class=\"line\">                  intr = new Bp##INTERFACE(obj);                         </span><br><span class=\"line\">             }                                                           </span><br><span class=\"line\">          }                                                               </span><br><span class=\"line\">          return intr;                                                    </span><br><span class=\"line\">      }                      </span><br><span class=\"line\">\t\t...</span><br></pre></td></tr></table></figure>\n<p>&#x5C06;INTERFACE&#x66FF;&#x6362;&#x6210;ServiceManager&#x6765;&#x770B;&#xFF0C;&#x6700;&#x7EC8;&#x901A;&#x8FC7;asInterface&#x8FD4;&#x56DE;&#x7684;&#x662F;BpServiceManager&#x5BF9;&#x8C61;&#xFF0C;&#x540C;&#x65F6;&#x5B83;&#x7684;&#x53C2;&#x6570;obj&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;&#x4E4B;&#x524D;&#x7684;BpBinder(0)&#x3002;</p>\n<p>&#x641E;&#x660E;&#x767D;&#x8FD9;&#x4E2A;&#x4E4B;&#x540E;&#xFF0C;&#x518D;&#x56DE;&#x5230;&#x6700;&#x521D;&#x7684;&#x5730;&#x65B9;&#xFF08;&#x5E0C;&#x671B;&#x6CA1;&#x6709;&#x6655;&#xFF09;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;defaultServiceManager&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x6BCF;&#x6B21;&#x8C03;&#x7528;defaultServiceManager&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x8FD4;&#x56DE;BpServiceManager(BpBinder(0))&#x5BF9;&#x8C61;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x4E0B;BpServiceManager&#xFF0C;&#x5B83;&#x5728;IServiceManager.cpp&#x5C31;&#x7533;&#x660E;&#x7684;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class BpServiceManager : public BpInterface&lt;IServiceManager&gt;</span><br><span class=\"line\"> {</span><br><span class=\"line\"> public:</span><br><span class=\"line\">     explicit BpServiceManager(const sp&lt;IBinder&gt;&amp; impl)</span><br><span class=\"line\">         : BpInterface&lt;IServiceManager&gt;(impl)</span><br><span class=\"line\">     {</span><br><span class=\"line\">     } </span><br><span class=\"line\">  </span><br><span class=\"line\">     virtual sp&lt;IBinder&gt; getService(const String16&amp; name) const</span><br><span class=\"line\">     { ... }</span><br><span class=\"line\"> </span><br><span class=\"line\">     virtual sp&lt;IBinder&gt; checkService( const String16&amp; name) const</span><br><span class=\"line\">     { ... }</span><br><span class=\"line\"> </span><br><span class=\"line\">     virtual status_t addService(const String16&amp; name, const sp&lt;IBinder&gt;&amp; service,</span><br><span class=\"line\">                                 bool allowIsolated, int dumpsysPriority) { ... }</span><br><span class=\"line\">\t ...</span><br><span class=\"line\"> };</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x63D0;&#x4F9B;&#x4E86;addService&#x4E0E;getService&#x65B9;&#x6CD5;&#xFF0C;&#x6682;&#x65F6;&#x4E0D;&#x5206;&#x6790;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x5927;&#x80C6;&#x731C;&#x4E00;&#x4E0B;&#xFF0C;&#x5E94;&#x8BE5;&#x662F;&#x901A;&#x8FC7;BpServiceManager&#x7684;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x6765;&#x6CE8;&#x518C;&#x4E0E;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;Service&#x3002;&#x81F3;&#x4E8E;&#x5B83;&#x5185;&#x90E8;&#x53C8;&#x662F;&#x5982;&#x4F55;&#x4F20;&#x9012;&#x5230;ServiceManager&#x6211;&#x4EEC;&#x540E;&#x7EED;&#x518D;&#x5206;&#x6790;&#x3002;</p>\n<p>&#x56DE;&#x5230;&#x6700;&#x521D;&#x7684;main&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6765;&#x5E94;&#x8BE5;&#x5C31;&#x662F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MediaPlayerService::instantiate();</span><br><span class=\"line\">void MediaPlayerService::instantiate() {</span><br><span class=\"line\">\tdefaultServiceManager()-&gt;addService(</span><br><span class=\"line\">\t\tString16(&quot;media.player&quot;), new MediaPlayerService());</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x518D;&#x6765;&#x770B;instantiate&#x5C31;&#x7B80;&#x5355;&#x8BB8;&#x591A;&#x4E86;&#xFF0C;&#x5B83;&#x901A;&#x8FC7;defaultServiceManager&#x5411;&#x5176;&#x4E2D;&#x6CE8;&#x518C;&#x4E86;&#x540D;&#x79F0;&#x4E3A;media.player&#x7684;MediaPlayerService&#x670D;&#x52A1;&#x3002;</p>\n<p>&#x800C;defaultServiceManager&#x5BF9;&#x5E94;&#x7684;&#x662F;BpServiceManager(BpBinder(0))&#xFF0C;&#x6240;&#x4EE5;&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x7684;&#x731C;&#x60F3;&#x662F;&#x6210;&#x7ACB;&#x7684;&#x3002;&#x5173;&#x4E8E;&#x670D;&#x52A1;&#x7684;&#x6CE8;&#x518C;&#x3001;&#x9A8C;&#x8BC1;&#x4E0E;&#x83B7;&#x53D6;&#x90FD;&#x662F;&#x901A;&#x8FC7;BpServiceManager&#x4EE3;&#x7406;&#x5B8C;&#x6210;&#x7684;&#xFF0C;&#x5176;&#x5B9E;&#x5185;&#x90E8;&#x6700;&#x7EC8;&#x90FD;&#x662F;&#x901A;&#x8FC7;BpBinder(0)&#x6765;&#x4F20;&#x8F93;&#x7684;&#x3002;</p>\n<p>&#x597D;&#x4E86;&#xFF0C;&#x4E3A;&#x4E86;&#x5C3D;&#x91CF;&#x7F29;&#x77ED;&#x7BC7;&#x5E45;&#xFF0C;&#x964D;&#x4F4E;&#x9605;&#x8BFB;&#x75B2;&#x52B3;&#xFF0C;&#x63D0;&#x5347;&#x8BFB;&#x8005;&#x4F53;&#x9A8C;&#xFF0C;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5C31;&#x5206;&#x6790;&#x5230;&#x8FD9;&#x91CC;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6765;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;MediaService&#x6240;&#x505A;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x6838;&#x5FC3;&#x5185;&#x5BB9;</p>\n<ol>\n<li>&#x521B;&#x5EFA;ProcessState&#x5BF9;&#x8C61;</li>\n<li>&#x5728;ProcessState&#x7684;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;&#x4E2D;&#x542F;&#x52A8;binder&#x9A71;&#x52A8;&#xFF0C;&#x4F7F;&#x7528;ioctl&#x4E0E;binder&#x9A71;&#x52A8;&#x4EA4;&#x4E92;&#xFF0C;&#x5E76;&#x8BBE;&#x7F6E;binder&#x6700;&#x5927;&#x5E76;&#x53D1;&#x7EBF;&#x7A0B;&#x6570;16&#xFF0C;&#x4F7F;&#x7528;mmap&#x6620;&#x5C04;&#x865A;&#x62DF;&#x5185;&#x5B58;&#x5730;&#x5740;</li>\n<li>&#x521B;&#x5EFA;IPCThreadState&#x5BF9;&#x8C61;&#xFF0C;&#x4F7F;&#x7528;transact&#x5411;server&#x7AEF;&#x53D1;&#x9001;&#x6570;&#x636E;</li>\n<li>&#x521B;&#x5EFA;BpBinder&#x5BF9;&#x8C61;&#xFF0C;&#x83B7;&#x53D6;IBinder,&#x4F5C;&#x4E3A;&#x8DE8;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;&#x7684;&#x8F7D;&#x4F53;</li>\n<li>&#x521B;&#x5EFA;BpServiceManager&#x5BF9;&#x8C61;&#xFF0C;&#x4F5C;&#x4E3A;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x3001;&#x68C0;&#x9A8C;&#x4E0E;&#x83B7;&#x53D6;&#x7684;&#x4EE3;&#x7406;</li>\n</ol>\n<h2 id=\"&#x63A8;&#x8350;\"><a href=\"#&#x63A8;&#x8350;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;\"></a>&#x63A8;&#x8350;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["binder"]},{"title":"Binder纯理论分析","url":"https://www.rousetime.com/2021/01/21/Binder纯理论分析/","content":"<p>&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x6765;&#x6DF1;&#x5165;&#x8BA4;&#x8BC6;&#x4E00;&#x4E0B;Android&#x4E2D;&#x7684;Binder&#x673A;&#x5236;&#x3002;</p>\n<p>&#x4ECA;&#x5929;&#x7684;&#x4E3B;&#x8981;&#x662F;&#x6765;&#x5BF9;Binder&#x505A;&#x4E00;&#x4E2A;&#x8F83;&#x5168;&#x9762;&#x7684;&#x4ECB;&#x7ECD;&#xFF0C;&#x4E3A;&#x4E4B;&#x540E;&#x7684;&#x6DF1;&#x5165;&#x5206;&#x6790;&#x505A;&#x4E00;&#x4E2A;&#x9884;&#x70ED;&#x51C6;&#x5907;&#x3002;</p>\n<h2 id=\"Linux-IPC\"><a href=\"#Linux-IPC\" class=\"headerlink\" title=\"Linux IPC\"></a>Linux IPC</h2><p>&#x9996;&#x5148;Binder&#x662F;Android&#x4E2D;&#x7684;&#x4E00;&#x79CD;&#x72EC;&#x6709;&#x7684;&#x8DE8;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;&#x65B9;&#x5F0F;&#xFF0C;&#x7B80;&#x79F0;IPC&#x3002;&#x5B83;&#x662F;&#x4E13;&#x95E8;&#x4E3A;Android&#x5E73;&#x53F0;&#x8BBE;&#x8BA1;&#x7684;&#x3002;</p>\n<p>&#x90A3;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8BBE;&#x8BA1;&#x51FA;Binder&#x8FD9;&#x4E2A;&#x70E6;&#x4EBA;&#x7684;&#x4E1C;&#x897F;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;Android&#x662F;&#x57FA;&#x4E8E;Linux&#x7CFB;&#x7EDF;&#x8FDB;&#x884C;&#x6F14;&#x53D8;&#x8FC7;&#x6765;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x7406;&#x5E94;&#x4E5F;&#x80FD;&#x76F4;&#x63A5;&#x4F7F;&#x7528;Linux&#x7684;IPC&#x901A;&#x4FE1;&#x65B9;&#x5F0F;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x5728;&#x7406;&#x89E3;Binder&#x7684;&#x8BBE;&#x8BA1;&#x521D;&#x8877;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;Linux&#x7CFB;&#x7EDF;&#x4E2D;&#x73B0;&#x6709;&#x7684;IPC&#x901A;&#x4FE1;&#x65B9;&#x5F0F;&#x3002;</p>\n<p>Linux&#x73B0;&#x6709;&#x7684;IPC&#x901A;&#x4FE1;&#x65B9;&#x5F0F;&#x6709;6&#x79CD;&#xFF1A;</p>\n<ol>\n<li>&#x7BA1;&#x9053;</li>\n<li>&#x4FE1;&#x53F7;&#x91CF;</li>\n<li>&#x4FE1;&#x53F7;</li>\n<li>&#x5171;&#x4EAB;&#x5185;&#x5B58;</li>\n<li>&#x6D88;&#x606F;&#x961F;&#x5217;</li>\n<li>socket</li>\n</ol>\n<h3 id=\"&#x7BA1;&#x9053;\"><a href=\"#&#x7BA1;&#x9053;\" class=\"headerlink\" title=\"&#x7BA1;&#x9053;\"></a>&#x7BA1;&#x9053;</h3><p>&#x82F1;&#x6587;&#x4E3A;pipe&#xFF0C;&#x5728;Linux&#x4E2D;&#x5B83;&#x7684;&#x672C;&#x8D28;&#x662F;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x4EE5;&#x5199;&#x7684;&#x65B9;&#x5F0F;&#x6253;&#x5F00;&#x6587;&#x4EF6;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x4EE5;&#x8BFB;&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x6253;&#x5F00;&#x6587;&#x4EF6;&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x6837;&#x8BFB;&#x5199;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x8FDB;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#x3002;</p>\n<p>&#x53EA;&#x4E0D;&#x8FC7;&#x8BE5;&#x6587;&#x4EF6;&#x662F;&#x4F4D;&#x4E8E;Linux&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x6240;&#x4EE5;&#x64CD;&#x4F5C;&#x7BA1;&#x9053;&#x5C31;&#x662F;&#x4EE5;&#x6587;&#x4EF6;&#x7684;&#x65B9;&#x5F0F;&#x64CD;&#x4F5C;Linux&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x533A;&#x3002;</p>\n<p>&#x540C;&#x65F6;&#x7BA1;&#x9053;&#x8FD8;&#x6709;&#x5927;&#x5C0F;&#x9650;&#x5236;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;4k,&#x4E00;&#x65E6;&#x5199;&#x5165;&#x7AEF;&#x8D85;&#x8FC7;&#x5927;&#x5C0F;&#x9650;&#x5236;&#xFF0C;&#x7BA1;&#x9053;&#x5C06;&#x4F1A;&#x963B;&#x585E;&#x3002;</p>\n<h3 id=\"&#x4FE1;&#x53F7;&#x91CF;\"><a href=\"#&#x4FE1;&#x53F7;&#x91CF;\" class=\"headerlink\" title=\"&#x4FE1;&#x53F7;&#x91CF;\"></a>&#x4FE1;&#x53F7;&#x91CF;</h3><p>&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x7684;&#x8D44;&#x6E90;&#x4E92;&#x65A5;&#x8BBF;&#x95EE;&#xFF0C;&#x901A;&#x8FC7;PV&#x4E24;&#x79CD;&#x64CD;&#x4F5C;&#x7B49;&#x5F85;&#x4E0E;&#x53D1;&#x9001;&#x4FE1;&#x53F7;&#x3002;</p>\n<p>P(sv)&#xFF1A;&#x5982;&#x679C;sv&#x7684;&#x503C;&#x5927;&#x4E8E;&#x96F6;&#xFF0C;&#x5C31;&#x7ED9;&#x5B83;&#x51CF;1&#xFF1B;&#x5982;&#x679C;&#x5B83;&#x7684;&#x503C;&#x4E3A;&#x96F6;&#xFF0C;&#x5C31;&#x6302;&#x8D77;&#x8BE5;&#x8FDB;&#x7A0B;&#x7684;&#x6267;&#x884C;<br>V(sv)&#xFF1A;&#x5982;&#x679C;&#x6709;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x56E0;&#x7B49;&#x5F85;sv&#x800C;&#x88AB;&#x6302;&#x8D77;&#xFF0C;&#x5C31;&#x8BA9;&#x5B83;&#x6062;&#x590D;&#x8FD0;&#x884C;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8FDB;&#x7A0B;&#x56E0;&#x7B49;&#x5F85;sv&#x800C;&#x6302;&#x8D77;&#xFF0C;&#x5C31;&#x7ED9;&#x5B83;&#x52A0;1.</p>\n<p>&#x6240;&#x4EE5;&#x4FE1;&#x53F7;&#x91CF;&#x4E3B;&#x8981;&#x662F;&#x7528;&#x6765;&#x89E3;&#x51B3;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x5BF9;&#x540C;&#x4E00;&#x8D44;&#x6E90;&#x7684;&#x7ADE;&#x4E89;&#x95EE;&#x9898;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;&#x591A;&#x7EBF;&#x7A0B;&#x7684;&#x540C;&#x6B65;&#x9501;&#x3002;</p>\n<h3 id=\"&#x4FE1;&#x53F7;\"><a href=\"#&#x4FE1;&#x53F7;\" class=\"headerlink\" title=\"&#x4FE1;&#x53F7;\"></a>&#x4FE1;&#x53F7;</h3><p>Linux&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x4E00;&#x79CD;&#x8F6F;&#x4E2D;&#x65AD;&#xFF0C;&#x6709;64&#x79CD;&#xFF0C;&#x5206;&#x4E3A;&#x53EF;&#x9760;&#x4FE1;&#x53F7;&#x4E0E;&#x4E0D;&#x53EF;&#x9760;&#x4FE1;&#x53F7;&#xFF0C;&#x591A;&#x7528;&#x4E8E;&#x6D88;&#x606F;&#x4F20;&#x9012;&#x4E0E;&#x901A;&#x77E5;&#xFF0C;&#x4E0D;&#x9002;&#x5408;&#x4F20;&#x9012;&#x4FE1;&#x606F;&#x3002;</p>\n<h3 id=\"&#x5171;&#x4EAB;&#x5185;&#x5B58;\"><a href=\"#&#x5171;&#x4EAB;&#x5185;&#x5B58;\" class=\"headerlink\" title=\"&#x5171;&#x4EAB;&#x5185;&#x5B58;\"></a>&#x5171;&#x4EAB;&#x5185;&#x5B58;</h3><p>&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x987E;&#x540D;&#x601D;&#x4E49;&#xFF0C;&#x5141;&#x8BB8;&#x4E0D;&#x540C;&#x7684;&#x8FDB;&#x7A0B;&#x8BBF;&#x95EE;&#x540C;&#x4E00;&#x5757;&#x5185;&#x5B58;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#xFF0C;&#x5B83;&#x4E5F;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x4E24;&#x6B21;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x64CD;&#x4F5C;&#xFF0C;&#x5206;&#x522B;&#x662F;&#x5C06;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x5230;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x53C8;&#x4ECE;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x4E2D;&#x95F4;&#x5C06;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x51FA;&#x6765;&#x3002;</p>\n<p>&#x4F46;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x662F;&#x4E0D;&#x63D0;&#x4F9B;&#x540C;&#x6B65;&#x673A;&#x5236;&#x3002;</p>\n<p>&#x610F;&#x601D;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5728;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x8FDB;&#x884C;&#x5199;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x5E76;&#x4E0D;&#x80FD;&#x653E;&#x5728;&#x53E6;&#x4E00;&#x8FDB;&#x7A0B;&#x8FDB;&#x884C;&#x8BFB;&#x64CD;&#x4F5C;&#x3002;</p>\n<p>&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x4E00;&#x822C;&#x90FD;&#x4E0E;&#x524D;&#x9762;&#x8BF4;&#x7684;&#x4FE1;&#x53F7;&#x91CF;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x3002;</p>\n<h3 id=\"&#x6D88;&#x606F;&#x961F;&#x5217;\"><a href=\"#&#x6D88;&#x606F;&#x961F;&#x5217;\" class=\"headerlink\" title=\"&#x6D88;&#x606F;&#x961F;&#x5217;\"></a>&#x6D88;&#x606F;&#x961F;&#x5217;</h3><p>&#x6D88;&#x606F;&#x961F;&#x5217;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x5411;&#x53E6;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x53D1;&#x751F;&#x6D88;&#x606F;&#x5757;&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF0C;&#x5B83;&#x4E0E;&#x7BA1;&#x9053;&#x975E;&#x5E38;&#x7C7B;&#x4F3C;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x53D1;&#x9001;&#x4E0E;&#x63A5;&#x6536;&#xFF0C;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x4E24;&#x6B21;&#x3002;</p>\n<p>&#x4E0D;&#x540C;&#x70B9;&#x662F;</p>\n<ol>\n<li>&#x6D88;&#x606F;&#x961F;&#x5217;&#x53EF;&#x4EE5;&#x9632;&#x6B62;&#x540C;&#x6B65;&#x4E0E;&#x963B;&#x585E;&#x95EE;&#x9898;&#x3002;</li>\n<li>&#x6D88;&#x606F;&#x961F;&#x5217;&#x7684;&#x63A5;&#x6536;&#x65B9;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x9009;&#x62E9;&#x6027;&#x63A5;&#x6536;&#x3002;</li>\n<li>&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;&#x5757;&#x6709;&#x6700;&#x5927;&#x9650;&#x5236;</li>\n</ol>\n<h3 id=\"socket\"><a href=\"#socket\" class=\"headerlink\" title=\"socket\"></a>socket</h3><p>Linux&#x4E2D;&#x7684;socket&#x662F;&#x57FA;&#x4E8E;C/S&#x67B6;&#x6784;&#x7684;&#xFF0C;&#x4F20;&#x8F93;&#x6548;&#x7387;&#x4F4E;&#xFF0C;&#x591A;&#x7528;&#x4E8E;&#x8DE8;&#x7F51;&#x7EDC;&#x4E0E;&#x8DE8;&#x8BBE;&#x5907;&#x7684;&#x901A;&#x4FE1;&#x3002;</p>\n<p>&#x5728;Android&#x5E95;&#x5C42;&#x4F7F;&#x7528;socket&#x6765;&#x8FDB;&#x884C;init&#x4E0E;zygote&#x7B49;&#x8FDB;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x7B80;&#x5355;&#x7684;&#x6765;&#x770B;&#x4E00;&#x5F20;&#x56FE;&#x6765;&#x4E86;&#x89E3;&#x5728;Linux&#x4E2D;&#x4E0D;&#x540C;&#x8FDB;&#x7A0B;&#x4E2D;&#x7684;&#x901A;&#x4FE1;&#x8FC7;&#x7A0B;&#x3002;</p>\n<p><img src=\"/2021/01/21/Binder&#x7EAF;&#x7406;&#x8BBA;&#x5206;&#x6790;/linux_ipc.jpg\" alt></p>\n<p>&#x6240;&#x4EE5;&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x5206;&#x6790;&#xFF0C;Linux&#x73B0;&#x6709;&#x7684;&#x51E0;&#x79CD;IPC&#x901A;&#x4FE1;&#x65B9;&#x5F0F;&#x90FD;&#x4E0D;&#x662F;&#x5F88;&#x9002;&#x5408;Android&#x95F4;&#x7684;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#x7BA1;&#x9053;&#x3001;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x4E0E;&#x6D88;&#x606F;&#x961F;&#x5217;&#x90FD;&#x9700;&#x8981;&#x62F7;&#x8D1D;&#x4E24;&#x6B21;&#x6570;&#x636E;&#xFF0C;&#x540C;&#x65F6;&#x6709;&#x7684;&#x8FD8;&#x4F1A;&#x5B58;&#x5728;&#x963B;&#x585E;&#x4E0E;&#x540C;&#x6B65;&#x95EE;&#x9898;&#xFF1B;&#x53E6;&#x5916;&#x7684;&#x4FE1;&#x53F7;&#x3001;&#x4FE1;&#x53F7;&#x91CF;&#x4E0E;socket&#x7531;&#x4E8E;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x90FD;&#x4E0D;&#x9002;&#x5408;&#x7528;&#x4E8E;Android&#x4E2D;&#x5FEB;&#x901F;&#x7684;&#x8FDB;&#x7A0B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x901A;&#x4FE1;&#x3002;</p>\n<h2 id=\"Binder\"><a href=\"#Binder\" class=\"headerlink\" title=\"Binder\"></a>Binder</h2><p>&#x90A3;&#x4E48;Binder&#x901A;&#x4FE1;&#x65B9;&#x5F0F;&#x662F;&#x600E;&#x4E48;&#x6837;&#x7684;&#x5462;&#xFF1F;</p>\n<p>Binder&#x672C;&#x8EAB;&#x662F;&#x57FA;&#x4E8E;C/S&#x67B6;&#x6784;&#x7684;&#xFF0C;&#x5C42;&#x6B21;&#x5206;&#x660E;&#xFF0C;&#x67B6;&#x6784;&#x7A33;&#x5B9A;&#xFF0C;&#x540C;&#x65F6;Binder&#x5185;&#x90E8;&#x53EA;&#x9700;&#x4F7F;&#x7528;&#x4E00;&#x6B21;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x64CD;&#x4F5C;&#xFF0C;&#x5C31;&#x80FD;&#x8FBE;&#x5230;&#x8FDB;&#x7A0B;&#x95F4;&#x6570;&#x636E;&#x7684;&#x901A;&#x4FE1;&#xFF1B;&#x53E6;&#x5916;Binder&#x8FD8;&#x652F;&#x6301;&#x9274;&#x522B;&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#x7684;Uid,&#x4E3A;Android&#x63D0;&#x4F9B;&#x8EAB;&#x4EFD;&#x7684;&#x9A8C;&#x8BC1;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x901A;&#x8FC7;&#x4E00;&#x5F20;&#x56FE;&#x6765;&#x7B80;&#x5355;&#x770B;&#x4E0B;&#x57FA;&#x4E8E;Binder&#x7684;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;&#x8FC7;&#x7A0B;</p>\n<p><img src=\"/2021/01/21/Binder&#x7EAF;&#x7406;&#x8BBA;&#x5206;&#x6790;/android_ipc.jpg\" alt></p>\n<p>Binder&#x6570;&#x636E;&#x901A;&#x4FE1;&#x6D41;&#x7A0B;&#x662F;&#xFF0C;&#x5C06;&#x6570;&#x636E;&#x4ECE;client&#x7AEF;&#x62F7;&#x8D1D;&#x5230;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#xFF0C;&#x5728;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#x4E2D;&#x4F1A;&#x63D0;&#x524D;&#x901A;&#x8FC7;mmap&#x65B9;&#x5F0F;&#x5EFA;&#x7ACB;&#x4E0E;server&#x7AEF;&#x7684;&#x5185;&#x5B58;&#x5730;&#x5740;&#x6620;&#x5C04;&#xFF0C;&#x901A;&#x8FC7;&#x5185;&#x5B58;&#x5730;&#x5740;&#x6620;&#x5C04;server&#x7AEF;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;&#x5C06;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x5230;server&#x7AEF;&#xFF0C;&#x63D0;&#x9AD8;&#x8FDB;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#x901F;&#x5EA6;&#x3002;</p>\n<p>&#x5728;&#x6574;&#x4E2A;&#x901A;&#x4FE1;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x4E3B;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x662F;&#xFF1A;</p>\n<ol>\n<li>&#x901A;&#x8FC7;/dev/binder&#x6253;&#x5F00;binder&#x9A71;&#x52A8;</li>\n<li>&#x901A;&#x8FC7;mmap&#x5EFA;&#x7ACB;&#x5185;&#x5B58;&#x5730;&#x5740;&#x6620;&#x5C04;</li>\n<li>&#x901A;&#x8FC7;ioctl&#x4E0E;binder&#x9A71;&#x52A8;&#x4EA4;&#x4E92;&#xFF0C;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x4F20;&#x8F93;</li>\n<li>client&#x4F7F;&#x7528;BpBinder&#x7684;transact&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x4E8B;&#x52A1;&#x8BF7;&#x6C42;</li>\n<li>server&#x4F7F;&#x7528;BBinder&#x7684;onTransact&#x65B9;&#x6CD5;&#x6765;&#x63A5;&#x6536;&#x76F8;&#x5E94;&#x7684;&#x4E8B;&#x52A1;</li>\n</ol>\n<p>&#x7531;&#x4E8E;Android&#x4E2D;&#x4E3B;&#x8981;&#x4F7F;&#x7528;Binder&#x6765;&#x8FDB;&#x884C;service&#x7684;&#x6CE8;&#x518C;&#x4E0E;&#x83B7;&#x53D6;&#xFF0C;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x7BA1;&#x7406;service&#x7684;&#x6CE8;&#x518C;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;ServiceManager&#x6765;&#x8FDB;&#x884C;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;service&#x7684;&#x6CE8;&#x518C;&#x3002;</p>\n<p>&#x5728;service&#x7684;&#x6CE8;&#x518C;&#x8FC7;&#x7A0B;&#x4E2D;ServiceManager&#x5C31;&#x76F8;&#x5F53;&#x4E8E;server&#x7AEF;&#xFF0C;&#x5185;&#x90E8;&#x5F00;&#x542F;loop&#x5FAA;&#x73AF;&#xFF0C;&#x4E0D;&#x65AD;&#x63A5;&#x6536;&#x6D88;&#x606F;&#x5C06;&#x6CE8;&#x518C;&#x7684;service&#x4FDD;&#x5B58;&#x5230;&#x6CE8;&#x518C;&#x8868;svclist&#x4E2D;&#x3002;</p>\n<p>&#x6700;&#x7EC8;&#x5173;&#x4E8E;Binder&#x7684;&#x6574;&#x4E2A;&#x5927;&#x81F4;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;</p>\n<p><img src=\"/2021/01/21/Binder&#x7EAF;&#x7406;&#x8BBA;&#x5206;&#x6790;/binder.jpg\" alt></p>\n<p>&#x5176;&#x4E2D;client&#x4E0E;server&#x4F4D;&#x4E8E;&#x5E94;&#x7528;&#x5C42;&#xFF0C;ServiceManager&#x4F4D;&#x4E8E;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#xFF0C;binder&#x9A71;&#x52A8;&#x4F4D;&#x4E8E;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x5F00;&#x53D1;&#x8005;&#x6765;&#x8BF4;&#xFF0C;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x4E0E;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#x662F;&#x900F;&#x660E;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x5173;&#x6CE8;&#x5E94;&#x7528;&#x5C42;client&#x4E0E;server&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x7684;&#x4F7F;&#x7528;Binder&#x7684;&#x901A;&#x4FE1;&#x673A;&#x5236;&#x3002;</p>\n<p>&#x4EE5;&#x4E0A;&#x662F;&#x5BF9;Binder&#x7684;&#x4E00;&#x4E2A;&#x7406;&#x8BBA;&#x5206;&#x6790;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#xFF0C;&#x6211;&#x5C06;&#x7ED3;&#x5408;&#x6E90;&#x7801;&#x6765;&#x5206;&#x6790;service&#x7684;&#x6CE8;&#x518C;&#x8FC7;&#x7A0B;&#xFF0C;&#x4ECE;&#x800C;&#x63A2;&#x7D22;Binder&#x7684;&#x6574;&#x4E2A;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x4E00;&#x4E0B;&#x3002;</p>\n<h2 id=\"&#x63A8;&#x8350;\"><a href=\"#&#x63A8;&#x8350;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;\"></a>&#x63A8;&#x8350;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["binder"]},{"title":"链表：由浅入深","url":"https://www.rousetime.com/2021/01/18/链表：由浅入深/","content":"<p>&#x4ECA;&#x5929;&#x53C8;&#x5230;&#x4E86;&#x7B97;&#x6CD5;&#x7684;&#x4E3B;&#x9898;&#x4E86;&#xFF0C;&#x4E0A;&#x6B21;&#x6211;&#x4EEC;&#x804A;&#x5230;&#x4E86;<a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247485006&amp;idx=1&amp;sn=63a7b03b9fed8824b01c1a00faae1ca1&amp;chksm=e8e0ffdedf9776c8a219154c05474060042f8bac44f355ea0333d5dbbf0d07f24aa1130f08f5&amp;token=1746891284&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">&#x6570;&#x7EC4;&#xFF1A;&#x9762;&#x8BD5;&#x4E2D;&#x7684;&#x7591;&#x96BE;&#x70B9;</a>&#xFF0C;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x6765;&#x804A;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x7EBF;&#x6027;&#x7ED3;&#x6784;&#xFF0C;&#x94FE;&#x8868;&#x3002;</p>\n<h2 id=\"&#x672C;&#x8D28;\"><a href=\"#&#x672C;&#x8D28;\" class=\"headerlink\" title=\"&#x672C;&#x8D28;\"></a>&#x672C;&#x8D28;</h2><p>&#x867D;&#x7136;&#x94FE;&#x8868;&#x4E0E;&#x6570;&#x7EC4;&#x4E00;&#x6837;&#x90FD;&#x662F;&#x7EBF;&#x6027;&#x7ED3;&#x6784;&#xFF0C;&#x4F46;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x8FD8;&#x662F;&#x6709;&#x672C;&#x8D28;&#x7684;&#x533A;&#x522B;&#x7684;&#x3002;</p>\n<p>&#x6570;&#x7EC4;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x662F;&#x4E00;&#x5757;&#x8FDE;&#x7EED;&#x7684;&#x5B58;&#x50A8;&#x533A;&#x57DF;&#xFF0C;&#x800C;&#x94FE;&#x8868;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x968F;&#x673A;&#x5B58;&#x50A8;&#xFF0C;&#x975E;&#x8FDE;&#x7EED;&#x7684;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x3002;</p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0548abaec6784182ad1076f27bed5e02~tplv-k3u1fbpfcp-watermark.image\" alt></p>\n<p>&#x94FE;&#x8868;&#x7684;&#x79CD;&#x7C7B;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#xFF0C;&#x5355;&#x94FE;&#x8868;&#x3001;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x3001;&#x5FAA;&#x73AF;&#x94FE;&#x8868;&#x3001;&#x53CC;&#x5411;&#x5FAA;&#x73AF;&#x94FE;&#x8868;&#x3002;</p>\n<p>&#x5B83;&#x4EEC;&#x7684;&#x672C;&#x8D28;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x5177;&#x4F53;&#x7684;&#x8868;&#x73B0;&#x4E0E;&#x5E94;&#x7528;&#x3002;</p>\n<p>&#x7B80;&#x5355;&#x6765;&#x8BF4;&#xFF0C;&#x5BF9;&#x4E8E;&#x5355;&#x94FE;&#x8868;&#x662F;&#x6BCF;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x6709;&#x4E00;&#x4E2A;next&#x540E;&#x7EED;&#x6307;&#x9488;&#xFF0C;&#x5B83;&#x90FD;&#x6307;&#x5411;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x94FE;&#x8868;&#x8282;&#x70B9;&#xFF1B;&#x5BF9;&#x4E8E;&#x94FE;&#x8868;&#x7684;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x7531;&#x4E8E;&#x662F;&#x94FE;&#x8868;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x7684;next&#x4E3A;null&#x3002;</p>\n<p><img src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a962bc00df414d3d85dbc043778a8435~tplv-k3u1fbpfcp-watermark.image\" alt><br>&#x53CC;&#x5411;&#x94FE;&#x8868;&#x4E0E;&#x5355;&#x94FE;&#x8868;&#x6240;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x5B83;&#x9664;&#x4E86;&#x6709;next&#x6307;&#x9488;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x6709;prev&#x524D;&#x9A71;&#x6307;&#x9488;&#xFF0C;&#x5B83;&#x6307;&#x5411;&#x4E8E;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x4E0A;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF1B;&#x7279;&#x6B8A;&#x7684;&#xFF0C;&#x94FE;&#x8868;&#x7684;&#x5934;&#x8282;&#x70B9;&#x7684;prev&#x4E3A;null&#x3002;</p>\n<p><img src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/02a4f83e7adc4dc4abfaabaf14f04277~tplv-k3u1fbpfcp-watermark.image\" alt></p>\n<p>&#x5FAA;&#x73AF;&#x94FE;&#x8868;&#x4E0E;&#x5355;&#x94FE;&#x8868;&#x7684;&#x533A;&#x522B;&#x662F;&#xFF0C;&#x5B83;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7684;next&#x5C06;&#x4E0D;&#x518D;&#x4E3A;null&#xFF0C;&#x800C;&#x662F;&#x6307;&#x5411;&#x5934;&#x8282;&#x70B9;&#x6216;&#x8005;&#x94FE;&#x8868;&#x7684;&#x5176;&#x5B83;&#x4F4D;&#x7F6E;&#x8282;&#x70B9;&#x3002;</p>\n<p>&#x800C;&#x5BF9;&#x4E8E;&#x53CC;&#x5411;&#x5FAA;&#x73AF;&#x94FE;&#x8868;&#x4E5F;&#x662F;&#x540C;&#x6837;&#x7684;&#x539F;&#x7406;&#x3002;</p>\n<h2 id=\"&#x63D2;&#x5165;\"><a href=\"#&#x63D2;&#x5165;\" class=\"headerlink\" title=\"&#x63D2;&#x5165;\"></a>&#x63D2;&#x5165;</h2><p>&#x6211;&#x4EEC;&#x90FD;&#x542C;&#x8FC7;&#x8FD9;&#x4E48;&#x4E00;&#x53E5;&#x8BDD;&#xFF0C;&#x94FE;&#x8868;&#x9002;&#x5408;&#x63D2;&#x5165;&#x4E0E;&#x5220;&#x9664;&#x3002;</p>\n<p>&#x8FD9;&#x4E3B;&#x8981;&#x662F;&#x7531;&#x4E8E;&#x94FE;&#x8868;&#x81EA;&#x8EAB;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x51B3;&#x5B9A;&#x7684;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x5355;&#x94FE;&#x8868;&#x6765;&#x8BF4;&#xFF0C;&#x5411;&#x5DF2;&#x77E5;&#x7684;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x540E;&#x63D2;&#x5165;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x5B83;&#x6240;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x5C31;&#x662F;&#x5C06;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;next&#x6307;&#x9488;&#x6307;&#x5411;&#x65B0;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5C06;&#x65B0;&#x8282;&#x70B9;&#x7684;next&#x6307;&#x5411;&#x6307;&#x5411;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x4E4B;&#x524D;&#x7684;&#x540E;&#x7EED;&#x8282;&#x70B9;&#x3002;&#x800C;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E0D;&#x9700;&#x8981;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#x7684;&#x8FC1;&#x79FB;&#xFF0C;&#x53EA;&#x9700;&#x6539;&#x53D8;&#x8282;&#x70B9;&#x7684;next&#x6307;&#x9488;&#x6307;&#x5411;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;O(1)&#x3002;</p>\n<p><img src=\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/da901a2ec51c4e60b70d65ed5a575e9d~tplv-k3u1fbpfcp-watermark.image\" alt></p>\n<p>&#x770B;&#x56FE;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x771F;&#x6B63;&#x53BB;&#x5B9E;&#x73B0;&#x7684;&#x8BDD;&#xFF0C;&#x4E0D;&#x4E00;&#x5B9A;&#x90FD;&#x4F1A;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x9996;&#x6B21;&#x63A5;&#x89E6;&#x5230;&#x94FE;&#x8868;&#x7684;&#x8BFB;&#x8005;&#x3002;&#x5BB9;&#x6613;&#x72AF;&#x7684;&#x662F;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node.next = newNode</span><br><span class=\"line\">newNode.next = node.next</span><br></pre></td></tr></table></figure>\n<p>&#x72AF;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x7684;&#x672C;&#x8D28;&#x7EDD;&#x5927;&#x591A;&#x6570;&#x8FD8;&#x662F;&#x5BF9;&#x94FE;&#x8868;&#x7684;&#x6307;&#x9488;&#x7406;&#x89E3;&#x4E0D;&#x5230;&#x4F4D;&#x3002;&#x5176;&#x5B9E;&#x5BF9;&#x4E8E;&#x6307;&#x9488;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8BB0;&#x4F4F;&#x4E00;&#x70B9;&#xFF0C;&#x6307;&#x9488;&#x6307;&#x5411;&#x7684;&#x662F;&#x8282;&#x70B9;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x5730;&#x5740;&#x3002;&#x6539;&#x53D8;&#x6307;&#x9488;&#x5C31;&#x662F;&#x6539;&#x53D8;&#x6307;&#x5411;&#x7684;&#x5730;&#x5740;&#x3002;</p>\n<p>&#x6B63;&#x786E;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x4E0B;&#x9762;&#x8FD9;&#x79CD;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">newNode.next = node.next</span><br><span class=\"line\">node.next = newNode</span><br></pre></td></tr></table></figure>\n<p>&#x5F53;&#x7136;&#xFF0C;&#x4E3A;&#x4E86;&#x675C;&#x7EDD;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x591A;&#x7EC3;&#xFF0C;&#x5199;&#x591A;&#x4E86;&#x81EA;&#x7136;&#x5C31;&#x4F1A;&#x4E86;&#x3002;</p>\n<p>&#x6240;&#x8C13;&#x4E66;&#x8BFB;&#x767E;&#x904D;&#x5176;&#x4E49;&#x81EA;&#x89C1;&#xFF0C;&#x5E94;&#x8BE5;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#x9053;&#x7406;&#x3002;</p>\n<p>&#x8FD8;&#x6709;&#x4E0A;&#x9762;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x7684;&#x662F;&#x57FA;&#x4E8E;&#x4E00;&#x4E2A;&#x524D;&#x63D0;&#x7684;&#xFF1A;&#x5DF2;&#x7ECF;&#x627E;&#x5230;&#x4E86;&#x63D2;&#x5165;&#x8282;&#x70B9;&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x800C;&#x67E5;&#x627E;&#x5F53;&#x524D;&#x63D2;&#x5165;&#x70B9;&#xFF0C;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x904D;&#x5386;&#x6574;&#x4E2A;&#x94FE;&#x8868;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x94FE;&#x8868;&#x4E2D;&#x67E5;&#x627E;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;O(n)&#x3002;</p>\n<p>&#x53EF;&#x80FD;&#x6709;&#x7684;&#x8BFB;&#x8005;&#x4E00;&#x76F4;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x7591;&#x95EE;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x6709;&#x4E86;&#x5355;&#x94FE;&#x8868;&#x8FD8;&#x6709;&#x51FA;&#x6765;&#x4E00;&#x4E2A;&#x53CC;&#x5411;&#x94FE;&#x8868;&#xFF0C;&#x4F60;&#x770B;&#x8FD9;&#x63D2;&#x5165;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x4E5F;&#x662F;&#x4E0E;&#x5355;&#x94FE;&#x8868;&#x4E00;&#x6837;&#xFF0C;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x90FD;&#x4E3A;O(1)&#xFF0C;&#x800C;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x7531;&#x4E8E;&#x5B83;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x989D;&#x5916;&#x9700;&#x8981;prev&#x524D;&#x9A71;&#x8282;&#x70B9;&#xFF0C;&#x5BFC;&#x81F4;&#x5B83;&#x66F4;&#x52A0;&#x6D6A;&#x8D39;&#x5185;&#x5B58;&#x3002;</p>\n<p>&#x9488;&#x5BF9;&#x8FD9;&#x7C7B;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4E0A;&#x9762;&#x7684;&#x63D2;&#x5165;&#x4F4D;&#x7F6E;&#x505A;&#x4E00;&#x4E0B;&#x8C03;&#x6574;&#x3002;</p>\n<p>&#x73B0;&#x5728;&#x5DF2;&#x77E5;&#x4E86;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x4E0B;&#x9762;&#x9700;&#x8981;&#x5C06;&#x65B0;&#x8282;&#x70B9;&#x63D2;&#x5165;&#x5230;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x524D;&#x9762;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x662F;&#x5355;&#x94FE;&#x8868;&#xFF0C;&#x7531;&#x4E8E;&#x53EA;&#x6709;next&#x6307;&#x9488;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x80FD;&#x91CD;&#x65B0;&#x904D;&#x5386;&#x94FE;&#x8868;&#xFF0C;&#x627E;&#x5230;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x4E0A;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x91CD;&#x590D;&#x4E0A;&#x9762;&#x7684;&#x8F6C;&#x79FB;&#x6307;&#x9488;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x6B64;&#x65F6;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;O(n)&#x3002;</p>\n<p>&#x800C;&#x5BF9;&#x4E8E;&#x53CC;&#x5411;&#x94FE;&#x8868;&#xFF0C;&#x7531;&#x4E8E;&#x5B83;&#x8FD8;&#x6709;prev&#x6267;&#x884C;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6539;&#x53D8;prev&#x7684;&#x6307;&#x5411;&#xFF0C;&#x6765;&#x5C06;&#x65B0;&#x8282;&#x70B9;&#x63D2;&#x5165;&#x5230;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x524D;&#x9762;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;O(1)&#x3002;</p>\n<p><img src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4482a1cecb5d43e0b45eaf5e2fb4138b~tplv-k3u1fbpfcp-watermark.image\" alt></p>\n<p>&#x6B63;&#x662F;&#x7531;&#x4E8E;&#x8FD9;&#x7279;&#x6027;&#xFF0C;&#x5728;&#x5B9E;&#x9645;&#x8FD0;&#x7528;&#x4E2D;&#xFF0C;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x6BD4;&#x5355;&#x94FE;&#x8868;&#x66F4;&#x52A0;&#x666E;&#x904D;&#xFF0C;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x6240;&#x719F;&#x6089;&#x7684;LinkedList</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private static class Node&lt;E&gt; {</span><br><span class=\"line\">    E item;</span><br><span class=\"line\">    Node&lt;E&gt; next;</span><br><span class=\"line\">    Node&lt;E&gt; prev;</span><br><span class=\"line\">    Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) {</span><br><span class=\"line\">        this.item = element;</span><br><span class=\"line\">        this.next = next;</span><br><span class=\"line\">        this.prev = prev;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x5220;&#x9664;\"><a href=\"#&#x5220;&#x9664;\" class=\"headerlink\" title=\"&#x5220;&#x9664;\"></a>&#x5220;&#x9664;</h2><p>&#x94FE;&#x8868;&#x7684;&#x5220;&#x9664;&#x4E0E;&#x63D2;&#x5165;&#x539F;&#x7406;&#x7C7B;&#x4F3C;&#xFF0C;&#x90FD;&#x662F;&#x6539;&#x53D8;&#x8282;&#x70B9;&#x7684;&#x6307;&#x9488;&#x6307;&#x5411;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x5355;&#x94FE;&#x8868;&#xFF0C;&#x5982;&#x679C;&#x5220;&#x9664;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x540E;&#x7EED;&#x8282;&#x70B9;&#xFF0C;&#x53EA;&#x9700;&#x5C06;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;next&#x6307;&#x9488;&#x6307;&#x5411;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x540E;&#x7EED;&#x8282;&#x70B9;&#x7684;&#x540E;&#x7EED;&#x8282;&#x70B9;&#x3002;&#x6587;&#x5B57;&#x6709;&#x70B9;&#x7ED5;&#xFF0C;&#x8FD8;&#x662F;&#x76F4;&#x63A5;&#x770B;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node.next = node.next.next</span><br></pre></td></tr></table></figure>\n<p>&#x800C;&#x5BF9;&#x4E8E;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x6765;&#x8BF4;&#xFF0C;&#x9664;&#x4E86;&#x6539;&#x53D8;next&#x8282;&#x70B9;&#xFF0C;&#x8FD8;&#x8981;&#x6539;&#x53D8;next&#x6307;&#x5411;&#x7684;prev&#x8282;&#x70B9;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node.next = node.next.next</span><br><span class=\"line\">node.next.prev = node</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x4EEC;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x90FD;&#x4E3A;O(1)</p>\n<p>&#x53E6;&#x5916;&#x7684;&#x5220;&#x9664;&#x8282;&#x70B9;&#x4E3A;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x3002;&#x8FD9;&#x4E2A;&#x4E0E;&#x63D2;&#x5165;&#x539F;&#x7406;&#x7C7B;&#x4F3C;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x505A;&#x8BE6;&#x7EC6;&#x5206;&#x6790;&#x3002;&#x5355;&#x94FE;&#x8868;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;O(n)&#xFF0C;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;O(1)&#x3002;</p>\n<h2 id=\"&#x6CE8;&#x610F;&#x70B9;\"><a href=\"#&#x6CE8;&#x610F;&#x70B9;\" class=\"headerlink\" title=\"&#x6CE8;&#x610F;&#x70B9;\"></a>&#x6CE8;&#x610F;&#x70B9;</h2><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5BF9;&#x94FE;&#x8868;&#x6709;&#x4E86;&#x4E00;&#x4E2A;&#x8F83;&#x5168;&#x9762;&#x7684;&#x4E86;&#x89E3;&#x3002;&#x4F46;&#x5F00;&#x59CB;&#x4E0A;&#x624B;&#x5199;&#x7684;&#x65F6;&#x5019;&#x8FD8;&#x662F;&#x4F1A;&#x5F88;&#x5BB9;&#x6613;&#x72AF;&#x9519;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x7ED3;&#x5408;&#x81EA;&#x5DF1;&#x7684;&#x4E00;&#x70B9;&#x5FAE;&#x8584;&#x7684;&#x7ECF;&#x9A8C;&#x8FD8;&#x5BF9;&#x5BB9;&#x6613;&#x72AF;&#x7684;&#x9519;&#x8BEF;&#x505A;&#x4E00;&#x4E2A;&#x603B;&#x7ED3;&#xFF0C;&#x5E76;&#x5BF9;&#x5176;&#x63D0;&#x51FA;&#x76F8;&#x5E94;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;</p>\n<h3 id=\"&#x6307;&#x9488;&#x7684;&#x6307;&#x5411;&#x95EE;&#x9898;\"><a href=\"#&#x6307;&#x9488;&#x7684;&#x6307;&#x5411;&#x95EE;&#x9898;\" class=\"headerlink\" title=\"&#x6307;&#x9488;&#x7684;&#x6307;&#x5411;&#x95EE;&#x9898;\"></a>&#x6307;&#x9488;&#x7684;&#x6307;&#x5411;&#x95EE;&#x9898;</h3><p>&#x9996;&#x5148;&#x662F;&#x5199;&#x94FE;&#x8868;&#x65F6;&#xFF0C;&#x5BF9;&#x4E8E;&#x6307;&#x9488;&#x7684;&#x6307;&#x5411;&#x9519;&#x4E71;&#x95EE;&#x9898;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x9047;&#x5230;&#x7B80;&#x5355;&#x7684;&#x63D2;&#x5165;&#x5220;&#x9664;&#xFF0C;&#x6B65;&#x9AA4;&#x4E0D;&#x662F;&#x5F88;&#x9891;&#x7E41;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x76F8;&#x4FE1;&#x5927;&#x5BB6;&#x90FD;&#x80FD;&#x591F;&#x5F88;&#x5BB9;&#x6613;&#x7684;&#x5B8C;&#x6210;&#x3002;&#x4E00;&#x65E6;&#x6D89;&#x53CA;&#x5230;&#x94FE;&#x8868;&#x7684;&#x6307;&#x9488;&#x9891;&#x7E41;&#x6539;&#x53D8;&#xFF0C;&#x4EA6;&#x6216;&#x8005;&#x662F;&#x53CC;&#x5411;&#x94FE;&#x8868;(&#x518D;&#x52A0;&#x4E00;&#x4E2A;&#x524D;&#x9A71;&#x6307;&#x9488;)&#xFF0C;&#x8FD9;&#x65F6;&#x72AF;&#x9519;&#x7387;&#x5C31;&#x4F1A;&#x76F4;&#x7EBF;&#x63D0;&#x5347;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x8FD9;&#x79CD;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x7ED9;&#x51FA;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#xFF1A;</p>\n<ol>\n<li>&#x653E;&#x4E0B;&#x5FC3;&#x6765;&#x4ED4;&#x7EC6;&#x601D;&#x8003;&#xFF0C;&#x7406;&#x6E05;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#xFF0C;&#x518D;&#x52A8;&#x624B;&#x5199;&#x4EE3;&#x7801;&#x3002;</li>\n<li>&#x501F;&#x52A9;&#x8F85;&#x52A9;&#x5DE5;&#x5177;&#xFF0C;&#x4F8B;&#x5982;&#x505C;&#x4E0B;&#x624B;&#x6765;&#xFF0C;&#x627E;&#x53EA;&#x7B14;&#x627E;&#x5F20;&#x7EB8;&#xFF0C;&#x628A;&#x94FE;&#x8868;&#x7684;&#x7ED3;&#x6784;&#x753B;&#x51FA;&#x6765;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x753B;&#x5B83;&#x4EEC;&#x95F4;&#x7684;&#x6307;&#x9488;&#x6307;&#x5411;&#x3002;</li>\n<li>&#x7B80;&#x5355;&#x7C97;&#x66B4;&#xFF0C;&#x591A;&#x770B;&#x591A;&#x7EC3;&#x3002;&#x57FA;&#x672C;&#x4E0A;&#x505A;&#x4E2A;&#x6BCF;&#x5929;&#x505A;&#x4E2A;&#x4E00;&#x4E24;&#x9053;&#xFF0C;&#x575A;&#x6301;&#x4E00;&#x661F;&#x671F;&#x57FA;&#x672C;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</li>\n</ol>\n<h3 id=\"&#x8FB9;&#x754C;&#x95EE;&#x9898;\"><a href=\"#&#x8FB9;&#x754C;&#x95EE;&#x9898;\" class=\"headerlink\" title=\"&#x8FB9;&#x754C;&#x95EE;&#x9898;\"></a>&#x8FB9;&#x754C;&#x95EE;&#x9898;</h3><p>&#x5728;&#x5199;&#x94FE;&#x8868;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x5C31;&#x662F;&#x5BF9;&#x8FB9;&#x754C;&#x7684;&#x5904;&#x7406;&#x3002;</p>\n<p>&#x53EF;&#x80FD;&#x662F;&#x5FD8;&#x4E86;&#x5BF9;&#x8FB9;&#x754C;&#x7684;&#x5904;&#x7406;&#xFF1B;&#x4E5F;&#x53EF;&#x80FD;&#x662F;&#x76F4;&#x63A5;&#x5904;&#x7406;&#x9519;&#x8BEF;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x94FE;&#x8868;&#x7684;&#x8FB9;&#x754C;&#x5C31;&#x662F;&#x5B83;&#x7684;&#x5934;&#x8282;&#x70B9;&#x4E0E;&#x5C3E;&#x8282;&#x70B9;&#x3002;&#x7531;&#x4E8E;&#x5B83;&#x4EEC;&#x7684;&#x7279;&#x6B8A;&#x6027;&#xFF0C;&#x9488;&#x5BF9;&#x5B83;&#x4EEC;&#x7684;&#x63D2;&#x5165;&#x4E0E;&#x5220;&#x9664;&#xFF0C;&#x53EF;&#x80FD;&#x4E0E;&#x522B;&#x7684;&#x8282;&#x70B9;&#x4E0D;&#x540C;&#xFF0C;&#x9700;&#x8981;&#x989D;&#x5916;&#x8FDB;&#x884C;&#x7279;&#x6B8A;&#x5904;&#x7406;&#x3002;</p>\n<p>&#x9488;&#x5BF9;&#x8FD9;&#x79CD;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#xFF0C;&#x5199;&#x5B8C;&#x94FE;&#x8868;&#x4E4B;&#x540E;&#xFF0C;&#x65F6;&#x523B;&#x90FD;&#x8981;&#x63D0;&#x9192;&#x81EA;&#x5DF1;&#x662F;&#x5426;&#x5BF9;&#x8FB9;&#x754C;&#x505A;&#x4E86;&#x5904;&#x7406;&#xFF0C;&#x5982;&#x679C;&#x505A;&#x4E86;&#x4E5F;&#x8981;&#x505C;&#x4E0B;&#x6765;&#x601D;&#x8003;&#x4E00;&#x904D;&#x662F;&#x5426;&#x5904;&#x7406;&#x6B63;&#x786E;&#x3002;</p>\n<p>&#x8FD9;&#x6837;&#x5C31;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x4FDD;&#x8BC1;&#x8FB9;&#x754C;&#x5904;&#x7406;&#x7684;&#x6B63;&#x786E;&#x6027;&#x3002;</p>\n<p>&#x5343;&#x4E07;&#x4E0D;&#x8981;&#x5077;&#x61D2;&#xFF0C;&#x522B;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x8FB9;&#x754C;&#x95EE;&#x9898;&#x5BFC;&#x81F4;&#x5728;&#x9762;&#x8BD5;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x8BC4;&#x5206;&#x6253;&#x6298;&#x6263;&#x3002;&#x56E0;&#x4E3A;&#x8FD9;&#x80FD;&#x4ECE;&#x4FA7;&#x9762;&#x4F53;&#x73B0;&#x4E00;&#x4E2A;&#x4EBA;&#x7684;&#x601D;&#x7EF4;&#x7684;&#x5168;&#x9762;&#x4E0E;&#x7F1C;&#x5BC6;&#x6027;&#x3002;</p>\n<h3 id=\"&#x54E8;&#x5175;&#x4F18;&#x5316;\"><a href=\"#&#x54E8;&#x5175;&#x4F18;&#x5316;\" class=\"headerlink\" title=\"&#x54E8;&#x5175;&#x4F18;&#x5316;\"></a>&#x54E8;&#x5175;&#x4F18;&#x5316;</h3><p>&#x9488;&#x5BF9;&#x4E0A;&#x9762;&#x7684;&#x8FB9;&#x754C;&#x95EE;&#x9898;&#xFF0C;&#x6709;&#x6CA1;&#x6709;&#x4EE3;&#x7801;&#x4E0A;&#x7684;&#x4F18;&#x5316;&#x5462;&#xFF1F;</p>\n<p>&#x6709;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x8981;&#x8BF4;&#x7684;&#x5C31;&#x662F;&#x54E8;&#x5175;&#x4F18;&#x5316;&#x3002;</p>\n<p>&#x6240;&#x8C13;&#x7684;&#x54E8;&#x5175;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x7406;&#x89E3;&#x5C31;&#x662F;&#x56FA;&#x5B9A;&#x4E00;&#x4E2A;&#x6807;&#x8BC6;&#xFF0C;&#x8BA9;&#x5B83;&#x50CF;&#x8FB9;&#x754C;&#x7684;&#x58EB;&#x5175;&#x4E00;&#x6837;&#xFF0C;&#x4E00;&#x76F4;&#x5C79;&#x7ACB;&#x5728;&#x4ED6;&#x7684;&#x8FB9;&#x754C;&#x5C97;&#x4F4D;&#xFF0C;&#x5B88;&#x536B;&#x56FD;&#x571F;&#x7684;&#x5B89;&#x5168;&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x62FF;&#x4E0A;&#x9762;&#x7684;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x7684;&#x5220;&#x9664;&#x6765;&#x8BF4;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x975E;&#x5934;&#x8282;&#x70B9;&#x7684;&#x5220;&#x9664;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x627E;&#x5230;&#x5F53;&#x524D;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x7136;&#x540E;&#x6539;&#x53D8;&#x5B83;&#x524D;&#x540E;&#x8282;&#x70B9;&#x7684;next&#x4E0E;prev&#x6307;&#x9488;&#x7684;&#x6307;&#x5411;&#x5373;&#x53EF;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node.prev.next = node.next</span><br><span class=\"line\">node.next.prev = node.prev</span><br></pre></td></tr></table></figure>\n<p>&#x73B0;&#x5728;&#x5982;&#x679C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x662F;&#x5934;&#x8282;&#x70B9;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x4E0D;&#x80FD;&#x8FD0;&#x884C;&#xFF0C;&#x56E0;&#x4E3A;&#x5934;&#x8282;&#x70B9;&#x7684;prev&#x8282;&#x70B9;&#x4E3A;null&#xFF0C;&#x6240;&#x4EE5;&#x5E38;&#x89C4;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x505A;&#x7279;&#x6B8A;&#x5224;&#x65AD;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (node == head) {</span><br><span class=\"line\">    node.next.prev = null</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x5C31;&#x662F;&#x8FB9;&#x754C;&#x95EE;&#x9898;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8BB0;&#x5F97;&#x5904;&#x7406;&#x90A3;&#x8FD8;&#x597D;&#xFF0C;&#x4E00;&#x65E6;&#x5FD8;&#x4E86;&#x5C31;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#x3002;</p>\n<p>&#x800C;&#x4F7F;&#x7528;&#x54E8;&#x5175;&#x5C31;&#x80FD;&#x591F;&#x5B8C;&#x5168;&#x89C4;&#x907F;&#x8FB9;&#x754C;&#x7684;&#x5224;&#x65AD;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x5177;&#x4F53;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x5EFA;&#x7ACB;&#x54E8;&#x5175;&#xFF0C;&#x65B0;&#x5EFA;#&#x8282;&#x70B9;&#xFF0C;&#x5E76;&#x5C06;&#x5176;next&#x6307;&#x9488;&#x6307;&#x5411;&#x5934;&#x8282;&#x70B9;</span><br><span class=\"line\">val guard = LinkedNode(&quot;#&quot;)</span><br><span class=\"line\">val newLinked = guard.next = head</span><br><span class=\"line\">head.prev = guard</span><br><span class=\"line\"> </span><br><span class=\"line\">...</span><br><span class=\"line\"> </span><br><span class=\"line\">// &#x8282;&#x70B9;&#x5220;&#x9664;(&#x5305;&#x62EC;&#x5934;&#x8282;&#x70B9;)</span><br><span class=\"line\">node.prev.next = node.next</span><br><span class=\"line\">node.next.prev = node.prev</span><br><span class=\"line\">// &#x8FD4;&#x56DE;&#x5220;&#x9664;&#x540E;&#x7684;&#x94FE;&#x8868;</span><br><span class=\"line\">return newLinked.next</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a9ca891b56cc4db6a7e9e201d7a21584~tplv-k3u1fbpfcp-watermark.image\" alt></p>\n<h2 id=\"&#x7ECF;&#x5178;&#x5B9E;&#x4F8B;\"><a href=\"#&#x7ECF;&#x5178;&#x5B9E;&#x4F8B;\" class=\"headerlink\" title=\"&#x7ECF;&#x5178;&#x5B9E;&#x4F8B;\"></a>&#x7ECF;&#x5178;&#x5B9E;&#x4F8B;</h2><p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E9B;&#x5173;&#x4E8E;&#x94FE;&#x8868;&#x7684;&#x7ECF;&#x5178;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x5982;&#x679C;&#x5BF9;&#x94FE;&#x8868;&#x8FD8;&#x4E0D;&#x719F;&#x6089;&#x7684;&#x63A8;&#x8350;&#x4EB2;&#x81EA;&#x53BB;&#x5199;&#x4E00;&#x904D;&#x3002;</p>\n<p>&#x5199;&#x5B8C;&#x4E4B;&#x540E;&#x4F60;&#x5C06;&#x5BF9;&#x94FE;&#x8868;&#x6709;&#x4E00;&#x4E2A;&#x5168;&#x65B0;&#x7684;&#x8BA4;&#x8BC6;&#x3002;</p>\n<ol>\n<li>&#x73AF;&#x7684;&#x68C0;&#x6D4B;</li>\n<li>&#x5355;&#x94FE;&#x8868;&#x53CD;&#x8F6C;</li>\n<li>&#x5220;&#x9664;&#x94FE;&#x8868;&#x5012;&#x6570;&#x7B2C;n&#x4E2A;&#x7ED3;&#x70B9;</li>\n<li>LRU</li>\n<li>&#x6C42;&#x94FE;&#x8868;&#x7684;&#x4E2D;&#x95F4;&#x7ED3;&#x70B9;</li>\n<li>&#x4E24;&#x4E2A;&#x6709;&#x5E8F;&#x94FE;&#x8868;&#x7684;&#x5408;&#x5E76;</li>\n<li>&#x5355;&#x94FE;&#x8868;&#x5224;&#x65AD;&#x56DE;&#x6587;</li>\n</ol>\n<p>&#x6211;&#x8FD9;&#x91CC;&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x5168;&#x90E8;&#x7684;&#x6E90;&#x7801;&#xFF0C;kotlin&#x4E0E;java&#x90FD;&#x6709;&#xFF0C;&#x5E0C;&#x671B;&#x5BF9;&#x4F60;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a></p>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["算法"],"tags":["链表"]},{"title":"ActivityManagerService 启动初探","url":"https://www.rousetime.com/2021/01/08/ActivityManagerService-启动初探/","content":"<p>&#x5728;&#x4E4B;&#x524D;&#x7684;<a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484991&amp;idx=1&amp;sn=7a4701c30ade3569c75591a12644c4f3&amp;chksm=e8e0ffafdf9776b9a00e9b912a47578622379e667e45a16f5d814b638e8ab04786e38403542b&amp;token=694410729&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android SystemServer&#x542F;&#x52A8;(&#x4E8C;)</a>&#x4E2D;&#xFF0C;&#x5206;&#x6790;&#x5230;&#x5728;SystemServer&#x4E2D;&#x4F1A;&#x542F;&#x52A8;&#x5927;&#x91CF;&#x7684;Service&#xFF0C;&#x5176;&#x4E2D;&#x5C31;&#x6709;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x7279;&#x6B8A;&#x7684;Service&#xFF0C;&#x5B83;&#x5C31;&#x662F;ActivityManagerService&#x3002;</p>\n<p>&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x5C31;&#x6765;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;ActivityManageerService&#x7684;&#x542F;&#x52A8;&#xFF0C;&#x4E0B;&#x9762;&#x90FD;&#x5C06;&#x5176;&#x7B80;&#x79F0;&#x4E3A;AMS&#x3002;</p>\n<h2 id=\"&#x542F;&#x52A8;AMS\"><a href=\"#&#x542F;&#x52A8;AMS\" class=\"headerlink\" title=\"&#x542F;&#x52A8;AMS\"></a>&#x542F;&#x52A8;AMS</h2><p>AMS&#x7684;&#x542F;&#x52A8;&#x53D1;&#x751F;&#x5728;SystemServer&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;BootPhase 0&#x9636;&#x6BB5;&#x3002;</p>\n<p>&#x5728;&#x4E09;&#x5927;&#x5206;&#x7C7B;&#x670D;&#x52A1;&#x7684;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x4E2D;&#xFF0C;&#x5373;startBootstrapServices&#x65B9;&#x6CD5;&#x4E2D;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void startBootstrapServices() {</span><br><span class=\"line\">\t...</span><br><span class=\"line\"> </span><br><span class=\"line\">    ActivityTaskManagerService atm = mSystemServiceManager.startService(</span><br><span class=\"line\">            ActivityTaskManagerService.Lifecycle.class).getService();</span><br><span class=\"line\">    mActivityManagerService = ActivityManagerService.Lifecycle.startService(</span><br><span class=\"line\">            mSystemServiceManager, atm);</span><br><span class=\"line\">    mActivityManagerService.setSystemServiceManager(mSystemServiceManager);</span><br><span class=\"line\">    mActivityManagerService.setInstaller(installer);</span><br><span class=\"line\">    mWindowManagerGlobalLock = atm.getGlobalLock();</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>AMS&#x7684;&#x662F;&#x901A;&#x8FC7;AMS&#x7684;&#x5185;&#x90E8;&#x7C7B;Lifecycle&#x6765;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x540C;&#x65F6;&#x8C03;&#x7528;Lifecycle.onStart()&#x6765;&#x542F;&#x52A8;AMS&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static final class Lifecycle extends SystemService {</span><br><span class=\"line\">    private final ActivityManagerService mService;</span><br><span class=\"line\">    private static ActivityTaskManagerService sAtm;</span><br><span class=\"line\"> </span><br><span class=\"line\">    public Lifecycle(Context context) {</span><br><span class=\"line\">        super(context);</span><br><span class=\"line\">        mService = new ActivityManagerService(context, sAtm);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    public static ActivityManagerService startService(</span><br><span class=\"line\">            SystemServiceManager ssm, ActivityTaskManagerService atm) {</span><br><span class=\"line\">        sAtm = atm;</span><br><span class=\"line\">        return ssm.startService(ActivityManagerService.Lifecycle.class).getService();</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void onStart() {</span><br><span class=\"line\">        mService.start();</span><br><span class=\"line\">    }</span><br><span class=\"line\">     </span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>Lifecycle&#x7EE7;&#x627F;&#x4E8E;SystemService&#xFF0C;&#x901A;&#x8FC7;ssm&#x5373;SystemServiceManager&#x6765;&#x542F;&#x52A8;&#x8FD9;&#x4E2A;Service&#x3002;</p>\n<p>&#x5185;&#x90E8;&#x662F;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x6765;&#x521B;&#x5EFA;Lifecycle&#x5B9E;&#x4F8B;&#xFF0C;&#x800C;&#x5728;Lifecycle&#x5B9E;&#x4F8B;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F1A;&#x521B;&#x5EFA;AMS&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;AMS&#x5B9E;&#x4F8B;&#x5316;&#x8FC7;&#x7A0B;&#x4E2D;&#x505A;&#x4E86;&#x4EC0;&#x4E48;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public ActivityManagerService(Context systemContext, ActivityTaskManagerService atm) {</span><br><span class=\"line\">\t...</span><br><span class=\"line\"> </span><br><span class=\"line\">\t// &#x521B;&#x5EFA;&#x540D;&#x4E3A;ActivityManager&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x5E76;&#x521B;&#x5EFA;MainHandler </span><br><span class=\"line\">\t// &#x5904;&#x7406;&#x5404;&#x79CD;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#x7684;&#x7EBF;&#x7A0B;&#xFF08;GC&#x3001;service_timeout&#x3001;update_time_zone&#x3001;kill_application&#x3001;kill_zygote&#xFF09;</span><br><span class=\"line\">    mHandlerThread = new ServiceThread(TAG,</span><br><span class=\"line\">            THREAD_PRIORITY_FOREGROUND, false /*allowIo*/);</span><br><span class=\"line\">    mHandlerThread.start();</span><br><span class=\"line\">    mHandler = new MainHandler(mHandlerThread.getLooper());</span><br><span class=\"line\">    // &#x83B7;&#x53D6;UiHandler</span><br><span class=\"line\">    mUiHandler = mInjector.getUiHandler(this);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x521B;&#x5EFA;&#x4E0E;&#x542F;&#x52A8;proc&#x7EBF;&#x7A0B;</span><br><span class=\"line\">    mProcStartHandlerThread = new ServiceThread(TAG + &quot;:procStart&quot;,</span><br><span class=\"line\">            THREAD_PRIORITY_FOREGROUND, false /* allowIo */);</span><br><span class=\"line\">    mProcStartHandlerThread.start();</span><br><span class=\"line\">    mProcStartHandler = new Handler(mProcStartHandlerThread.getLooper());</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x5B9A;&#x4E49;&#x4E00;&#x4E9B;&#x5E38;&#x91CF;&#xFF0C;&#x7BA1;&#x7406;ActivityManager&#x7684;&#x884C;&#x4E3A;</span><br><span class=\"line\">    mConstants = new ActivityManagerConstants(mContext, this, mHandler);</span><br><span class=\"line\">    // &#x8FFD;&#x8E2A;&#x6D3B;&#x8DC3;&#x7684;uid</span><br><span class=\"line\">    final ActiveUids activeUids = new ActiveUids(this, true /* postChangesToAtm */);</span><br><span class=\"line\">    mProcessList.init(this, activeUids);</span><br><span class=\"line\">    // &#x4F4E;&#x5185;&#x5B58;&#x63A2;&#x6D4B;&#x5668;</span><br><span class=\"line\">    mLowMemDetector = new LowMemDetector(this);</span><br><span class=\"line\">    mOomAdjuster = new OomAdjuster(this, mProcessList, activeUids);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x524D;&#x53F0;&#x5E7F;&#x64AD;&#x63A5;&#x6536;&#x5668;</span><br><span class=\"line\">    final BroadcastConstants foreConstants = new BroadcastConstants(</span><br><span class=\"line\">            Settings.Global.BROADCAST_FG_CONSTANTS);</span><br><span class=\"line\">    foreConstants.TIMEOUT = BROADCAST_FG_TIMEOUT;</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x540E;&#x53F0;&#x5E7F;&#x64AD;&#x63A5;&#x6536;&#x5668;</span><br><span class=\"line\">    final BroadcastConstants backConstants = new BroadcastConstants(</span><br><span class=\"line\">            Settings.Global.BROADCAST_BG_CONSTANTS);</span><br><span class=\"line\">    backConstants.TIMEOUT = BROADCAST_BG_TIMEOUT;</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x5378;&#x8F7D;&#x5E7F;&#x64AD;&#x63A5;&#x6536;&#x5668;</span><br><span class=\"line\">    final BroadcastConstants offloadConstants = new BroadcastConstants(</span><br><span class=\"line\">            Settings.Global.BROADCAST_OFFLOAD_CONSTANTS);</span><br><span class=\"line\">    offloadConstants.TIMEOUT = BROADCAST_BG_TIMEOUT;</span><br><span class=\"line\"> </span><br><span class=\"line\">    offloadConstants.SLOW_TIME = Integer.MAX_VALUE;</span><br><span class=\"line\"> </span><br><span class=\"line\">    mEnableOffloadQueue = SystemProperties.getBoolean(</span><br><span class=\"line\">            &quot;persist.device_config.activity_manager_native_boot.offload_queue_enabled&quot;, false);</span><br><span class=\"line\"> </span><br><span class=\"line\">    mFgBroadcastQueue = new BroadcastQueue(this, mHandler,</span><br><span class=\"line\">            &quot;foreground&quot;, foreConstants, false);</span><br><span class=\"line\">    mBgBroadcastQueue = new BroadcastQueue(this, mHandler,</span><br><span class=\"line\">            &quot;background&quot;, backConstants, true);</span><br><span class=\"line\">    mOffloadBroadcastQueue = new BroadcastQueue(this, mHandler,</span><br><span class=\"line\">            &quot;offload&quot;, offloadConstants, true);</span><br><span class=\"line\">    mBroadcastQueues[0] = mFgBroadcastQueue;</span><br><span class=\"line\">    mBroadcastQueues[1] = mBgBroadcastQueue;</span><br><span class=\"line\">    mBroadcastQueues[2] = mOffloadBroadcastQueue;</span><br><span class=\"line\"> </span><br><span class=\"line\">    mServices = new ActiveServices(this);</span><br><span class=\"line\">    mProviderMap = new ProviderMap(this);</span><br><span class=\"line\">    mPackageWatchdog = PackageWatchdog.getInstance(mUiContext);</span><br><span class=\"line\">    mAppErrors = new AppErrors(mUiContext, this, mPackageWatchdog);</span><br><span class=\"line\"> </span><br><span class=\"line\">    final File systemDir = SystemServiceManager.ensureSystemDir();</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x7535;&#x6C60;&#x72B6;&#x6001;</span><br><span class=\"line\">    mBatteryStatsService = new BatteryStatsService(systemContext, systemDir,</span><br><span class=\"line\">            BackgroundThread.get().getHandler());</span><br><span class=\"line\">    mBatteryStatsService.getActiveStatistics().readLocked();</span><br><span class=\"line\">    mBatteryStatsService.scheduleWriteToDisk();</span><br><span class=\"line\">    mOnBattery = DEBUG_POWER ? true</span><br><span class=\"line\">            : mBatteryStatsService.getActiveStatistics().getIsOnBattery();</span><br><span class=\"line\">    mBatteryStatsService.getActiveStatistics().setCallback(this);</span><br><span class=\"line\">    mOomAdjProfiler.batteryPowerChanged(mOnBattery);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x8FDB;&#x7A0B;&#x72B6;&#x6001;</span><br><span class=\"line\">    mProcessStats = new ProcessStatsService(this, new File(systemDir, &quot;procstats&quot;));</span><br><span class=\"line\"> </span><br><span class=\"line\">    mAppOpsService = mInjector.getAppOpsService(new File(systemDir, &quot;appops.xml&quot;), mHandler);</span><br><span class=\"line\"> </span><br><span class=\"line\">    ... </span><br><span class=\"line\"> </span><br><span class=\"line\">    mActivityTaskManager = atm;</span><br><span class=\"line\">    mActivityTaskManager.initialize(mIntentFirewall, mPendingIntentController,</span><br><span class=\"line\">            DisplayThread.get().getLooper());</span><br><span class=\"line\">    mAtmInternal = LocalServices.getService(ActivityTaskManagerInternal.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x8FDB;&#x7A0B;cpu&#x7EDF;&#x8BA1;&#x7EBF;&#x7A0B;</span><br><span class=\"line\">    mProcessCpuThread = new Thread(&quot;CpuTracker&quot;) {</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void run() {</span><br><span class=\"line\">            synchronized (mProcessCpuTracker) {</span><br><span class=\"line\">                mProcessCpuInitLatch.countDown();</span><br><span class=\"line\">                mProcessCpuTracker.init();</span><br><span class=\"line\">            }</span><br><span class=\"line\">            while (true) {</span><br><span class=\"line\">                try {</span><br><span class=\"line\">                    try {</span><br><span class=\"line\">                        synchronized(this) {</span><br><span class=\"line\">                            final long now = SystemClock.uptimeMillis();</span><br><span class=\"line\">                            long nextCpuDelay = (mLastCpuTime.get()+MONITOR_CPU_MAX_TIME)-now;</span><br><span class=\"line\">                            long nextWriteDelay = (mLastWriteTime+BATTERY_STATS_TIME)-now;</span><br><span class=\"line\">                            //Slog.i(TAG, &quot;Cpu delay=&quot; + nextCpuDelay</span><br><span class=\"line\">                            //        + &quot;, write delay=&quot; + nextWriteDelay);</span><br><span class=\"line\">                            if (nextWriteDelay &lt; nextCpuDelay) {</span><br><span class=\"line\">                                nextCpuDelay = nextWriteDelay;</span><br><span class=\"line\">                            }</span><br><span class=\"line\">                            if (nextCpuDelay &gt; 0) {</span><br><span class=\"line\">                                mProcessCpuMutexFree.set(true);</span><br><span class=\"line\">                                this.wait(nextCpuDelay);</span><br><span class=\"line\">                            }</span><br><span class=\"line\">                        }</span><br><span class=\"line\">                    } catch (InterruptedException e) {</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                    // &#x66F4;&#x65B0;cpu&#x7684;&#x4FE1;&#x606F;</span><br><span class=\"line\">                    updateCpuStatsNow();</span><br><span class=\"line\">                } catch (Exception e) {</span><br><span class=\"line\">                    Slog.e(TAG, &quot;Unexpected exception collecting process stats&quot;, e);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    };</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x662F;&#x521B;&#x5EFA;ActivityManager&#x3001;proc&#x4E0E;CpuTracker&#x7EBF;&#x7A0B;&#xFF1B;&#x540C;&#x65F6;&#x521B;&#x5EFA;&#x5BF9;&#x5E94;&#x7684;&#x5E7F;&#x64AD;&#x63A5;&#x6536;&#x5668;&#x3002;</p>\n<p>&#x521B;&#x5EFA;&#x5B8C;AMS&#x5B9E;&#x4F8B;&#x4E4B;&#x540E;&#x4F1A;&#x8C03;&#x7528;start()&#x65B9;&#x6CD5;&#x6765;&#x542F;&#x52A8;AMS</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void start() {</span><br><span class=\"line\">\t// &#x79FB;&#x9664;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#x7EC4;</span><br><span class=\"line\">    removeAllProcessGroups();</span><br><span class=\"line\">    // &#x5F00;&#x542F;&#x8FDB;&#x7A0B;cpu&#x7EDF;&#x8BA1;&#x7EBF;&#x7A0B;</span><br><span class=\"line\">    mProcessCpuThread.start();</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;&#x7535;&#x6C60;&#x7EDF;&#x8BA1;&#x670D;&#x52A1;</span><br><span class=\"line\">    mBatteryStatsService.publish();</span><br><span class=\"line\">    mAppOpsService.publish(mContext);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x6DFB;&#x52A0;&#x5230;&#x672C;&#x5730;LocalServices&#x4E2D;</span><br><span class=\"line\">    LocalServices.addService(ActivityManagerInternal.class, new LocalService());</span><br><span class=\"line\">    mActivityTaskManager.onActivityManagerInternalAdded();</span><br><span class=\"line\">    mUgmInternal.onActivityManagerInternalAdded();</span><br><span class=\"line\">    mPendingIntentController.onActivityManagerInternalAdded();</span><br><span class=\"line\"> </span><br><span class=\"line\">    try {</span><br><span class=\"line\">    \t// &#x7B49;&#x5F85;&#x8FDB;&#x7A0B;cpu&#x7EDF;&#x8BA1;&#x7EBF;&#x7A0B;&#x8FD0;&#x884C;</span><br><span class=\"line\">        mProcessCpuInitLatch.await();</span><br><span class=\"line\">    } catch (InterruptedException e) {</span><br><span class=\"line\">        Slog.wtf(TAG, &quot;Interrupted wait during start&quot;, e);</span><br><span class=\"line\">        Thread.currentThread().interrupt();</span><br><span class=\"line\">        throw new IllegalStateException(&quot;Interrupted wait during start&quot;);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;&#x65F6;&#x5019;AMS&#x5C31;&#x5DF2;&#x7ECF;&#x542F;&#x52A8;&#x5B8C;&#x6BD5;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5728;&#x6765;&#x770B;&#x4E0B;AMS&#x5728;SystemServer&#x4E2D;&#x90FD;&#x5E72;&#x4E86;&#x4EC0;&#x4E48;</p>\n<h2 id=\"startBootstrapServices\"><a href=\"#startBootstrapServices\" class=\"headerlink\" title=\"startBootstrapServices\"></a>startBootstrapServices</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void startBootstrapServices() {</span><br><span class=\"line\">\t...</span><br><span class=\"line\"> </span><br><span class=\"line\">\tmActivityManagerService.initPowerManagement();</span><br><span class=\"line\">\t...</span><br><span class=\"line\"> </span><br><span class=\"line\">\tmActivityManagerService.setSystemProcess();</span><br><span class=\"line\">\t...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"initPowerManagement\"><a href=\"#initPowerManagement\" class=\"headerlink\" title=\"initPowerManagement\"></a>initPowerManagement</h3><p>&#x9996;&#x5148;&#x4F1A;&#x521D;&#x59CB;&#x5316;PowerManagement</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void initPowerManagement() {</span><br><span class=\"line\">    mActivityTaskManager.onInitPowerManagement();</span><br><span class=\"line\">    mBatteryStatsService.initPowerManagement();</span><br><span class=\"line\">    mLocalPowerManager = LocalServices.getService(PowerManagerInternal.class);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x7EC8;&#x4F1A;&#x901A;&#x8FC7;BatterStateService&#x6765;&#x521D;&#x59CB;&#x5316;PowerManagement&#x3002;</p>\n<h3 id=\"setSystemProcess\"><a href=\"#setSystemProcess\" class=\"headerlink\" title=\"setSystemProcess\"></a>setSystemProcess</h3><p>&#x63A5;&#x4E0B;&#x6765;&#x662F;setSystemProcess&#xFF0C;&#x6CE8;&#x518C;&#x76F8;&#x5173;&#x7684;&#x670D;&#x52A1;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void setSystemProcess() {</span><br><span class=\"line\">    try {</span><br><span class=\"line\">    \t// &#x6CE8;&#x518C;ActivityManagerService</span><br><span class=\"line\">        ServiceManager.addService(Context.ACTIVITY_SERVICE, this, /* allowIsolated= */ true,</span><br><span class=\"line\">                DUMP_FLAG_PRIORITY_CRITICAL | DUMP_FLAG_PRIORITY_NORMAL | DUMP_FLAG_PROTO);</span><br><span class=\"line\">        // &#x6CE8;&#x518C; ProcessStatsService</span><br><span class=\"line\">        ServiceManager.addService(ProcessStats.SERVICE_NAME, mProcessStats);</span><br><span class=\"line\">        // &#x6CE8;&#x518C;MemBinder</span><br><span class=\"line\">        ServiceManager.addService(&quot;meminfo&quot;, new MemBinder(this), /* allowIsolated= */ false,</span><br><span class=\"line\">                DUMP_FLAG_PRIORITY_HIGH);</span><br><span class=\"line\">        // &#x6CE8;&#x518C;GraphicsBinder</span><br><span class=\"line\">        ServiceManager.addService(&quot;gfxinfo&quot;, new GraphicsBinder(this));</span><br><span class=\"line\">        // &#x6CE8;&#x518C;DbBinder</span><br><span class=\"line\">        ServiceManager.addService(&quot;dbinfo&quot;, new DbBinder(this));</span><br><span class=\"line\">        if (MONITOR_CPU_USAGE) {</span><br><span class=\"line\">        \t// &#x6CE8;&#x518C;CpuBinder</span><br><span class=\"line\">            ServiceManager.addService(&quot;cpuinfo&quot;, new CpuBinder(this),</span><br><span class=\"line\">                    /* allowIsolated= */ false, DUMP_FLAG_PRIORITY_CRITICAL);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        // &#x6CE8;&#x518C;PermissionController</span><br><span class=\"line\">        ServiceManager.addService(&quot;permission&quot;, new PermissionController(this));</span><br><span class=\"line\">        // &#x6CE8;&#x518C;ProcessInfoService</span><br><span class=\"line\">        ServiceManager.addService(&quot;processinfo&quot;, new ProcessInfoService(this));</span><br><span class=\"line\"> </span><br><span class=\"line\">        // &#x52A0;&#x8F7D;&#x5305;&#x540D;&#x4E3A;android&#x7684;&#x5305;&#xFF0C;&#x6700;&#x7EC8;&#x901A;&#x8FC7;LoadedApk&#x6765;&#x52A0;&#x8F7D;</span><br><span class=\"line\">        ApplicationInfo info = mContext.getPackageManager().getApplicationInfo(</span><br><span class=\"line\">                &quot;android&quot;, STOCK_PM_FLAGS | MATCH_SYSTEM_ONLY);</span><br><span class=\"line\">        mSystemThread.installSystemApplicationInfo(info, getClass().getClassLoader());</span><br><span class=\"line\"> </span><br><span class=\"line\">        ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x91CC;&#x5C06;AMS&#x6CE8;&#x518C;&#x5230;ServiceManager&#x4E2D;&#xFF0C;&#x540E;&#x7EED;&#x901A;&#x8FC7;ActivityManager&#x6765;&#x83B7;&#x53D6;&#x6CE8;&#x518C;&#x7684;AMS&#x3002;</p>\n<p>&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x8FDB;&#x5165;&#x4E86;startCoreServices&#xFF0C;&#x542F;&#x52A8;&#x6838;&#x5FC3;&#x670D;&#x52A1;</p>\n<h2 id=\"startCoreServices\"><a href=\"#startCoreServices\" class=\"headerlink\" title=\"startCoreServices\"></a>startCoreServices</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void startCoreServices() {</span><br><span class=\"line\">\t...</span><br><span class=\"line\">\tmActivityManagerService.setUsageStatsManager(</span><br><span class=\"line\">                LocalServices.getService(UsageStatsManagerInternal.class));</span><br><span class=\"line\">\t...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x8BBE;&#x7F6E;UsageStateManager</p>\n<h2 id=\"startOtherServices\"><a href=\"#startOtherServices\" class=\"headerlink\" title=\"startOtherServices\"></a>startOtherServices</h2><p>&#x7EE7;&#x7EED;&#x6765;&#x5230;&#x542F;&#x52A8;&#x5176;&#x5B83;&#x7684;&#x670D;&#x52A1;&#x6A21;&#x5757;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void startOtherServices() {</span><br><span class=\"line\">\t...</span><br><span class=\"line\">\tmActivityManagerService.installSystemProviders();</span><br><span class=\"line\"> </span><br><span class=\"line\">\tmActivityManagerService.setWindowManager(wm);</span><br><span class=\"line\"> </span><br><span class=\"line\">\tmActivityManagerService.systemReady(...)</span><br><span class=\"line\">\t...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x505A;&#x7684;&#x662F;&#x5B89;&#x88C5;&#x7CFB;&#x7EDF;&#x7684;Provider&#x3001;&#x8BBE;&#x7F6E;WindowManagerService&#x4E0E;systemReady&#x7684;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#x3002;</p>\n<h3 id=\"installSystemProviders\"><a href=\"#installSystemProviders\" class=\"headerlink\" title=\"installSystemProviders\"></a>installSystemProviders</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public final void installSystemProviders() {</span><br><span class=\"line\">    List&lt;ProviderInfo&gt; providers;</span><br><span class=\"line\">    synchronized (this) {</span><br><span class=\"line\">        ProcessRecord app = mProcessList.mProcessNames.get(&quot;system&quot;, SYSTEM_UID);</span><br><span class=\"line\">        // &#x83B7;&#x53D6;Providers</span><br><span class=\"line\">        providers = generateApplicationProvidersLocked(app);</span><br><span class=\"line\">        if (providers != null) {</span><br><span class=\"line\">            for (int i=providers.size()-1; i&gt;=0; i--) {</span><br><span class=\"line\">                ProviderInfo pi = (ProviderInfo)providers.get(i);</span><br><span class=\"line\">                // &#x6E05;&#x9664;&#x975E;&#x7CFB;&#x7EDF;&#x7684;Providers</span><br><span class=\"line\">                if ((pi.applicationInfo.flags&amp;ApplicationInfo.FLAG_SYSTEM) == 0) {</span><br><span class=\"line\">                    providers.remove(i);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    // &#x901A;&#x8FC7;ActivityThread&#x6765;&#x5B89;&#x88C5;&#x7CFB;&#x7EDF;&#x7684;Providers</span><br><span class=\"line\">    if (providers != null) {</span><br><span class=\"line\">        mSystemThread.installSystemProviders(providers);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    synchronized (this) {</span><br><span class=\"line\">        mSystemProvidersInstalled = true;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    mConstants.start(mContext.getContentResolver());</span><br><span class=\"line\">    mCoreSettingsObserver = new CoreSettingsObserver(this);</span><br><span class=\"line\">    mActivityTaskManager.installSystemProviders();</span><br><span class=\"line\">    mDevelopmentSettingsObserver = new DevelopmentSettingsObserver();</span><br><span class=\"line\">    SettingsToPropertiesMapper.start(mContext.getContentResolver());</span><br><span class=\"line\">    mOomAdjuster.initSettings();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5B89;&#x88C5;&#x7CFB;&#x7EDF;&#x7684;Providers</p>\n<h3 id=\"WindowManagerService\"><a href=\"#WindowManagerService\" class=\"headerlink\" title=\"WindowManagerService\"></a>WindowManagerService</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void setWindowManager(WindowManagerService wm) {</span><br><span class=\"line\">    synchronized (this) {</span><br><span class=\"line\">        mWindowManager = wm;</span><br><span class=\"line\">        mActivityTaskManager.setWindowManager(wm);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8BBE;&#x7F6E;WindowManagerService&#x670D;&#x52A1;</p>\n<h3 id=\"systemReady\"><a href=\"#systemReady\" class=\"headerlink\" title=\"systemReady\"></a>systemReady</h3><p>systemReady&#x7684;&#x903B;&#x8F91;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x6211;&#x4EEC;&#x62C6;&#x5F00;&#x6765;&#x8BF4;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void systemReady(final Runnable goingCallback, TimingsTraceLog traceLog) {</span><br><span class=\"line\">\tgoingCallback before</span><br><span class=\"line\"> </span><br><span class=\"line\">\tif (goingCallback != null) goingCallback.run();</span><br><span class=\"line\"> </span><br><span class=\"line\">\tgoingCallback after</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8C03;&#x7528;goingCallback.run&#x4E4B;&#x524D;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void systemReady(final Runnable goingCallback, TimingsTraceLog traceLog) {</span><br><span class=\"line\">\t synchronized(this) {</span><br><span class=\"line\">        // &#x7B2C;&#x4E00;&#x6B21;&#x8FDB;&#x6765;&#x4E3A;false&#xFF0C;&#x8DF3;&#x8FC7;</span><br><span class=\"line\">        if (mSystemReady) {</span><br><span class=\"line\">            if (goingCallback != null) {</span><br><span class=\"line\">                goingCallback.run();</span><br><span class=\"line\">            }</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        ...</span><br><span class=\"line\"> </span><br><span class=\"line\">        mSystemReady = true;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    ArrayList&lt;ProcessRecord&gt; procsToKill = null;</span><br><span class=\"line\">    synchronized(mPidsSelfLocked) {</span><br><span class=\"line\">        for (int i=mPidsSelfLocked.size()-1; i&gt;=0; i--) {</span><br><span class=\"line\">            ProcessRecord proc = mPidsSelfLocked.valueAt(i);</span><br><span class=\"line\">            // &#x975E;president&#x8FDB;&#x7A0B;</span><br><span class=\"line\">            if (!isAllowedWhileBooting(proc.info)){</span><br><span class=\"line\">                if (procsToKill == null) {</span><br><span class=\"line\">                    procsToKill = new ArrayList&lt;ProcessRecord&gt;();</span><br><span class=\"line\">                }</span><br><span class=\"line\">                // &#x52A0;&#x5165;&#x5230;procsTokill&#x4E2D;</span><br><span class=\"line\">                procsToKill.add(proc);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    synchronized(this) {</span><br><span class=\"line\">        if (procsToKill != null) {</span><br><span class=\"line\">        \t// kill procsToKill&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;</span><br><span class=\"line\">            for (int i=procsToKill.size()-1; i&gt;=0; i--) {</span><br><span class=\"line\">                ProcessRecord proc = procsToKill.get(i);</span><br><span class=\"line\">                mProcessList.removeProcessLocked(proc, true, false, &quot;system update done&quot;);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        mProcessesReady = true;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (goingCallback != null) goingCallback.run();</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E3B;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x6740;&#x6389;procsToKill&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x6B64;&#x65F6;&#x7CFB;&#x7EDF;&#x4E0E;&#x8FDB;&#x7A0B;&#x90FD;&#x5DF2;&#x7ECF;&#x51C6;&#x5907;&#x5C31;&#x7EEA;</p>\n<p>&#x4E4B;&#x540E;&#x518D;&#x8C03;&#x7528;goingCallback.run</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mActivityManagerService.systemReady(() -&gt; {</span><br><span class=\"line\">    </span><br><span class=\"line\">    // BootPhase 550</span><br><span class=\"line\">    mSystemServiceManager.startBootPhase(</span><br><span class=\"line\">            SystemService.PHASE_ACTIVITY_MANAGER_READY);</span><br><span class=\"line\"> </span><br><span class=\"line\">    try {</span><br><span class=\"line\">        mActivityManagerService.startObservingNativeCrashes();</span><br><span class=\"line\">    } catch (Throwable e) {</span><br><span class=\"line\">        reportWtf(&quot;observing native crashes&quot;, e);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    traceBeginAndSlog(&quot;MakeConnectivityServiceReady&quot;);</span><br><span class=\"line\">    try {</span><br><span class=\"line\">        if (connectivityF != null) {</span><br><span class=\"line\">            connectivityF.systemReady();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    } catch (Throwable e) {</span><br><span class=\"line\">        reportWtf(&quot;making Connectivity Service ready&quot;, e);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\">     </span><br><span class=\"line\">    // BootPhase 600</span><br><span class=\"line\">    mSystemServiceManager.startBootPhase(</span><br><span class=\"line\">            SystemService.PHASE_THIRD_PARTY_APPS_CAN_START);</span><br><span class=\"line\"> </span><br><span class=\"line\">    try {</span><br><span class=\"line\">        if (locationF != null) {</span><br><span class=\"line\">            locationF.systemRunning();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    } catch (Throwable e) {</span><br><span class=\"line\">        reportWtf(&quot;Notifying Location Service running&quot;, e);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    try {</span><br><span class=\"line\">        if (countryDetectorF != null) {</span><br><span class=\"line\">            countryDetectorF.systemRunning();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    } catch (Throwable e) {</span><br><span class=\"line\">        reportWtf(&quot;Notifying CountryDetectorService running&quot;, e);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">}, BOOT_TIMINGS_TRACE_LOG);</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;&#x5728;<a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484991&amp;idx=1&amp;sn=7a4701c30ade3569c75591a12644c4f3&amp;chksm=e8e0ffafdf9776b9a00e9b912a47578622379e667e45a16f5d814b638e8ab04786e38403542b&amp;token=694410729&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android SystemServer&#x542F;&#x52A8;(&#x4E8C;)</a>&#x4E2D;&#x5DF2;&#x7ECF;&#x5206;&#x6790;&#x4E86;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x591A;&#x4ECB;&#x7ECD;&#x4E86;&#x3002;</p>\n<p>&#x4E3B;&#x8981;&#x662F;&#x5BF9;&#x4E00;&#x4E9B;&#x670D;&#x52A1;&#x8FDB;&#x884C;systemReady&#x4E0E;systemRuning&#x64CD;&#x4F5C;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x6765;&#x5230;systemReady&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x6B65;&#x9AA4;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void systemReady(final Runnable goingCallback, TimingsTraceLog traceLog) {</span><br><span class=\"line\">\t...</span><br><span class=\"line\"> </span><br><span class=\"line\">\tif (goingCallback != null) goingCallback.run();</span><br><span class=\"line\"> </span><br><span class=\"line\">    final int currentUserId = mUserController.getCurrentUserId();</span><br><span class=\"line\">    if (currentUserId != UserHandle.USER_SYSTEM &amp;&amp; !mUserController.isSystemUserStarted()) {</span><br><span class=\"line\">        throw new RuntimeException(&quot;System user not started while current user is:&quot;</span><br><span class=\"line\">                + currentUserId);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    mBatteryStatsService.noteEvent(BatteryStats.HistoryItem.EVENT_USER_RUNNING_START,</span><br><span class=\"line\">            Integer.toString(currentUserId), currentUserId);</span><br><span class=\"line\">    mBatteryStatsService.noteEvent(BatteryStats.HistoryItem.EVENT_USER_FOREGROUND_START,</span><br><span class=\"line\">            Integer.toString(currentUserId), currentUserId);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x8C03;&#x7528;&#x6240;&#x6709;SystemService&#x7684;onStartUser&#x65B9;&#x6CD5;</span><br><span class=\"line\">    mSystemServiceManager.startUser(currentUserId);</span><br><span class=\"line\"> </span><br><span class=\"line\">    synchronized (this) {</span><br><span class=\"line\">        // &#x5F00;&#x542F;Persistent app</span><br><span class=\"line\">        startPersistentApps(PackageManager.MATCH_DIRECT_BOOT_AWARE);</span><br><span class=\"line\"> </span><br><span class=\"line\">        mBooting = true;</span><br><span class=\"line\">        if (UserManager.isSplitSystemUser() &amp;&amp;</span><br><span class=\"line\">                Settings.Secure.getInt(mContext.getContentResolver(),</span><br><span class=\"line\">                     Settings.Secure.USER_SETUP_COMPLETE, 0) != 0) {</span><br><span class=\"line\">            ComponentName cName = new ComponentName(mContext, SystemUserHomeActivity.class);</span><br><span class=\"line\">            try {</span><br><span class=\"line\">                AppGlobals.getPackageManager().setComponentEnabledSetting(cName,</span><br><span class=\"line\">                        PackageManager.COMPONENT_ENABLED_STATE_ENABLED, 0,</span><br><span class=\"line\">                        UserHandle.USER_SYSTEM);</span><br><span class=\"line\">            } catch (RemoteException e) {</span><br><span class=\"line\">                throw e.rethrowAsRuntimeException();</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        // &#x542F;&#x52A8;&#x7CFB;&#x7EDF;&#x684C;&#x9762;Activity</span><br><span class=\"line\">        mAtmInternal.startHomeOnAllDisplays(currentUserId, &quot;systemReady&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        mAtmInternal.showSystemReadyErrorDialogsIfNeeded();</span><br><span class=\"line\"> </span><br><span class=\"line\">        final int callingUid = Binder.getCallingUid();</span><br><span class=\"line\">        final int callingPid = Binder.getCallingPid();</span><br><span class=\"line\">        long ident = Binder.clearCallingIdentity();</span><br><span class=\"line\">        try {</span><br><span class=\"line\">        \t// &#x53D1;&#x9001;USER_STARTED&#x5E7F;&#x64AD;</span><br><span class=\"line\">            Intent intent = new Intent(Intent.ACTION_USER_STARTED);</span><br><span class=\"line\">            intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY</span><br><span class=\"line\">                    | Intent.FLAG_RECEIVER_FOREGROUND);</span><br><span class=\"line\">            intent.putExtra(Intent.EXTRA_USER_HANDLE, currentUserId);</span><br><span class=\"line\">            broadcastIntentLocked(null, null, intent,</span><br><span class=\"line\">                    null, null, 0, null, null, null, OP_NONE,</span><br><span class=\"line\">                    null, false, false, MY_PID, SYSTEM_UID, callingUid, callingPid,</span><br><span class=\"line\">                    currentUserId);</span><br><span class=\"line\"> </span><br><span class=\"line\">            // &#x53D1;&#x9001;USER_STARTING&#x5E7F;&#x64AD;</span><br><span class=\"line\">            intent = new Intent(Intent.ACTION_USER_STARTING);</span><br><span class=\"line\">            intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);</span><br><span class=\"line\">            intent.putExtra(Intent.EXTRA_USER_HANDLE, currentUserId);</span><br><span class=\"line\">            broadcastIntentLocked(null, null, intent,</span><br><span class=\"line\">                    null, new IIntentReceiver.Stub() {</span><br><span class=\"line\">                        @Override</span><br><span class=\"line\">                        public void performReceive(Intent intent, int resultCode, String data,</span><br><span class=\"line\">                                Bundle extras, boolean ordered, boolean sticky, int sendingUser)</span><br><span class=\"line\">                                throws RemoteException {</span><br><span class=\"line\">                        }</span><br><span class=\"line\">                    }, 0, null, null,</span><br><span class=\"line\">                    new String[] {INTERACT_ACROSS_USERS}, OP_NONE,</span><br><span class=\"line\">                    null, true, false, MY_PID, SYSTEM_UID, callingUid, callingPid,</span><br><span class=\"line\">                    UserHandle.USER_ALL);</span><br><span class=\"line\">        } catch (Throwable t) {</span><br><span class=\"line\">            Slog.wtf(TAG, &quot;Failed sending first user broadcasts&quot;, t);</span><br><span class=\"line\">        } finally {</span><br><span class=\"line\">            Binder.restoreCallingIdentity(ident);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        mAtmInternal.resumeTopActivities(false /* scheduleIdle */);</span><br><span class=\"line\">        mUserController.sendUserSwitchBroadcasts(-1, currentUserId);</span><br><span class=\"line\"> </span><br><span class=\"line\">        BinderInternal.nSetBinderProxyCountWatermarks(BINDER_PROXY_HIGH_WATERMARK,</span><br><span class=\"line\">                BINDER_PROXY_LOW_WATERMARK);</span><br><span class=\"line\">        BinderInternal.nSetBinderProxyCountEnabled(true);</span><br><span class=\"line\">        BinderInternal.setBinderProxyCountCallback(</span><br><span class=\"line\">                new BinderInternal.BinderProxyLimitListener() {</span><br><span class=\"line\">                    @Override</span><br><span class=\"line\">                    public void onLimitReached(int uid) {</span><br><span class=\"line\">                        Slog.wtf(TAG, &quot;Uid &quot; + uid + &quot; sent too many Binders to uid &quot;</span><br><span class=\"line\">                                + Process.myUid());</span><br><span class=\"line\">                        BinderProxy.dumpProxyDebugInfo();</span><br><span class=\"line\">                        if (uid == Process.SYSTEM_UID) {</span><br><span class=\"line\">                            Slog.i(TAG, &quot;Skipping kill (uid is SYSTEM)&quot;);</span><br><span class=\"line\">                        } else {</span><br><span class=\"line\">                            killUid(UserHandle.getAppId(uid), UserHandle.getUserId(uid),</span><br><span class=\"line\">                                    &quot;Too many Binders sent to SYSTEM&quot;);</span><br><span class=\"line\">                        }</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }, mHandler);</span><br><span class=\"line\"> </span><br><span class=\"line\">        // &#x6062;&#x590D;&#x6808;&#x9876;Activity</span><br><span class=\"line\">        mAtmInternal.resumeTopActivities(false /* scheduleIdle */);</span><br><span class=\"line\">        // &#x53D1;&#x9001;User_SWITCH &#x5E7F;&#x64AD;</span><br><span class=\"line\">        mUserController.sendUserSwitchBroadcasts(-1, currentUserId);</span><br><span class=\"line\"> </span><br><span class=\"line\">        ...</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;startUser&#x4F1A;&#x56DE;&#x8C03;&#x4E4B;&#x524D;&#x7684;SystemService&#x7684;onStartUser&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void startUser(final int userHandle) {</span><br><span class=\"line\">    final int serviceLen = mServices.size();</span><br><span class=\"line\">    // &#x904D;&#x5386;mServices</span><br><span class=\"line\">    for (int i = 0; i &lt; serviceLen; i++) {</span><br><span class=\"line\">        final SystemService service = mServices.get(i);</span><br><span class=\"line\">        Trace.traceBegin(Trace.TRACE_TAG_SYSTEM_SERVER, &quot;onStartUser &quot;</span><br><span class=\"line\">                + service.getClass().getName());</span><br><span class=\"line\">        long time = SystemClock.elapsedRealtime();</span><br><span class=\"line\">        try {</span><br><span class=\"line\">        \t// &#x56DE;&#x8C03;onStartUser</span><br><span class=\"line\">            service.onStartUser(userHandle);</span><br><span class=\"line\">        } catch (Exception ex) {</span><br><span class=\"line\">            Slog.wtf(TAG, &quot;Failure reporting start of user &quot; + userHandle</span><br><span class=\"line\">                    + &quot; to service &quot; + service.getClass().getName(), ex);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>startHomeOnAllDisplays&#x6700;&#x7EC8;&#x4F1A;&#x6765;&#x5230;RootActivityContainer&#x7684;startHomeOnDisplay&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">boolean startHomeOnDisplay(int userId, String reason, int displayId, boolean allowInstrumenting,</span><br><span class=\"line\">        boolean fromHomeKey) {</span><br><span class=\"line\">    if (displayId == INVALID_DISPLAY) {</span><br><span class=\"line\">        displayId = getTopDisplayFocusedStack().mDisplayId;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    Intent homeIntent = null;</span><br><span class=\"line\">    ActivityInfo aInfo = null;</span><br><span class=\"line\">    if (displayId == DEFAULT_DISPLAY) {</span><br><span class=\"line\">        homeIntent = mService.getHomeIntent();</span><br><span class=\"line\">        aInfo = resolveHomeActivity(userId, homeIntent);</span><br><span class=\"line\">    } else if (shouldPlaceSecondaryHomeOnDisplay(displayId)) {</span><br><span class=\"line\">        Pair&lt;ActivityInfo, Intent&gt; info = resolveSecondaryHomeActivity(userId, displayId);</span><br><span class=\"line\">        aInfo = info.first;</span><br><span class=\"line\">        homeIntent = info.second;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    if (aInfo == null || homeIntent == null) {</span><br><span class=\"line\">        return false;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (!canStartHomeOnDisplay(aInfo, displayId, allowInstrumenting)) {</span><br><span class=\"line\">        return false;</span><br><span class=\"line\">    } </span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x8BBE;&#x7F6E;home Intent &#x7684;Component&#x4FE1;&#x606F;</span><br><span class=\"line\">    homeIntent.setComponent(new ComponentName(aInfo.applicationInfo.packageName, aInfo.name));</span><br><span class=\"line\">    homeIntent.setFlags(homeIntent.getFlags() | FLAG_ACTIVITY_NEW_TASK);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x8BBE;&#x7F6E;extra</span><br><span class=\"line\">    if (fromHomeKey) {</span><br><span class=\"line\">        homeIntent.putExtra(WindowManagerPolicy.EXTRA_FROM_HOME_KEY, true);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    final String myReason = reason + &quot;:&quot; + userId + &quot;:&quot; + UserHandle.getUserId(</span><br><span class=\"line\">            aInfo.applicationInfo.uid) + &quot;:&quot; + displayId;</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;&#x684C;&#x9762;Activity</span><br><span class=\"line\">    mService.getActivityStartController().startHomeActivity(homeIntent, aInfo, myReason,</span><br><span class=\"line\">            displayId);</span><br><span class=\"line\">    return true;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#xFF0C;&#x5728;goingCallback.run&#x4E4B;&#x540E;&#xFF0C;&#x8BE5;&#x9636;&#x6BB5;&#x4E3B;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x662F;&#xFF1A;</p>\n<ol>\n<li>&#x8C03;&#x7528;&#x6240;&#x6709;&#x4E4B;&#x524D;&#x6DFB;&#x52A0;&#x7684;SystemService&#x7684;onStartUser&#x65B9;&#x6CD5;</li>\n<li>&#x542F;&#x52A8;Persistent&#x8FDB;&#x7A0B;</li>\n<li>&#x542F;&#x52A8;&#x7CFB;&#x7EDF;&#x684C;&#x9762;Activity</li>\n<li>&#x53D1;&#x9001;USER_STARTED&#x5E7F;&#x64AD;</li>\n<li>&#x53D1;&#x9001;USER_STARTING&#x5E7F;&#x64AD;</li>\n<li>&#x6062;&#x590D;&#x6808;&#x9876;Activity</li>\n<li>&#x53D1;&#x9001;User_SWITCH&#x5E7F;&#x64AD;</li>\n</ol>\n<p>&#x4EE5;&#x4E0A;&#x5C31;&#x662F;AMS&#x5728;SystemServer&#x4E2D;&#x7684;&#x5168;&#x90E8;&#x8FC7;&#x7A0B;, &#x4E5F;&#x662F;AMS&#x7684;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x3002;</p>\n<p>&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E3B;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x662F;&#xFF1A;</p>\n<ol>\n<li>&#x901A;&#x8FC7;Lifecycle&#x521B;&#x5EFA;AMS&#x5B9E;&#x4F8B;&#xFF0C;&#x540C;&#x65F6;&#x8C03;&#x7528;onStart()&#x65B9;&#x6CD5;&#x542F;&#x52A8;AMS</li>\n<li>&#x901A;&#x8FC7;setSystemProcess&#x6CE8;&#x518C;AMS&#x3001;meminfo&#x3001;gfxinfo&#x3001;dbinfo&#x3001;cpuinfo&#x7B49;&#x670D;&#x52A1;&#x5230;ServiceManager&#x4E2D;</li>\n<li>&#x901A;&#x8FC7;installSystemProviders&#x6765;&#x52A0;&#x8F7D;&#x7CFB;&#x7EDF;&#x7684;providers</li>\n<li>&#x901A;&#x8FC7;systemReady&#x6765;ready&#x4E0E;running&#x5404;&#x79CD;&#x670D;&#x52A1;&#xFF0C;&#x540C;&#x65F6;&#x542F;&#x52A8;&#x684C;&#x9762;&#x5E94;&#x7528;&#xFF0C;&#x53D1;&#x9001;&#x76F8;&#x5173;&#x5E7F;&#x64AD;&#x4E0E;&#x6062;&#x590D;&#x6808;&#x9876;Activity</li>\n</ol>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["启动"]},{"title":"一文彻底搞懂Kotlin inline","url":"https://www.rousetime.com/2021/01/07/一文彻底搞懂Kotlin-inline/","content":"<p>Kotlin&#x8BED;&#x8A00;&#x76F8;&#x4FE1;&#x5927;&#x5BB6;&#x5DF2;&#x7ECF;&#x73A9;&#x7684;&#x5F88;&#x6E9C;&#x4E86;&#xFF0C;&#x4F46;&#x5927;&#x5BB6;&#x6709;&#x6CA1;&#x6709;&#x6CE8;&#x610F;&#x5230;&#x5B83;&#x5185;&#x90E8;&#x6E90;&#x7801;&#x5927;&#x91CF;&#x4F7F;&#x7528;&#x4E86;inline&#xFF0C;&#x90A3;&#x4E48;Kotlin&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x4F7F;&#x7528;inline&#xFF1F;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x53C8;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x53EA;&#x662F;&#x6CE8;&#x610F;&#x5230;&#x4E86;&#xFF0C;&#x4F46;&#x4ECE;&#x6765;&#x6CA1;&#x6709;&#x8FDB;&#x884C;&#x6DF1;&#x5165;&#x63A2;&#x7A76;&#xFF0C;&#x76F8;&#x4FE1;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x80FD;&#x591F;&#x5E2E;&#x4F60;&#x627E;&#x5230;&#x7B54;&#x6848;&#x3002;</p>\n<h2 id=\"inline\"><a href=\"#inline\" class=\"headerlink\" title=\"inline\"></a>inline</h2><p>inline&#x662F;&#x4F5C;&#x7528;&#x5728;&#x51FD;&#x6570;&#x65B9;&#x6CD5;&#x4E0A;&#x9762;&#x7684;&#xFF0C;&#x4F8B;&#x5982;Kotlin&#x7684;let&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public inline fun &lt;T, R&gt; T.let(block: (T) -&gt; R): R {</span><br><span class=\"line\">    contract {</span><br><span class=\"line\">        callsInPlace(block, InvocationKind.EXACTLY_ONCE)</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return block(this)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x90A3;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p>\n<p>inline&#x4E3B;&#x8981;&#x662F;&#x5BF9;&#x95ED;&#x5305;block&#x505A;&#x4F18;&#x5316;&#xFF0C;&#x4E3A;&#x4E86;&#x5BF9;&#x6BD4;&#x5B83;&#x505A;&#x7684;&#x4F18;&#x5316;&#xFF0C;&#x6211;&#x5BF9;&#x5E94;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x6CA1;&#x6709;inline&#x7684;&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public fun &lt;T, R&gt; T.ret(block: (T) -&gt; R): R {</span><br><span class=\"line\">    return block(this)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x6211;&#x540C;&#x65F6;&#x8C03;&#x7528;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class MainActivity : AppCompatActivity() {</span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) {</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"> </span><br><span class=\"line\">        let {</span><br><span class=\"line\">            it.a()</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        ret {</span><br><span class=\"line\">            it.b()</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    fun a() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    fun b() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    fun &lt;T, R&gt; T.ret(block: (T) -&gt; R): R {</span><br><span class=\"line\">        return block(this)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x518D;&#x901A;&#x8FC7;AS&#x7684;Show Kotlin Bytecode&#xFF0C;&#x6765;&#x770B;&#x5B83;&#x4EEC;&#x53CD;&#x7F16;&#x8BD1;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public final class MainActivity extends AppCompatActivity {</span><br><span class=\"line\">   private HashMap _$_findViewCache;</span><br><span class=\"line\"> </span><br><span class=\"line\">   protected void onCreate(@Nullable Bundle savedInstanceState) {</span><br><span class=\"line\">      super.onCreate(savedInstanceState);</span><br><span class=\"line\">      this.setContentView(1300009);</span><br><span class=\"line\">      boolean var3 = false;</span><br><span class=\"line\">      boolean var4 = false;</span><br><span class=\"line\">      // inline&#x4FEE;&#x9970;&#x7684;let</span><br><span class=\"line\">      MainActivity it = (MainActivity)this;</span><br><span class=\"line\">      int var6 = false;</span><br><span class=\"line\">      it.a();</span><br><span class=\"line\">      // &#x6CA1;&#x6709;inline&#x4FEE;&#x9970;&#x7684;ret</span><br><span class=\"line\">      this.ret(this, (Function1)null.INSTANCE);</span><br><span class=\"line\">   }</span><br><span class=\"line\"> </span><br><span class=\"line\">   public final void a() {</span><br><span class=\"line\">   }</span><br><span class=\"line\"> </span><br><span class=\"line\">   public final void b() {</span><br><span class=\"line\">   }</span><br><span class=\"line\"> </span><br><span class=\"line\">   public final Object ret(Object $this$ret, @NotNull Function1 block) {</span><br><span class=\"line\">      Intrinsics.checkParameterIsNotNull(block, &quot;block&quot;);</span><br><span class=\"line\">      return block.invoke($this$ret);</span><br><span class=\"line\">   }</span><br><span class=\"line\"> </span><br><span class=\"line\">   ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0D;&#x61C2;&#x7684;&#x8FD8;&#x662F;&#x8981;&#x770B;&#x6E90;&#x7801;&#xFF0C;&#x7A0B;&#x5E8F;&#x5458;&#x7684;&#x7EC8;&#x7ED3;&#x6B66;&#x5668;</p>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x901A;&#x8FC7;inline&#x4FEE;&#x9970;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F1A;&#x901A;&#x8FC7;&#x5E73;&#x5766;&#x5F0F;&#x7684;&#x65B9;&#x5F0F;&#x76F4;&#x63A5;&#x5728;&#x540E;&#x9762;&#x6309;&#x6267;&#x884C;&#x987A;&#x4F9D;&#x6B21;&#x8C03;&#x7528;&#x3002;</p>\n<p>&#x800C;&#x6CA1;&#x6709;&#x4F7F;&#x7528;inline&#x4FEE;&#x9970;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5219;&#x4F1A;&#x4E3A;block&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Function1&#x5B9E;&#x4F8B;&#x3002;</p>\n<p>&#x7B80;&#x5355;&#x7684;&#x7406;&#x89E3;&#x5C31;&#x662F;&#x672A;&#x4F7F;&#x7528;inline&#x4FEE;&#x9970;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4F1A;&#x5BF9;&#x5E26;&#x6709;&#x51FD;&#x6570;&#x5F0F;&#x53C2;&#x6570;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x521B;&#x5EFA;&#x5BF9;&#x4E8E;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x518D;&#x5C06;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x4F20;&#x9012;&#x5230;&#x65B9;&#x6CD5;&#x53C2;&#x6570;&#x4E2D;&#x3002;&#x8BE5;&#x53C2;&#x6570;&#x65B9;&#x6CD5;&#x6700;&#x7EC8;&#x5728;&#x539F;&#x65B9;&#x6CD5;&#x7684;&#x5185;&#x90E8;&#x88AB;&#x663E;&#x793A;&#x8C03;&#x7528;&#x3002;</p>\n<p>&#x6240;&#x4EE5;inline&#x505A;&#x7684;&#x4F18;&#x5316;&#x5C31;&#x662F;&#x5C06;&#x5E26;&#x6709;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x7684;&#x65B9;&#x6CD5;&#x7B80;&#x5316;&#x6210;&#x6CA1;&#x51FD;&#x6570;&#x5F0F;&#x53C2;&#x6570;&#x7684;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x3002;&#x597D;&#x5904;&#x662F;&#x63D0;&#x9AD8;&#x7A0B;&#x5E8F;&#x7684;&#x6027;&#x80FD;&#x3002;</p>\n<p>&#x5F53;&#x7136;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x907F;&#x514D;&#x4F7F;&#x7528;inline&#x5185;&#x8054;&#x5927;&#x578B;&#x51FD;&#x6570;&#xFF0C;&#x51CF;&#x5C11;&#x65B9;&#x6CD5;&#x4E2D;&#x4EE3;&#x7801;&#x7684;&#x589E;&#x957F;&#x3002;</p>\n<h3 id=\"&#x975E;&#x5C40;&#x90E8;&#x8FD4;&#x56DE;\"><a href=\"#&#x975E;&#x5C40;&#x90E8;&#x8FD4;&#x56DE;\" class=\"headerlink\" title=\"&#x975E;&#x5C40;&#x90E8;&#x8FD4;&#x56DE;\"></a>&#x975E;&#x5C40;&#x90E8;&#x8FD4;&#x56DE;</h3><p>inline&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x597D;&#x5904;&#x662F;&#xFF0C;&#x5BF9;&#x4E8E;while&#x3001;for&#x7B49;&#x8BED;&#x53E5;&#xFF0C;&#x88AB;inline&#x4FEE;&#x9970;&#x7684;&#x51FD;&#x6570;&#x652F;&#x6301;&#x5C40;&#x90E8;&#x8FD4;&#x56DE;</p>\n<p>&#x8FD8;&#x662F;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">while (--i &gt; 0) {</span><br><span class=\"line\">    let {</span><br><span class=\"line\">        return // success</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">while (--i &gt; 0) {</span><br><span class=\"line\">    ret {</span><br><span class=\"line\">        return // error: return is not allow here</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x7B80;&#x5355;&#x7684;&#x7406;&#x89E3;&#x5C31;&#x662F;&#xFF0C;&#x4F7F;&#x7528;inline&#x4FEE;&#x9970;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x5FAA;&#x73AF;&#x8BED;&#x53E5;&#x4E2D;&#x901A;&#x8FC7;return&#x8DF3;&#x51FA;&#x5FAA;&#x73AF;&#x4F53;&#x3002;&#x800C;&#x975E;inline&#x51FD;&#x6570;&#x662F;&#x4E0D;&#x652F;&#x6301;&#x7684;&#xFF0C;&#x5B83;&#x652F;&#x6301;&#x8DF3;&#x51FA;&#x65B9;&#x6CD5;&#x4F53;&#x3002;</p>\n<p>&#x539F;&#x56E0;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x56DE;&#x5934;&#x518D;&#x770B;&#x4E4B;&#x524D;&#x7684;&#x53CD;&#x7F16;&#x8BD1;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x4EE3;&#x7801;&#xFF0C;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;inline&#x4FEE;&#x9970;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x5E73;&#x94FA;&#x5F0F;&#x76F4;&#x63A5;&#x6309;&#x987A;&#x5E8F;&#x8C03;&#x7528;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x5305;&#x542B;&#x5728;&#x65B9;&#x6CD5;&#x4F53;&#x4E2D;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;return&#x7684;&#x8BDD;&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x76F4;&#x63A5;&#x5728;&#x5FAA;&#x73AF;&#x4F53;&#x4E2D;return</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">while(--i &gt; 0) {</span><br><span class=\"line\">\treturn</span><br><span class=\"line\">\t...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x800C;&#x672A;&#x4F7F;&#x7528;inline&#x4FEE;&#x9970;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x662F;&#x5728;&#x53E6;&#x5916;&#x7684;&#x65B9;&#x6CD5;&#x4F53;&#x4E2D;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x7684;return&#x53EA;&#x80FD;&#x662F;&#x8FD4;&#x56DE;&#x5230;&#x65B9;&#x6CD5;&#x4F53;&#x3002;</p>\n<h3 id=\"reified\"><a href=\"#reified\" class=\"headerlink\" title=\"reified\"></a>reified</h3><p>&#x4F7F;&#x7528;inline&#x4FEE;&#x9970;&#x7684;&#x51FD;&#x6570;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x597D;&#x5904;&#x662F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;reified&#x6765;&#x4FEE;&#x9970;&#x51FD;&#x6570;&#x7684;&#x6CDB;&#x578B;&#xFF0C;&#x8BA9;&#x51FD;&#x6570;&#x7684;&#x6CDB;&#x578B;&#x5177;&#x4F53;&#x5316;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">inline fun &lt;reified T, R&gt; T.det(block: (T) -&gt; R): R {</span><br><span class=\"line\">    val a = 0</span><br><span class=\"line\">    if (a is T) { // success</span><br><span class=\"line\"> </span><br><span class=\"line\">    }</span><br><span class=\"line\">    return block(this)</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">fun &lt;T, R&gt; T.ret(block: (T) -&gt; R): R {</span><br><span class=\"line\">    val a = 0</span><br><span class=\"line\">    if (a is T) { // error: Cannot check for instance of erased type: T</span><br><span class=\"line\"> </span><br><span class=\"line\">    }</span><br><span class=\"line\">    return block(this)</span><br><span class=\"line\">}</span><br><span class=\"line\">  </span><br><span class=\"line\">// &#x6216;&#x8005;</span><br><span class=\"line\">inline fun &lt;reified T&gt; membersOf() = T::class.members</span><br></pre></td></tr></table></figure>\n<p>&#x4F20;&#x7EDF;&#x7684;&#x6CDB;&#x578B;&#x662F;&#x4F1A;&#x5728;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x8FDB;&#x884C;&#x64E6;&#x9664;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x4F7F;&#x7528;reified&#x4FEE;&#x9970;&#x7684;&#x6CDB;&#x578B;&#xFF0C;&#x901A;&#x8FC7;&#x53CD;&#x7F16;&#x8BD1;&#x4E8C;&#x8FDB;&#x5236;&#x8868;&#x73B0;&#x5C31;&#x662F;&#x5C06;&#x6CDB;&#x578B;&#x66FF;&#x6362;&#x6210;&#x5177;&#x4F53;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x4E0D;&#x8FDB;&#x884C;&#x7C7B;&#x578B;&#x64E6;&#x9664;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$i$f$det = false;</span><br><span class=\"line\">int a$iv = 0;</span><br><span class=\"line\">if (Integer.valueOf(a$iv) instanceof MainActivity) {</span><br><span class=\"line\">   this.a();</span><br><span class=\"line\">}</span><br><span class=\"line\">  </span><br><span class=\"line\">MainActivity it = (MainActivity)this;</span><br><span class=\"line\">int var7 = false;</span><br><span class=\"line\">it.b();</span><br></pre></td></tr></table></figure>\n<h2 id=\"noinline\"><a href=\"#noinline\" class=\"headerlink\" title=\"noinline\"></a>noinline</h2><p>&#x6709;&#x4E86;inline&#x81EA;&#x7136;&#x4E5F;&#x6709;&#x5BF9;&#x7ACB;&#x7684;noinline&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x591A;&#x4E2A;&#x51FD;&#x6570;&#x65B9;&#x6CD5;&#x53C2;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;noinline&#x6765;&#x6307;&#x5B9A;&#x67D0;&#x4E2A;&#x51FD;&#x6570;&#x65B9;&#x6CD5;&#x53C2;&#x6570;&#x4E0D;&#x4F7F;&#x7528;inline&#x7684;&#x7279;&#x6027;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">inline fun &lt;T, R&gt; T.net(block: (T) -&gt; R, noinline noBlock: () -&gt; Unit): R {</span><br><span class=\"line\">    noBlock()</span><br><span class=\"line\">    return block(this)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x5C31;&#x53EA;&#x6709;block&#x4F1A;&#x6267;&#x884C;inline&#x7684;&#x4F18;&#x5316;&#x3002;</p>\n<h2 id=\"crossinline\"><a href=\"#crossinline\" class=\"headerlink\" title=\"crossinline\"></a>crossinline</h2><p>&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4E86;inline&#x4FEE;&#x9970;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x88AB;&#x4F7F;&#x7528;&#x5230;&#x4E86;&#x5D4C;&#x5957;&#x7684;&#x5185;&#x8054;&#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x662F;&#x4F1A;&#x62A5;&#x9519;&#x7684;&#xFF0C;&#x9700;&#x8981;&#x4E3A;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x6DFB;&#x52A0;crossinline&#x4FEE;&#x9970;&#x7B26;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">inline fun &lt;T, R&gt; T.cet(block: (T) -&gt; R, crossinline noBlock: () -&gt; Unit): R {</span><br><span class=\"line\">    Runnable {</span><br><span class=\"line\">        noBlock()</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return block(this)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4ECA;&#x5929;&#x6709;&#x5173;kotlin&#x7684;inline&#x90E8;&#x5206;&#x5C31;&#x5206;&#x6790;&#x5230;&#x8FD9;&#xFF0C;&#x5E0C;&#x671B;&#x4F60;&#x6709;&#x6240;&#x6536;&#x83B7;&#x3002;</p>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["kotlin"]},{"title":"Android SystemServer启动(二)","url":"https://www.rousetime.com/2021/01/04/Android-SystemServer启动-二/","content":"<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484889&amp;idx=1&amp;sn=b39c8bc0a9925464022b77a341263cf0&amp;chksm=e8e0fc49df97755f598ef0082409c573d7715ce33bb27b1c98194410d487ae69adbeb2293d84&amp;token=1353481402&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android init &#x542F;&#x52A8;</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484889&amp;idx=1&amp;sn=b39c8bc0a9925464022b77a341263cf0&amp;chksm=e8e0fc49df97755f598ef0082409c573d7715ce33bb27b1c98194410d487ae69adbeb2293d84&amp;token=1204064574&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android Linux Zygote&#x542F;&#x52A8;</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484921&amp;idx=1&amp;sn=bf7251253d23c17c9148423f6f1e386e&amp;chksm=e8e0fc69df97757f2aec459954c07d0fc44be4bd6c6963dab2b5c5b01d8e8176c9069ddab12c&amp;token=757375240&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android Java Zygote&#x542F;&#x52A8;</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484938&amp;idx=1&amp;sn=027a7eb6902d8668d15008db0e2ac29a&amp;chksm=e8e0ff9adf97768cb5f77f6b1ffbb2e306a1ac6dea66a4aeeed0a7aed3c3ccb531db634df991&amp;token=757375240&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android SystemServer&#x542F;&#x52A8;(&#x4E00;)</a></p>\n<p>&#x7EE7;&#x7EED;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x7684;SystemServer&#x542F;&#x52A8;&#x5206;&#x6790;&#x3002;</p>\n<blockquote>\n<p>&#x6B64;&#x6B21;&#x5206;&#x6790;&#x8FC7;&#x7A0B;&#x57FA;&#x4E8E;Android 10.0</p>\n</blockquote>\n<h2 id=\"run\"><a href=\"#run\" class=\"headerlink\" title=\"run\"></a>run</h2><p>&#x5728;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x5206;&#x6790;&#x5230;&#xFF0C;&#x901A;&#x8FC7;SystemServer&#x7684;run&#x65B9;&#x6CD5;&#x8FDB;&#x5165;&#x5230;SystemServer&#x5185;&#x90E8;&#x903B;&#x8F91;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x6765;&#x770B;run&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void run() {</span><br><span class=\"line\">    try {</span><br><span class=\"line\">        traceBeginAndSlog(&quot;InitBeforeStartServices&quot;);</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        </span><br><span class=\"line\">        // &#x521B;&#x5EFA;Looper</span><br><span class=\"line\">        Looper.prepareMainLooper();</span><br><span class=\"line\">        Looper.getMainLooper().setSlowLogThresholdMs(</span><br><span class=\"line\">                SLOW_DISPATCH_THRESHOLD_MS, SLOW_DELIVERY_THRESHOLD_MS);</span><br><span class=\"line\"> </span><br><span class=\"line\">        // &#x521D;&#x59CB;&#x5316;native service</span><br><span class=\"line\">        System.loadLibrary(&quot;android_servers&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        performPendingShutdown();</span><br><span class=\"line\"> </span><br><span class=\"line\">        // &#x521B;&#x5EFA;system context</span><br><span class=\"line\">        createSystemContext();</span><br><span class=\"line\"> </span><br><span class=\"line\">        // &#x521B;&#x5EFA;SystemServiceManager</span><br><span class=\"line\">        mSystemServiceManager = new SystemServiceManager(mSystemContext);</span><br><span class=\"line\">        mSystemServiceManager.setStartInfo(mRuntimeRestart,</span><br><span class=\"line\">                mRuntimeStartElapsedTime, mRuntimeStartUptime);</span><br><span class=\"line\">        </span><br><span class=\"line\">        // &#x6DFB;&#x52A0;&#x5230;&#x672C;&#x5730;LocalServices&#x4E2D;&#xFF0C;&#x4EE5;&#x4FBF;&#x540E;&#x7EED;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;&#x670D;&#x52A1;&#x5BF9;&#x8C61;</span><br><span class=\"line\">        LocalServices.addService(SystemServiceManager.class, mSystemServiceManager);</span><br><span class=\"line\">        SystemServerInitThreadPool.get();</span><br><span class=\"line\">    } finally {</span><br><span class=\"line\">        traceEnd();  // InitBeforeStartServices</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;&#x5404;&#x9879;services</span><br><span class=\"line\">    try {</span><br><span class=\"line\">        traceBeginAndSlog(&quot;StartServices&quot;);</span><br><span class=\"line\">        startBootstrapServices();</span><br><span class=\"line\">        startCoreServices();</span><br><span class=\"line\">        startOtherServices();</span><br><span class=\"line\">        SystemServerInitThreadPool.shutdown();</span><br><span class=\"line\">    } catch (Throwable ex) {</span><br><span class=\"line\">        Slog.e(&quot;System&quot;, &quot;******************************************&quot;);</span><br><span class=\"line\">        Slog.e(&quot;System&quot;, &quot;************ Failure starting system services&quot;, ex);</span><br><span class=\"line\">        throw ex;</span><br><span class=\"line\">    } finally {</span><br><span class=\"line\">        traceEnd();</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    StrictMode.initVmDefaults(null);</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (!mRuntimeRestart &amp;&amp; !isFirstBootOrUpgrade()) {</span><br><span class=\"line\">        int uptimeMillis = (int) SystemClock.elapsedRealtime();</span><br><span class=\"line\">        MetricsLogger.histogram(null, &quot;boot_system_server_ready&quot;, uptimeMillis);</span><br><span class=\"line\">        final int MAX_UPTIME_MILLIS = 60 * 1000;</span><br><span class=\"line\">        if (uptimeMillis &gt; MAX_UPTIME_MILLIS) {</span><br><span class=\"line\">            Slog.wtf(SYSTEM_SERVER_TIMING_TAG,</span><br><span class=\"line\">                    &quot;SystemServer init took too long. uptimeMillis=&quot; + uptimeMillis);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x5F00;&#x542F;loop&#x5FAA;&#x73AF;&#xFF0C;&#x7B49;&#x5F85;&#x6D88;&#x606F;&#x7684;&#x6765;&#x4E34;</span><br><span class=\"line\">    Looper.loop();</span><br><span class=\"line\">    throw new RuntimeException(&quot;Main thread loop unexpectedly exited&quot;);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;SystemServer&#x7684;run&#x65B9;&#x6CD5;&#x4E2D;&#x4E3B;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x662F;&#xFF1A;</p>\n<ol>\n<li>&#x521B;&#x5EFA;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684;Looper</li>\n<li>&#x52A0;&#x8F7D;native services&#x539F;&#x751F;&#x5E93;android_servers</li>\n<li>&#x521B;&#x5EFA;SystemContext&#xFF0C;&#x901A;&#x8FC7;ActivityThread&#x6765;&#x83B7;&#x53D6;SystemContext</li>\n<li>&#x521B;&#x5EFA;SystemServiceManager&#xFF0C;&#x7528;&#x6765;&#x542F;&#x52A8;&#x540E;&#x7EED;&#x7684;&#x5404;&#x9879;&#x670D;&#x52A1;</li>\n<li>&#x5F00;&#x542F;&#x5404;&#x9879;&#x670D;&#x52A1;</li>\n<li>&#x5F00;&#x542F;Looper&#x5FAA;&#x73AF;&#xFF0C;&#x7B49;&#x5F85;&#x6D88;&#x606F;&#x7684;&#x6765;&#x4E34;&#x5E76;&#x6267;&#x884C;</li>\n</ol>\n<h3 id=\"SystemContext\"><a href=\"#SystemContext\" class=\"headerlink\" title=\"SystemContext\"></a>SystemContext</h3><p>&#x5176;&#x4E2D;SystemContext&#x7684;&#x521B;&#x5EFA;&#x662F;&#x901A;&#x8FC7;ActivityThread&#x6765;&#x83B7;&#x53D6;&#x7684;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void createSystemContext() {</span><br><span class=\"line\">    ActivityThread activityThread = ActivityThread.systemMain();</span><br><span class=\"line\">    mSystemContext = activityThread.getSystemContext();</span><br><span class=\"line\">    mSystemContext.setTheme(DEFAULT_SYSTEM_THEME);</span><br><span class=\"line\"> </span><br><span class=\"line\">    final Context systemUiContext = activityThread.getSystemUiContext();</span><br><span class=\"line\">    systemUiContext.setTheme(DEFAULT_SYSTEM_THEME);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x7EC8;&#x83B7;&#x53D6;&#x5230;&#x7684;SystemContext&#x662F;&#x7531;ContextImpl&#x521B;&#x5EFA;&#x7684;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public ContextImpl getSystemContext() {</span><br><span class=\"line\">    synchronized (this) {</span><br><span class=\"line\">        if (mSystemContext == null) {</span><br><span class=\"line\">            mSystemContext = ContextImpl.createSystemContext(this);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        return mSystemContext;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"SystemServiceManager\"><a href=\"#SystemServiceManager\" class=\"headerlink\" title=\"SystemServiceManager\"></a>SystemServiceManager</h3><p>&#x5B83;&#x662F;SystemServer&#x7684;&#x670D;&#x52A1;&#x5927;&#x7BA1;&#x5BB6;&#xFF0C;&#x63D0;&#x4F9B;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x7684;&#x76F8;&#x5173;&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x4E3B;&#x8981;&#x6D89;&#x53CA;&#x7684;&#x65B9;&#x6CD5;&#x6709;</p>\n<ol>\n<li>startService: &#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x521B;&#x5EFA;&#x76F8;&#x5173;&#x670D;&#x52A1;&#xFF0C;&#x5E76;&#x4E14;&#x8C03;&#x7528;&#x5BF9;&#x5E94;&#x670D;&#x52A1;&#x7684;onStart()&#x65B9;&#x6CD5;&#x6765;&#x5F00;&#x542F;&#x670D;&#x52A1;</li>\n<li>startBootPhase: &#x5F00;&#x542F;&#x7279;&#x6B8A;&#x7684;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#xFF0C;&#x5404;&#x9879;&#x670D;&#x52A1;&#x4F1A;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#x6267;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x903B;&#x8F91;&#x3002;</li>\n</ol>\n<p>&#x542F;&#x52A8;&#x7684;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#x5206;&#x522B;&#x4E3A;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x542F;&#x52A8;&#x9636;&#x6BB5;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E9B;&#x9ED8;&#x8BA4;&#x5C55;&#x793A;</span><br><span class=\"line\">public static final int PHASE_WAIT_FOR_DEFAULT_DISPLAY = 100;</span><br><span class=\"line\"> </span><br><span class=\"line\">// &#x8BE5;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x5C06;&#x4F1A;&#x9501;&#x5B9A;setting&#x6570;&#x636E;</span><br><span class=\"line\">public static final int PHASE_LOCK_SETTINGS_READY = 480;</span><br><span class=\"line\"> </span><br><span class=\"line\">// &#x8BE5;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x5C06;&#x4F1A;&#x8C03;&#x7528;&#x6838;&#x5FC3;&#x7684;system services&#xFF0C;&#x4F8B;&#x5982;PowerManager&#x4E0E;PackageManager</span><br><span class=\"line\">public static final int PHASE_SYSTEM_SERVICES_READY = 500;</span><br><span class=\"line\"> </span><br><span class=\"line\">// &#x8BE5;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x5C06;&#x4F1A;&#x8C03;&#x7528;&#x8BBE;&#x5907;&#x7279;&#x6B8A;&#x670D;&#x52A1;</span><br><span class=\"line\">public static final int PHASE_DEVICE_SPECIFIC_SERVICES_READY = 520;</span><br><span class=\"line\"> </span><br><span class=\"line\">// &#x8BE5;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x5C06;&#x4F1A;&#x5C06;&#x4F1A;&#x53D1;&#x9001;&#x670D;&#x52A1;&#x5E7F;&#x64AD;</span><br><span class=\"line\">public static final int PHASE_ACTIVITY_MANAGER_READY = 550;</span><br><span class=\"line\"> </span><br><span class=\"line\">// &#x8BE5;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x5C06;&#x4F1A;&#x542F;&#x52A8;&#x4E0D;&#x7ED1;&#x5B9A;&#x4E09;&#x65B9;app</span><br><span class=\"line\">public static final int PHASE_THIRD_PARTY_APPS_CAN_START = 600;</span><br><span class=\"line\"> </span><br><span class=\"line\">// &#x8BE5;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x6807;&#x5FD7;&#x7740;&#x542F;&#x52A8;&#x5B8C;&#x6210;&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x8BBE;&#x5907;&#x4EA4;&#x4E92;&#xFF0C;&#x5E94;&#x7528;&#x684C;&#x9762;&#x5DF2;&#x7ECF;&#x542F;&#x52A8;</span><br><span class=\"line\">public static final int PHASE_BOOT_COMPLETED = 1000;</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E9B;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x4F1A;&#x7A7F;&#x63D2;&#x5728;&#x5404;&#x9879;&#x7684;&#x670D;&#x52A1;&#x542F;&#x52A8;&#x5E8F;&#x5217;&#x4E2D;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#x7684;&#x63D2;&#x5165;&#xFF0C;&#x90FD;&#x4F1A;&#x4F34;&#x968F;&#x7740;&#x8BE5;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#x4E4B;&#x524D;&#x7684;&#x670D;&#x52A1;&#x6267;&#x884C;&#x76F8;&#x5173;&#x903B;&#x8F91;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#x76F8;&#x5BF9;&#x4E8E;&#x6807;&#x8BC6;&#x6216;&#x8005;&#x8BF4;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;&#x5373;&#x540E;&#x7EED;&#x7684;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x9700;&#x8981;&#x4F9D;&#x8D56;&#x4E8E;&#x524D;&#x9762;&#x67D0;&#x4E9B;&#x670D;&#x52A1;&#x7684;&#x7279;&#x8272;&#x5904;&#x7406;&#x903B;&#x8F91;&#x4E4B;&#x540E;&#x624D;&#x80FD;&#x8FDB;&#x884C;&#x3002;</p>\n<p>&#x800C;&#x8FD9;&#x4E9B;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x7684;&#x8282;&#x70B9;&#x4F53;&#x73B0;&#x90FD;&#x5206;&#x5E03;&#x5728;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x4E2D;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">traceBeginAndSlog(&quot;StartServices&quot;);</span><br><span class=\"line\">startBootstrapServices();</span><br><span class=\"line\">startCoreServices();</span><br><span class=\"line\">startOtherServices();</span><br></pre></td></tr></table></figure>\n<p>&#x5177;&#x4F53;&#x7684;&#x8282;&#x70B9;&#x63D2;&#x5165;&#x65F6;&#x673A;&#x4E3A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void startBootstrapServices() {</span><br><span class=\"line\">        mSystemServiceManager.startBootPhase(SystemService.PHASE_WAIT_FOR_DEFAULT_DISPLAY);</span><br><span class=\"line\">}</span><br><span class=\"line\">private void startCoreServices() {</span><br><span class=\"line\">        ...</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">private void startOtherServices() {</span><br><span class=\"line\">        mSystemServiceManager.startBootPhase(SystemService.PHASE_LOCK_SETTINGS_READY);</span><br><span class=\"line\"> </span><br><span class=\"line\">        mSystemServiceManager.startBootPhase(SystemService.PHASE_SYSTEM_SERVICES_READY);</span><br><span class=\"line\"> </span><br><span class=\"line\">        mSystemServiceManager.startBootPhase(SystemService.PHASE_DEVICE_SPECIFIC_SERVICES_READY);</span><br><span class=\"line\"> </span><br><span class=\"line\">        mActivityManagerService.systemReady(() -&gt; {</span><br><span class=\"line\">            mSystemServiceManager.startBootPhase(</span><br><span class=\"line\">                    SystemService.PHASE_ACTIVITY_MANAGER_READY);        </span><br><span class=\"line\">             </span><br><span class=\"line\">            mSystemServiceManager.startBootPhase(</span><br><span class=\"line\">                    SystemService.PHASE_THIRD_PARTY_APPS_CAN_START);</span><br><span class=\"line\">        }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x5E94;&#x7684;&#x54CD;&#x5E94;&#x5404;&#x4E2A;&#x9636;&#x6BB5;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;&#x662F;&#x5728;&#x5BF9;&#x5E94;service&#x7684;onBootPhase()&#x65B9;&#x6CD5;&#x4E2D;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void onBootPhase(int phase) {</span><br><span class=\"line\">\t...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x5404;&#x4E2A;&#x9636;&#x6BB5;&#x90FD;&#x542F;&#x52A8;&#x4E86;&#x54EA;&#x4E9B;&#x670D;&#x52A1;&#x3002;</p>\n<h2 id=\"startBootstrapServices\"><a href=\"#startBootstrapServices\" class=\"headerlink\" title=\"startBootstrapServices\"></a>startBootstrapServices</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void startBootstrapServices() {</span><br><span class=\"line\">    final String TAG_SYSTEM_CONFIG = &quot;ReadingSystemConfig&quot;;</span><br><span class=\"line\">    traceBeginAndSlog(TAG_SYSTEM_CONFIG);</span><br><span class=\"line\">    SystemServerInitThreadPool.get().submit(SystemConfig::getInstance, TAG_SYSTEM_CONFIG);</span><br><span class=\"line\">    traceEnd();</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;Installer</span><br><span class=\"line\">    Installer installer = mSystemServiceManager.startService(Installer.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;DeviceIdentifiersPolicyService</span><br><span class=\"line\">    mSystemServiceManager.startService(DeviceIdentifiersPolicyService.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;ActivityManagerService</span><br><span class=\"line\">    mActivityManagerService = mSystemServiceManager.startService(</span><br><span class=\"line\">            ActivityManagerService.Lifecycle.class).getService();</span><br><span class=\"line\">    mActivityManagerService.setSystemServiceManager(mSystemServiceManager);</span><br><span class=\"line\">    mActivityManagerService.setInstaller(installer);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;PowerManagerService</span><br><span class=\"line\">    mPowerManagerService = mSystemServiceManager.startService(PowerManagerService.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x521D;&#x59CB;&#x5316;PowerManager</span><br><span class=\"line\">    mActivityManagerService.initPowerManagement();</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;RecoverySystemService</span><br><span class=\"line\">    mSystemServiceManager.startService(RecoverySystemService.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">    RescueParty.noteBoot(mSystemContext);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;LightsService</span><br><span class=\"line\">    mSystemServiceManager.startService(LightsService.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;SidekickService</span><br><span class=\"line\">    if (SystemProperties.getBoolean(&quot;config.enable_sidekick_graphics&quot;, false)) {</span><br><span class=\"line\">        mSystemServiceManager.startService(WEAR_SIDEKICK_SERVICE_CLASS);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;DisplayManagerService</span><br><span class=\"line\">    mDisplayManagerService = mSystemServiceManager.startService(DisplayManagerService.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x63D2;&#x5165;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#xFF0C;&#x6267;&#x884C;&#x5BF9;&#x5E94;&#x7684;&#x8282;&#x70B9;&#x903B;&#x8F91;</span><br><span class=\"line\">    mSystemServiceManager.startBootPhase(SystemService.PHASE_WAIT_FOR_DEFAULT_DISPLAY);</span><br><span class=\"line\">    </span><br><span class=\"line\">    ...</span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x5F00;&#x59CB;&#x63D2;&#x5165;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#x4E4B;&#x524D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x79F0;&#x4E4B;&#x4E3A;BootPhase 0&#xFF0C;&#x542F;&#x52A8;&#x7684;&#x670D;&#x52A1;&#x6709;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Installer</span><br><span class=\"line\">DeviceIdentifiersPolicyService</span><br><span class=\"line\">UriGrantsManagerService</span><br><span class=\"line\">ActivityManagerService</span><br><span class=\"line\">PowerManagerService</span><br><span class=\"line\">RecoverySystemService</span><br><span class=\"line\">LightsService</span><br><span class=\"line\">DisplayManagerService</span><br></pre></td></tr></table></figure>\n<p>&#x7531;&#x4E8E;PackageManager&#x542F;&#x52A8;&#x9700;&#x8981;DisplayManagerService&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#xFF0C;&#x6240;&#x4EE5;&#x8BBE;&#x7F6E;BootPhase 100&#xFF0C;&#x6267;&#x884C;DisplayManagerService&#x4E2D;&#x7684;onBootPhase&#x65B9;&#x6CD5;&#x6765;&#x5904;&#x7406;BootPhase 100&#x7684;&#x903B;&#x8F91;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void onBootPhase(int phase) {</span><br><span class=\"line\">    if (phase == PHASE_WAIT_FOR_DEFAULT_DISPLAY) {</span><br><span class=\"line\">        synchronized (mSyncRoot) {</span><br><span class=\"line\">            long timeout = SystemClock.uptimeMillis()</span><br><span class=\"line\">                    + mInjector.getDefaultDisplayDelayTimeout();</span><br><span class=\"line\">            while (mLogicalDisplays.get(Display.DEFAULT_DISPLAY) == null ||</span><br><span class=\"line\">                    mVirtualDisplayAdapter == null) {</span><br><span class=\"line\">                long delay = timeout - SystemClock.uptimeMillis();</span><br><span class=\"line\">                if (delay &lt;= 0) {</span><br><span class=\"line\">                    throw new RuntimeException(&quot;Timeout waiting for default display &quot;</span><br><span class=\"line\">                            + &quot;to be initialized. DefaultDisplay=&quot;</span><br><span class=\"line\">                            + mLogicalDisplays.get(Display.DEFAULT_DISPLAY)</span><br><span class=\"line\">                            + &quot;, mVirtualDisplayAdapter=&quot; + mVirtualDisplayAdapter);</span><br><span class=\"line\">                }</span><br><span class=\"line\">                if (DEBUG) {</span><br><span class=\"line\">                    Slog.d(TAG, &quot;waitForDefaultDisplay: waiting, timeout=&quot; + delay);</span><br><span class=\"line\">                }</span><br><span class=\"line\">                try {</span><br><span class=\"line\">                    mSyncRoot.wait(delay);</span><br><span class=\"line\">                } catch (InterruptedException ex) {</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5904;&#x7406;&#x5B8C;&#x4E4B;&#x540E;&#x7EE7;&#x7EED;&#x542F;&#x52A8;PackageManagerService&#x4E0E;&#x5176;&#x4ED6;&#x7684;&#x670D;&#x52A1;&#x3002;</p>\n<p>&#x4ECE;BootPhase 100&#x5230;BootPhase 480&#x4F1A;&#x542F;&#x52A8;&#x5927;&#x91CF;&#x7684;&#x670D;&#x52A1;&#x3002;</p>\n<p>&#x5305;&#x62EC;&#x521D;&#x59CB;&#x5316;&#x7684;&#x670D;&#x52A1;&#x3001;&#x6838;&#x5FC3;&#x670D;&#x52A1;&#x4E0E;&#x5176;&#x4ED6;&#x670D;&#x52A1;&#x3002;&#x5206;&#x522B;&#x4ECE;startBootstrapServices&#x3001;startCoreServices&#x5230;startOtherServices&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void startBootstrapServices() {</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    // BootPhase 100</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;PackageManagerService</span><br><span class=\"line\">    try {</span><br><span class=\"line\">        Watchdog.getInstance().pauseWatchingCurrentThread(&quot;packagemanagermain&quot;);</span><br><span class=\"line\">        mPackageManagerService = PackageManagerService.main(mSystemContext, installer,</span><br><span class=\"line\">                mFactoryTestMode != FactoryTest.FACTORY_TEST_OFF, mOnlyCore);</span><br><span class=\"line\">    } finally {</span><br><span class=\"line\">        Watchdog.getInstance().resumeWatchingCurrentThread(&quot;packagemanagermain&quot;);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    mFirstBoot = mPackageManagerService.isFirstBoot();</span><br><span class=\"line\">    mPackageManager = mSystemContext.getPackageManager();</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;UserManagerService&#xFF0C;&#x521B;&#x5EFA;/data/user/ &#x76EE;&#x5F55;</span><br><span class=\"line\">    mSystemServiceManager.startService(UserManagerService.LifeCycle.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x8BBE;&#x7F6E;AMS</span><br><span class=\"line\">    mActivityManagerService.setSystemProcess();</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;OverlayManagerService</span><br><span class=\"line\">    mSystemServiceManager.startService(new OverlayManagerService(mSystemContext, installer));</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;SensorPrivacyService&#xFF0C;&#x4F20;&#x611F;&#x5668;</span><br><span class=\"line\">    mSystemServiceManager.startService(new SensorPrivacyService(mSystemContext));</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;BootPhase 100&#x9636;&#x6BB5;&#xFF0C;startBootstrapServices&#x542F;&#x52A8;&#x4EE5;&#x4E0B;&#x670D;&#x52A1;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PackageManagerService</span><br><span class=\"line\">UserManagerService</span><br><span class=\"line\">OverlayManagerService</span><br><span class=\"line\">SensorPrivacyService</span><br></pre></td></tr></table></figure>\n<p>&#x968F;&#x540E;&#x8FDB;&#x5165;startCoreServices</p>\n<h2 id=\"startCoreServices\"><a href=\"#startCoreServices\" class=\"headerlink\" title=\"startCoreServices\"></a>startCoreServices</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void startCoreServices() {</span><br><span class=\"line\">    // &#x542F;&#x52A8;BatterService, &#x7BA1;&#x7406;&#x7535;&#x91CF;&#xFF0C;&#x9700;&#x8981;LightService</span><br><span class=\"line\">    mSystemServiceManager.startService(BatteryService.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;UsageStatsService&#xFF0C;&#x7EDF;&#x8BA1;&#x5E94;&#x7528;&#x4F7F;&#x7528;&#x60C5;&#x51B5;</span><br><span class=\"line\">    mSystemServiceManager.startService(UsageStatsService.class);</span><br><span class=\"line\">    mActivityManagerService.setUsageStatsManager(</span><br><span class=\"line\">            LocalServices.getService(UsageStatsManagerInternal.class));</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;WebViewUpdateService, &#x7BA1;&#x7406;WebView&#x66F4;&#x65B0;</span><br><span class=\"line\">    if (mPackageManager.hasSystemFeature(PackageManager.FEATURE_WEBVIEW)) {</span><br><span class=\"line\">        mWebViewUpdateService = mSystemServiceManager.startService(WebViewUpdateService.class);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;CachedDeviceStateService, &#x7F13;&#x5B58;&#x8BBE;&#x5907;&#x72B6;&#x6001;</span><br><span class=\"line\">    mSystemServiceManager.startService(CachedDeviceStateService.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;BinderCallsStatsService, &#x8BB0;&#x5F55;cpu&#x5728;binder&#x56DE;&#x8C03;&#x4E2D;&#x82B1;&#x8D39;&#x7684;&#x65F6;&#x95F4;</span><br><span class=\"line\">    mSystemServiceManager.startService(BinderCallsStatsService.LifeCycle.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;LooperStatsService, &#x8BB0;&#x5F55;&#x4F7F;&#x7528;handler message&#x82B1;&#x8D39;&#x7684;&#x65F6;&#x95F4;</span><br><span class=\"line\">    mSystemServiceManager.startService(LooperStatsService.Lifecycle.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;RollbackManagerService&#xFF0C;&#x7BA1;&#x7406;apk&#x56DE;&#x5377;</span><br><span class=\"line\">    mSystemServiceManager.startService(RollbackManagerService.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;BugreportManagerService, &#x6355;&#x83B7;bug&#x7684;&#x62A5;&#x544A;</span><br><span class=\"line\">    mSystemServiceManager.startService(BugreportManagerService.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;GpuService, &#x7BA1;&#x7406;GPU</span><br><span class=\"line\">    mSystemServiceManager.startService(GpuService.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">// BootPhase 100 &#x542F;&#x52A8;&#x7684;&#x670D;&#x52A1;</span><br><span class=\"line\">UsageStatsService</span><br><span class=\"line\">WebViewUpdateService</span><br><span class=\"line\">CachedDeviceStateService</span><br><span class=\"line\">BinderCallsStatsService</span><br><span class=\"line\">LooperStatsService</span><br><span class=\"line\">RollbackManagerService</span><br><span class=\"line\">BugreportManagerService</span><br><span class=\"line\">GpuService</span><br></pre></td></tr></table></figure>\n<p>&#x4EE5;&#x4E0A;&#x662F;&#x542F;&#x52A8;&#x7684;&#x6838;&#x5FC3;&#x670D;&#x52A1;&#xFF1B;&#x7EE7;&#x7EED;&#x8FDB;&#x5165;startOtherServices</p>\n<h2 id=\"startOtherServices\"><a href=\"#startOtherServices\" class=\"headerlink\" title=\"startOtherServices\"></a>startOtherServices</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void startOtherServices() {</span><br><span class=\"line\">    final Context context = mSystemContext; // &#x83B7;&#x53D6;Context</span><br><span class=\"line\"> </span><br><span class=\"line\">    try {</span><br><span class=\"line\">        ServiceManager.addService(&quot;sec_key_att_app_id_provider&quot;,</span><br><span class=\"line\">                new KeyAttestationApplicationIdProviderService(context));</span><br><span class=\"line\"> </span><br><span class=\"line\">        mSystemServiceManager.startService(KeyChainSystemService.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">        ServiceManager.addService(&quot;scheduling_policy&quot;, new SchedulingPolicyService());</span><br><span class=\"line\"> </span><br><span class=\"line\">        mSystemServiceManager.startService(TelecomLoaderService.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">        telephonyRegistry = new TelephonyRegistry(context);</span><br><span class=\"line\">        ServiceManager.addService(&quot;telephony.registry&quot;, telephonyRegistry);</span><br><span class=\"line\"> </span><br><span class=\"line\">        mEntropyMixer = new EntropyMixer(context);</span><br><span class=\"line\"> </span><br><span class=\"line\">        mContentResolver = context.getContentResolver(); // &#x83B7;&#x53D6;ContentResolver</span><br><span class=\"line\"> </span><br><span class=\"line\">        mSystemServiceManager.startService(ACCOUNT_SERVICE_CLASS);</span><br><span class=\"line\"> </span><br><span class=\"line\">        mSystemServiceManager.startService(CONTENT_SERVICE_CLASS);</span><br><span class=\"line\"> </span><br><span class=\"line\">        mActivityManagerService.installSystemProviders(); // &#x5B89;&#x88C5;&#x7CFB;&#x7EDF;Provider</span><br><span class=\"line\"> </span><br><span class=\"line\">        ...</span><br><span class=\"line\"> </span><br><span class=\"line\">        mSystemServiceManager.startService(new AlarmManagerService(context)); // &#x95F9;&#x949F;&#x670D;&#x52A1;</span><br><span class=\"line\"> </span><br><span class=\"line\">        ...</span><br><span class=\"line\"> </span><br><span class=\"line\">        mActivityManagerService.setWindowManager(wm); // &#x8BBE;&#x7F6E;WindowManager</span><br><span class=\"line\"> </span><br><span class=\"line\">        ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x8FDB;&#x5165;&#x5B89;&#x5168;&#x6A21;&#x5F0F;</span><br><span class=\"line\">    if (safeMode) {</span><br><span class=\"line\">        mActivityManagerService.enterSafeMode();</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    // BootPhase  480</span><br><span class=\"line\">    mSystemServiceManager.startBootPhase(SystemService.PHASE_LOCK_SETTINGS_READY);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // BootPhase 500</span><br><span class=\"line\">    mSystemServiceManager.startBootPhase(SystemService.PHASE_SYSTEM_SERVICES_READY);</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">    // BootPhase 520</span><br><span class=\"line\">    mSystemServiceManager.startBootPhase(SystemService.PHASE_DEVICE_SPECIFIC_SERVICES_READY);</span><br><span class=\"line\"> </span><br><span class=\"line\">    try {</span><br><span class=\"line\">        wm.systemReady();</span><br><span class=\"line\">    } catch (Throwable e) {</span><br><span class=\"line\">        reportWtf(&quot;making Window Manager Service ready&quot;, e);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (safeMode) {</span><br><span class=\"line\">        mActivityManagerService.showSafeModeOverlay();</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x66F4;&#x65B0;Configuration</span><br><span class=\"line\">    final Configuration config = wm.computeNewConfiguration(DEFAULT_DISPLAY);</span><br><span class=\"line\">    DisplayMetrics metrics = new DisplayMetrics();</span><br><span class=\"line\">    WindowManager w = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE);</span><br><span class=\"line\">    w.getDefaultDisplay().getMetrics(metrics);</span><br><span class=\"line\">    context.getResources().updateConfiguration(config, metrics);</span><br><span class=\"line\"> </span><br><span class=\"line\">    final Theme systemTheme = context.getTheme();</span><br><span class=\"line\">    if (systemTheme.getChangingConfigurations() != 0) {</span><br><span class=\"line\">        systemTheme.rebase();</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    try {</span><br><span class=\"line\">        mPowerManagerService.systemReady(mActivityManagerService.getAppOpsService());</span><br><span class=\"line\">    } catch (Throwable e) {</span><br><span class=\"line\">        reportWtf(&quot;making Power Manager Service ready&quot;, e);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    mSystemServiceManager.startService(PermissionPolicyService.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">    mPackageManagerService.systemReady();</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    mActivityManagerService.systemReady(() -&gt; {</span><br><span class=\"line\">        </span><br><span class=\"line\">        // BootPhase 550</span><br><span class=\"line\">        mSystemServiceManager.startBootPhase(</span><br><span class=\"line\">                SystemService.PHASE_ACTIVITY_MANAGER_READY);</span><br><span class=\"line\"> </span><br><span class=\"line\">        try {</span><br><span class=\"line\">            mActivityManagerService.startObservingNativeCrashes();</span><br><span class=\"line\">        } catch (Throwable e) {</span><br><span class=\"line\">            reportWtf(&quot;observing native crashes&quot;, e);</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        traceBeginAndSlog(&quot;MakeConnectivityServiceReady&quot;);</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            if (connectivityF != null) {</span><br><span class=\"line\">                connectivityF.systemReady();</span><br><span class=\"line\">            }</span><br><span class=\"line\">        } catch (Throwable e) {</span><br><span class=\"line\">            reportWtf(&quot;making Connectivity Service ready&quot;, e);</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        ...</span><br><span class=\"line\">        </span><br><span class=\"line\">        // BootPhase 600</span><br><span class=\"line\">        mSystemServiceManager.startBootPhase(</span><br><span class=\"line\">                SystemService.PHASE_THIRD_PARTY_APPS_CAN_START);</span><br><span class=\"line\"> </span><br><span class=\"line\">        try {</span><br><span class=\"line\">            if (locationF != null) {</span><br><span class=\"line\">                locationF.systemRunning();</span><br><span class=\"line\">            }</span><br><span class=\"line\">        } catch (Throwable e) {</span><br><span class=\"line\">            reportWtf(&quot;Notifying Location Service running&quot;, e);</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        try {</span><br><span class=\"line\">            if (countryDetectorF != null) {</span><br><span class=\"line\">                countryDetectorF.systemRunning();</span><br><span class=\"line\">            }</span><br><span class=\"line\">        } catch (Throwable e) {</span><br><span class=\"line\">            reportWtf(&quot;Notifying CountryDetectorService running&quot;, e);</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    }, BOOT_TIMINGS_TRACE_LOG);</span><br><span class=\"line\"> </span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;startOtherServices&#x4E2D;&#x542F;&#x52A8;&#x4E86;&#x5927;&#x91CF;&#x670D;&#x52A1;&#xFF0C;&#x603B;&#x5171;&#x5DEE;&#x4E0D;&#x591A;&#x6709;80&#x591A;&#x79CD;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x4E00;&#x4E00;&#x5217;&#x4E3E;&#x51FA;&#x6765;&#x3002;</p>\n<p>&#x6211;&#x8FD9;&#x91CC;&#x5C06;&#x5176;&#x4E0E;BootPhase&#x505A;&#x4E86;&#x4E2A;&#x5F52;&#x603B;&#xFF0C;&#x6765;&#x770B;&#x4E00;&#x4E0B;&#x5404;&#x4E2A;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x8282;&#x70B9;&#x90FD;&#x542F;&#x52A8;&#x4E86;&#x54EA;&#x4E9B;&#x670D;&#x52A1;&#x4E0E;&#x5BF9;&#x5E94;&#x670D;&#x52A1;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// BootPhase 100</span><br><span class=\"line\">KeyAttestationApplicationIdProviderService (startOtherServices)</span><br><span class=\"line\">KeyChainSystemService </span><br><span class=\"line\">SchedulingPolicyService</span><br><span class=\"line\">TelecomLoaderService</span><br><span class=\"line\">TelephonyRegistry</span><br><span class=\"line\">EntropyMixer</span><br><span class=\"line\">AccountManagerService</span><br><span class=\"line\">ContentService</span><br><span class=\"line\"> </span><br><span class=\"line\">...(&#x5927;&#x91CF;&#x670D;&#x52A1;)</span><br><span class=\"line\"> </span><br><span class=\"line\">AppBindingService</span><br><span class=\"line\"> </span><br><span class=\"line\">BootPhase 480</span><br><span class=\"line\"> </span><br><span class=\"line\">BootPhase 500</span><br><span class=\"line\"> </span><br><span class=\"line\">PermissionPolicyService</span><br><span class=\"line\">DeviceSpecificServices(&#x5305;&#x542B;&#x5927;&#x91CF;Service)</span><br><span class=\"line\"> </span><br><span class=\"line\">// &#x51C6;&#x5907;&#x597D; Power&#x3001;Package&#x4E0E;Diaplay&#x670D;&#x52A1;</span><br><span class=\"line\">PowerManagerService.systemReady</span><br><span class=\"line\">PackageManagerService.systemReady</span><br><span class=\"line\">DisplayManagerService.systemReady</span><br><span class=\"line\"> </span><br><span class=\"line\">BootPhase 520</span><br><span class=\"line\"> </span><br><span class=\"line\">BootPhase 550</span><br><span class=\"line\"> </span><br><span class=\"line\">CarServiceHelperService</span><br><span class=\"line\">startSystemUi</span><br><span class=\"line\"> </span><br><span class=\"line\">// &#x51C6;&#x5907;&#x597D; Network&#x3001;Ip&#x3001;Connectivity&#x670D;&#x52A1;</span><br><span class=\"line\">NetworkManagementService.systemReady</span><br><span class=\"line\">NetworkPolicyManagerService.systemReady</span><br><span class=\"line\">IpSecService.systemReady</span><br><span class=\"line\">NetworkStatsService.systemReady</span><br><span class=\"line\">ConnectivityService.systemReady</span><br><span class=\"line\">NetworkPolicyService.systemReady</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">BootPhase 600</span><br><span class=\"line\">  </span><br><span class=\"line\">NetworkStack</span><br><span class=\"line\"> </span><br><span class=\"line\">// &#x8FD0;&#x884C;Location&#x3001;CountryDetection&#x3001;Network&#x3001;Input&#x3001;Telephoney&#x3001;Media&#x3001;Mms&#x3001;Incident&#x670D;&#x52A1;</span><br><span class=\"line\">LocationService.systemRunning</span><br><span class=\"line\">CountryDetectionService.systemRunning</span><br><span class=\"line\">NetworkTimeUpdateService.systemRunning</span><br><span class=\"line\">InputManagerService.systemRunning</span><br><span class=\"line\">TelephonyRegistry.systemRunning</span><br><span class=\"line\">MediaRouterService.systemRunning</span><br><span class=\"line\">MmsServiceBroker.systemRunning</span><br><span class=\"line\">IncidentDaemon.systemRunning</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x7ECF;&#x8FC7;&#x4EE5;&#x4E0A;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x670D;&#x52A1;&#x8C03;&#x7528;&#xFF0C;&#x4F1A;&#x8C03;&#x7528;ActivityManagerService&#x7684;finishBooting&#x65B9;&#x6CD5;&#x6765;&#x6267;&#x884C;&#x6700;&#x540E;&#x4E00;&#x4E2A;BootPhase 1000&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">final void finishBooting() {</span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    // BootPhase 1000</span><br><span class=\"line\">    mSystemServiceManager.startBootPhase(SystemService.PHASE_BOOT_COMPLETED);</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x81F3;&#x6B64;&#xFF0C;&#x7CFB;&#x7EDF;&#x670D;&#x52A1;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x5B8C;&#x6210;&#x5C31;&#x7EEA;&#xFF0C;system_server&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#x5B8C;&#x6210;&#x5219;&#x8FDB;&#x5165;Looper.loop()&#x72B6;&#x6001;&#xFF0C;&#x7B49;&#x5F85;&#x6D88;&#x606F;&#x961F;&#x5217;MessageQueue&#x4E2D;&#x7684;&#x6D88;&#x606F;&#x5230;&#x6765;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;&#x5BF9;&#x5E94;&#x7684;Message&#x3002;</p>\n<p>&#x4EE5;&#x4E0A;&#x662F;SystemService&#x7684;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#xFF0C;&#x4E3B;&#x8981;&#x901A;&#x8FC7;BootPhase 0 ~ BootPhase 1000&#x6765;&#x5206;&#x522B;&#x542F;&#x52A8;&#x4E0D;&#x540C;&#x7684;Service&#xFF0C;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;BootPhase&#xFF0C;&#x76F8;&#x5E94;&#x7684;Service&#x6267;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x903B;&#x8F91;&#x3002;&#x540E;&#x7EED;Service&#x542F;&#x52A8;&#x903B;&#x8F91;&#x4E0E;&#x6267;&#x884C;&#x903B;&#x8F91;&#x53EF;&#x80FD;&#x4F9D;&#x8D56;&#x4E8E;&#x4E4B;&#x524D;&#x7684;Service&#xFF0C;&#x800C;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x4F9D;&#x8D56;&#x7BA1;&#x7406;&#x662F;&#x901A;&#x8FC7;BootPhase&#x6765;&#x5EFA;&#x7ACB;&#x7684;&#x3002;</p>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["启动"]},{"title":"Android SystemServer启动(一)","url":"https://www.rousetime.com/2020/12/31/Android-SystemServer启动-一/","content":"<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484889&amp;idx=1&amp;sn=b39c8bc0a9925464022b77a341263cf0&amp;chksm=e8e0fc49df97755f598ef0082409c573d7715ce33bb27b1c98194410d487ae69adbeb2293d84&amp;token=1353481402&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android init &#x542F;&#x52A8;</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484889&amp;idx=1&amp;sn=b39c8bc0a9925464022b77a341263cf0&amp;chksm=e8e0fc49df97755f598ef0082409c573d7715ce33bb27b1c98194410d487ae69adbeb2293d84&amp;token=1204064574&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android Linux Zygote&#x542F;&#x52A8;</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484921&amp;idx=1&amp;sn=bf7251253d23c17c9148423f6f1e386e&amp;chksm=e8e0fc69df97757f2aec459954c07d0fc44be4bd6c6963dab2b5c5b01d8e8176c9069ddab12c&amp;token=757375240&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android Java Zygote&#x542F;&#x52A8;</a></p>\n<p>Android&#x901A;&#x8FC7;Linux&#x542F;&#x52A8;init&#x8FDB;&#x7A0B;&#xFF0C; &#x518D;&#x901A;&#x8FC7;init&#x8FDB;&#x7A0B;fork&#x51FA;Zygote&#x8FDB;&#x7A0B;&#x3002;&#x5728;Zygote&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x6B65;&#x9AA4;&#x5C31;&#x662F;&#x542F;&#x52A8;system_server&#x8FDB;&#x7A0B;&#xFF0C;&#x5E76;&#x4E14;&#x521B;&#x5EFA;SystemServer&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x6DF1;&#x5165;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;SystemServer&#x7684;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;&#x3002;</p>\n<blockquote>\n<p>&#x6B64;&#x6B21;&#x5206;&#x6790;&#x8FC7;&#x7A0B;&#x57FA;&#x4E8E;Android 10.0</p>\n</blockquote>\n<h2 id=\"forkSystemServer\"><a href=\"#forkSystemServer\" class=\"headerlink\" title=\"forkSystemServer\"></a>forkSystemServer</h2><p>&#x5728;ZygoteInit&#x4E2D;&#x4F1A;&#x901A;&#x8FC7;forkSystemServer&#x6765;&#x521B;&#x5EFA;system_server&#x8FDB;&#x7A0B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private static Runnable forkSystemServer(String abiList, String socketName,</span><br><span class=\"line\">        ZygoteServer zygoteServer) {</span><br><span class=\"line\">    long capabilities = posixCapabilitiesAsBits(</span><br><span class=\"line\">        OsConstants.CAP_IPC_LOCK,</span><br><span class=\"line\">        OsConstants.CAP_KILL,</span><br><span class=\"line\">        OsConstants.CAP_NET_ADMIN,</span><br><span class=\"line\">        OsConstants.CAP_NET_BIND_SERVICE,</span><br><span class=\"line\">        OsConstants.CAP_NET_BROADCAST,</span><br><span class=\"line\">        OsConstants.CAP_NET_RAW,</span><br><span class=\"line\">        OsConstants.CAP_SYS_MODULE,</span><br><span class=\"line\">        OsConstants.CAP_SYS_NICE,</span><br><span class=\"line\">        OsConstants.CAP_SYS_PTRACE,</span><br><span class=\"line\">        OsConstants.CAP_SYS_TIME,</span><br><span class=\"line\">        OsConstants.CAP_SYS_TTY_CONFIG,</span><br><span class=\"line\">        OsConstants.CAP_WAKE_ALARM,</span><br><span class=\"line\">        OsConstants.CAP_BLOCK_SUSPEND</span><br><span class=\"line\">    );</span><br><span class=\"line\">    /* Containers run without some capabilities, so drop any caps that are not available. */</span><br><span class=\"line\">    StructCapUserHeader header = new StructCapUserHeader(</span><br><span class=\"line\">            OsConstants._LINUX_CAPABILITY_VERSION_3, 0);</span><br><span class=\"line\">    StructCapUserData[] data;</span><br><span class=\"line\">    try {</span><br><span class=\"line\">        data = Os.capget(header);</span><br><span class=\"line\">    } catch (ErrnoException ex) {</span><br><span class=\"line\">        throw new RuntimeException(&quot;Failed to capget()&quot;, ex);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    capabilities &amp;= ((long) data[0].effective) | (((long) data[1].effective) &lt;&lt; 32);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // system_server &#x8FDB;&#x7A0B;&#x53C2;&#x6570;</span><br><span class=\"line\">    String args[] = {</span><br><span class=\"line\">        &quot;--setuid=1000&quot;,</span><br><span class=\"line\">        &quot;--setgid=1000&quot;,</span><br><span class=\"line\">        &quot;--setgroups=1001,1002,1003,1004,1005,1006,1007,1008,1009,1010,1018,1021,1023,1024,1032,1065,3001,3002,3003,3006,3007,3009,3010&quot;,</span><br><span class=\"line\">        &quot;--capabilities=&quot; + capabilities + &quot;,&quot; + capabilities,</span><br><span class=\"line\">        &quot;--nice-name=system_server&quot;,</span><br><span class=\"line\">        &quot;--runtime-args&quot;,</span><br><span class=\"line\">        &quot;--target-sdk-version=&quot; + VMRuntime.SDK_VERSION_CUR_DEVELOPMENT,</span><br><span class=\"line\">        &quot;com.android.server.SystemServer&quot;,</span><br><span class=\"line\">    };</span><br><span class=\"line\">    ZygoteConnection.Arguments parsedArgs = null;</span><br><span class=\"line\"> </span><br><span class=\"line\">    int pid;</span><br><span class=\"line\"> </span><br><span class=\"line\">    try {</span><br><span class=\"line\">        // &#x89E3;&#x6790;&#x53C2;&#x6570;</span><br><span class=\"line\">        parsedArgs = new ZygoteConnection.Arguments(args);</span><br><span class=\"line\">        ZygoteConnection.applyDebuggerSystemProperty(parsedArgs);</span><br><span class=\"line\">        ZygoteConnection.applyInvokeWithSystemProperty(parsedArgs);</span><br><span class=\"line\"> </span><br><span class=\"line\">        boolean profileSystemServer = SystemProperties.getBoolean(</span><br><span class=\"line\">                &quot;dalvik.vm.profilesystemserver&quot;, false);</span><br><span class=\"line\">        if (profileSystemServer) {</span><br><span class=\"line\">            parsedArgs.runtimeFlags |= Zygote.PROFILE_SYSTEM_SERVER;</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        // fork&#x51FA;system_server&#x8FDB;&#x7A0B;</span><br><span class=\"line\">        pid = Zygote.forkSystemServer(</span><br><span class=\"line\">                parsedArgs.uid, parsedArgs.gid,</span><br><span class=\"line\">                parsedArgs.gids,</span><br><span class=\"line\">                parsedArgs.runtimeFlags,</span><br><span class=\"line\">                null,</span><br><span class=\"line\">                parsedArgs.permittedCapabilities,</span><br><span class=\"line\">                parsedArgs.effectiveCapabilities);</span><br><span class=\"line\">    } catch (IllegalArgumentException ex) {</span><br><span class=\"line\">        throw new RuntimeException(ex);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // system_server&#x5B50;&#x8FDB;&#x7A0B;</span><br><span class=\"line\">    if (pid == 0) {</span><br><span class=\"line\">        if (hasSecondZygote(abiList)) {</span><br><span class=\"line\">            waitForSecondaryZygote(socketName);</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        // &#x5173;&#x95ED;&#x539F;&#x6709;&#x8FDB;&#x7A0B;</span><br><span class=\"line\">        zygoteServer.closeServerSocket();</span><br><span class=\"line\">        // &#x64CD;&#x4F5C;system_server&#x8FDB;&#x7A0B;</span><br><span class=\"line\">        return handleSystemServerProcess(parsedArgs);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return null;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x4F1A;&#x51C6;&#x5907;fork&#x7684;&#x8FDB;&#x7A0B;&#x53C2;&#x6570;&#xFF0C;&#x4ECE;&#x53C2;&#x6570;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;system_server&#x8FDB;&#x7A0B;&#x7684;uid=1000&#x3001;gid=1000&#xFF0C;&#x8FDB;&#x7A0B;&#x540D;&#x79F0;&#x4E3A;system_server&#xFF0C;&#x540E;&#x7EED;&#x542F;&#x52A8;&#x7684;SystemServer&#x8DEF;&#x5F84;&#x4E3A;com.android.server.SystemServer&#x3002;</p>\n<p>&#x4ECE;zygote&#x8FDB;&#x7A0B;fork&#x65B0;&#x8FDB;&#x7A0B;&#x4E4B;&#x540E;&#x4F1A;&#x5C06;&#x539F;&#x6765;&#x7684;zygote&#x7684;socket&#x5173;&#x95ED;&#xFF0C;&#x540C;&#x65F6;&#x5BF9;&#x4E8E;&#x6709;&#x4E24;&#x4E2A;zygote&#x8FDB;&#x7A0B;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x7B2C;2&#x4E2A;zygote&#x521B;&#x5EFA;&#x5B8C;&#x6210;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static int forkSystemServer(int uid, int gid, int[] gids, int runtimeFlags,</span><br><span class=\"line\">        int[][] rlimits, long permittedCapabilities, long effectiveCapabilities) {</span><br><span class=\"line\">    VM_HOOKS.preFork();</span><br><span class=\"line\">    // Resets nice priority for zygote process.</span><br><span class=\"line\">    resetNicePriority();</span><br><span class=\"line\">    int pid = nativeForkSystemServer(</span><br><span class=\"line\">            uid, gid, gids, runtimeFlags, rlimits, permittedCapabilities, effectiveCapabilities);</span><br><span class=\"line\">    // Enable tracing as soon as we enter the system_server.</span><br><span class=\"line\">    if (pid == 0) {</span><br><span class=\"line\">        Trace.setTracingEnabled(true, runtimeFlags);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    VM_HOOKS.postForkCommon();</span><br><span class=\"line\">    return pid;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>nativeForkSystemServer&#x6700;&#x7EC8;&#x4F1A;&#x901A;&#x8FC7;JNI&#x6620;&#x5C04;&#x5230;com_android_internal_os_Zygote.cpp&#x4E2D;&#x7684;com_android_internal_os_Zygote_nativeForkSystemServer&#x65B9;&#x6CD5;.</p>\n<h2 id=\"nativeForkSystemServer\"><a href=\"#nativeForkSystemServer\" class=\"headerlink\" title=\"nativeForkSystemServer\"></a>nativeForkSystemServer</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static jint com_android_internal_os_Zygote_nativeForkSystemServer(</span><br><span class=\"line\">        JNIEnv* env, jclass, uid_t uid, gid_t gid, jintArray gids,</span><br><span class=\"line\">        jint runtime_flags, jobjectArray rlimits, jlong permitted_capabilities,</span><br><span class=\"line\">        jlong effective_capabilities) {</span><br><span class=\"line\">  std::vector&lt;int&gt; fds_to_close(MakeUsapPipeReadFDVector()),</span><br><span class=\"line\">                   fds_to_ignore(fds_to_close);</span><br><span class=\"line\"> </span><br><span class=\"line\">  fds_to_close.push_back(gUsapPoolSocketFD);</span><br><span class=\"line\"> </span><br><span class=\"line\">  if (gUsapPoolEventFD != -1) {</span><br><span class=\"line\">    fds_to_close.push_back(gUsapPoolEventFD);</span><br><span class=\"line\">    fds_to_ignore.push_back(gUsapPoolEventFD);</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  if (gSystemServerSocketFd != -1) {</span><br><span class=\"line\">      fds_to_close.push_back(gSystemServerSocketFd);</span><br><span class=\"line\">      fds_to_ignore.push_back(gSystemServerSocketFd);</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  // fork &#x5B50;&#x8FDB;&#x7A0B;</span><br><span class=\"line\">  pid_t pid = ForkCommon(env, true,</span><br><span class=\"line\">                         fds_to_close,</span><br><span class=\"line\">                         fds_to_ignore,</span><br><span class=\"line\">                         true);</span><br><span class=\"line\">  if (pid == 0) {</span><br><span class=\"line\">      </span><br><span class=\"line\">      // &#x5904;&#x7406;&#x5B50;&#x8FDB;&#x7A0B;</span><br><span class=\"line\">      SpecializeCommon(env, uid, gid, gids, runtime_flags, rlimits,</span><br><span class=\"line\">                       permitted_capabilities, effective_capabilities,</span><br><span class=\"line\">                       MOUNT_EXTERNAL_DEFAULT, nullptr, nullptr, true,</span><br><span class=\"line\">                       false, nullptr, nullptr, /* is_top_app= */ false,</span><br><span class=\"line\">                       /* pkg_data_info_list */ nullptr,</span><br><span class=\"line\">                       /* whitelisted_data_info_list */ nullptr, false, false);</span><br><span class=\"line\">  } else if (pid &gt; 0) {</span><br><span class=\"line\">      gSystemServerPid = pid;</span><br><span class=\"line\">      int status;</span><br><span class=\"line\">      if (waitpid(pid, &amp;status, WNOHANG) == pid) {</span><br><span class=\"line\">          ALOGE(&quot;System server process %d has died. Restarting Zygote!&quot;, pid);</span><br><span class=\"line\">          RuntimeAbort(env, __LINE__, &quot;System server process has died. Restarting Zygote!&quot;);</span><br><span class=\"line\">      }</span><br><span class=\"line\"> </span><br><span class=\"line\">      if (UsePerAppMemcg()) {</span><br><span class=\"line\">          if (!SetTaskProfiles(pid, std::vector&lt;std::string&gt;{&quot;SystemMemoryProcess&quot;})) {</span><br><span class=\"line\">              ALOGE(&quot;couldn&apos;t add process %d into system memcg group&quot;, pid);</span><br><span class=\"line\">          }</span><br><span class=\"line\">      }</span><br><span class=\"line\">  }</span><br><span class=\"line\">  return pid;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x4F1A;&#x901A;&#x8FC7;ForkCommon&#x6765;&#x521B;&#x5EFA;&#x5B50;&#x8FDB;&#x7A0B;</p>\n<h2 id=\"ForkCommon\"><a href=\"#ForkCommon\" class=\"headerlink\" title=\"ForkCommon\"></a>ForkCommon</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static pid_t ForkCommon(JNIEnv* env, bool is_system_server,</span><br><span class=\"line\">                        const std::vector&lt;int&gt;&amp; fds_to_close,</span><br><span class=\"line\">                        const std::vector&lt;int&gt;&amp; fds_to_ignore,</span><br><span class=\"line\">                        bool is_priority_fork) {</span><br><span class=\"line\">  SetSignalHandlers();</span><br><span class=\"line\"> </span><br><span class=\"line\">  auto fail_fn = std::bind(ZygoteFailure, env, is_system_server ? &quot;system_server&quot; : &quot;zygote&quot;,</span><br><span class=\"line\">                           nullptr, _1);</span><br><span class=\"line\"> </span><br><span class=\"line\">  BlockSignal(SIGCHLD, fail_fn);</span><br><span class=\"line\"> </span><br><span class=\"line\">  __android_log_close();</span><br><span class=\"line\">  AStatsSocket_close();</span><br><span class=\"line\"> </span><br><span class=\"line\">  if (gOpenFdTable == nullptr) {</span><br><span class=\"line\">    gOpenFdTable = FileDescriptorTable::Create(fds_to_ignore, fail_fn);</span><br><span class=\"line\">  } else {</span><br><span class=\"line\">    gOpenFdTable-&gt;Restat(fds_to_ignore, fail_fn);</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  android_fdsan_error_level fdsan_error_level = android_fdsan_get_error_level();</span><br><span class=\"line\"> </span><br><span class=\"line\">  mallopt(M_PURGE, 0);</span><br><span class=\"line\"> </span><br><span class=\"line\">  // fork&#x5B50;&#x8FDB;&#x7A0B;</span><br><span class=\"line\">  pid_t pid = fork();</span><br><span class=\"line\"> </span><br><span class=\"line\">  if (pid == 0) {</span><br><span class=\"line\">    // &#x5904;&#x7406;&#x5B50;&#x8FDB;&#x7A0B;&#x903B;&#x8F91;</span><br><span class=\"line\">    if (is_priority_fork) {</span><br><span class=\"line\">      setpriority(PRIO_PROCESS, 0, PROCESS_PRIORITY_MAX);</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">      setpriority(PRIO_PROCESS, 0, PROCESS_PRIORITY_MIN);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // The child process.</span><br><span class=\"line\">    PAuthKeyChange(env);</span><br><span class=\"line\">    PreApplicationInit();</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Clean up any descriptors which must be closed immediately</span><br><span class=\"line\">    DetachDescriptors(env, fds_to_close, fail_fn);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Invalidate the entries in the USAP table.</span><br><span class=\"line\">    ClearUsapTable();</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Re-open all remaining open file descriptors so that they aren&apos;t shared</span><br><span class=\"line\">    // with the zygote across a fork.</span><br><span class=\"line\">    gOpenFdTable-&gt;ReopenOrDetach(fail_fn);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Turn fdsan back on.</span><br><span class=\"line\">    android_fdsan_set_error_level(fdsan_error_level);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Reset the fd to the unsolicited zygote socket</span><br><span class=\"line\">    gSystemServerSocketFd = -1;</span><br><span class=\"line\">  } else {</span><br><span class=\"line\">    ALOGD(&quot;Forked child process %d&quot;, pid);</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  // We blocked SIGCHLD prior to a fork, we unblock it here.</span><br><span class=\"line\">  UnblockSignal(SIGCHLD, fail_fn);</span><br><span class=\"line\"> </span><br><span class=\"line\">  return pid;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>fork&#x521B;&#x5EFA;&#x8FDB;&#x7A0B;&#x91C7;&#x7528;&#x7684;&#x662F;copy on write&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;Linux&#x521B;&#x5EFA;&#x8FDB;&#x7A0B;&#x7684;&#x6807;&#x51C6;&#x65B9;&#x5F0F;&#xFF0C;&#x4F1A;&#x6709;&#x4E24;&#x6B21;&#x8FD4;&#x56DE;&#x503C;&#x3002;</p>\n<p>&#x8FD4;&#x56DE;0&#x65F6;&#x4EE3;&#x8868;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x5927;&#x4E8E;0&#x4E3A;&#x7236;&#x8FDB;&#x7A0B;&#x3002;</p>\n<p>&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x8FD4;&#x56DE;Java&#x5C42;&#xFF0C;&#x5E76;&#x8FDB;&#x5165;handleSystemServerProcess&#x6765;&#x5904;&#x7406;system_server&#x8FDB;&#x7A0B;&#x903B;&#x8F91;&#x3002;</p>\n<h2 id=\"handleSystemServerProcess\"><a href=\"#handleSystemServerProcess\" class=\"headerlink\" title=\"handleSystemServerProcess\"></a>handleSystemServerProcess</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private static Runnable handleSystemServerProcess(ZygoteConnection.Arguments parsedArgs) {</span><br><span class=\"line\">    Os.umask(S_IRWXG | S_IRWXO);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x8BBE;&#x7F6E;&#x8FDB;&#x7A0B;&#x540D;&#x79F0;</span><br><span class=\"line\">    if (parsedArgs.niceName != null) {</span><br><span class=\"line\">        Process.setArgV0(parsedArgs.niceName);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    final String systemServerClasspath = Os.getenv(&quot;SYSTEMSERVERCLASSPATH&quot;);</span><br><span class=\"line\">    if (systemServerClasspath != null) {</span><br><span class=\"line\">        performSystemServerDexOpt(systemServerClasspath);</span><br><span class=\"line\">        boolean profileSystemServer = SystemProperties.getBoolean(</span><br><span class=\"line\">                &quot;dalvik.vm.profilesystemserver&quot;, false);</span><br><span class=\"line\">        if (profileSystemServer &amp;&amp; (Build.IS_USERDEBUG || Build.IS_ENG)) {</span><br><span class=\"line\">            try {</span><br><span class=\"line\">                prepareSystemServerProfile(systemServerClasspath);</span><br><span class=\"line\">            } catch (Exception e) {</span><br><span class=\"line\">                Log.wtf(TAG, &quot;Failed to set up system server profile&quot;, e);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (parsedArgs.invokeWith != null) {</span><br><span class=\"line\">        String[] args = parsedArgs.remainingArgs;</span><br><span class=\"line\">        if (systemServerClasspath != null) {</span><br><span class=\"line\">            String[] amendedArgs = new String[args.length + 2];</span><br><span class=\"line\">            amendedArgs[0] = &quot;-cp&quot;;</span><br><span class=\"line\">            amendedArgs[1] = systemServerClasspath;</span><br><span class=\"line\">            System.arraycopy(args, 0, amendedArgs, 2, args.length);</span><br><span class=\"line\">            args = amendedArgs;</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        // &#x542F;&#x52A8;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;</span><br><span class=\"line\">        WrapperInit.execApplication(parsedArgs.invokeWith,</span><br><span class=\"line\">                parsedArgs.niceName, parsedArgs.targetSdkVersion,</span><br><span class=\"line\">                VMRuntime.getCurrentInstructionSet(), null, args);</span><br><span class=\"line\"> </span><br><span class=\"line\">        throw new IllegalStateException(&quot;Unexpected return from WrapperInit.execApplication&quot;);</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        ClassLoader cl = null;</span><br><span class=\"line\">        if (systemServerClasspath != null) {</span><br><span class=\"line\">            // &#x521B;&#x5EFA;ClassLoader</span><br><span class=\"line\">            cl = createPathClassLoader(systemServerClasspath, parsedArgs.targetSdkVersion);</span><br><span class=\"line\">            Thread.currentThread().setContextClassLoader(cl);</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        return ZygoteInit.zygoteInit(parsedArgs.targetSdkVersion, parsedArgs.remainingArgs, cl);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8BBE;&#x7F6E;&#x8FDB;&#x7A0B;&#x540D;&#x79F0;system_server&#xFF0C;&#x5E76;&#x901A;&#x8FC7;zygoteInit&#x8FDB;&#x5165;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static final Runnable zygoteInit(int targetSdkVersion, String[] argv, ClassLoader classLoader) {</span><br><span class=\"line\">    if (RuntimeInit.DEBUG) {</span><br><span class=\"line\">        Slog.d(RuntimeInit.TAG, &quot;RuntimeInit: Starting application from zygote&quot;);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, &quot;ZygoteInit&quot;);</span><br><span class=\"line\">    RuntimeInit.redirectLogStreams();</span><br><span class=\"line\"> </span><br><span class=\"line\">    RuntimeInit.commonInit();</span><br><span class=\"line\">    ZygoteInit.nativeZygoteInit();</span><br><span class=\"line\">    return RuntimeInit.applicationInit(targetSdkVersion, argv, classLoader);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x4F1A;&#x901A;&#x8FC7;&#x8C03;&#x7528;RuntimeInit.commonInit&#x6765;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E9B;&#x516C;&#x7528;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x5E76;&#x901A;&#x8FC7;nativeZygoteInit&#x8C03;&#x7528;&#x5BF9;&#x4E8E;&#x6620;&#x5C04;&#x7684;Linux&#x65B9;&#x6CD5;&#xFF0C;&#x5373;app_main.cpp&#x4E2D;&#x7684;onZygoteInit&#x65B9;&#x6CD5;&#x6765;&#x521D;&#x59CB;&#x5316;zygote&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">virtual void onZygoteInit() {</span><br><span class=\"line\">    sp&lt;ProcessState&gt; proc = ProcessState::self();</span><br><span class=\"line\">    proc-&gt;startThreadPool(); //&#x542F;&#x52A8;&#x65B0;binder&#x7EBF;&#x7A0B;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>ProcessState::self()&#x662F;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#xFF0C;&#x4E3B;&#x8981;&#x5DE5;&#x4F5C;&#x662F;&#x8C03;&#x7528;open()&#x6253;&#x5F00;/dev/binder&#x9A71;&#x52A8;&#x8BBE;&#x5907;&#xFF0C;&#x518D;&#x5229;&#x7528;mmap()&#x6620;&#x5C04;&#x5185;&#x6838;&#x7684;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#xFF0C;&#x5C06;Binder&#x9A71;&#x52A8;&#x7684;fd&#x8D4B;&#x503C;ProcessState&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x53D8;&#x91CF;mDriverFD&#xFF0C;&#x7528;&#x4E8E;&#x4EA4;&#x4E92;&#x64CD;&#x4F5C;&#x3002;startThreadPool()&#x662F;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;binder&#x7EBF;&#x7A0B;&#xFF0C;&#x4E0D;&#x65AD;&#x8FDB;&#x884C;talkWithDriver()&#x3002;</p>\n<h2 id=\"applicationInit\"><a href=\"#applicationInit\" class=\"headerlink\" title=\"applicationInit\"></a>applicationInit</h2><p>&#x7EE7;&#x7EED;&#x56DE;&#x5230;Java&#xFF0C;&#x8C03;&#x7528;applicationInit&#x65B9;&#x6CD5;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected static Runnable applicationInit(int targetSdkVersion, String[] argv,</span><br><span class=\"line\">        ClassLoader classLoader) {</span><br><span class=\"line\">    </span><br><span class=\"line\">    nativeSetExitWithoutCleanup(true);</span><br><span class=\"line\"> </span><br><span class=\"line\">    VMRuntime.getRuntime().setTargetHeapUtilization(0.75f);</span><br><span class=\"line\">    VMRuntime.getRuntime().setTargetSdkVersion(targetSdkVersion);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x89E3;&#x6790;&#x53C2;&#x6570;</span><br><span class=\"line\">    final Arguments args = new Arguments(argv);</span><br><span class=\"line\"> </span><br><span class=\"line\">    Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</span><br><span class=\"line\"> </span><br><span class=\"line\">    return findStaticMain(args.startClass, args.startArgs, classLoader);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x4E4B;&#x524D;&#x7684;&#x53C2;&#x6570;&#x5217;&#x8868;&#x4FE1;&#x606F;&#xFF0C;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x8FD9;&#x91CC;&#x7684;startclass&#x5C31;&#x662F;com.android.server.SystemServer&#x3002;</p>\n<h2 id=\"findStaticMain\"><a href=\"#findStaticMain\" class=\"headerlink\" title=\"findStaticMain\"></a>findStaticMain</h2><p>&#x6700;&#x540E;&#x8FDB;&#x5165;findStaticMain&#x65B9;&#x6CD5;&#x6765;&#x521B;&#x5EFA;SystemServer</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected static Runnable findStaticMain(String className, String[] argv,</span><br><span class=\"line\">        ClassLoader classLoader) {</span><br><span class=\"line\">    Class&lt;?&gt; cl;</span><br><span class=\"line\"> </span><br><span class=\"line\">    try {</span><br><span class=\"line\">        cl = Class.forName(className, true, classLoader);</span><br><span class=\"line\">    } catch (ClassNotFoundException ex) {</span><br><span class=\"line\">        throw new RuntimeException(</span><br><span class=\"line\">                &quot;Missing class when invoking static main &quot; + className,</span><br><span class=\"line\">                ex);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    Method m;</span><br><span class=\"line\">    try {</span><br><span class=\"line\">        m = cl.getMethod(&quot;main&quot;, new Class[] { String[].class });</span><br><span class=\"line\">    } catch (NoSuchMethodException ex) {</span><br><span class=\"line\">        throw new RuntimeException(</span><br><span class=\"line\">                &quot;Missing static main on &quot; + className, ex);</span><br><span class=\"line\">    } catch (SecurityException ex) {</span><br><span class=\"line\">        throw new RuntimeException(</span><br><span class=\"line\">                &quot;Problem getting static main on &quot; + className, ex);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    int modifiers = m.getModifiers();</span><br><span class=\"line\">    if (! (Modifier.isStatic(modifiers) &amp;&amp; Modifier.isPublic(modifiers))) {</span><br><span class=\"line\">        throw new RuntimeException(</span><br><span class=\"line\">                &quot;Main method is not public and static on &quot; + className);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    return new MethodAndArgsCaller(m, argv);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8BE5;&#x65B9;&#x6CD5;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x901A;&#x8FC7;Java&#x53CD;&#x5C04;&#x6765;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;Class&#x3001;Method&#xFF0C;&#x8FD9;&#x91CC;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;SystemServer&#x7684;main&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x8FD4;&#x56DE;MethodAndArgsCaller&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static class MethodAndArgsCaller implements Runnable {</span><br><span class=\"line\">    /** method to call */</span><br><span class=\"line\">    private final Method mMethod;</span><br><span class=\"line\"> </span><br><span class=\"line\">    /** argument array */</span><br><span class=\"line\">    private final String[] mArgs;</span><br><span class=\"line\"> </span><br><span class=\"line\">    public MethodAndArgsCaller(Method method, String[] args) {</span><br><span class=\"line\">        mMethod = method;</span><br><span class=\"line\">        mArgs = args;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    public void run() {</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            mMethod.invoke(null, new Object[] { mArgs });</span><br><span class=\"line\">        } catch (IllegalAccessException ex) {</span><br><span class=\"line\">            throw new RuntimeException(ex);</span><br><span class=\"line\">        } catch (InvocationTargetException ex) {</span><br><span class=\"line\">            Throwable cause = ex.getCause();</span><br><span class=\"line\">            if (cause instanceof RuntimeException) {</span><br><span class=\"line\">                throw (RuntimeException) cause;</span><br><span class=\"line\">            } else if (cause instanceof Error) {</span><br><span class=\"line\">                throw (Error) cause;</span><br><span class=\"line\">            }</span><br><span class=\"line\">            throw new RuntimeException(ex);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x5982;&#x679C;&#x8C03;&#x7528;run&#x65B9;&#x6CD5;&#x5C31;&#x4F1A;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x6765;&#x6267;&#x884C;SystemServer&#x4E2D;&#x7684;main&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x800C;&#x8FD9;&#x4E2A;Runnable&#x6700;&#x7EC8;&#x5728;ZygoteInit&#x7684;main&#x65B9;&#x6CD5;&#x4E2D;&#x901A;&#x8FC7;forkSystemServer&#x521B;&#x5EFA;&#x5E76;&#x8FD4;&#x56DE;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (startSystemServer) {</span><br><span class=\"line\">    Runnable r = forkSystemServer(abiList, socketName, zygoteServer);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // {@code r == null} in the parent (zygote) process, and {@code r != null} in the</span><br><span class=\"line\">    // child (system_server) process.</span><br><span class=\"line\">    if (r != null) {</span><br><span class=\"line\">        r.run();</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x521B;&#x5EFA;&#x5E76;&#x8FD4;&#x56DE;Runnable&#x4E4B;&#x540E;&#xFF0C;&#x8C03;&#x7528;r.run()&#x6765;&#x6267;&#x884C;SystemServer&#x7684;main&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x6700;&#x7EC8;&#x8FDB;&#x5165;SystemServer&#x7684;&#x6D41;&#x7A0B;&#x3002;</p>\n<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x627E;&#x5230;&#x4E86;&#x8FDB;&#x5165;SystemServer&#x7684;&#x5165;&#x53E3;&#xFF0C;&#x540E;&#x7EED;&#x7EE7;&#x7EED;&#x5206;&#x6790;SystemServer&#x7684;&#x4F5C;&#x7528;&#x4E0E;&#x5185;&#x90E8;&#x6267;&#x884C;&#x7684;&#x903B;&#x8F91;&#x3002;</p>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["启动"]},{"title":"Android Java Zygote启动","url":"https://www.rousetime.com/2020/12/17/Android-Java-Zygote启动/","content":"<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484889&amp;idx=1&amp;sn=b39c8bc0a9925464022b77a341263cf0&amp;chksm=e8e0fc49df97755f598ef0082409c573d7715ce33bb27b1c98194410d487ae69adbeb2293d84&amp;token=1353481402&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android init &#x542F;&#x52A8;</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484889&amp;idx=1&amp;sn=b39c8bc0a9925464022b77a341263cf0&amp;chksm=e8e0fc49df97755f598ef0082409c573d7715ce33bb27b1c98194410d487ae69adbeb2293d84&amp;token=1204064574&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android Linux Zygote&#x542F;&#x52A8;</a></p>\n<p>&#x5728;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#x4E2D;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5206;&#x6790;&#x5230;Zygote&#x6700;&#x540E;&#x5728;Linux&#x7684;init&#x8FDB;&#x7A0B;&#x4E2D;&#x662F;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#x542F;&#x52A8;Java&#x5C42;&#x7684;ZygoteInit&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">runtime.start(&quot;com.android.internal.os.ZygoteInit&quot;, args, zygote);</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8FDB;&#x5165;runtime.start()&#x65B9;&#x6CD5;&#x770B;&#x4E0B;&#x5B83;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x3002;</p>\n<h2 id=\"AndroidRuntime\"><a href=\"#AndroidRuntime\" class=\"headerlink\" title=\"AndroidRuntime\"></a>AndroidRuntime</h2><blockquote>\n<p>frameworks/base/core/jni/AndroidRuntime.cpp</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void AndroidRuntime::start(const char* className, const Vector&lt;String8&gt;&amp; options, bool zygote)</span><br><span class=\"line\">{</span><br><span class=\"line\">    ALOGD(&quot;&gt;&gt;&gt;&gt;&gt;&gt; START %s uid %d &lt;&lt;&lt;&lt;&lt;&lt;\\n&quot;,</span><br><span class=\"line\">            className != NULL ? className : &quot;(unknown)&quot;, getuid());</span><br><span class=\"line\"> </span><br><span class=\"line\">    static const String8 startSystemServer(&quot;start-system-server&quot;);</span><br><span class=\"line\">    // Whether this is the primary zygote, meaning the zygote which will fork system server.</span><br><span class=\"line\">    bool primary_zygote = false;</span><br><span class=\"line\"> </span><br><span class=\"line\">    /*</span><br><span class=\"line\">     * &apos;startSystemServer == true&apos; means runtime is obsolete and not run from</span><br><span class=\"line\">     * init.rc anymore, so we print out the boot start event here.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    for (size_t i = 0; i &lt; options.size(); ++i) {</span><br><span class=\"line\">        if (options[i] == startSystemServer) {</span><br><span class=\"line\">            primary_zygote = true;</span><br><span class=\"line\">           /* track our progress through the boot sequence */</span><br><span class=\"line\">           const int LOG_BOOT_PROGRESS_START = 3000;</span><br><span class=\"line\">           LOG_EVENT_LONG(LOG_BOOT_PROGRESS_START,  ns2ms(systemTime(SYSTEM_TIME_MONOTONIC)));</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    const char* rootDir = getenv(&quot;ANDROID_ROOT&quot;);</span><br><span class=\"line\">    if (rootDir == NULL) {</span><br><span class=\"line\">        rootDir = &quot;/system&quot;;</span><br><span class=\"line\">        if (!hasDir(&quot;/system&quot;)) {</span><br><span class=\"line\">            LOG_FATAL(&quot;No root directory specified, and /system does not exist.&quot;);</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        setenv(&quot;ANDROID_ROOT&quot;, rootDir, 1);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    const char* artRootDir = getenv(&quot;ANDROID_ART_ROOT&quot;);</span><br><span class=\"line\">    if (artRootDir == NULL) {</span><br><span class=\"line\">        LOG_FATAL(&quot;No ART directory specified with ANDROID_ART_ROOT environment variable.&quot;);</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    const char* i18nRootDir = getenv(&quot;ANDROID_I18N_ROOT&quot;);</span><br><span class=\"line\">    if (i18nRootDir == NULL) {</span><br><span class=\"line\">        LOG_FATAL(&quot;No runtime directory specified with ANDROID_I18N_ROOT environment variable.&quot;);</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    const char* tzdataRootDir = getenv(&quot;ANDROID_TZDATA_ROOT&quot;);</span><br><span class=\"line\">    if (tzdataRootDir == NULL) {</span><br><span class=\"line\">        LOG_FATAL(&quot;No tz data directory specified with ANDROID_TZDATA_ROOT environment variable.&quot;);</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    //const char* kernelHack = getenv(&quot;LD_ASSUME_KERNEL&quot;);</span><br><span class=\"line\">    //ALOGD(&quot;Found LD_ASSUME_KERNEL=&apos;%s&apos;\\n&quot;, kernelHack);</span><br><span class=\"line\"> </span><br><span class=\"line\">    /* start the virtual machine */</span><br><span class=\"line\">    JniInvocation jni_invocation;</span><br><span class=\"line\">    jni_invocation.Init(NULL);</span><br><span class=\"line\">    JNIEnv* env;</span><br><span class=\"line\">    // 1. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</span><br><span class=\"line\">    if (startVm(&amp;mJavaVM, &amp;env, zygote, primary_zygote) != 0) {</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    onVmCreated(env);</span><br><span class=\"line\"> </span><br><span class=\"line\">    /*</span><br><span class=\"line\">     * Register android functions.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    // 2. &#x4F7F;&#x7528;JNI&#x6CE8;&#x518C;&#x5BF9;&#x5E94;&#x7684;Android Native &#x65B9;&#x6CD5;</span><br><span class=\"line\">    if (startReg(env) &lt; 0) {</span><br><span class=\"line\">        ALOGE(&quot;Unable to register all android natives\\n&quot;);</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    /*</span><br><span class=\"line\">     * We want to call main() with a String array with arguments in it.</span><br><span class=\"line\">     * At present we have two arguments, the class name and an option string.</span><br><span class=\"line\">     * Create an array to hold them.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    jclass stringClass;</span><br><span class=\"line\">    jobjectArray strArray;</span><br><span class=\"line\">    jstring classNameStr;</span><br><span class=\"line\"> </span><br><span class=\"line\">    // 3. &#x62FC;&#x63A5;&#x53C2;&#x6570;&#xFF0C;&#x83B7;&#x53D6;ZygoteInit Class &#x4E0E; main&#x65B9;&#x6CD5;id</span><br><span class=\"line\">    // &#x83B7;&#x53D6; str = new String[options.size() + 1]</span><br><span class=\"line\">    stringClass = env-&gt;FindClass(&quot;java/lang/String&quot;);</span><br><span class=\"line\">    assert(stringClass != NULL);</span><br><span class=\"line\">    strArray = env-&gt;NewObjectArray(options.size() + 1, stringClass, NULL);</span><br><span class=\"line\">    assert(strArray != NULL);</span><br><span class=\"line\">     </span><br><span class=\"line\">    // &#x83B7;&#x53D6; str[0] = &quot;com.android.internal.os.ZygoteInit&quot;</span><br><span class=\"line\">    classNameStr = env-&gt;NewStringUTF(className);</span><br><span class=\"line\">    assert(classNameStr != NULL);</span><br><span class=\"line\">    env-&gt;SetObjectArrayElement(strArray, 0, classNameStr);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x83B7;&#x53D6; str[1] = &quot;start-system-server&quot;</span><br><span class=\"line\">    // &#x83B7;&#x53D6; str[2] = &quot;--abi-list=xxxx&quot;</span><br><span class=\"line\">    for (size_t i = 0; i &lt; options.size(); ++i) {</span><br><span class=\"line\">        jstring optionsStr = env-&gt;NewStringUTF(options.itemAt(i).string());</span><br><span class=\"line\">        assert(optionsStr != NULL);</span><br><span class=\"line\">        env-&gt;SetObjectArrayElement(strArray, i + 1, optionsStr);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    /*</span><br><span class=\"line\">     * Start VM.  This thread becomes the main thread of the VM, and will</span><br><span class=\"line\">     * not return until the VM exits.</span><br><span class=\"line\">     */</span><br><span class=\"line\">      </span><br><span class=\"line\">    // &#x83B7;&#x53D6; &quot;com/android/internal/os/ZygoteInit&quot;</span><br><span class=\"line\">    char* slashClassName = toSlashClassName(className != NULL ? className : &quot;&quot;);</span><br><span class=\"line\">    // &#x83B7;&#x53D6;ZygoteInit Class</span><br><span class=\"line\">    jclass startClass = env-&gt;FindClass(slashClassName);</span><br><span class=\"line\">    if (startClass == NULL) {</span><br><span class=\"line\">        ALOGE(&quot;JavaVM unable to locate class &apos;%s&apos;\\n&quot;, slashClassName);</span><br><span class=\"line\">        /* keep going */</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        // &#x83B7;&#x53D6; ZygoteInit&#x4E2D;&#x7684;main&#x65B9;&#x6CD5;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;id</span><br><span class=\"line\">        jmethodID startMeth = env-&gt;GetStaticMethodID(startClass, &quot;main&quot;,</span><br><span class=\"line\">            &quot;([Ljava/lang/String;)V&quot;);</span><br><span class=\"line\">        if (startMeth == NULL) {</span><br><span class=\"line\">            ALOGE(&quot;JavaVM unable to find main() in &apos;%s&apos;\\n&quot;, className);</span><br><span class=\"line\">            /* keep going */</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            // 4. &#x8C03;&#x7528; ZygoteInit.main()&#x65B9;&#x6CD5;</span><br><span class=\"line\">            env-&gt;CallStaticVoidMethod(startClass, startMeth, strArray);</span><br><span class=\"line\">#if 0</span><br><span class=\"line\">            if (env-&gt;ExceptionCheck())</span><br><span class=\"line\">                threadExitUncaughtException(env);</span><br><span class=\"line\">#endif</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    // &#x91CA;&#x653E;&#x5185;&#x5B58;&#x7A7A;&#x95F4;</span><br><span class=\"line\">    free(slashClassName);</span><br><span class=\"line\">    ALOGD(&quot;Shutting down VM\\n&quot;);</span><br><span class=\"line\">    if (mJavaVM-&gt;DetachCurrentThread() != JNI_OK)</span><br><span class=\"line\">        ALOGW(&quot;Warning: unable to detach main thread\\n&quot;);</span><br><span class=\"line\">    if (mJavaVM-&gt;DestroyJavaVM() != 0)</span><br><span class=\"line\">        ALOGW(&quot;Warning: VM did not shut down cleanly\\n&quot;);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6839;&#x636E;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x6CE8;&#x91CA;&#xFF0C;&#x5C0F;&#x61A9;&#x5C06;start()&#x65B9;&#x6CD5;&#x5206;&#x4E3A;&#x56DB;&#x6B65;&#xFF1A;</p>\n<ol>\n<li>&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</li>\n<li>&#x901A;&#x8FC7;JNI&#x6CE8;&#x518C;Android Native&#x65B9;&#x6CD5;</li>\n<li>&#x62FC;&#x63A5;&#x53C2;&#x6570;&#x3001;&#x83B7;&#x53D6;ZygoteInit Class&#x4E0E;&#x5176;&#x5BF9;&#x5E94;&#x7684;main&#x65B9;&#x6CD5;id</li>\n<li>&#x8C03;&#x7528;ZygoteInit.main()&#x65B9;&#x6CD5;&#xFF0C;&#x8FDB;&#x53BB;Java&#x5C42;</li>\n</ol>\n<h3 id=\"&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"><a href=\"#&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\" class=\"headerlink\" title=\"&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a>&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</h3><p>&#x901A;&#x8FC7;startVm()&#x6765;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int AndroidRuntime::startVm(JavaVM** pJavaVM, JNIEnv** pEnv, bool zygote, bool primary_zygote)</span><br><span class=\"line\">{</span><br><span class=\"line\">    JavaVMInitArgs initArgs;</span><br><span class=\"line\">    char propBuf[PROPERTY_VALUE_MAX];</span><br><span class=\"line\">    char jniOptsBuf[sizeof(&quot;-Xjniopts:&quot;)-1 + PROPERTY_VALUE_MAX];</span><br><span class=\"line\">    char heapstartsizeOptsBuf[sizeof(&quot;-Xms&quot;)-1 + PROPERTY_VALUE_MAX];</span><br><span class=\"line\">    char heapsizeOptsBuf[sizeof(&quot;-Xmx&quot;)-1 + PROPERTY_VALUE_MAX];</span><br><span class=\"line\">    char heapgrowthlimitOptsBuf[sizeof(&quot;-XX:HeapGrowthLimit=&quot;)-1 + PROPERTY_VALUE_MAX];</span><br><span class=\"line\">    char heapminfreeOptsBuf</span><br><span class=\"line\">    ....</span><br><span class=\"line\">     </span><br><span class=\"line\">        parseRuntimeOption(&quot;dalvik.vm.heapstartsize&quot;, heapstartsizeOptsBuf, &quot;-Xms&quot;, &quot;4m&quot;);</span><br><span class=\"line\">    parseRuntimeOption(&quot;dalvik.vm.heapsize&quot;, heapsizeOptsBuf, &quot;-Xmx&quot;, &quot;16m&quot;);</span><br><span class=\"line\">    parseRuntimeOption(&quot;dalvik.vm.heapgrowthlimit&quot;, heapgrowthlimitOptsBuf, &quot;-XX:HeapGrowthLimit=&quot;);</span><br><span class=\"line\">    parseRuntimeOption(&quot;dalvik.vm.heapminfree&quot;, heapminfreeOptsBuf, &quot;-XX:HeapMinFree=&quot;);</span><br><span class=\"line\">    parseRuntimeOption(&quot;dalvik.vm.heapmaxfree&quot;, heapmaxfreeOptsBuf, &quot;-XX:HeapMaxFree=&quot;);</span><br><span class=\"line\">    </span><br><span class=\"line\">    ....</span><br><span class=\"line\">    </span><br><span class=\"line\">    initArgs.version = JNI_VERSION_1_4;</span><br><span class=\"line\">    initArgs.options = mOptions.editArray();</span><br><span class=\"line\">    initArgs.nOptions = mOptions.size();</span><br><span class=\"line\">    initArgs.ignoreUnrecognized = JNI_FALSE;</span><br><span class=\"line\"> </span><br><span class=\"line\">    /*</span><br><span class=\"line\">     * Initialize the VM.</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * The JavaVM* is essentially per-process, and the JNIEnv* is per-thread.</span><br><span class=\"line\">     * If this call succeeds, the VM is ready, and we can start issuing</span><br><span class=\"line\">     * JNI calls.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    if (JNI_CreateJavaVM(pJavaVM, pEnv, &amp;initArgs) &lt; 0) {</span><br><span class=\"line\">        ALOGE(&quot;JNI_CreateJavaVM failed\\n&quot;);</span><br><span class=\"line\">        return -1;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    return 0;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8BE5;&#x65B9;&#x6CD5;&#x5F88;&#x957F;&#xFF0C;&#x4F46;&#x4E3B;&#x8981;&#x4EFB;&#x52A1;&#x5C31;&#x662F;&#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x76F8;&#x5173;&#x53C2;&#x6570;&#xFF0C;&#x5177;&#x4F53;&#x5404;&#x4E2A;&#x5C5E;&#x6027;&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x4E0D;&#x505A;&#x5206;&#x6790;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x81EA;&#x884C;google&#x5BF9;&#x5E94;&#x641C;&#x7D22;&#x3002;</p>\n<h3 id=\"JNI&#x65B9;&#x6CD5;&#x6CE8;&#x518C;\"><a href=\"#JNI&#x65B9;&#x6CD5;&#x6CE8;&#x518C;\" class=\"headerlink\" title=\"JNI&#x65B9;&#x6CD5;&#x6CE8;&#x518C;\"></a>JNI&#x65B9;&#x6CD5;&#x6CE8;&#x518C;</h3><p>&#x901A;&#x8FC7;startReg()&#x6765;&#x6CE8;&#x518C;Android Native&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int AndroidRuntime::startReg(JNIEnv* env)</span><br><span class=\"line\">{</span><br><span class=\"line\">    ATRACE_NAME(&quot;RegisterAndroidNatives&quot;);</span><br><span class=\"line\">    /*</span><br><span class=\"line\">     * This hook causes all future threads created in this process to be</span><br><span class=\"line\">     * attached to the JavaVM.  (This needs to go away in favor of JNI</span><br><span class=\"line\">     * Attach calls.)</span><br><span class=\"line\">     */</span><br><span class=\"line\">    androidSetCreateThreadFunc((android_create_thread_fn) javaCreateThreadEtc);</span><br><span class=\"line\">    ALOGV(&quot;--- registering native functions ---\\n&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    /*</span><br><span class=\"line\">     * Every &quot;register&quot; function calls one or more things that return</span><br><span class=\"line\">     * a local reference (e.g. FindClass).  Because we haven&apos;t really</span><br><span class=\"line\">     * started the VM yet, they&apos;re all getting stored in the base frame</span><br><span class=\"line\">     * and never released.  Use Push/Pop to manage the storage.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    env-&gt;PushLocalFrame(200);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x901A;&#x8FC7;JNI&#x6CE8;&#x518C;</span><br><span class=\"line\">    if (register_jni_procs(gRegJNI, NELEM(gRegJNI), env) &lt; 0) {</span><br><span class=\"line\">        env-&gt;PopLocalFrame(NULL);</span><br><span class=\"line\">        return -1;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    env-&gt;PopLocalFrame(NULL);</span><br><span class=\"line\"> </span><br><span class=\"line\">    //createJavaThread(&quot;fubar&quot;, quickTest, (void*) &quot;hello&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    return 0;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E3B;&#x8981;&#x90E8;&#x5206;&#x662F;&#x901A;&#x8FC7;register_jni_procs&#x6765;&#x6CE8;&#x518C;JNI&#x65B9;&#x6CD5;&#x3002;&#x5BF9;&#x5E94;&#x7684;&#x662F;gRegJNI</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static const RegJNIRec gRegJNI[] = {</span><br><span class=\"line\">        REG_JNI(register_com_android_internal_os_RuntimeInit),</span><br><span class=\"line\">        REG_JNI(register_com_android_internal_os_ZygoteInit_nativeZygoteInit),</span><br><span class=\"line\">        REG_JNI(register_android_os_SystemClock),</span><br><span class=\"line\">        REG_JNI(register_android_util_EventLog),</span><br><span class=\"line\">        REG_JNI(register_android_util_Log),</span><br><span class=\"line\">        REG_JNI(register_android_util_MemoryIntArray),</span><br><span class=\"line\">        ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x65B9;&#x6CD5;&#x5F88;&#x591A;&#x5C31;&#x4E0D;&#x4E00;&#x4E00;&#x5217;&#x4E3E;&#x51FA;&#x6765;&#x3002;</p>\n<p>&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">register_com_android_internal_os_ZygoteInit_nativeZygoteInit</span><br><span class=\"line\"> </span><br><span class=\"line\">int register_com_android_internal_os_ZygoteInit_nativeZygoteInit(JNIEnv* env)</span><br><span class=\"line\">{</span><br><span class=\"line\">    const JNINativeMethod methods[] = {</span><br><span class=\"line\">        { &quot;nativeZygoteInit&quot;, &quot;()V&quot;,</span><br><span class=\"line\">            (void*) com_android_internal_os_ZygoteInit_nativeZygoteInit },</span><br><span class=\"line\">    };</span><br><span class=\"line\">    return jniRegisterNativeMethods(env, &quot;com/android/internal/os/ZygoteInit&quot;,</span><br><span class=\"line\">        methods, NELEM(methods));</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;com/android/internal/os/ZygoteInit&#x4E2D;&#x7684;nativeZygoteInit()&#x65B9;&#x6CD5;&#xFF0C;&#x800C;nativeZygoteInit()&#x65B9;&#x6CD5;&#x901A;&#x8FC7;JNI&#x6CE8;&#x518C;&#x4E4B;&#x540E;&#xFF0C;&#x5728;Linux&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x662F;&#x5BF9;&#x5E94;&#x7684;com_android_internal_os_ZygoteInit_nativeZygoteInit()&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static void com_android_internal_os_ZygoteInit_nativeZygoteInit(JNIEnv* env, jobject clazz)</span><br><span class=\"line\">{</span><br><span class=\"line\">    gCurRuntime-&gt;onZygoteInit();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x5B83;&#x4F1A;&#x8C03;&#x7528;onZygoteInit()&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x5728;app_main.cpp&#x4E2D;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">virtual void onZygoteInit()</span><br><span class=\"line\">{</span><br><span class=\"line\">    sp&lt;ProcessState&gt; proc = ProcessState::self();</span><br><span class=\"line\">    ALOGV(&quot;App process: starting thread pool.\\n&quot;);</span><br><span class=\"line\">    proc-&gt;startThreadPool();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x53C2;&#x6570;&#x3001;&#x7C7B;&#x3001;&#x65B9;&#x6CD5;&#x6784;&#x5EFA;&#x4E0E;&#x8C03;&#x7528;\"><a href=\"#&#x53C2;&#x6570;&#x3001;&#x7C7B;&#x3001;&#x65B9;&#x6CD5;&#x6784;&#x5EFA;&#x4E0E;&#x8C03;&#x7528;\" class=\"headerlink\" title=\"&#x53C2;&#x6570;&#x3001;&#x7C7B;&#x3001;&#x65B9;&#x6CD5;&#x6784;&#x5EFA;&#x4E0E;&#x8C03;&#x7528;\"></a>&#x53C2;&#x6570;&#x3001;&#x7C7B;&#x3001;&#x65B9;&#x6CD5;&#x6784;&#x5EFA;&#x4E0E;&#x8C03;&#x7528;</h3><p>&#x5728;&#x8FD9;&#x4E00;&#x6B65;&#x4E3B;&#x8981;&#x901A;&#x8FC7;FindClass()&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;Java&#x7684;Class&#x7C7B;&#x578B;&#xFF0C;&#x6784;&#x5EFA;&#x5BF9;&#x5E94;&#x7684;String[]&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#x4E0E;ZygoteInit Class&#x3002;</p>\n<p>&#x518D;&#x901A;&#x8FC7;GetStaticMethodID()&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;main()&#x65B9;&#x6CD5;&#x7684;&#x65B9;&#x6CD5;id&#xFF0C;&#x4EE5;&#x4FBF;&#x4E3A;&#x4E4B;&#x540E;&#x8C03;&#x7528;ZygoteInit.main()&#x65B9;&#x6CD5;&#x505A;&#x51C6;&#x5907;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x5728;&#x901A;&#x8FC7;CallStaticVoidMethod()&#x6765;&#x8C03;&#x7528;ZygoteInit.main()&#x65B9;&#x6CD5;&#xFF0C;&#x6700;&#x7EC8;&#x8FDB;&#x5165;Java&#x5C42;&#x7684;ZygoteInit&#x3002;</p>\n<p>&#x4ECE;runtime.start()&#x5230;&#x8C03;&#x7528;Java&#x5C42;&#x7684;ZygoteInit.main()&#x7684;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x6D41;&#x7A0B;&#x56FE;&#x5982;&#x4E0B;&#xFF1A;</p>\n<p><img src=\"/2020/12/17/Android-Java-Zygote&#x542F;&#x52A8;/java_zygote.jpg\" alt></p>\n<h2 id=\"ZygoteInit\"><a href=\"#ZygoteInit\" class=\"headerlink\" title=\"ZygoteInit\"></a>ZygoteInit</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void main(String argv[]) {</span><br><span class=\"line\">    // &#x521B;&#x5EFA;zygoteServer</span><br><span class=\"line\">    ZygoteServer zygoteServer = new ZygoteServer();</span><br><span class=\"line\">     </span><br><span class=\"line\">    ZygoteHooks.startZygoteNoThreadCreation();</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x8BBE;&#x7F6E;zygote&#x81EA;&#x5DF1;&#x7684;&#x8FDB;&#x7A0B;group id</span><br><span class=\"line\">    try {</span><br><span class=\"line\">        Os.setpgid(0, 0);</span><br><span class=\"line\">    } catch (ErrnoException ex) {</span><br><span class=\"line\">        throw new RuntimeException(&quot;Failed to setpgid(0,0)&quot;, ex);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    final Runnable caller;</span><br><span class=\"line\">    try {</span><br><span class=\"line\">        // Report Zygote start time to tron unless it is a runtime restart</span><br><span class=\"line\">        if (!&quot;1&quot;.equals(SystemProperties.get(&quot;sys.boot_completed&quot;))) {</span><br><span class=\"line\">            MetricsLogger.histogram(null, &quot;boot_zygote_init&quot;,</span><br><span class=\"line\">                    (int) SystemClock.elapsedRealtime());</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        String bootTimeTag = Process.is64Bit() ? &quot;Zygote64Timing&quot; : &quot;Zygote32Timing&quot;;</span><br><span class=\"line\">        TimingsTraceLog bootTimingsTraceLog = new TimingsTraceLog(bootTimeTag,</span><br><span class=\"line\">                Trace.TRACE_TAG_DALVIK);</span><br><span class=\"line\">        bootTimingsTraceLog.traceBegin(&quot;ZygoteInit&quot;);</span><br><span class=\"line\">        RuntimeInit.enableDdms();</span><br><span class=\"line\"> </span><br><span class=\"line\">        // &#x89E3;&#x6790;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#x6765;&#x81EA;&#x4E8E;`Linux`&#x5C42;</span><br><span class=\"line\">        boolean startSystemServer = false;</span><br><span class=\"line\">        String socketName = &quot;zygote&quot;;</span><br><span class=\"line\">        String abiList = null;</span><br><span class=\"line\">        boolean enableLazyPreload = false;</span><br><span class=\"line\">        for (int i = 1; i &lt; argv.length; i++) {</span><br><span class=\"line\">            // &#x662F;&#x5426;&#x9700;&#x8981;&#x542F;&#x52A8;system_server&#x670D;&#x52A1;</span><br><span class=\"line\">            if (&quot;start-system-server&quot;.equals(argv[i])) {</span><br><span class=\"line\">                startSystemServer = true;</span><br><span class=\"line\">            } else if (&quot;--enable-lazy-preload&quot;.equals(argv[i])) {</span><br><span class=\"line\">                // &#x662F;&#x5426;&#x9700;&#x8981;&#x61D2;&#x52A0;&#x8F7D;</span><br><span class=\"line\">                enableLazyPreload = true;</span><br><span class=\"line\">            } else if (argv[i].startsWith(ABI_LIST_ARG)) {</span><br><span class=\"line\">                // &#x83B7;&#x53D6;abi_list</span><br><span class=\"line\">                abiList = argv[i].substring(ABI_LIST_ARG.length());</span><br><span class=\"line\">            } else if (argv[i].startsWith(SOCKET_NAME_ARG)) {</span><br><span class=\"line\">                // &#x83B7;&#x53D6;socket&#x540D;&#x79F0;</span><br><span class=\"line\">                socketName = argv[i].substring(SOCKET_NAME_ARG.length());</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                throw new RuntimeException(&quot;Unknown command line argument: &quot; + argv[i]);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        if (abiList == null) {</span><br><span class=\"line\">            throw new RuntimeException(&quot;No ABI list supplied.&quot;);</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        // &#x6CE8;&#x518C;zygote&#x7684;socket</span><br><span class=\"line\">        zygoteServer.registerServerSocketFromEnv(socketName);</span><br><span class=\"line\">        // In some configurations, we avoid preloading resources and classes eagerly.</span><br><span class=\"line\">        // In such cases, we will preload things prior to our first fork.</span><br><span class=\"line\">        if (!enableLazyPreload) {</span><br><span class=\"line\">            bootTimingsTraceLog.traceBegin(&quot;ZygotePreload&quot;);</span><br><span class=\"line\">            EventLog.writeEvent(LOG_BOOT_PROGRESS_PRELOAD_START,</span><br><span class=\"line\">                SystemClock.uptimeMillis());</span><br><span class=\"line\">            // &#x9884;&#x52A0;&#x8F7D;</span><br><span class=\"line\">            preload(bootTimingsTraceLog);</span><br><span class=\"line\">            EventLog.writeEvent(LOG_BOOT_PROGRESS_PRELOAD_END,</span><br><span class=\"line\">                SystemClock.uptimeMillis());</span><br><span class=\"line\">            bootTimingsTraceLog.traceEnd(); // ZygotePreload</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            Zygote.resetNicePriority();</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        // Do an initial gc to clean up after startup</span><br><span class=\"line\">        bootTimingsTraceLog.traceBegin(&quot;PostZygoteInitGC&quot;);</span><br><span class=\"line\">        // &#x89E6;&#x53D1;gc</span><br><span class=\"line\">        gcAndFinalize();</span><br><span class=\"line\">        bootTimingsTraceLog.traceEnd(); // PostZygoteInitGC</span><br><span class=\"line\"> </span><br><span class=\"line\">        bootTimingsTraceLog.traceEnd(); // ZygoteInit</span><br><span class=\"line\">        // Disable tracing so that forked processes do not inherit stale tracing tags from</span><br><span class=\"line\">        // Zygote.</span><br><span class=\"line\">        Trace.setTracingEnabled(false, 0);</span><br><span class=\"line\"> </span><br><span class=\"line\">        Zygote.nativeSecurityInit();</span><br><span class=\"line\"> </span><br><span class=\"line\">        // Zygote process unmounts root storage spaces.</span><br><span class=\"line\">        Zygote.nativeUnmountStorageOnInit();</span><br><span class=\"line\"> </span><br><span class=\"line\">        ZygoteHooks.stopZygoteNoThreadCreation();</span><br><span class=\"line\"> </span><br><span class=\"line\">        // &#x542F;&#x52A8; system_server</span><br><span class=\"line\">        if (startSystemServer) {</span><br><span class=\"line\">            Runnable r = forkSystemServer(abiList, socketName, zygoteServer);</span><br><span class=\"line\">            // {@code r == null} in the parent (zygote) process, and {@code r != null} in the</span><br><span class=\"line\">            // child (system_server) process.</span><br><span class=\"line\">            if (r != null) {</span><br><span class=\"line\">                r.run();</span><br><span class=\"line\">                return;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        Log.i(TAG, &quot;Accepting command socket connections&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        // &#x8FDB;&#x5165;&#x5FAA;&#x73AF;&#x6A21;&#x5F0F;</span><br><span class=\"line\">        caller = zygoteServer.runSelectLoop(abiList);</span><br><span class=\"line\">    } catch (Throwable ex) {</span><br><span class=\"line\">        Log.e(TAG, &quot;System zygote died with exception&quot;, ex);</span><br><span class=\"line\">        throw ex;</span><br><span class=\"line\">    } finally {</span><br><span class=\"line\">        zygoteServer.closeServerSocket();</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // We&apos;re in the child process and have exited the select loop. Proceed to execute the</span><br><span class=\"line\">    // command.</span><br><span class=\"line\">    if (caller != null) {</span><br><span class=\"line\">        caller.run();</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x7EC8;&#x4E8E;&#x89C1;&#x5230;Java&#x4EE3;&#x7801;&#x4E86;&#xFF0C;&#x4E0D;&#x5BB9;&#x6613;&#x554A;~</p>\n<p>&#x9996;&#x5148;&#x4F1A;&#x521B;&#x5EFA;zygoteServer&#xFF0C;&#x4E3A;Zygote&#x8BBE;&#x7F6E;&#x81EA;&#x5DF1;&#x7684;&#x8FDB;&#x7A0B;&#x5206;&#x7EC4;id&#xFF1B;&#x7136;&#x540E;&#x4F1A;&#x89E3;&#x6790;&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x6839;&#x636E;&#x53C2;&#x6570;&#x6267;&#x884C;&#x4E4B;&#x540E;&#x7684;&#x540E;&#x7EED;&#x64CD;&#x4F5C;&#x3002;</p>\n<h3 id=\"&#x6CE8;&#x518C;Socket\"><a href=\"#&#x6CE8;&#x518C;Socket\" class=\"headerlink\" title=\"&#x6CE8;&#x518C;Socket\"></a>&#x6CE8;&#x518C;Socket</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void registerServerSocketFromEnv(String socketName) {</span><br><span class=\"line\">    if (mServerSocket == null) {</span><br><span class=\"line\">        int fileDesc;</span><br><span class=\"line\">        final String fullSocketName = ANDROID_SOCKET_PREFIX + socketName;</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            String env = System.getenv(fullSocketName);</span><br><span class=\"line\">            fileDesc = Integer.parseInt(env);</span><br><span class=\"line\">        } catch (RuntimeException ex) {</span><br><span class=\"line\">            throw new RuntimeException(fullSocketName + &quot; unset or invalid&quot;, ex);</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        try {</span><br><span class=\"line\">            FileDescriptor fd = new FileDescriptor();</span><br><span class=\"line\">            fd.setInt$(fileDesc);</span><br><span class=\"line\">            mServerSocket = new LocalServerSocket(fd);</span><br><span class=\"line\">            mCloseSocketFd = true;</span><br><span class=\"line\">        } catch (IOException ex) {</span><br><span class=\"line\">            throw new RuntimeException(</span><br><span class=\"line\">                    &quot;Error binding to local socket &apos;&quot; + fileDesc + &quot;&apos;&quot;, ex);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;registerServerSocketFromEnv&#x6765;&#x6CE8;&#x518C;socket&#xFF0C;&#x4F7F;&#x7528;LocalServerSocket&#x521B;&#x5EFA;&#x672C;&#x5730;socket&#x670D;&#x52A1;&#xFF0C;&#x6765;&#x76D1;&#x542C;&#x5BF9;&#x4E8E;&#x7684;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;fd&#x3002;</p>\n<h3 id=\"&#x9884;&#x52A0;&#x8F7D;\"><a href=\"#&#x9884;&#x52A0;&#x8F7D;\" class=\"headerlink\" title=\"&#x9884;&#x52A0;&#x8F7D;\"></a>&#x9884;&#x52A0;&#x8F7D;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static void preload(TimingsTraceLog bootTimingsTraceLog) {</span><br><span class=\"line\">    // &#x9884;&#x52A0;&#x8F7D;&#x4F4D;&#x4E8E;/system/etc/preloaded-classes&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x7C7B;</span><br><span class=\"line\">    preloadClasses();</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x9884;&#x52A0;&#x8F7D;&#x8D44;&#x6E90;&#xFF0C;&#x4FDD;&#x5B58;drawable&#x4E0E;color</span><br><span class=\"line\">    preloadResources();</span><br><span class=\"line\">    </span><br><span class=\"line\">    // &#x9884;&#x52A0;&#x8F7D;OpenGL</span><br><span class=\"line\">    preloadOpenGL();</span><br><span class=\"line\">    </span><br><span class=\"line\">    // &#x9884;&#x52A0;&#x8F7D;&#x5171;&#x4EAB;&#x5E93;&#xFF0C;&#x5305;&#x62EC;android&#x3001;compiler_rt&#x3001;jnigraphics</span><br><span class=\"line\">    preloadSharedLibraries();</span><br><span class=\"line\">    </span><br><span class=\"line\">    // &#x9884;&#x52A0;&#x8F7D; &#x6587;&#x672C;&#x8FDE;&#x63A5;&#x7B26;&#x8D44;&#x6E90;</span><br><span class=\"line\">    preloadTextResources();</span><br><span class=\"line\">    </span><br><span class=\"line\">    // &#x4EC5;&#x7528;&#x4E8E;zygote&#x8FDB;&#x7A0B;&#xFF0C;&#x7528;&#x4E8E;&#x5185;&#x5B58;&#x5171;&#x4EAB;&#x7684;&#x8FDB;&#x7A0B;</span><br><span class=\"line\">    WebViewFactory.prepareWebViewInZygote();</span><br><span class=\"line\">    </span><br><span class=\"line\">    endIcuCachePinning();</span><br><span class=\"line\">    warmUpJcaProviders();</span><br><span class=\"line\"> </span><br><span class=\"line\">    sPreloadComplete = true;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x4E8E;&#x7C7B;&#x52A0;&#x8F7D;&#xFF0C;&#x91C7;&#x7528;&#x53CD;&#x5C04;&#x673A;&#x5236;Class.forName()&#x65B9;&#x6CD5;&#x6765;&#x52A0;&#x8F7D;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#xFF0C;&#x4E3B;&#x8981;&#x662F;com.android.internal.R.array.preloaded_drawables&#x548C;com.android.internal.R.array.preloaded_color_state_lists&#xFF0C;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x4EE5;com.android.internal.R.xxx&#x5F00;&#x5934;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x4FBF;&#x662F;&#x6B64;&#x65F6;&#x7531;Zygote&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x7684;&#x3002;</p>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x9884;&#x52A0;&#x8F7D;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x4E4B;&#x540E;fork&#x51FA;&#x5B50;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x540C;&#x65F6;&#x4F7F;&#x7528;copy on write&#x6280;&#x672F;&#xFF0C;&#x4F7F;&#x5F97;&#x5B50;&#x8FDB;&#x7A0B;&#x5728;&#x53EA;&#x8BFB;&#x6A21;&#x5F0F;&#x4E0B;&#x4E0E;&#x7236;&#x8FDB;&#x7A0B;&#x5171;&#x7528;&#x4E00;&#x5757;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#xFF0C;&#x4ECE;&#x800C;&#x4FDD;&#x8BC1;&#x5B50;&#x8FDB;&#x7A0B;&#x80FD;&#x591F;&#x8FC5;&#x901F;fork&#x5904;&#x7406;&#xFF0C;&#x51CF;&#x5C11;&#x6570;&#x636E;&#x7684;&#x62F7;&#x8D1D;&#x6570;&#x91CF;&#x3002;</p>\n<h3 id=\"SystemServer\"><a href=\"#SystemServer\" class=\"headerlink\" title=\"SystemServer\"></a>SystemServer</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (startSystemServer) {</span><br><span class=\"line\">    Runnable r = forkSystemServer(abiList, socketName, zygoteServer);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // {@code r == null} in the parent (zygote) process, and {@code r != null} in the</span><br><span class=\"line\">    // child (system_server) process.</span><br><span class=\"line\">    if (r != null) {</span><br><span class=\"line\">        r.run();</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x521B;&#x5EFA;system_server&#x670D;&#x52A1;&#xFF0C;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x540E;&#x7EED;&#x5230;system_server&#x7684;&#x65F6;&#x5019;&#x518D;&#x5206;&#x6790;&#x3002;</p>\n<h3 id=\"runSelectLoop\"><a href=\"#runSelectLoop\" class=\"headerlink\" title=\"runSelectLoop\"></a>runSelectLoop</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Runnable runSelectLoop(String abiList) {</span><br><span class=\"line\">    ArrayList&lt;FileDescriptor&gt; fds = new ArrayList&lt;FileDescriptor&gt;();</span><br><span class=\"line\">    ArrayList&lt;ZygoteConnection&gt; peers = new ArrayList&lt;ZygoteConnection&gt;();</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x4FDD;&#x5B58;fd</span><br><span class=\"line\">    fds.add(mServerSocket.getFileDescriptor());</span><br><span class=\"line\">    peers.add(null);</span><br><span class=\"line\"> </span><br><span class=\"line\">    while (true) {</span><br><span class=\"line\">        StructPollfd[] pollFds = new StructPollfd[fds.size()];</span><br><span class=\"line\">        for (int i = 0; i &lt; pollFds.length; ++i) {</span><br><span class=\"line\">            pollFds[i] = new StructPollfd();</span><br><span class=\"line\">            pollFds[i].fd = fds.get(i);</span><br><span class=\"line\">            pollFds[i].events = (short) POLLIN;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            // &#x8F6E;&#x8BE2;&#xFF0C;&#x5F53;pollFds&#x6709;&#x4E8B;&#x4EF6;&#x5230;&#x6765;&#x5219;&#x5F80;&#x4E0B;&#x6267;&#x884C;&#xFF0C;&#x5426;&#x5219;&#x963B;&#x585E;&#x5728;&#x8FD9;&#x91CC;</span><br><span class=\"line\">            Os.poll(pollFds, -1);</span><br><span class=\"line\">        } catch (ErrnoException ex) {</span><br><span class=\"line\">            throw new RuntimeException(&quot;poll failed&quot;, ex);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        for (int i = pollFds.length - 1; i &gt;= 0; --i) {</span><br><span class=\"line\">            // &#x91C7;&#x7528;I/O&#x591A;&#x8DEF;&#x590D;&#x7528;&#x673A;&#x5236;&#xFF0C;&#x5F53;&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x51FA;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42; &#x6216;&#x8005;&#x6570;&#x636E;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x5230;&#x6765;&#xFF0C;&#x5219;&#x5F80;&#x4E0B;&#x6267;&#x884C;</span><br><span class=\"line\">            // &#x5426;&#x5219;&#x8FDB;&#x5165;continue&#xFF0C;&#x8DF3;&#x51FA;&#x672C;&#x6B21;&#x5FAA;&#x73AF;</span><br><span class=\"line\">            if ((pollFds[i].revents &amp; POLLIN) == 0) {</span><br><span class=\"line\">                continue;</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            if (i == 0) {</span><br><span class=\"line\">                // &#x5373;fds[0]&#xFF0C;&#x4EE3;&#x8868;&#x7684;&#x662F;sServerSocket&#xFF0C;&#x5219;&#x610F;&#x5473;&#x7740;&#x6709;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;</span><br><span class=\"line\">                // &#x5219;&#x521B;&#x5EFA;ZygoteConnection&#x5BF9;&#x8C61;,&#x5E76;&#x6DFB;&#x52A0;&#x5230;fds</span><br><span class=\"line\">                ZygoteConnection newPeer = acceptCommandPeer(abiList);</span><br><span class=\"line\">                peers.add(newPeer);</span><br><span class=\"line\">                fds.add(newPeer.getFileDesciptor());</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                // i&gt;0&#xFF0C;&#x5219;&#x4EE3;&#x8868;&#x901A;&#x8FC7;socket&#x63A5;&#x6536;&#x6765;&#x81EA;&#x5BF9;&#x7AEF;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x6267;&#x884C;&#x76F8;&#x5E94;&#x64CD;&#x4F5C;</span><br><span class=\"line\">                try {</span><br><span class=\"line\">                    // &#x83B7;&#x53D6;&#x94FE;&#x63A5;</span><br><span class=\"line\">                    ZygoteConnection connection = peers.get(i);</span><br><span class=\"line\">                    // &#x6267;&#x884C;&#x64CD;&#x4F5C;</span><br><span class=\"line\">                    final Runnable command = connection.processOneCommand(this);</span><br><span class=\"line\">                    if (mIsForkChild) {</span><br><span class=\"line\">                        if (command == null) {</span><br><span class=\"line\">                            throw new IllegalStateException(&quot;command == null&quot;);</span><br><span class=\"line\">                        }</span><br><span class=\"line\"> </span><br><span class=\"line\">                        return command;</span><br><span class=\"line\">                    } else {</span><br><span class=\"line\">                        if (command != null) {</span><br><span class=\"line\">                            throw new IllegalStateException(&quot;command != null&quot;);</span><br><span class=\"line\">                        }</span><br><span class=\"line\"> </span><br><span class=\"line\">                        if (connection.isClosedByPeer()) {</span><br><span class=\"line\">                            connection.closeSocket();</span><br><span class=\"line\">                            peers.remove(i);</span><br><span class=\"line\">                            fds.remove(i);</span><br><span class=\"line\">                        }</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                } catch (Exception e) {</span><br><span class=\"line\">                    if (!mIsForkChild) {</span><br><span class=\"line\"> </span><br><span class=\"line\">                        Slog.e(TAG, &quot;Exception executing zygote command: &quot;, e);</span><br><span class=\"line\"> </span><br><span class=\"line\">                        ZygoteConnection conn = peers.remove(i);</span><br><span class=\"line\">                        conn.closeSocket();</span><br><span class=\"line\"> </span><br><span class=\"line\">                        fds.remove(i);</span><br><span class=\"line\">                    } else {</span><br><span class=\"line\">                        Log.e(TAG, &quot;Caught post-fork exception in child process.&quot;, e);</span><br><span class=\"line\">                        throw e;</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                } finally {</span><br><span class=\"line\">                    mIsForkChild = false;</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>Zygote&#x91C7;&#x7528;&#x9AD8;&#x6548;&#x7684;I/O&#x591A;&#x8DEF;&#x590D;&#x7528;&#x673A;&#x5236;&#xFF0C;&#x4FDD;&#x8BC1;&#x5728;&#x6CA1;&#x6709;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x6216;&#x6570;&#x636E;&#x5904;&#x7406;&#x65F6;&#x4F11;&#x7720;&#xFF0C;&#x5426;&#x5219;&#x54CD;&#x5E94;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;&#x3002;</p>\n<h3 id=\"processOneCommand\"><a href=\"#processOneCommand\" class=\"headerlink\" title=\"processOneCommand\"></a>processOneCommand</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Runnable processOneCommand(ZygoteServer zygoteServer) {</span><br><span class=\"line\">    String args[];</span><br><span class=\"line\">    Arguments parsedArgs = null;</span><br><span class=\"line\">    FileDescriptor[] descriptors;</span><br><span class=\"line\"> </span><br><span class=\"line\">    try {</span><br><span class=\"line\">        // &#x8BFB;&#x53D6;&#x53C2;&#x6570;</span><br><span class=\"line\">        args = readArgumentList();</span><br><span class=\"line\">        descriptors = mSocket.getAncillaryFileDescriptors();</span><br><span class=\"line\">    } catch (IOException ex) {</span><br><span class=\"line\">        throw new IllegalStateException(&quot;IOException on command socket&quot;, ex);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // readArgumentList returns null only when it has reached EOF with no available</span><br><span class=\"line\">    // data to read. This will only happen when the remote socket has disconnected.</span><br><span class=\"line\">    if (args == null) {</span><br><span class=\"line\">        isEof = true;</span><br><span class=\"line\">        return null;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    int pid = -1;</span><br><span class=\"line\">    FileDescriptor childPipeFd = null;</span><br><span class=\"line\">    FileDescriptor serverPipeFd = null;</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x89E3;&#x6790;&#x53C2;&#x6570;&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x8F6C;&#x6362;</span><br><span class=\"line\">    parsedArgs = new Arguments(args);</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    fd = zygoteServer.getServerSocketFileDescriptor();</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (fd != null) {</span><br><span class=\"line\">        fdsToClose[1] = fd.getInt$();</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    fd = null;</span><br><span class=\"line\"> </span><br><span class=\"line\">    pid = Zygote.forkAndSpecialize(parsedArgs.uid, parsedArgs.gid, parsedArgs.gids,</span><br><span class=\"line\">            parsedArgs.runtimeFlags, rlimits, parsedArgs.mountExternal, parsedArgs.seInfo,</span><br><span class=\"line\">            parsedArgs.niceName, fdsToClose, fdsToIgnore, parsedArgs.startChildZygote,</span><br><span class=\"line\">            parsedArgs.instructionSet, parsedArgs.appDataDir);</span><br><span class=\"line\">  </span><br><span class=\"line\">    try {</span><br><span class=\"line\">        if (pid == 0) {</span><br><span class=\"line\">            // &#x5B50;&#x8FDB;&#x7A0B;&#x6267;&#x884C;</span><br><span class=\"line\">            zygoteServer.setForkChild();</span><br><span class=\"line\"> </span><br><span class=\"line\">            zygoteServer.closeServerSocket();</span><br><span class=\"line\">            IoUtils.closeQuietly(serverPipeFd);</span><br><span class=\"line\">            serverPipeFd = null;</span><br><span class=\"line\"> </span><br><span class=\"line\">            return handleChildProc(parsedArgs, descriptors, childPipeFd,</span><br><span class=\"line\">                    parsedArgs.startChildZygote);</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            // &#x7236;&#x8FDB;&#x7A0B;&#x6267;&#x884C;</span><br><span class=\"line\">            IoUtils.closeQuietly(childPipeFd);</span><br><span class=\"line\">            childPipeFd = null;</span><br><span class=\"line\">            handleParentProc(pid, descriptors, serverPipeFd);</span><br><span class=\"line\">            return null;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    } finally {</span><br><span class=\"line\">        IoUtils.closeQuietly(childPipeFd);</span><br><span class=\"line\">        IoUtils.closeQuietly(serverPipeFd);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;fork&#x65B9;&#x6CD5;&#x6765;&#x521B;&#x5EFA;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x8FD4;&#x56DE;&#x4E24;&#x6B21;&#x7ED3;&#x679C;&#xFF1B;&#x5982;&#x679C;&#x4E3A;0&#x5219;&#x4EE3;&#x8868;&#x5F53;&#x524D;&#x9700;&#x8981;&#x6267;&#x884C;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x76F8;&#x5173;&#x903B;&#x8F91;&#xFF0C;&#x975E;0&#x5219;&#x662F;&#x7236;&#x8FDB;&#x7A0B;&#x7684;&#x903B;&#x8F91;&#x3002;</p>\n<p>&#x81F3;&#x6B64;Zygote&#x7684;&#x542F;&#x52A8;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x5728;Java&#x5C42;Zygote&#x4E3B;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x4E3A;:</p>\n<ol>\n<li>&#x901A;&#x8FC7;registerServerSocketFromEnv&#x6765;&#x6CE8;&#x518C;socket</li>\n<li>&#x901A;&#x8FC7;preload&#x9884;&#x52A0;&#x8F7D;&#x7C7B;&#x3001;drawable&#x4E0E;color&#x8D44;&#x6E90;&#x3001;openGL&#x3001;&#x5171;&#x4EAB;&#x5E93;&#x4E0E;WebView&#x76F8;&#x5173;&#x8D44;&#x6E90;</li>\n<li>&#x521B;&#x5EFA;system_server&#x670D;&#x52A1;</li>\n<li>runSelectLoop&#x7B49;&#x5F85;&#x65B0;&#x6D88;&#x606F;&#x7684;&#x5230;&#x6765;&#xFF0C;&#x5E76;&#x521B;&#x5EFA;&#x65B0;&#x8FDB;&#x7A0B;</li>\n</ol>\n<p>Zygote&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x6B65;&#x9AA4;&#xFF1A;&#x542F;&#x52A8;system_server&#x540E;&#x7EED;&#x518D;&#x8FDB;&#x884C;&#x5206;&#x6790;&#xFF0C;&#x656C;&#x8BF7;&#x671F;&#x5F85;&#xFF01;</p>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["启动"]},{"title":"Android Linux Zygote启动","url":"https://www.rousetime.com/2020/12/10/Android-Linux-Zygote启动/","content":"<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484889&amp;idx=1&amp;sn=b39c8bc0a9925464022b77a341263cf0&amp;chksm=e8e0fc49df97755f598ef0082409c573d7715ce33bb27b1c98194410d487ae69adbeb2293d84&amp;token=1353481402&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android init &#x542F;&#x52A8;</a></p>\n<p>Android&#x542F;&#x52A8;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x662F;&#x7531;Linux Kernel&#x542F;&#x52A8;&#x7684;init&#x8FDB;&#x7A0B;&#x3002;&#x5728;init&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x4F1A;&#x901A;&#x8FC7;&#x89E3;&#x6790;init.rc&#x6587;&#x4EF6;&#x6765;&#x542F;&#x52A8;zygote&#x8FDB;&#x7A0B;&#x3002;</p>\n<p>zygote&#x8FDB;&#x7A0B;&#x662F;Android&#x6240;&#x5728;Java&#x5C42;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x4E00;&#x8D77;&#x6765;&#x770B;&#x4E00;&#x4E0B;zygote&#x7684;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x3002;</p>\n<h2 id=\"rc&#x6587;&#x4EF6;&#x8BED;&#x6CD5;\"><a href=\"#rc&#x6587;&#x4EF6;&#x8BED;&#x6CD5;\" class=\"headerlink\" title=\".rc&#x6587;&#x4EF6;&#x8BED;&#x6CD5;\"></a>.rc&#x6587;&#x4EF6;&#x8BED;&#x6CD5;</h2><p>&#x5982;&#x679C;&#x4F60;&#x76F4;&#x63A5;&#x6253;&#x5F00;init.rc&#x6587;&#x4EF6;&#x770B;&#x5B83;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x4F60;&#x5927;&#x6982;&#x7387;&#x4F1A;&#x4E00;&#x8138;&#x61F5;&#x903C;&#x3002;&#x56E0;&#x4E3A;&#x5B83;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x5957;&#x72EC;&#x6709;&#x7684;&#x8BED;&#x6CD5;&#x3002;</p>\n<p>&#x9996;&#x5148;&#x6765;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;.rc&#x8BED;&#x6CD5;&#x3002;&#x5B83;&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7684;&#x662F;Android Init Language&#xFF0C;&#x4FD7;&#x79F0;Android&#x521D;&#x59CB;&#x5316;&#x8BED;&#x8A00;&#x3002;</p>\n<p>&#x5728;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x5176;&#x5B9E;&#x5DF2;&#x7ECF;&#x63D0;&#x53CA;&#x8FC7;&#xFF0C;&#x5B83;&#x7684;&#x8BED;&#x6CD5;&#x4E3B;&#x8981;&#x5206;&#x4E3A;&#x4E94;&#x7C7B;&#xFF0C;&#x5206;&#x522B;&#x4E3A;&#xFF1A;Actions&#x3001;Commands&#x3001;Services&#x3001; Options&#x4E0E;Imports&#x3002;</p>\n<h3 id=\"Actions\"><a href=\"#Actions\" class=\"headerlink\" title=\"Actions\"></a>Actions</h3><p>Actions&#x79F0;&#x4E3A;&#x547D;&#x4EE4;&#x5E8F;&#x5217;&#x3002;</p>\n<p>&#x5B83;&#x7ED3;&#x5408;trigger&#x89E6;&#x53D1;&#x5668;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x3002;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x786E;&#x5B9A;&#x8BE5;Actions&#x4F5C;&#x7528;&#x7684;&#x65F6;&#x673A;&#xFF0C;&#x5F53;&#x53D1;&#x751F;&#x65F6;&#x673A;&#x4E0E;&#x67D0;&#x4E2A;Actions&#x7684;trigger&#x76F8;&#x5339;&#x914D;&#x65F6;&#xFF0C;&#x8FD9;&#x4E2A;Actions&#x5C06;&#x4F1A;&#x6DFB;&#x52A0;&#x5230;&#x6267;&#x884C;&#x7684;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;Actions&#x90FD;&#x6309;&#x987A;&#x5E8F;&#x51FA;&#x961F;&#xFF0C;&#x5E76;&#x4E14;&#x8BE5;Actions&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x547D;&#x4EE4;&#x90FD;&#x6309;&#x987A;&#x5E8F;&#x6267;&#x884C;&#x3002;</p>\n<p>Actions&#x7684;&#x683C;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">on &lt;trigger&gt; [&amp;&amp; &lt;trigger&gt;]*</span><br><span class=\"line\">   &lt;command&gt;</span><br><span class=\"line\">   &lt;command&gt;</span><br><span class=\"line\">   &lt;command&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x4EE5;on&#x5F00;&#x5934;&#xFF0C;&#x914D;&#x5408;&#x5BF9;&#x5E94;&#x7684;trigger&#xFF0C;&#x4E00;&#x65E6;trigger&#x89E6;&#x53D1;&#xFF0C;&#x5C06;&#x4F1A;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;command&#x3002;</p>\n<p>trigger&#x4E3B;&#x8981;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;&#x7C7B;&#x578B;&#xFF1A;</p>\n<ol>\n<li>early-init: &#x5728;&#x521D;&#x59CB;&#x5316;&#x65E9;&#x671F;&#x9636;&#x6BB5;&#x89E6;&#x53D1;</li>\n<li>init: &#x5728;&#x521D;&#x59CB;&#x5316;&#x9636;&#x6BB5;&#x89E6;&#x53D1;</li>\n<li>late-init: &#x5728;&#x521D;&#x59CB;&#x5316;&#x665A;&#x671F;&#x9636;&#x6BB5;&#x89E6;&#x53D1;</li>\n<li>boot/charger: &#x5F53;&#x7CFB;&#x7EDF;&#x542F;&#x52A8;/&#x5145;&#x7535;&#x65F6;&#x89E6;&#x53D1;&#xFF0C;&#x8FD8;&#x5305;&#x542B;&#x5176;&#x4ED6;&#x60C5;&#x51B5;&#xFF0C;&#x6B64;&#x5904;&#x4E0D;&#x4E00;&#x4E00;&#x5217;&#x4E3E;</li>\n<li>property:<key>=<value>: &#x5F53;&#x5C5E;&#x6027;&#x503C;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x65F6;&#x89E6;&#x53D1;</value></key></li>\n</ol>\n<p>&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">on boot</span><br><span class=\"line\">   setprop a 1</span><br><span class=\"line\">   setprop b 2</span><br><span class=\"line\"> </span><br><span class=\"line\">on boot &amp;&amp; property:true=true</span><br><span class=\"line\">   setprop c 1</span><br><span class=\"line\">   setprop d 2</span><br><span class=\"line\"> </span><br><span class=\"line\">on boot</span><br><span class=\"line\">   setprop e 1</span><br><span class=\"line\">   setprop f 2</span><br></pre></td></tr></table></figure>\n<p>&#x5F53;boot&#x89E6;&#x53D1;&#x5E76;&#x5047;&#x8BBE;&#x5C5E;&#x6027;true&#x7B49;&#x4E8E;true&#x65F6;&#xFF0C;&#x5C06;&#x89E6;&#x53D1;&#x4E0A;&#x9762;&#x7684;Actions, &#x6267;&#x884C;&#x7684;&#x547D;&#x4EE4;&#x987A;&#x5E8F;&#x4E3A;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setprop a 1</span><br><span class=\"line\">setprop b 2</span><br><span class=\"line\">setprop c 1</span><br><span class=\"line\">setprop d 2</span><br><span class=\"line\">setprop e 1</span><br><span class=\"line\">setprop f 2</span><br></pre></td></tr></table></figure>\n<h3 id=\"Commands\"><a href=\"#Commands\" class=\"headerlink\" title=\"Commands\"></a>Commands</h3><p>Commands&#x4FD7;&#x79F0;&#x6307;&#x4EE4;&#x3002;</p>\n<p>&#x5C31;&#x662F;Linux&#x9700;&#x8981;&#x6267;&#x884C;&#x7684;&#x5177;&#x4F53;&#x5185;&#x5BB9;&#x3002;</p>\n<p>Commands&#x5305;&#x542B;&#x7684;&#x6307;&#x4EE4;&#x8FD8;&#x662F;&#x5F88;&#x591A;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x5217;&#x4E3E;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x7684;&#x6307;&#x4EE4;&#x3002;</p>\n<ol>\n<li>class_start &lt;service_class_name&gt;&#xFF1A; &#x542F;&#x52A8;&#x5C5E;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;class&#x7684;&#x6240;&#x6709;&#x670D;&#x52A1;</li>\n<li>start &lt;service_name&gt;&#xFF1A; &#x542F;&#x52A8;&#x6307;&#x5B9A;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x82E5;&#x5DF2;&#x542F;&#x52A8;&#x5219;&#x8DF3;&#x8FC7;</li>\n<li>stop &lt;service_name&gt;&#xFF1A; &#x505C;&#x6B62;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x670D;&#x52A1;</li>\n<li>setprop <name> <value>&#xFF1A;&#x8BBE;&#x7F6E;&#x5C5E;&#x6027;&#x503C;</value></name></li>\n<li>mkdir <path></path>&#xFF1A;&#x521B;&#x5EFA;&#x6307;&#x5B9A;&#x76EE;&#x5F55;</li>\n<li>symlink <target> &lt;sym_link&gt;&#xFF1A; &#x521B;&#x5EFA;&#x8FDE;&#x63A5;&#x5230;<target>&#x7684;&lt;sym_link&gt;&#x7B26;&#x53F7;&#x94FE;&#x63A5;</target></target></li>\n<li>write <path></path> <string>&#xFF1A; &#x5411;&#x6587;&#x4EF6;path&#x4E2D;&#x5199;&#x5165;&#x5B57;&#x7B26;&#x4E32;</string></li>\n<li>exec&#xFF1A; fork&#x5E76;&#x6267;&#x884C;&#xFF0C;&#x4F1A;&#x963B;&#x585E;init&#x8FDB;&#x7A0B;&#x76F4;&#x5230;&#x7A0B;&#x5E8F;&#x5B8C;&#x6BD5;</li>\n<li>exprot <name> <name>&#xFF1A;&#x8BBE;&#x5B9A;&#x73AF;&#x5883;&#x53D8;&#x91CF;</name></name></li>\n<li>loglevel <level>&#xFF1A;&#x8BBE;&#x7F6E;log&#x7EA7;&#x522B;</level></li>\n</ol>\n<p>&#x8FD9;&#x4E2A;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x9047;&#x5230;&#x5C31;&#x76F4;&#x63A5;&#x5BF9;&#x7167;&#x67E5;&#x770B;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x4F8B;&#x5982;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684;setprop&#xFF0C;&#x5B83;&#x5C31;&#x662F;&#x7528;&#x6765;&#x5BF9;&#x5C5E;&#x6027;&#x8D4B;&#x503C;&#x7684;&#x3002;</p>\n<h3 id=\"Services\"><a href=\"#Services\" class=\"headerlink\" title=\"Services\"></a>Services</h3><p>Services&#x4FD7;&#x79F0;&#x670D;&#x52A1;&#x3002;</p>\n<p>&#x5B83;&#x7531;init&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#xFF0C;&#x4E00;&#x822C;&#x8FD0;&#x884C;&#x5728;init&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x4E2D;&#xFF0C;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x65F6;&#x9996;&#x5148;&#x4F1A;&#x5224;&#x65AD;&#x8BE5;&#x670D;&#x52A1;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x5B9A;&#x4E49;&#x5728;.rc&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x4F1A;&#x901A;&#x8FC7;init&#x8FDB;&#x7A0B;fork&#x51FA;&#x5B50;&#x8FDB;&#x7A0B;&#x6765;&#x542F;&#x52A8;&#x5BF9;&#x5E94;&#x7684;Service&#x3002;</p>\n<p>&#x5177;&#x4F53;&#x7684;&#x5B9A;&#x4E49;&#x683C;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service &lt;name&gt; &lt;pathname&gt; [ &lt;argument&gt; ]*</span><br><span class=\"line\">   &lt;option&gt;</span><br><span class=\"line\">   &lt;option&gt;</span><br><span class=\"line\">   ...</span><br></pre></td></tr></table></figure>\n<p>&#x4F8B;&#x5982;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service servicemanager /system/bin/servicemanager</span><br></pre></td></tr></table></figure>\n<p>&#x4EE3;&#x8868;&#x7684;&#x610F;&#x4E49;&#x662F;&#xFF1A;&#x8BE5;&#x670D;&#x52A1;&#x7684;&#x540D;&#x79F0;&#x662F;servicemanager&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x6267;&#x884C;&#x8DEF;&#x5F84;&#x4E3A;/system/bin/servicemanager&#x3002;</p>\n<h3 id=\"Options\"><a href=\"#Options\" class=\"headerlink\" title=\"Options\"></a>Options</h3><p>Options&#x4FD7;&#x79F0;&#x53EF;&#x9009;&#x9879;&#x3002;</p>\n<p>&#x5B83;&#x90FD;&#x4F5C;&#x7528;&#x4E8E;Services&#xFF0C;&#x6539;&#x53D8;&#x670D;&#x52A1;&#x7684;&#x8FD0;&#x884C;&#x65B9;&#x5F0F;&#x4E0E;&#x5BF9;&#x5E94;&#x7684;&#x65F6;&#x95F4;&#x7B49;&#x3002;</p>\n<p>&#x5B83;&#x7684;&#x5185;&#x5BB9;&#x4E0E;Commands&#x4E00;&#x6837;&#x6709;&#x5F88;&#x591A;&#xFF0C;&#x8FD9;&#x91CC;&#x5217;&#x4E3E;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x7684;&#xFF0C;&#x9047;&#x5230;&#x76F4;&#x63A5;&#x67E5;&#x770B;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p>\n<ol>\n<li>disabled: &#x4E0D;&#x968F;class&#x81EA;&#x52A8;&#x542F;&#x52A8;&#xFF0C;&#x53EA;&#x6709;&#x6839;&#x636E;service&#x540D;&#x624D;&#x542F;&#x52A8;</li>\n<li>oneshot: service&#x9000;&#x51FA;&#x540E;&#x4E0D;&#x518D;&#x91CD;&#x542F;</li>\n<li>user/group&#xFF1A; &#x8BBE;&#x7F6E;&#x6267;&#x884C;&#x670D;&#x52A1;&#x7684;&#x7528;&#x6237;/&#x7528;&#x6237;&#x7EC4;&#xFF0C;&#x9ED8;&#x8BA4;&#x90FD;&#x662F;root</li>\n<li>class&#xFF1A;&#x8BBE;&#x7F6E;&#x6240;&#x5C5E;&#x7684;&#x7C7B;&#x540D;&#xFF0C;&#x5F53;&#x6240;&#x5C5E;&#x7C7B;&#x542F;&#x52A8;/&#x9000;&#x51FA;&#x65F6;&#xFF0C;&#x670D;&#x52A1;&#x4E5F;&#x542F;&#x52A8;/&#x505C;&#x6B62;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;default</li>\n<li>onrestart:&#x5F53;&#x670D;&#x52A1;&#x91CD;&#x542F;&#x65F6;&#x6267;&#x884C;&#x76F8;&#x5E94;&#x547D;&#x4EE4;</li>\n<li>socket: &#x521B;&#x5EFA;&#x540D;&#x4E3A;/dev/socket/<name>&#x7684;socket</name></li>\n<li>critical: &#x5728;&#x89C4;&#x5B9A;&#x65F6;&#x95F4;&#x5185;&#x8BE5;service&#x4E0D;&#x65AD;&#x91CD;&#x542F;&#xFF0C;&#x5219;&#x7CFB;&#x7EDF;&#x4F1A;&#x91CD;&#x542F;&#x5E76;&#x8FDB;&#x5165;&#x6062;&#x590D;&#x6A21;&#x5F0F;</li>\n</ol>\n<blockquote>\n<p>default: &#x610F;&#x5473;&#x7740;disabled=false&#xFF0C;oneshot=false&#xFF0C;critical=false</p>\n</blockquote>\n<h3 id=\"Imports\"><a href=\"#Imports\" class=\"headerlink\" title=\"Imports\"></a>Imports</h3><p>Imports&#x4FD7;&#x79F0;&#x5BFC;&#x5165;&#x3002;</p>\n<p>&#x7528;&#x9014;&#x662F;&#x7528;&#x6765;&#x5BFC;&#x5165;&#x5BF9;&#x5E94;&#x7684;.rc&#x6587;&#x4EF6;&#x3002;</p>\n<p>&#x5177;&#x4F53;&#x683C;&#x5F0F;&#x4E3A;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &lt;path&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x4F8B;&#x5982;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import /init.environ.rc</span><br><span class=\"line\">import /init.usb.rc</span><br><span class=\"line\">import /init.${ro.hardware}.rc</span><br></pre></td></tr></table></figure>\n<h2 id=\"Zygote\"><a href=\"#Zygote\" class=\"headerlink\" title=\"Zygote\"></a>Zygote</h2><p>&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x5BF9;.rc&#x8BED;&#x6CD5;&#x6709;&#x4E86;&#x4E00;&#x4E2A;&#x521D;&#x6B65;&#x7684;&#x4E86;&#x89E3;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;init.rc&#x7684;&#x6E90;&#x6587;&#x4EF6;&#xFF0C;&#x6765;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x5B83;&#x662F;&#x5982;&#x4F55;&#x542F;&#x52A8;Zygote&#x8FDB;&#x7A0B;&#x7684;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">on early-init</span><br><span class=\"line\">    # Set init and its forked children&apos;s oom_adj.</span><br><span class=\"line\">    write /proc/1/oom_score_adj -1000</span><br><span class=\"line\"> </span><br><span class=\"line\">    # Apply strict SELinux checking of PROT_EXEC on mmap/mprotect calls.</span><br><span class=\"line\">    write /sys/fs/selinux/checkreqprot 0</span><br><span class=\"line\"> </span><br><span class=\"line\">    # Set the security context for the init process.</span><br><span class=\"line\">    # This should occur before anything else (e.g. ueventd) is started.</span><br><span class=\"line\">    setcon u:r:init:s0</span><br><span class=\"line\"> </span><br><span class=\"line\">    # Set the security context of /adb_keys if present.</span><br><span class=\"line\">    restorecon /adb_keys</span><br><span class=\"line\"> </span><br><span class=\"line\">    start ueventd</span><br><span class=\"line\"> </span><br><span class=\"line\">    # create mountpoints</span><br><span class=\"line\">    mkdir /mnt 0775 root system</span><br><span class=\"line\"> </span><br><span class=\"line\">on init</span><br><span class=\"line\">    sysclktz 0</span><br><span class=\"line\"> </span><br><span class=\"line\">    loglevel 3</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">on late-init</span><br><span class=\"line\">   ...</span><br><span class=\"line\">   ...</span><br><span class=\"line\"> </span><br><span class=\"line\">on post-fs //&#x6302;&#x8F7D;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</span><br><span class=\"line\">    </span><br><span class=\"line\">   ...</span><br><span class=\"line\">   ...</span><br><span class=\"line\"> </span><br><span class=\"line\">on post-fs-data //&#x6302;&#x8F7D;data</span><br><span class=\"line\">   ...</span><br><span class=\"line\">   ...</span><br><span class=\"line\"> </span><br><span class=\"line\">on boot //&#x542F;&#x52A8;&#x6838;&#x5FC3;&#x670D;&#x52A1;</span><br><span class=\"line\">   ...</span><br><span class=\"line\">   ...</span><br><span class=\"line\"> </span><br><span class=\"line\">   class_start very-first</span><br><span class=\"line\"> </span><br><span class=\"line\">on property:androVM.inited=1</span><br><span class=\"line\">    class_start core</span><br><span class=\"line\">    class_start main</span><br><span class=\"line\"> </span><br><span class=\"line\">on property:genymotion.local_opengl.started=1</span><br><span class=\"line\">    start surfaceflinger</span><br><span class=\"line\"> </span><br><span class=\"line\">on nonencrypted</span><br><span class=\"line\">    class_start main</span><br><span class=\"line\">    class_start late_start</span><br></pre></td></tr></table></figure>\n<p>&#x4EE5;&#x4E0A;&#x662F;&#x5404;&#x4E2A;&#x89E6;&#x53D1;&#x5668;&#x7684;&#x6267;&#x884C;&#x987A;&#x5E8F;&#x3002;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x4F1A;&#x6267;&#x884C;class_start&#x6765;&#x542F;&#x52A8;&#x540D;&#x79F0;&#x4E3A;main&#x7684;&#x7C7B;&#xFF0C;&#x5E76;&#x542F;&#x52A8;&#x5B83;&#x5173;&#x8054;&#x7684;service&#x3002;</p>\n<p>&#x5176;&#x4E2D;class_start&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;builtins.cpp&#x4E2D;&#x7684;do_class_start&#x3002;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x662F;&#x7531;BuiltinFunctionMap&#x7EF4;&#x62A4;&#x7684;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const BuiltinFunctionMap&amp; GetBuiltinFunctionMap() {</span><br><span class=\"line\">    constexpr std::size_t kMax = std::numeric_limits&lt;std::size_t&gt;::max();</span><br><span class=\"line\">    // clang-format off</span><br><span class=\"line\">    static const BuiltinFunctionMap builtin_functions = {</span><br><span class=\"line\">        {&quot;bootchart&quot;,               {1,     1,    {false,  do_bootchart}}},</span><br><span class=\"line\">        {&quot;chmod&quot;,                   {2,     2,    {true,   do_chmod}}},</span><br><span class=\"line\">        {&quot;chown&quot;,                   {2,     3,    {true,   do_chown}}},</span><br><span class=\"line\">        {&quot;class_reset&quot;,             {1,     1,    {false,  do_class_reset}}},</span><br><span class=\"line\">        {&quot;class_reset_post_data&quot;,   {1,     1,    {false,  do_class_reset_post_data}}},</span><br><span class=\"line\">        {&quot;class_restart&quot;,           {1,     1,    {false,  do_class_restart}}},</span><br><span class=\"line\">        {&quot;class_start&quot;,             {1,     1,    {false,  do_class_start}}},</span><br><span class=\"line\">        {&quot;class_start_post_data&quot;,   {1,     1,    {false,  do_class_start_post_data}}},</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        ...</span><br><span class=\"line\">   }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x4E0E;&#x5BF9;&#x5E94;&#x7684;Actions&#x7ED1;&#x5B9A;&#x662F;&#x5728;init.cpp&#x4E2D;&#x7684;SecondStageMain&#x65B9;&#x6CD5;&#x91CC;&#x9762;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const BuiltinFunctionMap&amp; function_map = GetBuiltinFunctionMap();</span><br><span class=\"line\">Action::set_function_map(&amp;function_map);</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>system/core/init/builtins.cpp</p>\n</blockquote>\n<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x770B;do_class_start&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static Result&lt;void&gt; do_class_start(const BuiltinArguments&amp; args) {</span><br><span class=\"line\">    // Do not start a class if it has a property persist.dont_start_class.CLASS set to 1.</span><br><span class=\"line\">    if (android::base::GetBoolProperty(&quot;persist.init.dont_start_class.&quot; + args[1], false))</span><br><span class=\"line\">        return {};</span><br><span class=\"line\">    // Starting a class does not start services which are explicitly disabled.</span><br><span class=\"line\">    // They must  be started individually.</span><br><span class=\"line\">    for (const auto&amp; service : ServiceList::GetInstance()) {</span><br><span class=\"line\">        if (service-&gt;classnames().count(args[1])) {</span><br><span class=\"line\">            if (auto result = service-&gt;StartIfNotDisabled(); !result.ok()) {</span><br><span class=\"line\">                LOG(ERROR) &lt;&lt; &quot;Could not start service &apos;&quot; &lt;&lt; service-&gt;name()</span><br><span class=\"line\">                           &lt;&lt; &quot;&apos; as part of class &apos;&quot; &lt;&lt; args[1] &lt;&lt; &quot;&apos;: &quot; &lt;&lt; result.error();</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return {};</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x65B9;&#x6CD5;&#x4E2D;&#x4F1A;&#x901A;&#x8FC7;ServiceList::GetInstance&#x6765;&#x83B7;&#x53D6;&#x89E3;&#x6790;.rc&#x6587;&#x4EF6;&#x4E2D;&#x7684;Service&#x94FE;&#x8868;&#xFF0C;&#x901A;&#x8FC7;&#x5339;&#x914D;&#x5BF9;&#x5E94;&#x7684;classnames&#x6765;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;Service&#x3002;</p>\n<p>&#x6839;&#x636E;&#x4E0A;&#x9762;&#x7684;class_start main&#xFF0C;&#x8BF4;&#x660E;&#x8981;&#x627E;&#x7684;&#x662F;class&#x540D;&#x79F0;&#x4E3A;main&#x8FD9;&#x4E2A;&#x5173;&#x8054;&#x7684;Service&#x3002;</p>\n<p>&#x8FD9;&#x4E2A;main service&#x4F4D;&#x4E8E;init.zygote.rc&#x4E2D;&#xFF0C;&#x5185;&#x90E8;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service zygote /system/bin/app_process -Xzygote /system/bin --zygote --start-system-server</span><br><span class=\"line\">    class main</span><br><span class=\"line\">    socket zygote stream 660 root system</span><br><span class=\"line\">    onrestart write /sys/android_power/request_state wake</span><br><span class=\"line\">    onrestart write /sys/power/state on</span><br><span class=\"line\">    onrestart restart media</span><br><span class=\"line\">    onrestart restart netd</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x53EA;&#x6CE8;&#x518C;&#x4E86;&#x4E00;&#x4E2A;service&#xFF0C;&#x540D;&#x79F0;&#x4E3A;zygote&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4E3A;/system/bin/app_process, &#x540E;&#x9762;&#x7684;&#x2013;zygote &#x2013;start-system-serve&#x90FD;&#x662F;&#x5B83;&#x7684;&#x542F;&#x52A8;&#x53C2;&#x6570;&#x3002;</p>\n<p>&#x901A;&#x8FC7;class main&#x8BBE;&#x7F6E;&#x5B83;&#x7684;&#x542F;&#x52A8;&#x7C7B;&#x4E3A;main&#xFF0C;&#x901A;&#x8FC7;&#x5B83;&#x6765;&#x542F;&#x52A8;&#x8FD9;&#x4E2A;service&#x3002;</p>\n<p>&#x8FD9;&#x91CC;&#x6B63;&#x597D;&#x5BF9;&#x5E94;&#x7684;&#x4E0A;&#x9762;&#x9700;&#x8981;&#x5BFB;&#x627E;&#x7684;&#x7C7B;&#x540D;&#x4E3A;main&#x7684;&#x542F;&#x52A8;&#x7C7B;&#x6765;&#x542F;&#x52A8;service&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x542F;&#x52A8;&#x7684;&#x8FD9;&#x4E2A;service&#x5C31;&#x662F;zygote&#x3002;</p>\n<p>&#x81F3;&#x4E8E;service&#x7684;&#x89E3;&#x6790;&#x8FC7;&#x7A0B;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;init&#x542F;&#x52A8;&#x6709;&#x63D0;&#x53CA;&#x8FC7;&#xFF0C;&#x5B83;&#x662F;&#x901A;&#x8FC7;LoadBootScripts(am, sm)&#x8FDB;&#x5165;&#x89E3;&#x6790;.rc&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x5185;&#x90E8;&#x4F1A;&#x901A;&#x8FC7;service_parser.cpp&#x6765;&#x89E3;&#x6790;&#x5BF9;&#x5E94;&#x7684;service&#x8BED;&#x53E5;&#xFF0C;&#x6700;&#x540E;&#x5C06;&#x89E3;&#x6790;&#x7684;service&#x4FE1;&#x606F;&#x6DFB;&#x52A0;&#x5230;service vector&#x94FE;&#x8868;&#x4E2D;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service_list_-&gt;AddService(std::move(service_));</span><br><span class=\"line\"> </span><br><span class=\"line\">vector&lt;_Tp, _Allocator&gt;::__emplace_back_slow_path(_Args&amp;&amp;... __args)</span><br></pre></td></tr></table></figure>\n<p>&#x627E;&#x5230;&#x5339;&#x914D;&#x7684;main class&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x8FDB;&#x5165;StartIfNotDisabled</p>\n<blockquote>\n<p>system/core/init/service.cpp</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Result&lt;void&gt; Service::StartIfNotDisabled() {</span><br><span class=\"line\">    if (!(flags_ &amp; SVC_DISABLED)) {</span><br><span class=\"line\">        return Start();</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        flags_ |= SVC_DISABLED_START;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return {};</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x5B83;&#x4E0D;&#x662F;disabled&#x5C31;&#x662F;&#x8C03;&#x7528;Start&#xFF0C;&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;service&#x6CE8;&#x518C;&#x4FE1;&#x606F;&#x662F;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;disabled&#xFF0C;&#x6240;&#x4EE5;&#x4E3A;false&#x3002;&#x5373;&#x8FDB;&#x5165;Start&#x542F;&#x52A8;service</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Result&lt;void&gt; Service::Start() {</span><br><span class=\"line\">  </span><br><span class=\"line\">    ...</span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (flags_ &amp; SVC_RUNNING) {</span><br><span class=\"line\">        if ((flags_ &amp; SVC_ONESHOT) &amp;&amp; disabled) {</span><br><span class=\"line\">            flags_ |= SVC_RESTART;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        // &#x5982;&#x679C;&#x6CA1;&#x6709;&#x9519;&#x8BEF;&#x5C31;&#x542F;&#x52A8;&#x4E4B;&#x524D;&#x542F;&#x52A8;&#x7684;service</span><br><span class=\"line\">        reboot_on_failure.Disable();</span><br><span class=\"line\">        return {};</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    &#x3002;&#x3002;&#x3002;</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x5224;&#x65AD;&#x8BE5;service&#x5BF9;&#x4E8E;&#x7684;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x5B58;&#x5728;</span><br><span class=\"line\">    struct stat sb;</span><br><span class=\"line\">    if (stat(args_[0].c_str(), &amp;sb) == -1) {</span><br><span class=\"line\">        flags_ |= SVC_DISABLED;</span><br><span class=\"line\">        return ErrnoError() &lt;&lt; &quot;Cannot find &apos;&quot; &lt;&lt; args_[0] &lt;&lt; &quot;&apos;&quot;;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    pid_t pid = -1;</span><br><span class=\"line\">    if (namespaces_.flags) {</span><br><span class=\"line\">        pid = clone(nullptr, nullptr, namespaces_.flags | SIGCHLD, nullptr);</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        // fork()&#x521B;&#x5EFA;&#x5B50;&#x8FDB;&#x7A0B;</span><br><span class=\"line\">        pid = fork();</span><br><span class=\"line\">    }</span><br><span class=\"line\">  </span><br><span class=\"line\">    if (pid == 0) { // fork&#x7684;&#x5B50;&#x8FDB;&#x7A0B;</span><br><span class=\"line\">        umask(077);</span><br><span class=\"line\">  </span><br><span class=\"line\">        ...</span><br><span class=\"line\">        ...</span><br><span class=\"line\">  </span><br><span class=\"line\">        if (!ExpandArgsAndExecv(args_, sigstop_)) {</span><br><span class=\"line\">            PLOG(ERROR) &lt;&lt; &quot;cannot execv(&apos;&quot; &lt;&lt; args_[0]</span><br><span class=\"line\">                        &lt;&lt; &quot;&apos;). See the &apos;Debugging init&apos; section of init&apos;s README.md for tips&quot;;</span><br><span class=\"line\">        }</span><br><span class=\"line\">  </span><br><span class=\"line\">        _exit(127);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    NotifyStateChange(&quot;running&quot;);</span><br><span class=\"line\">    reboot_on_failure.Disable();</span><br><span class=\"line\">    return {};</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;Start&#x4E2D;&#x9996;&#x5148;&#x4F1A;&#x5224;&#x65AD;&#x8BE5;service&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x542F;&#x52A8;&#xFF0C;&#x82E5;&#x6CA1;&#x6709;&#xFF0C;&#x7136;&#x540E;&#x53BB;&#x9A8C;&#x8BC1;&#x8BE5;service&#x662F;&#x5426;&#x80FD;&#x591F;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x91CC;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;/system/bin/app_process&#x3002;<br>&#x6700;&#x540E;&#x4F1A;&#x901A;&#x8FC7;fork()&#x6765;&#x521B;&#x5EFA;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;pid = 0&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x5F53;pid === 0&#x65F6;&#xFF0C;&#x8BF4;&#x660E;&#x8FD0;&#x884C;&#x5728;&#x5B50;&#x8FDB;&#x7A0B;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x5165;ExpandArgsAndExecv&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static bool ExpandArgsAndExecv(const std::vector&lt;std::string&gt;&amp; args, bool sigstop) {</span><br><span class=\"line\">    std::vector&lt;std::string&gt; expanded_args;</span><br><span class=\"line\">    std::vector&lt;char*&gt; c_strings;</span><br><span class=\"line\"> </span><br><span class=\"line\">    expanded_args.resize(args.size());</span><br><span class=\"line\">    c_strings.push_back(const_cast&lt;char*&gt;(args[0].data()));</span><br><span class=\"line\">    for (std::size_t i = 1; i &lt; args.size(); ++i) {</span><br><span class=\"line\">        auto expanded_arg = ExpandProps(args[i]);</span><br><span class=\"line\">        if (!expanded_arg.ok()) {</span><br><span class=\"line\">            LOG(FATAL) &lt;&lt; args[0] &lt;&lt; &quot;: cannot expand arguments&apos;: &quot; &lt;&lt; expanded_arg.error();</span><br><span class=\"line\">        }</span><br><span class=\"line\">        expanded_args[i] = *expanded_arg;</span><br><span class=\"line\">        c_strings.push_back(expanded_args[i].data());</span><br><span class=\"line\">    }</span><br><span class=\"line\">    c_strings.push_back(nullptr);</span><br><span class=\"line\">    if (sigstop) {</span><br><span class=\"line\">        kill(getpid(), SIGSTOP);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x542F;&#x52A8;zygote</span><br><span class=\"line\">    return execv(c_strings[0], c_strings.data()) == 0;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;ExpandArgsAndExecv&#x65B9;&#x6CD5;&#x4E2D;&#x6700;&#x540E;&#x4F1A;&#x901A;&#x8FC7;execv&#x6765;&#x542F;&#x52A8;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x662F;&#x8FDB;&#x5165;app_main.cpp&#x5E76;&#x8C03;&#x7528;&#x5B83;&#x7684;main&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x5373;zygote&#x662F;&#x901A;&#x8FC7;fork&#x548C;execv&#x5171;&#x540C;&#x521B;&#x5EFA;&#x7684;&#x3002;</p>\n<p>&#x518D;&#x6765;&#x770B;app_main.cpp&#x505A;&#x4E86;&#x4EC0;&#x4E48;</p>\n<blockquote>\n<p>frameworks/base/cmds/app_process/app_main.cpp</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int main(int argc, char* const argv[])</span><br><span class=\"line\">{</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    ...</span><br><span class=\"line\">     </span><br><span class=\"line\">    // --zygote : Start in zygote mode</span><br><span class=\"line\">    // --start-system-server : Start the system server.</span><br><span class=\"line\">    // --application : Start in application (stand alone, non zygote) mode.</span><br><span class=\"line\">    // --nice-name : The nice name for this process.</span><br><span class=\"line\">  </span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    bool zygote = false;</span><br><span class=\"line\">    bool startSystemServer = false;</span><br><span class=\"line\">    bool application = false;</span><br><span class=\"line\">    String8 niceName;</span><br><span class=\"line\">    String8 className;</span><br><span class=\"line\"> </span><br><span class=\"line\">    ++i;  // Skip unused &quot;parent dir&quot; argument.</span><br><span class=\"line\">    while (i &lt; argc) {</span><br><span class=\"line\">        const char* arg = argv[i++];</span><br><span class=\"line\">        if (strcmp(arg, &quot;--zygote&quot;) == 0) {</span><br><span class=\"line\">            // &#x542F;&#x52A8;&#x7684;&#x662F;zygote</span><br><span class=\"line\">            zygote = true;</span><br><span class=\"line\">            // &#x8BBE;&#x7F6E;&#x8FDB;&#x7A0B;&#x540D;&#x79F0;&#xFF0C;&#x8FD9;&#x91CC;&#x4E3A;zygote</span><br><span class=\"line\">            niceName = ZYGOTE_NICE_NAME;</span><br><span class=\"line\">        } else if (strcmp(arg, &quot;--start-system-server&quot;) == 0) {</span><br><span class=\"line\">            // &#x542F;&#x52A8;&#x5B8C;zygote&#x4E4B;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x5F00;&#x542F;system service</span><br><span class=\"line\">            startSystemServer = true;</span><br><span class=\"line\">        } else if (strcmp(arg, &quot;--application&quot;) == 0) {</span><br><span class=\"line\">            application = true;</span><br><span class=\"line\">        } else if (strncmp(arg, &quot;--nice-name=&quot;, 12) == 0) {</span><br><span class=\"line\">            niceName.setTo(arg + 12);</span><br><span class=\"line\">        } else if (strncmp(arg, &quot;--&quot;, 2) != 0) {</span><br><span class=\"line\">            className.setTo(arg);</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            --i;</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (zygote) {</span><br><span class=\"line\">        // &#x542F;&#x52A8;java ZygoteInit</span><br><span class=\"line\">        runtime.start(&quot;com.android.internal.os.ZygoteInit&quot;, args, zygote);</span><br><span class=\"line\">    } else if (className) {</span><br><span class=\"line\">        runtime.start(&quot;com.android.internal.os.RuntimeInit&quot;, args, zygote);</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        fprintf(stderr, &quot;Error: no class name or --zygote supplied.\\n&quot;);</span><br><span class=\"line\">        app_usage();</span><br><span class=\"line\">        LOG_ALWAYS_FATAL(&quot;app_process: no class name or --zygote supplied.&quot;);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6838;&#x5FC3;&#x90E8;&#x5206;&#x5C31;&#x4E24;&#x6B65;&#xFF0C;&#x7B2C;&#x4E00;&#x6B65;&#x662F;&#x89E3;&#x6790;service&#x4E2D;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x5728;.rc&#x4E2D;&#x6CE8;&#x518C;&#x65F6;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B65;&#x901A;&#x8FC7;runtime.start&#x6765;&#x542F;&#x52A8;java&#x4E2D;&#x7684;ZygoteInit&#x3002;</p>\n<p>&#x8FD9;&#x4E00;&#x6B65;&#x662F;Linux&#x9996;&#x6B21;&#x8FDB;&#x5165;&#x5230;Java&#x5C42;&#x3002;</p>\n<p>&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x5355;&#x7BC7;&#x5E45;&#x5EA6;&#x8FC7;&#x957F;&#xFF0C;&#x5173;&#x4E8E;Linux&#x5982;&#x4F55;&#x542F;&#x52A8;Java&#x4E2D;&#x7684;ZygoteInit&#x4E0E;ZygoteInit&#x7684;&#x5185;&#x90E8;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#xFF0C;&#x8FD9;&#x5757;&#x7684;&#x5177;&#x4F53;&#x5185;&#x5BB9;&#x5C06;&#x4F1A;&#x5728;&#x4E0B;&#x7BC7;&#x6587;&#x7AE0;&#x7EE7;&#x7EED;&#x5206;&#x6790;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;zygote&#x5728;Linux&#x4E2D;&#x7684;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;&#xFF1A;</p>\n<ol>\n<li>&#x901A;&#x8FC7;LoadBootScripts(am, sm)&#x89E3;&#x6790;.rc&#x6587;&#x4EF6;</li>\n<li>&#x89E3;&#x6790;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x6839;&#x636E;Actions&#x4E8B;&#x4EF6;&#x89E6;&#x53D1;&#x65F6;&#x673A;&#x627E;&#x5230;&#x7C7B;&#x540D;&#x4E3A;main&#x7684;&#x542F;&#x52A8;&#x7C7B;</li>\n<li>&#x6839;&#x636E;main&#x542F;&#x52A8;&#x7C7B;&#x6765;&#x542F;&#x52A8;&#x5BF9;&#x5E94;&#x7684;zygote&#x670D;&#x52A1;</li>\n<li>&#x7136;&#x540E;&#x901A;&#x8FC7;fork&#x6765;&#x521B;&#x5EFA;zygote&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;pid = 0</li>\n<li>&#x901A;&#x8FC7;execv&#x6765;&#x542F;&#x52A8;zygote&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x8FDB;&#x5165;app_main.cpp&#x7684;main&#x65B9;&#x6CD5;<br>&#x65B9;&#x6CD5;</li>\n<li>&#x6700;&#x540E;&#x518D;&#x89E3;&#x6790;&#x6CE8;&#x518C;&#x8868;&#x4E2D;service&#x7684;&#x53C2;&#x6570;&#x5E76;&#x901A;&#x8FC7;runtime.start&#x542F;&#x52A8;java&#x5C42;&#x7684;ZygoteInit</li>\n</ol>\n<p>&#x4E00;&#x56FE;&#x80DC;&#x5343;&#x6587;</p>\n<p><img src=\"/2020/12/10/Android-Linux-Zygote&#x542F;&#x52A8;/linux_zygote_init.png\" alt></p>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["启动"]},{"title":"Android init 启动","url":"https://www.rousetime.com/2020/12/08/Android-init-启动/","content":"<p>Android&#x662F;&#x57FA;&#x4E8E;Linux&#x7CFB;&#x7EDF;&#x7684;&#xFF0C;&#x6240;&#x4EE5;Android&#x542F;&#x52A8;&#x5C06;&#x7531;Linux Kernel&#x542F;&#x52A8;&#x5E76;&#x521B;&#x5EFA;init&#x8FDB;&#x7A0B;&#x3002;&#x8BE5;&#x8FDB;&#x7A0B;&#x662F;&#x6240;&#x6709;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x7684;&#x9F3B;&#x7956;&#x3002;</p>\n<p>&#x5728;init&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x4F1A;&#x76F8;&#x7EE7;&#x542F;&#x52A8;servicemanager(binder&#x670D;&#x52A1;&#x7BA1;&#x7406;&#x8005;)&#x3001;Zygote&#x8FDB;&#x7A0B;(java&#x8FDB;&#x7A0B;)&#x3002;&#x800C;Zygote&#x53C8;&#x4F1A;&#x521B;&#x5EFA;system_server&#x8FDB;&#x7A0B;&#x4EE5;&#x53CA;app&#x8FDB;&#x7A0B;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x4F60;&#x4E00;&#x5B9A;&#x542C;&#x5230;&#x8FC7;&#x8FD9;&#x53E5;&#x8BDD;&#xFF1A;app&#x8FDB;&#x7A0B;&#x662F;&#x7531;Zygote&#x8FDB;&#x7A0B;&#x901A;&#x8FC7;fork&#x521B;&#x5EFA;&#x51FA;&#x6765;&#x7684;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x5C1D;&#x8BD5;&#x6765;&#x5206;&#x6790;Android&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#x5173;&#x4E8E;init&#x8FDB;&#x7A0B;&#x7684;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;&#x3002;</p>\n<blockquote>\n<p>&#x6B64;&#x6B21;&#x5206;&#x6790;&#x8FC7;&#x7A0B;&#x57FA;&#x4E8E;Android 10.0</p>\n</blockquote>\n<h2 id=\"init\"><a href=\"#init\" class=\"headerlink\" title=\"init\"></a>init</h2><p>init&#x8FDB;&#x7A0B;&#x662F;Android&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#x5728;Linux&#x7CFB;&#x7EDF;&#x4E2D;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;init&#x542F;&#x52A8;&#x5165;&#x53E3;&#x662F;&#x5728;&#x5B83;&#x7684;SecondStageMain&#x65B9;&#x6CD5;&#x4E2D;&#x3002;&#x4F46;&#x8C03;&#x7528;init&#x7684;SecondStageMain&#x65B9;&#x6CD5;&#x662F;&#x901A;&#x8FC7;main.cpp&#x4E2D;&#x7684;main&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x7684;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C31;&#x4ECE;main.cpp&#x7684;main&#x65B9;&#x6CD5;&#x5F00;&#x59CB;&#x3002;</p>\n<h2 id=\"main\"><a href=\"#main\" class=\"headerlink\" title=\"main\"></a>main</h2><blockquote>\n<p>system/core/init/main.cpp</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int main(int argc, char** argv) {</span><br><span class=\"line\">#if __has_feature(address_sanitizer)</span><br><span class=\"line\">    __asan_set_error_report_callback(AsanReportCallback);</span><br><span class=\"line\">#endif</span><br><span class=\"line\">  </span><br><span class=\"line\">    // &#x521B;&#x5EFA;&#x8BBE;&#x5907;&#x8282;&#x70B9;&#x3001;&#x6743;&#x9650;&#x8BBE;&#x5B9A;&#x7B49;</span><br><span class=\"line\">    if (!strcmp(basename(argv[0]), &quot;ueventd&quot;)) {</span><br><span class=\"line\">        return ueventd_main(argc, argv);</span><br><span class=\"line\">    }</span><br><span class=\"line\">  </span><br><span class=\"line\">    if (argc &gt; 1) {</span><br><span class=\"line\">        // &#x521D;&#x59CB;&#x5316;&#x65E5;&#x5FD7;&#x7CFB;&#x7EDF;</span><br><span class=\"line\">        if (!strcmp(argv[1], &quot;subcontext&quot;)) {</span><br><span class=\"line\">            android::base::InitLogging(argv, &amp;android::base::KernelLogger);</span><br><span class=\"line\">            const BuiltinFunctionMap function_map;</span><br><span class=\"line\">            return SubcontextMain(argc, argv, &amp;function_map);</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        // 2. &#x521B;&#x5EFA;&#x589E;&#x5F3A;&#x578B;Linux</span><br><span class=\"line\">        if (!strcmp(argv[1], &quot;selinux_setup&quot;)) {</span><br><span class=\"line\">            return SetupSelinux(argv);</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        // 3. &#x89E3;&#x6790;init.rc&#x6587;&#x4EF6;&#x3001;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x3001;&#x521B;&#x5EFA;epoll&#x4E0E;&#x5904;&#x7406;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x7EC8;&#x6B62;&#x7B49;</span><br><span class=\"line\">        if (!strcmp(argv[1], &quot;second_stage&quot;)) {</span><br><span class=\"line\">            return SecondStageMain(argc, argv);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // 1. &#x6302;&#x8F7D;&#x76F8;&#x5173;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</span><br><span class=\"line\">    return FirstStageMain(argc, argv);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;main.cpp&#x7684;main&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x4E3B;&#x8981;&#x5206;&#x4E3A;&#x4E09;&#x6B65;&#xFF1A;</p>\n<ol>\n<li>FirstStageMain</li>\n<li>SetupSelinux</li>\n<li>SecondStageMain</li>\n</ol>\n<h3 id=\"FirstStageMain\"><a href=\"#FirstStageMain\" class=\"headerlink\" title=\"FirstStageMain\"></a>FirstStageMain</h3><blockquote>\n<p>system/core/init/first_stage_init.cpp</p>\n</blockquote>\n<p>&#x5B83;&#x662F;init&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#x7684;&#x7B2C;&#x4E00;&#x6B65;&#xFF0C;&#x4E3B;&#x8981;&#x4EFB;&#x52A1;&#x662F;&#x6302;&#x8F7D;&#x76F8;&#x5173;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int FirstStageMain(int argc, char** argv) {</span><br><span class=\"line\">    if (REBOOT_BOOTLOADER_ON_PANIC) {</span><br><span class=\"line\">        InstallRebootSignalHandlers();</span><br><span class=\"line\">    }</span><br><span class=\"line\">  </span><br><span class=\"line\">    boot_clock::time_point start_time = boot_clock::now();</span><br><span class=\"line\">  </span><br><span class=\"line\">    std::vector&lt;std::pair&lt;std::string, int&gt;&gt; errors;</span><br><span class=\"line\">#define CHECKCALL(x) \\</span><br><span class=\"line\">    if (x != 0) errors.emplace_back(#x &quot; failed&quot;, errno);</span><br><span class=\"line\">  </span><br><span class=\"line\">    // Clear the umask.</span><br><span class=\"line\">    umask(0);</span><br><span class=\"line\">  </span><br><span class=\"line\">    // &#x521B;&#x5EFA;&#x4E8E;&#x6302;&#x8F7D;&#x76F8;&#x5173;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</span><br><span class=\"line\">    CHECKCALL(clearenv());</span><br><span class=\"line\">    CHECKCALL(setenv(&quot;PATH&quot;, _PATH_DEFPATH, 1));</span><br><span class=\"line\">    // Get the basic filesystem setup we need put together in the initramdisk</span><br><span class=\"line\">    // on / and then we&apos;ll let the rc file figure out the rest.</span><br><span class=\"line\">    CHECKCALL(mount(&quot;tmpfs&quot;, &quot;/dev&quot;, &quot;tmpfs&quot;, MS_NOSUID, &quot;mode=0755&quot;));</span><br><span class=\"line\">    CHECKCALL(mkdir(&quot;/dev/pts&quot;, 0755));</span><br><span class=\"line\">    CHECKCALL(mkdir(&quot;/dev/socket&quot;, 0755));</span><br><span class=\"line\">    CHECKCALL(mount(&quot;devpts&quot;, &quot;/dev/pts&quot;, &quot;devpts&quot;, 0, NULL));</span><br><span class=\"line\">#define MAKE_STR(x) __STRING(x)</span><br><span class=\"line\">    CHECKCALL(mount(&quot;proc&quot;, &quot;/proc&quot;, &quot;proc&quot;, 0, &quot;hidepid=2,gid=&quot; MAKE_STR(AID_READPROC)));</span><br><span class=\"line\">#undef MAKE_STR</span><br><span class=\"line\">    // Don&apos;t expose the raw commandline to unprivileged processes.</span><br><span class=\"line\">    CHECKCALL(chmod(&quot;/proc/cmdline&quot;, 0440));</span><br><span class=\"line\">    gid_t groups[] = {AID_READPROC};</span><br><span class=\"line\">    CHECKCALL(setgroups(arraysize(groups), groups));</span><br><span class=\"line\">    CHECKCALL(mount(&quot;sysfs&quot;, &quot;/sys&quot;, &quot;sysfs&quot;, 0, NULL));</span><br><span class=\"line\">    CHECKCALL(mount(&quot;selinuxfs&quot;, &quot;/sys/fs/selinux&quot;, &quot;selinuxfs&quot;, 0, NULL));</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    // Now that tmpfs is mounted on /dev and we have /dev/kmsg, we can actually</span><br><span class=\"line\">    // talk to the outside world...</span><br><span class=\"line\">     </span><br><span class=\"line\">    // &#x521D;&#x59CB;&#x5316;&#x65E5;&#x5FD7;&#x7CFB;&#x7EDF;</span><br><span class=\"line\">    InitKernelLogging(argv);</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    ...</span><br><span class=\"line\">     </span><br><span class=\"line\">    // &#x8FDB;&#x5165;&#x4E0B;&#x4E00;&#x6B65;</span><br><span class=\"line\">    const char* path = &quot;/system/bin/init&quot;;</span><br><span class=\"line\">    const char* args[] = {path, &quot;selinux_setup&quot;, nullptr};</span><br><span class=\"line\">    execv(path, const_cast&lt;char**&gt;(args));</span><br><span class=\"line\">  </span><br><span class=\"line\">    // execv() only returns if an error happened, in which case we</span><br><span class=\"line\">    // panic and never fall through this conditional.</span><br><span class=\"line\">    PLOG(FATAL) &lt;&lt; &quot;execv(\\&quot;&quot; &lt;&lt; path &lt;&lt; &quot;\\&quot;) failed&quot;;</span><br><span class=\"line\">  </span><br><span class=\"line\">    return 1;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E3B;&#x8981;&#x901A;&#x8FC7;mount&#x6302;&#x8F7D;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;mkdir&#x521B;&#x5EFA;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x76EE;&#x5F55;&#xFF0C;&#x5E76;&#x914D;&#x7F6E;&#x76F8;&#x5E94;&#x7684;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x3002;</p>\n<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x53EA;&#x662F;&#x5728;&#x5E94;&#x7528;&#x8FD0;&#x884C;&#x7684;&#x65F6;&#x5019;&#x5B58;&#x5728;&#xFF0C;&#x4E00;&#x65E6;&#x5E94;&#x7528;&#x8FD0;&#x884C;&#x7ED3;&#x675F;&#x5C31;&#x4F1A;&#x968F;&#x7740;&#x5E94;&#x7528;&#x4E00;&#x8D77;&#x6D88;&#x5931;&#x3002;</p>\n<p>&#x6302;&#x8F7D;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E3B;&#x8981;&#x6709;&#x56DB;&#x7C7B;&#xFF1A;</p>\n<ol>\n<li>tmpfs: &#x4E00;&#x79CD;&#x865A;&#x62DF;&#x5185;&#x5B58;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x5B83;&#x4F1A;&#x5C06;&#x6240;&#x6709;&#x7684;&#x6587;&#x4EF6;&#x5B58;&#x50A8;&#x5728;&#x865A;&#x62DF;&#x5185;&#x5B58;&#x4E2D;&#x3002;&#x7531;&#x4E8E;tmpfs&#x662F;&#x9A7B;&#x7559;&#x5728;RAM&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5B83;&#x7684;&#x5185;&#x5BB9;&#x662F;&#x4E0D;&#x6301;&#x4E45;&#x7684;&#x3002;&#x65AD;&#x7535;&#x540E;&#xFF0C;tmpfs &#x7684;&#x5185;&#x5BB9;&#x5C31;&#x6D88;&#x5931;&#x4E86;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x88AB;&#x79F0;&#x4F5C;tmpfs&#x7684;&#x6839;&#x672C;&#x539F;&#x56E0;&#x3002;</li>\n<li>devpts: &#x4E3A;&#x4F2A;&#x7EC8;&#x7AEF;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x6807;&#x51C6;&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x7684;&#x6807;&#x51C6;&#x6302;&#x63A5;&#x70B9;&#x662F;/dev/pts&#x3002;&#x53EA;&#x8981;pty&#x7684;&#x4E3B;&#x590D;&#x5408;&#x8BBE;&#x5907;/dev/ptmx&#x88AB;&#x6253;&#x5F00;&#xFF0C;&#x5C31;&#x4F1A;&#x5728;/dev/pts&#x4E0B;&#x52A8;&#x6001;&#x7684;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;pty&#x8BBE;&#x5907;&#x6587;&#x4EF6;&#x3002;</li>\n<li>proc: &#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x662F;&#x5185;&#x6838;&#x5185;&#x90E8;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x901A;&#x8FC7;&#x5B83;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7CFB;&#x7EDF;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x80FD;&#x591F;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x4FEE;&#x6539;&#x7279;&#x5B9A;&#x7684;&#x5185;&#x6838;&#x53C2;&#x6570;&#x3002;</li>\n<li>sysfs: &#x4E0E;proc&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7C7B;&#x4F3C;&#xFF0C;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x5360;&#x6709;&#x4EFB;&#x4F55;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x7684;&#x865A;&#x62DF;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;&#x5B83;&#x901A;&#x5E38;&#x88AB;&#x6302;&#x63A5;&#x5728;/sys&#x76EE;&#x5F55;&#x4E0B;&#x3002;</li>\n</ol>\n<p>&#x5728;FirstStageMain&#x8FD8;&#x4F1A;&#x901A;&#x8FC7;InitKernelLogging(argv)&#x6765;&#x521D;&#x59CB;&#x5316;log&#x65E5;&#x5FD7;&#x7CFB;&#x7EDF;&#x3002;&#x6B64;&#x65F6;Android&#x8FD8;&#x6CA1;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x7CFB;&#x7EDF;&#x65E5;&#x5FD7;&#xFF0C;&#x91C7;&#x7528;kernel&#x7684;log&#x7CFB;&#x7EDF;&#xFF0C;&#x6253;&#x5F00;&#x7684;&#x8BBE;&#x5907;&#x8282;&#x70B9;/dev/kmsg&#xFF0C; &#x90A3;&#x4E48;&#x53EF;&#x901A;&#x8FC7;cat /dev/kmsg&#x6765;&#x83B7;&#x53D6;&#x5185;&#x6838;log&#x3002;</p>\n<p>&#x6700;&#x540E;&#x4F1A;&#x901A;&#x8FC7;execv&#x65B9;&#x6CD5;&#x4F20;&#x9012;&#x5BF9;&#x5E94;&#x7684;path&#x4E0E;&#x4E0B;&#x4E00;&#x9636;&#x6BB5;&#x7684;&#x53C2;&#x6570;selinux_setup&#x3002;</p>\n<h3 id=\"SetupSelinux\"><a href=\"#SetupSelinux\" class=\"headerlink\" title=\"SetupSelinux\"></a>SetupSelinux</h3><blockquote>\n<p>system/core/init/selinux.cpp</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// This function initializes SELinux then execs init to run in the init SELinux context.</span><br><span class=\"line\">int SetupSelinux(char** argv) {</span><br><span class=\"line\">    InitKernelLogging(argv);</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (REBOOT_BOOTLOADER_ON_PANIC) {</span><br><span class=\"line\">        InstallRebootSignalHandlers();</span><br><span class=\"line\">    }</span><br><span class=\"line\">   </span><br><span class=\"line\">    // Set up SELinux, loading the SELinux policy.</span><br><span class=\"line\">    SelinuxSetupKernelLogging();</span><br><span class=\"line\">    SelinuxInitialize();</span><br><span class=\"line\">  </span><br><span class=\"line\">    // We&apos;re in the kernel domain and want to transition to the init domain.  File systems that</span><br><span class=\"line\">    // store SELabels in their xattrs, such as ext4 do not need an explicit restorecon here,</span><br><span class=\"line\">    // but other file systems do.  In particular, this is needed for ramdisks such as the</span><br><span class=\"line\">    // recovery image for A/B devices.</span><br><span class=\"line\">    if (selinux_android_restorecon(&quot;/system/bin/init&quot;, 0) == -1) {</span><br><span class=\"line\">        PLOG(FATAL) &lt;&lt; &quot;restorecon failed of /system/bin/init failed&quot;;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x8FDB;&#x5165;&#x4E0B;&#x4E00;&#x6B65;</span><br><span class=\"line\">    const char* path = &quot;/system/bin/init&quot;;</span><br><span class=\"line\">    const char* args[] = {path, &quot;second_stage&quot;, nullptr};</span><br><span class=\"line\">    execv(path, const_cast&lt;char**&gt;(args));</span><br><span class=\"line\">   </span><br><span class=\"line\">    // execv() only returns if an error happened, in which case we</span><br><span class=\"line\">    // panic and never return from this function.</span><br><span class=\"line\">    PLOG(FATAL) &lt;&lt; &quot;execv(\\&quot;&quot; &lt;&lt; path &lt;&lt; &quot;\\&quot;) failed&quot;;</span><br><span class=\"line\"> </span><br><span class=\"line\">    return 1;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E3B;&#x8981;&#x662F;&#x7528;&#x6765;&#x63D0;&#x9AD8;linux&#x7684;&#x5B89;&#x5168;&#xFF0C;&#x8FDB;&#x4E00;&#x6B65;&#x7EA6;&#x675F;&#x8BBF;&#x95EE;&#x7684;&#x6743;&#x9650;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x4E5F;&#x662F;&#x901A;&#x8FC7;execv&#x6765;&#x8FDB;&#x7A0B;init&#x542F;&#x52A8;&#x7684;&#x6838;&#x5FC3;&#x9636;&#x6BB5;SecondStageMain&#x3002;</p>\n<h3 id=\"SecondStageMain\"><a href=\"#SecondStageMain\" class=\"headerlink\" title=\"SecondStageMain\"></a>SecondStageMain</h3><blockquote>\n<p>system/core/init/init.cpp</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int SecondStageMain(int argc, char** argv) {</span><br><span class=\"line\">    if (REBOOT_BOOTLOADER_ON_PANIC) {</span><br><span class=\"line\">        InstallRebootSignalHandlers();</span><br><span class=\"line\">    }</span><br><span class=\"line\">     </span><br><span class=\"line\">    ...</span><br><span class=\"line\">    ...</span><br><span class=\"line\">     </span><br><span class=\"line\">    // &#x521D;&#x59CB;&#x5316;&#x5C5E;&#x6027;&#x670D;&#x52A1;</span><br><span class=\"line\">    property_init();</span><br><span class=\"line\"> </span><br><span class=\"line\">    // If arguments are passed both on the command line and in DT,</span><br><span class=\"line\">    // properties set in DT always have priority over the command-line ones.</span><br><span class=\"line\">    process_kernel_dt();</span><br><span class=\"line\">    process_kernel_cmdline();</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Propagate the kernel variables to internal variables</span><br><span class=\"line\">    // used by init as well as the current required properties.</span><br><span class=\"line\">    export_kernel_boot_props();</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Make the time that init started available for bootstat to log.</span><br><span class=\"line\">    property_set(&quot;ro.boottime.init&quot;, getenv(&quot;INIT_STARTED_AT&quot;));</span><br><span class=\"line\">    property_set(&quot;ro.boottime.init.selinux&quot;, getenv(&quot;INIT_SELINUX_TOOK&quot;));</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Set libavb version for Framework-only OTA match in Treble build.</span><br><span class=\"line\">    const char* avb_version = getenv(&quot;INIT_AVB_VERSION&quot;);</span><br><span class=\"line\">    if (avb_version) property_set(&quot;ro.boot.avb_version&quot;, avb_version);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // See if need to load debug props to allow adb root, when the device is unlocked.</span><br><span class=\"line\">    const char* force_debuggable_env = getenv(&quot;INIT_FORCE_DEBUGGABLE&quot;);</span><br><span class=\"line\">    if (force_debuggable_env &amp;&amp; AvbHandle::IsDeviceUnlocked()) {</span><br><span class=\"line\">        load_debug_prop = &quot;true&quot;s == force_debuggable_env;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Clean up our environment.</span><br><span class=\"line\">    unsetenv(&quot;INIT_STARTED_AT&quot;);</span><br><span class=\"line\">    unsetenv(&quot;INIT_SELINUX_TOOK&quot;);</span><br><span class=\"line\">    unsetenv(&quot;INIT_AVB_VERSION&quot;);</span><br><span class=\"line\">    unsetenv(&quot;INIT_FORCE_DEBUGGABLE&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Now set up SELinux for second stage.</span><br><span class=\"line\">    SelinuxSetupKernelLogging();</span><br><span class=\"line\">    SelabelInitialize();</span><br><span class=\"line\">    SelinuxRestoreContext();</span><br><span class=\"line\"> </span><br><span class=\"line\">    Epoll epoll;</span><br><span class=\"line\">    if (auto result = epoll.Open(); !result) {</span><br><span class=\"line\">        PLOG(FATAL) &lt;&lt; result.error();</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x521D;&#x59CB;&#x5316;single&#x53E5;&#x67C4;</span><br><span class=\"line\">    InstallSignalFdHandler(&amp;epoll);</span><br><span class=\"line\"> </span><br><span class=\"line\">    property_load_boot_defaults(load_debug_prop);</span><br><span class=\"line\">    UmountDebugRamdisk();</span><br><span class=\"line\">    fs_mgr_vendor_overlay_mount_all();</span><br><span class=\"line\">    export_oem_lock_status();</span><br><span class=\"line\">    // &#x5F00;&#x542F;&#x5C5E;&#x6027;&#x670D;&#x52A1;</span><br><span class=\"line\">    StartPropertyService(&amp;epoll);</span><br><span class=\"line\">    MountHandler mount_handler(&amp;epoll);</span><br><span class=\"line\">    set_usb_controller();</span><br><span class=\"line\"> </span><br><span class=\"line\">    const BuiltinFunctionMap function_map;</span><br><span class=\"line\">    Action::set_function_map(&amp;function_map);</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (!SetupMountNamespaces()) {</span><br><span class=\"line\">        PLOG(FATAL) &lt;&lt; &quot;SetupMountNamespaces failed&quot;;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    subcontexts = InitializeSubcontexts();</span><br><span class=\"line\"> </span><br><span class=\"line\">    ActionManager&amp; am = ActionManager::GetInstance();</span><br><span class=\"line\">    ServiceList&amp; sm = ServiceList::GetInstance();</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x89E3;&#x6790;init.rc&#x7B49;&#x76F8;&#x5173;&#x6587;&#x4EF6;</span><br><span class=\"line\">    LoadBootScripts(am, sm);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Turning this on and letting the INFO logging be discarded adds 0.2s to</span><br><span class=\"line\">    // Nexus 9 boot time, so it&apos;s disabled by default.</span><br><span class=\"line\">    if (false) DumpState();</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Make the GSI status available before scripts start running.</span><br><span class=\"line\">    if (android::gsi::IsGsiRunning()) {</span><br><span class=\"line\">        property_set(&quot;ro.gsid.image_running&quot;, &quot;1&quot;);</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        property_set(&quot;ro.gsid.image_running&quot;, &quot;0&quot;);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    am.QueueBuiltinAction(SetupCgroupsAction, &quot;SetupCgroups&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    am.QueueEventTrigger(&quot;early-init&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Queue an action that waits for coldboot done so we know ueventd has set up all of /dev...</span><br><span class=\"line\">    am.QueueBuiltinAction(wait_for_coldboot_done_action, &quot;wait_for_coldboot_done&quot;);</span><br><span class=\"line\">    // ... so that we can start queuing up actions that require stuff from /dev.</span><br><span class=\"line\">    am.QueueBuiltinAction(MixHwrngIntoLinuxRngAction, &quot;MixHwrngIntoLinuxRng&quot;);</span><br><span class=\"line\">    am.QueueBuiltinAction(SetMmapRndBitsAction, &quot;SetMmapRndBits&quot;);</span><br><span class=\"line\">    am.QueueBuiltinAction(SetKptrRestrictAction, &quot;SetKptrRestrict&quot;);</span><br><span class=\"line\">    Keychords keychords;</span><br><span class=\"line\">    am.QueueBuiltinAction(</span><br><span class=\"line\">        [&amp;epoll, &amp;keychords](const BuiltinArguments&amp; args) -&gt; Result&lt;Success&gt; {</span><br><span class=\"line\">            for (const auto&amp; svc : ServiceList::GetInstance()) {</span><br><span class=\"line\">                keychords.Register(svc-&gt;keycodes());</span><br><span class=\"line\">            }</span><br><span class=\"line\">            keychords.Start(&amp;epoll, HandleKeychord);</span><br><span class=\"line\">            return Success();</span><br><span class=\"line\">        },</span><br><span class=\"line\">        &quot;KeychordInit&quot;);</span><br><span class=\"line\">    am.QueueBuiltinAction(console_init_action, &quot;console_init&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Trigger all the boot actions to get us started.</span><br><span class=\"line\">    am.QueueEventTrigger(&quot;init&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Starting the BoringSSL self test, for NIAP certification compliance.</span><br><span class=\"line\">    am.QueueBuiltinAction(StartBoringSslSelfTest, &quot;StartBoringSslSelfTest&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Repeat mix_hwrng_into_linux_rng in case /dev/hw_random or /dev/random</span><br><span class=\"line\">    // wasn&apos;t ready immediately after wait_for_coldboot_done</span><br><span class=\"line\">    am.QueueBuiltinAction(MixHwrngIntoLinuxRngAction, &quot;MixHwrngIntoLinuxRng&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Initialize binder before bringing up other system services</span><br><span class=\"line\">    am.QueueBuiltinAction(InitBinder, &quot;InitBinder&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Don&apos;t mount filesystems or start core system services in charger mode.</span><br><span class=\"line\">    std::string bootmode = GetProperty(&quot;ro.bootmode&quot;, &quot;&quot;);</span><br><span class=\"line\">    if (bootmode == &quot;charger&quot;) {</span><br><span class=\"line\">        am.QueueEventTrigger(&quot;charger&quot;);</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        am.QueueEventTrigger(&quot;late-init&quot;);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Run all property triggers based on current state of the properties.</span><br><span class=\"line\">    am.QueueBuiltinAction(queue_property_triggers_action, &quot;queue_property_triggers&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    while (true) {</span><br><span class=\"line\">        // By default, sleep until something happens.</span><br><span class=\"line\">        auto epoll_timeout = std::optional&lt;std::chrono::milliseconds&gt;{};</span><br><span class=\"line\">        if (do_shutdown &amp;&amp; !shutting_down) {</span><br><span class=\"line\">            do_shutdown = false;</span><br><span class=\"line\">            if (HandlePowerctlMessage(shutdown_command)) {</span><br><span class=\"line\">                shutting_down = true;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        if (!(waiting_for_prop || Service::is_exec_service_running())) {</span><br><span class=\"line\">            am.ExecuteOneCommand();</span><br><span class=\"line\">        }</span><br><span class=\"line\">        if (!(waiting_for_prop || Service::is_exec_service_running())) {</span><br><span class=\"line\">            if (!shutting_down) {</span><br><span class=\"line\">                auto next_process_action_time = HandleProcessActions();</span><br><span class=\"line\">                // If there&apos;s a process that needs restarting, wake up in time for that.</span><br><span class=\"line\">                if (next_process_action_time) {</span><br><span class=\"line\">                    epoll_timeout = std::chrono::ceil&lt;std::chrono::milliseconds&gt;(</span><br><span class=\"line\">                            *next_process_action_time - boot_clock::now());</span><br><span class=\"line\">                    if (*epoll_timeout &lt; 0ms) epoll_timeout = 0ms;</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            // If there&apos;s more work to do, wake up again immediately.</span><br><span class=\"line\">            if (am.HasMoreCommands()) epoll_timeout = 0ms;</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        if (auto result = epoll.Wait(epoll_timeout); !result) {</span><br><span class=\"line\">            LOG(ERROR) &lt;&lt; result.error();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return 0;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;SecondStageMain&#x4E2D;&#x4E3B;&#x8981;&#x5206;&#x4E3A;4&#x6B65;</p>\n<ol>\n<li>&#x521D;&#x59CB;&#x5316;&#x5C5E;&#x6027;&#x670D;&#x52A1;</li>\n<li>&#x521D;&#x59CB;&#x5316;single&#x53E5;&#x67C4;</li>\n<li>&#x5F00;&#x542F;&#x5C5E;&#x6027;&#x670D;&#x52A1;</li>\n<li>&#x89E3;&#x6790;.rc&#x6587;&#x4EF6;</li>\n</ol>\n<h2 id=\"&#x521D;&#x59CB;&#x5316;&#x5C5E;&#x6027;&#x670D;&#x52A1;\"><a href=\"#&#x521D;&#x59CB;&#x5316;&#x5C5E;&#x6027;&#x670D;&#x52A1;\" class=\"headerlink\" title=\"&#x521D;&#x59CB;&#x5316;&#x5C5E;&#x6027;&#x670D;&#x52A1;\"></a>&#x521D;&#x59CB;&#x5316;&#x5C5E;&#x6027;&#x670D;&#x52A1;</h2><blockquote>\n<p>system/core/init/property_service.cpp</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void property_init() {</span><br><span class=\"line\">    mkdir(&quot;/dev/__properties__&quot;, S_IRWXU | S_IXGRP | S_IXOTH);</span><br><span class=\"line\">    CreateSerializedPropertyInfo();</span><br><span class=\"line\">    if (__system_property_area_init()) {</span><br><span class=\"line\">        LOG(FATAL) &lt;&lt; &quot;Failed to initialize property area&quot;;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    if (!property_info_area.LoadDefaultPath()) {</span><br><span class=\"line\">        LOG(FATAL) &lt;&lt; &quot;Failed to load serialized property info file&quot;;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E3B;&#x8981;&#x65B9;&#x6CD5;&#x662F;__system_property_area_init()&#xFF0C;&#x7528;&#x6765;&#x521B;&#x5EFA;&#x8DE8;&#x8FDB;&#x7A0B;&#x5185;&#x5B58;&#xFF0C;&#x4E3B;&#x8981;&#x64CD;&#x4F5C;&#x4E3A;</p>\n<ol>\n<li>&#x6267;&#x884C;open&#xFF0C;&#x6253;&#x5F00;dev/properities&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x6587;&#x4EF6;&#xFF0C;&#x5927;&#x5C0F;&#x4E3A;128KB</li>\n<li>&#x6267;&#x884C;mmap&#xFF0C;&#x5C06;&#x5185;&#x5B58;&#x6620;&#x5C04;&#x5230;init&#x8FDB;&#x7A0B;</li>\n<li>&#x5C06;&#x8BE5;&#x5185;&#x5B58;&#x7684;&#x9996;&#x5730;&#x5740;&#x4FDD;&#x5B58;&#x5728;&#x5168;&#x5C40;&#x53D8;&#x91CF;<strong>system_property_area</strong>&#xFF0C;&#x540E;&#x7EED;&#x7684;&#x589E;&#x52A0;&#x6216;&#x8005;&#x4FEE;&#x6539;&#x5C5E;&#x6027;&#x90FD;&#x57FA;&#x4E8E;&#x8BE5;&#x53D8;&#x91CF;&#x6765;&#x8BA1;&#x7B97;&#x4F4D;&#x7F6E;&#x3002;</li>\n</ol>\n<h2 id=\"&#x521D;&#x59CB;&#x5316;single&#x53E5;&#x67C4;\"><a href=\"#&#x521D;&#x59CB;&#x5316;single&#x53E5;&#x67C4;\" class=\"headerlink\" title=\"&#x521D;&#x59CB;&#x5316;single&#x53E5;&#x67C4;\"></a>&#x521D;&#x59CB;&#x5316;single&#x53E5;&#x67C4;</h2><blockquote>\n<p>system/core/init/init.cpp</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static void InstallSignalFdHandler(Epoll* epoll) {</span><br><span class=\"line\">    // Applying SA_NOCLDSTOP to a defaulted SIGCHLD handler prevents the signalfd from receiving</span><br><span class=\"line\">    // SIGCHLD when a child process stops or continues (b/77867680#comment9).</span><br><span class=\"line\">    const struct sigaction act { .sa_handler = SIG_DFL, .sa_flags = SA_NOCLDSTOP };</span><br><span class=\"line\">    sigaction(SIGCHLD, &amp;act, nullptr);</span><br><span class=\"line\"> </span><br><span class=\"line\">    sigset_t mask;</span><br><span class=\"line\">    sigemptyset(&amp;mask);</span><br><span class=\"line\">    sigaddset(&amp;mask, SIGCHLD);</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (!IsRebootCapable()) {</span><br><span class=\"line\">        // If init does not have the CAP_SYS_BOOT capability, it is running in a container.</span><br><span class=\"line\">        // In that case, receiving SIGTERM will cause the system to shut down.</span><br><span class=\"line\">        sigaddset(&amp;mask, SIGTERM);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (sigprocmask(SIG_BLOCK, &amp;mask, nullptr) == -1) {</span><br><span class=\"line\">        PLOG(FATAL) &lt;&lt; &quot;failed to block signals&quot;;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Register a handler to unblock signals in the child processes.</span><br><span class=\"line\">    const int result = pthread_atfork(nullptr, nullptr, &amp;UnblockSignals);</span><br><span class=\"line\">    if (result != 0) {</span><br><span class=\"line\">        LOG(FATAL) &lt;&lt; &quot;Failed to register a fork handler: &quot; &lt;&lt; strerror(result);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    signal_fd = signalfd(-1, &amp;mask, SFD_CLOEXEC);</span><br><span class=\"line\">    if (signal_fd == -1) {</span><br><span class=\"line\">        PLOG(FATAL) &lt;&lt; &quot;failed to create signalfd&quot;;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (auto result = epoll-&gt;RegisterHandler(signal_fd, HandleSignalFd); !result) {</span><br><span class=\"line\">        LOG(FATAL) &lt;&lt; result.error();</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;&#x5728;&#x5904;&#x7406;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;&#x9001;&#x7684;signal&#x4FE1;&#x53F7;&#x65F6;&#x90FD;&#x9700;&#x8981;&#x5148;&#x6CE8;&#x518C;&#xFF0C;&#x5F53;&#x8FDB;&#x7A0B;&#x7684;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x6539;&#x53D8;&#x6216;&#x7EC8;&#x6B62;&#x65F6;&#x4F1A;&#x4EA7;&#x751F;&#x67D0;&#x79CD;signal&#x4FE1;&#x53F7;&#xFF0C;init&#x8FDB;&#x7A0B;&#x662F;&#x6240;&#x6709;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x8FDB;&#x7A0B;&#x7684;&#x7236;&#x8FDB;&#x7A0B;&#xFF0C;&#x5F53;&#x5176;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;&#x65F6;&#x4EA7;&#x751F;signal&#x4FE1;&#x53F7;&#x3002;&#x4EE5;&#x4FBF;&#x7236;&#x8FDB;&#x7A0B;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</p>\n<p>&#x4E3B;&#x8981;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x5B50;&#x8FDB;&#x7A0B;&#x6210;&#x4E3A;&#x50F5;&#x5C38;&#x8FDB;&#x7A0B;&#x3002;</p>\n<p>&#x4F55;&#x4E3A;&#x50F5;&#x5C38;&#x8FDB;&#x7A0B;&#xFF1F;</p>\n<p>&#x7236;&#x8FDB;&#x7A0B;&#x4F7F;&#x7528;fork&#x521B;&#x5EFA;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x7236;&#x8FDB;&#x7A0B;&#x4E0D;&#x77E5;&#x9053;&#x5B50;&#x8FDB;&#x7A0B;&#x5DF2;&#x7ECF;&#x7EC8;&#x6B62;&#x7684;&#x8BDD;&#xFF0C;&#x8FD9;&#x65F6;&#x5B50;&#x8FDB;&#x7A0B;&#x867D;&#x7136;&#x5DF2;&#x7ECF;&#x9000;&#x51FA;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;&#x8868;&#x4E2D;&#x8FD8;&#x4E3A;&#x5B83;&#x4FDD;&#x7559;&#x4E86;&#x4E00;&#x4E9B;&#x4FE1;&#x606F;&#xFF08;&#x5982;&#x8FDB;&#x7A0B;&#x53F7;&#x3001;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x3001;&#x9000;&#x51FA;&#x72B6;&#x6001;&#x7B49;&#xFF09;&#xFF0C;&#x8FD9;&#x4E2A;&#x5B50;&#x8FDB;&#x7A0B;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684;&#x50F5;&#x5C38;&#x8FDB;&#x7A0B;&#x3002;&#x5176;&#x4E2D;&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;&#x8868;&#x662F;&#x4E00;&#x9879;&#x6709;&#x9650;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x5982;&#x679C;&#x5B83;&#x88AB;&#x50F5;&#x5C38;&#x8FDB;&#x7A0B;&#x8017;&#x5C3D;&#x7684;&#x8BDD;&#xFF0C;&#x7CFB;&#x7EDF;&#x53EF;&#x80FD;&#x4F1A;&#x65E0;&#x6CD5;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x8FDB;&#x7A0B;&#x3002;</p>\n<p>&#x901A;&#x8FC7;epoll&#x8FDB;&#x884C;&#x6CE8;&#x518C;&#x53E5;&#x67C4;&#xFF0C;&#x6700;&#x540E;&#x4F1A;&#x7531;HandleSignalFd&#x8FDB;&#x884C;&#x56DE;&#x8C03;&#x64CD;&#x4F5C;&#x3002;</p>\n<p>epoll&#x53C8;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</p>\n<p>&#x5728;Linux&#x7684;&#x65B0;&#x5185;&#x6838;&#x4E2D;&#xFF0C;epoll&#x662F;&#x7528;&#x6765;&#x53D6;&#x4EE3;select/poll&#x7684;&#xFF0C;&#x5B83;&#x662F;Linux&#x5185;&#x6838;&#x4E3A;&#x5904;&#x7406;&#x5927;&#x6279;&#x91CF;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x7684;&#x6539;&#x8FDB;&#x7248;poll&#xFF0C;&#x662F;Linux&#x4E0B;&#x591A;&#x8DEF;&#x590D;&#x7528;I/O&#x63A5;&#x53E3;select/poll&#x7684;&#x589E;&#x5F3A;&#x7248;&#xFF0C;&#x5B83;&#x80FD;&#x663E;&#x8457;&#x63D0;&#x5347;&#x7A0B;&#x5E8F;&#x5728;&#x5927;&#x91CF;&#x5E76;&#x53D1;&#x8FDE;&#x63A5;&#x4E2D;&#x53EA;&#x6709;&#x5C11;&#x91CF;&#x6D3B;&#x8DC3;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x7684;&#x7CFB;&#x7EDF;CPU&#x5229;&#x7528;&#x7387;&#x3002;</p>\n<p>epoll&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x4E86;&#x7EA2;&#x9ED1;&#x6811;&#xFF0C;&#x6240;&#x4EE5;&#x67E5;&#x627E;&#x6548;&#x7387;&#x6BD4;&#x4F7F;&#x7528;&#x6570;&#x7EC4;&#x7684;select&#x66F4;&#x5FEB;&#x3002;</p>\n<h2 id=\"&#x5F00;&#x542F;&#x5C5E;&#x6027;&#x670D;&#x52A1;\"><a href=\"#&#x5F00;&#x542F;&#x5C5E;&#x6027;&#x670D;&#x52A1;\" class=\"headerlink\" title=\"&#x5F00;&#x542F;&#x5C5E;&#x6027;&#x670D;&#x52A1;\"></a>&#x5F00;&#x542F;&#x5C5E;&#x6027;&#x670D;&#x52A1;</h2><blockquote>\n<p>system/core/init/property_service.cpp</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void StartPropertyService(Epoll* epoll) {</span><br><span class=\"line\">    selinux_callback cb;</span><br><span class=\"line\">    cb.func_audit = SelinuxAuditCallback;</span><br><span class=\"line\">    selinux_set_callback(SELINUX_CB_AUDIT, cb);</span><br><span class=\"line\"> </span><br><span class=\"line\">    property_set(&quot;ro.property_service.version&quot;, &quot;2&quot;);</span><br><span class=\"line\">    property_set_fd = CreateSocket(PROP_SERVICE_NAME, SOCK_STREAM | SOCK_CLOEXEC | SOCK_NONBLOCK,</span><br><span class=\"line\">                                   false, 0666, 0, 0, nullptr);</span><br><span class=\"line\">    if (property_set_fd == -1) {</span><br><span class=\"line\">        PLOG(FATAL) &lt;&lt; &quot;start_property_service socket creation failed&quot;;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    listen(property_set_fd, 8);</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (auto result = epoll-&gt;RegisterHandler(property_set_fd, handle_property_set_fd); !result) {</span><br><span class=\"line\">        PLOG(FATAL) &lt;&lt; result.error();</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E3B;&#x8981;&#x505A;&#x7684;&#x4EFB;&#x52A1;&#x662F;&#xFF1A;</p>\n<ol>\n<li>&#x521B;&#x5EFA;&#x975E;&#x963B;&#x585E;&#x5F0F;&#x7684;Socket&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;property_set_fd&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x3002;</li>\n<li>&#x4F7F;&#x7528;listen()&#x51FD;&#x6570;&#x53BB;&#x76D1;&#x542C;property_set_fd&#xFF0C;&#x6B64;&#x65F6;Socket&#x5373;&#x6210;&#x4E3A;&#x5C5E;&#x6027;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x5E76;&#x4E14;&#x5B83;&#x6700;&#x591A;&#x540C;&#x65F6;&#x53EF;&#x4E3A;8&#x4E2A;&#x8BD5;&#x56FE;&#x8BBE;&#x7F6E;&#x5C5E;&#x6027;&#x7684;&#x7528;&#x6237;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x3002;</li>\n<li>&#x4F7F;&#x7528;epoll&#x6CE8;&#x518C;&#xFF0C;&#x5F53;property_set_fd&#x4E2D;&#x6709;&#x6570;&#x636E;&#x5230;&#x6765;&#x65F6;&#xFF0C;init&#x8FDB;&#x7A0B;&#x5C06;&#x8C03;&#x7528;handle_property_set_fd()&#x51FD;&#x6570;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</li>\n</ol>\n<h2 id=\"&#x89E3;&#x6790;-rc&#x6587;&#x4EF6;\"><a href=\"#&#x89E3;&#x6790;-rc&#x6587;&#x4EF6;\" class=\"headerlink\" title=\"&#x89E3;&#x6790;.rc&#x6587;&#x4EF6;\"></a>&#x89E3;&#x6790;.rc&#x6587;&#x4EF6;</h2><blockquote>\n<p>system/core/init/init.cpp</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static void LoadBootScripts(ActionManager&amp; action_manager, ServiceList&amp; service_list) {</span><br><span class=\"line\">    Parser parser = CreateParser(action_manager, service_list);</span><br><span class=\"line\"> </span><br><span class=\"line\">    std::string bootscript = GetProperty(&quot;ro.boot.init_rc&quot;, &quot;&quot;);</span><br><span class=\"line\">    if (bootscript.empty()) {</span><br><span class=\"line\">        parser.ParseConfig(&quot;/init.rc&quot;);</span><br><span class=\"line\">        if (!parser.ParseConfig(&quot;/system/etc/init&quot;)) {</span><br><span class=\"line\">            late_import_paths.emplace_back(&quot;/system/etc/init&quot;);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        if (!parser.ParseConfig(&quot;/product/etc/init&quot;)) {</span><br><span class=\"line\">            late_import_paths.emplace_back(&quot;/product/etc/init&quot;);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        if (!parser.ParseConfig(&quot;/product_services/etc/init&quot;)) {</span><br><span class=\"line\">            late_import_paths.emplace_back(&quot;/product_services/etc/init&quot;);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        if (!parser.ParseConfig(&quot;/odm/etc/init&quot;)) {</span><br><span class=\"line\">            late_import_paths.emplace_back(&quot;/odm/etc/init&quot;);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        if (!parser.ParseConfig(&quot;/vendor/etc/init&quot;)) {</span><br><span class=\"line\">            late_import_paths.emplace_back(&quot;/vendor/etc/init&quot;);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        parser.ParseConfig(bootscript);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;ParseConfig&#x6765;&#x89E3;&#x6790;init.rc&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</p>\n<p>.rc&#x6587;&#x4EF6;&#x8BED;&#x6CD5;&#x662F;&#x4EE5;&#x884C;&#x5C3E;&#x5355;&#x4F4D;&#xFF0C;&#x4EE5;&#x7A7A;&#x683C;&#x95F4;&#x9694;&#x7684;&#x8BED;&#x6CD5;&#xFF0C;&#x4EE5;#&#x5F00;&#x59CB;&#x4EE3;&#x8868;&#x6CE8;&#x91CA;&#x884C;&#x3002;.rc&#x6587;&#x4EF6;&#x4E3B;&#x8981;&#x5305;&#x542B;Action&#x3001;Service&#x3001;Command&#x3001;Options&#x3001;Import&#xFF0C;&#x5176;&#x4E2D;&#x5BF9;&#x4E8E;Action&#x548C;Service&#x7684;&#x540D;&#x79F0;&#x90FD;&#x662F;&#x552F;&#x4E00;&#x7684;&#xFF0C;&#x5BF9;&#x4E8E;&#x91CD;&#x590D;&#x7684;&#x547D;&#x540D;&#x89C6;&#x4E3A;&#x65E0;&#x6548;&#x3002;</p>\n<p>init.rc&#x4E2D;&#x7684;Action&#x3001;Service&#x8BED;&#x53E5;&#x90FD;&#x6709;&#x76F8;&#x5E94;&#x7684;&#x7C7B;&#x6765;&#x89E3;&#x6790;&#xFF0C;&#x5373;ActionParser&#x3001;ServiceParser&#x3002;</p>\n<p>&#x5728;&#x89E3;&#x6790;init.rc&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x8FDB;&#x884C;&#x542F;&#x52A8;Zygote&#x3002;</p>\n<blockquote>\n<p>&#x5173;&#x4E8E;Zygote&#x7684;&#x542F;&#x52A8;&#x540E;&#x7EED;&#x518D;&#x5206;&#x6790;&#x3002;</p>\n</blockquote>\n<p>&#x4ECA;&#x5929;&#x4E3B;&#x8981;&#x5C1D;&#x8BD5;&#x5206;&#x6790;&#x4E86;&#x4E00;&#x4E0B;Android&#x5728;Linux&#x7CFB;&#x7EDF;&#x4E0B;&#x7684;init&#x542F;&#x52A8;&#x6D89;&#x53CA;&#x7684;&#x4E3B;&#x8981;&#x6D41;&#x7A0B;&#x3002;</p>\n<p>&#x53EF;&#x89C1;init&#x542F;&#x52A8;&#x4E3B;&#x8981;&#x6D89;&#x53CA;&#x7684;&#x5DE5;&#x4F5C;&#x662F;&#xFF1A;</p>\n<ol>\n<li>&#x521B;&#x5EFA;&#x4E0E;&#x6302;&#x8F7D;&#x542F;&#x52A8;&#x6240;&#x9700;&#x8981;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</li>\n<li>&#x521D;&#x59CB;&#x5316;&#x5C5E;&#x6027;&#x670D;&#x52A1;</li>\n<li>&#x521B;&#x5EFA;single&#x53E5;&#x67C4;&#xFF0C;&#x6765;&#x76D1;&#x542C;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x9632;&#x6B62;&#x50F5;&#x5C38;&#x8FDB;&#x7A0B;&#x7684;&#x4EA7;&#x751F;</li>\n<li>&#x5F00;&#x542F;&#x5C5E;&#x6027;&#x670D;&#x52A1;</li>\n<li>&#x89E3;&#x6790;.rc&#x6587;&#x4EF6;&#x5E76;&#x542F;&#x52A8;Zygote&#x8FDB;&#x7A0B;</li>\n</ol>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["启动"]},{"title":"Jetpack:DataStore必知的几个优点","url":"https://www.rousetime.com/2020/12/06/Jetpack-DataStore必知的几个优点/","content":"<p>&#x6700;&#x8FD1;Jetpack&#x53C8;&#x589E;&#x52A0;&#x4E86;&#x65B0;&#x6210;&#x5458;&#xFF0C;&#x63D0;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;&#x5173;&#x4E8E;&#x5C0F;&#x578B;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x76F8;&#x5173;&#x7684;DataStore&#x7EC4;&#x4EF6;&#x3002;</p>\n<p>&#x6839;&#x636E;&#x5B98;&#x7F51;&#x7684;&#x63CF;&#x8FF0;&#xFF0C;DataStore&#x5B8C;&#x5168;&#x662F;&#x5BF9;&#x6807;&#x73B0;&#x6709;&#x7684;SharedPreferences&#x3002;</p>\n<p>SharedPreferences&#x76F8;&#x4FE1;&#x5927;&#x5BB6;&#x90FD;&#x6709;&#x7528;&#x8FC7;&#xFF0C;&#x65E2;&#x7136;&#x5728;&#x73B0;&#x6709;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x63D0;&#x51FA;DataStore&#x90A3;&#x81EA;&#x7136;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;SharedPreferences&#x7684;&#x7F3A;&#x70B9;&#x7684;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;SharedPreferences&#x6709;&#x4EC0;&#x4E48;&#x7F3A;&#x70B9;&#xFF1F;&#x6CA1;&#x5173;&#x7CFB;&#xFF0C;&#x6211;&#x4EEC;&#x6B63;&#x597D;&#x6765;&#x590D;&#x4E60;&#x4E00;&#x904D;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x5BF9;&#x6807;&#x4E00;&#x4E0B;&#x5728;&#x4F7F;&#x7528;SharedPreferences&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x662F;&#x5426;&#x4E5F;&#x9047;&#x5230;&#x8FC7;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x3002;</p>\n<h2 id=\"SharedPreferences&#x7684;&#x7CDF;&#x5FC3;&#x4E8B;\"><a href=\"#SharedPreferences&#x7684;&#x7CDF;&#x5FC3;&#x4E8B;\" class=\"headerlink\" title=\"SharedPreferences&#x7684;&#x7CDF;&#x5FC3;&#x4E8B;\"></a>SharedPreferences&#x7684;&#x7CDF;&#x5FC3;&#x4E8B;</h2><p>&#x4E3A;&#x4E86;&#x7CBE;&#x7B80;&#x8BED;&#x8A00;&#xFF0C;&#x4E0B;&#x9762;&#x90FD;&#x5C06;SharedPreferences&#x7B80;&#x79F0;sp</p>\n<h3 id=\"&#x4E00;&#x6B21;&#x6027;&#x8BFB;&#x53D6;&#x963B;&#x585E;&#x4E3B;&#x7EBF;&#x7A0B;\"><a href=\"#&#x4E00;&#x6B21;&#x6027;&#x8BFB;&#x53D6;&#x963B;&#x585E;&#x4E3B;&#x7EBF;&#x7A0B;\" class=\"headerlink\" title=\"&#x4E00;&#x6B21;&#x6027;&#x8BFB;&#x53D6;&#x963B;&#x585E;&#x4E3B;&#x7EBF;&#x7A0B;\"></a>&#x4E00;&#x6B21;&#x6027;&#x8BFB;&#x53D6;&#x963B;&#x585E;&#x4E3B;&#x7EBF;&#x7A0B;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sp = getSharedPreferences(&quot;settings_preference&quot;, Context.MODE_PRIVATE)</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x4F7F;&#x7528;sp&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x4F1A;&#x901A;&#x8FC7;getSharedPreferences&#x6765;&#x521D;&#x59CB;&#x5316;sp&#x3002;</p>\n<p>&#x4E0A;&#x9762;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6700;&#x7EC8;&#x4F1A;&#x8FDB;&#x5165;SharedPreferencesImpl&#x7684;loadFromDisk&#x65B9;&#x6CD5;&#x3002;</p>\n<blockquote>\n<p>&#x5177;&#x4F53;&#x8C03;&#x7528;&#x5C31;&#x4E0D;&#x5E26;&#x5927;&#x5BB6;&#x8D70;&#x4E00;&#x904D;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x90FD;&#x8D34;&#x51FA;&#x6765;&#x6587;&#x7AE0;&#x5C31;&#x53D8;&#x6210;&#x4EE3;&#x7801;&#x7C98;&#x8D34;&#x677F;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x5173;&#x6CE8;&#x6838;&#x5FC3;&#x903B;&#x8F91;&#xFF0C;&#x5176;&#x5B83;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x67E5;&#x770B;&#x6E90;&#x7801;</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void loadFromDisk() {</span><br><span class=\"line\">    synchronized (mLock) {</span><br><span class=\"line\">        if (mLoaded) {</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        if (mBackupFile.exists()) {</span><br><span class=\"line\">            mFile.delete();</span><br><span class=\"line\">            mBackupFile.renameTo(mFile);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Debugging</span><br><span class=\"line\">    if (mFile.exists() &amp;&amp; !mFile.canRead()) {</span><br><span class=\"line\">        Log.w(TAG, &quot;Attempt to read preferences file &quot; + mFile + &quot; without permission&quot;);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    Map&lt;String, Object&gt; map = null;</span><br><span class=\"line\">    StructStat stat = null;</span><br><span class=\"line\">    Throwable thrown = null;</span><br><span class=\"line\">    try {</span><br><span class=\"line\">        stat = Os.stat(mFile.getPath());</span><br><span class=\"line\">        if (mFile.canRead()) {</span><br><span class=\"line\">            BufferedInputStream str = null;</span><br><span class=\"line\">            try {</span><br><span class=\"line\">                str = new BufferedInputStream(</span><br><span class=\"line\">                        new FileInputStream(mFile), 16 * 1024);</span><br><span class=\"line\">                map = (Map&lt;String, Object&gt;) XmlUtils.readMapXml(str);</span><br><span class=\"line\">            } catch (Exception e) {</span><br><span class=\"line\">                Log.w(TAG, &quot;Cannot read &quot; + mFile.getAbsolutePath(), e);</span><br><span class=\"line\">            } finally {</span><br><span class=\"line\">                IoUtils.closeQuietly(str);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    } catch (ErrnoException e) {</span><br><span class=\"line\">        // An errno exception means the stat failed. Treat as empty/non-existing by</span><br><span class=\"line\">        // ignoring.</span><br><span class=\"line\">    } catch (Throwable t) {</span><br><span class=\"line\">        thrown = t;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    synchronized (mLock) {</span><br><span class=\"line\">        mLoaded = true;</span><br><span class=\"line\">        mThrowable = thrown;</span><br><span class=\"line\"> </span><br><span class=\"line\">        // It&apos;s important that we always signal waiters, even if we&apos;ll make</span><br><span class=\"line\">        // them fail with an exception. The try-finally is pretty wide, but</span><br><span class=\"line\">        // better safe than sorry.</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            if (thrown == null) {</span><br><span class=\"line\">                if (map != null) {</span><br><span class=\"line\">                    mMap = map;</span><br><span class=\"line\">                    mStatTimestamp = stat.st_mtim;</span><br><span class=\"line\">                    mStatSize = stat.st_size;</span><br><span class=\"line\">                } else {</span><br><span class=\"line\">                    mMap = new HashMap&lt;&gt;();</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">            // In case of a thrown exception, we retain the old map. That allows</span><br><span class=\"line\">            // any open editors to commit and store updates.</span><br><span class=\"line\">        } catch (Throwable t) {</span><br><span class=\"line\">            mThrowable = t;</span><br><span class=\"line\">        } finally {</span><br><span class=\"line\">            mLock.notifyAll();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x901A;&#x8FC7;&#x5BF9;&#x8C61;&#x9501;mLock&#x673A;&#x5236;&#x6765;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x52A0;&#x9501;&#x64CD;&#x4F5C;&#x3002;&#x53EA;&#x6709;&#x5F53;sp&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5168;&#x90E8;&#x8BFB;&#x53D6;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#x624D;&#x4F1A;&#x8C03;&#x7528;mLock.notifyAll()&#x6765;&#x91CA;&#x653E;&#x9501;&#x3002;</p>\n<p>&#x800C;&#x53E6;&#x4E00;&#x8FB9;&#x5BF9;&#x5E94;&#x7684;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x7684;get&#x65B9;&#x6CD5;&#xFF0C;&#x4F8B;&#x5982;getString&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public String getString(String key, @Nullable String defValue) {</span><br><span class=\"line\">    synchronized (mLock) {</span><br><span class=\"line\">        awaitLoadedLocked();</span><br><span class=\"line\">        String v = (String)mMap.get(key);</span><br><span class=\"line\">        return v != null ? v : defValue;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">private void awaitLoadedLocked() {</span><br><span class=\"line\">    if (!mLoaded) {</span><br><span class=\"line\">        // Raise an explicit StrictMode onReadFromDisk for this</span><br><span class=\"line\">        // thread, since the real read will be in a different</span><br><span class=\"line\">        // thread and otherwise ignored by StrictMode.</span><br><span class=\"line\">        BlockGuard.getThreadPolicy().onReadFromDisk();</span><br><span class=\"line\">    }</span><br><span class=\"line\">    while (!mLoaded) {</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            mLock.wait(); // &#x7B49;&#x5F85;sp&#x6587;&#x4EF6;&#x8BFB;&#x53D6;&#x5B8C;&#x6BD5;</span><br><span class=\"line\">        } catch (InterruptedException unused) {</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    if (mThrowable != null) {</span><br><span class=\"line\">        throw new IllegalStateException(mThrowable);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x4F1A;&#x5728;awaitLoadedLocked&#x65B9;&#x6CD5;&#x4E2D;&#x8C03;&#x7528;mLock.wait()&#x6765;&#x7B49;&#x5F85;sp&#x7684;&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6210;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x5982;&#x679C;sp&#x6587;&#x4EF6;&#x8FC7;&#x5927;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x6240;&#x82B1;&#x7684;&#x65F6;&#x95F4;&#x8FC7;&#x591A;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x540E;&#x9762;sp&#x6570;&#x636E;&#x83B7;&#x53D6;&#x65F6;&#x7684;&#x963B;&#x585E;&#x3002;</p>\n<h3 id=\"&#x7C7B;&#x578B;&#x4E0D;&#x5B89;&#x5168;\"><a href=\"#&#x7C7B;&#x578B;&#x4E0D;&#x5B89;&#x5168;\" class=\"headerlink\" title=\"&#x7C7B;&#x578B;&#x4E0D;&#x5B89;&#x5168;\"></a>&#x7C7B;&#x578B;&#x4E0D;&#x5B89;&#x5168;</h3><p>&#x5728;&#x6211;&#x4EEC;&#x4F7F;&#x7528;sp&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x7528;&#x7684;&#x6700;&#x591A;&#x7684;&#x5E94;&#x8BE5;&#x662F;&#x5B83;&#x7684;put&#x4E0E;get&#x65B9;&#x6CD5;&#x3002;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7528;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x6765;&#x5199;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sp = getSharedPreferences(&quot;settings_preference&quot;, Context.MODE_PRIVATE)</span><br><span class=\"line\"> </span><br><span class=\"line\">// &#x67D0;&#x4E00;&#x4E2A;&#x5730;&#x65B9;&#x7684;&#x903B;&#x8F91;</span><br><span class=\"line\">sp.edit().putString(&quot;key_name_from_sp&quot;, &quot;from sp&quot;).apply()</span><br><span class=\"line\"> </span><br><span class=\"line\">// &#x53E6;&#x4E00;&#x4E2A;&#x5730;&#x65B9;&#x7684;&#x903B;&#x8F91;</span><br><span class=\"line\">sp.edit().putInt(&quot;key_name_from_sp&quot;, &quot;from sp&quot;).apply()</span><br><span class=\"line\"> </span><br><span class=\"line\">// &#x83B7;&#x53D6;key_name_from_sp&#x503C;</span><br><span class=\"line\">sp.getString(&quot;key_name_from_sp&quot;, &quot;&quot;)</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x4F60;&#x8FD0;&#x884C;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4F60;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x5F02;&#x5E38;&#xFF0C;&#x672C;&#x8D28;&#x95EE;&#x9898;&#x662F;&#x5BF9;&#x540C;&#x4E00;&#x4E2A;key&#x8D4B;&#x503C;&#x4E86;&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x503C;&#x3002;&#x5C06;&#x539F;&#x6765;String&#x7C7B;&#x578B;&#x7684;&#x503C;&#x8F6C;&#x53D8;&#x6210;Int&#x7C7B;&#x578B;&#x3002;&#x7531;&#x4E8E;sp&#x5185;&#x90E8;&#x662F;&#x901A;&#x8FC7;Map&#x6765;&#x4FDD;&#x5B58;&#x5BF9;&#x4E8E;&#x7684;key-value&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x5E76;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;key-value&#x7684;&#x7C7B;&#x578B;&#x56FA;&#x5B9A;&#xFF0C;&#x4E5F;&#x8FDB;&#x4E00;&#x6B65;&#x5BFC;&#x81F4;&#x901A;&#x8FC7;get&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;key&#x7684;&#x503C;&#x7684;&#x7C7B;&#x578B;&#x4E5F;&#x662F;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#x3002;&#x8FD9;&#x5C31;&#x9020;&#x6210;&#x4E86;&#x6240;&#x8C13;&#x7684;&#x7C7B;&#x578B;&#x4E0D;&#x5B89;&#x5168;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public String getString(String key, @Nullable String defValue) {</span><br><span class=\"line\">    synchronized (mLock) {</span><br><span class=\"line\">        awaitLoadedLocked();</span><br><span class=\"line\">        String v = (String)mMap.get(key);</span><br><span class=\"line\">        return v != null ? v : defValue;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;getString&#x7684;&#x6E90;&#x7801;&#x4E2D;&#xFF0C;&#x4F1A;&#x8FDB;&#x884C;&#x7C7B;&#x578B;&#x5F3A;&#x5236;&#x8F6C;&#x6362;&#xFF0C;&#x5982;&#x679C;&#x7C7B;&#x578B;&#x4E0D;&#x5BF9;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#x7A0B;&#x5E8F;&#x5D29;&#x6E83;&#x3002;&#x7531;&#x4E8E;sp&#x4E0D;&#x4F1A;&#x5728;&#x4EE3;&#x7801;&#x7F16;&#x8BD1;&#x65F6;&#x8FDB;&#x884C;&#x63D0;&#x9192;&#xFF0C;&#x53EA;&#x80FD;&#x5728;&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x4E4B;&#x540E;&#x624D;&#x80FD;&#x53D1;&#x73B0;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x907F;&#x514D;&#x4E0D;&#x6389;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;sp&#x7C7B;&#x578B;&#x4E0D;&#x5B89;&#x5168;&#x3002;</p>\n<h3 id=\"apply&#x5F02;&#x6B65;&#x6CA1;&#x6709;&#x56DE;&#x8C03;\"><a href=\"#apply&#x5F02;&#x6B65;&#x6CA1;&#x6709;&#x56DE;&#x8C03;\" class=\"headerlink\" title=\"apply&#x5F02;&#x6B65;&#x6CA1;&#x6709;&#x56DE;&#x8C03;\"></a>apply&#x5F02;&#x6B65;&#x6CA1;&#x6709;&#x56DE;&#x8C03;</h3><p>&#x4E3A;&#x4E86;&#x9632;&#x6B62;sp&#x5199;&#x5165;&#x65F6;&#x963B;&#x585E;&#x7EBF;&#x7A0B;&#xFF0C;&#x4E00;&#x822C;&#x90FD;&#x4F1A;&#x4F7F;&#x7528;apply&#x65B9;&#x6CD5;&#x6765;&#x5C06;&#x6570;&#x636E;&#x5F02;&#x6B65;&#x63D0;&#x4EA4;&#x5230;&#x78C1;&#x76D8;&#xFF0C;&#x5373;&#x5199;&#x5165;&#x5230;&#x6587;&#x4EF6;&#x4E2D;&#x3002;</p>\n<p>&#x867D;&#x7136;apply&#x662F;&#x5F02;&#x6B65;&#xFF0C;&#x4F46;&#x5B83;&#x5E76;&#x6CA1;&#x6709;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x540C;&#x6837;&#x4E5F;&#x6CA1;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x7ED3;&#x679C;&#x56DE;&#x8C03;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void apply() {</span><br><span class=\"line\">\t...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x5BFC;&#x81F4;ANR\"><a href=\"#&#x5BFC;&#x81F4;ANR\" class=\"headerlink\" title=\"&#x5BFC;&#x81F4;ANR\"></a>&#x5BFC;&#x81F4;ANR</h3><p>apply&#x5F02;&#x6B65;&#x63D0;&#x4EA4;&#x89E3;&#x51B3;&#x4E86;&#x7EBF;&#x7A0B;&#x7684;&#x963B;&#x585E;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x5982;&#x679C;apply&#x4EFB;&#x52A1;&#x8FC7;&#x591A;&#x6570;&#x636E;&#x91CF;&#x8FC7;&#x5927;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;ANR&#x7684;&#x4EA7;&#x751F;&#x3002;</p>\n<p>ANR&#x7684;&#x4EA7;&#x751F;&#x662F;&#x4E3B;&#x7EBF;&#x7A0B;&#x957F;&#x65F6;&#x95F4;&#x672A;&#x54CD;&#x5E94;&#x5BFC;&#x81F4;&#x7684;&#x3002;apply&#x4E0D;&#x662F;&#x5F02;&#x6B65;&#x7684;&#x5417;&#xFF1F;&#x5B83;&#x600E;&#x4E48;&#x53C8;&#x4F1A;&#x4EA7;&#x751F;ANR&#x5462;&#xFF1F;</p>\n<p>&#x6765;&#x770B;&#x4E0B;apply&#x7684;&#x6E90;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void apply() {</span><br><span class=\"line\">    final long startTime = System.currentTimeMillis();</span><br><span class=\"line\"> </span><br><span class=\"line\">    final MemoryCommitResult mcr = commitToMemory();</span><br><span class=\"line\">    final Runnable awaitCommit = new Runnable() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void run() {</span><br><span class=\"line\">                try {</span><br><span class=\"line\">                    mcr.writtenToDiskLatch.await();</span><br><span class=\"line\">                } catch (InterruptedException ignored) {</span><br><span class=\"line\">                }</span><br><span class=\"line\">                if (DEBUG &amp;&amp; mcr.wasWritten) {</span><br><span class=\"line\">                    Log.d(TAG, mFile.getName() + &quot;:&quot; + mcr.memoryStateGeneration</span><br><span class=\"line\">                            + &quot; applied after &quot; + (System.currentTimeMillis() - startTime)</span><br><span class=\"line\">                            + &quot; ms&quot;);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        };</span><br><span class=\"line\"> </span><br><span class=\"line\">    // &#x6CE8;&#x610F;&#xFF1A;&#x5C06;awaitCommit&#x6DFB;&#x52A0;&#x5230;&#x961F;&#x5217;&#x4E2D;</span><br><span class=\"line\">    QueuedWork.addFinisher(awaitCommit);</span><br><span class=\"line\"> </span><br><span class=\"line\">    Runnable postWriteRunnable = new Runnable() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void run() {</span><br><span class=\"line\">                awaitCommit.run();</span><br><span class=\"line\">                // &#x6210;&#x529F;&#x5199;&#x5165;&#x78C1;&#x76D8;&#x4E4B;&#x540E;&#x624D;&#x5C06;awaitCommit&#x79FB;&#x9664;</span><br><span class=\"line\">                QueuedWork.removeFinisher(awaitCommit);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        };</span><br><span class=\"line\"> </span><br><span class=\"line\">    SharedPreferencesImpl.this.enqueueDiskWrite(mcr, postWriteRunnable);</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Okay to notify the listeners before it&apos;s hit disk</span><br><span class=\"line\">    // because the listeners should always get the same</span><br><span class=\"line\">    // SharedPreferences instance back, which has the</span><br><span class=\"line\">    // changes reflected in memory.</span><br><span class=\"line\">    notifyListeners(mcr);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x5173;&#x952E;&#x70B9;&#x662F;&#x4F1A;&#x5C06;awaitCommit&#x52A0;&#x5165;&#x5230;QueuedWork&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x53EA;&#x6709;&#x5F53;awaitCommit&#x6267;&#x884C;&#x5B8C;&#x4E4B;&#x540E;&#x624D;&#x4F1A;&#x8FDB;&#x884C;&#x79FB;&#x9664;&#x3002;</p>\n<p>&#x8FD9;&#x662F;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#x3002;</p>\n<p>&#x5728;Activity&#x7684;onPause&#x4E0E;onStop&#x3001;Service&#x7684;onDestory&#x4E2D;&#x4F1A;&#x7B49;&#x5F85;QueuedWork&#x4E2D;&#x7684;&#x4EFB;&#x52A1;&#x5168;&#x90E8;&#x5B8C;&#x6210;&#xFF0C;&#x4E00;&#x65E6;QueuedWork&#x4E2D;&#x7684;&#x4EFB;&#x52A1;&#x975E;&#x5E38;&#x8017;&#x65F6;&#xFF0C;&#x4F8B;&#x5982;sp&#x7684;&#x5199;&#x5165;&#x78C1;&#x76D8;&#x6570;&#x636E;&#x91CF;&#x8FC7;&#x591A;&#xFF0C;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#x4E3B;&#x7EBF;&#x7A0B;&#x957F;&#x65F6;&#x95F4;&#x672A;&#x54CD;&#x5E94;&#xFF0C;&#x4ECE;&#x800C;&#x4EA7;&#x751F;ANR&#x3002;</p>\n<p>&#x5177;&#x4F53;&#x8C03;&#x7528;&#x5206;&#x522B;&#x5728;ActivityThread&#x4E2D;&#x7684;handlePauseActivity&#x3001;handlePauseActivity&#x4E0E;handleStopService&#x65B9;&#x6CD5;&#x4E2D;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void handlePauseActivity(IBinder token, boolean finished, boolean userLeaving,</span><br><span class=\"line\">        int configChanges, PendingTransactionActions pendingActions, String reason) {</span><br><span class=\"line\">    ActivityClientRecord r = mActivities.get(token);</span><br><span class=\"line\">    if (r != null) {</span><br><span class=\"line\">        if (userLeaving) {</span><br><span class=\"line\">            performUserLeavingActivity(r);</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        r.activity.mConfigChangeFlags |= configChanges;</span><br><span class=\"line\">        performPauseActivity(r, finished, reason, pendingActions);</span><br><span class=\"line\">        // Make sure any pending writes are now committed.</span><br><span class=\"line\">        if (r.isPreHoneycomb()) {</span><br><span class=\"line\">            //&#x7B49;&#x5F85;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;</span><br><span class=\"line\">            QueuedWork.waitToFinish();</span><br><span class=\"line\">        }</span><br><span class=\"line\">        mSomeActivitiesChanged = true;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x90A3;&#x5982;&#x4F55;&#x89E3;&#x51B3;&#x5462;&#xFF1F;&#x9996;&#x5148;&#x4F7F;&#x7528;sp&#x4E0D;&#x8981;&#x5B58;&#x50A8;&#x8FC7;&#x5927;&#x7684;key-value&#x6570;&#x636E;&#xFF0C;&#x672C;&#x8EAB;sp&#x5C31;&#x662F;&#x8F7B;&#x91CF;&#x7684;&#x5B58;&#x50A8;&#xFF0C;&#x5BF9;&#x4E8E;&#x5927;&#x6570;&#x636E;&#x8FD8;&#x662F;&#x4F7F;&#x7528;room&#x6765;&#x5B58;&#x50A8;&#x3002;</p>\n<p>&#x6B64;&#x7C7B;ANR&#x90FD;&#x662F;&#x7ECF;&#x7531;QueuedWork.waitToFinish()&#x89E6;&#x53D1;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x8C03;&#x7528;&#x6B64;&#x51FD;&#x6570;&#x4E4B;&#x524D;&#xFF0C;&#x5C06;&#x5176;&#x4E2D;&#x4FDD;&#x5B58;&#x7684;&#x961F;&#x5217;&#x624B;&#x52A8;&#x6E05;&#x7A7A;&#xFF0C;&#x90A3;&#x4E48;&#x662F;&#x4E0D;&#x662F;&#x80FD;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x5462;&#xFF0C;&#x7B54;&#x6848;&#x662F;&#x80AF;&#x5B9A;&#x7684;&#x3002;</p>\n<p>&#x53E6;&#x5916;&#x5728;&#x4ECA;&#x65E5;&#x5934;&#x6761;&#x7684;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x5DF2;&#x7ECF;&#x63D0;&#x51FA;&#x89E3;&#x51B3;ANR&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5177;&#x4F53;&#x89E3;&#x51B3;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x67E5;&#x770B;</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzI1MzYzMjE0MQ==&amp;mid=2247484387&amp;idx=1&amp;sn=e3c8d6ef52520c51b5e07306d9750e70&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener\">&#x5256;&#x6790; SharedPreference apply &#x5F15;&#x8D77;&#x7684; ANR &#x95EE;&#x9898;</a></p>\n<h3 id=\"&#x4E0D;&#x80FD;&#x8DE8;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;\"><a href=\"#&#x4E0D;&#x80FD;&#x8DE8;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;\" class=\"headerlink\" title=\"&#x4E0D;&#x80FD;&#x8DE8;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;\"></a>&#x4E0D;&#x80FD;&#x8DE8;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;</h3><p>sp&#x662F;&#x4E0D;&#x80FD;&#x8DE8;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;&#x7684;&#xFF0C;&#x867D;&#x7136;&#x5728;&#x83B7;&#x53D6;sp&#x7684;&#x65F6;&#x5019;&#x63D0;&#x4F9B;&#x4E86;MODE_MULTI_PROCESS&#xFF0C;&#x4F46;&#x5185;&#x90E8;&#x5E76;&#x4E0D;&#x662F;&#x7528;&#x6765;&#x8DE8;&#x8FDB;&#x7A0B;&#x7684;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public SharedPreferences getSharedPreferences(File file, int mode) {</span><br><span class=\"line\">    if ((mode &amp; Context.MODE_MULTI_PROCESS) != 0 ||</span><br><span class=\"line\">        getApplicationInfo().targetSdkVersion &lt; android.os.Build.VERSION_CODES.HONEYCOMB) {</span><br><span class=\"line\">        // &#x91CD;&#x65B0;&#x8BFB;&#x53D6;SP&#x6587;&#x4EF6;&#x5185;&#x5BB9;</span><br><span class=\"line\">        sp.startReloadIfChangedUnexpectedly();</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return sp;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;MODE_MULTI_PROCESS&#x53EA;&#x662F;&#x91CD;&#x65B0;&#x8BFB;&#x53D6;&#x4E00;&#x904D;&#x6587;&#x4EF6;&#x800C;&#x5DF2;&#xFF0C;&#x5E76;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x8DE8;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;&#x3002;</p>\n<p>&#x4E0A;&#x9762;&#x7684;sp&#x95EE;&#x9898;&#x4E0D;&#x77E5;&#x9053;&#x4F60;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x662F;&#x5426;&#x6709;&#x9047;&#x5230;&#x8FC7;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x6709;&#x5E78;&#x4E2D;&#x6807;&#x51E0;&#x6761;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x7559;&#x8A00;&#x6765;&#x5BF9;&#x6BD4;&#x4E00;&#x4E0B;&#xFF0C;&#x8BF4;&#x51FA;&#x4F60;&#x7684;&#x6545;&#x4E8B;(&#x6B64;&#x5904;&#x5E94;&#x8BE5;&#x6709;&#x9152;)&#x3002;</p>\n<h2 id=\"DataStore\"><a href=\"#DataStore\" class=\"headerlink\" title=\"DataStore\"></a>DataStore</h2><p>&#x9488;&#x5BF9;sp&#x90A3;&#x51E0;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;DataStore&#x90FD;&#x591F;&#x80FD;&#x89C4;&#x907F;&#x3002;&#x4E3A;&#x4E86;&#x7CBE;&#x7B80;&#x8BED;&#x8A00;&#xFF0C;&#x4E0B;&#x9762;&#x90FD;&#x5C06;DataStore&#x7B80;&#x79F0;ds</p>\n<ol>\n<li>ds&#x5185;&#x90E8;&#x4F7F;&#x7528;kotlin&#x534F;&#x7A0B;&#x901A;&#x8FC7;&#x6302;&#x8D77;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x907F;&#x514D;&#x963B;&#x585E;&#x7EBF;&#x7A0B;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x907F;&#x514D;&#x4EA7;&#x751F;ANR&#x3002;</li>\n<li>ds&#x4E0D;&#x4EC5;&#x652F;&#x6301;sp&#x540C;&#x65F6;&#x8FD8;&#x652F;&#x6301;protocol buffers&#x7C7B;&#x578B;&#x7684;&#x5B58;&#x50A8;&#xFF0C;&#x800C;protocol buffers&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x5B89;&#x5168;&#x3002;</li>\n<li>ds&#x80FD;&#x591F;&#x5728;&#x7F16;&#x8BD1;&#x9636;&#x6BB5;&#x63D0;&#x9192;sp&#x7C7B;&#x578B;&#x9519;&#x8BEF;&#xFF0C;&#x4FDD;&#x8BC1;sp&#x7C7B;&#x578B;&#x7684;&#x7C7B;&#x578B;&#x4E0D;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x3002;</li>\n<li>ds&#x4F7F;&#x7528;Flow&#x6765;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x6BCF;&#x6B21;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x4E4B;&#x540E;&#x90FD;&#x4F1A;&#x901A;&#x77E5;&#x6700;&#x8FD1;&#x7684;Flow&#x3002;</li>\n<li>ds&#x5B8C;&#x7F8E;&#x652F;&#x6301;sp&#x6570;&#x636E;&#x7684;&#x8FC1;&#x79FB;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x65E0;&#x6210;&#x672C;&#x8FC7;&#x6E21;&#x5230;ds&#x3002;</li>\n</ol>\n<p>&#x6240;&#x4EE5;ds&#x5C06;&#x4F1A;&#x662F;Android&#x540E;&#x7EED;&#x8F7B;&#x91CF;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x7684;&#x9996;&#x9009;&#x7EC4;&#x4EF6;&#x3002;&#x6211;&#x4EEC;&#x4E5F;&#x662F;&#x65F6;&#x5019;&#x6765;&#x4E86;&#x89E3;ds&#x7684;&#x4F7F;&#x7528;&#x3002;</p>\n<h3 id=\"&#x5F15;&#x5165;DataStore\"><a href=\"#&#x5F15;&#x5165;DataStore\" class=\"headerlink\" title=\"&#x5F15;&#x5165;DataStore\"></a>&#x5F15;&#x5165;DataStore</h3><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x8981;&#x5F15;&#x5165;ds&#xFF0C;&#x65B9;&#x5F0F;&#x5F88;&#x7B80;&#x5355;&#x76F4;&#x63A5;&#x5728;build&#x4E2D;&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;&#x5373;&#x53EF;&#x3002;&#x552F;&#x4E00;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;ds&#x652F;&#x6301;sp&#x4E0E;protocol buffers&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#xFF0C;&#x6240;&#x4EE5;&#x5BF9;&#x5E94;&#x7684;&#x4E5F;&#x6709;&#x4E24;&#x79CD;&#x4F9D;&#x8D56;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// Preferences DataStore</span><br><span class=\"line\">implementation &quot;androidx.datastore:datastore-preferences:1.0.0-alpha01&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">// Proto DataStore</span><br><span class=\"line\">implementation  &quot;androidx.datastore:datastore-core:1.0.0-alpha01&quot;</span><br></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x9488;&#x5BF9;&#x8FD9;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#x5206;&#x522B;&#x505A;&#x4ECB;&#x7ECD;&#x3002;</p>\n<h3 id=\"&#x521B;&#x5EFA;DataStore\"><a href=\"#&#x521B;&#x5EFA;DataStore\" class=\"headerlink\" title=\"&#x521B;&#x5EFA;DataStore\"></a>&#x521B;&#x5EFA;DataStore</h3><p>&#x9488;&#x5BF9;sp&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#xFF0C;ds&#x53EA;&#x9700;&#x901A;&#x8FC7;createDataStore&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;ds&#x5BF9;&#x8C61;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private val dataStore = createDataStore(&quot;settings&quot;)</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;settings&#x4E3A;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x5B58;&#x50A8;&#x65B9;&#x5F0F;&#x4E3A;datastore/ + name + .preferences_pb</p>\n<p>protocol buffers&#x7C7B;&#x578B;&#x9700;&#x8981;&#x989D;&#x5916;&#x5B9E;&#x73B0;Serializer&#x63A5;&#x53E3;&#xFF0C;&#x63D0;&#x4F9B;&#x8BFB;&#x5199;&#x7684;&#x5165;&#x53E3;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">object SettingsSerializer : Serializer&lt;Settings&gt; {</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun readFrom(input: InputStream): Settings {</span><br><span class=\"line\">        return Settings.parseFrom(input)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun writeTo(t: Settings, output: OutputStream) {</span><br><span class=\"line\">        t.writeTo(output)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">private val dataStoreProto = createDataStore(&quot;settings.pb&quot;, SettingsSerializer)</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#x7684;Settings&#x7C7B;&#x662F;&#x901A;&#x8FC7;protocol buffers&#x811A;&#x672C;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x3002;&#x8981;&#x751F;&#x6210;Settings&#x7C7B;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x505A;&#x4E24;&#x4EF6;&#x4E8B;</p>\n<ol>\n<li>&#x914D;&#x7F6E;protocol buffers&#x73AF;&#x5883;</li>\n<li>&#x7F16;&#x5199;.proto&#x6587;&#x4EF6;</li>\n</ol>\n<p>&#x6240;&#x4EE5;&#x4F60;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x61C2;&#x4E00;&#x70B9;protocol buffers&#x76F8;&#x5173;&#x7684;&#x8BED;&#x6CD5;&#x3002;</p>\n<blockquote>\n<p>&#x5982;&#x679C;&#x540E;&#x7EED;&#x6709;&#x7A7A;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5355;&#x72EC;&#x5F00;&#x6587;&#x7AE0;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;protocol buffers&#x76F8;&#x5173;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5927;&#x5382;&#x7528;&#x7684;&#x57FA;&#x672C;&#x4E0A;&#x90FD;&#x662F;protocol buffers&#x3002;</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">syntax = &quot;proto3&quot;;</span><br><span class=\"line\">option java_multiple_files = true;</span><br><span class=\"line\">message Settings {</span><br><span class=\"line\">    string key_name = 1;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;protocol buffers&#x8FD0;&#x884C;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x80FD;&#x81EA;&#x52A8;&#x5E2E;&#x6211;&#x4EEC;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684;Settings&#x7C7B;&#x3002;&#x5176;&#x4E2D;&#x5B83;&#x91CC;&#x9762;&#x7684;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x5C31;&#x662F;keyName_&#xFF0C;&#x5B83;&#x662F;String&#x7C7B;&#x578B;&#x3002;&#x901A;&#x8FC7;&#x521B;&#x5EFA;&#x7C7B;&#x4E0E;&#x5BF9;&#x5E94;&#x53D8;&#x91CF;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x7EA6;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x5B89;&#x5168;&#x3002;</p>\n<h3 id=\"&#x8BFB;\"><a href=\"#&#x8BFB;\" class=\"headerlink\" title=\"&#x8BFB;\"></a>&#x8BFB;</h3><p>sp&#x4E0E;protocol buffers&#x7C7B;&#x578B;&#x7684;&#x8BFB;&#x64CD;&#x4F5C;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x90FD;&#x4E00;&#x6837;&#xFF0C;&#x9996;&#x5148;&#x90FD;&#x8981;&#x521B;&#x5EFA;Preferences.Key&#x7C7B;&#x578B;&#x7684;key&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val DATA_KEY = preferencesKey&lt;String&gt;(&quot;key_name&quot;)</span><br></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x5E94;&#x7684;preferencesKey&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">inline fun &lt;reified T : Any&gt; preferencesKey(name: String): Preferences.Key&lt;T&gt; {</span><br><span class=\"line\">    return when (T::class) {</span><br><span class=\"line\">        Int::class -&gt; {</span><br><span class=\"line\">            Preferences.Key&lt;T&gt;(name)</span><br><span class=\"line\">        }</span><br><span class=\"line\">        String::class -&gt; {</span><br><span class=\"line\">            Preferences.Key&lt;T&gt;(name)</span><br><span class=\"line\">        }</span><br><span class=\"line\">        Boolean::class -&gt; {</span><br><span class=\"line\">            Preferences.Key&lt;T&gt;(name)</span><br><span class=\"line\">        }</span><br><span class=\"line\">        Float::class -&gt; {</span><br><span class=\"line\">            Preferences.Key&lt;T&gt;(name)</span><br><span class=\"line\">        }</span><br><span class=\"line\">        Long::class -&gt; {</span><br><span class=\"line\">            Preferences.Key&lt;T&gt;(name)</span><br><span class=\"line\">        }</span><br><span class=\"line\">        Set::class -&gt; {</span><br><span class=\"line\">            throw IllegalArgumentException(&quot;Use `preferencesSetKey` to create keys for Sets.&quot;)</span><br><span class=\"line\">        }</span><br><span class=\"line\">        else -&gt; {</span><br><span class=\"line\">            throw IllegalArgumentException(&quot;Type not supported: ${T::class.java}&quot;)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x652F;&#x6301;Int&#x3001;String&#x3001;Boolean&#x3001;Float&#x4E0E;Long&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x53E6;&#x5916;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;preferencesSetKey&#xFF0C;&#x7528;&#x6765;&#x652F;&#x6301;set&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x3002;</p>\n<p>&#x8C03;&#x7528;preferencesKey&#x6BCF;&#x6B21;&#x90FD;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Preferences.Key&#x5BF9;&#x8C61;&#xFF0C;&#x90A3;&#x5B83;&#x8FD9;&#x6837;&#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x662F;&#x540C;&#x4E00;&#x4E2A;key&#x5462;?</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x53BB;&#x770B;&#x6E90;&#x7801;&#x5C31;&#x4F1A;&#x4E00;&#x76EE;&#x4E86;&#x7136;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">internal constructor(val name: String) {</span><br><span class=\"line\">    override fun equals(other: Any?) =</span><br><span class=\"line\">        if (other is Key&lt;*&gt;) {</span><br><span class=\"line\">            name == other.name</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            false</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun hashCode(): Int {</span><br><span class=\"line\">        return name.hashCode()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x539F;&#x6765;&#x662F;&#x5B83;&#x91CD;&#x5199;&#x4E86;equals&#x65B9;&#x6CD5;&#xFF0C;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x5BF9;name&#x7684;&#x6BD4;&#x8F83;&#x3002;&#x90A3;&#x4E48;&#x53EA;&#x8981;&#x521B;&#x5EFA;preferencesKey&#x65F6;&#x4F20;&#x5165;&#x7684;name&#x76F8;&#x540C;&#xFF0C;&#x5C31;&#x80FD;&#x4FDD;&#x8BC1;&#x83B7;&#x53D6;&#x5230;&#x7684;&#x662F;&#x540C;&#x4E00;&#x4E2A;key&#x7684;&#x6570;&#x636E;&#x3002;</p>\n<p>&#x6709;&#x4E86;key&#xFF0C;&#x518D;&#x6765;&#x901A;&#x8FC7;dataStore.data.map&#x6765;&#x83B7;&#x53D6;Flow&#xFF0C;&#x540C;&#x65F6;&#x66B4;&#x9732;&#x51FA;&#x5BF9;&#x5E94;&#x7684;Preferences</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private suspend fun read() {</span><br><span class=\"line\">    dataStore.data.map {</span><br><span class=\"line\">        // unSafe type</span><br><span class=\"line\">        if (it[DATA_KEY] is String) {</span><br><span class=\"line\">            it[DATA_KEY] ?: &quot;&quot;</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            &quot;type is String: ${it[DATA_KEY] is String}&quot;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }.collect {</span><br><span class=\"line\">        Toast.makeText(this@DataStoreActivity, &quot;read result: $it&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x540C;&#x65F6;&#x5728;read&#x4E2D;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x9A8C;&#x8BC1;SharedPreference&#x7C7B;&#x578B;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#x793A;&#x4F8B;&#x3002;&#x5982;&#x679C;&#x5728;&#x522B;&#x7684;&#x5730;&#x65B9;&#x8D4B;&#x503C;&#x4E86;DATA_KEY&#x975E;String&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x5C06;&#x4F1A;&#x5F39;&#x51FA;else&#x4E2D;&#x7684;&#x8BED;&#x53E5;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x662F;protocol buffers&#x7684;&#x8BFB;&#x53D6;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private suspend fun protoRead() {</span><br><span class=\"line\">    dataStoreProto.data.map {</span><br><span class=\"line\">        // safe type</span><br><span class=\"line\">        it.keyName</span><br><span class=\"line\">    }.collect {</span><br><span class=\"line\">        Toast.makeText(this, &quot;read result success form proto: $it&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x8FD9;&#x91CC;&#x83B7;&#x53D6;&#x7684;&#x6570;&#x636E;&#x5C31;&#x662F;&#x7C7B;&#x578B;&#x5B89;&#x5168;&#x7684;&#x3002;&#x8FD9;&#x91CC;&#x7684;it&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;&#x5728;ds&#x521B;&#x5EFA;&#x65F6;&#x4EA7;&#x751F;&#x7684;Settings&#x3002;</p>\n<h3 id=\"&#x5199;\"><a href=\"#&#x5199;\" class=\"headerlink\" title=\"&#x5199;\"></a>&#x5199;</h3><p>&#x5199;sp&#x4E0E;protocol buffers&#x6709;&#x6240;&#x4E0D;&#x540C;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;sp&#x76F4;&#x63A5;&#x4F7F;&#x7528;dataStore.edit&#x6765;&#x5199;&#x5165;&#x6570;&#x636E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private suspend fun write(value: String) {</span><br><span class=\"line\">    dataStore.edit {</span><br><span class=\"line\">        it[DATA_KEY] = value</span><br><span class=\"line\">        LogUtils.d(&quot;dataStore write: $value&quot;)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x800C;protocol buffers&#x4F7F;&#x7528;&#x7684;&#x662F;updateData&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private suspend fun protoWrite(value: String) {</span><br><span class=\"line\">    dataStoreProto.updateData {</span><br><span class=\"line\">        it.toBuilder().setKeyName(value).build()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x8FC1;&#x79FB;SharedPreferences\"><a href=\"#&#x8FC1;&#x79FB;SharedPreferences\" class=\"headerlink\" title=\"&#x8FC1;&#x79FB;SharedPreferences\"></a>&#x8FC1;&#x79FB;SharedPreferences</h3><p>&#x8FC1;&#x79FB;&#x4E5F;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x8FC1;&#x79FB;&#x5230;ds&#x7684;sp&#x4E2D;&#xFF1B;&#x53E6;&#x4E00;&#x79CD;&#x662F;&#x8FC1;&#x79FB;&#x5230;protocol buffers&#x4E2D;&#x3002;</p>\n<p>&#x5177;&#x4F53;&#x6765;&#x770B;&#xFF0C;&#x5982;&#x679C;&#x8FC1;&#x79FB;&#x5230;ds&#x7684;sp&#x4E2D;&#xFF0C;&#x53EA;&#x9700;&#x5728;&#x4E4B;&#x524D;&#x521B;&#x5EFA;ds&#x57FA;&#x7840;&#x4E0A;&#x989D;&#x5916;&#x518D;&#x52A0;&#x4E00;&#x4E2A;migrations&#x53C2;&#x6570;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private val dataStore = createDataStore(&quot;settings&quot;, migrations = listOf(SharedPreferencesMigration(this, &quot;settings_preference&quot;)))</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x521B;&#x5EFA;SharedPreferencesMigration&#x6765;&#x8FC1;&#x79FB;&#x5BF9;&#x5E94;&#x7684;sp&#x6570;&#x636E;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x662F;&#x8FC1;&#x79FB;&#x5230;protocol buffers&#x4E2D;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val settingsDataStore: DataStore&lt;Settings&gt; = context.createDataStore(</span><br><span class=\"line\">    produceFile = { File(context.filesDir, &quot;settings.preferences_pb&quot;) },</span><br><span class=\"line\">    serializer = SettingsSerializer,</span><br><span class=\"line\">    migrations = listOf(</span><br><span class=\"line\">        SharedPreferencesMigration(</span><br><span class=\"line\">            context,</span><br><span class=\"line\">            &quot;settings_preferences&quot;            </span><br><span class=\"line\">        ) { sharedPrefs: SharedPreferencesView, currentData: UserPreferences -&gt;</span><br><span class=\"line\">            // Map your sharedPrefs to your type here</span><br><span class=\"line\">          }</span><br><span class=\"line\">    )</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>&#x8FC1;&#x79FB;&#x5B8C;&#x4E4B;&#x540E;&#x9700;&#x8981;&#x6267;&#x884C;&#x4E00;&#x6B21;&#x4EE3;&#x7801;&#xFF0C;&#x540C;&#x65F6;&#x5E94;&#x8BE5;&#x505C;&#x6B62;&#x518D;&#x6B21;&#x4F7F;&#x7528;sp&#x3002;&#x5982;&#x679C;&#x8FC1;&#x79FB;&#x6210;&#x529F;&#x5C06;&#x4F1A;&#x5220;&#x9664;&#x4E4B;&#x524D;sp&#x7684;.xml&#x7C7B;&#x578B;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x751F;&#x6210;&#x5BF9;&#x5E94;ds&#x6587;&#x4EF6;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x9644;&#x4E0A;&#x4E00;&#x5F20;Google&#x5206;&#x6790;&#x7684;SharedPreferences&#x548C;DataStore&#x7684;&#x533A;&#x522B;&#x56FE;</p>\n<p><img src=\"https://3.bp.blogspot.com/-Vk_q5hWw6DQ/X00ZfiRrB9I/AAAAAAAAPlo/u-kvBvmMfzgRnNViYLwaAim-E7wq5yxKACLcBGAsYHQ/s1600/Screen%2BShot%2B2020-08-31%2Bat%2B11.25.43%2BAM.png\" alt></p>\n<p>&#x76EE;&#x524D;&#x53EF;&#x4EE5;&#x770B;&#x5230;DataStore&#x8FD8;&#x5904;&#x5728;alpha&#x7248;&#x672C;&#xFF0C;&#x975E;&#x5E38;&#x671F;&#x5F85;&#x5B83;&#x4E4B;&#x540E;&#x7684;&#x6B63;&#x5F0F;&#x7248;&#x672C;&#x3002;</p>\n<p>&#x53E6;&#x5916;&#xFF0C;&#x9488;&#x5BF9;DataStore&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x6211;&#x5199;&#x4E86;&#x4E00;&#x4E2A;demo&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x5728;<a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>&#x4E2D;&#x83B7;&#x53D6;&#x3002;</p>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["jetpack"]},{"title":"算法之旅:复杂度分析","url":"https://www.rousetime.com/2020/12/03/算法之旅-复杂度分析/","content":"<p>&#x4ECA;&#x5929;&#x6B63;&#x5F0F;&#x5F00;&#x542F;&#x7B97;&#x6CD5;&#x4E4B;&#x65C5;&#xFF01;</p>\n<p>&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5408;&#x683C;&#x7684;&#x6280;&#x672F;&#x4EBA;&#x5458;&#xFF0C;&#x7B97;&#x6CD5;&#x662F;&#x5FC5;&#x5907;&#x77E5;&#x8BC6;&#x3002;&#x53EF;&#x4EE5;&#x8FD9;&#x4E48;&#x8BF4;&#xFF0C;&#x867D;&#x7136;&#x4E0D;&#x61C2;&#x7B97;&#x6CD5;&#x7684;&#x4EBA;&#x5E76;&#x4E0D;&#x4F1A;&#x5931;&#x4E1A;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x5FEB;&#x901F;&#x664B;&#x5347;&#x6446;&#x8131;&#x4E1A;&#x52A1;&#x5DE5;&#x7A0B;&#x5E08;CRUD&#x7684;&#x547D;&#x8FD0;&#x5C31;&#x4E00;&#x5B9A;&#x79BB;&#x4E0D;&#x5F00;&#x7B97;&#x6CD5;&#x3002;&#x540C;&#x65F6;&#x4E0D;&#x7BA1;&#x662F;&#x5BF9;&#x4E8E;&#x5DE5;&#x4F5C;&#x8FD8;&#x662F;&#x9762;&#x8BD5;&#x90FD;&#x662F;&#x975E;&#x5E38;&#x6709;&#x7528;&#x7684;&#x3002;</p>\n<p>&#x7531;&#x4E8E;&#x8FD9;&#x662F;&#x7B97;&#x6CD5;&#x7B2C;&#x4E00;&#x7BC7;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5148;&#x4ECE;&#x7B80;&#x5355;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x8BF4;&#x8D77;&#x3002;</p>\n<p>&#x4EFB;&#x4F55;&#x7B97;&#x6CD5;&#x90FD;&#x79BB;&#x4E0D;&#x5F00;&#x590D;&#x6742;&#x5EA6;&#x5206;&#x6790;&#xFF0C;&#x8861;&#x91CF;&#x4E00;&#x4E2A;&#x7B97;&#x6CD5;&#x7684;&#x5F3A;&#x4E0E;&#x5F31;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x7EDF;&#x4E00;&#x7684;&#x6807;&#x51C6;&#x5C31;&#x662F;&#x770B;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x3002;</p>\n<p>&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x6240;&#x7591;&#x95EE;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x770B;&#x590D;&#x6742;&#x5EA6;&#x5462;&#xFF1F;&#x6211;&#x76F4;&#x63A5;&#x8DD1;&#x4E00;&#x4E0B;&#x4EE3;&#x7801;&#x770B;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x4E0D;&#x5C31;&#x5B8C;&#x4E8B;&#x4E86;&#x5417;&#xFF1F;</p>\n<p>&#x662F;&#x7684;&#x8FD9;&#x6837;&#x4E5F;&#x80FD;&#x7EDF;&#x8BA1;&#x51FA;&#x65F6;&#x95F4;&#xFF0C;&#x4F46;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x5B58;&#x5728;&#x975E;&#x5E38;&#x5927;&#x7684;&#x5C40;&#x9650;&#x6027;&#x3002;</p>\n<p>&#x8BD5;&#x60F3;&#x4E00;&#x4E0B;&#xFF0C;&#x4F60;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x5426;&#x975E;&#x5E38;&#x4F9D;&#x8D56;&#x4E8E;&#x6240;&#x5904;&#x7684;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;&#xFF0C;&#x4F8B;&#x5982;&#x540C;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#x5728;2G&#x4E0E;8G&#x7684;&#x624B;&#x673A;&#x4E0A;&#x8FD0;&#x884C;&#x7684;&#x65F6;&#x95F4;&#x80FD;&#x4E00;&#x6837;&#x5417;&#xFF1F;</p>\n<p>&#x53E6;&#x5916;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x660E;&#x663E;&#x7684;&#x7F3A;&#x9677;&#x662F;&#x6837;&#x672C;&#x89C4;&#x6A21;&#x592A;&#x5C0F;&#xFF0C;&#x540C;&#x4E00;&#x7B97;&#x6CD5;&#x53EF;&#x80FD;&#x5BF9;&#x4E0D;&#x540C;&#x89C4;&#x6A21;&#x7684;&#x6570;&#x636E;&#x4F1A;&#x4EA7;&#x751F;&#x4E0D;&#x540C;&#x7684;&#x6548;&#x679C;&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#x5BF9;&#x4E8E;&#x5C0F;&#x89C4;&#x6A21;&#x7684;&#x6392;&#x5E8F;&#xFF0C;&#x63D2;&#x5165;&#x6392;&#x5E8F;&#x53EF;&#x80FD;&#x6BD4;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x66F4;&#x5FEB;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x66F4;&#x79D1;&#x5B66;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x8861;&#x91CF;&#x7B97;&#x6CD5;&#x7684;&#x5F3A;&#x4E0E;&#x5F31;&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x590D;&#x6742;&#x5EA6;&#x3002;</p>\n<p>&#x800C;&#x7B97;&#x6CD5;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x53C8;&#x5206;&#x4E3A;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E0E;&#x7A7A;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E24;&#x5927;&#x7C7B;&#x3002;&#x5176;&#x5B9E;&#x96BE;&#x70B9;&#x5C31;&#x662F;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x7684;&#x8BA1;&#x7B97;&#xFF0C;&#x7A7A;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x76F8;&#x5BF9;&#x7B80;&#x5355;&#x8BB8;&#x591A;&#x3002;</p>\n<h2 id=\"&#x5927;O&#x8868;&#x793A;&#x6CD5;\"><a href=\"#&#x5927;O&#x8868;&#x793A;&#x6CD5;\" class=\"headerlink\" title=\"&#x5927;O&#x8868;&#x793A;&#x6CD5;\"></a>&#x5927;O&#x8868;&#x793A;&#x6CD5;</h2><p>&#x5728;&#x8BF4;&#x590D;&#x6742;&#x5EA6;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x5B83;&#x7684;&#x8868;&#x793A;&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x5148;&#x4ECE;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#x8FDB;&#x884C;&#x5206;&#x6790;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun test(n: Int) {</span><br><span class=\"line\">    var i = 0 //1</span><br><span class=\"line\">    while (i &lt; n) { //2</span><br><span class=\"line\">        var j = 0 //3</span><br><span class=\"line\">        while (j &lt; n) { //4</span><br><span class=\"line\">            j++ //5</span><br><span class=\"line\">        }</span><br><span class=\"line\">        i++ //6</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5047;&#x8BBE;&#x6267;&#x884C;&#x6BCF;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x95F4;&#x4E3A;k&#xFF0C;&#x90A3;&#x4E48;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4ECE;&#x4E0A;&#x5F80;&#x4E0B;&#x4F9D;&#x6B21;&#x6267;&#x884C;&#x7684;&#x65F6;&#x95F4;&#x603B;&#x548C;&#x4E3A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">T(n) = k + n * k + n * k + n^2 * k + n^2 * k + n * k </span><br><span class=\"line\">    = (1 + 3 * n + 2 * n^2) * k</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;&#x516C;&#x5F0F;&#x6211;&#x4EEC;&#x5206;&#x89E3;&#x4E00;&#x4E0B;&#x770B;&#xFF0C;&#x5DE6;&#x8FB9;T(n)&#x4EE3;&#x8868;&#x4EE3;&#x7801;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#xFF0C;&#x53F3;&#x8FB9;(1 + 3 <em> n + 2 </em> n^2)&#x90E8;&#x5206;&#x53EF;&#x4EE5;&#x4EE3;&#x8868;&#x4EE3;&#x7801;&#x7684;&#x6267;&#x884C;&#x6B21;&#x6570;&#x603B;&#x548C;&#xFF0C;&#x800C;k&#x662F;&#x6BCF;&#x884C;&#x4EE3;&#x7801;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x3002;</p>\n<p>&#x8BD5;&#x60F3;&#x4E00;&#x4E0B;&#x662F;&#x5426;&#x4E0D;&#x7BA1;&#x662F;&#x4EC0;&#x4E48;&#x4EE3;&#x7801;&#x90FD;&#x53EF;&#x4EE5;&#x7531;&#x8FD9;&#x4E09;&#x90E8;&#x5206;&#x7EC4;&#x6210;&#x5462;&#xFF1F;</p>\n<p>&#x7B54;&#x6848;&#x81EA;&#x7136;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x4E0A;&#x9762;&#x7684;&#x8868;&#x793A;&#x6CD5;&#x5C31;&#x4EA7;&#x751F;&#x4E86;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x6982;&#x5FF5;&#x4E86;&#xFF1A;&#x4EE3;&#x7801;&#x6267;&#x884C;&#x65F6;&#x95F4;T(n)&#x4E0E;&#x4EE3;&#x7801;&#x7684;&#x6267;&#x884C;&#x6B21;&#x6570;&#x603B;&#x548C;&#x6210;&#x6B63;&#x6BD4;&#x3002;</p>\n<p>&#x6709;&#x4E86;&#x8FD9;&#x4E2A;&#x89C4;&#x5F8B;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x4E0A;&#x9762;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x8F6C;&#x6362;&#x6210;&#x5927;O&#x6765;&#x8868;&#x793A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">T(n) = O(f(n))</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;n&#x4EE3;&#x8868;&#x6570;&#x636E;&#x89C4;&#x6A21;&#xFF0C;T(n)&#x4EE3;&#x8868;&#x4EE3;&#x7801;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#xFF0C;f(n)&#x4EE3;&#x8868;&#x4EE3;&#x7801;&#x7684;&#x6267;&#x884C;&#x6B21;&#x6570;&#x603B;&#x548C;&#xFF0C;&#x5927;O&#x4EE3;&#x8868;&#x4EE3;&#x7801;&#x6267;&#x884C;&#x65F6;&#x95F4;T(n)&#x4E0E;&#x4EE3;&#x7801;&#x7684;&#x6267;&#x884C;&#x6B21;&#x6570;&#x603B;&#x548C;&#x6210;&#x6B63;&#x6BD4;&#x3002;</p>\n<p>&#x5C06;&#x8868;&#x8FBE;&#x5F0F;&#x5957;&#x5165;&#x5230;f(n)&#x4E2D;&#xFF0C;&#x6700;&#x7EC8;&#x8868;&#x793A;&#x4E3A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">T(n) = O(1 + 3 * n + 2 * n^2)</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x5C31;&#x662F;&#x5927;O&#x8868;&#x793A;&#x6CD5;&#xFF0C;&#x5B83;&#x4EE3;&#x8868;&#x7684;&#x5E76;&#x4E0D;&#x662F;&#x4EE3;&#x7801;&#x6267;&#x884C;&#x7684;&#x771F;&#x6B63;&#x65F6;&#x95F4;&#xFF0C;&#x800C;&#x662F;&#x4E00;&#x79CD;&#x8D8B;&#x52BF;&#xFF0C;&#x5373;&#x4EE3;&#x8868;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x968F;&#x6570;&#x636E;&#x89C4;&#x6A21;&#x53D8;&#x5316;&#x7684;&#x8D8B;&#x52BF;&#xFF0C;&#x4E1A;&#x754C;&#x79F0;&#x4E4B;&#x4E3A;&#x6E10;&#x8FDB;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF0C;&#x7B80;&#x79F0;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x3002;</p>\n<p>&#x5982;&#x679C;n&#x7684;&#x89C4;&#x6A21;&#x5F88;&#x5927;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x5E38;&#x6570;&#x3001;&#x7CFB;&#x6570;&#x4E0E;&#x4F4E;&#x4EF7;&#x8FDB;&#x884C;&#x5FFD;&#x7565;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x5DF2;&#x7ECF;&#x4E0D;&#x80FD;&#x5DE6;&#x53F3;&#x8D8B;&#x52BF;&#x7684;&#x53D8;&#x5316;&#x3002;&#x6240;&#x4EE5;&#x5C31;&#x5F97;&#x5230;&#x6211;&#x4EEC;&#x65E5;&#x5E38;&#x6240;&#x770B;&#x5230;&#x7684;&#x7ED3;&#x679C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">T(n) = O(n^2)</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;\"><a href=\"#&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;\" class=\"headerlink\" title=\"&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;\"></a>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;</h2><p>&#x8BF4;&#x5B8C;&#x5927;O&#x8868;&#x793A;&#x6CD5;&#xFF0C;&#x73B0;&#x5728;&#x6B63;&#x5F0F;&#x5206;&#x6790;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x8003;&#x5BDF;&#x4E00;&#x4E2A;&#x7B97;&#x6CD5;&#xFF0C;&#x5F80;&#x5F80;&#x90FD;&#x8981;&#x5206;&#x6790;&#x5B83;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF0C;&#x90A3;&#x4E48;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x53C8;&#x8BE5;&#x5982;&#x4F55;&#x53C8;&#x5FEB;&#x53C8;&#x51C6;&#x7684;&#x5206;&#x6790;&#x51FA;&#x6765;&#x5462;&#xFF1F;</p>\n<p>&#x5176;&#x5B9E;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x6211;&#x6559;&#x5927;&#x5BB6;&#x51E0;&#x4E2A;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x8BA9;&#x4F60;&#x66F4;&#x52A0;&#x8FC5;&#x901F;&#x4E0E;&#x51C6;&#x786E;&#x7684;&#x5F97;&#x5230;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x3002;</p>\n<h3 id=\"&#x8D2A;&#x5FC3;&#x6CD5;&#x5219;\"><a href=\"#&#x8D2A;&#x5FC3;&#x6CD5;&#x5219;\" class=\"headerlink\" title=\"&#x8D2A;&#x5FC3;&#x6CD5;&#x5219;\"></a>&#x8D2A;&#x5FC3;&#x6CD5;&#x5219;</h3><p>&#x4F55;&#x4E3A;&#x8D2A;&#x5FC3;&#x6CD5;&#x5219;&#xFF1F;&#x7B80;&#x5355;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#x627E;&#x5230;&#x4F60;&#x8BA4;&#x4E3A;&#x6700;&#x590D;&#x6742;&#x7684;&#x90A3;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x5FAA;&#x73AF;&#x6B21;&#x6570;&#x6700;&#x591A;&#x7684;&#x90A3;&#x6BB5;&#x4EE3;&#x7801;&#x3002;</p>\n<p>&#x5728;&#x5927;O&#x8868;&#x793A;&#x6CD5;&#x4E2D;&#x5DF2;&#x7ECF;&#x8BF4;&#x4E86;&#xFF0C;&#x8BA1;&#x7B97;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x90FD;&#x4F1A;&#x5FFD;&#x7565;&#x5E38;&#x6570;&#x3001;&#x7CFB;&#x6570;&#x4E0E;&#x4F4E;&#x4EF7;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x5173;&#x6CE8;&#x6B21;&#x6570;&#x6700;&#x591A;&#x7684;&#x90A3;&#x884C;&#x4EE3;&#x7801;&#x3002;&#x4F8B;&#x5982;:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun search(n: Int): Int {</span><br><span class=\"line\">    var i = 0</span><br><span class=\"line\">    var result = 0</span><br><span class=\"line\">    while (i &lt;= n) {</span><br><span class=\"line\">        result+=i</span><br><span class=\"line\">        i++</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return result</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x4E00;&#x770B;&#x5C31;&#x77E5;&#x9053;&#x6267;&#x884C;&#x6700;&#x591A;&#x7684;&#x4EE3;&#x7801;&#x5728;while&#x5FAA;&#x5E8F;&#x4E2D;&#xFF0C;&#x6240;&#x4EE5;&#x7528;&#x5927;O&#x8868;&#x793A;&#x4E3A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">T(n) = O(3 * n)</span><br><span class=\"line\">     = O(n)</span><br></pre></td></tr></table></figure>\n<p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x4E0D;&#x7BA1;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x5E73;&#x7EA7;&#x7684;while&#x5FAA;&#x5E8F;&#xFF0C;&#x6700;&#x7EC8;&#x901A;&#x8FC7;&#x52A0;&#x6CD5;&#x5408;&#x5E76;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x7136;&#x540E;&#x53BB;&#x6389;&#x5E38;&#x6570;&#xFF0C;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x8FD8;&#x662F;O(n)&#x3002;&#x4F8B;&#x5982;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun search(n: Int): Int {</span><br><span class=\"line\">    var i = 0</span><br><span class=\"line\">    var result = 0</span><br><span class=\"line\">    while (i &lt;= n) {</span><br><span class=\"line\">        result+=i</span><br><span class=\"line\">        i++</span><br><span class=\"line\">    }</span><br><span class=\"line\">    </span><br><span class=\"line\">    var j = 0</span><br><span class=\"line\">    while (j &lt;= n) {</span><br><span class=\"line\">        result+=j</span><br><span class=\"line\">        j++</span><br><span class=\"line\">    }</span><br><span class=\"line\">    </span><br><span class=\"line\">    return result</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x6C42;&#x540C;&#x5B58;&#x5F02;\"><a href=\"#&#x6C42;&#x540C;&#x5B58;&#x5F02;\" class=\"headerlink\" title=\"&#x6C42;&#x540C;&#x5B58;&#x5F02;\"></a>&#x6C42;&#x540C;&#x5B58;&#x5F02;</h3><p>&#x8FD9;&#x79CD;&#x7D2F;&#x8BA1;&#x7684;&#x53EA;&#x9002;&#x7528;&#x4E8E;&#x5355;&#x4E2A;&#x89C4;&#x6A21;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x5982;&#x679C;&#x5904;&#x5728;&#x591A;&#x4E2A;&#x89C4;&#x6A21;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x5C31;&#x76F4;&#x63A5;&#x6309;&#x7167;&#x6B63;&#x5E38;&#x7684;&#x52A0;&#x6CD5;&#x8FD0;&#x7B97;&#x8FDB;&#x884C;&#x4FDD;&#x7559;&#x5373;&#x53EF;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun search(n: Int, m: Int): Int {</span><br><span class=\"line\">    var i = 0</span><br><span class=\"line\">    var result = 0</span><br><span class=\"line\">    while (i &lt;= n) {</span><br><span class=\"line\">        result+=i</span><br><span class=\"line\">        i++</span><br><span class=\"line\">    }</span><br><span class=\"line\">    </span><br><span class=\"line\">    var j = 0</span><br><span class=\"line\">    while (j &lt;= m) {</span><br><span class=\"line\">        result+=j</span><br><span class=\"line\">        j++</span><br><span class=\"line\">    }</span><br><span class=\"line\">    </span><br><span class=\"line\">    return result</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;O(n+m),&#x56E0;&#x4E3A;&#x5B58;&#x5728;n&#x3001;m&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x89C4;&#x6A21;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x5408;&#x5E76;&#xFF0C;&#x53EA;&#x80FD;&#x5171;&#x5B58;&#x3002;</p>\n<p>&#x4E3E;&#x4E00;&#x53CD;&#x4E09;&#xFF0C;&#x5BF9;&#x4E8E;n&#x3001;m&#x5D4C;&#x5957;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x6309;&#x7167;&#x4E58;&#x6CD5;&#x6CD5;&#x5219;&#x8FDB;&#x884C;&#x8FD0;&#x884C;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun search(n: Int, m: Int): Int {</span><br><span class=\"line\">    var i = 0</span><br><span class=\"line\">    var result = 0</span><br><span class=\"line\">    while (i &lt;= n) {</span><br><span class=\"line\">        result+=i</span><br><span class=\"line\">        i++</span><br><span class=\"line\">        var j = 0</span><br><span class=\"line\">        while (j &lt;= m) {</span><br><span class=\"line\">        \t result+=j</span><br><span class=\"line\">        \t j++</span><br><span class=\"line\">    \t  }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    </span><br><span class=\"line\">    return result</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;O(n*m)</p>\n<p>&#x76F8;&#x5BF9;&#x6765;&#x8BF4;&#x6211;&#x4EEC;&#x9047;&#x5230;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x7684;&#x6837;&#x5F0F;&#x5E76;&#x4E0D;&#x591A;&#xFF0C;&#x4E3B;&#x8981;&#x4E3A;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;</p>\n<ol>\n<li>O(1)&#xFF1A;&#x5E38;&#x6570;&#x9636;</li>\n<li>O(n)&#xFF1A;&#x7EBF;&#x6027;&#x9636;</li>\n<li>O(n^2)&#xFF1A;&#x5E73;&#x65B9;&#x9636;</li>\n<li>O(logn)&#xFF1A;&#x5BF9;&#x6570;&#x9636;</li>\n<li>O(nlogn)&#xFF1A;&#x7EBF;&#x6027;&#x5BF9;&#x6570;&#x9636;</li>\n<li>O(2^n)&#xFF1A;&#x6307;&#x6570;&#x9636;</li>\n<li>O(n!)&#xFF1A;&#x9636;&#x4E58;&#x9636;</li>\n</ol>\n<p>&#x800C;&#x7528;&#x7684;&#x6700;&#x591A;&#x7684;&#x5C31;&#x662F;O(1)&#x3001;O(logn)&#x3001;O(n)&#x3001;O(nlogn)&#x3001;O(n^2)&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5BF9;O(n)&#x4E0E;O(n^2)&#x8FDB;&#x884C;&#x4E86;&#x4E3E;&#x4F8B;&#xFF0C;&#x81F3;&#x4E8E;&#x5E38;&#x6570;&#x9636;O(1)&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x53EA;&#x8981;&#x5B83;&#x6CA1;&#x6709;&#x5FAA;&#x73AF;&#x4F53;&#x6216;&#x8005;&#x9012;&#x5F52;&#x5B58;&#x5728;&#xFF0C;&#x90A3;&#x5B83;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x5C31;&#x662F;O(1)</p>\n<p>&#x4E0B;&#x9762;&#x518D;&#x6765;&#x5206;&#x6790;&#x4E0B;O(logn)&#x4E0E;O(nlogn)</p>\n<h3 id=\"&#x5BF9;&#x6570;&#x9636;&#x4E0E;&#x7EBF;&#x6027;&#x5BF9;&#x6570;&#x9636;\"><a href=\"#&#x5BF9;&#x6570;&#x9636;&#x4E0E;&#x7EBF;&#x6027;&#x5BF9;&#x6570;&#x9636;\" class=\"headerlink\" title=\"&#x5BF9;&#x6570;&#x9636;&#x4E0E;&#x7EBF;&#x6027;&#x5BF9;&#x6570;&#x9636;\"></a>&#x5BF9;&#x6570;&#x9636;&#x4E0E;&#x7EBF;&#x6027;&#x5BF9;&#x6570;&#x9636;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var i = 1</span><br><span class=\"line\">while(i &lt; n)</span><br><span class=\"line\">{</span><br><span class=\"line\">    i = i * 2</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6BCF;&#x6B21;&#x5FAA;&#x73AF;&#x90FD;&#x5C06;&#x5F53;&#x524D;&#x503C;&#x4E58;&#x4EE5;2&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x96BE;&#x5F97;&#x51FA;&#x5B83;&#x7684;&#x7EC8;&#x6B62;&#x8868;&#x8FBE;&#x5F0F;&#x4E3A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2^0 , 2^1 , 2^2 , 2^3 , ... , 2^x = n</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x6C42;&#x5F97;x&#x7B49;&#x4E8E;log2^n&#xFF0C;&#x6240;&#x4EE5;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;O(log2^n)</p>\n<p>&#x5982;&#x679C;&#x6211;&#x518D;&#x5C06;i = i <em> 2&#x6539;&#x6210;i = i </em> 3&#xFF0C;&#x5176;&#x5B83;&#x90FD;&#x4E0D;&#x53D8;&#xFF0C;&#x6B64;&#x65F6;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;O(log3^n)</p>\n<p>&#x4F46;&#x662F;&#xFF0C;&#x6839;&#x636E;&#x5BF9;&#x6570;&#x4E4B;&#x95F4;&#x7684;&#x76F8;&#x4E92;&#x8F6C;&#x6362;&#x89C4;&#x5F8B;&#xFF0C;log3^n = log3^2 <em> log2^n&#xFF0C;&#x6240;&#x4EE5;O(log3^n)&#x53EF;&#x4EE5;&#x8F6C;&#x6210;O(k </em> log2^n)&#x3002;</p>\n<p>&#x5176;&#x4E2D;k&#x662F;&#x5E38;&#x91CF;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x5FFD;&#x7565;&#xFF0C;&#x6240;&#x4EE5;&#x8F6C;&#x5316;&#x4E4B;&#x540E;&#x5B83;&#x4EEC;&#x90FD;&#x662F;O(log2^n)&#x3002;</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x5BF9;&#x6570;&#x9636;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x7684;&#x8868;&#x793A;&#x65B9;&#x6CD5;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x5FFD;&#x7565;&#x5BF9;&#x6570;&#x7684;&#x5E95;&#xFF0C;&#x7EDF;&#x4E00;&#x8868;&#x793A;&#x4E3A;O(logn)&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x5BF9;&#x5E94;&#x7684;&#x7EBF;&#x6027;&#x5BF9;&#x6570;&#x9636;O(nlogn)&#x4E5F;&#x5C31;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x53EA;&#x662F;&#x5BF9;&#x5BF9;&#x6570;&#x9636;&#x7684;&#x4EE3;&#x7801;&#x6267;&#x884C;&#x4E86;n&#x904D;&#xFF0C;&#x539F;&#x7406;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>\n<p>&#x4F60;&#x53EF;&#x80FD;&#x8FD8;&#x542C;&#x8BF4;&#x8FC7;&#x6700;&#x597D;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x3001;&#x6700;&#x574F;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x3001;&#x5E73;&#x5747;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E0E;&#x5747;&#x644A;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x3002;&#x5176;&#x5B9E;&#x5B83;&#x4EEC;&#x4E5F;&#x5F88;&#x597D;&#x7406;&#x89E3;&#xFF0C;&#x672C;&#x8D28;&#x5C31;&#x662F;&#x5B57;&#x9762;&#x4E0A;&#x7684;&#x610F;&#x601D;&#xFF0C;&#x5177;&#x4F53;&#x5C31;&#x4E0D;&#x5230;&#x8FD9;&#x8FC7;&#x591A;&#x8BF4;&#x660E;&#xFF0C;&#x540E;&#x7EED;&#x9047;&#x5230;&#x5177;&#x4F53;&#x7B97;&#x6CD5;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x5177;&#x4F53;&#x8BF4;&#x660E;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x518D;&#x9644;&#x4E0A;&#x4E00;&#x5F20;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x66F2;&#x7EBF;&#x56FE;&#xFF0C;&#x6765;&#x66F4;&#x52A0;&#x76F4;&#x89C2;&#x7684;&#x770B;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x53D8;&#x5316;&#x8D8B;&#x52BF;&#x3002;</p>\n<p><img src=\"/2020/12/03/&#x7B97;&#x6CD5;&#x4E4B;&#x65C5;-&#x590D;&#x6742;&#x5EA6;&#x5206;&#x6790;/1.png\" alt></p>\n<h2 id=\"&#x7A7A;&#x95F4;&#x590D;&#x6742;&#x5EA6;\"><a href=\"#&#x7A7A;&#x95F4;&#x590D;&#x6742;&#x5EA6;\" class=\"headerlink\" title=\"&#x7A7A;&#x95F4;&#x590D;&#x6742;&#x5EA6;\"></a>&#x7A7A;&#x95F4;&#x590D;&#x6742;&#x5EA6;</h2><p>&#x5206;&#x6790;&#x5B8C;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF0C;&#x518D;&#x6765;&#x770B;&#x7A7A;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x5C31;&#x7B80;&#x5355;&#x8BB8;&#x591A;&#x4E86;&#x3002;</p>\n<p>&#x7A7A;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E5F;&#x662F;&#x7528;&#x5927;O&#x6765;&#x8868;&#x793A;&#xFF0C;&#x7A7A;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E5F;&#x662F;&#x6E10;&#x8FDB;&#x7A7A;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF0C;&#x8868;&#x793A;&#x7B97;&#x6CD5;&#x4E4B;&#x95F4;&#x7684;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x4E0E;&#x6570;&#x636E;&#x89C4;&#x6A21;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x3002;</p>\n<p>&#x7B80;&#x5355;&#x770B;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private fun test(n: Int) {</span><br><span class=\"line\">    var i = 0</span><br><span class=\"line\">    val temp = IntArray(n)</span><br><span class=\"line\">    while (i &lt; n) {</span><br><span class=\"line\">        temp[i] = i + 1</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x7533;&#x8BF7;&#x4E86;&#x4E00;&#x4E2A;n&#x5927;&#x5C0F;&#x7684;temp&#x6570;&#x7EC4;&#xFF0C;&#x53EA;&#x6709;&#x8FD9;&#x4E00;&#x5757;&#x6709;&#x989D;&#x5916;&#x7684;&#x7A7A;&#x95F4;&#x7533;&#x8BF7;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x7684;&#x7A7A;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x5C31;&#x662F;O(n)&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x7A7A;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF0C;&#x6211;&#x4EEC;&#x5E38;&#x89C1;&#x7684;&#x7A7A;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;&#xFF1A;O(1)&#x3001;O(n)&#x4E0E;O(n^2)&#xFF0C;&#x800C;&#x5BF9;&#x4E8E;&#x5BF9;&#x6570;&#x9636;&#x3001;&#x7EBF;&#x6027;&#x5BF9;&#x6570;&#x9636;&#x3001;&#x9636;&#x4E58;&#x9636;&#x4E0E;&#x6307;&#x6570;&#x9636;&#x90FD;&#x57FA;&#x672C;&#x7528;&#x4E0D;&#x5230;&#x3002;&#x6240;&#x4EE5;&#x76F8;&#x5BF9;&#x4E8E;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x7A7A;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3002;</p>\n<p>&#x8FD9;&#x4E2A;&#x4E5F;&#x4F1A;&#x5728;&#x4E4B;&#x540E;&#x7684;&#x7B97;&#x6CD5;&#x4E2D;&#x8FDB;&#x884C;&#x540C;&#x6B65;&#x5206;&#x6790;&#x3002;</p>\n<p>&#x5173;&#x4E8E;&#x7B97;&#x6CD5;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x4ECA;&#x5929;&#x5C31;&#x804A;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x5BF9;&#x4E8E;&#x7B97;&#x6CD5;&#x590D;&#x6742;&#x5EA6;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x523B;&#x610F;&#x7684;&#x53BB;&#x627E;&#x7B97;&#x6CD5;&#x8FDB;&#x884C;&#x7EC3;&#x4E60;&#xFF0C;&#x53EA;&#x9700;&#x5728;&#x6BCF;&#x6B21;&#x9047;&#x5230;&#x7684;&#x7B97;&#x6CD5;&#x7684;&#x65F6;&#x5019;&#x6709;&#x590D;&#x6742;&#x5EA6;&#x7684;&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x5199;&#x5B8C;&#x7B97;&#x6CD5;&#x4E4B;&#x540E;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x5BF9;&#x6BD4;&#x5373;&#x53EF;&#x3002;</p>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["算法"],"tags":["算法"]},{"title":"Android Startup最新进展","url":"https://www.rousetime.com/2020/11/29/Android-Startup最新进展/","content":"<p>&#x4ECA;&#x5929;&#x4ECB;&#x7ECD;&#x4E00;&#x4E2A;&#x6709;&#x5173;&#x542F;&#x52A8;&#x4F18;&#x5316;&#x7684;&#x5F00;&#x6E90;&#x5E93;<a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android-startup</a>&#x3002;&#x8FD9;&#x4E2A;&#x5F00;&#x6E90;&#x5E93;&#x4E3B;&#x8981;&#x662F;&#x505A;&#x4EC0;&#x4E48;&#x7684;&#x5462;&#xFF1F;</p>\n<p>android-startup&#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#x3002;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B83;&#x6765;&#x7B80;&#x5316;&#x542F;&#x52A8;&#x5E8F;&#x5217;&#xFF0C;&#x5E76;&#x663E;&#x5F0F;&#x5730;&#x8BBE;&#x7F6E;&#x521D;&#x59CB;&#x5316;&#x987A;&#x5E8F;&#x4E0E;&#x7EC4;&#x4EF6;&#x4E4B;&#x95F4;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x3002; &#x4E0E;&#x6B64;&#x540C;&#x65F6;android-startup&#x652F;&#x6301;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x4F18;&#x5316;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x6709;&#x5411;&#x65E0;&#x73AF;&#x56FE;&#x62D3;&#x6251;&#x6392;&#x5E8F;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x4FDD;&#x8BC1;&#x5185;&#x90E8;&#x4F9D;&#x8D56;&#x7EC4;&#x4EF6;&#x7684;&#x521D;&#x59CB;&#x5316;&#x987A;&#x5E8F;&#x3002;</p>\n<p>&#x76EE;&#x524D;&#x5DF2;&#x7ECF;&#x5F97;&#x5230;400&#x591A;&#x4E2A;Star&#x7684;&#x652F;&#x6301;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#x611F;&#x8C22;&#x8FD9;&#x4E9B;&#x7C89;&#x4E1D;&#x7684;&#x652F;&#x6301;&#xFF01;</p>\n<p>&#x5F53;&#x7136;&#x5982;&#x679C;&#x6709;&#x4E0D;&#x5BF9;&#x7684;&#x5730;&#x65B9;&#x4E5F;&#x8BF7;&#x76F4;&#x63A5;&#x6307;&#x51FA;&#xFF0C;&#x6211;&#x90FD;&#x4F1A;&#x865A;&#x5FC3;&#x63A5;&#x53D7;&#xFF01;&#x4E5F;&#x6B22;&#x8FCE;&#x5927;&#x5BB6;&#x4E00;&#x8D77;&#x8BA8;&#x8BBA;&#x3002;</p>\n<p>&#x5728;&#x4E4B;&#x524D;&#x6211;&#x5DF2;&#x7ECF;&#x5199;&#x4E86;&#x4E24;&#x7BC7;&#x5173;&#x4E8E;android-startup&#x7684;&#x4ECB;&#x7ECD;&#x6587;&#x7AE0;&#xFF0C;&#x5206;&#x522B;&#x4E3A;&#xFF1A;</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484560&amp;idx=1&amp;sn=39e02098d66d6228970bdc8df09fba42&amp;chksm=e8e0fd00df977416066c25f6560e27ba0ad75abb3ab0ade0afd85df866850671a997dc609c5d&amp;token=846567760&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">&#x6211;&#x4E3A;&#x4F55;&#x5F03;&#x7528;Jetpack&#x7684;App Startup&#xFF1F;</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s/05N5GNE3pg2x_yaWho7HdQ\" target=\"_blank\" rel=\"noopener\">&#x66F4;&#x5FEB;&#xFF01;&#x8FD9;&#x624D;&#x662F;&#x6211;&#x60F3;&#x8981;&#x7684; Android Startup&#x5E93;&#xFF01;</a></p>\n<p>&#x7B2C;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x4E86;&#x5173;&#x4E8E;android-startup&#x7684;&#x8D77;&#x6E90;&#xFF0C;&#x6211;&#x4E3A;&#x4F55;&#x8981;&#x8BBE;&#x8BA1;&#x8FD9;&#x4E2A;&#x5F00;&#x6E90;&#x5E93;&#x4E0E;&#x8FD9;&#x4E2A;&#x5F00;&#x6E90;&#x5E93;&#x80FD;&#x591F;&#x89E3;&#x51B3;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;</p>\n<p>&#x5728;&#x6587;&#x7AE0;&#x4E2D;&#x6211;&#x901A;&#x8FC7;Jetpack&#x65B0;&#x6210;&#x5458;App Startup&#x5F15;&#x53D1;&#x601D;&#x8003;&#xFF0C;&#x5B83;&#x662F;Jetpack&#x63A8;&#x51FA;&#x7684;&#x542F;&#x52A8;&#x4F18;&#x5316;&#x5E93;&#xFF0C;&#x901A;&#x8FC7;&#x4F9D;&#x8D56;&#x6765;&#x89E3;&#x51B3;&#x4E0D;&#x540C;&#x542F;&#x52A8;&#x4EFB;&#x52A1;&#x4E4B;&#x95F4;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;&#x540C;&#x65F6;&#x5185;&#x90E8;&#x4E00;&#x4E2A;&#x4EAE;&#x70B9;&#x662F;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;ContentProvider&#x6765;&#x89E3;&#x51B3;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x7684;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x51CF;&#x5C11;ContentProvider&#x7684;&#x6EE5;&#x7528;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x73B0;&#x5728;&#x5404;&#x79CD;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x663E;&#x6027;&#x7684;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x90FD;&#x4F1A;&#x5728;&#x81EA;&#x5DF1;&#x5E93;&#x4E2D;&#x63D0;&#x4F9B;ContentProvider&#x3002;&#x4E00;&#x65E6;&#x4F60;&#x7684;&#x9879;&#x76EE;&#x4E2D;&#x4F9D;&#x8D56;&#x7684;&#x8FD9;&#x79CD;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#x8FC7;&#x591A;&#xFF0C;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;ContentProvider&#x7684;&#x6EE5;&#x7528;&#xFF0C;&#x6700;&#x7EC8;&#x5C31;&#x4F1A;&#x5EF6;&#x957F;App&#x7684;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#x3002;&#x56E0;&#x4E3A;&#x5728;&#x542F;&#x52A8;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x4E00;&#x65E6;ContentProvider&#x7684;&#x542F;&#x52A8;&#x6570;&#x91CF;&#x8FC7;&#x591A;&#x8FD8;&#x662F;&#x4F1A;&#x5360;&#x7528;&#x6BD4;&#x8F83;&#x5927;&#x7684;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#x3002;</p>\n<p>&#x8FD9;&#x7B97;App Startup&#x6BD4;&#x8F83;&#x5927;&#x7684;&#x4E00;&#x4E2A;&#x4F18;&#x70B9;&#x3002;</p>\n<p>&#x4F46;&#x6211;&#x5728;&#x7814;&#x7A76;&#x4E0E;&#x4F7F;&#x7528;&#x4E2D;&#x5374;&#x53D1;&#x73B0;&#x5B83;&#x4E00;&#x4E2A;&#x5BF9;&#x6211;&#x6765;&#x8BF4;&#x6BD4;&#x8F83;&#x81F4;&#x547D;&#x7684;&#x7F3A;&#x70B9;&#xFF0C;&#x5C31;&#x662F;&#x5B83;&#x5E76;&#x4E0D;&#x652F;&#x6301;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x66F4;&#x522B;&#x8BF4;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x3001;&#x5F02;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x95F4;&#x7684;&#x7B49;&#x5F85;&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x3002;</p>\n<p>&#x867D;&#x7136;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;create()&#x65B9;&#x6CD5;&#x4E2D;&#x624B;&#x52A8;&#x521B;&#x5EFA;&#x5B50;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#xFF0C;&#x4F46;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x4F9D;&#x8D56;&#x53E6;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x53C8;&#x8BE5;&#x5982;&#x4F55;&#x5904;&#x7406;&#x5462;&#xFF1F;&#x591A;&#x4E2A;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#xFF0C;&#x7EDF;&#x4E00;&#x903B;&#x8F91;&#x5904;&#x7406;&#x53C8;&#x5728;&#x54EA;&#x91CC;&#x5462;&#xFF1F;&#x4F9D;&#x8D56;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#x540E;&#x7684;&#x56DE;&#x8C03;&#x53C8;&#x5728;&#x54EA;&#x91CC;&#xFF1F;&#x4EA6;&#x6216;&#x8005;&#x662F;&#x4F9D;&#x8D56;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#x540E;&#x7684;&#x901A;&#x77E5;&#xFF1F;&#x8FD8;&#x6709;&#x4F9D;&#x8D56;&#x95F4;&#x7684;&#x6267;&#x884C;&#x987A;&#x5E8F;&#x4F18;&#x5316;&#xFF1F;</p>\n<p>&#x6240;&#x4EE5;&#x57FA;&#x4E8E;&#x8FD9;&#x4E9B;&#x7591;&#x95EE;&#xFF0C;&#x6211;&#x5F00;&#x59CB;&#x5C1D;&#x8BD5;&#x4F18;&#x5316;Jetpack&#x7684;App Startup&#x3002;</p>\n<p>&#x5728;&#x4E0D;&#x505C;&#x7684;&#x5C1D;&#x8BD5;&#x4E0E;&#x4F18;&#x5316;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x4E5F;&#x5C31;&#x4EA7;&#x751F;&#x4E86;android-startup&#x5F00;&#x6E90;&#x5E93;&#x3002;</p>\n<p>&#x5728;&#x6587;&#x7AE0;&#x4E2D;&#x6211;&#x4E5F;&#x7ED9;&#x51FA;&#x4E86;android-startup&#x4E0E;App Startup&#x7684;&#x529F;&#x80FD;&#x5BF9;&#x6BD4;&#x8868;&#x683C;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x518D;&#x62FF;&#x51FA;&#x6765;&#x7ED9;&#x5927;&#x5BB6;&#x770B;&#x4E00;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;&#x76EE;&#x524D;&#x8FED;&#x4EE3;&#x5B8C;&#x7684;&#x6700;&#x65B0;&#x7248;</p>\n<p><img src=\"/2020/11/29/Android-Startup&#x6700;&#x65B0;&#x8FDB;&#x5C55;/1.jpg\" alt><br>android-startup&#x4E0D;&#x4EC5;&#x652F;&#x6301;App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x5728;&#x5B83;&#x57FA;&#x7840;&#x4E4B;&#x4E0A;&#x8FDB;&#x884C;&#x4E86;&#x591A;&#x529F;&#x80FD;&#x62D3;&#x5C55;&#x4E0E;&#x4F18;&#x5316;&#x3002;&#x5982;&#x679C;&#x4F60;&#x6B63;&#x5728;&#x4F7F;&#x7528;App Startup&#xFF0C;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x4F60;&#x65E0;&#x538B;&#x529B;&#x7684;&#x8FC7;&#x6E21;&#x5230;android-startup&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x60F3;&#x4E86;&#x89E3;android-startup&#x7684;&#x57FA;&#x672C;&#x4F7F;&#x7528;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x770B;&#x7B2C;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x60F3;&#x8FDB;&#x4E00;&#x6B65;&#x4E86;&#x89E3;android-startup&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x770B;&#x7B2C;&#x4E8C;&#x7BC7;&#x6587;&#x7AE0;&#x3002;</p>\n<p>&#x7B2C;&#x4E8C;&#x7BC7;&#x6587;&#x7AE0;&#x662F;&#x5728;<strong>&#x9E3F;&#x6D0B;</strong>&#x516C;&#x4F17;&#x53F7;&#x8FDB;&#x884C;&#x53D1;&#x5E03;&#x7684;&#x3002;</p>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x518D;&#x6B21;&#x611F;&#x8C22;<strong>&#x9E3F;&#x6D0B;</strong>&#x5BF9;android-startup&#x7684;&#x8BA4;&#x53EF;&#x3002;&#x8FD9;&#x5BF9;&#x6211;&#x6765;&#x8BF4;&#x662F;&#x4E00;&#x4E2A;&#x6781;&#x5927;&#x7684;&#x9F13;&#x821E;&#xFF0C;&#x8BA9;&#x6211;&#x4E5F;&#x80FD;&#x591F;&#x4E3A;&#x5F00;&#x6E90;&#x505A;&#x4E00;&#x70B9;&#x8D21;&#x732E;&#x3002;</p>\n<p>&#x7B2C;&#x4E8C;&#x7BC7;&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x4E86;android-startup&#x76F8;&#x5173;&#x7684;&#x914D;&#x7F6E;&#x539F;&#x7406;&#x3001;&#x4F9D;&#x8D56;&#x652F;&#x6301;&#x539F;&#x7406;&#x3001;&#x95ED;&#x73AF;&#x5904;&#x7406;&#x903B;&#x8F91;&#x3001;&#x63D0;&#x4F9B;&#x7684;&#x7EBF;&#x7A0B;&#x3001;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#x3001;&#x4F9D;&#x8D56;&#x56DE;&#x8C03;&#x539F;&#x7406;&#x3001;&#x624B;&#x52A8;&#x901A;&#x77E5;&#x539F;&#x7406;&#x4E0E;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x987A;&#x5E8F;&#x7684;&#x62D3;&#x6251;&#x4F18;&#x5316;&#x7B97;&#x6CD5;&#x3002;</p>\n<p>&#x76F8;&#x4FE1;&#x4F60;&#x770B;&#x4E86;&#x8FD9;&#x4E9B;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x4F1A;&#x66F4;&#x6DF1;&#x523B;&#x7684;&#x4E86;&#x89E3;android-startup&#xFF0C;&#x540C;&#x65F6;&#x5BF9;&#x5B83;&#x7684;&#x4F7F;&#x7528;&#x4E5F;&#x5C06;&#x4E86;&#x7136;&#x4E8E;&#x80F8;&#x3002;</p>\n<p>android-startup&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x66F4;&#x65B0;&#x5230;1.0.6&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x4F9D;&#x8D56;&#x65B9;&#x5F0F;&#x5982;&#x4E0B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    implementation &apos;com.rousetime.android:android-startup:1.0.6&apos;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x6211;&#x6765;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;android-startup&#x6700;&#x65B0;&#x7684;&#x4E24;&#x5927;&#x66F4;&#x65B0;&#x5185;&#x5BB9;&#xFF0C;&#x5206;&#x522B;&#x4E3A;&#x7EBF;&#x7A0B;&#x4F18;&#x5148;&#x7EA7;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x7684;&#x652F;&#x6301;&#x3002;</p>\n<h2 id=\"&#x7EBF;&#x7A0B;&#x4F18;&#x5148;&#x7EA7;\"><a href=\"#&#x7EBF;&#x7A0B;&#x4F18;&#x5148;&#x7EA7;\" class=\"headerlink\" title=\"&#x7EBF;&#x7A0B;&#x4F18;&#x5148;&#x7EA7;\"></a>&#x7EBF;&#x7A0B;&#x4F18;&#x5148;&#x7EA7;</h2><p>&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x4E0D;&#x540C;&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x8C03;&#x5EA6;&#x95EE;&#x9898;&#xFF0C;&#x5728;android-startup&#x4E2D;&#x63D0;&#x4F9B;&#x4E86;ThreadPriority&#x6CE8;&#x89E3;&#x6765;&#x4E3A;&#x4E0D;&#x540C;&#x7684;&#x4EFB;&#x52A1;&#x58F0;&#x660E;&#x7EBF;&#x7A0B;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@MustBeDocumented</span><br><span class=\"line\">@Retention</span><br><span class=\"line\">@Target(AnnotationTarget.CLASS)</span><br><span class=\"line\">annotation class ThreadPriority(val priority: Int = Process.THREAD_PRIORITY_DEFAULT)</span><br></pre></td></tr></table></figure>\n<p>&#x5177;&#x4F53;&#x4F7F;&#x7528;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x9700;&#x5728;&#x5BF9;&#x5E94;&#x7684;AndroidStartup&#x4E2D;&#x8FDB;&#x884C;&#x6307;&#x5B9A;&#x4F18;&#x5148;&#x7EA7;&#x5373;&#x53EF;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@ThreadPriority(Process.THREAD_PRIORITY_URGENT_AUDIO)</span><br><span class=\"line\">class SamplePriorityFirstStartup : AndroidStartup&lt;String&gt;() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun create(context: Context): String? {</span><br><span class=\"line\">        val i = buildString {</span><br><span class=\"line\">            repeat(1000000) {</span><br><span class=\"line\">                append(&quot;$it&quot;)</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        return SamplePriorityFirstStartup::class.java.simpleName</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun callCreateOnMainThread(): Boolean = false</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun waitOnMainThread(): Boolean = false</span><br><span class=\"line\"> </span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x5C31;&#x4E3A;SamplePriorityFirstStartup&#x6307;&#x5B9A;&#x4E86;&#x4E00;&#x4E2A;&#x8F83;&#x9AD8;&#x7684;&#x7EBF;&#x7A0B;&#x4F18;&#x5148;&#x7EA7;&#x3002;&#x5728;cpu&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x83B7;&#x5F97;&#x66F4;&#x591A;&#x7684;&#x8C03;&#x5EA6;&#x65F6;&#x95F4;&#x7247;&#x6BB5;&#x3002;</p>\n<p>&#x4E3A;&#x4E86;&#x6D4B;&#x8BD5;&#xFF0C;&#x518D;&#x52A0;&#x5165;&#x4E24;&#x4E2A;AndroidStartup&#xFF0C;&#x5206;&#x522B;&#x4E3A;&#x9ED8;&#x8BA4;&#x7684;&#x7EBF;&#x7A0B;&#x4F18;&#x5148;&#x7EA7;&#x4E0E;&#x8BBE;&#x7F6E;&#x4E86;&#x66F4;&#x4F4E;&#x7684;&#x540E;&#x53F0;&#x7EBF;&#x7A0B;&#x4F18;&#x5148;&#x7EA7;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class SamplePrioritySecondStartup : AndroidStartup&lt;String&gt;() { </span><br><span class=\"line\">\t// create&#x5185;&#x90E8;&#x903B;&#x8F91;&#x4E0E;SamplePriorityFirstStartup&#x4E00;&#x81F4;</span><br><span class=\"line\">\t... </span><br><span class=\"line\">}</span><br><span class=\"line\">@ThreadPriority(Process.THREAD_PRIORITY_BACKGROUND)</span><br><span class=\"line\">class SamplePriorityThirdStartup : AndroidStartup&lt;String&gt;() { </span><br><span class=\"line\">\t// create&#x5185;&#x90E8;&#x903B;&#x8F91;&#x4E0E;SamplePriorityFirstStartup&#x4E00;&#x81F4;</span><br><span class=\"line\">\t...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x4E3A;&#x4E86;&#x5C55;&#x793A;&#x65B9;&#x4FBF;&#xFF0C;&#x4F7F;&#x7528;&#x624B;&#x52A8;&#x914D;&#x7F6E;&#x65B9;&#x5F0F;&#x5C06;&#x5B83;&#x4EEC;&#x52A0;&#x5165;&#x5230;StartupManager&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">list.add(SamplePriorityThirdStartup())</span><br><span class=\"line\">list.add(SamplePrioritySecondStartup())</span><br><span class=\"line\">list.add(SamplePriorityFirstStartup())</span><br><span class=\"line\"> </span><br><span class=\"line\">StartupManager.Builder()</span><br><span class=\"line\">    .setConfig(config)</span><br><span class=\"line\">    .addAllStartup(list)</span><br><span class=\"line\">    .build(this)</span><br><span class=\"line\">    .start()</span><br><span class=\"line\">    .await()</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x6765;&#x9884;&#x6D4B;&#x4E00;&#x4E0B;&#xFF0C;&#x6309;&#x7167;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x5E94;&#x8BE5;&#x662F;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x7684;SamplePriorityFirstStartup&#x4F18;&#x5148;&#x6267;&#x884C;&#x5B8C;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x662F;&#x9ED8;&#x8BA4;&#x4F18;&#x5148;&#x7EA7;SamplePrioritySecondStartup&#x6267;&#x884C;&#x5B8C;&#xFF0C;&#x6700;&#x540E;&#x624D;&#x662F;&#x8BBE;&#x7F6E;&#x540E;&#x53F0;&#x4F18;&#x5148;&#x7EA7;&#x7684;SamplePriorityThirdStartup&#x6267;&#x884C;&#x5B8C;&#x3002;</p>\n<p>&#x7531;&#x4E8E;android-startup&#x4E2D;&#x6709;&#x5BF9;&#x4EFB;&#x52A1;&#x8017;&#x65F6;&#x7684;&#x7EDF;&#x8BA1;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x770B;&#x5B83;&#x4EEC;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">|=================================================================</span><br><span class=\"line\">|      Startup Name       |   SamplePriorityThirdStartup</span><br><span class=\"line\">| ----------------------- | --------------------------------------</span><br><span class=\"line\">|   Call On Main Thread   |   false</span><br><span class=\"line\">| ----------------------- | --------------------------------------</span><br><span class=\"line\">|   Wait On Main Thread   |   false</span><br><span class=\"line\">| ----------------------- | --------------------------------------</span><br><span class=\"line\">|       Cost Times        |   834 ms</span><br><span class=\"line\">|=================================================================</span><br><span class=\"line\">|      Startup Name       |   SamplePrioritySecondStartup</span><br><span class=\"line\">| ----------------------- | --------------------------------------</span><br><span class=\"line\">|   Call On Main Thread   |   false</span><br><span class=\"line\">| ----------------------- | --------------------------------------</span><br><span class=\"line\">|   Wait On Main Thread   |   false</span><br><span class=\"line\">| ----------------------- | --------------------------------------</span><br><span class=\"line\">|       Cost Times        |   778 ms</span><br><span class=\"line\">|=================================================================</span><br><span class=\"line\">|      Startup Name       |   SamplePriorityFirstStartup</span><br><span class=\"line\">| ----------------------- | --------------------------------------</span><br><span class=\"line\">|   Call On Main Thread   |   false</span><br><span class=\"line\">| ----------------------- | --------------------------------------</span><br><span class=\"line\">|   Wait On Main Thread   |   false</span><br><span class=\"line\">| ----------------------- | --------------------------------------</span><br><span class=\"line\">|       Cost Times        |   610 ms</span><br><span class=\"line\">|=================================================================</span><br><span class=\"line\">| Total Main Thread Times |   25 ms</span><br><span class=\"line\">|=================================================================</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x5BF9;&#x6BD4;&#xFF0C;SamplePriorityFirstStartup&#x6267;&#x884C;&#x65F6;&#x95F4;&#x6700;&#x77ED;&#xFF0C;&#x5B8C;&#x7F8E;&#x9A8C;&#x8BC1;&#x4E86;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x7684;&#x9884;&#x6D4B;&#x7ED3;&#x679C;&#x3002;</p>\n<h2 id=\"&#x591A;&#x8FDB;&#x7A0B;\"><a href=\"#&#x591A;&#x8FDB;&#x7A0B;\" class=\"headerlink\" title=\"&#x591A;&#x8FDB;&#x7A0B;\"></a>&#x591A;&#x8FDB;&#x7A0B;</h2><p>android-startup&#x652F;&#x6301;&#x591A;&#x8FDB;&#x7A0B;&#x7684;&#x4EFB;&#x52A1;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x4E0D;&#x540C;&#x4EFB;&#x52A1;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x521D;&#x59CB;&#x5316;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x8FDB;&#x7A0B;&#x4E2D;&#x3002;</p>\n<p>android-startup&#x63D0;&#x4F9B;&#x4E86;MultipleProcess&#x6CE8;&#x89E3;&#x6765;&#x89E3;&#x51B3;&#x4E0D;&#x540C;&#x8FDB;&#x7A0B;&#x95F4;&#x4EFB;&#x52A1;&#x7684;&#x521D;&#x59CB;&#x5316;&#x95EE;&#x9898;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MustBeDocumented</span><br><span class=\"line\">@Retention</span><br><span class=\"line\">@Target(AnnotationTarget.CLASS)</span><br><span class=\"line\">annotation class MultipleProcess(val process: String)</span><br></pre></td></tr></table></figure>\n<p>MultipleProcess&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x4E0E;ThreadPriority&#x6CE8;&#x89E3;&#x7C7B;&#x4F3C;&#xFF0C;&#x53EA;&#x9700;&#x5728;&#x5BF9;&#x5E94;&#x7684;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#x4E0A;&#x6DFB;&#x52A0;MultipleProcess&#xFF0C;&#x540C;&#x65F6;&#x6307;&#x5B9A;&#x591A;&#x8FDB;&#x7A0B;&#x7684;&#x540D;&#x79F0;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@MultipleProcess(&quot;:multiple.process.service&quot;, &quot;:multiple.test&quot;)</span><br><span class=\"line\">class SampleMultipleFourthStartup : AndroidStartup&lt;String&gt;() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun create(context: Context): String? {</span><br><span class=\"line\">        Thread.sleep(1000)</span><br><span class=\"line\">        return SampleMultipleFourthStartup::class.java.simpleName</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun callCreateOnMainThread(): Boolean = false</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun waitOnMainThread(): Boolean = false</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x6211;&#x4EEC;&#x4E3A;SampleMultipleFourthStartup&#x6307;&#x5B9A;&#x4E86;&#x521D;&#x59CB;&#x5316;&#x6240;&#x5728;&#x7684;&#x8FDB;&#x7A0B;&#x540D;&#x79F0;:multiple.process.service&#x4E0E;:multiple.test&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x5728;AndroidManifest&#x4E2D;&#x914D;&#x7F6E;&#x4E86;&#x591A;&#x8FDB;&#x7A0B;&#x4E2D;&#x7684;service</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;service</span><br><span class=\"line\">    android:name=&quot;.MultipleProcessService&quot;</span><br><span class=\"line\">    android:process=&quot;:multiple.process.service&quot; /&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5728;service&#x7684;&#x591A;&#x8FDB;&#x7A0B;&#x4E2D;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#x65F6;&#xFF0C;&#x4F1A;&#x6392;&#x67E5;&#x6389;&#x4E0D;&#x5305;&#x62EC;:multiple.process.service&#x8FDB;&#x7A0B;&#x7684;&#x4EFB;&#x52A1;&#x3002;</p>\n<blockquote>\n<p>&#x5982;&#x679C;&#x672A;&#x8BBE;&#x7F6E;MultipleProcess&#xFF0C;&#x90A3;&#x4E48;&#x5F53;&#x524D;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#x9ED8;&#x8BA4;&#x652F;&#x6301;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#x3002;</p>\n</blockquote>\n<p>&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x5C31;&#x4E0D;&#x5728;&#x8FD9;&#x91CC;&#x5C55;&#x793A;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x6D89;&#x53CA;&#x5230;&#x591A;&#x8FDB;&#x7A0B;&#x7684;&#x4EA4;&#x4E92;&#xFF0C;&#x4EE3;&#x7801;&#x53EF;&#x80FD;&#x4F1A;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x6240;&#x6709;&#x5982;&#x679C;&#x60F3;&#x770B;&#x5B8C;&#x6574;&#x4EE3;&#x7801;&#x7684;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5230;Github&#x4E0A;&#x67E5;&#x770B;&#x3002;</p>\n<p>android-startup&#x591A;&#x8FDB;&#x7A0B;&#x7684;&#x8BBE;&#x7F6E;&#x5C31;&#x662F;&#x8FD9;&#x4E9B;&#xFF0C;&#x4F7F;&#x7528;&#x8D77;&#x6765;&#x8FD8;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x5E0C;&#x671B;&#x5927;&#x5BB6;&#x80FD;&#x591F;&#x559C;&#x6B22;&#x3002;</p>\n<p>&#x6709;&#x5173;android-startup&#x7684;&#x6700;&#x65B0;&#x66F4;&#x65B0;&#x5C31;&#x4ECB;&#x7ECD;&#x5230;&#x8FD9;&#x91CC;&#x4E86;&#xFF0C;&#x540E;&#x7EED;&#x5982;&#x6709;&#x66F4;&#x65B0;&#x6211;&#x4E5F;&#x4F1A;&#x53CA;&#x65F6;&#x540C;&#x6B65;&#x7ED9;&#x5927;&#x5BB6;&#x3002;</p>\n<p>&#x540C;&#x65F6;&#x6211;&#x4E5F;&#x4F1A;&#x65F6;&#x523B;&#x5173;&#x6CE8;Jetpack&#x7684;App Startup&#x7684;&#x8FDB;&#x5C55;&#xFF0C;&#x65F6;&#x523B;&#x53D6;&#x957F;&#x8865;&#x77ED;&#x52AA;&#x529B;&#x5B8C;&#x5584;android-startup&#xFF0C;&#x5C3D;&#x529B;&#x505A;&#x5230;&#x6700;&#x597D;&#x7684;Android&#x542F;&#x52A8;&#x4F18;&#x5316;&#x5E93;&#x3002;</p>\n<p>&#x6B22;&#x8FCE;&#x5927;&#x5BB6;&#x52A0;&#x5165;&#x4F7F;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x4F7F;&#x7528;&#x8FC7;&#x7A0B;&#x4E2D;&#x6709;&#x4EFB;&#x4F55;&#x7591;&#x95EE;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6765;&#x627E;&#x6211;&#xFF0C;&#x6211;&#x90FD;&#x4F1A;&#x5168;&#x7A0B;&#x8FDB;&#x884C;&#x89E3;&#x7B54;&#x3002;</p>\n<p>&#x5F53;&#x7136;&#x5982;&#x679C;&#x4F60;&#x6709;&#x597D;&#x7684;&#x5EFA;&#x8BAE;&#x4E5F;&#x6B22;&#x8FCE;&#x63D0;&#x51FA;&#xFF0C;&#x5E76;&#x4E14;&#x8BDA;&#x6073;&#x9080;&#x8BF7;&#x4F60;&#x52A0;&#x5165;&#x5230;android-startup&#x7684;&#x5EFA;&#x8BBE;&#x4E2D;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x4E00;&#x8D77;&#x4E3A;&#x5F00;&#x6E90;&#x5C3D;&#x4E00;&#x4EFD;&#x5FAE;&#x8584;&#x4E4B;&#x529B;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x62C9;&#x4E2A;&#x7968;&#xFF0C;&#x5F00;&#x6E90;&#x4E0D;&#x6613;&#xFF0C;&#x624B;&#x7559;&#x4F59;&#x9999;&#xFF0C;&#x5C0F;&#x6307;&#x5934;&#x70B9;&#x4E2A;Star&#x3002;</p>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["jetpack"]},{"title":"Kotlin协程实现原理:挂起与恢复","url":"https://www.rousetime.com/2020/11/23/Kotlin协程实现原理-挂起与恢复/","content":"<p>&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x6765;&#x804A;&#x804A;Kotlin&#x7684;&#x534F;&#x7A0B;Coroutine&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x6CA1;&#x6709;&#x63A5;&#x89E6;&#x8FC7;&#x534F;&#x7A0B;&#xFF0C;&#x63A8;&#x8350;&#x4F60;&#x5148;&#x9605;&#x8BFB;&#x8FD9;&#x7BC7;&#x5165;&#x95E8;&#x7EA7;&#x6587;&#x7AE0;<a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247483860&amp;idx=1&amp;sn=d8a4441912d0d1eee189d97506bb4689&amp;chksm=e8e0f844df977152652d69a3b4cc3cd1d1a148609f4295b6142e6d577156b76905e1cb6b95be&amp;token=1091218095&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">What? &#x4F60;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;Kotlin Coroutine?</a></p>\n<p>&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x63A5;&#x89E6;&#x8FC7;&#x534F;&#x7A0B;&#xFF0C;&#x4F46;&#x5BF9;&#x534F;&#x7A0B;&#x7684;&#x539F;&#x7406;&#x5B58;&#x5728;&#x7591;&#x60D1;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x9605;&#x8BFB;&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x4E4B;&#x524D;&#x63A8;&#x8350;&#x4F60;&#x5148;&#x9605;&#x8BFB;&#x4E0B;&#x9762;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x8FD9;&#x6837;&#x80FD;&#x8BA9;&#x4F60;&#x66F4;&#x5168;&#x9762;&#x66F4;&#x987A;&#x7545;&#x7684;&#x7406;&#x89E3;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x3002;</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484630&amp;idx=1&amp;sn=967175b88ce6d57e25917b4763601776&amp;chksm=e8e0fd46df9774500d1446410e6e04cde88fc40f27a95e9d059ca60cbdf5dc4099dc86ed4dc0&amp;token=1520540464&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Kotlin&#x534F;&#x7A0B;&#x5B9E;&#x73B0;&#x539F;&#x7406;:Suspend&amp;CoroutineContext</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484642&amp;idx=1&amp;sn=3d628b5094d05f0ea6fcb9559dcf73e4&amp;chksm=e8e0fd72df9774642d35efac6dac966ec1c7b25ea561fa686bdc8a08e672bea701e868d27d15&amp;token=1604035346&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Kotlin&#x534F;&#x7A0B;&#x5B9E;&#x73B0;&#x539F;&#x7406;:CoroutineScope&amp;Job</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484655&amp;idx=1&amp;sn=36fe3d4a0018b9b633e7aab0f00236a6&amp;chksm=e8e0fd7fdf977469c04c5624acbecc561f167aeaf434ca29d47beb69d9737a771ceb81424c8d&amp;token=1580936770&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Kotlin&#x534F;&#x7A0B;&#x5B9E;&#x73B0;&#x539F;&#x7406;:ContinuationInterceptor&amp;CoroutineDispatcher</a></p>\n<p>&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x63A5;&#x89E6;&#x8FC7;&#x534F;&#x7A0B;&#xFF0C;&#x76F8;&#x4FE1;&#x4F60;&#x90FD;&#x6709;&#x8FC7;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x7591;&#x95EE;&#xFF1A;</p>\n<ol>\n<li>&#x534F;&#x7A0B;&#x5230;&#x5E95;&#x662F;&#x4E2A;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF1F;</li>\n<li>&#x534F;&#x7A0B;&#x7684;suspend&#x6709;&#x4EC0;&#x4E48;&#x4F5C;&#x7528;&#xFF0C;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x662F;&#x600E;&#x6837;&#x7684;&#xFF1F;</li>\n<li>&#x534F;&#x7A0B;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x5173;&#x952E;&#x540D;&#x79F0;(&#x4F8B;&#x5982;&#xFF1A;Job&#x3001;Coroutine&#x3001;Dispatcher&#x3001;4. CoroutineContext&#x4E0E;CoroutineScope)&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x5230;&#x5E95;&#x662F;&#x600E;&#x4E48;&#x6837;&#x7684;&#x5173;&#x7CFB;&#xFF1F;</li>\n<li>&#x534F;&#x7A0B;&#x7684;&#x6240;&#x8C13;&#x975E;&#x963B;&#x585E;&#x5F0F;&#x6302;&#x8D77;&#x4E0E;&#x6062;&#x590D;&#x53C8;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</li>\n<li>&#x534F;&#x7A0B;&#x7684;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x662F;&#x600E;&#x4E48;&#x6837;&#x7684;&#xFF1F;</li>\n<li>&#x2026;</li>\n</ol>\n<p>&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x4E00;&#x4E9B;&#x6587;&#x7AE0;&#x8BD5;&#x7740;&#x6765;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x8FD9;&#x4E9B;&#x7591;&#x95EE;&#xFF0C;&#x4E5F;&#x6B22;&#x8FCE;&#x5927;&#x5BB6;&#x4E00;&#x8D77;&#x52A0;&#x5165;&#x6765;&#x8BA8;&#x8BBA;&#x3002;</p>\n<h2 id=\"&#x6302;&#x8D77;\"><a href=\"#&#x6302;&#x8D77;\" class=\"headerlink\" title=\"&#x6302;&#x8D77;\"></a>&#x6302;&#x8D77;</h2><p>&#x534F;&#x7A0B;&#x662F;&#x4F7F;&#x7528;&#x975E;&#x963B;&#x585E;&#x5F0F;&#x6302;&#x8D77;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x4FDD;&#x8BC1;&#x534F;&#x7A0B;&#x8FD0;&#x884C;&#x7684;&#x3002;&#x90A3;&#x4E48;&#x4EC0;&#x4E48;&#x662F;&#x975E;&#x963B;&#x585E;&#x5F0F;&#x6302;&#x8D77;&#x5462;&#xFF1F;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x804A;&#x804A;&#x6302;&#x8D77;&#x5230;&#x5E95;&#x662F;&#x4E00;&#x4E2A;&#x600E;&#x6837;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>\n<p>&#x5728;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#x4E2D;&#x63D0;&#x53CA;&#x5230;suspend&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x5B83;&#x7684;&#x4E00;&#x4E2A;&#x4F5C;&#x7528;&#x662F;&#x4EE3;&#x7801;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x4E3A;&#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;Continuation&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x4FDD;&#x8BC1;&#x534F;&#x7A0B;&#x4E2D;Continuaton&#x7684;&#x4E0A;&#x4E0B;&#x4F20;&#x9012;&#x3002;</p>\n<p>&#x800C;&#x5B83;&#x53E6;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x4F5C;&#x7528;&#x662F;&#x8D77;&#x5230;&#x6302;&#x8D77;&#x534F;&#x7A0B;&#x7684;&#x6807;&#x8BC6;&#x3002;</p>\n<p>&#x534F;&#x7A0B;&#x8FD0;&#x884C;&#x7684;&#x65F6;&#x5019;&#x6BCF;&#x9047;&#x5230;&#x88AB;suspend&#x4FEE;&#x9970;&#x7684;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x90FD;<strong>&#x6709;&#x53EF;&#x80FD;</strong>&#x4F1A;&#x6302;&#x8D77;&#x5F53;&#x524D;&#x7684;&#x534F;&#x7A0B;&#x3002;</p>\n<p>&#x6CE8;&#x610F;&#x662F;&#x6709;&#x53EF;&#x80FD;&#x3002;</p>\n<p>&#x4F60;&#x53EF;&#x4EE5;&#x968F;&#x4FBF;&#x5199;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4E5F;&#x53EF;&#x4EE5;&#x88AB;suspend&#x4FEE;&#x9970;&#xFF0C;&#x4F46;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x5728;&#x534F;&#x7A0B;&#x4E2D;&#x8C03;&#x7528;&#x662F;&#x4E0D;&#x4F1A;&#x88AB;&#x6302;&#x8D77;&#x7684;&#x3002;&#x4F8B;&#x5982;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private suspend fun a() {</span><br><span class=\"line\">\tprintln(&quot;aa&quot;)</span><br><span class=\"line\">}</span><br><span class=\"line\">lifecycleScope.launch {</span><br><span class=\"line\">\ta()</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x56E0;&#x4E3A;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x4E0D;&#x4F1A;&#x8FD4;&#x56DE;COROUTINE_SUSPENDED&#x7C7B;&#x578B;&#x7684;&#x3002;</p>\n<p>&#x534F;&#x7A0B;&#x88AB;&#x6302;&#x8D77;&#x7684;&#x6807;&#x5FD7;&#x662F;&#x5BF9;&#x5E94;&#x7684;&#x72B6;&#x6001;&#x4E0B;&#x8FD4;&#x56DE;COROUTINE_SUSPENDED&#x6807;&#x8BC6;&#x3002;</p>\n<p>&#x66F4;&#x6DF1;&#x5165;&#x4E00;&#x70B9;&#x7684;&#x8BDD;&#x5C31;&#x6D89;&#x53CA;&#x5230;<strong>&#x72B6;&#x6001;&#x673A;</strong>&#x3002;&#x534F;&#x7A0B;&#x5185;&#x90E8;&#x662F;&#x4F7F;&#x7528;&#x72B6;&#x6001;&#x673A;&#x6765;&#x7BA1;&#x7406;&#x534F;&#x7A0B;&#x7684;&#x5404;&#x4E2A;&#x6302;&#x8D77;&#x70B9;&#x3002;</p>\n<p>&#x6587;&#x5B57;&#x6709;&#x70B9;&#x62BD;&#x8C61;&#xFF0C;&#x5177;&#x4F53;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x6765;&#x770B;&#x4EE3;&#x7801;&#x3002;&#x6211;&#x4EEC;&#x5C31;&#x62FF;&#x4E0A;&#x9762;&#x7684;a&#x65B9;&#x6CD5;&#x4F8B;&#x5B50;&#x6765;&#x8BF4;&#x660E;&#x3002;</p>\n<p>&#x9996;&#x5148;&#x5728;Android Studio&#x6253;&#x5F00;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7684;Kotlin Bytecode&#x3002;&#x53EF;&#x4EE5;&#x5728;Tools -&gt; Kotlin -&gt; Show Kotlin Bytecode&#x4E2D;&#x6253;&#x5F00;&#x3002;</p>\n<p>&#x7136;&#x540E;&#x70B9;&#x51FB;&#x5176;&#x4E2D;&#x7684;Decompile&#x9009;&#x9879;&#xFF0C;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684;&#x53CD;&#x7F16;&#x8BD1;java&#x4EE3;&#x7801;&#x3002;&#x6700;&#x7EC8;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BuildersKt.launch$default((CoroutineScope)LifecycleOwnerKt.getLifecycleScope(this), (CoroutineContext)null, (CoroutineStart)null, (Function2)(new Function2((Continuation)null) {</span><br><span class=\"line\">   private CoroutineScope p$;</span><br><span class=\"line\">   Object L$0;</span><br><span class=\"line\">   int label;</span><br><span class=\"line\"> </span><br><span class=\"line\">   @Nullable</span><br><span class=\"line\">   public final Object invokeSuspend(@NotNull Object $result) {</span><br><span class=\"line\">      // &#x6302;&#x8D77;&#x6807;&#x8BC6;</span><br><span class=\"line\">      Object var3 = IntrinsicsKt.getCOROUTINE_SUSPENDED();</span><br><span class=\"line\">      CoroutineScope $this$launch;</span><br><span class=\"line\">      switch(this.label) {</span><br><span class=\"line\">      case 0:</span><br><span class=\"line\">         ResultKt.throwOnFailure($result);</span><br><span class=\"line\">         $this$launch = this.p$;</span><br><span class=\"line\">         MainActivity var10000 = MainActivity.this;</span><br><span class=\"line\">         // &#x4FDD;&#x5B58;&#x73B0;&#x573A;</span><br><span class=\"line\">         this.L$0 = $this$launch;</span><br><span class=\"line\">         // &#x8BBE;&#x7F6E;&#x6302;&#x8D77;&#x540E;&#x6062;&#x590D;&#x65F6;&#xFF0C;&#x8FDB;&#x5165;&#x7684;&#x72B6;&#x6001;</span><br><span class=\"line\">         this.label = 1;</span><br><span class=\"line\">         // &#x5224;&#x65AD;&#x662F;&#x5426;&#x6302;&#x8D77;</span><br><span class=\"line\">         if (var10000.a(this) == var3) {</span><br><span class=\"line\">            // &#x6302;&#x8D77;&#xFF0C;&#x8DF3;&#x51FA;&#x8BE5;&#x65B9;&#x6CD5;</span><br><span class=\"line\">            return var3;</span><br><span class=\"line\">         }</span><br><span class=\"line\">         // &#x4E0D;&#x9700;&#x8981;&#x6302;&#x8D77;&#xFF0C;&#x534F;&#x7A0B;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x5176;&#x4ED6;&#x903B;&#x8F91;</span><br><span class=\"line\">         break;</span><br><span class=\"line\">      case 1:</span><br><span class=\"line\">         // &#x6062;&#x590D;&#x73B0;&#x573A;</span><br><span class=\"line\">         $this$launch = (CoroutineScope)this.L$0;</span><br><span class=\"line\">         // &#x662F;&#x5426;&#x9700;&#x8981;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span><br><span class=\"line\">         ResultKt.throwOnFailure($result);</span><br><span class=\"line\">         break;</span><br><span class=\"line\">      default:</span><br><span class=\"line\">         throw new IllegalStateException(&quot;call to &apos;resume&apos; before &apos;invoke&apos; with coroutine&quot;);</span><br><span class=\"line\">      }</span><br><span class=\"line\">      return Unit.INSTANCE;</span><br><span class=\"line\">   }</span><br><span class=\"line\"> </span><br><span class=\"line\">   @NotNull</span><br><span class=\"line\">   public final Continuation create(@Nullable Object value, @NotNull Continuation completion) {</span><br><span class=\"line\">      Intrinsics.checkParameterIsNotNull(completion, &quot;completion&quot;);</span><br><span class=\"line\">      Function2 var3 = new &lt;anonymous constructor&gt;(completion);</span><br><span class=\"line\">      var3.p$ = (CoroutineScope)value;</span><br><span class=\"line\">      return var3;</span><br><span class=\"line\">   }</span><br><span class=\"line\"> </span><br><span class=\"line\">   public final Object invoke(Object var1, Object var2) {</span><br><span class=\"line\">      return ((&lt;undefinedtype&gt;)this.create(var1, (Continuation)var2)).invokeSuspend(Unit.INSTANCE);</span><br><span class=\"line\">   }</span><br><span class=\"line\">}), 3, (Object)null);</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x662F;&#x534F;&#x7A0B;&#x7684;&#x72B6;&#x6001;&#x673A;&#xFF0C;&#x901A;&#x8FC7;label&#x6765;&#x4EE3;&#x8868;&#x4E0D;&#x540C;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x4ECE;&#x800C;&#x5BF9;&#x5E94;&#x6267;&#x884C;&#x4E0D;&#x540C;case&#x4E2D;&#x7684;&#x903B;&#x8F91;&#x4EE3;&#x7801;&#x3002;</p>\n<p>&#x5728;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#x4E2D;&#x5DF2;&#x7ECF;&#x4ECB;&#x7ECD;&#x8FC7;&#xFF0C;&#x534F;&#x7A0B;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x624B;&#x52A8;&#x8C03;&#x7528;&#x4E00;&#x6B21;resumeWith&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x5B83;&#x5BF9;&#x5E94;&#x7684;&#x5185;&#x90E8;&#x903B;&#x8F91;&#x5C31;&#x662F;&#x6267;&#x884C;&#x4E0A;&#x9762;&#x7684;invokeSuspend&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x9996;&#x6B21;&#x8FD0;&#x884C;&#x534F;&#x7A0B;&#x65F6;label&#x503C;&#x4E3A;0&#xFF0C;&#x8FDB;&#x5165;case 0:&#x8BED;&#x53E5;&#x3002;&#x6B64;&#x65F6;&#x4F1A;&#x8BB0;&#x5F55;&#x73B0;&#x573A;&#x4E3A;&#x53EF;&#x80FD;&#x88AB;&#x6302;&#x8D77;&#x7684;&#x72B6;&#x6001;&#x505A;&#x51C6;&#x5907;&#xFF0C;&#x5E76;&#x8BBE;&#x7F6E;&#x4E0B;&#x4E00;&#x4E2A;&#x53EF;&#x80FD;&#x88AB;&#x6267;&#x884C;&#x7684;&#x72B6;&#x6001;&#x3002;</p>\n<p>&#x5982;&#x679C;a&#x65B9;&#x6CD5;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x4E3A;var3&#xFF0C;&#x8FD9;&#x4E2A;var3&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;COROUTINE_SUSPENDED&#x3002;&#x6240;&#x4EE5;&#x53EA;&#x6709;&#x5F53;a&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;COROUTINE_SUSPENDED&#x65F6;&#x624D;&#x4F1A;&#x6267;&#x884C;if&#x5185;&#x90E8;&#x8BED;&#x53E5;&#xFF0C;&#x8DF3;&#x51FA;&#x65B9;&#x6CD5;&#xFF0C;&#x6B64;&#x65F6;&#x534F;&#x7A0B;&#x5C31;&#x88AB;&#x6302;&#x8D77;&#x3002;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E5F;&#x5C31;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x5176;&#x5B83;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x88AB;&#x534F;&#x7A0B;&#x7684;&#x6302;&#x8D77;&#x6240;&#x963B;&#x585E;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x534F;&#x7A0B;&#x7684;&#x6302;&#x8D77;&#x5728;&#x4EE3;&#x7801;&#x5C42;&#x9762;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#x8DF3;&#x51FA;&#x534F;&#x7A0B;&#x6267;&#x884C;&#x7684;&#x65B9;&#x6CD5;&#x4F53;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x8DF3;&#x51FA;&#x534F;&#x7A0B;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x673A;&#x4E0B;&#x7684;&#x5BF9;&#x5E94;&#x72B6;&#x6001;&#xFF0C;&#x7136;&#x540E;&#x7B49;&#x5F85;&#x4E0B;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#x6765;&#x4E34;&#x65F6;&#x5728;&#x8FDB;&#x884C;&#x6267;&#x884C;&#x3002;</p>\n<p>&#x90A3;&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;&#x6211;&#x4EEC;&#x5199;&#x7684;&#x8FD9;&#x4E2A;a&#x65B9;&#x6CD5;&#x4E0D;&#x4F1A;&#x88AB;&#x6302;&#x8D77;&#x5462;&#xFF1F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Nullable</span><br><span class=\"line\">final Object a(@NotNull Continuation $completion) {</span><br><span class=\"line\">   return Unit.INSTANCE;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x539F;&#x6765;&#x662F;&#x5B83;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5E76;&#x4E0D;&#x662F;COROUTINE_SUSPENDED&#x3002;</p>\n<p>&#x65E2;&#x7136;&#x5B83;&#x4E0D;&#x4F1A;&#x88AB;&#x6302;&#x8D77;&#xFF0C;&#x90A3;&#x4E48;&#x4EC0;&#x4E48;&#x60C5;&#x51B5;&#x4E0B;&#x7684;&#x65B9;&#x6CD5;&#x624D;&#x4F1A;&#x88AB;&#x6302;&#x8D77;&#x5462;&#xFF1F;</p>\n<p>&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5728;a&#x65B9;&#x6CD5;&#x4E2D;&#x52A0;&#x5165;delay&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x5C31;&#x4F1A;&#x88AB;&#x6302;&#x8D77;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Nullable</span><br><span class=\"line\">final Object a(@NotNull Continuation $completion) {</span><br><span class=\"line\">   Object var10000 = DelayKt.delay(1000L, $completion);</span><br><span class=\"line\">   return var10000 == IntrinsicsKt.getCOROUTINE_SUSPENDED() ? var10000 : Unit.INSTANCE;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x771F;&#x6B63;&#x89E6;&#x53D1;&#x6302;&#x8D77;&#x7684;&#x662F;delay&#x65B9;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;delay&#x65B9;&#x6CD5;&#x4F1A;&#x521B;&#x5EFA;&#x81EA;&#x5DF1;Continuation&#xFF0C;&#x540C;&#x65F6;&#x5185;&#x90E8;&#x8C03;&#x7528;getResult&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">internal fun getResult(): Any? {</span><br><span class=\"line\">    installParentCancellationHandler()</span><br><span class=\"line\">    if (trySuspend()) return COROUTINE_SUSPENDED</span><br><span class=\"line\">    // otherwise, onCompletionInternal was already invoked &amp; invoked tryResume, and the result is in the state</span><br><span class=\"line\">    val state = this.state</span><br><span class=\"line\">    if (state is CompletedExceptionally) throw recoverStackTrace(state.cause, this)</span><br><span class=\"line\">    return getSuccessfulResult(state)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;getResult&#x65B9;&#x6CD5;&#x4E2D;&#x4F1A;&#x901A;&#x8FC7;trySuspend&#x6765;&#x5224;&#x65AD;&#x6302;&#x8D77;&#x5F53;&#x524D;&#x534F;&#x7A0B;&#x3002;&#x7531;&#x6302;&#x8D77;&#x81EA;&#x8EAB;&#x7684;&#x534F;&#x7A0B;&#xFF0C;&#x4ECE;&#x800C;&#x89E6;&#x53D1;&#x6302;&#x8D77;&#x7236;&#x7C7B;&#x7684;&#x534F;&#x7A0B;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x6D4B;&#x8BD5;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;a&#x65B9;&#x6CD5;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;COROUTINE_SUSPENDED</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private suspend fun a(): Any {</span><br><span class=\"line\">    return kotlin.coroutines.intrinsics.COROUTINE_SUSPENDED</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5F53;&#x7136;&#x7EBF;&#x4E0A;&#x5343;&#x4E07;&#x4E0D;&#x80FD;&#x8FD9;&#x6837;&#x5199;&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x65E6;&#x8FD9;&#x6837;&#x5199;&#x534F;&#x7A0B;&#x5C06;&#x4E00;&#x76F4;&#x88AB;&#x6302;&#x8D77;&#xFF0C;&#x56E0;&#x4E3A;&#x4F60;&#x6CA1;&#x6709;&#x5C06;&#x5176;&#x6062;&#x590D;&#x7684;&#x80FD;&#x529B;&#x3002;</p>\n<h2 id=\"&#x6062;&#x590D;\"><a href=\"#&#x6062;&#x590D;\" class=\"headerlink\" title=\"&#x6062;&#x590D;\"></a>&#x6062;&#x590D;</h2><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x804A;&#x4E00;&#x804A;&#x534F;&#x7A0B;&#x7684;&#x6062;&#x590D;&#x3002;</p>\n<p>&#x534F;&#x7A0B;&#x7684;&#x6062;&#x590D;&#x672C;&#x8D28;&#x662F;&#x901A;&#x8FC7;Continuation&#x7684;resumeWith&#x65B9;&#x6CD5;&#x6765;&#x89E6;&#x53D1;&#x7684;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x6302;&#x8D77;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x901A;&#x8FC7;&#x5B83;&#x6765;&#x5206;&#x6790;&#x534F;&#x7A0B;&#x6302;&#x8D77;&#x4E0E;&#x6062;&#x590D;&#x7684;&#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">println(&quot;main start&quot;)</span><br><span class=\"line\">lifecycleScope.launch {</span><br><span class=\"line\">   println(&quot;async start&quot;)</span><br><span class=\"line\">   val b = async {</span><br><span class=\"line\">       delay(2000)</span><br><span class=\"line\">       &quot;async&quot;</span><br><span class=\"line\">   }</span><br><span class=\"line\">   b.await()</span><br><span class=\"line\">   println(&quot;async end&quot;)</span><br><span class=\"line\">}</span><br><span class=\"line\">Handler().postDelayed({</span><br><span class=\"line\">   println(&quot;main end&quot;)</span><br><span class=\"line\">}, 1000)</span><br></pre></td></tr></table></figure>\n<p>Kotlin&#x4EE3;&#x7801;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5F53;&#x524D;&#x534F;&#x7A0B;&#x8FD0;&#x884C;&#x4E0E;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#xFF0C;&#x5185;&#x90E8;&#x6267;&#x884C;&#x4E00;&#x4E2A;async&#x65B9;&#x6CD5;&#xFF0C;&#x901A;&#x8FC7;await&#x65B9;&#x6CD5;&#x89E6;&#x53D1;&#x534F;&#x7A0B;&#x7684;&#x6302;&#x8D77;&#x3002;</p>\n<p>&#x518D;&#x6765;&#x770B;&#x5B83;&#x7684;&#x5BF9;&#x5E94;&#x53CD;&#x7F16;&#x8BD1;java&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 1</span><br><span class=\"line\">String var2 = &quot;main start&quot;;</span><br><span class=\"line\">System.out.println(var2);</span><br><span class=\"line\">BuildersKt.launch$default((CoroutineScope)LifecycleOwnerKt.getLifecycleScope(this), (CoroutineContext)null, (CoroutineStart)null, (Function2)(new Function2((Continuation)null) {</span><br><span class=\"line\">   private CoroutineScope p$;</span><br><span class=\"line\">   Object L$0;</span><br><span class=\"line\">   Object L$1;</span><br><span class=\"line\">   int label;</span><br><span class=\"line\"> </span><br><span class=\"line\">   @Nullable</span><br><span class=\"line\">   public final Object invokeSuspend(@NotNull Object $result) {</span><br><span class=\"line\">      Object var5 = IntrinsicsKt.getCOROUTINE_SUSPENDED();</span><br><span class=\"line\">      CoroutineScope $this$launch;</span><br><span class=\"line\">      Deferred b;</span><br><span class=\"line\">      switch(this.label) {</span><br><span class=\"line\">      case 0:</span><br><span class=\"line\">         // 2</span><br><span class=\"line\">         ResultKt.throwOnFailure($result);</span><br><span class=\"line\">         $this$launch = this.p$;</span><br><span class=\"line\">         String var6 = &quot;async start&quot;;</span><br><span class=\"line\">         System.out.println(var6);</span><br><span class=\"line\">         b = BuildersKt.async$default($this$launch, (CoroutineContext)null, (CoroutineStart)null, (Function2)(new Function2((Continuation)null) {</span><br><span class=\"line\">            private CoroutineScope p$;</span><br><span class=\"line\">            Object L$0;</span><br><span class=\"line\">            int label;</span><br><span class=\"line\"> </span><br><span class=\"line\">            @Nullable</span><br><span class=\"line\">            public final Object invokeSuspend(@NotNull Object $result) {</span><br><span class=\"line\">               Object var3 = IntrinsicsKt.getCOROUTINE_SUSPENDED();</span><br><span class=\"line\">               CoroutineScope $this$async;</span><br><span class=\"line\">               switch(this.label) {</span><br><span class=\"line\">               case 0:</span><br><span class=\"line\">                  // 3</span><br><span class=\"line\">                  ResultKt.throwOnFailure($result);</span><br><span class=\"line\">                  $this$async = this.p$;</span><br><span class=\"line\">                  this.L$0 = $this$async;</span><br><span class=\"line\">                  this.label = 1;</span><br><span class=\"line\">                  if (DelayKt.delay(2000L, this) == var3) {</span><br><span class=\"line\">                     return var3;</span><br><span class=\"line\">                  }</span><br><span class=\"line\">                  break;</span><br><span class=\"line\">               case 1:</span><br><span class=\"line\">                  // 5&#x3001;6</span><br><span class=\"line\">                  $this$async = (CoroutineScope)this.L$0;</span><br><span class=\"line\">                  ResultKt.throwOnFailure($result);</span><br><span class=\"line\">                  break;</span><br><span class=\"line\">               default:</span><br><span class=\"line\">                  throw new IllegalStateException(&quot;call to &apos;resume&apos; before &apos;invoke&apos; with coroutine&quot;);</span><br><span class=\"line\">               }</span><br><span class=\"line\"> </span><br><span class=\"line\">               return &quot;async&quot;;</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            @NotNull</span><br><span class=\"line\">            public final Continuation create(@Nullable Object value, @NotNull Continuation completion) {</span><br><span class=\"line\">               Intrinsics.checkParameterIsNotNull(completion, &quot;completion&quot;);</span><br><span class=\"line\">               Function2 var3 = new &lt;anonymous constructor&gt;(completion);</span><br><span class=\"line\">               var3.p$ = (CoroutineScope)value;</span><br><span class=\"line\">               return var3;</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            public final Object invoke(Object var1, Object var2) {</span><br><span class=\"line\">               return ((&lt;undefinedtype&gt;)this.create(var1, (Continuation)var2)).invokeSuspend(Unit.INSTANCE);</span><br><span class=\"line\">            }</span><br><span class=\"line\">         }), 3, (Object)null);</span><br><span class=\"line\">         this.L$0 = $this$launch;</span><br><span class=\"line\">         this.L$1 = b;</span><br><span class=\"line\">         this.label = 1;</span><br><span class=\"line\">         if (b.await(this) == var5) {</span><br><span class=\"line\">            return var5;</span><br><span class=\"line\">         }</span><br><span class=\"line\">         break;</span><br><span class=\"line\">      case 1:</span><br><span class=\"line\">         // 7</span><br><span class=\"line\">         b = (Deferred)this.L$1;</span><br><span class=\"line\">         $this$launch = (CoroutineScope)this.L$0;</span><br><span class=\"line\">         ResultKt.throwOnFailure($result);</span><br><span class=\"line\">         break;</span><br><span class=\"line\">      default:</span><br><span class=\"line\">         throw new IllegalStateException(&quot;call to &apos;resume&apos; before &apos;invoke&apos; with coroutine&quot;);</span><br><span class=\"line\">      }</span><br><span class=\"line\"> </span><br><span class=\"line\">      // 8</span><br><span class=\"line\">      String var4 = &quot;async end&quot;;</span><br><span class=\"line\">      System.out.println(var4);</span><br><span class=\"line\">      return Unit.INSTANCE;</span><br><span class=\"line\">   }</span><br><span class=\"line\"> </span><br><span class=\"line\">   @NotNull</span><br><span class=\"line\">   public final Continuation create(@Nullable Object value, @NotNull Continuation completion) {</span><br><span class=\"line\">      Intrinsics.checkParameterIsNotNull(completion, &quot;completion&quot;);</span><br><span class=\"line\">      Function2 var3 = new &lt;anonymous constructor&gt;(completion);</span><br><span class=\"line\">      var3.p$ = (CoroutineScope)value;</span><br><span class=\"line\">      return var3;</span><br><span class=\"line\">   }</span><br><span class=\"line\"> </span><br><span class=\"line\">   public final Object invoke(Object var1, Object var2) {</span><br><span class=\"line\">      return ((&lt;undefinedtype&gt;)this.create(var1, (Continuation)var2)).invokeSuspend(Unit.INSTANCE);</span><br><span class=\"line\">   }</span><br><span class=\"line\">}), 3, (Object)null);</span><br><span class=\"line\">// 4</span><br><span class=\"line\">(new Handler()).postDelayed((Runnable)null.INSTANCE, 1000L);</span><br></pre></td></tr></table></figure>\n<p>&#x6709;&#x70B9;&#x957F;&#xFF0C;&#x6CA1;&#x5173;&#x7CFB;&#x6211;&#x4EEC;&#x53EA;&#x770B;&#x5173;&#x952E;&#x70B9;&#xFF0C;&#x770B;&#x5B83;&#x7684;&#x72B6;&#x6001;&#x673A;&#x76F8;&#x5173;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>\n<ol>\n<li>&#x9996;&#x5148;&#x4F1A;&#x8F93;&#x51FA;main start&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;launch&#x521B;&#x5EFA;&#x534F;&#x7A0B;&#xFF0C;&#x8FDB;&#x5165;&#x534F;&#x7A0B;&#x72B6;&#x6001;&#x673A;&#xFF0C;&#x6B64;&#x65F6;label&#x4E3A;0&#xFF0C;&#x6267;&#x884C;case: 0&#x76F8;&#x5173;&#x903B;&#x8F91;&#x3002;</li>\n<li>&#x8FDB;&#x5165;case: 0&#x540E;&#x8F93;&#x51FA;async start&#xFF0C;&#x8C03;&#x7528;async&#x5E76;&#x901A;&#x8FC7;await&#x6765;&#x6302;&#x8D77;&#x5F53;&#x524D;&#x534F;&#x7A0B;&#xFF0C;&#x518D;&#x6302;&#x8D77;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x8BB0;&#x5F55;&#x5F53;&#x524D;&#x6302;&#x8D77;&#x70B9;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x5C06;lable&#x8BBE;&#x7F6E;&#x4E3A;1&#x3002;</li>\n<li>&#x8FDB;&#x5165;async&#x521B;&#x5EFA;&#x7684;&#x534F;&#x7A0B;&#xFF0C;&#x6B64;&#x65F6;async&#x534F;&#x7A0B;&#x4E2D;&#x7684;lable&#x4E3A;0&#xFF0C;&#x8FDB;&#x5165;async case: 0&#x6267;&#x884C;dealy&#x5E76;&#x6302;&#x8D77;async&#x7684;&#x534F;&#x7A0B;&#x3002;&#x5E76;&#x5C06;label&#x8BBE;&#x7F6E;&#x4E3A;1&#x3002;&#x7B49;&#x5F85;2s&#x4E4B;&#x540E;&#x88AB;&#x5524;&#x9192;&#x3002;</li>\n<li>&#x6B64;&#x65F6;&#x534F;&#x7A0B;&#x90FD;&#x88AB;&#x6302;&#x8D77;&#xFF0C;&#x5373;&#x8DF3;&#x51FA;&#x534F;&#x7A0B;launch&#x65B9;&#x6CD5;&#xFF0C;&#x6267;&#x884C;handler&#x64CD;&#x4F5C;&#x3002;&#x7531;&#x4E8E;post 1s&#x6240;&#x4EE5;&#x6BD4;&#x534F;&#x7A0B;&#x4E2D;dealy&#x8FD8;&#x77ED;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x4F18;&#x5148;&#x8F93;&#x51FA;main end&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8FC7;1s&#xFF0C;&#x8FDB;&#x5165;&#x6062;&#x590D;&#x534F;&#x7A0B;&#x9636;&#x6BB5;</li>\n<li>async&#x4E2D;&#x7684;&#x534F;&#x7A0B;&#x88AB;delay&#x6062;&#x590D;&#xFF0C;&#x6CE8;&#x610F;&#x5728;delay&#x65B9;&#x6CD5;&#x4E2D;&#x4F20;&#x5165;&#x4E86;this&#xFF0C;async&#x7684;Continuation&#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x4EE5;delay&#x5185;&#x90E8;&#x4E00;&#x65E6;&#x5B8C;&#x6210;2s&#x8BA1;&#x65F6;&#x5C31;&#x4F1A;&#x8C03;&#x7528;Continuation&#x7684;resumeWith&#x65B9;&#x6CD5;&#x6765;&#x6062;&#x590D;async&#x4E2D;&#x7684;&#x534F;&#x7A0B;&#xFF0C;&#x5373;&#x8C03;&#x7528;invokeSuspend&#x65B9;&#x6CD5;&#x3002;</li>\n<li>&#x7531;&#x4E8E;&#x88AB;&#x6302;&#x8D77;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x5C06;async label&#x8BBE;&#x7F6E;&#x4E3A;1&#xFF0C;&#x6240;&#x4EE5;&#x8FDB;&#x5165;case: 1&#xFF0C;&#x6062;&#x590D;&#x4E4B;&#x524D;&#x6302;&#x8D77;&#x7684;&#x73B0;&#x573A;&#xFF0C;&#x68C0;&#x67E5;&#x5F02;&#x5E38;&#xFF0C;&#x6700;&#x7EC8;&#x8FD4;&#x56DE;async&#x3002;</li>\n<li>&#x6B64;&#x65F6;await&#x6302;&#x8D77;&#x70B9;&#x88AB;&#x6062;&#x590D;&#xFF0C;&#x6CE8;&#x610F;&#x5B83;&#x4E5F;&#x4F20;&#x5165;&#x4E86;this&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;launch&#x4E2D;&#x7684;Continuation&#xFF0C;&#x6240;&#x4EE5;&#x4E5F;&#x4F1A;&#x56DE;&#x8C03;resumeWith&#x65B9;&#x6CD5;&#xFF0C;&#x6700;&#x7EC8;&#x8C03;&#x7528;invokeSuspend&#xFF0C;&#x5373;&#x8FDB;&#x5165;case 1:&#x6062;&#x590D;&#x73B0;&#x573A;&#xFF0C;&#x7ED3;&#x675F;&#x72B6;&#x6001;&#x673A;&#x3002;</li>\n<li>&#x6700;&#x540E;&#x518D;&#x7EE7;&#x7EED;&#x8F93;&#x51FA;async end&#xFF0C;&#x534F;&#x7A0B;&#x8FD0;&#x884C;&#x7ED3;&#x675F;&#x3002;</li>\n</ol>\n<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x6765;&#x9A8C;&#x8BC1;&#x8F93;&#x51FA;&#x662F;&#x5426;&#x6B63;&#x786E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">main start</span><br><span class=\"line\">async start</span><br><span class=\"line\">main end</span><br><span class=\"line\">async end</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x6765;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#xFF0C;&#x534F;&#x7A0B;&#x901A;&#x8FC7;suspend&#x6765;&#x6807;&#x8BC6;&#x6302;&#x8D77;&#x70B9;&#xFF0C;&#x4F46;&#x771F;&#x6B63;&#x7684;&#x6302;&#x8D77;&#x70B9;&#x8FD8;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x662F;&#x5426;&#x8FD4;&#x56DE;COROUTINE_SUSPENDED&#x6765;&#x5224;&#x65AD;&#xFF0C;&#x800C;&#x4EE3;&#x7801;&#x4F53;&#x73B0;&#x662F;&#x901A;&#x8FC7;&#x72B6;&#x6001;&#x673A;&#x6765;&#x5904;&#x7406;&#x534F;&#x7A0B;&#x7684;&#x6302;&#x8D77;&#x4E0E;&#x6062;&#x590D;&#x3002;&#x5728;&#x9700;&#x8981;&#x6302;&#x8D77;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5148;&#x4FDD;&#x7559;&#x73B0;&#x573A;&#x4E0E;&#x8BBE;&#x7F6E;&#x4E0B;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#x70B9;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x901A;&#x8FC7;&#x9000;&#x51FA;&#x65B9;&#x6CD5;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x6302;&#x8D77;&#x534F;&#x7A0B;&#x3002;&#x5728;&#x6302;&#x8D77;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x5E76;&#x4E0D;&#x4F1A;&#x963B;&#x585E;&#x5F53;&#x524D;&#x7684;&#x7EBF;&#x7A0B;&#x3002;&#x5BF9;&#x5E94;&#x7684;&#x6062;&#x590D;&#x901A;&#x8FC7;resumeWith&#x6765;&#x8FDB;&#x5165;&#x72B6;&#x6001;&#x673A;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#xFF0C;&#x540C;&#x65F6;&#x5728;&#x8FDB;&#x5165;&#x4E0B;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#x65F6;&#x4F1A;&#x6062;&#x590D;&#x4E4B;&#x524D;&#x6302;&#x8D77;&#x7684;&#x73B0;&#x573A;&#x3002;</p>\n<p>&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x4E86;&#x534F;&#x7A0B;&#x7684;&#x6302;&#x8D77;&#x4E0E;&#x6062;&#x590D;&#x539F;&#x7406;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x5206;&#x6790;&#x4E86;&#x534F;&#x7A0B;&#x7684;&#x72B6;&#x6001;&#x673A;&#x76F8;&#x5173;&#x7684;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x3002;&#x5E0C;&#x671B;&#x5BF9;&#x5B66;&#x4E60;&#x534F;&#x7A0B;&#x7684;&#x4F19;&#x4F34;&#x4EEC;&#x80FD;&#x591F;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#xFF0C;&#x656C;&#x8BF7;&#x671F;&#x5F85;&#x540E;&#x7EED;&#x7684;&#x534F;&#x7A0B;&#x5206;&#x6790;&#x3002;</p>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["coroutine"]},{"title":"Kotlin协程实现原理:ContinuationInterceptor&CoroutineDispatcher","url":"https://www.rousetime.com/2020/11/17/Kotlin协程实现原理-ContinuationInterceptor-CoroutineDispatcher/","content":"<p>&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x6765;&#x804A;&#x804A;Kotlin&#x7684;&#x534F;&#x7A0B;Coroutine&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x6CA1;&#x6709;&#x63A5;&#x89E6;&#x8FC7;&#x534F;&#x7A0B;&#xFF0C;&#x63A8;&#x8350;&#x4F60;&#x5148;&#x9605;&#x8BFB;&#x8FD9;&#x7BC7;&#x5165;&#x95E8;&#x7EA7;&#x6587;&#x7AE0;<a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247483860&amp;idx=1&amp;sn=d8a4441912d0d1eee189d97506bb4689&amp;chksm=e8e0f844df977152652d69a3b4cc3cd1d1a148609f4295b6142e6d577156b76905e1cb6b95be&amp;token=1091218095&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">What? &#x4F60;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;Kotlin Coroutine?</a></p>\n<p>&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x63A5;&#x89E6;&#x8FC7;&#x534F;&#x7A0B;&#xFF0C;&#x4F46;&#x5BF9;&#x534F;&#x7A0B;&#x7684;&#x539F;&#x7406;&#x5B58;&#x5728;&#x7591;&#x60D1;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x9605;&#x8BFB;&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x4E4B;&#x524D;&#x63A8;&#x8350;&#x4F60;&#x5148;&#x9605;&#x8BFB;&#x4E0B;&#x9762;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x8FD9;&#x6837;&#x80FD;&#x8BA9;&#x4F60;&#x66F4;&#x5168;&#x9762;&#x66F4;&#x987A;&#x7545;&#x7684;&#x7406;&#x89E3;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x3002;</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484630&amp;idx=1&amp;sn=967175b88ce6d57e25917b4763601776&amp;chksm=e8e0fd46df9774500d1446410e6e04cde88fc40f27a95e9d059ca60cbdf5dc4099dc86ed4dc0&amp;token=1520540464&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Kotlin&#x534F;&#x7A0B;&#x5B9E;&#x73B0;&#x539F;&#x7406;:Suspend&amp;CoroutineContext</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484642&amp;idx=1&amp;sn=3d628b5094d05f0ea6fcb9559dcf73e4&amp;chksm=e8e0fd72df9774642d35efac6dac966ec1c7b25ea561fa686bdc8a08e672bea701e868d27d15&amp;token=1604035346&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Kotlin&#x534F;&#x7A0B;&#x5B9E;&#x73B0;&#x539F;&#x7406;:CoroutineScope&amp;Job</a></p>\n<p>&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x63A5;&#x89E6;&#x8FC7;&#x534F;&#x7A0B;&#xFF0C;&#x76F8;&#x4FE1;&#x4F60;&#x90FD;&#x6709;&#x8FC7;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x7591;&#x95EE;&#xFF1A;</p>\n<ol>\n<li>&#x534F;&#x7A0B;&#x5230;&#x5E95;&#x662F;&#x4E2A;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF1F;</li>\n<li>&#x534F;&#x7A0B;&#x7684;suspend&#x6709;&#x4EC0;&#x4E48;&#x4F5C;&#x7528;&#xFF0C;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x662F;&#x600E;&#x6837;&#x7684;&#xFF1F;</li>\n<li>&#x534F;&#x7A0B;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x5173;&#x952E;&#x540D;&#x79F0;(&#x4F8B;&#x5982;&#xFF1A;Job&#x3001;Coroutine&#x3001;Dispatcher&#x3001;4. CoroutineContext&#x4E0E;CoroutineScope)&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x5230;&#x5E95;&#x662F;&#x600E;&#x4E48;&#x6837;&#x7684;&#x5173;&#x7CFB;&#xFF1F;</li>\n<li>&#x534F;&#x7A0B;&#x7684;&#x6240;&#x8C13;&#x975E;&#x963B;&#x585E;&#x5F0F;&#x6302;&#x8D77;&#x4E0E;&#x6062;&#x590D;&#x53C8;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</li>\n<li>&#x534F;&#x7A0B;&#x7684;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x662F;&#x600E;&#x4E48;&#x6837;&#x7684;&#xFF1F;</li>\n<li>&#x2026;</li>\n</ol>\n<p>&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x4E00;&#x4E9B;&#x6587;&#x7AE0;&#x8BD5;&#x7740;&#x6765;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x8FD9;&#x4E9B;&#x7591;&#x95EE;&#xFF0C;&#x4E5F;&#x6B22;&#x8FCE;&#x5927;&#x5BB6;&#x4E00;&#x8D77;&#x52A0;&#x5165;&#x6765;&#x8BA8;&#x8BBA;&#x3002;</p>\n<h2 id=\"ContinuationInterceptor\"><a href=\"#ContinuationInterceptor\" class=\"headerlink\" title=\"ContinuationInterceptor\"></a>ContinuationInterceptor</h2><p>&#x770B;&#x5230;Interceptor&#x76F8;&#x4FE1;&#x7B2C;&#x4E00;&#x5370;&#x8C61;&#x5E94;&#x8BE5;&#x5C31;&#x662F;&#x62E6;&#x622A;&#x5668;&#xFF0C;&#x4F8B;&#x5982;&#x5728;Okhttp&#x4E2D;&#x88AB;&#x5E7F;&#x6CDB;&#x5E94;&#x7528;&#x3002;&#x81EA;&#x7136;&#x5728;&#x534F;&#x7A0B;&#x4E2D;ContinuationInterceptor&#x7684;&#x4F5C;&#x7528;&#x4E5F;&#x662F;&#x7528;&#x6765;&#x505A;&#x62E6;&#x622A;&#x534F;&#x7A0B;&#x7684;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6765;&#x770B;&#x4E0B;&#x5B83;&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface ContinuationInterceptor : CoroutineContext.Element {</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * The key that defines *the* context interceptor.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    companion object Key : CoroutineContext.Key&lt;ContinuationInterceptor&gt;</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Returns continuation that wraps the original [continuation], thus intercepting all resumptions.</span><br><span class=\"line\">     * This function is invoked by coroutines framework when needed and the resulting continuations are</span><br><span class=\"line\">     * cached internally per each instance of the original [continuation].</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * This function may simply return original [continuation] if it does not want to intercept this particular continuation.</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * When the original [continuation] completes, coroutine framework invokes [releaseInterceptedContinuation]</span><br><span class=\"line\">     * with the resulting continuation if it was intercepted, that is if `interceptContinuation` had previously</span><br><span class=\"line\">     * returned a different continuation instance.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public fun &lt;T&gt; interceptContinuation(continuation: Continuation&lt;T&gt;): Continuation&lt;T&gt;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x53EA;&#x7ED9;&#x51FA;&#x4E86;&#x5173;&#x952E;&#x90E8;&#x5206;&#xFF0C;ContinuationInterceptor&#x7EE7;&#x627F;&#x4E8E;CoroutineContext.Element&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4E5F;&#x662F;CoroutineContext&#xFF0C;&#x540C;&#x65F6;&#x63D0;&#x4F9B;&#x4E86;interceptContinuation&#x65B9;&#x6CD5;&#xFF0C;&#x5148;&#x8BB0;&#x4F4F;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x540E;&#x7EED;&#x4F1A;&#x7528;&#x5230;&#x3002;</p>\n<p>&#x5927;&#x5BB6;&#x662F;&#x5426;&#x8FD8;&#x8BB0;&#x5F97;&#x5728;<strong>Kotlin&#x534F;&#x7A0B;&#x5B9E;&#x73B0;&#x539F;&#x7406;</strong>&#x7CFB;&#x5217;&#x7684;&#x7B2C;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5206;&#x6790;&#x4E86;CoroutineContext&#x7684;&#x5185;&#x90E8;&#x7ED3;&#x6784;&#xFF0C;&#x5F53;&#x65F6;&#x63D0;&#x5230;&#x4E86;&#x5B83;&#x7684;plus&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x662F;&#x4E0B;&#x9762;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public operator fun plus(context: CoroutineContext): CoroutineContext =</span><br><span class=\"line\">    if (context === EmptyCoroutineContext) this else // fast path -- avoid lambda creation</span><br><span class=\"line\">        context.fold(this) { acc, element -&gt;</span><br><span class=\"line\">            val removed = acc.minusKey(element.key)</span><br><span class=\"line\">            if (removed === EmptyCoroutineContext) element else {</span><br><span class=\"line\">                // make sure interceptor is always last in the context (and thus is fast to get when present)</span><br><span class=\"line\">                val interceptor = removed[ContinuationInterceptor]</span><br><span class=\"line\">                if (interceptor == null) CombinedContext(removed, element) else {</span><br><span class=\"line\">                    val left = removed.minusKey(ContinuationInterceptor)</span><br><span class=\"line\">                    if (left === EmptyCoroutineContext) CombinedContext(element, interceptor) else</span><br><span class=\"line\">                        CombinedContext(CombinedContext(left, element), interceptor)</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x7B2C;&#x4E00;&#x6B21;&#x770B;&#x5230;&#x4E86;ContinuationInterceptor&#x7684;&#x8EAB;&#x5F71;&#xFF0C;&#x5F53;&#x65F6;&#x6838;&#x5FC3;&#x662F;&#x4E3A;&#x4E86;&#x5206;&#x6790;CoroutineContext&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x662F;&#x63D0;&#x4E86;plus&#x65B9;&#x6CD5;&#x6BCF;&#x6B21;&#x90FD;&#x4F1A;&#x5C06;ContinuationInterceptor&#x6DFB;&#x52A0;&#x5230;&#x62FC;&#x63A5;&#x94FE;&#x7684;&#x5C3E;&#x90E8;&#x3002;</p>\n<p>&#x4E0D;&#x77E5;&#x9053;&#x6709;&#x6CA1;&#x6709;&#x8001;&#x94C1;&#x60F3;&#x8FC7;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6BCF;&#x6B21;&#x65B0;&#x52A0;&#x5165;&#x4E00;&#x4E2A;CoroutineContext&#x90FD;&#x8981;&#x8C03;&#x6574;ContinuationInterceptor&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5E76;&#x5C06;&#x5B83;&#x6DFB;&#x52A0;&#x5230;&#x5C3E;&#x90E8;&#xFF1F;</p>\n<p>&#x8FD9;&#x91CC;&#x5176;&#x5B9E;&#x6D89;&#x53CA;&#x5230;&#x4E24;&#x70B9;&#x3002;</p>\n<p>&#x5176;&#x4E2D;&#x4E00;&#x70B9;&#x662F;&#x7531;&#x4E8E;CombinedContext&#x7684;&#x7ED3;&#x6784;&#x51B3;&#x5B9A;&#x7684;&#x3002;&#x5B83;&#x6709;&#x4E24;&#x4E2A;&#x5143;&#x7D20;&#x5206;&#x522B;&#x662F;left&#x4E0E;element&#x3002;&#x800C;left&#x7C7B;&#x4F3C;&#x4E8E;&#x524D;&#x9A71;&#x8282;&#x70B9;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x524D;&#x9A71;&#x96C6;&#x5408;&#xFF0C;&#x800C;element&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x7EAF;&#x788E;&#x7684;CoroutineContext&#xFF0C;&#x800C;&#x5B83;&#x7684;get&#x65B9;&#x6CD5;&#x6BCF;&#x6B21;&#x90FD;&#x662F;&#x4ECE;element&#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x67E5;&#x627E;&#x5BF9;&#x5E94;Key&#x7684;CoroutineContext&#x5BF9;&#x8C61;&#xFF1B;&#x6CA1;&#x6709;&#x5339;&#x914D;&#x5230;&#x624D;&#x4F1A;&#x53BB;left&#x96C6;&#x5408;&#x4E2D;&#x8FDB;&#x884C;&#x9012;&#x5F52;&#x67E5;&#x627E;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x52A0;&#x5FEB;&#x67E5;&#x627E;ContinuationInterceptor&#x7C7B;&#x578B;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x624D;&#x5C06;&#x5B83;&#x52A0;&#x5165;&#x5230;&#x62FC;&#x63A5;&#x94FE;&#x7684;&#x5C3E;&#x90E8;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;element&#x3002;</p>\n<p>&#x53E6;&#x4E00;&#x4E2A;&#x539F;&#x56E0;&#x662F;ContinuationInterceptor&#x4F7F;&#x7528;&#x7684;&#x5F88;&#x9891;&#x7E41;&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x6B21;&#x521B;&#x5EFA;&#x534F;&#x7A0B;&#x90FD;&#x4F1A;&#x53BB;&#x5C1D;&#x8BD5;&#x67E5;&#x627E;&#x5F53;&#x524D;&#x534F;&#x7A0B;&#x7684;CoroutineContext&#x4E2D;&#x662F;&#x5426;&#x5B58;&#x5728;ContinuationInterceptor&#x3002;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x901A;&#x8FC7;launch&#x6765;&#x770B;&#x534F;&#x7A0B;&#x7684;&#x542F;&#x52A8;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public fun CoroutineScope.launch(</span><br><span class=\"line\">    context: CoroutineContext = EmptyCoroutineContext,</span><br><span class=\"line\">    start: CoroutineStart = CoroutineStart.DEFAULT,</span><br><span class=\"line\">    block: suspend CoroutineScope.() -&gt; Unit</span><br><span class=\"line\">): Job {</span><br><span class=\"line\">    val newContext = newCoroutineContext(context)</span><br><span class=\"line\">    val coroutine = if (start.isLazy)</span><br><span class=\"line\">        LazyStandaloneCoroutine(newContext, block) else</span><br><span class=\"line\">        StandaloneCoroutine(newContext, active = true)</span><br><span class=\"line\">    coroutine.start(start, coroutine, block)</span><br><span class=\"line\">    return coroutine</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x4F60;&#x4F7F;&#x7528;launch&#x7684;&#x9ED8;&#x8BA4;&#x53C2;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x6B64;&#x65F6;&#x7684;Coroutine&#x5C31;&#x662F;StandaloneCoroutine&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;start&#x65B9;&#x6CD5;&#x542F;&#x52A8;&#x534F;&#x7A0B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public fun &lt;R&gt; start(start: CoroutineStart, receiver: R, block: suspend R.() -&gt; T) {</span><br><span class=\"line\">    initParentJob()</span><br><span class=\"line\">    start(block, receiver, this)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;start&#x4E2D;&#x8FDB;&#x5165;&#x4E86;CoroutineStart&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;&#x4E0B;&#x9762;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public operator fun &lt;R, T&gt; invoke(block: suspend R.() -&gt; T, receiver: R, completion: Continuation&lt;T&gt;) =</span><br><span class=\"line\">    when (this) {</span><br><span class=\"line\">        CoroutineStart.DEFAULT -&gt; block.startCoroutineCancellable(receiver, completion)</span><br><span class=\"line\">        CoroutineStart.ATOMIC -&gt; block.startCoroutine(receiver, completion)</span><br><span class=\"line\">        CoroutineStart.UNDISPATCHED -&gt; block.startCoroutineUndispatched(receiver, completion)</span><br><span class=\"line\">        CoroutineStart.LAZY -&gt; Unit // will start lazily</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x9ED8;&#x8BA4;&#x53C2;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;CoroutineStart.DEFAULT&#xFF0C;&#x6700;&#x7EC8;&#x6765;&#x5230;block.startCoroutineCancellable</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">internal fun &lt;R, T&gt; (suspend (R) -&gt; T).startCoroutineCancellable(receiver: R, completion: Continuation&lt;T&gt;) =</span><br><span class=\"line\">    runSafely(completion) {</span><br><span class=\"line\">        createCoroutineUnintercepted(receiver, completion).intercepted().resumeCancellable(Unit)</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x7EC8;&#x4E8E;&#x770B;&#x5230;&#x4E86;intercepted&#x3002;</p>\n<p>&#x9996;&#x5148;&#x901A;&#x8FC7;createCoroutineUnintercepted&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x534F;&#x7A0B;(&#x5185;&#x90E8;&#x5177;&#x4F53;&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x7684;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5148;&#x4E0D;&#x8BF4;&#xFF0C;&#x540E;&#x7EED;&#x6587;&#x7AE0;&#x4F1A;&#x5355;&#x72EC;&#x5206;&#x6790;)&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8C03;&#x7528;&#x4E86;intercepted&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x62E6;&#x622A;&#x64CD;&#x4F5C;&#xFF0C;&#x6700;&#x540E;&#x518D;resumeCancellable&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x7684;&#x5C31;&#x662F;Continuation&#x7684;resumeWith&#x65B9;&#x6CD5;&#xFF0C;&#x5373;&#x542F;&#x52A8;&#x534F;&#x7A0B;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x6BCF;&#x6B21;&#x542F;&#x52A8;&#x534F;&#x7A0B;&#x90FD;&#x4F1A;&#x81EA;&#x52A8;&#x56DE;&#x8C03;&#x4E00;&#x6B21;resumeWith&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x4ECA;&#x5929;&#x7684;&#x4E3B;&#x9898;&#x662F;ContinuationInterceptor&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x770B;intercepted&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public expect fun &lt;T&gt; Continuation&lt;T&gt;.intercepted(): Continuation&lt;T&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x53D1;&#x73B0;&#x5B83;&#x662F;&#x4E00;&#x4E2A;expect&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x4F1A;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x5E73;&#x53F0;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x7684;&#x903B;&#x8F91;&#x3002;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x662F;Android&#x6240;&#x4EE5;&#x76F4;&#x63A5;&#x770B;Android&#x4E0A;&#x7684;actual&#x7684;&#x5B9E;&#x73B0;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public actual fun &lt;T&gt; Continuation&lt;T&gt;.intercepted(): Continuation&lt;T&gt; =</span><br><span class=\"line\">    (this as? ContinuationImpl)?.intercepted() ?: this</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x7EC8;&#x6765;&#x5230;ContinuationImpl&#x7684;intercepted&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public fun intercepted(): Continuation&lt;Any?&gt; =</span><br><span class=\"line\">    intercepted</span><br><span class=\"line\">        ?: (context[ContinuationInterceptor]?.interceptContinuation(this) ?: this)</span><br><span class=\"line\">            .also { intercepted = it }</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x770B;&#x5230;&#x4E86;&#x719F;&#x6089;&#x7684;context&#xFF0C;&#x83B7;&#x53D6;&#x5230;ContinuationInterceptor&#x5B9E;&#x4F8B;&#xFF0C;&#x5E76;&#x4E14;&#x8C03;&#x7528;&#x5B83;&#x7684;interceptContinuation&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5904;&#x7406;&#x8FC7;&#x7684;Continuation&#x3002;</p>\n<blockquote>\n<p>&#x591A;&#x6B21;&#x8C03;&#x7528;intercepted&#xFF0C;&#x5BF9;&#x5E94;&#x7684;interceptContinuation&#x53EA;&#x4F1A;&#x8C03;&#x7528;&#x4E00;&#x6B21;&#x3002;</p>\n</blockquote>\n<p>&#x6240;&#x4EE5;ContinuationInterceptor&#x7684;&#x62E6;&#x622A;&#x662F;&#x901A;&#x8FC7;interceptContinuation&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x7684;&#x3002;&#x65E2;&#x7136;&#x5DF2;&#x7ECF;&#x660E;&#x767D;&#x4E86;&#x5B83;&#x7684;&#x62E6;&#x622A;&#x65B9;&#x5F0F;&#xFF0C;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x6765;&#x624B;&#x52A8;&#x5199;&#x4E00;&#x4E2A;&#x62E6;&#x622A;&#x5668;&#x6765;&#x9A8C;&#x8BC1;&#x4E00;&#x4E0B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val interceptor = object : ContinuationInterceptor {</span><br><span class=\"line\"> </span><br><span class=\"line\">    override val key: CoroutineContext.Key&lt;*&gt; = ContinuationInterceptor</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun &lt;T&gt; interceptContinuation(continuation: Continuation&lt;T&gt;): Continuation&lt;T&gt; {</span><br><span class=\"line\">        println(&quot;intercept todo something. change run to thread&quot;)</span><br><span class=\"line\">        return object : Continuation&lt;T&gt; by continuation {</span><br><span class=\"line\">            override fun resumeWith(result: Result&lt;T&gt;) {</span><br><span class=\"line\">                println(&quot;create new thread&quot;)</span><br><span class=\"line\">                thread {</span><br><span class=\"line\">                    continuation.resumeWith(result)</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">println(Thread.currentThread().name)</span><br><span class=\"line\"> </span><br><span class=\"line\">lifecycleScope.launch(interceptor) {</span><br><span class=\"line\">    println(&quot;launch start. current thread: ${Thread.currentThread().name}&quot;)</span><br><span class=\"line\">    </span><br><span class=\"line\">    withContext(Dispatchers.Main) {</span><br><span class=\"line\">        println(&quot;new continuation todo something in the main thread. current thread: ${Thread.currentThread().name}&quot;)</span><br><span class=\"line\">    }</span><br><span class=\"line\">    </span><br><span class=\"line\">    launch {</span><br><span class=\"line\">        println(&quot;new continuation todo something. current thread: ${Thread.currentThread().name}&quot;)</span><br><span class=\"line\">    }</span><br><span class=\"line\">    </span><br><span class=\"line\">    println(&quot;launch end. current thread: ${Thread.currentThread().name}&quot;)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x7B80;&#x5355;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;ContinuationInterceptor&#xFF0C;&#x5982;&#x679C;&#x62E6;&#x622A;&#x6210;&#x529F;&#x5C31;&#x4F1A;&#x8F93;&#x51FA;interceptContinuation&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x8BED;&#x53E5;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x540E;&#x7684;&#x8F93;&#x51FA;&#x65E5;&#x5FD7;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">main</span><br><span class=\"line\">// &#x7B2C;&#x4E00;&#x6B21;launch</span><br><span class=\"line\">intercept todo something. change run to thread</span><br><span class=\"line\">create new thread</span><br><span class=\"line\">launch start. current thread: Thread-2</span><br><span class=\"line\">new continuation todo something in the main thread. current thread: main</span><br><span class=\"line\">create new thread</span><br><span class=\"line\">// &#x7B2C;&#x4E8C;&#x6B21;launch</span><br><span class=\"line\">intercept todo something. change run to thread</span><br><span class=\"line\">create new thread</span><br><span class=\"line\">launch end. current thread: Thread-7</span><br><span class=\"line\">new continuation todo something. current thread: Thread-8</span><br></pre></td></tr></table></figure>\n<p>&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x4E0A;&#x9762;&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x9996;&#x5148;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x5728;main&#x7EBF;&#x7A0B;&#xFF0C;&#x901A;&#x8FC7;lifecycleScope.launch&#x542F;&#x52A8;&#x534F;&#x7A0B;&#x5E76;&#x5C06;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;intercetpor&#x52A0;&#x5165;&#x5230;CoroutineContext&#x4E2D;&#xFF1B;&#x7136;&#x540E;&#x5728;&#x542F;&#x52A8;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x53D1;&#x73B0;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;interceptor&#x62E6;&#x622A;&#x6210;&#x529F;&#x4E86;&#xFF0C;&#x540C;&#x65F6;&#x5C06;&#x539F;&#x672C;&#x5728;main&#x7EBF;&#x7A0B;&#x8FD0;&#x884C;&#x7684;&#x7A0B;&#x5E8F;&#x5207;&#x6362;&#x5230;&#x4E86;&#x65B0;&#x7684;thread&#x7EBF;&#x7A0B;&#x3002;&#x540C;&#x65F6;&#x7B2C;&#x4E8C;&#x6B21;launch&#x7684;&#x65F6;&#x5019;&#x4E5F;&#x62E6;&#x622A;&#x6210;&#x529F;&#x3002;</p>\n<p>&#x5230;&#x8FD9;&#x91CC;&#x5C31;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x8BC1;&#x660E;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x5BF9;ContinuationInterceptor&#x7406;&#x89E3;&#x662F;&#x6B63;&#x786E;&#x7684;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x5728;&#x534F;&#x7A0B;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x8FDB;&#x884C;&#x62E6;&#x622A;&#x64CD;&#x4F5C;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x770B;&#x65E5;&#x5FD7;&#xFF0C;&#x53D1;&#x73B0;withContext&#x5E76;&#x6CA1;&#x6709;&#x62E6;&#x622A;&#x6210;&#x529F;&#xFF0C;&#x8FD9;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x6CE8;&#x610F;&#x770B;Dispatchers.Main&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x63A5;&#x4E0B;&#x6765;&#x9700;&#x8981;&#x5206;&#x6790;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>\n<p>&#x53E6;&#x5916;&#x8FD8;&#x6709;&#x4E00;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x7EC6;&#x5FC3;&#x7684;&#x8001;&#x94C1;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;launch start&#x4E0E;launch end&#x6240;&#x5904;&#x7684;&#x7EBF;&#x7A0B;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x5728;withContext&#x7ED3;&#x675F;&#x4E4B;&#x540E;&#xFF0C;&#x5B83;&#x5185;&#x90E8;&#x8FD8;&#x4F1A;&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x7EBF;&#x7A0B;&#x6062;&#x590D;&#xFF0C;&#x5C06;&#x81EA;&#x8EAB;&#x6240;&#x5904;&#x7684;main&#x7EBF;&#x7A0B;&#x5207;&#x6362;&#x5230;&#x4E4B;&#x524D;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x4F46;&#x4E3A;&#x4EC0;&#x4E48;&#x53C8;&#x4E0E;&#x4E4B;&#x524D;launch start&#x7684;&#x7EBF;&#x7A0B;&#x4E0D;&#x540C;&#x5462;&#xFF1F;</p>\n<p>&#x5927;&#x5BB6;&#x4E0D;&#x8981;&#x5FD8;&#x4E86;&#xFF0C;&#x534F;&#x7A0B;&#x6BCF;&#x4E00;&#x4E2A;&#x6302;&#x8D77;&#x540E;&#x7684;&#x6062;&#x590D;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x56DE;&#x8C03;resumeWith&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x7136;&#x800C;&#x5916;&#x90E8;launch&#x534F;&#x7A0B;&#x6211;&#x4EEC;&#x8FDB;&#x884C;&#x4E86;&#x62E6;&#x622A;&#xFF0C;&#x5728;&#x5B83;&#x8FD4;&#x56DE;&#x7684;Continuation&#x7684;resumeWith&#x56DE;&#x8C03;&#x4E2D;&#x603B;&#x662F;&#x4F1A;&#x521B;&#x5EFA;&#x65B0;&#x7684;thread&#x3002;&#x6240;&#x4EE5;&#x53D1;&#x751F;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E5F;&#x5C31;&#x4E0D;&#x5947;&#x602A;&#x4E86;&#xFF0C;&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x62E6;&#x622A;&#x7684;&#x6548;&#x679C;&#x3002;</p>\n<p>&#x6574;&#x4F53;&#x518D;&#x6765;&#x770B;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x5B83;&#x662F;&#x4E0D;&#x662F;&#x50CF;&#x4E00;&#x4E2A;&#x7B80;&#x6613;&#x7248;&#x7684;&#x534F;&#x7A0B;&#x7684;&#x7EBF;&#x7A0B;&#x5207;&#x6362;&#x5462;&#xFF1F;</p>\n<h2 id=\"CoroutineDispatcher\"><a href=\"#CoroutineDispatcher\" class=\"headerlink\" title=\"CoroutineDispatcher\"></a>CoroutineDispatcher</h2><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6765;&#x770B;Dispatchers.Main&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x5B83;&#x4F1A;&#x5BFC;&#x81F4;&#x6211;&#x4EEC;&#x62E6;&#x622A;&#x5931;&#x8D25;&#x5462;&#xFF1F;&#x8981;&#x63A2;&#x7A76;&#x539F;&#x56E0;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x770B;&#x6E90;&#x7801;&#x66F4;&#x52A0;&#x76F4;&#x63A5;&#x6709;&#x6548;&#x7684;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public actual val Main: MainCoroutineDispatcher get() = MainDispatcherLoader.dispatcher</span><br></pre></td></tr></table></figure>\n<p>&#x4E3B;&#x8981;&#x770B;&#x5B83;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x5B83;&#x8FD4;&#x56DE;&#x7684;&#x662F;MainCoroutineDispatcher&#xFF0C;&#x7136;&#x540E;&#x518D;&#x770B;&#x5B83;&#x662F;&#x4EC0;&#x4E48;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public abstract class MainCoroutineDispatcher : CoroutineDispatcher() {}</span><br></pre></td></tr></table></figure>\n<p>&#x53D1;&#x73B0;MainCoroutineDispatcher&#x7EE7;&#x627F;&#x4E8E;CoroutineDispatcher&#xFF0C;&#x4E3B;&#x89D2;&#x767B;&#x573A;&#x4E86;&#xFF0C;&#x4F46;&#x8FD8;&#x4E0D;&#x591F;&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x770B;CoroutineDispatcher&#x662F;&#x4EC0;&#x4E48;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public abstract class CoroutineDispatcher :</span><br><span class=\"line\">    AbstractCoroutineContextElement(ContinuationInterceptor), ContinuationInterceptor {</span><br><span class=\"line\">    </span><br><span class=\"line\">    public open fun isDispatchNeeded(context: CoroutineContext): Boolean = true</span><br><span class=\"line\">    </span><br><span class=\"line\">    public abstract fun dispatch(context: CoroutineContext, block: Runnable)</span><br><span class=\"line\">    </span><br><span class=\"line\">    public open fun dispatchYield(context: CoroutineContext, block: Runnable) = dispatch(context, block)</span><br><span class=\"line\">    </span><br><span class=\"line\">    public final override fun &lt;T&gt; interceptContinuation(continuation: Continuation&lt;T&gt;): Continuation&lt;T&gt; =</span><br><span class=\"line\">        DispatchedContinuation(this, continuation)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x771F;&#x60F3;&#x5DF2;&#x7ECF;&#x6D6E;&#x51FA;&#x6C34;&#x9762;&#x4E86;&#xFF0C;&#x539F;&#x6765;CoroutineDispatcher&#x5B9E;&#x73B0;&#x4E86;ContinuationInterceptor&#xFF0C;&#x8BF4;&#x660E;CoroutineDispatcher&#x4E5F;&#x5177;&#x6709;&#x62E6;&#x622A;&#x5668;&#x7684;&#x529F;&#x80FD;&#x3002;&#x7136;&#x540E;&#x518D;&#x7ED3;&#x5408;CoroutineContext&#x7684;&#x6027;&#x8D28;&#xFF0C;&#x5C31;&#x5F88;&#x597D;&#x89E3;&#x91CA;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x62E6;&#x622A;&#x5668;&#x6CA1;&#x6709;&#x751F;&#x6548;&#x3002;</p>\n<p>&#x539F;&#x56E0;&#x5C31;&#x662F;&#x5B83;&#x4E0E;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x62E6;&#x622A;&#x5668;&#x4E00;&#x6837;&#x90FD;&#x5B9E;&#x73B0;&#x4E86;ContinuationInterceptor&#x63A5;&#x53E3;&#xFF0C;&#x4E00;&#x65E6;&#x4F7F;&#x7528;Dispatchers.Main&#x5C31;&#x4F1A;&#x66FF;&#x6362;&#x6389;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x62E6;&#x622A;&#x5668;&#x3002;</p>\n<p>&#x56E0;&#x679C;&#x5173;&#x7CFB;&#x5F04;&#x660E;&#x767D;&#x4E86;&#x73B0;&#x5728;&#x5C31;&#x597D;&#x529E;&#x4E86;&#x3002;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x5B83;&#x5177;&#x6709;&#x62E6;&#x622A;&#x529F;&#x80FD;&#xFF0C;&#x518D;&#x6765;&#x770B;CoroutineDispatcher&#x63D0;&#x4F9B;&#x7684;&#x53E6;&#x5916;&#x51E0;&#x4E2A;&#x65B9;&#x6CD5;isDispatchNeeded&#x4E0E;dispatch&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5927;&#x80C6;&#x731C;&#x6D4B;&#xFF0C;isDispatchNeeded&#x5C31;&#x662F;&#x5224;&#x65AD;&#x662F;&#x5426;&#x9700;&#x8981;&#x5206;&#x53D1;&#xFF0C;&#x7136;&#x540E;dispatch&#x5C31;&#x662F;&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x5206;&#x53D1;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x6765;&#x9A8C;&#x8BC1;&#x4E00;&#x4E0B;&#x3002;</p>\n<p>ContinuationInterceptor&#x91CD;&#x8981;&#x7684;&#x65B9;&#x6CD5;&#x5C31;&#x662F;interceptContinuation&#xFF0C;&#x5728;CoroutineDispatcher&#x4E2D;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x4E86;DispatchedContinuation&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;Continuation&#x7C7B;&#x578B;&#x3002;&#x90A3;&#x4E48;&#x81EA;&#x7136;&#x91CD;&#x70B9;&#x5C31;&#x662F;&#x5B83;&#x7684;resumeWith&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun resumeWith(result: Result&lt;T&gt;) {</span><br><span class=\"line\">    val context = continuation.context</span><br><span class=\"line\">    val state = result.toState()</span><br><span class=\"line\">    if (dispatcher.isDispatchNeeded(context)) {</span><br><span class=\"line\">        _state = state</span><br><span class=\"line\">        resumeMode = MODE_ATOMIC_DEFAULT</span><br><span class=\"line\">        dispatcher.dispatch(context, this)</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        executeUnconfined(state, MODE_ATOMIC_DEFAULT) {</span><br><span class=\"line\">            withCoroutineContext(this.context, countOrElement) {</span><br><span class=\"line\">                continuation.resumeWith(result)</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x4E86;isDispatchNeeded&#x4E0E;dispatch&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x5206;&#x53D1;&#x81EA;&#x7136;&#x662F;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x539F;&#x59CB;&#x7684;continuation&#x5BF9;&#x8C61;&#x7684;resumeWith&#x65B9;&#x6CD5;&#xFF0C;&#x4E5F;&#x5C31;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x7C7B;&#x4F3C;&#x4E8E;&#x7EBF;&#x7A0B;&#x7684;&#x5207;&#x6362;&#x3002;</p>\n<p>&#x90A3;&#x4EC0;&#x4E48;&#x65F6;&#x5019;isDispatcheNeeded&#x4E3A;true&#x5462;&#xFF1F;&#x8FD9;&#x5C31;&#x8981;&#x770B;&#x5B83;&#x7684;dispatcer&#x662F;&#x4EC0;&#x4E48;&#x3002;</p>\n<p>&#x7531;&#x4E8E;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x662F;&#x62FF;Dispatchers.Main&#x4F5C;&#x5206;&#x6790;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x6211;&#x76F4;&#x63A5;&#x544A;&#x8BC9;&#x4F60;&#x4EEC;&#x5B83;&#x7684;dispatcher&#x662F;HandlerContext</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun createDispatcher(allFactories: List&lt;MainDispatcherFactory&gt;) =</span><br><span class=\"line\">    HandlerContext(Looper.getMainLooper().asHandler(async = true), &quot;Main&quot;)</span><br><span class=\"line\">internal class HandlerContext private constructor(</span><br><span class=\"line\">    private val handler: Handler,</span><br><span class=\"line\">    private val name: String?,</span><br><span class=\"line\">    private val invokeImmediately: Boolean</span><br><span class=\"line\">) : HandlerDispatcher(), Delay {</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Creates [CoroutineDispatcher] for the given Android [handler].</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * @param handler a handler.</span><br><span class=\"line\">     * @param name an optional name for debugging.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public constructor(</span><br><span class=\"line\">        handler: Handler,</span><br><span class=\"line\">        name: String? = null</span><br><span class=\"line\">    ) : this(handler, name, false)</span><br><span class=\"line\">    @Volatile</span><br><span class=\"line\">    private var _immediate: HandlerContext? = if (invokeImmediately) this else null</span><br><span class=\"line\">    override val immediate: HandlerContext = _immediate ?:</span><br><span class=\"line\">        HandlerContext(handler, name, true).also { _immediate = it }</span><br><span class=\"line\">    override fun isDispatchNeeded(context: CoroutineContext): Boolean {</span><br><span class=\"line\">        return !invokeImmediately || Looper.myLooper() != handler.looper</span><br><span class=\"line\">    }</span><br><span class=\"line\">    override fun dispatch(context: CoroutineContext, block: Runnable) {</span><br><span class=\"line\">        handler.post(block)</span><br><span class=\"line\">    }</span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x7EE7;&#x627F;&#x4E8E;HandlerDispatcher&#xFF0C;&#x800C;HandlerDispatcher&#x7EE7;&#x627F;&#x4E8E;MainCoroutineDispatcher&#x3002;</p>\n<p>&#x6761;&#x4EF6;&#x90FD;&#x7B26;&#x5408;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x770B;isDispatchNeeded&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;true&#x7684;&#x903B;&#x8F91;&#x3002;</p>\n<p>&#x9996;&#x5148;&#x901A;&#x8FC7;invokeImmediately&#x5224;&#x65AD;&#xFF0C;&#x5B83;&#x4EE3;&#x8868;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x4E0E;&#x81EA;&#x8EAB;&#x7684;&#x7EBF;&#x7A0B;&#x76F8;&#x540C;&#xFF0C;&#x5982;&#x4F55;&#x4F60;&#x5916;&#x90E8;&#x4F7F;&#x7528;&#x8005;&#x80FD;&#x591F;&#x4FDD;&#x8BC1;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;Dispatcher.Main.immediate&#x6765;&#x907F;&#x514D;&#x8FDB;&#x884C;&#x7EBF;&#x7A0B;&#x7684;&#x5207;&#x6362;&#x903B;&#x8F91;&#x3002;&#x5F53;&#x7136;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x5916;&#x90E8;&#x7684;&#x5224;&#x65AD;&#x5931;&#x8D25;&#xFF0C;&#x6700;&#x540E;&#x4E5F;&#x4F1A;&#x901A;&#x8FC7;Looper.myLooper() != handler.looper&#x6765;&#x8FDB;&#x884C;&#x6821;&#x6B63;&#x3002;&#x5BF9;&#x4E8E;Dispatchers.Main&#x8FD9;&#x4E2A;&#x7684;handle.looper&#x81EA;&#x7136;&#x662F;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;looper&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x5219;invokeImmediately&#x4E3A;false&#xFF0C;&#x76F4;&#x63A5;&#x8FDB;&#x884C;&#x7EBF;&#x7A0B;&#x5207;&#x6362;&#x3002;&#x7136;&#x540E;&#x8FDB;&#x5165;dispatch&#x65B9;&#x6CD5;&#xFF0C;&#x4E0B;&#x9762;&#x662F;Dispatchers.Main&#x4E2D;dispatch&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun dispatch(context: CoroutineContext, block: Runnable) {</span><br><span class=\"line\">    handler.post(block)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;&#x518D;&#x719F;&#x6089;&#x4E0D;&#x8FC7;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x7684;handler.post&#x5C31;&#x662F;&#x4EE3;&#x8868;&#x5411;&#x4E3B;&#x7EBF;&#x7A0B;&#x63A8;&#x9001;&#x6D88;&#x606F;&#xFF0C;&#x6B64;&#x65F6;&#x7684;block&#x5C06;&#x4F1A;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#x3002;</p>\n<p>&#x8FD9;&#x6837;&#x7EBF;&#x7A0B;&#x7684;&#x5207;&#x6362;&#x5C31;&#x5B8C;&#x6210;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x7EFC;&#x4E0A;&#x6765;&#x770B;&#xFF0C;CoroutineDispatcher&#x4E3A;&#x534F;&#x7A0B;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5207;&#x6362;&#x7684;&#x7EDF;&#x4E00;&#x5224;&#x65AD;&#x4E0E;&#x6267;&#x884C;&#x6807;&#x51C6;&#x3002;</p>\n<p>&#x9996;&#x5148;&#x5728;&#x534F;&#x7A0B;&#x8FDB;&#x884C;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x901A;&#x8FC7;&#x62E6;&#x622A;&#x5668;&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x62E6;&#x622A;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#x662F;interceptContinuation&#xFF0C;&#x7136;&#x540E;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5177;&#x6709;&#x5207;&#x6362;&#x7EBF;&#x7A0B;&#x529F;&#x80FD;&#x7684;Continuation&#xFF0C;&#x5728;&#x6BCF;&#x6B21;&#x8FDB;&#x884C;resumeWith&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5185;&#x90E8;&#x518D;&#x901A;&#x8FC7;isDispatchNeeded&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x534F;&#x7A0B;&#x7684;&#x8FD0;&#x884C;&#x662F;&#x5426;&#x9700;&#x8981;&#x5207;&#x6362;&#x7EBF;&#x7A0B;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x5219;&#x8C03;&#x7528;dispatch&#x8FDB;&#x884C;&#x7EBF;&#x7A0B;&#x7684;&#x5207;&#x6362;&#xFF0C;&#x4FDD;&#x8BC1;&#x534F;&#x7A0B;&#x7684;&#x6B63;&#x786E;&#x8FD0;&#x884C;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x6211;&#x8981;&#x81EA;&#x5B9A;&#x4E49;&#x534F;&#x7A0B;&#x7EBF;&#x7A0B;&#x7684;&#x5207;&#x6362;&#x903B;&#x8F91;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7EE7;&#x627F;&#x4E8E;CoroutineDispatcher&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x5C06;&#x5B83;&#x7684;&#x6838;&#x5FC3;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x81EA;&#x5B9A;&#x4E49;&#x5373;&#x53EF;&#x3002;</p>\n<p>&#x5F53;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x662F;&#x5728;Android&#x4E2D;&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#xFF0C;&#x90A3;&#x57FA;&#x672C;&#x4E0A;&#x662F;&#x4E0D;&#x9700;&#x8981;&#x81EA;&#x5B9A;&#x4E49;&#x7EBF;&#x7A0B;&#x7684;&#x5207;&#x6362;&#x903B;&#x8F91;&#x3002;&#x56E0;&#x4E3A;kotlin&#x5DF2;&#x7ECF;&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x65E5;&#x5E38;&#x6240;&#x9700;&#x7684;Dispatchers&#x3002;&#x4E3B;&#x8981;&#x6709;&#x56DB;&#x79CD;&#x5206;&#x522B;&#x4E3A;:</p>\n<ol>\n<li>Dispatchers.Default: &#x9002;&#x5408;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E4B;&#x5916;&#x6267;&#x884C;&#x5360;&#x7528;&#x5927;&#x91CF;CPU&#x8D44;&#x6E90;&#x7684;&#x5DE5;&#x4F5C;</li>\n<li>Dispatchers.Main: Android&#x4E3B;&#x7EBF;&#x7A0B;</li>\n<li>Dispatchers.Unconfined: &#x5B83;&#x4E0D;&#x4F1A;&#x5207;&#x6362;&#x7EBF;&#x7A0B;&#xFF0C;&#x53EA;&#x662F;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x534F;&#x7A0B;&#x8FDB;&#x884C;&#x6302;&#x8D77;&#xFF0C;&#x81F3;&#x4E8E;&#x6062;&#x590D;&#x4E4B;&#x540E;&#x6240;&#x5728;&#x7684;&#x7EBF;&#x7A0B;&#x5B8C;&#x5168;&#x7531;&#x8C03;&#x7528;&#x5B83;&#x6062;&#x590D;&#x7684;&#x534F;&#x7A0B;&#x63A7;&#x5236;&#x3002;</li>\n<li>Dispatchers.IO: &#x9002;&#x5408;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E4B;&#x5916;&#x6267;&#x884C;&#x78C1;&#x76D8;&#x6216;&#x7F51;&#x7EDC;I/O</li>\n</ol>\n<p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x7B80;&#x5355;&#x63D0;&#x4E00;&#x4E0B;withContext&#x3002;</p>\n<h2 id=\"withContext\"><a href=\"#withContext\" class=\"headerlink\" title=\"withContext\"></a>withContext</h2><p>CoroutineDispatcher&#x867D;&#x7136;&#x80FD;&#x591F;&#x63D0;&#x4F9B;&#x7EBF;&#x7A0B;&#x7684;&#x5207;&#x6362;&#xFF0C;&#x4F46;&#x8FD9;&#x53EA;&#x662F;&#x5355;&#x65B9;&#x5411;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x7EBF;&#x7A0B;&#x7684;&#x6062;&#x590D;&#x3002;</p>\n<p>&#x8BD5;&#x60F3;&#x4E00;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x4E2A;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;CoroutineDispatcher&#x5C06;&#x7EBF;&#x7A0B;&#x5207;&#x6362;&#x5230;Dispatchers.IO&#xFF0C;&#x5F53;&#x62FF;&#x5230;&#x8BF7;&#x6C42;&#x6210;&#x529F;&#x7684;&#x6570;&#x636E;&#x4E4B;&#x540E;&#xFF0C;&#x6240;&#x5728;&#x7684;&#x7EBF;&#x7A0B;&#x8FD8;&#x662F;IO&#x7EBF;&#x7A0B;&#xFF0C;&#x8FD9;&#x6837;&#x5E76;&#x4E0D;&#x80FD;&#x6709;&#x5229;&#x4E8E;&#x6211;&#x4EEC;UI&#x64CD;&#x4F5C;&#x3002;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;kotlin&#x63D0;&#x4F9B;&#x4E86;withContext&#xFF0C;&#x5B83;&#x4E0D;&#x4EC5;&#x80FD;&#x591F;&#x63A5;&#x53D7;CoroutineDispatcher&#x6765;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5207;&#x6362;&#x7EBF;&#x7A0B;&#xFF0C;&#x540C;&#x65F6;&#x5728;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#x8FD8;&#x4F1A;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5C06;&#x4E4B;&#x524D;&#x5207;&#x6362;&#x6389;&#x7684;&#x7EBF;&#x7A0B;&#x8FDB;&#x6062;&#x590D;&#xFF0C;&#x4FDD;&#x8BC1;&#x534F;&#x7A0B;&#x8FD0;&#x884C;&#x7684;&#x8FDE;&#x8D2F;&#x6027;&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x5B98;&#x65B9;&#x63A8;&#x8350;&#x4F7F;&#x7528;withContext&#x8FDB;&#x884C;&#x534F;&#x7A0B;&#x7EBF;&#x7A0B;&#x7684;&#x5207;&#x6362;&#x7684;&#x539F;&#x56E0;&#x3002;</p>\n<p>&#x800C;withContext&#x7684;&#x7EBF;&#x7A0B;&#x6062;&#x590D;&#x539F;&#x7406;&#x662F;&#x5B83;&#x5185;&#x90E8;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A;DispatchedCoroutine&#xFF0C;&#x4FDD;&#x5B58;&#x5207;&#x6362;&#x7EBF;&#x7A0B;&#x65F6;&#x7684;CoroutineContext&#x4E0E;&#x5207;&#x6362;&#x4E4B;&#x524D;&#x7684;Continuation&#xFF0C;&#x6700;&#x540E;&#x5728;onCompletionInternal&#x8FDB;&#x884C;&#x6062;&#x590D;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">internal override fun onCompletionInternal(state: Any?, mode: Int, suppressed: Boolean) {</span><br><span class=\"line\">    if (state is CompletedExceptionally) {</span><br><span class=\"line\">        val exception = if (mode == MODE_IGNORE) state.cause else recoverStackTrace(state.cause, uCont)</span><br><span class=\"line\">        uCont.resumeUninterceptedWithExceptionMode(exception, mode)</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        uCont.resumeUninterceptedMode(state as T, mode)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;uCont&#x5C31;&#x662F;&#x5207;&#x6362;&#x7EBF;&#x7A0B;&#x4E4B;&#x524D;&#x7684;Continuation&#x3002;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x5C31;&#x4E0D;&#x5728;&#x8FD9;&#x5206;&#x6790;&#x4E86;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x8001;&#x94C1;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x7FFB;&#x4E00;&#x7FFB;&#x6E90;&#x7801;&#x3002;</p>\n<p>&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x4E86;ContinuationInterceptor&#x4F5C;&#x7528;&#x4E0E;&#x5982;&#x4F55;&#x62E6;&#x622A;&#x534F;&#x7A0B;&#x7684;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x5206;&#x6790;&#x4E86;CoroutineDispatcher&#x5185;&#x90E8;&#x7ED3;&#x6784;&#xFF0C;&#x8FDB;&#x4E00;&#x6B65;&#x5256;&#x6790;&#x4E86;&#x534F;&#x7A0B;&#x7EBF;&#x7A0B;&#x5207;&#x6362;&#x7684;&#x539F;&#x7406;&#x3002;&#x5E0C;&#x671B;&#x5BF9;&#x5B66;&#x4E60;&#x534F;&#x7A0B;&#x7684;&#x4F19;&#x4F34;&#x4EEC;&#x80FD;&#x591F;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#xFF0C;&#x656C;&#x8BF7;&#x671F;&#x5F85;&#x540E;&#x7EED;&#x7684;&#x534F;&#x7A0B;&#x5206;&#x6790;&#x3002;</p>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["coroutine"]},{"title":"Kotlin协程实现原理:CoroutineScope&Job","url":"https://www.rousetime.com/2020/11/13/Kotlin协程实现原理-CoroutineScope-Job/","content":"<p>&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x6765;&#x804A;&#x804A;Kotlin&#x7684;&#x534F;&#x7A0B;Coroutine&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x6CA1;&#x6709;&#x63A5;&#x89E6;&#x8FC7;&#x534F;&#x7A0B;&#xFF0C;&#x63A8;&#x8350;&#x4F60;&#x5148;&#x9605;&#x8BFB;&#x8FD9;&#x7BC7;&#x5165;&#x95E8;&#x7EA7;&#x6587;&#x7AE0;<a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247483860&amp;idx=1&amp;sn=d8a4441912d0d1eee189d97506bb4689&amp;chksm=e8e0f844df977152652d69a3b4cc3cd1d1a148609f4295b6142e6d577156b76905e1cb6b95be&amp;token=1091218095&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">What? &#x4F60;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;Kotlin Coroutine?</a></p>\n<p>&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x63A5;&#x89E6;&#x8FC7;&#x534F;&#x7A0B;&#xFF0C;&#x4F46;&#x5BF9;&#x534F;&#x7A0B;&#x7684;&#x539F;&#x7406;&#x5B58;&#x5728;&#x7591;&#x60D1;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x9605;&#x8BFB;&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x4E4B;&#x524D;&#x63A8;&#x8350;&#x4F60;&#x5148;&#x9605;&#x8BFB;&#x4E0B;&#x9762;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x8FD9;&#x6837;&#x80FD;&#x8BA9;&#x4F60;&#x66F4;&#x5168;&#x9762;&#x66F4;&#x987A;&#x7545;&#x7684;&#x7406;&#x89E3;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x3002;</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484630&amp;idx=1&amp;sn=967175b88ce6d57e25917b4763601776&amp;chksm=e8e0fd46df9774500d1446410e6e04cde88fc40f27a95e9d059ca60cbdf5dc4099dc86ed4dc0&amp;token=1520540464&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Kotlin&#x534F;&#x7A0B;&#x5B9E;&#x73B0;&#x539F;&#x7406;:Suspend&amp;CoroutineContext</a></p>\n<p>&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x63A5;&#x89E6;&#x8FC7;&#x534F;&#x7A0B;&#xFF0C;&#x76F8;&#x4FE1;&#x4F60;&#x90FD;&#x6709;&#x8FC7;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x7591;&#x95EE;&#xFF1A;</p>\n<ol>\n<li>&#x534F;&#x7A0B;&#x5230;&#x5E95;&#x662F;&#x4E2A;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF1F;</li>\n<li>&#x534F;&#x7A0B;&#x7684;suspend&#x6709;&#x4EC0;&#x4E48;&#x4F5C;&#x7528;&#xFF0C;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x662F;&#x600E;&#x6837;&#x7684;&#xFF1F;</li>\n<li>&#x534F;&#x7A0B;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x5173;&#x952E;&#x540D;&#x79F0;(&#x4F8B;&#x5982;&#xFF1A;Job&#x3001;Coroutine&#x3001;Dispatcher&#x3001;4. CoroutineContext&#x4E0E;CoroutineScope)&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x5230;&#x5E95;&#x662F;&#x600E;&#x4E48;&#x6837;&#x7684;&#x5173;&#x7CFB;&#xFF1F;</li>\n<li>&#x534F;&#x7A0B;&#x7684;&#x6240;&#x8C13;&#x975E;&#x963B;&#x585E;&#x5F0F;&#x6302;&#x8D77;&#x4E0E;&#x6062;&#x590D;&#x53C8;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</li>\n<li>&#x534F;&#x7A0B;&#x7684;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x662F;&#x600E;&#x4E48;&#x6837;&#x7684;&#xFF1F;</li>\n<li>&#x2026;</li>\n</ol>\n<p>&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x4E00;&#x4E9B;&#x6587;&#x7AE0;&#x8BD5;&#x7740;&#x6765;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x8FD9;&#x4E9B;&#x7591;&#x95EE;&#xFF0C;&#x4E5F;&#x6B22;&#x8FCE;&#x5927;&#x5BB6;&#x4E00;&#x8D77;&#x52A0;&#x5165;&#x6765;&#x8BA8;&#x8BBA;&#x3002;</p>\n<h2 id=\"CoroutineScope\"><a href=\"#CoroutineScope\" class=\"headerlink\" title=\"CoroutineScope\"></a>CoroutineScope</h2><p>CoroutineScope&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x5982;&#x679C;&#x4F60;&#x89C9;&#x5F97;&#x964C;&#x751F;&#xFF0C;&#x90A3;&#x4E48;GlobalScope&#x3001;lifecycleScope&#x4E0E;viewModelScope&#x76F8;&#x4FE1;&#x5C31;&#x5F88;&#x719F;&#x6089;&#x4E86;&#x5427;(&#x5F53;&#x7136;&#x8FD9;&#x4E2A;&#x662F;&#x9488;&#x5BF9;&#x4E8E;Android&#x5F00;&#x53D1;&#x8005;)&#x3002;&#x5B83;&#x4EEC;&#x90FD;&#x5B9E;&#x73B0;&#x4E86;CoroutineScope&#x63A5;&#x53E3;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface CoroutineScope {</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * The context of this scope.</span><br><span class=\"line\">     * Context is encapsulated by the scope and used for implementation of coroutine builders that are extensions on the scope.</span><br><span class=\"line\">     * Accessing this property in general code is not recommended for any purposes except accessing the [Job] instance for advanced usages.</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * By convention, should contain an instance of a [job][Job] to enforce structured concurrency.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public val coroutineContext: CoroutineContext</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>CoroutineScope&#x4E2D;&#x53EA;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x5F85;&#x5B9E;&#x73B0;&#x7684;&#x53D8;&#x91CF;CoroutineContext&#xFF0C;&#x81F3;&#x4E8E;CoroutineContext&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#x5DF2;&#x7ECF;&#x5206;&#x6790;&#x4E86;&#x5B83;&#x7684;&#x5185;&#x90E8;&#x7ED3;&#x6784;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x518D;&#x7D2F;&#x8D58;&#x4E86;&#x3002;</p>\n<p>&#x901A;&#x8FC7;&#x5B83;&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x5B83;&#x662F;&#x63D0;&#x4F9B;CoroutineContext&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x4FDD;&#x8BC1;CoroutineContext&#x80FD;&#x5728;&#x6574;&#x4E2A;&#x534F;&#x7A0B;&#x8FD0;&#x884C;&#x4E2D;&#x4F20;&#x9012;&#x4E0B;&#x53BB;&#xFF0C;&#x7EA6;&#x675F;CoroutineContext&#x7684;&#x4F5C;&#x7528;&#x8FB9;&#x754C;&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#xFF0C;&#x5728;Android&#x4E2D;&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#x6765;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#xFF0C;&#x5F53;&#x63A5;&#x53E3;&#x8FD8;&#x6CA1;&#x6709;&#x8BF7;&#x6C42;&#x5B8C;&#x6210;&#x65F6;Activity&#x5C31;&#x5DF2;&#x7ECF;&#x9000;&#x51FA;&#x4E86;&#xFF0C;&#x8FD9;&#x65F6;&#x5982;&#x679C;&#x4E0D;&#x505C;&#x6B62;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x534F;&#x7A0B;&#x5C06;&#x4F1A;&#x9020;&#x6210;&#x4E0D;&#x53EF;&#x9884;&#x671F;&#x7684;&#x540E;&#x679C;&#x3002;&#x6240;&#x4EE5;&#x5728;Activity&#x4E2D;&#x6211;&#x4EEC;&#x90FD;&#x63A8;&#x8350;&#x4F7F;&#x7528;lifecycleScope&#x6765;&#x542F;&#x52A8;&#x534F;&#x7A0B;&#xFF0C;lifecycleScope&#x53EF;&#x4EE5;&#x8BA9;&#x534F;&#x7A0B;&#x5177;&#x6709;&#x4E0E;Activity&#x4E00;&#x6837;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x610F;&#x8BC6;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x662F;lifecycleScope&#x6E90;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val LifecycleOwner.lifecycleScope: LifecycleCoroutineScope</span><br><span class=\"line\">    get() = lifecycle.coroutineScope</span><br><span class=\"line\">    </span><br><span class=\"line\">val Lifecycle.coroutineScope: LifecycleCoroutineScope</span><br><span class=\"line\">    get() {</span><br><span class=\"line\">        while (true) {</span><br><span class=\"line\">            val existing = mInternalScopeRef.get() as LifecycleCoroutineScopeImpl?</span><br><span class=\"line\">            if (existing != null) {</span><br><span class=\"line\">                return existing</span><br><span class=\"line\">            }</span><br><span class=\"line\">            val newScope = LifecycleCoroutineScopeImpl(</span><br><span class=\"line\">                this,</span><br><span class=\"line\">                SupervisorJob() + Dispatchers.Main.immediate</span><br><span class=\"line\">            )</span><br><span class=\"line\">            if (mInternalScopeRef.compareAndSet(null, newScope)) {</span><br><span class=\"line\">                newScope.register()</span><br><span class=\"line\">                return newScope</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;LifecycleCoroutineScopeImpl&#x5B9E;&#x4F8B;&#xFF0C;&#x5B83;&#x5B9E;&#x73B0;&#x4E86;CoroutineScope&#x63A5;&#x53E3;&#xFF0C;&#x540C;&#x65F6;&#x4F20;&#x5165;SupervisorJob() + Dispatchers.Main&#x4F5C;&#x4E3A;&#x5B83;&#x7684;CoroutineContext&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x5B83;&#x7684;register()&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">internal class LifecycleCoroutineScopeImpl(</span><br><span class=\"line\">    override val lifecycle: Lifecycle,</span><br><span class=\"line\">    override val coroutineContext: CoroutineContext</span><br><span class=\"line\">) : LifecycleCoroutineScope(), LifecycleEventObserver {</span><br><span class=\"line\">    init {</span><br><span class=\"line\">        // in case we are initialized on a non-main thread, make a best effort check before</span><br><span class=\"line\">        // we return the scope. This is not sync but if developer is launching on a non-main</span><br><span class=\"line\">        // dispatcher, they cannot be 100% sure anyways.</span><br><span class=\"line\">        if (lifecycle.currentState == Lifecycle.State.DESTROYED) {</span><br><span class=\"line\">            coroutineContext.cancel()</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    fun register() {</span><br><span class=\"line\">        // TODO use Main.Immediate once it is graduated out of experimental.</span><br><span class=\"line\">        launch(Dispatchers.Main) {</span><br><span class=\"line\">            if (lifecycle.currentState &gt;= Lifecycle.State.INITIALIZED) {</span><br><span class=\"line\">                lifecycle.addObserver(this@LifecycleCoroutineScopeImpl)</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                coroutineContext.cancel()</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun onStateChanged(source: LifecycleOwner, event: Lifecycle.Event) {</span><br><span class=\"line\">        if (lifecycle.currentState &lt;= Lifecycle.State.DESTROYED) {</span><br><span class=\"line\">            lifecycle.removeObserver(this)</span><br><span class=\"line\">            coroutineContext.cancel()</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5728;register&#x65B9;&#x6CD5;&#x4E2D;&#x901A;&#x8FC7;&#x7ECF;&#x5178;&#x7684;launch&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x534F;&#x7A0B;&#xFF0C;&#x800C;launch&#x4F7F;&#x7528;&#x5230;&#x7684;CoroutineContext&#x5C31;&#x662F;CoroutineSope&#x4E2D;&#x7684;CoroutineContext&#x3002;&#x7136;&#x540E;&#x5728;&#x534F;&#x7A0B;&#x4E2D;&#x7ED3;&#x5408;Jetpack&#x7684;Lifecycle&#x7279;&#x6027;&#x6765;&#x76D1;&#x542C;Activiyt&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x3002;</p>\n<blockquote>\n<p>&#x5982;&#x679C;&#x5BF9;Lifecycle&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x7279;&#x6027;&#x8FD8;&#x4E0D;&#x662F;&#x5F88;&#x4E86;&#x89E3;&#x7684;&#xFF0C;&#x63A8;&#x8350;&#x9605;&#x8BFB;&#x8FD9;&#x7BC7;&#x5165;&#x95E8;&#x7EA7;&#x6587;&#x7AE0;<a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247483714&amp;idx=1&amp;sn=8d2137f92d0f8561cbf03c75456f122c&amp;chksm=e8e0f8d2df9771c41caa4f5cb285c6c99ba115e8c20ed8356eccdf998a640f01341028b8c9df&amp;token=1588275923&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part3:Lifecycle</a></p>\n</blockquote>\n<p>&#x610F;&#x601D;&#x5C31;&#x662F;&#x8BF4;&#x5728;Activity&#x9500;&#x6BC1;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x8C03;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#x53D6;&#x6D88;&#x534F;&#x7A0B;&#x7684;&#x8FD0;&#x884C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">coroutineContext.cancel()</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x5C31;&#x4F7F;&#x7528;&#x5230;&#x4E86;CoroutineContext&#xFF0C;&#x7ECF;&#x8FC7;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x5206;&#x6790;&#x6211;&#x4EEC;&#x5F88;&#x5BB9;&#x6613;&#x77E5;&#x9053;CoroutineContext&#x81EA;&#x8EAB;&#x662F;&#x6CA1;&#x6709;cancel&#x65B9;&#x6CD5;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;cancel&#x65B9;&#x6CD5;&#x662F;CoroutineContext&#x7684;&#x6269;&#x5C55;&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public fun CoroutineContext.cancel(): Unit {</span><br><span class=\"line\">    this[Job]?.cancel()</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x771F;&#x6B63;&#x7684;&#x903B;&#x8F91;&#x662F;&#x4ECE;CoroutineContex&#x96C6;&#x5408;&#x4E2D;&#x53D6;&#x51FA;Key&#x4E3A;Job&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x8FD9;&#x4E2A;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;&#x4E0A;&#x9762;&#x521B;&#x5EFA;LifecycleCoroutineScopeImpl&#x5B9E;&#x4F8B;&#x65F6;&#x4F20;&#x5165;&#x7684;SupervisorJob&#xFF0C;&#x5B83;&#x662F;CoroutineContext&#x7684;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x5B50;&#x7C7B;&#x3002;</p>\n<p>&#x8FD9;&#x65F6;&#x518D;&#x6765;&#x770B;lifecycleScope&#x76F8;&#x5173;&#x7684;&#x4E00;&#x4E9B;&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lifecycleScope.launchWhenCreated {  }</span><br><span class=\"line\">lifecycleScope.launchWhenStarted {  }</span><br><span class=\"line\">lifecycleScope.launchWhenResumed {  }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x7684;&#x5185;&#x90E8;&#x903B;&#x8F91;&#x5C31;&#x5F88;&#x660E;&#x663E;&#x4E86;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x901A;&#x8FC7;Lifecycle&#x6765;&#x8FFD;&#x8E2A;Activity&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x4ECE;&#x800C;&#x7EA6;&#x675F;&#x534F;&#x7A0B;&#x8FD0;&#x884C;&#x7684;&#x65F6;&#x673A;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4E0D;&#x4F7F;&#x7528;lifecycleScope&#xFF0C;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;CoroutineScope&#xFF0C;&#x8BA9;&#x5B83;&#x5728;Activity&#x8FBE;&#x5230;&#x540C;&#x6837;&#x7684;&#x6548;&#x679C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class MyActivity : AppCompatActivity(), CoroutineScope {</span><br><span class=\"line\">    lateinit var job: Job</span><br><span class=\"line\">    override val coroutineContext: CoroutineContext</span><br><span class=\"line\">        get() = Dispatchers.Main + job</span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) {</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        job = Job()</span><br><span class=\"line\">    }</span><br><span class=\"line\">    override fun onDestroy() {</span><br><span class=\"line\">        super.onDestroy()</span><br><span class=\"line\">        job.cancel() // Cancel job on activity destroy. After destroy all children jobs will be cancelled automatically</span><br><span class=\"line\">    }</span><br><span class=\"line\">    /*</span><br><span class=\"line\">     * Note how coroutine builders are scoped: if activity is destroyed or any of the launched coroutines</span><br><span class=\"line\">     * in this method throws an exception, then all nested coroutines are cancelled.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    fun loadDataFromUI() = launch { // &lt;- extension on current activity, launched in the main thread</span><br><span class=\"line\">       val ioData = async(Dispatchers.IO) { // &lt;- extension on launch scope, launched in IO dispatcher</span><br><span class=\"line\">           // blocking I/O operation</span><br><span class=\"line\">       }</span><br><span class=\"line\">       // do something else concurrently with I/O</span><br><span class=\"line\">       val data = ioData.await() // wait for result of I/O</span><br><span class=\"line\">       draw(data) // can draw in the main thread</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x7684;&#x5B9E;&#x73B0;&#x4E5F;&#x80FD;&#x591F;&#x4FDD;&#x8BC1;&#x5F53;&#x524D;Activiyt&#x4E2D;&#x7684;&#x534F;&#x7A0B;&#x5728;Activity&#x9500;&#x6BC1;&#x7684;&#x65F6;&#x5019;&#x7EC8;&#x6B62;&#x534F;&#x7A0B;&#x7684;&#x8FD0;&#x884C;&#x3002;</p>\n<p>&#x5230;&#x8FD9;&#x91CC;CoroutineScope&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x547C;&#x4E4B;&#x6B32;&#x51FA;&#x4E86;&#xFF0C;&#x5B83;&#x5C31;&#x662F;&#x7528;&#x6765;&#x7EA6;&#x675F;&#x534F;&#x7A0B;&#x7684;&#x8FB9;&#x754C;&#xFF0C;&#x80FD;&#x591F;&#x5F88;&#x597D;&#x7684;&#x63D0;&#x4F9B;&#x5BF9;&#x5E94;&#x7684;&#x534F;&#x7A0B;&#x53D6;&#x6D88;&#x529F;&#x80FD;&#xFF0C;&#x4FDD;&#x8BC1;&#x534F;&#x7A0B;&#x7684;&#x8FD0;&#x884C;&#x8303;&#x56F4;&#x3002;</p>\n<p>&#x5F53;&#x7136;&#x8FD9;&#x53C8;&#x5F15;&#x7533;&#x51FA;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x8BDD;&#x9898;</p>\n<p>Job&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</p>\n<h2 id=\"Job\"><a href=\"#Job\" class=\"headerlink\" title=\"Job\"></a>Job</h2><p>&#x57FA;&#x672C;&#x4E0A;&#x6BCF;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x534F;&#x7A0B;&#x5C31;&#x4F1A;&#x4EA7;&#x751F;&#x5BF9;&#x5E94;&#x7684;Job&#xFF0C;&#x4F8B;&#x5982;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lifecycleScope.launch {</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>launch&#x8FD4;&#x56DE;&#x7684;&#x5C31;&#x662F;&#x4E00;&#x4E2A;Job&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x7BA1;&#x7406;&#x534F;&#x7A0B;&#xFF0C;&#x4E00;&#x4E2A;Job&#x4E2D;&#x53EF;&#x4EE5;&#x5173;&#x8054;&#x591A;&#x4E2A;&#x5B50;Job&#xFF0C;&#x540C;&#x65F6;&#x5B83;&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x901A;&#x8FC7;&#x5916;&#x90E8;&#x4F20;&#x5165;parent&#x7684;&#x5B9E;&#x73B0;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public fun Job(parent: Job? = null): Job = JobImpl(parent)</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;&#x5F88;&#x597D;&#x7406;&#x89E3;&#xFF0C;&#x5F53;&#x4F20;&#x5165;parent&#x65F6;&#xFF0C;&#x6B64;&#x65F6;&#x7684;Job&#x5C06;&#x4F1A;&#x4F5C;&#x4E3A;parent&#x7684;&#x5B50;Job&#x3002;</p>\n<p>&#x65E2;&#x7136;Job&#x662F;&#x6765;&#x7BA1;&#x7406;&#x534F;&#x7A0B;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x516D;&#x79CD;&#x72B6;&#x6001;&#x6765;&#x8868;&#x793A;&#x534F;&#x7A0B;&#x7684;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x3002;</p>\n<ol>\n<li>New: &#x521B;&#x5EFA;</li>\n<li>Active: &#x8FD0;&#x884C;</li>\n<li>Completing: &#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x7B49;&#x5F85;&#x81EA;&#x8EAB;&#x7684;&#x5B50;&#x534F;&#x7A0B;</li>\n<li>Completed: &#x5B8C;&#x6210;</li>\n<li>Cancelling: &#x6B63;&#x5728;&#x8FDB;&#x884C;&#x53D6;&#x6D88;&#x6216;&#x8005;&#x5931;&#x8D25;</li>\n<li>Cancelled: &#x53D6;&#x6D88;&#x6216;&#x5931;&#x8D25;</li>\n</ol>\n<p>&#x8FD9;&#x516D;&#x79CD;&#x72B6;&#x6001;Job&#x5BF9;&#x5916;&#x66B4;&#x9732;&#x4E86;&#x4E09;&#x79CD;&#x72B6;&#x6001;&#xFF0C;&#x5B83;&#x4EEC;&#x968F;&#x65F6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Job&#x6765;&#x83B7;&#x53D6;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public val isActive: Boolean</span><br><span class=\"line\">public val isCompleted: Boolean</span><br><span class=\"line\">public val isCancelled: Boolean</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x6765;&#x624B;&#x52A8;&#x7BA1;&#x7406;&#x534F;&#x7A0B;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x534F;&#x7A0B;&#x662F;&#x5426;&#x5728;&#x8FD0;&#x884C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">while (job.isActive) {</span><br><span class=\"line\">// &#x534F;&#x7A0B;&#x8FD0;&#x884C;&#x4E2D;            </span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x534F;&#x7A0B;&#x521B;&#x5EFA;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x5904;&#x5728;Active&#x72B6;&#x6001;&#xFF0C;&#x4F46;&#x4E5F;&#x6709;&#x7279;&#x4F8B;&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x901A;&#x8FC7;launch&#x542F;&#x52A8;&#x534F;&#x7A0B;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x4F20;&#x9012;&#x4E00;&#x4E2A;start&#x53C2;&#x6570;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public fun CoroutineScope.launch(</span><br><span class=\"line\">    context: CoroutineContext = EmptyCoroutineContext,</span><br><span class=\"line\">    start: CoroutineStart = CoroutineStart.DEFAULT,</span><br><span class=\"line\">    block: suspend CoroutineScope.() -&gt; Unit</span><br><span class=\"line\">): Job {</span><br><span class=\"line\">\t...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x8FD9;&#x4E2A;start&#x4F20;&#x9012;&#x7684;&#x662F;CoroutineStart.LAZY&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C06;&#x5904;&#x4E8E;New&#x72B6;&#x6001;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8C03;&#x7528;start&#x6216;&#x8005;join&#x6765;&#x5524;&#x8D77;&#x534F;&#x7A0B;&#x8FDB;&#x5165;Active&#x72B6;&#x6001;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x5F20;&#x7B80;&#x56FE;&#xFF0C;&#x5C31;&#x80FD;&#x5F88;&#x6E05;&#x6670;&#x7684;&#x4E86;&#x89E3;Job&#x4E2D;&#x7684;&#x516D;&#x4E2A;&#x72B6;&#x6001;&#x95F4;&#x7684;&#x8F6C;&#x5316;&#x8FC7;&#x7A0B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                                      wait children</span><br><span class=\"line\">+-----+ start  +--------+ complete   +-------------+  finish  +-----------+</span><br><span class=\"line\">| New | -----&gt; | Active | ---------&gt; | Completing  | -------&gt; | Completed |</span><br><span class=\"line\">+-----+        +--------+            +-------------+          +-----------+</span><br><span class=\"line\">                 |  cancel / fail       |</span><br><span class=\"line\">                 |     +----------------+</span><br><span class=\"line\">                 |     |</span><br><span class=\"line\">                 V     V</span><br><span class=\"line\">             +------------+                           finish  +-----------+</span><br><span class=\"line\">             | Cancelling | --------------------------------&gt; | Cancelled |</span><br><span class=\"line\">             +------------+                                   +-----------+</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x63D0;&#x53CA;&#x5230;&#x4E00;&#x4E2A;Job&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#x5B50;Job&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x4E2A;Job&#x7684;&#x5B8C;&#x6210;&#x90FD;&#x5FC5;&#x987B;&#x7B49;&#x5F85;&#x5B83;&#x5185;&#x90E8;&#x6240;&#x6709;&#x7684;&#x5B50;Job&#x5B8C;&#x6210;&#xFF1B;&#x5BF9;&#x5E94;&#x7684;cancel&#x4E5F;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>\n<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x5185;&#x90E8;&#x7684;&#x5B50;Job&#x53D1;&#x751F;&#x5F02;&#x5E38;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5BF9;&#x5E94;&#x7684;parent Job&#x4E0E;&#x5B83;&#x76F8;&#x5173;&#x8FDE;&#x7684;&#x5176;&#x5B83;&#x5B50;Job&#x90FD;&#x5C06;&#x53D6;&#x6D88;&#x8FD0;&#x884C;&#x3002;&#x4FD7;&#x79F0;&#x8FDE;&#x9501;&#x53CD;&#x5E94;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x8FD9;&#x79CD;&#x9ED8;&#x8BA4;&#x673A;&#x5236;&#xFF0C;Kotlin&#x63D0;&#x4F9B;&#x4E86;SupervisorJob&#x6765;&#x6539;&#x53D8;&#x8FD9;&#x79CD;&#x673A;&#x5236;&#x3002;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x8FD8;&#x662F;&#x5F88;&#x5E38;&#x89C1;&#x7684;&#xFF0C;&#x4F8B;&#x5982;&#x7528;&#x534F;&#x7A0B;&#x8BF7;&#x6C42;&#x4E24;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x60F3;&#x56E0;&#x4E3A;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#x5931;&#x8D25;&#x5BFC;&#x81F4;&#x53E6;&#x5916;&#x7684;&#x63A5;&#x53E3;&#x4E5F;&#x4E0D;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD9;&#x65F6;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;SupervisorJob&#x6765;&#x6539;&#x53D8;&#x534F;&#x7A0B;&#x7684;&#x8FD9;&#x79CD;&#x9ED8;&#x8BA4;&#x673A;&#x5236;&#x3002;</p>\n<p>&#x4F7F;&#x7528;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x521B;&#x5EFA;CoroutineContext&#x7684;&#x65F6;&#x5019;&#x52A0;&#x5165;SupervisorJob&#x5373;&#x53EF;&#x3002;&#x4F8B;&#x5982;&#x5728;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x8FC7;&#x7684;lifecycleScope&#xFF0C;&#x5185;&#x90E8;&#x5C31;&#x4F7F;&#x7528;&#x5230;&#x4E86;SupervisorJob</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val newScope = LifecycleCoroutineScopeImpl(</span><br><span class=\"line\">    this,</span><br><span class=\"line\">    SupervisorJob() + Dispatchers.Main</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x8FD0;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5B83;&#x7684;SupervisorJob&#x66FF;&#x6362;&#x6210;&#x522B;&#x7684;CoroutineContext&#x518D;&#x6765;&#x770B;&#x4E0B;&#x6548;&#x679C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun main() = runBlocking {</span><br><span class=\"line\">    val supervisor = SupervisorJob()</span><br><span class=\"line\">    with(CoroutineScope(coroutineContext + supervisor)) {</span><br><span class=\"line\">        // &#x542F;&#x52A8;&#x7B2C;&#x4E00;&#x4E2A;&#x5B50;&#x4F5C;&#x4E1A;&#x2014;&#x2014;&#x8FD9;&#x4E2A;&#x793A;&#x4F8B;&#x5C06;&#x4F1A;&#x5FFD;&#x7565;&#x5B83;&#x7684;&#x5F02;&#x5E38;&#xFF08;&#x4E0D;&#x8981;&#x5728;&#x5B9E;&#x8DF5;&#x4E2D;&#x8FD9;&#x4E48;&#x505A;&#xFF01;&#xFF09;</span><br><span class=\"line\">        val firstChild = launch(CoroutineExceptionHandler { _, _ -&gt;  }) {</span><br><span class=\"line\">            println(&quot;The first child is failing&quot;)</span><br><span class=\"line\">            throw AssertionError(&quot;The first child is cancelled&quot;)</span><br><span class=\"line\">        }</span><br><span class=\"line\">        // &#x542F;&#x52A8;&#x7B2C;&#x4E8C;&#x4E2A;&#x5B50;&#x4F5C;&#x4E1A;</span><br><span class=\"line\">        val secondChild = launch {</span><br><span class=\"line\">            firstChild.join()</span><br><span class=\"line\">            // &#x53D6;&#x6D88;&#x4E86;&#x7B2C;&#x4E00;&#x4E2A;&#x5B50;&#x4F5C;&#x4E1A;&#x4E14;&#x6CA1;&#x6709;&#x4F20;&#x64AD;&#x7ED9;&#x7B2C;&#x4E8C;&#x4E2A;&#x5B50;&#x4F5C;&#x4E1A;</span><br><span class=\"line\">            println(&quot;The first child is cancelled: ${firstChild.isCancelled}, but the second one is still active&quot;)</span><br><span class=\"line\">            try {</span><br><span class=\"line\">                delay(Long.MAX_VALUE)</span><br><span class=\"line\">            } finally {</span><br><span class=\"line\">                // &#x4F46;&#x662F;&#x53D6;&#x6D88;&#x4E86;&#x76D1;&#x7763;&#x7684;&#x4F20;&#x64AD;</span><br><span class=\"line\">                println(&quot;The second child is cancelled because the supervisor was cancelled&quot;)</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        // &#x7B49;&#x5F85;&#x76F4;&#x5230;&#x7B2C;&#x4E00;&#x4E2A;&#x5B50;&#x4F5C;&#x4E1A;&#x5931;&#x8D25;&#x4E14;&#x6267;&#x884C;&#x5B8C;&#x6210;</span><br><span class=\"line\">        firstChild.join()</span><br><span class=\"line\">        println(&quot;Cancelling the supervisor&quot;)</span><br><span class=\"line\">        supervisor.cancel()</span><br><span class=\"line\">        secondChild.join()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x6709;&#x4E9B;&#x4EFB;&#x52A1;&#x4F60;&#x5E76;&#x4E0D;&#x60F3;&#x88AB;&#x624B;&#x52A8;&#x53D6;&#x6D88;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;NonCancellable&#x4F5C;&#x4E3A;&#x4EFB;&#x52A1;&#x7684;CoroutineContext</p>\n<p>&#x5982;&#x679C;&#x9700;&#x8981;Job&#x83B7;&#x53D6;&#x534F;&#x7A0B;&#x7684;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Deferred&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x5B83;&#x662F;Job&#x7684;&#x4E00;&#x4E2A;&#x5B50;&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x4E5F;&#x62E5;&#x6709;Job&#x6240;&#x7528;&#x529F;&#x80FD;&#x3002;&#x540C;&#x65F6;&#x989D;&#x5916;&#x63D0;&#x4F9B;await&#x65B9;&#x6CD5;&#x6765;&#x7B49;&#x5F85;&#x534F;&#x7A0B;&#x7ED3;&#x679C;&#x7684;&#x8FD4;&#x56DE;&#x3002;</p>\n<p>Deferred&#x53EF;&#x4EE5;&#x901A;&#x8FC7;CoroutineScope.async&#x521B;&#x5EFA;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x4ECB;&#x7ECD;&#x4E0B;Job&#x7684;&#x51E0;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;start&#x4E0E;cancel&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x5206;&#x522B;&#x662F;&#x542F;&#x52A8;&#x4E0E;&#x53D6;&#x6D88;&#x3002;</p>\n<h3 id=\"invokeOnCompletion\"><a href=\"#invokeOnCompletion\" class=\"headerlink\" title=\"invokeOnCompletion\"></a>invokeOnCompletion</h3><p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;Job&#x7684;&#x56DE;&#x8C03;&#x901A;&#x77E5;&#xFF0C;&#x5F53;Job&#x6267;&#x884C;&#x5B8C;&#x540E;&#x4F1A;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public fun invokeOnCompletion(handler: CompletionHandler): DisposableHandle</span><br><span class=\"line\"> </span><br><span class=\"line\">public typealias CompletionHandler = (cause: Throwable?) -&gt; Unit</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;cause&#x6709;&#x4E09;&#x79CD;&#x60C5;&#x51B5;&#x5206;&#x522B;&#x4E3A;&#xFF1A;</p>\n<ol>\n<li>is null: &#x534F;&#x7A0B;&#x6B63;&#x5E38;&#x6267;&#x884C;&#x5B8C;&#x6BD5;</li>\n<li>is CancellationException: &#x534F;&#x7A0B;&#x6B63;&#x5E38;&#x53D6;&#x6D88;&#xFF0C;&#x5E76;&#x975E;&#x5F02;&#x5E38;&#x5BFC;&#x81F4;&#x7684;&#x53D6;&#x6D88;</li>\n<li>Otherwise: &#x534F;&#x7A0B;&#x53D1;&#x751F;&#x5F02;&#x5E38;</li>\n</ol>\n<p>&#x540C;&#x65F6;&#x5B83;&#x7684;&#x8FD4;&#x56DE;&#x503C;DisposableHandle&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x53D6;&#x6D88;&#x56DE;&#x8C03;&#x7684;&#x76D1;&#x542C;&#x3002;</p>\n<h3 id=\"join\"><a href=\"#join\" class=\"headerlink\" title=\"join\"></a>join</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public suspend fun join()</span><br></pre></td></tr></table></figure>\n<p>&#x6CE8;&#x610F;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;suspend&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x53EA;&#x80FD;&#x5728;suspend&#x6216;&#x8005;coroutine&#x4E2D;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#x3002;</p>\n<p>&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x6682;&#x505C;&#x5F53;&#x524D;&#x8FD0;&#x884C;&#x7684;&#x534F;&#x7A0B;&#x4EFB;&#x52A1;&#xFF0C;&#x7ACB;&#x523B;&#x6267;&#x884C;&#x81EA;&#x8EAB;Job&#x7684;&#x534F;&#x7A0B;&#x4EFB;&#x52A1;&#xFF0C;&#x76F4;&#x5230;&#x81EA;&#x8EAB;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#x624D;&#x6062;&#x590D;&#x4E4B;&#x524D;&#x7684;&#x534F;&#x7A0B;&#x4EFB;&#x52A1;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x3002;</p>\n<p>&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x4E86;CoroutineScope&#x7684;&#x4F5C;&#x7528;&#x4E0E;Job&#x7684;&#x76F8;&#x5173;&#x72B6;&#x6001;&#x6F14;&#x5316;&#x4E0E;&#x8FD0;&#x7528;&#x3002;&#x5E0C;&#x671B;&#x5BF9;&#x5B66;&#x4E60;&#x534F;&#x7A0B;&#x7684;&#x4F19;&#x4F34;&#x4EEC;&#x80FD;&#x591F;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#xFF0C;&#x656C;&#x8BF7;&#x671F;&#x5F85;&#x540E;&#x7EED;&#x7684;&#x534F;&#x7A0B;&#x5206;&#x6790;&#x3002;</p>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["coroutine"]},{"title":"Kotlin协程实现原理:Suspend&CoroutineContext","url":"https://www.rousetime.com/2020/11/11/Kotlin协程实现原理-Suspend-CoroutineContext/","content":"<p>&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x6765;&#x804A;&#x804A;Kotlin&#x7684;&#x534F;&#x7A0B;Coroutine&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x6CA1;&#x6709;&#x63A5;&#x89E6;&#x8FC7;&#x534F;&#x7A0B;&#xFF0C;&#x63A8;&#x8350;&#x4F60;&#x5148;&#x9605;&#x8BFB;&#x8FD9;&#x7BC7;&#x5165;&#x95E8;&#x7EA7;&#x6587;&#x7AE0;<a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247483860&amp;idx=1&amp;sn=d8a4441912d0d1eee189d97506bb4689&amp;chksm=e8e0f844df977152652d69a3b4cc3cd1d1a148609f4295b6142e6d577156b76905e1cb6b95be&amp;token=1091218095&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">What? &#x4F60;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;Kotlin Coroutine?</a></p>\n<p>&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x63A5;&#x89E6;&#x8FC7;&#x534F;&#x7A0B;&#xFF0C;&#x76F8;&#x4FE1;&#x4F60;&#x90FD;&#x6709;&#x8FC7;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x7591;&#x95EE;&#xFF1A;</p>\n<ol>\n<li>&#x534F;&#x7A0B;&#x5230;&#x5E95;&#x662F;&#x4E2A;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF1F;</li>\n<li>&#x534F;&#x7A0B;&#x7684;suspend&#x6709;&#x4EC0;&#x4E48;&#x4F5C;&#x7528;&#xFF0C;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x662F;&#x600E;&#x6837;&#x7684;&#xFF1F;</li>\n<li>&#x534F;&#x7A0B;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x5173;&#x952E;&#x540D;&#x79F0;(&#x4F8B;&#x5982;&#xFF1A;Job&#x3001;Coroutine&#x3001;Dispatcher&#x3001;4. CoroutineContext&#x4E0E;CoroutineScope)&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x5230;&#x5E95;&#x662F;&#x600E;&#x4E48;&#x6837;&#x7684;&#x5173;&#x7CFB;&#xFF1F;</li>\n<li>&#x534F;&#x7A0B;&#x7684;&#x6240;&#x8C13;&#x975E;&#x963B;&#x585E;&#x5F0F;&#x6302;&#x8D77;&#x4E0E;&#x6062;&#x590D;&#x53C8;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</li>\n<li>&#x534F;&#x7A0B;&#x7684;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x662F;&#x600E;&#x4E48;&#x6837;&#x7684;&#xFF1F;</li>\n<li>&#x2026;</li>\n</ol>\n<p>&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x4E00;&#x4E9B;&#x6587;&#x7AE0;&#x8BD5;&#x7740;&#x6765;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x8FD9;&#x4E9B;&#x7591;&#x95EE;&#xFF0C;&#x4E5F;&#x6B22;&#x8FCE;&#x5927;&#x5BB6;&#x4E00;&#x8D77;&#x52A0;&#x5165;&#x6765;&#x8BA8;&#x8BBA;&#x3002;</p>\n<h2 id=\"&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;\"><a href=\"#&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;\" class=\"headerlink\" title=\"&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;\"></a>&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;</h2><p>&#x8FD9;&#x4E2A;&#x7591;&#x95EE;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x8981;&#x4F60;&#x4E0D;&#x662F;&#x91CE;&#x8DEF;&#x5B50;&#x63A5;&#x89E6;&#x534F;&#x7A0B;&#x7684;&#xFF0C;&#x90FD;&#x5E94;&#x8BE5;&#x80FD;&#x591F;&#x77E5;&#x9053;&#x3002;&#x56E0;&#x4E3A;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x4E2D;&#x5DF2;&#x7ECF;&#x660E;&#x786E;&#x7ED9;&#x51FA;&#x4E86;&#x5B9A;&#x4E49;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6765;&#x770B;&#x4E0B;&#x5B98;&#x65B9;&#x7684;&#x539F;&#x8BDD;(&#x4E5F;&#x662F;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x6700;&#x5177;&#x6709;&#x5E95;&#x6C14;&#x7684;&#x4E00;&#x6BB5;&#x8BDD;)&#x3002;</p>\n<p><strong>&#x534F;&#x7A0B;&#x662F;&#x4E00;&#x79CD;&#x5E76;&#x53D1;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5728; Android &#x5E73;&#x53F0;&#x4E0A;&#x4F7F;&#x7528;&#x5B83;&#x6765;&#x7B80;&#x5316;&#x5F02;&#x6B65;&#x6267;&#x884C;&#x7684;&#x4EE3;&#x7801;&#x3002;</strong></p>\n<p>&#x6572;&#x9ED1;&#x677F;&#x5212;&#x91CD;&#x70B9;&#xFF1A;&#x534F;&#x7A0B;&#x662F;&#x4E00;&#x79CD;&#x5E76;&#x53D1;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E9B;&#x4EBA;&#x6240;&#x8BF4;&#x7684;&#x4EC0;&#x4E48;&#x7EBF;&#x7A0B;&#x7684;&#x53E6;&#x4E00;&#x79CD;&#x8868;&#x73B0;&#x3002;&#x867D;&#x7136;&#x534F;&#x7A0B;&#x7684;&#x5185;&#x90E8;&#x4E5F;&#x4F7F;&#x7528;&#x5230;&#x4E86;&#x7EBF;&#x7A0B;&#x3002;&#x4F46;&#x5B83;&#x66F4;&#x5927;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x5B83;&#x7684;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#x3002;&#x5C06;&#x6211;&#x4EEC;&#x4F20;&#x7EDF;&#x7684;Callback&#x56DE;&#x8C03;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x6D88;&#x9664;&#x3002;&#x5C06;&#x5F02;&#x6B65;&#x7F16;&#x7A0B;&#x8D8B;&#x8FD1;&#x4E8E;&#x540C;&#x6B65;&#x5BF9;&#x9F50;&#x3002;</p>\n<p>&#x89E3;&#x91CA;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x6700;&#x540E;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x76F4;&#x63A5;&#x70B9;&#xFF0C;&#x6765;&#x770B;&#x4E0B;&#x5B83;&#x7684;&#x4F18;&#x70B9;</p>\n<ol>\n<li>&#x8F7B;&#x91CF;&#xFF1A;&#x60A8;&#x53EF;&#x4EE5;&#x5728;&#x5355;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E0A;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x534F;&#x7A0B;&#xFF0C;&#x56E0;&#x4E3A;&#x534F;&#x7A0B;&#x652F;&#x6301;&#x6302;&#x8D77;&#xFF0C;&#x4E0D;&#x4F1A;&#x4F7F;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x534F;&#x7A0B;&#x7684;&#x7EBF;&#x7A0B;&#x963B;&#x585E;&#x3002;&#x6302;&#x8D77;&#x6BD4;&#x963B;&#x585E;&#x8282;&#x7701;&#x5185;&#x5B58;&#xFF0C;&#x4E14;&#x652F;&#x6301;&#x591A;&#x4E2A;&#x5E76;&#x884C;&#x64CD;&#x4F5C;&#x3002;</li>\n<li>&#x5185;&#x5B58;&#x6CC4;&#x9732;&#x66F4;&#x5C11;&#xFF1A;&#x4F7F;&#x7528;&#x7ED3;&#x6784;&#x5316;&#x5E76;&#x53D1;&#x673A;&#x5236;&#x5728;&#x4E00;&#x4E2A;&#x4F5C;&#x7528;&#x57DF;&#x5185;&#x6267;&#x884C;&#x591A;&#x4E2A;&#x64CD;&#x4F5C;&#x3002;</li>\n<li>&#x5185;&#x7F6E;&#x53D6;&#x6D88;&#x652F;&#x6301;&#xFF1A;&#x53D6;&#x6D88;&#x529F;&#x80FD;&#x4F1A;&#x81EA;&#x52A8;&#x901A;&#x8FC7;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x534F;&#x7A0B;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x4F20;&#x64AD;&#x3002;</li>\n<li>Jetpack&#x96C6;&#x6210;&#xFF1A;&#x8BB8;&#x591A; Jetpack &#x5E93;&#x90FD;&#x5305;&#x542B;&#x63D0;&#x4F9B;&#x5168;&#x9762;&#x534F;&#x7A0B;&#x652F;&#x6301;&#x7684;&#x6269;&#x5C55;&#x3002;&#x67D0;&#x4E9B;&#x5E93;&#x8FD8;&#x63D0;&#x4F9B;&#x81EA;&#x5DF1;&#x7684;&#x534F;&#x7A0B;&#x4F5C;&#x7528;&#x57DF;&#xFF0C;&#x53EF;&#x4F9B;&#x60A8;&#x7528;&#x4E8E;&#x7ED3;&#x6784;&#x5316;&#x5E76;&#x53D1;&#x3002;</li>\n</ol>\n<h2 id=\"suspend\"><a href=\"#suspend\" class=\"headerlink\" title=\"suspend\"></a>suspend</h2><p>suspend&#x662F;&#x534F;&#x7A0B;&#x7684;&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x88AB;suspend&#x4FEE;&#x9970;&#x7684;&#x65B9;&#x6CD5;&#x90FD;&#x5FC5;&#x987B;&#x5728;&#x53E6;&#x4E00;&#x4E2A;suspend&#x51FD;&#x6570;&#x6216;&#x8005;Coroutine&#x534F;&#x7A0B;&#x7A0B;&#x5E8F;&#x4E2D;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#x3002;</p>\n<p>&#x7B2C;&#x4E00;&#x6B21;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x5B9A;&#x4E49;&#x4E0D;&#x77E5;&#x9053;&#x4F60;&#x4EEC;&#x662F;&#x5426;&#x6709;&#x7591;&#x95EE;&#xFF0C;&#x53CD;&#x6B63;&#x5C0F;&#x61A9;&#x6211;&#x662F;&#x5F88;&#x7591;&#x60D1;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;suspend&#x4FEE;&#x9970;&#x7684;&#x65B9;&#x6CD5;&#x9700;&#x8981;&#x6709;&#x8FD9;&#x4E2A;&#x9650;&#x5236;&#x5462;&#xFF1F;&#x4E0D;&#x52A0;&#x4E3A;&#x4EC0;&#x4E48;&#x5C31;&#x4E0D;&#x53EF;&#x4EE5;&#xFF0C;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</p>\n<p>&#x5F53;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x6709;&#x5173;&#x6CE8;&#x6211;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x5E94;&#x8BE5;&#x5C31;&#x4F1A;&#x6709;&#x6240;&#x4E86;&#x89E3;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;<a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484584&amp;idx=1&amp;sn=14deb55b443975eec648602a8807862e&amp;chksm=e8e0fd38df97742e45daa2cba014bbbde2216212452c72a00e94e100c13d90d2af5d3fa9ed61&amp;token=981517486&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">&#x91CD;&#x6E29;Retrofit&#x6E90;&#x7801;&#xFF0C;&#x7B11;&#x770B;&#x534F;&#x7A0B;&#x5B9E;&#x73B0;</a>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x6211;&#x5DF2;&#x7ECF;&#x6709;&#x7B80;&#x5355;&#x7684;&#x63D0;&#x53CA;&#x3002;</p>\n<p>&#x8FD9;&#x91CC;&#x6D89;&#x53CA;&#x5230;&#x4E00;&#x79CD;&#x673A;&#x5236;&#x4FD7;&#x79F0;CPS(Continuation-Passing-Style)&#x3002;&#x6BCF;&#x4E00;&#x4E2A;suspend&#x4FEE;&#x9970;&#x7684;&#x65B9;&#x6CD5;&#x6216;&#x8005;lambda&#x8868;&#x8FBE;&#x5F0F;&#x90FD;&#x4F1A;&#x5728;&#x4EE3;&#x7801;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#x4E3A;&#x5176;&#x989D;&#x5916;&#x6DFB;&#x52A0;Continuation&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GET(&quot;/v2/news&quot;)</span><br><span class=\"line\">suspend fun newsGet(@QueryMap params: Map&lt;String, String&gt;): NewsResponse</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7ECF;&#x8FC7;CPS&#x8F6C;&#x6362;&#x4E4B;&#x540E;&#x771F;&#x6B63;&#x7684;&#x9762;&#x76EE;&#x662F;&#x8FD9;&#x6837;&#x7684;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GET(&quot;/v2/news&quot;)</span><br><span class=\"line\">fun newsGet(@QueryMap params: Map&lt;String, String&gt;, c: Continuation&lt;NewsResponse&gt;): Any?</span><br></pre></td></tr></table></figure>\n<p>&#x7ECF;&#x8FC7;&#x8F6C;&#x6362;&#x4E4B;&#x540E;&#xFF0C;&#x539F;&#x6709;&#x7684;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;NewsResponse&#x88AB;&#x6DFB;&#x52A0;&#x5230;&#x65B0;&#x589E;&#x7684;Continutation&#x53C2;&#x6570;&#x4E2D;&#xFF0C;&#x540C;&#x65F6;&#x8FD4;&#x56DE;&#x4E86;Any?&#x7C7B;&#x578B;&#x3002;&#x8FD9;&#x91CC;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x6240;&#x7591;&#x95EE;&#xFF1F;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x90FD;&#x53D8;&#x4E86;&#xFF0C;&#x7ED3;&#x679C;&#x4E0D;&#x5C31;&#x51FA;&#x9519;&#x4E86;&#x5417;&#xFF1F;</p>\n<p>&#x5176;&#x5B9E;&#x4E0D;&#x662F;&#xFF0C;Any?&#x5728;Kotlin&#x4E2D;&#x6BD4;&#x8F83;&#x7279;&#x6B8A;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x4EE3;&#x8868;&#x4EFB;&#x610F;&#x7C7B;&#x578B;&#x3002;</p>\n<p>&#x5F53;suspend&#x51FD;&#x6570;&#x88AB;&#x534F;&#x7A0B;&#x6302;&#x8D77;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x6807;&#x8BC6;COROUTINE_SUSPENDED&#xFF0C;&#x800C;&#x5B83;&#x672C;&#x8D28;&#x5C31;&#x662F;&#x4E00;&#x4E2A;Any&#xFF1B;&#x5F53;&#x534F;&#x7A0B;&#x4E0D;&#x6302;&#x8D77;&#x8FDB;&#x884C;&#x6267;&#x884C;&#x65F6;&#xFF0C;&#x5B83;&#x5C06;&#x8FD4;&#x56DE;&#x6267;&#x884C;&#x7684;&#x7ED3;&#x679C;&#x6216;&#x8005;&#x5F15;&#x53D1;&#x7684;&#x5F02;&#x5E38;&#x3002;&#x8FD9;&#x6837;&#x4E3A;&#x4E86;&#x8BA9;&#x8FD9;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x7684;&#x8FD4;&#x56DE;&#x90FD;&#x652F;&#x6301;&#xFF0C;&#x6240;&#x4EE5;&#x4F7F;&#x7528;&#x4E86;Kotlin&#x72EC;&#x6709;&#x7684;Any?&#x7C7B;&#x578B;&#x3002;</p>\n<p>&#x8FD4;&#x56DE;&#x503C;&#x641E;&#x660E;&#x767D;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x6765;&#x8BF4;&#x8BF4;&#x8FD9;&#x4E2A;Continutation&#x53C2;&#x6570;&#x3002;</p>\n<p>&#x9996;&#x5148;&#x6765;&#x770B;&#x4E0B;Continutation&#x7684;&#x6E90;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface Continuation&lt;in T&gt; {</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * The context of the coroutine that corresponds to this continuation.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public val context: CoroutineContext</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Resumes the execution of the corresponding coroutine passing a successful or failed [result] as the</span><br><span class=\"line\">     * return value of the last suspension point.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public fun resumeWith(result: Result&lt;T&gt;)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>context&#x662F;&#x534F;&#x7A0B;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x5B83;&#x66F4;&#x591A;&#x65F6;&#x5019;&#x662F;CombinedContext&#x7C7B;&#x578B;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;&#x534F;&#x7A0B;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x8FD9;&#x4E2A;&#x540E;&#x7EED;&#x4F1A;&#x8BE6;&#x60C5;&#x8BF4;&#x660E;&#x3002;</p>\n<p>resumeWith&#x662F;&#x7528;&#x6765;&#x5524;&#x9192;&#x6302;&#x8D77;&#x7684;&#x534F;&#x7A0B;&#x3002;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x8BF4;&#x8FC7;&#x534F;&#x7A0B;&#x5728;&#x6267;&#x884C;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x963B;&#x585E;&#x4F7F;&#x7528;&#x4E86;&#x6302;&#x8D77;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x4E00;&#x65E6;&#x534F;&#x7A0B;&#x5185;&#x90E8;&#x7684;&#x903B;&#x8F91;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x8BE5;&#x65B9;&#x6CD5;&#x6765;&#x5524;&#x8D77;&#x534F;&#x7A0B;&#x3002;&#x8BA9;&#x5B83;&#x5728;&#x4E4B;&#x524D;&#x6302;&#x8D77;&#x7684;&#x4F4D;&#x7F6E;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x4E0B;&#x53BB;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x6BCF;&#x4E00;&#x4E2A;&#x88AB;suspend&#x4FEE;&#x9970;&#x7684;&#x51FD;&#x6570;&#x90FD;&#x4F1A;&#x83B7;&#x53D6;&#x4E0A;&#x5C42;&#x7684;Continutation&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7ED9;&#x81EA;&#x5DF1;&#x3002;&#x65E2;&#x7136;&#x662F;&#x4ECE;&#x4E0A;&#x5C42;&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;&#xFF0C;&#x90A3;&#x4E48;Continutation&#x662F;&#x7531;&#x8C01;&#x521B;&#x5EFA;&#x7684;&#x5462;&#xFF1F;</p>\n<p>&#x5176;&#x5B9E;&#x4E5F;&#x4E0D;&#x96BE;&#x731C;&#x5230;&#xFF0C;Continutation&#x5C31;&#x662F;&#x4E0E;&#x534F;&#x7A0B;&#x521B;&#x5EFA;&#x7684;&#x65F6;&#x5019;&#x4E00;&#x8D77;&#x88AB;&#x521B;&#x5EFA;&#x7684;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GlobalScope.launch { </span><br><span class=\"line\">             </span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>launch&#x7684;&#x65F6;&#x5019;&#x5C31;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x4E86;Continutation&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x4E14;&#x542F;&#x52A8;&#x4E86;&#x534F;&#x7A0B;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x5B83;&#x91CC;&#x9762;&#x8FDB;&#x884C;&#x6302;&#x8D77;&#x7684;&#x534F;&#x7A0B;&#x4F20;&#x9012;&#x7684;&#x53C2;&#x6570;&#x90FD;&#x662F;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x3002;</p>\n<p>&#x7B80;&#x5355;&#x7684;&#x7406;&#x89E3;&#x5C31;&#x662F;&#x534F;&#x7A0B;&#x4F7F;&#x7528;resumeWith&#x66FF;&#x6362;&#x4F20;&#x7EDF;&#x7684;callback&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x534F;&#x7A0B;&#x7A0B;&#x5E8F;&#x7684;&#x521B;&#x5EFA;&#x90FD;&#x4F1A;&#x4F34;&#x968F;Continutation&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x540C;&#x65F6;&#x534F;&#x7A0B;&#x521B;&#x5EFA;&#x7684;&#x65F6;&#x5019;&#x90FD;&#x4F1A;&#x81EA;&#x52A8;&#x56DE;&#x8C03;&#x4E00;&#x6B21;Continutation&#x7684;resumeWith&#x65B9;&#x6CD5;&#xFF0C;&#x4EE5;&#x4FBF;&#x8BA9;&#x534F;&#x7A0B;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x3002;</p>\n<h2 id=\"CoroutineContext\"><a href=\"#CoroutineContext\" class=\"headerlink\" title=\"CoroutineContext\"></a>CoroutineContext</h2><p>&#x534F;&#x7A0B;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x5B83;&#x5305;&#x542B;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x4E00;&#x4E9B;&#x6570;&#x636E;&#x96C6;&#x5408;&#xFF0C;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x4E0E;&#x534F;&#x7A0B;&#x5BC6;&#x5207;&#x76F8;&#x5173;&#x3002;&#x5B83;&#x7C7B;&#x4F3C;&#x4E8E;map&#x96C6;&#x5408;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;key&#x6765;&#x83B7;&#x53D6;&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x3002;&#x540C;&#x65F6;CoroutineContext&#x7684;&#x7075;&#x6D3B;&#x6027;&#x5F88;&#x5F3A;&#xFF0C;&#x5982;&#x679C;&#x5176;&#x9700;&#x8981;&#x6539;&#x53D8;&#x53EA;&#x9700;&#x4F7F;&#x7528;&#x5F53;&#x524D;&#x7684;CoroutineContext&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;CoroutineContext&#x5373;&#x53EF;&#x3002;</p>\n<p>&#x6765;&#x770B;&#x4E0B;CoroutineContext&#x7684;&#x5B9A;&#x4E49;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface CoroutineContext {</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Returns the element with the given [key] from this context or `null`.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public operator fun &lt;E : Element&gt; get(key: Key&lt;E&gt;): E?</span><br><span class=\"line\"> </span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Accumulates entries of this context starting with [initial] value and applying [operation]</span><br><span class=\"line\">     * from left to right to current accumulator value and each element of this context.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public fun &lt;R&gt; fold(initial: R, operation: (R, Element) -&gt; R): R</span><br><span class=\"line\"> </span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Returns a context containing elements from this context and elements from  other [context].</span><br><span class=\"line\">     * The elements from this context with the same key as in the other one are dropped.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public operator fun plus(context: CoroutineContext): CoroutineContext = ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Returns a context containing elements from this context, but without an element with</span><br><span class=\"line\">     * the specified [key].</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public fun minusKey(key: Key&lt;*&gt;): CoroutineContext</span><br><span class=\"line\"> </span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Key for the elements of [CoroutineContext]. [E] is a type of element with this key.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public interface Key&lt;E : Element&gt;</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * An element of the [CoroutineContext]. An element of the coroutine context is a singleton context by itself.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public interface Element : CoroutineContext {..}</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6BCF;&#x4E00;&#x4E2A;CoroutineContext&#x90FD;&#x6709;&#x5B83;&#x552F;&#x4E00;&#x7684;&#x4E00;&#x4E2A;Key&#x5176;&#x4E2D;&#x7684;&#x7C7B;&#x578B;&#x662F;Element&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5BF9;&#x5E94;&#x7684;Key&#x6765;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;&#x5177;&#x4F53;&#x5BF9;&#x8C61;&#x3002;&#x8BF4;&#x7684;&#x6709;&#x70B9;&#x62BD;&#x8C61;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x4F8B;&#x5B50;&#x6765;&#x4E86;&#x89E3;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ar context = Job() + Dispatchers.IO + CoroutineName(&quot;aa&quot;)</span><br><span class=\"line\">LogUtils.d(&quot;$context, ${context[CoroutineName]}&quot;)</span><br><span class=\"line\">context = context.minusKey(Job)</span><br><span class=\"line\">LogUtils.d(&quot;$context&quot;)</span><br><span class=\"line\">// &#x8F93;&#x51FA;</span><br><span class=\"line\">[JobImpl{Active}@158b42c, CoroutineName(aa), LimitingDispatcher@aeb0f27[dispatcher = DefaultDispatcher]], CoroutineName(aa)</span><br><span class=\"line\">[CoroutineName(aa), LimitingDispatcher@aeb0f27[dispatcher = DefaultDispatcher]]</span><br></pre></td></tr></table></figure>\n<p>Job&#x3001;Dispatchers&#x4E0E;CoroutineName&#x90FD;&#x5B9E;&#x73B0;&#x4E86;Element&#x63A5;&#x53E3;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x7ED3;&#x5408;&#x4E0D;&#x540C;&#x7684;CoroutineContext&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x901A;&#x8FC7;+&#x62FC;&#x63A5;&#xFF0C;&#x672C;&#x8D28;&#x5C31;&#x662F;&#x4F7F;&#x7528;&#x4E86;plus&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public operator fun plus(context: CoroutineContext): CoroutineContext =</span><br><span class=\"line\">    if (context === EmptyCoroutineContext) this else // fast path -- avoid lambda creation</span><br><span class=\"line\">        context.fold(this) { acc, element -&gt;</span><br><span class=\"line\">            val removed = acc.minusKey(element.key)</span><br><span class=\"line\">            if (removed === EmptyCoroutineContext) element else {</span><br><span class=\"line\">                // make sure interceptor is always last in the context (and thus is fast to get when present)</span><br><span class=\"line\">                val interceptor = removed[ContinuationInterceptor]</span><br><span class=\"line\">                if (interceptor == null) CombinedContext(removed, element) else {</span><br><span class=\"line\">                    val left = removed.minusKey(ContinuationInterceptor)</span><br><span class=\"line\">                    if (left === EmptyCoroutineContext) CombinedContext(element, interceptor) else</span><br><span class=\"line\">                        CombinedContext(CombinedContext(left, element), interceptor)</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br></pre></td></tr></table></figure>\n<p>plus&#x7684;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#x662F;&#x5C06;&#x4E24;&#x4E2A;&#x62FC;&#x63A5;&#x7684;CoroutineContext&#x5C01;&#x88C5;&#x5230;CombinedContext&#x4E2D;&#x7EC4;&#x6210;&#x4E00;&#x4E2A;&#x62FC;&#x63A5;&#x94FE;&#xFF0C;&#x540C;&#x65F6;&#x6BCF;&#x6B21;&#x90FD;&#x5C06;ContinuationInterceptor&#x6DFB;&#x52A0;&#x5230;&#x62FC;&#x63A5;&#x94FE;&#x7684;&#x6700;&#x5C3E;&#x90E8;.</p>\n<p>&#x90A3;&#x4E48;CombinedContext&#x53C8;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">internal class CombinedContext(</span><br><span class=\"line\">    private val left: CoroutineContext,</span><br><span class=\"line\">    private val element: Element</span><br><span class=\"line\">) : CoroutineContext, Serializable {</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun &lt;E : Element&gt; get(key: Key&lt;E&gt;): E? {</span><br><span class=\"line\">        var cur = this</span><br><span class=\"line\">        while (true) {</span><br><span class=\"line\">            cur.element[key]?.let { return it }</span><br><span class=\"line\">            val next = cur.left</span><br><span class=\"line\">            if (next is CombinedContext) {</span><br><span class=\"line\">                cur = next</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                return next[key]</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6CE8;&#x610F;&#x770B;&#x5B83;&#x7684;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x62FF;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x6765;&#x5206;&#x6790;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Job() + Dispatchers.IO</span><br><span class=\"line\">(Job, Dispatchers.IO)</span><br></pre></td></tr></table></figure>\n<p>Job&#x5BF9;&#x5E94;&#x4E8E;left&#xFF0C;Dispatchers.IO&#x5BF9;&#x5E94;element&#x3002;&#x5982;&#x679C;&#x518D;&#x62FC;&#x63A5;&#x4E00;&#x5C42;CoroutineName(aa)&#x5C31;&#x662F;&#x8FD9;&#x6837;&#x7684;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">((Job, Dispatchers.IO),CoroutineName)</span><br></pre></td></tr></table></figure>\n<p>&#x529F;&#x80FD;&#x7C7B;&#x4F3C;&#x4E0E;&#x94FE;&#x8868;&#xFF0C;&#x4F46;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x4F60;&#x80FD;&#x591F;&#x62FF;&#x5230;&#x4E0A;&#x4E00;&#x4E2A;&#x4E0E;&#x4F60;&#x76F8;&#x8FDE;&#x7684;&#x6574;&#x4F53;&#x5185;&#x5BB9;&#x3002;&#x4E0E;&#x4E4B;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;minusKey&#x65B9;&#x6CD5;&#xFF0C;&#x4ECE;&#x96C6;&#x5408;&#x4E2D;&#x79FB;&#x9664;&#x5BF9;&#x5E94;Key&#x7684;CoroutineContext&#x5B9E;&#x4F8B;&#x3002;</p>\n<p>&#x6709;&#x4E86;&#x8FD9;&#x4E2A;&#x57FA;&#x7840;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x770B;&#x5B83;&#x7684;get&#x65B9;&#x6CD5;&#x5C31;&#x5F88;&#x6E05;&#x6670;&#x4E86;&#x3002;&#x5148;&#x4ECE;element&#x4E2D;&#x53BB;&#x53D6;&#xFF0C;&#x6CA1;&#x6709;&#x518D;&#x4ECE;&#x4E4B;&#x524D;&#x7684;left&#x4E2D;&#x53D6;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;Key&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;CoroutineName</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public data class CoroutineName(</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * User-defined coroutine name.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    val name: String</span><br><span class=\"line\">) : AbstractCoroutineContextElement(CoroutineName) {</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Key for [CoroutineName] instance in the coroutine context.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public companion object Key : CoroutineContext.Key&lt;CoroutineName&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Returns a string representation of the object.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    override fun toString(): String = &quot;CoroutineName($name)&quot;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5F88;&#x7B80;&#x5355;&#x5B83;&#x7684;Key&#x5C31;&#x662F;CoroutineContext.Key<coroutinename>&#xFF0C;&#x5F53;&#x7136;&#x8FD9;&#x6837;&#x8FD8;&#x4E0D;&#x591F;&#xFF0C;&#x9700;&#x8981;&#x7EE7;&#x7EED;&#x7ED3;&#x5408;&#x5BF9;&#x4E8E;&#x7684;operator get&#x65B9;&#x6CD5;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x4E0B;Element&#x7684;get&#x65B9;&#x6CD5;</coroutinename></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public override operator fun &lt;E : Element&gt; get(key: Key&lt;E&gt;): E? =</span><br><span class=\"line\">    @Suppress(&quot;UNCHECKED_CAST&quot;)</span><br><span class=\"line\">    if (this.key == key) this as E else null</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x5230;&#x4E86;Kotlin&#x7684;operator&#x64CD;&#x4F5C;&#x7B26;&#x91CD;&#x8F7D;&#x7684;&#x7279;&#x6027;&#x3002;&#x90A3;&#x4E48;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x662F;&#x7B49;&#x6548;&#x7684;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">context.get(CoroutineName)</span><br><span class=\"line\">context[CoroutineName]</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x7C7B;&#x4F3C;&#x4E8E;Map&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x83B7;&#x53D6;&#x6574;&#x4E2A;&#x534F;&#x7A0B;&#x4E2D;CoroutineContext&#x96C6;&#x5408;&#x4E2D;&#x5BF9;&#x5E94;Key&#x7684;CoroutineContext&#x5B9E;&#x4F8B;&#x3002;</p>\n<p>&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x4E86;suspend&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x4E0E;CoroutineContext&#x7684;&#x5185;&#x90E8;&#x7ED3;&#x6784;&#x3002;&#x5E0C;&#x671B;&#x5BF9;&#x5B66;&#x4E60;&#x534F;&#x7A0B;&#x7684;&#x4F19;&#x4F34;&#x4EEC;&#x80FD;&#x591F;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#xFF0C;&#x656C;&#x8BF7;&#x671F;&#x5F85;&#x540E;&#x7EED;&#x7684;&#x534F;&#x7A0B;&#x5206;&#x6790;&#x3002;</p>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["coroutine"]},{"title":"动态代理分析与仿Retrofit实践","url":"https://www.rousetime.com/2020/10/29/动态代理分析与仿Retrofit实践/","content":"<p><img src=\"/2020/10/29/&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x5206;&#x6790;&#x4E0E;&#x4EFF;Retrofit&#x5B9E;&#x8DF5;/1.jpeg\" alt><br>&#x6211;&#x4EEC;&#x4E00;&#x76F4;&#x90FD;&#x5728;&#x4F7F;&#x7528;Retroift&#xFF0C;&#x90FD;&#x77E5;&#x9053;&#x5B83;&#x7684;&#x6838;&#x5FC3;&#x662F;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x3002;&#x4F8B;&#x5982;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#x91CD;&#x6E29;Retrofit&#x6E90;&#x7801;&#xFF0C;&#x7B11;&#x770B;&#x534F;&#x7A0B;&#x5B9E;&#x73B0;&#x4E2D;&#x4E5F;&#x7B80;&#x5355;&#x63D0;&#x53CA;&#x5230;&#x52A8;&#x6001;&#x4EE3;&#x7406;(&#x6765;&#x586B;&#x4E4B;&#x524D;&#x6316;&#x7684;&#x5751;&#x2026;)&#x3002;</p>\n<p>&#x54B3;&#x54B3;&#xFF0C;&#x5927;&#x5BB6;&#x4E0D;&#x8981;&#x5173;&#x6CE8;&#x8D77;&#x56E0;&#xFF0C;&#x8FD8;&#x662F;&#x8981;&#x56DE;&#x5F52;&#x5F53;&#x524D;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>\n<p>&#x8FD9;&#x6B21;&#x4E3B;&#x8981;&#x662F;&#x6765;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7684;&#x4F5C;&#x7528;&#x4E0E;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x3002;&#x65E2;&#x7136;&#x90FD;&#x5DF2;&#x7ECF;&#x5206;&#x6790;&#x4E86;&#x539F;&#x7406;&#xFF0C;&#x6700;&#x540E;&#x81EA;&#x7136;&#x4E5F;&#x8981;&#x52A8;&#x624B;&#x4EFF;&#x7167;Retrofit&#x6765;&#x7B80;&#x5355;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;Demo&#x3002;</p>\n<p>&#x901A;&#x8FC7;&#x6700;&#x540E;&#x7684;Demo&#x5B9E;&#x73B0;&#xFF0C;&#x76F8;&#x4FE1;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x4F60;&#x4E5F;&#x57FA;&#x672C;&#x6CA1;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x4E86;&#x3002;</p>\n<h2 id=\"&#x9759;&#x6001;&#x4EE3;&#x7406;\"><a href=\"#&#x9759;&#x6001;&#x4EE3;&#x7406;\" class=\"headerlink\" title=\"&#x9759;&#x6001;&#x4EE3;&#x7406;\"></a>&#x9759;&#x6001;&#x4EE3;&#x7406;</h2><p>&#x65E2;&#x7136;&#x8BF4;&#x5230;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#xFF0C;&#x81EA;&#x7136;&#x5C11;&#x4E0D;&#x4E86;&#x9759;&#x6001;&#x4EE3;&#x7406;&#x3002;&#x90A3;&#x4E48;&#x9759;&#x6001;&#x4EE3;&#x7406;&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x573A;&#x666F;&#x6765;&#x4E86;&#x89E3;&#x3002;</p>\n<p>&#x5047;&#x8BBE;&#x6709;&#x4E00;&#x4E2A;Bird&#x63A5;&#x53E3;&#x6765;&#x4EE3;&#x8868;&#x9E1F;&#x7684;&#x4E00;&#x4E9B;&#x7279;&#x6027;&#xFF0C;&#x4F8B;&#x5982;fly&#x98DE;&#x884C;&#x7279;&#x6027;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface Bird {</span><br><span class=\"line\">    fun fly()</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x73B0;&#x5728;&#x5206;&#x522B;&#x6709;&#x9EBB;&#x96C0;&#x3001;&#x8001;&#x9E70;&#x7B49;&#x52A8;&#x7269;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x90FD;&#x662F;&#x9E1F;&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x90FD;&#x4F1A;&#x5B9E;&#x73B0;Bird&#x63A5;&#x53E3;&#xFF0C;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;fly&#x903B;&#x8F91;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// &#x9EBB;&#x96C0;</span><br><span class=\"line\">class Sparrow : Bird {</span><br><span class=\"line\">    override fun fly() {</span><br><span class=\"line\">        println(&quot;Sparrow: is fly.&quot;)</span><br><span class=\"line\">        Thread.sleep(1000)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\">// &#x8001;&#x9E70;</span><br><span class=\"line\">class Eagle : Bird {</span><br><span class=\"line\">    override fun fly() {</span><br><span class=\"line\">        println(&quot;Eagle: is fly.&quot;)</span><br><span class=\"line\">        Thread.sleep(2000)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x9EBB;&#x96C0;&#x4E0E;&#x8001;&#x9E70;&#x7684;&#x98DE;&#x884C;&#x80FD;&#x529B;&#x90FD;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x6709;&#x4E2A;&#x9700;&#x6C42;&#xFF1A;&#x9700;&#x8981;&#x5206;&#x522B;&#x7EDF;&#x8BA1;&#x9EBB;&#x96C0;&#x4E0E;&#x8001;&#x9E70;&#x98DE;&#x884C;&#x7684;&#x65F6;&#x957F;&#x3002;</p>\n<p>&#x4F60;&#x4F1A;&#x600E;&#x4E48;&#x505A;&#x5462;&#xFF1F;&#x76F8;&#x4FE1;&#x5728;&#x6211;&#x4EEC;&#x521A;&#x5B66;&#x4E60;&#x7F16;&#x7A0B;&#x7684;&#x65F6;&#x5019;&#x90FD;&#x4F1A;&#x60F3;&#x5230;&#x7684;&#x662F;&#xFF1A;&#x8FD9;&#x8FD8;&#x4E0D;&#x7B80;&#x5355;&#x76F4;&#x63A5;&#x5728;&#x9EBB;&#x96C0;&#x4E0E;&#x8001;&#x9E70;&#x7684;fly&#x65B9;&#x6CD5;&#x4E2D;&#x5206;&#x522B;&#x7EDF;&#x8BA1;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x5B9E;&#x73B0;&#x7684;&#x9E1F;&#x7C7B;&#x79CD;&#x7C7B;&#x4E0D;&#x591A;&#x7684;&#x8BDD;&#xFF0C;&#x8FD9;&#x79CD;&#x5B9E;&#x73B0;&#x4E0D;&#x4F1A;&#x6709;&#x592A;&#x5927;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#x4E00;&#x65E6;&#x5B9E;&#x73B0;&#x7684;&#x9E1F;&#x7C7B;&#x79CD;&#x7C7B;&#x5F88;&#x591A;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x91CD;&#x590D;&#x505A;&#x7684;&#x903B;&#x8F91;&#x5C06;&#x4F1A;&#x5F88;&#x591A;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x8981;&#x5230;&#x6BCF;&#x4E00;&#x79CD;&#x9E1F;&#x7C7B;&#x7684;fly&#x65B9;&#x6CD5;&#x4E2D;&#x90FD;&#x53BB;&#x6DFB;&#x52A0;&#x7EDF;&#x8BA1;&#x65F6;&#x957F;&#x7684;&#x903B;&#x8F91;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x79CD;&#x65E0;&#x610F;&#x4E49;&#x7684;&#x91CD;&#x590D;&#x903B;&#x8F91;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;ProxyBird&#x6765;&#x4EE3;&#x7406;&#x5B9E;&#x73B0;&#x65F6;&#x957F;&#x7684;&#x7EDF;&#x8BA1;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class BirdProxy(private val bird: Bird) : Bird {</span><br><span class=\"line\">    override fun fly() {</span><br><span class=\"line\">        println(&quot;BirdProxy: fly start.&quot;)</span><br><span class=\"line\">        val start = System.currentTimeMillis() / 1000</span><br><span class=\"line\">        bird.fly()</span><br><span class=\"line\">        println(&quot;BirdProxy: fly end and cost time =&gt; ${System.currentTimeMillis() / 1000 - start}s&quot;)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>ProxyBird&#x5B9E;&#x73B0;&#x4E86;Bird&#x63A5;&#x53E3;&#xFF0C;&#x540C;&#x65F6;&#x63A5;&#x53D7;&#x4E86;&#x5916;&#x90E8;&#x4F20;&#x8FDB;&#x6765;&#x7684;&#x5B9E;&#x73B0;Bird&#x63A5;&#x53E3;&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x5F53;&#x8C03;&#x7528;ProxyBird&#x7684;fly&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x95F4;&#x63A5;&#x8C03;&#x7528;&#x4E86;&#x4F20;&#x8FDB;&#x6765;&#x7684;&#x5BF9;&#x8C61;&#x7684;fly&#x65B9;&#x6CD5;&#xFF0C;&#x540C;&#x65F6;&#x8FD8;&#x8FDB;&#x884C;&#x6765;&#x65F6;&#x957F;&#x7684;&#x7EDF;&#x8BA1;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Main {</span><br><span class=\"line\">    companion object {</span><br><span class=\"line\">        @JvmStatic</span><br><span class=\"line\">        fun main(args: Array&lt;String&gt;) {</span><br><span class=\"line\">            ProxyBird(Sparrow()).fly()</span><br><span class=\"line\">            println()</span><br><span class=\"line\">            ProxyBird(Eagle()).fly()</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x8F93;&#x51FA;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ProxyBird: fly start.</span><br><span class=\"line\">Sparrow: is fly.</span><br><span class=\"line\">ProxyBird: fly end and cost time =&gt; 1s</span><br><span class=\"line\"> </span><br><span class=\"line\">ProxyBird: fly start.</span><br><span class=\"line\">Eagle: is fly.</span><br><span class=\"line\">ProxyBird: fly end and cost time =&gt; 2s</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x5C31;&#x662F;&#x9759;&#x6001;&#x4EE3;&#x7406;&#xFF0C;&#x53EF;&#x80FD;&#x6709;&#x8BB8;&#x591A;&#x8BFB;&#x8005;&#x90FD;&#x5DF2;&#x7ECF;&#x4E0D;&#x77E5;&#x89C9;&#x7684;&#x4F7F;&#x7528;&#x5230;&#x4E86;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x53EA;&#x662F;&#x81EA;&#x5DF1;&#x6CA1;&#x6709;&#x610F;&#x8BC6;&#x5230;&#x8FD9;&#x662F;&#x9759;&#x6001;&#x4EE3;&#x7406;&#x3002;</p>\n<p>&#x90A3;&#x5B83;&#x7684;&#x597D;&#x5904;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p>\n<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x5F88;&#x81EA;&#x7136;&#x7684;&#x80FD;&#x591F;&#x4F53;&#x4F1A;&#x5230;&#x9759;&#x6001;&#x4EE3;&#x7406;&#x4E3B;&#x8981;&#x5E2E;&#x6211;&#x4EEC;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x662F;&#xFF1A;</p>\n<ol>\n<li>&#x51CF;&#x5C11;&#x91CD;&#x590D;&#x903B;&#x8F91;&#x7684;&#x7F16;&#x5199;&#xFF0C;&#x63D0;&#x4F9B;&#x7EDF;&#x4E00;&#x7684;&#x4FBF;&#x6377;&#x5904;&#x7406;&#x5165;&#x53E3;&#x3002;</li>\n<li>&#x5C01;&#x88C5;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x3002;</li>\n</ol>\n<h2 id=\"&#x52A8;&#x6001;&#x4EE3;&#x7406;\"><a href=\"#&#x52A8;&#x6001;&#x4EE3;&#x7406;\" class=\"headerlink\" title=\"&#x52A8;&#x6001;&#x4EE3;&#x7406;\"></a>&#x52A8;&#x6001;&#x4EE3;&#x7406;</h2><p>&#x65E2;&#x7136;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x9759;&#x6001;&#x4EE3;&#x7406;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x53C8;&#x8981;&#x6765;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x5462;&#xFF1F;</p>\n<p><strong>&#x4EFB;&#x4F55;&#x4E1C;&#x897F;&#x7684;&#x4EA7;&#x751F;&#x90FD;&#x662F;&#x6709;&#x5B83;&#x7684;&#x5FC5;&#x8981;&#x6027;&#x7684;&#xFF0C;&#x90FD;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x524D;&#x8005;&#x4E0D;&#x80FD;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x3002;</strong><br>&#x6240;&#x4EE5;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x5C31;&#x662F;&#x6765;&#x89E3;&#x51B3;&#x9759;&#x6001;&#x4EE3;&#x7406;&#x6240;&#x4E0D;&#x80FD;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4EA6;&#x6216;&#x8005;&#x662F;&#x5B83;&#x7684;&#x7F3A;&#x70B9;&#x3002;</p>\n<p>&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x8981;&#x4E3A;Bird&#x65B0;&#x589E;&#x4E00;&#x79CD;&#x7279;&#x6027;&#xFF1A;chirp&#x9E1F;&#x53EB;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x57FA;&#x4E8E;&#x524D;&#x9762;&#x7684;&#x9759;&#x6001;&#x4EE3;&#x7406;&#xFF0C;&#x9700;&#x8981;&#x505A;&#x4E9B;&#x4EC0;&#x4E48;&#x6539;&#x53D8;&#x5462;&#xFF1F;</p>\n<ol>\n<li>&#x4FEE;&#x6539;Bird&#x63A5;&#x53E3;&#xFF0C;&#x65B0;&#x589E;chirp&#x65B9;&#x6CD5;&#x3002;</li>\n<li>&#x5206;&#x522B;&#x4FEE;&#x6539;Sparrow&#x4E0E;Eagle&#xFF0C;&#x4E3A;&#x5B83;&#x4EEC;&#x65B0;&#x589E;chirp&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x3002;</li>\n<li>&#x4FEE;&#x6539;ProxyBird&#xFF0C;&#x5B9E;&#x73B0;chirp&#x4EE3;&#x7406;&#x65B9;&#x6CD5;&#x3002;</li>\n</ol>\n<p>1&#x3001;3&#x8FD8;&#x597D;&#xFF0C;&#x5C24;&#x5176;&#x662F;2&#xFF0C;&#x4E00;&#x65E6;&#x5B9E;&#x73B0;Bird&#x63A5;&#x53E3;&#x7684;&#x9E1F;&#x7C7B;&#x79CD;&#x7C7B;&#x5F88;&#x591A;&#x7684;&#x8BDD;&#xFF0C;&#x5C06;&#x4F1A;&#x975E;&#x5E38;&#x7E41;&#x7410;&#xFF0C;&#x8FD9;&#x65F6;&#x5C31;&#x771F;&#x7684;&#x662F;&#x7275;&#x4E00;&#x53D1;&#x52A8;&#x5168;&#x8EAB;&#x4E86;&#x3002;</p>\n<p>&#x8FD9;&#x8FD8;&#x662F;&#x6539;&#x52A8;&#x73B0;&#x6709;&#x7684;Bird&#x63A5;&#x53E3;&#xFF0C;&#x53EF;&#x80FD;&#x4F60;&#x8FD8;&#x9700;&#x8981;&#x65B0;&#x589E;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x63A5;&#x53E3;&#xFF0C;&#x4F8B;&#x5982;Fish&#x9C7C;&#xFF0C;&#x5B9E;&#x73B0;&#x6709;&#x5173;&#x9C7C;&#x7684;&#x7279;&#x6027;&#x3002;</p>\n<p>&#x8FD9;&#x65F6;&#x53C8;&#x8981;&#x91CD;&#x65B0;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x4EE3;&#x7406;ProxyFish&#x6765;&#x7BA1;&#x7406;&#x6709;&#x5173;&#x9C7C;&#x7684;&#x4EE3;&#x7406;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x4ECE;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x9759;&#x6001;&#x4EE3;&#x7406;&#x7684;&#x673A;&#x52A8;&#x6027;&#x5F88;&#x5DEE;&#xFF0C;&#x5BF9;&#x4E8E;&#x90A3;&#x4E9B;&#x5B9E;&#x73B0;&#x4E86;&#x4E4B;&#x540E;&#x4E0D;&#x600E;&#x4E48;&#x6539;&#x53D8;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x4F7F;&#x7528;&#x5B83;&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x4E5F;&#x5B8C;&#x5168;&#x7B26;&#x5408;&#x5B83;&#x7684;&#x540D;&#x5B57;&#x4E2D;&#x7684;&#x9759;&#x6001;&#x7684;&#x7279;&#x6027;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x5C31;&#x80FD;&#x591F;&#x89E3;&#x51B3;&#x5417;&#xFF1F;&#x522B;&#x6025;&#xFF0C;&#x80FD;&#x5426;&#x89E3;&#x51B3;&#x63A5;&#x7740;&#x5F80;&#x4E0B;&#x770B;&#x3002;</p>\n<p>&#x63A5;&#x7740;&#x4E0A;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x4E3A;Bird&#x65B0;&#x589E;chirp&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface Bird {</span><br><span class=\"line\">    fun fly()</span><br><span class=\"line\">    </span><br><span class=\"line\">    fun chirp()</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x518D;&#x901A;&#x8FC7;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Main {</span><br><span class=\"line\">    companion object {</span><br><span class=\"line\">        @JvmStatic</span><br><span class=\"line\">        fun main(args: Array&lt;String&gt;) {</span><br><span class=\"line\">            val proxy = (Proxy.newProxyInstance(this::class.java.classLoader, arrayOf(Bird::class.java), InvocationHandler { proxy, method, args -&gt;</span><br><span class=\"line\">                if (method.name == &quot;fly&quot;) {</span><br><span class=\"line\">                    println(&quot;calling fly.&quot;)</span><br><span class=\"line\">                } else if (method.name == &quot;chirp&quot;) {</span><br><span class=\"line\">                    println(&quot;calling chirp.&quot;)</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }) as Bird)</span><br><span class=\"line\">            </span><br><span class=\"line\">            proxy.fly()</span><br><span class=\"line\">            proxy.chirp()</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8F93;&#x51FA;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">calling fly.</span><br><span class=\"line\">calling chirp.</span><br></pre></td></tr></table></figure>\n<p>&#x65B9;&#x5F0F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x901A;&#x8FC7;Proxy.newProxyInstance&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;Bird&#x63A5;&#x53E3;&#x7684;&#x4EE3;&#x7406;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x6709;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x5206;&#x522B;&#x4E3A;&#xFF1A;</p>\n<ol>\n<li>ClassLoader: &#x751F;&#x6210;&#x4EE3;&#x7406;&#x7C7B;&#x7684;&#x7C7B;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x3002;</li>\n<li>interface &#x63A5;&#x53E3;Class&#x6570;&#x7EC4;: &#x5BF9;&#x5E94;&#x7684;&#x63A5;&#x53E3;Class&#x3002;</li>\n<li>InvocationHandler: InvocationHandler&#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x6709;&#x4EE3;&#x7406;&#x65B9;&#x6CD5;&#x7684;&#x56DE;&#x8C03;&#x3002;</li>\n</ol>\n<p>&#x8FD9;&#x91CC;&#x5173;&#x952E;&#x70B9;&#x662F;&#x7B2C;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x6240;&#x6709;&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x4EE3;&#x7406;&#x7C7B;&#x7684;&#x4EE3;&#x7406;&#x65B9;&#x6CD5;&#x90FD;&#x4F1A;&#x5728;InvocationHandler&#x5BF9;&#x8C61;&#x4E2D;&#x901A;&#x8FC7;&#x5B83;&#x7684;invoke&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x56DE;&#x8C03;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface InvocationHandler {</span><br><span class=\"line\">    public Object invoke(Object proxy, Method method, Object[] args)</span><br><span class=\"line\">        throws Throwable;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x5C31;&#x662F;&#x4E0A;&#x9762;&#x5C06;&#x5224;&#x65AD;&#x8C03;&#x7528;&#x5177;&#x4F53;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x7684;&#x903B;&#x8F91;&#x5199;&#x5728;InvocationHandler&#x5BF9;&#x8C61;&#x7684;invoke&#x65B9;&#x6CD5;&#x7684;&#x539F;&#x56E0;&#x3002;</p>\n<p>&#x90A3;&#x5B83;&#x5230;&#x5E95;&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x7684;&#x5462;&#xFF1F;&#x600E;&#x4E48;&#x5C31;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#x7C7B;&#x5462;&#xFF1F;&#x6211;&#x4E5F;&#x6CA1;&#x770B;&#x5230;&#x4EE3;&#x7406;&#x7C7B;&#x5728;&#x54EA;&#x554A;&#xFF1F;&#x600E;&#x4E48;&#x5C31;&#x6240;&#x6709;&#x8C03;&#x7528;&#x90FD;&#x901A;&#x8FC7;InvocationHandler&#x7684;&#x5462;&#xFF1F;</p>\n<p>&#x6709;&#x8FD9;&#x4E9B;&#x7591;&#x95EE;&#x5F88;&#x6B63;&#x5E38;&#xFF0C;&#x5F00;&#x59CB;&#x63A5;&#x89E6;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x65F6;&#x90FD;&#x4F1A;&#x6709;&#x8FD9;&#x4E9B;&#x7591;&#x95EE;&#x3002;&#x5BFC;&#x81F4;&#x8FD9;&#x4E9B;&#x7591;&#x95EE;&#x7684;&#x76F4;&#x63A5;&#x539F;&#x56E0;&#x662F;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x770B;&#x5230;&#x6240;&#x8C13;&#x7684;&#x4EE3;&#x7406;&#x7C7B;&#x3002;&#x56E0;&#x4E3A;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x662F;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x751F;&#x6210;&#x4EE3;&#x7406;&#x7C7B;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x50CF;&#x5728;&#x7F16;&#x8BD1;&#x65F6;&#x671F;&#x4E00;&#x6837;&#x80FD;&#x591F;&#x76F4;&#x63A5;&#x770B;&#x5230;&#x6E90;&#x7801;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x4E0B;&#x9762;&#x76EE;&#x6807;&#x5C31;&#x5F88;&#x660E;&#x786E;&#x4E86;&#xFF0C;&#x89E3;&#x51B3;&#x770B;&#x4E0D;&#x5230;&#x6E90;&#x7801;&#x7684;&#x95EE;&#x9898;&#x3002;</p>\n<p>&#x65E2;&#x7136;&#x662F;&#x8FD0;&#x884C;&#x65F6;&#x751F;&#x6210;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x65F6;&#x5019;&#x5C06;&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7406;&#x7C7B;&#x5199;&#x5230;&#x672C;&#x5730;&#x76EE;&#x5F55;&#x4E0B;&#x4E0D;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x5417;&#xFF1F;&#x81F3;&#x4E8E;&#x5982;&#x4F55;&#x5199;Proxy&#x5DF2;&#x7ECF;&#x63D0;&#x4F9B;&#x4E86;ProxyGenerator&#x3002;&#x5B83;&#x7684;generateProxyClass&#x65B9;&#x6CD5;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5F97;&#x5230;&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7406;&#x7C7B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Main {</span><br><span class=\"line\">    companion object {</span><br><span class=\"line\">        @JvmStatic</span><br><span class=\"line\">        fun main(args: Array&lt;String&gt;) {</span><br><span class=\"line\">            val byte = ProxyGenerator.generateProxyClass(&quot;\\$Proxy0&quot;, arrayOf(Bird::class.java))</span><br><span class=\"line\">            FileOutputStream(&quot;/Users/{path}/Downloads/\\$Proxy0.class&quot;).apply {</span><br><span class=\"line\">                write(byte)</span><br><span class=\"line\">                flush()</span><br><span class=\"line\">                close()</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x4F1A;&#x5728;Downloads&#x76EE;&#x5F55;&#x4E0B;&#x627E;&#x5230;$Proxy0.class&#x6587;&#x4EF6;&#xFF0C;&#x5C06;&#x5176;&#x76F4;&#x63A5;&#x62D6;&#x5230;&#x7F16;&#x8BD1;&#x5668;&#x4E2D;&#xFF0C;&#x6253;&#x5F00;&#x540E;&#x7684;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public final class $Proxy0 extends Proxy implements Bird {</span><br><span class=\"line\">    private static Method m1;</span><br><span class=\"line\">    private static Method m4;</span><br><span class=\"line\">    private static Method m2;</span><br><span class=\"line\">    private static Method m3;</span><br><span class=\"line\">    private static Method m0;</span><br><span class=\"line\"> </span><br><span class=\"line\">    public $Proxy0(InvocationHandler var1) throws  {</span><br><span class=\"line\">        super(var1);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    public final boolean equals(Object var1) throws  {</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            return (Boolean)super.h.invoke(this, m1, new Object[]{var1});</span><br><span class=\"line\">        } catch (RuntimeException | Error var3) {</span><br><span class=\"line\">            throw var3;</span><br><span class=\"line\">        } catch (Throwable var4) {</span><br><span class=\"line\">            throw new UndeclaredThrowableException(var4);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    public final void fly() throws  {</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            super.h.invoke(this, m4, (Object[])null);</span><br><span class=\"line\">        } catch (RuntimeException | Error var2) {</span><br><span class=\"line\">            throw var2;</span><br><span class=\"line\">        } catch (Throwable var3) {</span><br><span class=\"line\">            throw new UndeclaredThrowableException(var3);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    public final String toString() throws  {</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            return (String)super.h.invoke(this, m2, (Object[])null);</span><br><span class=\"line\">        } catch (RuntimeException | Error var2) {</span><br><span class=\"line\">            throw var2;</span><br><span class=\"line\">        } catch (Throwable var3) {</span><br><span class=\"line\">            throw new UndeclaredThrowableException(var3);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    public final void chirp() throws  {</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            super.h.invoke(this, m3, (Object[])null);</span><br><span class=\"line\">        } catch (RuntimeException | Error var2) {</span><br><span class=\"line\">            throw var2;</span><br><span class=\"line\">        } catch (Throwable var3) {</span><br><span class=\"line\">            throw new UndeclaredThrowableException(var3);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    public final int hashCode() throws  {</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            return (Integer)super.h.invoke(this, m0, (Object[])null);</span><br><span class=\"line\">        } catch (RuntimeException | Error var2) {</span><br><span class=\"line\">            throw var2;</span><br><span class=\"line\">        } catch (Throwable var3) {</span><br><span class=\"line\">            throw new UndeclaredThrowableException(var3);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    static {</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            m1 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;equals&quot;, Class.forName(&quot;java.lang.Object&quot;));</span><br><span class=\"line\">            m4 = Class.forName(&quot;com.daily.algothrim.Bird&quot;).getMethod(&quot;fly&quot;);</span><br><span class=\"line\">            m2 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;toString&quot;);</span><br><span class=\"line\">            m3 = Class.forName(&quot;com.daily.algothrim.Bird&quot;).getMethod(&quot;chirp&quot;);</span><br><span class=\"line\">            m0 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;hashCode&quot;);</span><br><span class=\"line\">        } catch (NoSuchMethodException var2) {</span><br><span class=\"line\">            throw new NoSuchMethodError(var2.getMessage());</span><br><span class=\"line\">        } catch (ClassNotFoundException var3) {</span><br><span class=\"line\">            throw new NoClassDefFoundError(var3.getMessage());</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x9996;&#x5148;$Proxy0&#x7EE7;&#x627F;&#x4E86;Proxy&#x540C;&#x65F6;&#x5B9E;&#x73B0;&#x4E86;&#x6211;&#x4EEC;&#x719F;&#x6089;&#x7684;Bird&#x63A5;&#x53E3;&#xFF1B;&#x7136;&#x540E;&#x5728;&#x5B83;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#x63A5;&#x53D7;&#x4E86;&#x4E00;&#x4E2A;var1&#x53C2;&#x6570;&#xFF0C;&#x5B83;&#x7684;&#x7C7B;&#x578B;&#x662F;InvocationHandler&#x3002;&#x7EE7;&#x7EED;&#x770B;&#x65B9;&#x6CD5;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x7C7B;&#x7684;&#x9ED8;&#x8BA4;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;equals&#x3001;toString&#x4E0E;hashCode&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x627E;&#x5230;&#x4E86;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;fly&#x4E0E;chirp&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x4F8B;&#x5982;fly&#x65B9;&#x6CD5;&#xFF0C;&#x8C03;&#x7528;&#x4E86;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">super.h.invoke(this, m4, (Object[])null)</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x7684;h&#x5C31;&#x662F;&#x4E4B;&#x524D;&#x7684;var1&#xFF0C;&#x5373;InvocationHandler&#x5BF9;&#x8C61;&#x3002;</p>\n<p>&#x5230;&#x8FD9;&#x91CC;&#x8FF7;&#x96FE;&#x5DF2;&#x7ECF;&#x63ED;&#x6653;&#x4E86;&#xFF0C;&#x8C03;&#x7528;invoke&#x65B9;&#x6CD5;&#xFF0C;&#x540C;&#x65F6;&#x5C06;&#x4EE3;&#x7406;&#x7C7B;&#x7684;&#x81EA;&#x8EAB;this&#x3001;&#x5BF9;&#x5E94;&#x7684;method&#x4FE1;&#x606F;&#x4E0E;&#x65B9;&#x6CD5;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x8FC7;&#x53BB;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5728;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;InvocationHandler&#x7684;invoke&#x65B9;&#x6CD5;&#x4E2D;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x4E0D;&#x540C;&#x4EE3;&#x7406;&#x65B9;&#x6CD5;&#x7684;&#x76F8;&#x5173;&#x903B;&#x8F91;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x597D;&#x5904;&#x662F;&#xFF0C;&#x4E0D;&#x7BA1;&#x4F60;&#x5982;&#x4F55;&#x65B0;&#x589E;&#x4E0E;&#x5220;&#x9664;Bird&#x4E2D;&#x7684;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x90FD;&#x53EA;&#x8981;&#x8C03;&#x6574;invoke&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;&#x5373;&#x53EF;&#xFF0C;&#x5C06;&#x6539;&#x52A8;&#x7684;&#x8303;&#x56F4;&#x7F29;&#x5C0F;&#x5230;&#x6700;&#x5C0F;&#x5316;&#x3002;</p>\n<p>&#x8FD9;&#x5C31;&#x662F;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7684;&#x597D;&#x5904;&#x4E4B;&#x4E00;(&#x53E6;&#x4E00;&#x4E2A;&#x4E3B;&#x8981;&#x7684;&#x597D;&#x5904;&#x81EA;&#x7136;&#x662F;&#x51CF;&#x5C11;&#x4EE3;&#x7406;&#x7C7B;&#x7684;&#x4E66;&#x5199;)&#x3002;</p>\n<p>&#x5728;Android&#x4E2D;&#x8FD0;&#x7528;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7684;&#x5178;&#x578B;&#x975E;Retrofit&#x83AB;&#x5C5E;&#x3002;&#x7531;&#x4E8E;&#x662F;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x6846;&#x67B6;&#xFF0C;&#x4E00;&#x4E2A;App&#x5BF9;&#x4E8E;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x6765;&#x8BF4;&#x63A5;&#x53E3;&#x81EA;&#x7136;&#x662F;&#x968F;&#x7740;App&#x7684;&#x8FED;&#x4EE3;&#x4E0D;&#x65AD;&#x589E;&#x52A0;&#x7684;&#x3002;&#x5BF9;&#x4E8E;&#x8FD9;&#x79CD;&#x53D8;&#x5316;&#x9891;&#x7E41;&#x7684;&#x60C5;&#x51B5;&#xFF0C;Retrofit&#x4F7F;&#x7528;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x4E3A;&#x5165;&#x53E3;&#xFF0C;&#x66B4;&#x9732;&#x51FA;&#x4E00;&#x4E2A;&#x5BF9;&#x5E94;&#x7684;Service&#x63A5;&#x53E3;&#xFF0C;&#x800C;&#x76F8;&#x5173;&#x7684;&#x63A5;&#x53E3;&#x8BF7;&#x6C42;&#x65B9;&#x6CD5;&#x90FD;&#x5728;Service&#x4E2D;&#x8FDB;&#x884C;&#x5B9A;&#x4E49;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x6BCF;&#x65B0;&#x589E;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x90FD;&#x4E0D;&#x9700;&#x8981;&#x505A;&#x8FC7;&#x591A;&#x7684;&#x522B;&#x7684;&#x4FEE;&#x6539;&#xFF0C;&#x76F8;&#x5173;&#x7684;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x903B;&#x8F91;&#x90FD;&#x5C01;&#x88C5;&#x5230;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7684;invoke&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x5F53;&#x7136;Retrofit&#x539F;&#x7406;&#x662F;&#x501F;&#x52A9;&#x6DFB;&#x52A0;Annomation&#x6CE8;&#x89E3;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x89E3;&#x6790;&#x4E0D;&#x540C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x7684;&#x65B9;&#x5F0F;&#x4E0E;&#x76F8;&#x5173;&#x7684;&#x53C2;&#x6570;&#x903B;&#x8F91;&#x3002;&#x6700;&#x7EC8;&#x518D;&#x5C06;&#x89E3;&#x6790;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#x4F20;&#x9012;&#x7ED9;&#x4E0B;&#x5C42;&#x7684;OKHttp&#x3002;</p>\n<p>&#x6240;&#x4EE5;Retrofit&#x7684;&#x6838;&#x5FC3;&#x5C31;&#x662F;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x4E0E;&#x6CE8;&#x89E3;&#x7684;&#x89E3;&#x6790;&#x3002;</p>\n<p>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x539F;&#x7406;&#x89E3;&#x6790;&#x90E8;&#x5206;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x6700;&#x540E;&#x65E2;&#x7136;&#x5206;&#x6790;&#x4E86;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x4E0E;Retrofit&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;Demo&#x6765;&#x5DE9;&#x56FA;&#x4E00;&#x4E0B;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#xFF0C;&#x540C;&#x65F6;&#x501F;&#x9274;Retroift&#x7684;&#x4E00;&#x4E9B;&#x601D;&#x60F3;&#x5BF9;&#x4E00;&#x4E2A;&#x7B80;&#x6613;&#x7248;&#x7684;&#x6253;&#x70B9;&#x7CFB;&#x7EDF;&#x8FDB;&#x884C;&#x4E0A;&#x5C42;&#x5C01;&#x88C5;&#x3002;</p>\n<h2 id=\"Demo\"><a href=\"#Demo\" class=\"headerlink\" title=\"Demo\"></a>Demo</h2><p>Demo&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x6A21;&#x62DF;&#x6253;&#x70B9;&#x7CFB;&#x7EDF;&#xFF0C;&#x901A;&#x8FC7;&#x5B9A;&#x4E49;Statistic&#x7C7B;&#x6765;&#x521B;&#x5EFA;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#xFF0C;&#x66B4;&#x9732;Service&#x63A5;&#x53E3;&#xFF0C;&#x5177;&#x4F53;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Statistic private constructor() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    companion object {</span><br><span class=\"line\">        @JvmStatic</span><br><span class=\"line\">        val instance by lazy { Statistic() }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Suppress(&quot;UNCHECKED_CAST&quot;)</span><br><span class=\"line\">    fun &lt;T&gt; create(service: Class&lt;T&gt;): T {</span><br><span class=\"line\">        return Proxy.newProxyInstance(service.classLoader, arrayOf(service)) { proxy, method, args -&gt;</span><br><span class=\"line\">            return@newProxyInstance LoadService(method).invoke(args)</span><br><span class=\"line\">        } as T</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x5165;&#x53E3;&#x4F20;&#x8FDB;&#x6765;&#x7684;Service&#x63A5;&#x53E3;&#xFF0C;&#x4ECE;&#x800C;&#x521B;&#x5EFA;&#x5BF9;&#x5E94;&#x7684;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7C7B;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5BF9;Service&#x63A5;&#x53E3;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x7684;&#x903B;&#x8F91;&#x5904;&#x7406;&#x90FD;&#x5C01;&#x88C5;&#x5230;&#x4E86;LoadService&#x7684;invoke&#x65B9;&#x6CD5;&#x4E2D;&#x3002;&#x5F53;&#x7136;Statistic&#x4E5F;&#x501F;&#x52A9;&#x4E86;&#x6CE8;&#x89E3;&#x6765;&#x89E3;&#x6790;&#x4E0D;&#x540C;&#x7684;&#x6253;&#x70B9;&#x7C7B;&#x578B;&#x4E8B;&#x4EF6;&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5206;&#x522B;&#x5BF9;Button&#x4E0E;Text&#x8FDB;&#x884C;&#x70B9;&#x51FB;&#x4E0E;&#x5C55;&#x793A;&#x6253;&#x70B9;&#x7EDF;&#x8BA1;&#x3002;</p>\n<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5982;&#x4E0B;&#x5B9A;&#x4E49;&#x5BF9;&#x5E94;&#x7684;Service&#x63A5;&#x53E3;&#xFF0C;&#x8FD9;&#x91CC;&#x547D;&#x540D;&#x4E3A;StatisticService</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface StatisticService {</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Scan(ProxyActivity.PAGE_NAME)</span><br><span class=\"line\">    fun buttonScan(@Content(StatisticTrack.Parameter.NAME) name: String)</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Click(ProxyActivity.PAGE_NAME)</span><br><span class=\"line\">    fun buttonClick(@Content(StatisticTrack.Parameter.NAME) name: String, @Content(StatisticTrack.Parameter.TIME) clickTime: Long)</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Scan(ProxyActivity.PAGE_NAME)</span><br><span class=\"line\">    fun textScan(@Content(StatisticTrack.Parameter.NAME) name: String)</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Click(ProxyActivity.PAGE_NAME)</span><br><span class=\"line\">    fun textClick(@Content(StatisticTrack.Parameter.NAME) name: String, @Content(StatisticTrack.Parameter.TIME) clickTime: Long)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x518D;&#x901A;&#x8FC7;Statistic&#x6765;&#x83B7;&#x53D6;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7684;&#x4EE3;&#x7406;&#x7C7B;&#x5BF9;&#x8C61;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private val mStatisticService = Statistic.instance.create(StatisticService::class.java)</span><br></pre></td></tr></table></figure>\n<p>&#x6709;&#x4E86;&#x5BF9;&#x5E94;&#x7684;&#x4EE3;&#x7406;&#x7C7B;&#x5BF9;&#x8C61;&#xFF0C;&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F;&#x5728;&#x5BF9;&#x5E94;&#x7684;&#x4F4D;&#x7F6E;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ProxyActivity : AppCompatActivity() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    private val mStatisticService = Statistic.instance.create(StatisticService::class.java)</span><br><span class=\"line\"> </span><br><span class=\"line\">    companion object {</span><br><span class=\"line\">        private const val BUTTON = &quot;statistic_button&quot;</span><br><span class=\"line\">        private const val TEXT = &quot;statistic_text&quot;</span><br><span class=\"line\">        const val PAGE_NAME = &quot;ProxyActivity&quot;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) {</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        val extraData = getExtraData()</span><br><span class=\"line\">        setContentView(extraData.layoutId)</span><br><span class=\"line\">        title = extraData.title</span><br><span class=\"line\">        // statistic scan</span><br><span class=\"line\">        mStatisticService.buttonScan(BUTTON)</span><br><span class=\"line\">        mStatisticService.textScan(TEXT)</span><br><span class=\"line\">    }</span><br><span class=\"line\">    private fun getExtraData(): MainModel =</span><br><span class=\"line\">            intent?.extras?.getParcelable(ActivityUtils.EXTRA_DATA)</span><br><span class=\"line\">                    ?: throw NullPointerException(&quot;intent or extras is null&quot;)</span><br><span class=\"line\">    fun onClick(view: View) {</span><br><span class=\"line\">        // statistic click</span><br><span class=\"line\">        if (view.id == R.id.button) {</span><br><span class=\"line\">            mStatisticService.buttonClick(BUTTON, System.currentTimeMillis() / 1000)</span><br><span class=\"line\">        } else if (view.id == R.id.text) {</span><br><span class=\"line\">            mStatisticService.textClick(TEXT, System.currentTimeMillis() / 1000)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x6253;&#x70B9;&#x4E0A;&#x5C42;&#x903B;&#x8F91;&#x5C01;&#x88C5;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x3002;&#x7531;&#x4E8E;&#x7BC7;&#x5E45;&#x6709;&#x9650;(&#x61D2;&#x2026;)&#x5185;&#x90E8;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#x5C31;&#x4E0D;&#x5C55;&#x5F00;&#x4E86;&#x3002;</p>\n<p>&#x76F8;&#x5173;&#x6E90;&#x7801;&#x90FD;&#x5728;<a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x67E5;&#x770B;&#x3002;</p>\n<blockquote>\n<p>&#x4F7F;&#x7528;&#x524D;&#x8BF7;&#x5148;&#x628A;&#x5206;&#x652F;&#x5207;&#x6362;&#x5230;feat_proxy_dev</p>\n</blockquote>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x4EC5;&#x652F;&#x6301;Jetpack App Startup&#x7684;&#x5168;&#x90E8;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x4E0E;&#x591A;&#x8FDB;&#x7A0B;&#x652F;&#x6301;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0E;AwesomeGithub&#x76F8;&#x5BF9;&#x5E94;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n","categories":["android"],"tags":["retrofit"]},{"title":"重温Retrofit源码，笑看协程实现","url":"https://www.rousetime.com/2020/09/20/重温Retrofit源码，笑看协程实现/","content":"<p><img src=\"/2020/09/20/&#x91CD;&#x6E29;Retrofit&#x6E90;&#x7801;&#xFF0C;&#x7B11;&#x770B;&#x534F;&#x7A0B;&#x5B9E;&#x73B0;/cover.png\" alt></p>\n<p>&#x6700;&#x8FD1;&#x56DE;&#x5F52;&#x770B;&#x4E86;&#x4E00;&#x4E0B;Retrofit&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x56E0;&#x4E3A;&#x9879;&#x76EE;&#x63A5;&#x5165;&#x4E86;&#x534F;&#x7A0B;&#xFF0C;&#x6240;&#x4EE5;&#x60F3;&#x7814;&#x7A76;&#x4E00;&#x4E0B;Retorift&#x662F;&#x5982;&#x4F55;&#x652F;&#x6301;&#x534F;&#x7A0B;&#x7684;&#x3002;Retrofit&#x662F;&#x5728;Version 2.6.0&#x5F00;&#x59CB;&#x652F;&#x6301;&#x534F;&#x7A0B;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x6709;&#x5173;Retrofit&#x7684;&#x6E90;&#x7801;&#x90FD;&#x662F;&#x57FA;&#x4E8E;2.6.0&#x7684;&#x3002;</p>\n<blockquote>\n<p>&#x6E29;&#x99A8;&#x63D0;&#x793A;&#xFF0C;&#x5982;&#x679C;&#x6709;Retrofit&#x7684;&#x6E90;&#x7801;&#x9605;&#x8BFB;&#x7ECF;&#x9A8C;&#xFF0C;&#x9605;&#x8BFB;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5C06;&#x4F1A;&#x8F7B;&#x677E;&#x5F88;&#x591A;&#x3002;</p>\n</blockquote>\n<h2 id=\"Retrofit\"><a href=\"#Retrofit\" class=\"headerlink\" title=\"Retrofit\"></a>Retrofit</h2><p>&#x76F8;&#x4FE1;&#x8001;&#x9E1F;&#x90FD;&#x5E94;&#x8BE5;&#x5F88;&#x6E05;&#x695A;&#xFF0C;Retrofit&#x6838;&#x5FC3;&#x90E8;&#x5206;&#x662F;create()&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x7684;&#x52A8;&#x6001;&#x4EE3;&#x7406;(&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#x4E86;&#xFF0C;&#x4E4B;&#x540E;&#x4F1A;&#x6709;&#x4E13;&#x95E8;&#x7684;&#x6587;&#x7AE0;&#x5206;&#x6790;&#x52A8;&#x6001;&#x4EE3;&#x7406;)&#x3002;&#x5C31;&#x662F;&#x4E0B;&#x9762;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public &lt;T&gt; T create(final Class&lt;T&gt; service) {</span><br><span class=\"line\">  Utils.validateServiceInterface(service);</span><br><span class=\"line\">  if (validateEagerly) {</span><br><span class=\"line\">    eagerlyValidateMethods(service);</span><br><span class=\"line\">  }</span><br><span class=\"line\">  return (T) Proxy.newProxyInstance(service.getClassLoader(), new Class&lt;?&gt;[] { service },</span><br><span class=\"line\">      new InvocationHandler() {</span><br><span class=\"line\">        private final Platform platform = Platform.get();</span><br><span class=\"line\">        private final Object[] emptyArgs = new Object[0];</span><br><span class=\"line\"> </span><br><span class=\"line\">        @Override public @Nullable Object invoke(Object proxy, Method method,</span><br><span class=\"line\">            @Nullable Object[] args) throws Throwable {</span><br><span class=\"line\">          // If the method is a method from Object then defer to normal invocation.</span><br><span class=\"line\">          if (method.getDeclaringClass() == Object.class) {</span><br><span class=\"line\">            return method.invoke(this, args);</span><br><span class=\"line\">          }</span><br><span class=\"line\">          if (platform.isDefaultMethod(method)) {</span><br><span class=\"line\">            return platform.invokeDefaultMethod(method, service, proxy, args);</span><br><span class=\"line\">          }</span><br><span class=\"line\">          return loadServiceMethod(method).invoke(args != null ? args : emptyArgs);</span><br><span class=\"line\">        }</span><br><span class=\"line\">      });</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x7B2C;&#x4E00;&#x773C;&#x770B;&#xFF0C;&#x8DDF;&#x6211;&#x4E4B;&#x524D;&#x5370;&#x8C61;&#x4E2D;&#x7684;&#x6709;&#x70B9;&#x533A;&#x522B;(&#x4E5F;&#x4E0D;&#x77E5;&#x9053;&#x662F;&#x4EC0;&#x4E48;&#x7248;&#x672C;)&#xFF0C;return&#x7684;&#x65F6;&#x5019;&#x5C45;&#x7136;&#x6CA1;&#x6709;adapt&#x65B9;&#x6CD5;&#x4E86;&#x3002;&#x5F00;&#x59CB;&#x8FD8;&#x4EE5;&#x4E3A;&#x6709;&#x4EC0;&#x4E48;&#x91CD;&#x5927;&#x7684;&#x6539;&#x53D8;&#xFF0C;&#x5176;&#x5B9E;&#x4E5F;&#x6CA1;&#x4EC0;&#x4E48;&#xFF0C;&#x53EA;&#x662F;&#x5C06;&#x4E4B;&#x524D;&#x7684;adapt&#x65B9;&#x6CD5;&#x5C01;&#x88C5;&#x5230;invoke&#x65B9;&#x6CD5;&#x4E2D;&#x3002;</p>\n<p>&#x76F8;&#x5173;&#x7684;method&#x6CE8;&#x89E3;&#x89E3;&#x6790;&#x90FD;&#x653E;&#x5230;ServiceMethod&#x4E2D;&#xFF0C;&#x6709;&#x4E24;&#x4E2A;&#x5173;&#x952E;&#x51FD;&#x6570;&#x8C03;&#x7528;&#xFF0C;&#x5206;&#x522B;&#x662F;RequestFactory&#x4E0E;HttpServiceMethod&#x7684;parseAnnotations()&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static &lt;T&gt; ServiceMethod&lt;T&gt; parseAnnotations(Retrofit retrofit, Method method) {</span><br><span class=\"line\">  RequestFactory requestFactory = RequestFactory.parseAnnotations(retrofit, method);</span><br><span class=\"line\"> </span><br><span class=\"line\">  Type returnType = method.getGenericReturnType();</span><br><span class=\"line\">  if (Utils.hasUnresolvableType(returnType)) {</span><br><span class=\"line\">    throw methodError(method,</span><br><span class=\"line\">        &quot;Method return type must not include a type variable or wildcard: %s&quot;, returnType);</span><br><span class=\"line\">  }</span><br><span class=\"line\">  if (returnType == void.class) {</span><br><span class=\"line\">    throw methodError(method, &quot;Service methods cannot return void.&quot;);</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  return HttpServiceMethod.parseAnnotations(retrofit, method, requestFactory);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"RequestFactory\"><a href=\"#RequestFactory\" class=\"headerlink\" title=\"RequestFactory\"></a>RequestFactory</h2><p>&#x9996;&#x5148;RequestFactory&#x4E2D;&#x7684;parseAnnotations()&#x6700;&#x7EC8;&#x901A;&#x8FC7;build()&#x65B9;&#x6CD5;&#x6765;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;RequestFactory&#xFF0C;&#x7528;&#x6765;&#x4FDD;&#x5B58;&#x89E3;&#x6790;&#x51FA;&#x6765;&#x7684;&#x65B9;&#x6CD5;&#x4FE1;&#x606F;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RequestFactory build() {</span><br><span class=\"line\">   //1.&#x89E3;&#x6790;&#x65B9;&#x6CD5;&#x4E0A;&#x7684;&#x6CE8;&#x89E3;</span><br><span class=\"line\">   for (Annotation annotation : methodAnnotations) {</span><br><span class=\"line\">     parseMethodAnnotation(annotation);</span><br><span class=\"line\">   }</span><br><span class=\"line\">...</span><br><span class=\"line\">   int parameterCount = parameterAnnotationsArray.length;</span><br><span class=\"line\">   parameterHandlers = new ParameterHandler&lt;?&gt;[parameterCount];</span><br><span class=\"line\">   //2.&#x5FAA;&#x73AF;&#x904D;&#x5386;&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x5404;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x89E3;&#x6790;&#x53C2;&#x6570;&#x7684;&#x6CE8;&#x89E3;</span><br><span class=\"line\">   for (int p = 0, lastParameter = parameterCount - 1; p &lt; parameterCount; p++) {</span><br><span class=\"line\">     parameterHandlers[p] =</span><br><span class=\"line\">         parseParameter(p, parameterTypes[p], parameterAnnotationsArray[p], p == lastParameter);</span><br><span class=\"line\">   }</span><br><span class=\"line\">...</span><br><span class=\"line\">   return new RequestFactory(this);</span><br><span class=\"line\"> }</span><br></pre></td></tr></table></figure>\n<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E3B;&#x8981;&#x5206;&#x4E3A;&#x4E24;&#x6B65;&#xFF1A;</p>\n<ol>\n<li>&#x901A;&#x8FC7;parseMethodAnnotation&#x6765;&#x89E3;&#x6790;&#x51FA;&#x8BF7;&#x6C42;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4F8B;&#x5982;GET&#x3001;POST&#x4E0E;PUT&#x7B49;&#x7B49;&#xFF1B;&#x540C;&#x65F6;&#x4E5F;&#x4F1A;&#x9A8C;&#x8BC1;&#x4E00;&#x4E9B;&#x6CE8;&#x89E3;&#x7684;&#x5408;&#x89C4;&#x4F7F;&#x7528;&#xFF0C;&#x4F8B;&#x5982;Multipart&#x4E0E;FormUrlEncoded&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x3002;</li>\n<li>&#x901A;&#x8FC7;parseParameter&#x6765;&#x89E3;&#x6790;&#x51FA;&#x8BF7;&#x6C42;&#x7684;&#x53C2;&#x6570;&#x4FE1;&#x606F;&#xFF0C;&#x4F8B;&#x5982;Path&#x3001;Url&#x4E0E;Query&#x7B49;&#x7B49;&#xFF1B;&#x540C;&#x65F6;&#x4E5F;&#x5BF9;&#x5B83;&#x4EEC;&#x7684;&#x5408;&#x89C4;&#x4F7F;&#x7528;&#x505A;&#x4E86;&#x9A8C;&#x8BC1;&#xFF0C;&#x4F8B;&#x5982;QueryMap&#x4E0E;FieldMap&#x7B49;&#x6CE8;&#x89E3;&#x5B83;&#x4EEC;&#x7684;key&#x90FD;&#x5FC5;&#x987B;&#x4E3A;String&#x7C7B;&#x578B;&#x3002;&#x8FD9;&#x4E9B;&#x6CE8;&#x89E3;&#x7684;&#x89E3;&#x6790;&#x90FD;&#x662F;&#x5728;parseParameterAnnotation()&#x65B9;&#x6CD5;&#x4E2D;&#x8FDB;&#x884C;&#x7684;&#x3002;</li>\n</ol>\n<p>&#x4E0A;&#x9762;&#x7684;p == lastParameter&#x9700;&#x8981;&#x7279;&#x522B;&#x6CE8;&#x610F;&#x4E0B;&#xFF0C;&#x4E3A;&#x4F55;&#x8981;&#x4E13;&#x95E8;&#x5224;&#x65AD;&#x8BE5;&#x53C2;&#x6570;&#x662F;&#x5426;&#x4E3A;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5462;&#xFF1F;&#x8BF7;&#x7EE7;&#x7EED;&#x5411;&#x4E0B;&#x770B;&#x3002;</p>\n<h3 id=\"&#x534F;&#x7A0B;&#x7684;&#x5224;&#x65AD;&#x6761;&#x4EF6;\"><a href=\"#&#x534F;&#x7A0B;&#x7684;&#x5224;&#x65AD;&#x6761;&#x4EF6;\" class=\"headerlink\" title=\"&#x534F;&#x7A0B;&#x7684;&#x5224;&#x65AD;&#x6761;&#x4EF6;\"></a>&#x534F;&#x7A0B;&#x7684;&#x5224;&#x65AD;&#x6761;&#x4EF6;</h3><p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x7740;&#x91CD;&#x770B;&#x4E0B;parseParameter&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x56E0;&#x4E3A;&#x4ECE;&#x8FD9;&#x91CC;&#x5F00;&#x59CB;&#x5C31;&#x6D89;&#x53CA;&#x5230;&#x534F;&#x7A0B;&#x7684;&#x5224;&#x65AD;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private @Nullable ParameterHandler&lt;?&gt; parseParameter(</span><br><span class=\"line\">    int p, Type parameterType, @Nullable Annotation[] annotations, boolean allowContinuation) {</span><br><span class=\"line\">  ParameterHandler&lt;?&gt; result = null;</span><br><span class=\"line\">  if (annotations != null) {</span><br><span class=\"line\">    for (Annotation annotation : annotations) {</span><br><span class=\"line\">      //1.&#x89E3;&#x6790;&#x65B9;&#x6CD5;&#x53C2;&#x6570;&#x7684;&#x6CE8;&#x89E3;&#xFF0C;&#x5E76;&#x9A8C;&#x8BC1;&#x5B83;&#x4EEC;&#x7684;&#x5408;&#x6CD5;&#x6027;</span><br><span class=\"line\">      ParameterHandler&lt;?&gt; annotationAction =</span><br><span class=\"line\">          parseParameterAnnotation(p, parameterType, annotations, annotation);</span><br><span class=\"line\"> </span><br><span class=\"line\">      if (annotationAction == null) {</span><br><span class=\"line\">        continue;</span><br><span class=\"line\">      }</span><br><span class=\"line\"> </span><br><span class=\"line\">      //&#x6BCF;&#x4E2A;&#x53C2;&#x6570;&#x90FD;&#x53EA;&#x80FD;&#x6709;&#x4E00;&#x4E2A;&#x6CE8;&#x89E3;</span><br><span class=\"line\">      if (result != null) {</span><br><span class=\"line\">        throw parameterError(method, p,</span><br><span class=\"line\">            &quot;Multiple Retrofit annotations found, only one allowed.&quot;);</span><br><span class=\"line\">      }</span><br><span class=\"line\"> </span><br><span class=\"line\">      result = annotationAction;</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  //2.&#x5224;&#x65AD;&#x662F;&#x5426;&#x662F;&#x534F;&#x7A0B; </span><br><span class=\"line\">  if (result == null) {</span><br><span class=\"line\">    if (allowContinuation) {</span><br><span class=\"line\">      try {</span><br><span class=\"line\">        if (Utils.getRawType(parameterType) == Continuation.class) {</span><br><span class=\"line\">          isKotlinSuspendFunction = true;</span><br><span class=\"line\">          return null;</span><br><span class=\"line\">        }</span><br><span class=\"line\">      } catch (NoClassDefFoundError ignored) {</span><br><span class=\"line\">      }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    throw parameterError(method, p, &quot;No Retrofit annotation found.&quot;);</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  return result;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x7B2C;&#x4E00;&#x70B9;&#x6CA1;&#x4EC0;&#x4E48;&#x597D;&#x8BF4;&#x7684;&#xFF0C;&#x91CC;&#x9762;&#x6CA1;&#x4EC0;&#x4E48;&#x903B;&#x8F91;&#xFF0C;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7EAF;&#x6CE8;&#x89E3;&#x89E3;&#x6790;&#x4E0E;Converter&#x7684;&#x9009;&#x53D6;&#x3002;</p>\n<p>&#x7B2C;&#x4E8C;&#x70B9;&#x662F;&#x5173;&#x952E;&#x70B9;&#xFF0C;&#x7528;&#x6765;&#x5224;&#x65AD;&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x8C03;&#x7528;&#x662F;&#x5426;&#x4F7F;&#x7528;&#x5230;&#x4E86;&#x534F;&#x7A0B;&#x3002;&#x540C;&#x65F6;&#x6709;&#x4E2A;allowContinuation&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x5411;&#x4E0A;&#x770B;&#xFF0C;&#x53D1;&#x73B0;&#x5B83;&#x662F;&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x8FFD;&#x6EAF;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x7279;&#x610F;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;p == lastParameter&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x5224;&#x65AD;&#x662F;&#x5426;&#x662F;&#x4F7F;&#x7528;&#x4E86;&#x534F;&#x7A0B;&#x6709;&#x4E09;&#x6B65;&#xFF1A;</p>\n<ol>\n<li>result&#x4E3A;&#x7A7A;&#xFF0C;&#x5373;&#x8BE5;&#x53C2;&#x6570;&#x6CA1;&#x6709;&#x6CE8;&#x89E3;</li>\n<li>allowContinuation&#x4E3A;true&#xFF0C;&#x5373;&#x662F;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;</li>\n<li>Continuation.class&#xFF0C;&#x8BF4;&#x660E;&#x8BE5;&#x53C2;&#x6570;&#x7684;&#x7C7B;&#x578B;&#x4E3A;Continuation</li>\n</ol>\n<p>&#x53EA;&#x6709;&#x7B26;&#x5408;&#x4E0A;&#x8FF0;&#x4E09;&#x70B9;&#x624D;&#x80FD;&#x8BC1;&#x660E;&#x4F7F;&#x7528;&#x4E86;&#x534F;&#x7A0B;&#xFF0C;&#x4F46;&#x8111;&#x6D77;&#x91CC;&#x56DE;&#x60F3;&#x4E00;&#x4E0B;&#x534F;&#x7A0B;&#x7684;&#x5199;&#x6CD5;&#xFF0C;&#x53D1;&#x73B0;&#x5B8C;&#x5168;&#x5BF9;&#x4E0D;&#x5230;&#x8FD9;&#x4E09;&#x70B9;&#x2026;</p>\n<p>&#x5230;&#x8FD9;&#x91CC;&#x53EF;&#x80FD;&#x6709;&#x7684;&#x8BFB;&#x8005;&#x5DF2;&#x7ECF;&#x5F00;&#x59CB;&#x8499;&#x5708;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x6CA1;&#x6709;&#x6DF1;&#x5165;&#x4E86;&#x89E3;&#x534F;&#x7A0B;&#x7684;&#x8BDD;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;&#x6B63;&#x5E38;&#x7684;&#x72B6;&#x6001;&#x3002;</p>\n<p>&#x522B;&#x6025;&#xFF0C;&#x8981;&#x7406;&#x89E3;&#x8FD9;&#x5757;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x4E00;&#x70B9;&#x534F;&#x7A0B;&#x7684;&#x539F;&#x7406;&#x77E5;&#x8BC6;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x6765;&#x7B80;&#x5355;&#x8BF4;&#x4E00;&#x4E0B;&#x534F;&#x7A0B;&#x7684;&#x90E8;&#x5206;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x3002;</p>\n<h3 id=\"suspend&#x539F;&#x7406;\"><a href=\"#suspend&#x539F;&#x7406;\" class=\"headerlink\" title=\"suspend&#x539F;&#x7406;\"></a>suspend&#x539F;&#x7406;</h3><p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x4E0B;&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#x662F;&#x600E;&#x4E48;&#x5199;&#x7684;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GET(&quot;/v2/news&quot;)</span><br><span class=\"line\">suspend fun newsGet(@QueryMap params: Map&lt;String, String&gt;): NewsResponse</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x6807;&#x51C6;&#x7684;&#x534F;&#x7A0B;&#x5199;&#x6CD5;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x518D;&#x5957;&#x7528;&#x4E0A;&#x9762;&#x7684;&#x6761;&#x4EF6;&#xFF0C;&#x53D1;&#x73B0;&#x5B8C;&#x5168;&#x5339;&#x914D;&#x4E0D;&#x5230;&#x3002;</p>\n<p>&#x56E0;&#x4E3A;&#xFF0C;&#x8FD9;&#x662F;&#x4E0D;&#x534F;&#x7A0B;&#x7684;&#x672C;&#x6765;&#x9762;&#x76EE;&#x3002;&#x6211;&#x4EEC;&#x601D;&#x8003;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#x8981;&#x6DFB;&#x52A0;suspend&#x5173;&#x952E;&#x5B57;&#x5462;&#xFF1F;&#x8FD9;&#x662F;&#x91CD;&#x70B9;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x591A;&#x60F3;&#x51E0;&#x5206;&#x949F;&#x3002;</p>\n<p>(&#x51E0;&#x5206;&#x949F;&#x4E4B;&#x540E;&#x2026;)</p>\n<p>&#x4E0D;&#x540A;&#x5927;&#x5BB6;&#x80C3;&#x53E3;&#x4E86;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x5C31;&#x76F4;&#x63A5;&#x8BF4;&#x7ED3;&#x8BBA;&#x3002;</p>\n<p>&#x56E0;&#x4E3A;&#x5728;&#x4EE3;&#x7801;&#x7F16;&#x8BD1;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F1A;&#x81EA;&#x52A8;&#x4E3A;&#x5E26;&#x6709;suspend&#x7684;&#x51FD;&#x6570;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;Continuation&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x6DFB;&#x52A0;&#x5230;&#x6700;&#x540E;&#x9762;&#x3002;&#x6240;&#x4EE5;&#x4E0A;&#x9762;&#x7684;&#x534F;&#x7A0B;&#x771F;&#x6B63;&#x7684;&#x9762;&#x76EE;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GET(&quot;/v2/news&quot;)</span><br><span class=\"line\">fun newsGet(@QueryMap params: Map&lt;String, String&gt;, c: Continuation&lt;NewsResponse&gt;): NewsResponse</span><br></pre></td></tr></table></figure>\n<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x4E0A;&#x9762;&#x7684;&#x6761;&#x4EF6;&#xFF0C;&#x53D1;&#x73B0;&#x80FD;&#x591F;&#x5168;&#x90E8;&#x7B26;&#x5408;&#x4E86;&#x3002;</p>\n<blockquote>\n<p>&#x7531;&#x4E8E;&#x7BC7;&#x5E45;&#x6709;&#x9650;&#xFF0C;&#x6709;&#x5173;&#x534F;&#x7A0B;&#x7684;&#x539F;&#x7406;&#x5B9E;&#x73B0;&#x5C31;&#x70B9;&#x5230;&#x4E3A;&#x6B62;&#xFF0C;&#x540E;&#x7EED;&#x6211;&#x4F1A;&#x4E13;&#x95E8;&#x5199;&#x4E00;&#x4E2A;&#x534F;&#x7A0B;&#x7CFB;&#x5217;&#xFF0C;&#x5E0C;&#x671B;&#x5230;&#x65F6;&#x80FD;&#x591F;&#x8BA9;&#x8BFB;&#x8005;&#x4EEC;&#x8BA4;&#x8BC6;&#x5230;&#x534F;&#x7A0B;&#x7684;&#x771F;&#x9762;&#x76EE;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x671F;&#x5F85;&#x4E00;&#x4E0B;&#x3002;</p>\n</blockquote>\n<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x4E86;Retrofit&#x5982;&#x4F55;&#x5224;&#x65AD;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x5426;&#x4F7F;&#x7528;&#x4E86;&#x534F;&#x7A0B;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x518D;&#x8FDB;&#x5165;&#x53E6;&#x4E00;&#x4E2A;&#x70B9;:</p>\n<p>Retrofit&#x5982;&#x4F55;&#x5C06;Call&#x76F4;&#x63A5;&#x8F6C;&#x5316;&#x4E3A;NewResonse&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x8BF4;&#x5C31;&#x662F;&#x652F;&#x6301;&#x4F7F;newsGet&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;NewsResponse&#x3002;&#x800C;&#x8FD9;&#x4E00;&#x6B65;&#x7684;&#x8F6C;&#x5316;&#x5728;HttpServiceMethod&#x4E2D;&#x3002;</p>\n<h2 id=\"HttpServiceMethod\"><a href=\"#HttpServiceMethod\" class=\"headerlink\" title=\"HttpServiceMethod\"></a>HttpServiceMethod</h2><p>&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x5206;&#x6790;&#x5B8C;RequestFactory&#x7684;parseAnnotations()&#xFF0C;&#x73B0;&#x5728;&#x518D;&#x6765;&#x770B;&#x4E0B;HttpServiceMethod&#x4E2D;&#x7684;parseAnnotations()&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static &lt;ResponseT, ReturnT&gt; HttpServiceMethod&lt;ResponseT, ReturnT&gt; parseAnnotations(</span><br><span class=\"line\">    Retrofit retrofit, Method method, RequestFactory requestFactory) {</span><br><span class=\"line\">  boolean isKotlinSuspendFunction = requestFactory.isKotlinSuspendFunction;</span><br><span class=\"line\">  boolean continuationWantsResponse = false;</span><br><span class=\"line\">  boolean continuationBodyNullable = false;</span><br><span class=\"line\"> </span><br><span class=\"line\">  Annotation[] annotations = method.getAnnotations();</span><br><span class=\"line\">  Type adapterType;</span><br><span class=\"line\">  // 1. &#x662F;&#x534F;&#x7A0B;</span><br><span class=\"line\">  if (isKotlinSuspendFunction) {</span><br><span class=\"line\">    Type[] parameterTypes = method.getGenericParameterTypes();</span><br><span class=\"line\">    Type responseType = Utils.getParameterLowerBound(0,</span><br><span class=\"line\">        (ParameterizedType) parameterTypes[parameterTypes.length - 1]);</span><br><span class=\"line\">    // 2. &#x5224;&#x65AD;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x7684;&#x7C7B;&#x578B;&#x662F;&#x5426;&#x662F;Response</span><br><span class=\"line\">    if (getRawType(responseType) == Response.class &amp;&amp; responseType instanceof ParameterizedType) {</span><br><span class=\"line\">      // Unwrap the actual body type from Response&lt;T&gt;.</span><br><span class=\"line\">      responseType = Utils.getParameterUpperBound(0, (ParameterizedType) responseType);</span><br><span class=\"line\">      continuationWantsResponse = true;</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">      // TODO figure out if type is nullable or not</span><br><span class=\"line\">      // Metadata metadata = method.getDeclaringClass().getAnnotation(Metadata.class)</span><br><span class=\"line\">      // Find the entry for method</span><br><span class=\"line\">      // Determine if return type is nullable or not</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    // 3. &#x6CE8;&#x610F;&#xFF1A;&#x5C06;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x4F2A;&#x88C5;&#x6210;Call&#x7C7B;&#x578B;&#xFF0C;&#x5E76;&#x5C06;SkipCallbackExecutor&#x6CE8;&#x89E3;&#x6DFB;&#x52A0;&#x5230;annotations&#x4E2D;</span><br><span class=\"line\">    adapterType = new Utils.ParameterizedTypeImpl(null, Call.class, responseType);</span><br><span class=\"line\">    annotations = SkipCallbackExecutorImpl.ensurePresent(annotations);</span><br><span class=\"line\">  } else {</span><br><span class=\"line\">    adapterType = method.getGenericReturnType();</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  // 4. &#x521B;&#x5EFA;CallAdapter&#xFF0C;&#x9002;&#x914D;call&#xFF0C;&#x5C06;&#x5176;&#x8F6C;&#x5316;&#x6210;&#x9700;&#x8981;&#x7684;&#x7C7B;&#x578B;</span><br><span class=\"line\">  CallAdapter&lt;ResponseT, ReturnT&gt; callAdapter =</span><br><span class=\"line\">      createCallAdapter(retrofit, method, adapterType, annotations);</span><br><span class=\"line\">  Type responseType = callAdapter.responseType();</span><br><span class=\"line\">  // 5. &#x521B;&#x5EFA;Converter&#xFF0C;&#x5C06;&#x54CD;&#x5E94;&#x7684;&#x6570;&#x636E;&#x8F6C;&#x5316;&#x6210;&#x5BF9;&#x5E94;&#x7684;model&#x7C7B;&#x578B;</span><br><span class=\"line\">  Converter&lt;ResponseBody, ResponseT&gt; responseConverter =</span><br><span class=\"line\">      createResponseConverter(retrofit, method, responseType);</span><br><span class=\"line\"> </span><br><span class=\"line\">  okhttp3.Call.Factory callFactory = retrofit.callFactory;</span><br><span class=\"line\">  // 6. &#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x4E0D;&#x662F;&#x534F;&#x7A0B;</span><br><span class=\"line\">  if (!isKotlinSuspendFunction) {</span><br><span class=\"line\">    return new CallAdapted&lt;&gt;(requestFactory, callFactory, responseConverter, callAdapter);</span><br><span class=\"line\">  } else if (continuationWantsResponse) {</span><br><span class=\"line\">    // 7. &#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x662F;&#x534F;&#x7A0B;&#xFF0C;&#x540C;&#x65F6;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x662F;Response&#x7C7B;&#x578B;</span><br><span class=\"line\">    //noinspection unchecked Kotlin compiler guarantees ReturnT to be Object.</span><br><span class=\"line\">    return (HttpServiceMethod&lt;ResponseT, ReturnT&gt;) new SuspendForResponse&lt;&gt;(requestFactory,</span><br><span class=\"line\">        callFactory, responseConverter, (CallAdapter&lt;ResponseT, Call&lt;ResponseT&gt;&gt;) callAdapter);</span><br><span class=\"line\">  } else {</span><br><span class=\"line\">    // 8. &#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x662F;&#x534F;&#x7A0B;&#xFF0C;&#x540C;&#x65F6;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x662F;body&#xFF0C;&#x5373;&#x81EA;&#x5B9A;&#x4E49;&#x7684;model&#x7C7B;&#x578B;</span><br><span class=\"line\">    //noinspection unchecked Kotlin compiler guarantees ReturnT to be Object.</span><br><span class=\"line\">    return (HttpServiceMethod&lt;ResponseT, ReturnT&gt;) new SuspendForBody&lt;&gt;(requestFactory,</span><br><span class=\"line\">        callFactory, responseConverter, (CallAdapter&lt;ResponseT, Call&lt;ResponseT&gt;&gt;) callAdapter,</span><br><span class=\"line\">        continuationBodyNullable);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4EE3;&#x7801;&#x4E2D;&#x5DF2;&#x7ECF;&#x89E3;&#x6790;&#x7684;&#x5F88;&#x6E05;&#x695A;&#x4E86;&#xFF0C;&#x9700;&#x8981;&#x6CE8;&#x610F;3&#xFF0C;&#x5982;&#x679C;&#x662F;&#x534F;&#x7A0B;&#x4F1A;&#x505A;&#x4E24;&#x6B65;&#x64CD;&#x4F5C;&#xFF0C;&#x9996;&#x5148;&#x5C06;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x7684;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x4F2A;&#x88C5;&#x6210;Call&#x7C7B;&#x578B;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5C06;SkipCallbackExecutor&#x624B;&#x52A8;&#x6DFB;&#x52A0;&#x5230;annotations&#x4E2D;&#x3002;&#x5B57;&#x9762;&#x610F;&#x601D;&#x5C31;&#x5728;&#x540E;&#x7EED;&#x8C03;&#x7528;callAdapter.adapt(call)&#x65F6;&#xFF0C;&#x8DF3;&#x8FC7;&#x521B;&#x5EFA;Executor&#xFF0C;&#x7B80;&#x5355;&#x7406;&#x89E3;&#x5C31;&#x662F;&#x534F;&#x7A0B;&#x4E0D;&#x9700;&#x8981;Executor&#x6765;&#x5207;&#x6362;&#x7EBF;&#x7A0B;&#x7684;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x6837;&#xFF1F;&#x8FD9;&#x4E00;&#x70B9;&#x5148;&#x653E;&#x8FD9;&#x91CC;&#xFF0C;&#x540E;&#x7EED;&#x521B;&#x5EFA;Call&#x7684;&#x65F6;&#x5019;&#x518D;&#x8BF4;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x770B;&#x534F;&#x7A0B;&#x7684;7&#xFF0C;8&#x90E8;&#x5206;&#x3002;7&#x4E5F;&#x4E0D;&#x8BE6;&#x7EC6;&#x5206;&#x6790;&#xFF0C;&#x7B80;&#x5355;&#x63D0;&#x4E00;&#x4E0B;&#xFF0C;&#x5B83;&#x5C31;&#x662F;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;Response<t>&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x8FD9;&#x4E2A;Retrofit&#x6700;&#x57FA;&#x672C;&#x7684;&#x652F;&#x6301;&#x4E86;&#x3002;&#x81F3;&#x4E8E;&#x5982;&#x4F55;&#x5728;&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#x65F6;&#x5C06;Call<t>&#x8F6C;&#x5316;&#x6210;Response<t>&#x539F;&#x7406;&#x4E0E;8&#x57FA;&#x672C;&#x76F8;&#x540C;&#xFF0C;&#x53EA;&#x662F;&#x6BD4;8&#x5C11;&#x4E00;&#x6B65;&#xFF0C;&#x5C06;&#x5B83;&#x7684;body&#x8F6C;&#x5316;&#x6210;&#x5BF9;&#x5E94;&#x7684;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;model&#x3002;&#x6240;&#x4EE5;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x770B;8&#x3002;</t></t></t></p>\n<h3 id=\"&#x5C06;Call&#x8F6C;&#x5316;&#x6210;&#x5BF9;&#x5E94;&#x7684;Model\"><a href=\"#&#x5C06;Call&#x8F6C;&#x5316;&#x6210;&#x5BF9;&#x5E94;&#x7684;Model\" class=\"headerlink\" title=\"&#x5C06;Call&#x8F6C;&#x5316;&#x6210;&#x5BF9;&#x5E94;&#x7684;Model\"></a>&#x5C06;Call&#x8F6C;&#x5316;&#x6210;&#x5BF9;&#x5E94;&#x7684;Model</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static final class SuspendForBody&lt;ResponseT&gt; extends HttpServiceMethod&lt;ResponseT, Object&gt; {</span><br><span class=\"line\">  private final CallAdapter&lt;ResponseT, Call&lt;ResponseT&gt;&gt; callAdapter;</span><br><span class=\"line\">  private final boolean isNullable;</span><br><span class=\"line\"> </span><br><span class=\"line\">  SuspendForBody(RequestFactory requestFactory, okhttp3.Call.Factory callFactory,</span><br><span class=\"line\">      Converter&lt;ResponseBody, ResponseT&gt; responseConverter,</span><br><span class=\"line\">      CallAdapter&lt;ResponseT, Call&lt;ResponseT&gt;&gt; callAdapter, boolean isNullable) {</span><br><span class=\"line\">    super(requestFactory, callFactory, responseConverter);</span><br><span class=\"line\">    this.callAdapter = callAdapter;</span><br><span class=\"line\">    this.isNullable = isNullable;</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  @Override protected Object adapt(Call&lt;ResponseT&gt; call, Object[] args) {</span><br><span class=\"line\">    // 1. &#x83B7;&#x53D6;&#x9002;&#x914D;&#x7684;Call</span><br><span class=\"line\">    call = callAdapter.adapt(call);</span><br><span class=\"line\"> </span><br><span class=\"line\">    //noinspection unchecked Checked by reflection inside RequestFactory.</span><br><span class=\"line\">    // 2. &#x83B7;&#x53D6;&#x534F;&#x7A0B;&#x7684;Continuation</span><br><span class=\"line\">    Continuation&lt;ResponseT&gt; continuation = (Continuation&lt;ResponseT&gt;) args[args.length - 1];</span><br><span class=\"line\">    return isNullable</span><br><span class=\"line\">        ? KotlinExtensions.awaitNullable(call, continuation)</span><br><span class=\"line\">        : KotlinExtensions.await(call, continuation);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x7684;&#x5173;&#x6CE8;&#x70B9;&#x5728;adapt&#xFF0C;&#x6587;&#x7AE0;&#x5F00;&#x5934;&#x5DF2;&#x7ECF;&#x8BF4;&#x4E86;&#xFF0C;&#x65B0;&#x7248;&#x7684;Retrofit&#x5C06;adapt&#x9690;&#x85CF;&#x5230;invoke&#x4E2D;&#x3002;&#x800C;invoke&#x4E2D;&#x8C03;&#x7528;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;adapt&#x3002;</p>\n<p>&#x9996;&#x5148;&#x7B2C;&#x4E00;&#x6B65;&#xFF0C;&#x9002;&#x914D;Call&#xFF0C;&#x5982;&#x679C;&#x662F;RxJava&#xFF0C;&#x8FD9;&#x91CC;&#x7684;callAdapter&#x5C31;&#x662F;RxJava2CallAdapter&#xFF0C;&#x540C;&#x65F6;&#x8FD4;&#x56DE;&#x7684;&#x5C31;&#x662F;Observable&#xFF0C;&#x8FD9;&#x4E2A;&#x4E4B;&#x524D;&#x770B;&#x8FC7;&#x6E90;&#x7801;&#x7684;&#x90FD;&#x77E5;&#x9053;&#x3002;</p>\n<p>&#x4F46;&#x73B0;&#x5728;&#x662F;&#x534F;&#x7A0B;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x7684;callAdapter&#x5C31;&#x662F;Retrofit&#x9ED8;&#x8BA4;&#x7684;DefaultCallAdapterFactory</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override public @Nullable CallAdapter&lt;?, ?&gt; get(</span><br><span class=\"line\">    Type returnType, Annotation[] annotations, Retrofit retrofit) {</span><br><span class=\"line\">  // 1. &#x6CE8;&#x610F;: &#x5982;&#x679C;&#x662F;&#x534F;&#x7A0B;&#xFF0C;&#x56E0;&#x4E3A;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x6CA1;&#x6709;&#x4F7F;&#x7528;Call&#xFF0C;&#x4E4B;&#x524D;3&#x7684;&#x7B2C;&#x4E00;&#x6B65;&#x4F2A;&#x88C5;&#x6210;Call&#x7684;&#x5904;&#x7406;&#x5C31;&#x5728;&#x8FD9;&#x91CC;&#x4F53;&#x73B0;&#x4E86;&#x4F5C;&#x7528;</span><br><span class=\"line\">  if (getRawType(returnType) != Call.class) {</span><br><span class=\"line\">    return null;</span><br><span class=\"line\">  }</span><br><span class=\"line\">  if (!(returnType instanceof ParameterizedType)) {</span><br><span class=\"line\">    throw new IllegalArgumentException(</span><br><span class=\"line\">        &quot;Call return type must be parameterized as Call&lt;Foo&gt; or Call&lt;? extends Foo&gt;&quot;);</span><br><span class=\"line\">  }</span><br><span class=\"line\">  final Type responseType = Utils.getParameterUpperBound(0, (ParameterizedType) returnType);</span><br><span class=\"line\"> </span><br><span class=\"line\">  // 2. &#x4E4B;&#x524D;3&#x7684;&#x7B2C;&#x4E8C;&#x90E8;&#x5C31;&#x5728;&#x8FD9;&#x91CC;&#x4F53;&#x73B0;&#xFF0C;&#x7531;&#x4E8E;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x5C06;SkipCallbackExecutor&#x6CE8;&#x89E3;&#x6DFB;&#x52A0;&#x5230;annotations&#x4E2D;&#xFF0C;&#x6240;&#x4EE5;Executor&#x76F4;&#x63A5;&#x4E3A;null</span><br><span class=\"line\">  final Executor executor = Utils.isAnnotationPresent(annotations, SkipCallbackExecutor.class)</span><br><span class=\"line\">      ? null</span><br><span class=\"line\">      : callbackExecutor;</span><br><span class=\"line\">  return new CallAdapter&lt;Object, Call&lt;?&gt;&gt;() {</span><br><span class=\"line\">    @Override public Type responseType() {</span><br><span class=\"line\">      return responseType;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    @Override public Call&lt;Object&gt; adapt(Call&lt;Object&gt; call) {</span><br><span class=\"line\">      // 3. &#x6700;&#x7EC8;&#x8C03;&#x7528;adapt&#x65F6;&#x5019;&#x8FD4;&#x56DE;&#x7684;&#x5C31;&#x662F;&#x5B83;&#x672C;&#x8EAB;&#x7684;Call&#xFF0C;&#x5373;&#x4E0D;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x9002;&#x914D;&#x3002;</span><br><span class=\"line\">      return executor == null</span><br><span class=\"line\">          ? call</span><br><span class=\"line\">          : new ExecutorCallbackCall&lt;&gt;(executor, call);</span><br><span class=\"line\">    }</span><br><span class=\"line\">  };</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4EE3;&#x7801;&#x6CE8;&#x91CA;&#x5DF2;&#x7ECF;&#x5C06;&#x4E4B;&#x524D;3&#x7684;&#x4F5C;&#x7528;&#x89E3;&#x91CA;&#x5B8C;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x56DE;&#x5230;SuspendForBody&#x7684;adpt&#xFF0C;&#x518D;&#x770B;&#x7B2C;&#x4E8C;&#x6B65;&#x3002;&#x719F;&#x6089;&#x7684;&#x4E00;&#x5E55;&#xFF0C;&#x53C8;&#x7528;&#x5230;&#x4E86;&#x6700;&#x540E;&#x7684;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x3002;&#x8FD9;&#x91CC;&#x7684;isNullable&#x76EE;&#x524D;Retrofit&#x7684;&#x7248;&#x672C;&#x90FD;&#x662F;false&#xFF0C;&#x53EF;&#x80FD;&#x540E;&#x7EED;&#x4F1A;&#x652F;&#x6301;&#x7A7A;&#x7C7B;&#x578B;&#x3002;&#x4F46;&#x73B0;&#x5728;&#x80AF;&#x5B9A;&#x662F;&#x4E0D;&#x652F;&#x6301;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x76F4;&#x63A5;&#x8FDB;&#x5165;KotlinExtensions.await()</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">suspend fun &lt;T : Any&gt; Call&lt;T&gt;.await(): T {</span><br><span class=\"line\">  return suspendCancellableCoroutine { continuation -&gt;</span><br><span class=\"line\">    continuation.invokeOnCancellation {</span><br><span class=\"line\">      cancel()</span><br><span class=\"line\">    }</span><br><span class=\"line\">    enqueue(object : Callback&lt;T&gt; {</span><br><span class=\"line\">      override fun onResponse(call: Call&lt;T&gt;, response: Response&lt;T&gt;) {</span><br><span class=\"line\">        if (response.isSuccessful) {</span><br><span class=\"line\">          // 1. &#x62FF;&#x5230;body</span><br><span class=\"line\">          val body = response.body()</span><br><span class=\"line\">          if (body == null) {</span><br><span class=\"line\">            val invocation = call.request().tag(Invocation::class.java)!!</span><br><span class=\"line\">            val method = invocation.method()</span><br><span class=\"line\">            val e = KotlinNullPointerException(&quot;Response from &quot; +</span><br><span class=\"line\">                method.declaringClass.name +</span><br><span class=\"line\">                &apos;.&apos; +</span><br><span class=\"line\">                method.name +</span><br><span class=\"line\">                &quot; was null but response body type was declared as non-null&quot;)</span><br><span class=\"line\">            // 2. body&#x4E3A;&#x7A7A;&#xFF0C;&#x5524;&#x8D77;&#x534F;&#x7A0B;&#xFF0C;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span><br><span class=\"line\">            continuation.resumeWithException(e)</span><br><span class=\"line\">          } else {</span><br><span class=\"line\">            // 3. &#x5524;&#x8D77;&#x534F;&#x7A0B;&#xFF0C;&#x8FD4;&#x56DE;body</span><br><span class=\"line\">            continuation.resume(body)</span><br><span class=\"line\">          }</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">          // 4. &#x5524;&#x8D77;&#x534F;&#x7A0B;&#xFF0C;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span><br><span class=\"line\">          continuation.resumeWithException(HttpException(response))</span><br><span class=\"line\">        }</span><br><span class=\"line\">      }</span><br><span class=\"line\"> </span><br><span class=\"line\">      override fun onFailure(call: Call&lt;T&gt;, t: Throwable) {</span><br><span class=\"line\">        // 5. &#x5524;&#x8D77;&#x534F;&#x7A0B;&#xFF0C;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span><br><span class=\"line\">        continuation.resumeWithException(t)</span><br><span class=\"line\">      }</span><br><span class=\"line\">    })</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x770B;&#x5230;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x53EF;&#x80FD;&#x6709;&#x7684;&#x8BFB;&#x8005;&#x5F88;&#x719F;&#x6089;&#xFF0C;&#x5DF2;&#x7ECF;&#x660E;&#x767D;&#x4E86;&#x5B83;&#x7684;&#x8F6C;&#x5316;&#x3002;&#x56E0;&#x4E3A;&#x5728;Retrofit&#x4E4B;&#x524D;&#x7684;&#x51E0;&#x4E2A;&#x7248;&#x672C;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#x662F;&#x4E0D;&#x652F;&#x6301;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;model&#x7684;&#xFF0C;&#x9700;&#x8981;&#x8FD4;&#x56DE;Call<t>&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x3002;&#x6240;&#x4EE5;&#x5F53;&#x65F6;&#x6709;&#x7684;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x7C7B;&#x4F3C;&#x7684;extensions&#x65B9;&#x6CD5;&#x6765;&#x8F6C;&#x5316;&#x6210;&#x5BF9;&#x5E94;&#x7684;model&#x3002;</t></p>\n<p>&#x9057;&#x61BE;&#x7684;&#x662F;&#xFF0C;&#x5C31;&#x662F;&#x4F7F;&#x7528;&#x4E86;Retrofit&#x7684;Version 2.6.0&#x4E4B;&#x540E;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x6211;&#x8FD8;&#x662F;&#x770B;&#x5230;&#x6709;&#x7684;&#x4EBA;&#x4F7F;&#x7528;&#x8FD9;&#x4E00;&#x5957;&#x6765;&#x81EA;&#x5DF1;&#x8F6C;&#x5316;&#xFF0C;&#x5E0C;&#x671B;&#x770B;&#x5230;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x8BFB;&#x8005;&#x4E0D;&#x8981;&#x518D;&#x505A;&#x91CD;&#x590D;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x5C06;&#x5176;&#x4EA4;&#x7ED9;Retrofit&#x81EA;&#x8EAB;&#x6765;&#x505A;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p>\n<p>&#x4E0A;&#x9762;&#x7684;extensions&#x4F5C;&#x7528;&#x5C31;&#x4E00;&#x4E2A;&#xFF0C;&#x901A;&#x8FC7;suspendCancellableCoroutine&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x534F;&#x7A0B;&#xFF0C;&#x5B83;&#x662F;&#x534F;&#x7A0B;&#x4E2D;&#x51E0;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x521B;&#x5EFA;&#x534F;&#x7A0B;&#x7684;&#x65B9;&#x6CD5;&#x4E4B;&#x4E00;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x7EC6;&#x8BF4;&#xFF0C;&#x540E;&#x7EED;&#x5F00;&#x534F;&#x7A0B;&#x7CFB;&#x5217;&#x5728;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#x3002;</p>\n<p>&#x4E3B;&#x8981;&#x662F;onResponse&#x56DE;&#x8C03;&#xFF0C;&#x534F;&#x7A0B;&#x901A;&#x8FC7;&#x6302;&#x8D77;&#x6765;&#x6267;&#x884C;&#x8017;&#x65F6;&#x4EFB;&#x52A1;&#xFF0C;&#x800C;&#x6210;&#x529F;&#x4E0E;&#x5931;&#x8D25;&#x4F1A;&#x5206;&#x522B;&#x901A;&#x8FC7;resume()&#x4E0E;resumeWithExecption()&#x6765;&#x5524;&#x8D77;&#x6302;&#x8D77;&#x7684;&#x534F;&#x7A0B;&#xFF0C;&#x8BA9;&#x5B83;&#x8FD4;&#x56DE;&#x4E4B;&#x524D;&#x7684;&#x6302;&#x8D77;&#x70B9;&#xFF0C;&#x8FDB;&#x884C;&#x6267;&#x884C;&#x3002;&#x800C;resumeWithExecption()&#x5185;&#x90E8;&#x4E5F;&#x662F;&#x8C03;&#x7528;&#x4E86;resume()&#xFF0C;&#x6240;&#x4EE5;&#x534F;&#x7A0B;&#x7684;&#x5524;&#x8D77;&#x90FD;&#x662F;&#x901A;&#x8FC7;resume()&#x6765;&#x64CD;&#x4F5C;&#x7684;&#x3002;&#x8C03;&#x7528;resume()&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x8C03;&#x7528;&#x534F;&#x7A0B;&#x7684;&#x5730;&#x65B9;&#x8FD4;&#x56DE;&#x8BF7;&#x6C42;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x90A3;&#x4E48;&#x4E00;&#x4E2A;&#x5B8C;&#x7F8E;&#x7684;&#x534F;&#x7A0B;&#x63A5;&#x53E3;&#x8C03;&#x7528;&#x5C31;&#x662F;&#x8FD9;&#x6837;&#x5B9E;&#x73B0;&#x7684;&#x3002;</p>\n<p>&#x55EF;&#xFF0C;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x6574;&#x7406;&#x4E00;&#x4E0B;&#x4E5F;&#x4E0D;&#x662F;&#x5F88;&#x590D;&#x6742;&#x5427;&#x3002;&#x4E4B;&#x540E;&#x4F7F;&#x7528;Retroift&#x5199;&#x534F;&#x7A0B;&#x65F6;&#x5C06;&#x901A;&#x7545;&#x591A;&#x4E86;&#x3002;</p>\n<p>&#x4ECA;&#x5929;&#x5C31;&#x8FD9;&#x6837;&#x5427;&#xFF0C;&#x534F;&#x7A0B;&#x90E8;&#x5206;&#x5C31;&#x5206;&#x6790;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;Retrofit&#x7684;&#x6574;&#x4E2A;&#x534F;&#x7A0B;&#x5B9E;&#x73B0;&#x90E8;&#x5206;&#x5C31;&#x5206;&#x6790;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x6211;&#x5C06;&#x5173;&#x952E;&#x70B9;&#x90FD;&#x7279;&#x522B;&#x8FDB;&#x884C;&#x4E86;&#x6807;&#x6CE8;&#x4E0E;&#x8BF4;&#x660E;&#xFF0C;&#x5E0C;&#x671B;&#x5BF9;&#x5206;&#x6790;Retrofit&#x7684;&#x534F;&#x7A0B;&#x5B9E;&#x73B0;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#x3002;</p>\n<p>&#x6700;&#x540E;&#xFF0C;&#x611F;&#x8C22;&#x4F60;&#x7684;&#x9605;&#x8BFB;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x6709;&#x65F6;&#x95F4;&#x7684;&#x8BDD;&#xFF0C;&#x63A8;&#x8350;&#x5E26;&#x7740;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x518D;&#x53BB;&#x9605;&#x8BFB;&#x4E00;&#x4E0B;&#x6E90;&#x7801;&#xFF0C;&#x4F60;&#x5C06;&#x4F1A;&#x6709;&#x66F4;&#x6DF1;&#x523B;&#x7684;&#x5370;&#x8C61;&#x3002;</p>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x559C;&#x6B22;&#x6211;&#x7684;&#x6587;&#x7AE0;&#x6A21;&#x5F0F;&#xFF0C;&#x6216;&#x8005;&#x5BF9;&#x6211;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x6587;&#x7AE0;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x6211;&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF1A;&#x3010;Android&#x8865;&#x7ED9;&#x7AD9;&#x3011;</p>\n<p>&#x6216;&#x8005;&#x626B;&#x63CF;&#x4E0B;&#x65B9;&#x4E8C;&#x7EF4;&#x7801;&#xFF0C;&#x4E0E;&#x6211;&#x5EFA;&#x7ACB;&#x6709;&#x6548;&#x7684;&#x6C9F;&#x901A;&#xFF0C;&#x540C;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x65B9;&#x4FBF;&#x7684;&#x6536;&#x5230;&#x76F8;&#x5173;&#x7684;&#x6280;&#x672F;&#x63A8;&#x9001;&#x3002;</p>\n<p><img src=\"/2020/09/20/&#x91CD;&#x6E29;Retrofit&#x6E90;&#x7801;&#xFF0C;&#x7B11;&#x770B;&#x534F;&#x7A0B;&#x5B9E;&#x73B0;/Android&#x8865;&#x7ED9;&#x7AD9;.jpg\" alt></p>\n","categories":["android"],"tags":["coroutine"]},{"title":"Android Startup实现分析","url":"https://www.rousetime.com/2020/09/09/Android-Startup实现分析/","content":"<h2 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">Android Startup</a>&#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#x3002;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Android Startup&#x6765;&#x7B80;&#x5316;&#x542F;&#x52A8;&#x5E8F;&#x5217;&#xFF0C;&#x5E76;&#x663E;&#x5F0F;&#x5730;&#x8BBE;&#x7F6E;&#x521D;&#x59CB;&#x5316;&#x987A;&#x5E8F;&#x4E0E;&#x7EC4;&#x4EF6;&#x4E4B;&#x95F4;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x3002; &#x4E0E;&#x6B64;&#x540C;&#x65F6;&#xFF0C;Android Startup&#x652F;&#x6301;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#x3001;&#x624B;&#x52A8;&#x63A7;&#x5236;&#x4F9D;&#x8D56;&#x6267;&#x884C;&#x65F6;&#x673A;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x6709;&#x5411;&#x65E0;&#x73AF;&#x56FE;&#x62D3;&#x6251;&#x6392;&#x5E8F;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x4FDD;&#x8BC1;&#x5185;&#x90E8;&#x4F9D;&#x8D56;&#x7EC4;&#x4EF6;&#x7684;&#x521D;&#x59CB;&#x5316;&#x987A;&#x5E8F;&#x3002;</p>\n<p>Android Startup&#x7ECF;&#x8FC7;&#x51E0;&#x8F6E;&#x7684;&#x8FED;&#x4EE3;&#x5DF2;&#x7ECF;&#x66F4;&#x52A0;&#x5B8C;&#x5584;&#x4E86;&#xFF0C;&#x652F;&#x6301;&#x7684;&#x529F;&#x80FD;&#x573A;&#x666F;&#x4E5F;&#x66F4;&#x52A0;&#x591A;&#x6837;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8981;&#x4F7F;&#x7528;Android Startup&#x7684;&#x65B0;&#x7279;&#x6027;&#xFF0C;&#x8BF7;&#x5C06;&#x4F9D;&#x8D56;&#x5347;&#x7EA7;&#x5230;&#x6700;&#x65B0;&#x7248;&#x672C;<a href=\"https://github.com/idisfkj/android-startup/releases\" target=\"_blank\" rel=\"noopener\">latest release</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    implementation &apos;com.rousetime.android:android-startup:latest release&apos;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x4E4B;&#x524D;&#x7684;<a href=\"https://juejin.im/post/6859500445669752846\" target=\"_blank\" rel=\"noopener\">&#x6211;&#x4E3A;&#x4F55;&#x5F03;&#x7528;Jetpack&#x7684;App Startup?</a>&#x6587;&#x7AE0;&#x4E2D;&#x6709;&#x63D0;&#x4F9B;&#x4E00;&#x5F20;&#x4E0E;App Startup&#x7684;&#x5BF9;&#x6BD4;&#x56FE;&#xFF0C;&#x73B0;&#x5728;&#x4E5F;&#x6709;&#x4E86;&#x4E00;&#x70B9;&#x53D8;&#x5316;</p>\n<p><img src=\"/2020/09/09/Android-Startup&#x5B9E;&#x73B0;&#x5206;&#x6790;/1.jpg\" alt><br>&#x6838;&#x5FC3;&#x5185;&#x5BB9;&#x90FD;&#x5728;&#x8FD9;&#x79CD;&#x5BF9;&#x6BD4;&#x56FE;&#x4E2D;&#xFF0C;&#x4E0B;&#x9762;&#x6839;&#x636E;&#x8FD9;&#x79CD;&#x5BF9;&#x6BD4;&#x56FE;&#x6765;&#x8BE6;&#x7EC6;&#x5206;&#x6790;&#x4E00;&#x4E0B;Android Startup&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x3002;</p>\n<h2 id=\"&#x914D;&#x7F6E;\"><a href=\"#&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;\"></a>&#x914D;&#x7F6E;</h2><h3 id=\"&#x624B;&#x52A8;\"><a href=\"#&#x624B;&#x52A8;\" class=\"headerlink\" title=\"&#x624B;&#x52A8;\"></a>&#x624B;&#x52A8;</h3><p>&#x624B;&#x52A8;&#x914D;&#x7F6E;&#x662F;&#x901A;&#x8FC7;<a href=\"https://github.com/idisfkj/android-startup/blob/master/android-startup/src/main/java/com/rousetime/android_startup/StartupManager.kt\" target=\"_blank\" rel=\"noopener\">StartupManager.Builder()</a>&#x6765;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x672C;&#x8D28;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4F7F;&#x7528;builder&#x6A21;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E9B;&#x5FC5;&#x8981;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x8FDB;&#x800C;&#x6765;&#x83B7;&#x53D6;StartupManager&#x5B9E;&#x4F8B;&#xFF0C;&#x6700;&#x540E;&#x518D;&#x542F;&#x52A8;Android Startup&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val config = StartupConfig.Builder()</span><br><span class=\"line\">    .setLoggerLevel(LoggerLevel.DEBUG)</span><br><span class=\"line\">    .setAwaitTimeout(12000L)</span><br><span class=\"line\">    .setListener(object : StartupListener {</span><br><span class=\"line\">        override fun onCompleted(totalMainThreadCostTime: Long, costTimesModels: List&lt;CostTimesModel&gt;) {</span><br><span class=\"line\">            // can to do cost time statistics.</span><br><span class=\"line\">            costTimesLiveData.value = costTimesModels</span><br><span class=\"line\">            Log.d(&quot;StartupTrack&quot;, &quot;onCompleted: ${costTimesModels.size}&quot;)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    })</span><br><span class=\"line\">    .build()</span><br><span class=\"line\"> </span><br><span class=\"line\">StartupManager.Builder()</span><br><span class=\"line\">    .setConfig(config)</span><br><span class=\"line\">    .addStartup(SampleFirstStartup())</span><br><span class=\"line\">    .addStartup(SampleSecondStartup())</span><br><span class=\"line\">    .addStartup(SampleThirdStartup())</span><br><span class=\"line\">    .addStartup(SampleFourthStartup())</span><br><span class=\"line\">    .build(this)</span><br><span class=\"line\">    .start()</span><br><span class=\"line\">    .await()</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x81EA;&#x52A8;\"><a href=\"#&#x81EA;&#x52A8;\" class=\"headerlink\" title=\"&#x81EA;&#x52A8;\"></a>&#x81EA;&#x52A8;</h3><p>&#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x81EA;&#x52A8;&#x914D;&#x7F6E;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x4E0D;&#x9700;&#x8981;&#x624B;&#x52A8;&#x8C03;&#x7528;StartupManager.Builder()&#xFF0C;&#x53EA;&#x9700;&#x5728;AndroidManifest.xml&#x6587;&#x4EF6;&#x4E2D;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;provider</span><br><span class=\"line\">     android:name=&quot;com.rousetime.android_startup.provider.StartupProvider&quot;</span><br><span class=\"line\">    android:authorities=&quot;${applicationId}.android_startup&quot;</span><br><span class=\"line\">    android:exported=&quot;false&quot;&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;meta-data</span><br><span class=\"line\">        android:name=&quot;com.rousetime.sample.startup.SampleStartupProviderConfig&quot;</span><br><span class=\"line\">        android:value=&quot;android.startup.provider.config&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;meta-data</span><br><span class=\"line\">        android:name=&quot;com.rousetime.sample.startup.SampleFourthStartup&quot;</span><br><span class=\"line\">        android:value=&quot;android.startup&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;/provider&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x800C;&#x5B9E;&#x73B0;&#x8FD9;&#x79CD;&#x914D;&#x7F6E;&#x7684;&#x539F;&#x7406;&#x662F;&#xFF1A;Android Startup&#x5185;&#x90E8;&#x662F;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;ContentProvider&#x6765;&#x5B9E;&#x73B0;&#x81EA;&#x52A8;&#x914D;&#x7F6E;&#x7684;&#xFF0C;&#x5728;Android&#x4E2D;ContentProvider&#x7684;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x673A;&#x4ECB;&#x4E8E;Application&#x7684;attachBaseContext&#x4E0E;onCreate&#x4E4B;&#x95F4;&#x3002;&#x6240;&#x4EE5;Android Startup&#x501F;&#x52A9;&#x8FD9;&#x4E00;&#x7279;&#x6027;&#x5C06;&#x521D;&#x59CB;&#x5316;&#x7684;&#x903B;&#x8F91;&#x90FD;&#x5C01;&#x88C5;&#x5230;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<a href=\"https://github.com/idisfkj/android-startup/blob/master/android-startup/src/main/java/com/rousetime/android_startup/provider/StartupProvider.kt\" target=\"_blank\" rel=\"noopener\">StartupProvider</a>&#x4E2D;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class StartupProvider : ContentProvider() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun onCreate(): Boolean {</span><br><span class=\"line\">        context.takeIf { context -&gt; context != null }?.let {</span><br><span class=\"line\">            val store = StartupInitializer.instance.discoverAndInitialize(it)</span><br><span class=\"line\">            StartupManager.Builder()</span><br><span class=\"line\">                .setConfig(store.config?.getConfig())</span><br><span class=\"line\">                .addAllStartup(store.result)</span><br><span class=\"line\">                .build(it)</span><br><span class=\"line\">                .start()</span><br><span class=\"line\">                .await()</span><br><span class=\"line\">        } ?: throw StartupException(&quot;Context cannot be null.&quot;)</span><br><span class=\"line\"> </span><br><span class=\"line\">        return true</span><br><span class=\"line\">    }</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6709;&#x4E86;StartupProvider&#x4E4B;&#x540E;&#xFF0C;&#x4E0B;&#x4E00;&#x6B65;&#x9700;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x89E3;&#x6790;&#x5728;AndroidManife.xml&#x7684;provider&#x6807;&#x7B7E;&#x4E0B;&#x6240;&#x914D;&#x7F6E;&#x7684;Startup&#x4E0E;Config&#x3002;</p>\n<p>&#x6709;&#x5173;&#x89E3;&#x6790;&#x7684;&#x90E8;&#x5206;&#x90FD;&#x5728;<a href=\"https://github.com/idisfkj/android-startup/blob/master/android-startup/src/main/java/com/rousetime/android_startup/StartupInitializer.kt\" target=\"_blank\" rel=\"noopener\">StartupInitializer</a>&#x7C7B;&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;&#x5B83;&#x7684;discoverAndInitialize()&#x65B9;&#x6CD5;&#x5C31;&#x80FD;&#x83B7;&#x53D6;&#x5230;&#x89E3;&#x6790;&#x7684;&#x6570;&#x636E;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">internal fun discoverAndInitialize(context: Context): StartupProviderStore {</span><br><span class=\"line\"> </span><br><span class=\"line\">    TraceCompat.beginSection(StartupInitializer::class.java.simpleName)</span><br><span class=\"line\"> </span><br><span class=\"line\">    val result = mutableListOf&lt;AndroidStartup&lt;*&gt;&gt;()</span><br><span class=\"line\">    val initialize = mutableListOf&lt;String&gt;()</span><br><span class=\"line\">    val initialized = mutableListOf&lt;String&gt;()</span><br><span class=\"line\">    var config: StartupProviderConfig? = null</span><br><span class=\"line\">    try {</span><br><span class=\"line\">        val provider = ComponentName(context.packageName, StartupProvider::class.java.name)</span><br><span class=\"line\">        val providerInfo = context.packageManager.getProviderInfo(provider, PackageManager.GET_META_DATA)</span><br><span class=\"line\">        val startup = context.getString(R.string.android_startup)</span><br><span class=\"line\">        val providerConfig = context.getString(R.string.android_startup_provider_config)</span><br><span class=\"line\">        providerInfo.metaData?.let { metaData -&gt;</span><br><span class=\"line\">            metaData.keySet().forEach { key -&gt;</span><br><span class=\"line\">                val value = metaData[key]</span><br><span class=\"line\">                val clazz = Class.forName(key)</span><br><span class=\"line\">                if (startup == value) {</span><br><span class=\"line\">                    if (AndroidStartup::class.java.isAssignableFrom(clazz)) {</span><br><span class=\"line\">                        doInitialize((clazz.getDeclaredConstructor().newInstance() as AndroidStartup&lt;*&gt;), result, initialize, initialized)</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                } else if (providerConfig == value) {</span><br><span class=\"line\">                    if (StartupProviderConfig::class.java.isAssignableFrom(clazz)) {</span><br><span class=\"line\">                        config = clazz.getDeclaredConstructor().newInstance() as? StartupProviderConfig</span><br><span class=\"line\">                        // save initialized config</span><br><span class=\"line\">                        StartupCacheManager.instance.saveConfig(config?.getConfig())</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    } catch (t: Throwable) {</span><br><span class=\"line\">        throw StartupException(t)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    TraceCompat.endSection()</span><br><span class=\"line\"> </span><br><span class=\"line\">    return StartupProviderStore(result, config)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6838;&#x5FC3;&#x903B;&#x8F91;&#x662F;&#xFF1A;</p>\n<ol>\n<li>&#x901A;&#x8FC7;ComponentName()&#x83B7;&#x53D6;&#x6307;&#x5B9A;&#x7684;StartupProvider</li>\n<li>&#x901A;&#x8FC7;getProviderInfo()&#x83B7;&#x53D6;&#x5BF9;&#x5E94;StartupProvider&#x4E0B;&#x7684;meta-data&#x6570;&#x636E;</li>\n<li>&#x904D;&#x5386;meta-data&#x6570;&#x7EC4;</li>\n<li>&#x6839;&#x636E;&#x4E8B;&#x5148;&#x9884;&#x5B9A;&#x7684;value&#x6765;&#x5339;&#x914D;&#x5BF9;&#x5E94;&#x7684;name</li>\n<li>&#x6700;&#x7EC8;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x6765;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;name&#x7684;&#x5B9E;&#x4F8B;</li>\n</ol>\n<p>&#x5176;&#x4E2D;&#x5728;&#x89E3;&#x6790;Statup&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x51CF;&#x5C11;Statup&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x4F7F;&#x7528;doInitialize()&#x65B9;&#x6CD5;&#x6765;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x4F9D;&#x8D56;&#x7684;Startup&#xFF0C;&#x5E76;&#x4E14;&#x63D0;&#x524D;&#x5BF9;&#x5FAA;&#x73AF;&#x4F9D;&#x8D56;&#x8FDB;&#x884C;&#x68C0;&#x67E5;&#x3002;</p>\n<h2 id=\"&#x4F9D;&#x8D56;&#x652F;&#x6301;\"><a href=\"#&#x4F9D;&#x8D56;&#x652F;&#x6301;\" class=\"headerlink\" title=\"&#x4F9D;&#x8D56;&#x652F;&#x6301;\"></a>&#x4F9D;&#x8D56;&#x652F;&#x6301;</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * Returns a list of the other [Startup] objects that the initializer depends on.</span><br><span class=\"line\"> */</span><br><span class=\"line\">fun dependencies(): List&lt;Class&lt;out Startup&lt;*&gt;&gt;&gt;?</span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Called whenever there is a dependency completion.</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * @param [startup] dependencies [startup].</span><br><span class=\"line\"> * @param [result] of dependencies startup.</span><br><span class=\"line\"> */</span><br><span class=\"line\">fun onDependenciesCompleted(startup: Startup&lt;*&gt;, result: Any?)</span><br></pre></td></tr></table></figure>\n<p>&#x67D0;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x7684;&#x7EC4;&#x4EF6;&#x5728;&#x521D;&#x59CB;&#x5316;&#x4E4B;&#x524D;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x7EC4;&#x4EF6;&#x90FD;&#x5FC5;&#x987B;&#x901A;&#x8FC7;dependencies()&#x8FDB;&#x884C;&#x7533;&#x660E;&#x3002;&#x7533;&#x660E;&#x4E4B;&#x540E;&#x4F1A;&#x5728;&#x540E;&#x7EED;&#x8FDB;&#x884C;&#x89E3;&#x6790;&#xFF0C;&#x4FDD;&#x8BC1;&#x4F9D;&#x8D56;&#x7684;&#x7EC4;&#x4EF6;&#x4F18;&#x5148;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#xFF1B;&#x540C;&#x65F6;&#x4F9D;&#x8D56;&#x7684;&#x7EC4;&#x4EF6;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x4F1A;&#x56DE;&#x8C03;onDependenciesCompleted()&#x65B9;&#x6CD5;&#x3002;&#x6267;&#x884C;&#x987A;&#x5E8F;&#x5219;&#x662F;&#x901A;&#x8FC7;&#x6709;&#x5411;&#x56FE;&#x62D3;&#x6251;&#x6392;&#x5E8F;&#x51B3;&#x5B9A;&#x7684;&#x3002;</p>\n<h2 id=\"&#x95ED;&#x73AF;&#x5904;&#x7406;\"><a href=\"#&#x95ED;&#x73AF;&#x5904;&#x7406;\" class=\"headerlink\" title=\"&#x95ED;&#x73AF;&#x5904;&#x7406;\"></a>&#x95ED;&#x73AF;&#x5904;&#x7406;</h2><p>&#x6709;&#x5173;&#x95ED;&#x73AF;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x4E00;&#x65B9;&#x9762;&#x4F1A;&#x5728;&#x81EA;&#x52A8;&#x914D;&#x7F6E;&#x73AF;&#x8282;&#x7684;doInitialize()&#x65B9;&#x6CD5;&#x4E2D;&#x4F1A;&#x8FDB;&#x884C;&#x5904;&#x7406;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private fun doInitialize(</span><br><span class=\"line\">    startup: AndroidStartup&lt;*&gt;,</span><br><span class=\"line\">    result: MutableList&lt;AndroidStartup&lt;*&gt;&gt;,</span><br><span class=\"line\">    initialize: MutableList&lt;String&gt;,</span><br><span class=\"line\">    initialized: MutableList&lt;String&gt;</span><br><span class=\"line\">) {</span><br><span class=\"line\">    try {</span><br><span class=\"line\">        val uniqueKey = startup::class.java.getUniqueKey()</span><br><span class=\"line\">        if (initialize.contains(uniqueKey)) {</span><br><span class=\"line\">            throw IllegalStateException(&quot;have circle dependencies.&quot;)</span><br><span class=\"line\">        }</span><br><span class=\"line\">        if (!initialized.contains(uniqueKey)) {</span><br><span class=\"line\">            initialize.add(uniqueKey)</span><br><span class=\"line\">            result.add(startup)</span><br><span class=\"line\">            startup.dependencies()?.forEach {</span><br><span class=\"line\">                doInitialize(it.getDeclaredConstructor().newInstance() as AndroidStartup&lt;*&gt;, result, initialize, initialized)</span><br><span class=\"line\">            }</span><br><span class=\"line\">            initialize.remove(uniqueKey)</span><br><span class=\"line\">            initialized.add(uniqueKey)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    } catch (t: Throwable) {</span><br><span class=\"line\">        throw StartupException(t)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5C06;&#x5F53;&#x524D;Startup&#x52A0;&#x5165;&#x5230;initialize&#x4E2D;&#xFF0C;&#x540C;&#x65F6;&#x904D;&#x5386;dependencies()&#x4F9D;&#x8D56;&#x6570;&#x7EC4;&#xFF0C;&#x9012;&#x5F52;&#x8C03;&#x7528;doInitialize()&#x3002;</p>\n<p>&#x5728;&#x9012;&#x5F52;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x5728;initialize&#x4E2D;&#x5B58;&#x5728;&#x5BF9;&#x5E94;&#x7684;uniqueKey(&#x8FD9;&#x91CC;&#x4E3A;Startup&#x7684;&#x552F;&#x4E00;&#x6807;&#x8BC6;)&#x5219;&#x4EE3;&#x8868;&#x53D1;&#x9001;&#x7684;&#x4E92;&#x76F8;&#x4F9D;&#x8D56;&#xFF0C;&#x5373;&#x5B58;&#x5728;&#x4F9D;&#x8D56;&#x73AF;&#x3002;</p>\n<p>&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x518D;&#x540E;&#x7EED;&#x7684;&#x6709;&#x5411;&#x56FE;&#x62D3;&#x6251;&#x6392;&#x5E8F;&#x4F18;&#x5316;&#x4E5F;&#x4F1A;&#x8FDB;&#x884C;&#x73AF;&#x5904;&#x7406;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun sort(startupList: List&lt;Startup&lt;*&gt;&gt;): StartupSortStore {</span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (mainResult.size + ioResult.size != startupList.size) {</span><br><span class=\"line\">        throw StartupException(&quot;lack of dependencies or have circle dependencies.&quot;)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x6392;&#x5E8F;&#x4F18;&#x5316;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F1A;&#x5C06;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x4E0E;&#x975E;&#x4E3B;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x7684;Startup&#x8FDB;&#x884C;&#x5206;&#x7C7B;&#xFF0C;&#x518D;&#x5206;&#x7C7B;&#x8FC7;&#x7A0B;&#x4E2D;&#x5E76;&#x4E0D;&#x4F1A;&#x8FDB;&#x884C;&#x6392;&#x91CD;&#x5904;&#x7406;&#xFF0C;&#x53EA;&#x5173;&#x6CE8;&#x5F53;&#x524D;&#x7684;Startup&#x662F;&#x5426;&#x518D;&#x4E3B;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x3002;&#x6240;&#x4EE5;&#x6700;&#x540E;&#x53EA;&#x8981;&#x8FD9;&#x4E24;&#x79CD;&#x5206;&#x7C7B;&#x7684;&#x5927;&#x5C0F;&#x4E4B;&#x548C;&#x4E0D;&#x7B49;&#x4E8E;Startup&#x7684;&#x603B;&#x548C;&#x5C31;&#x4EE3;&#x8868;&#x5B58;&#x5728;&#x73AF;&#xFF0C;&#x5373;&#x6709;&#x4E92;&#x76F8;&#x4F9D;&#x8D56;&#x3002;</p>\n<h2 id=\"&#x7EBF;&#x7A0B;&#x5904;&#x7406;\"><a href=\"#&#x7EBF;&#x7A0B;&#x5904;&#x7406;\" class=\"headerlink\" title=\"&#x7EBF;&#x7A0B;&#x5904;&#x7406;\"></a>&#x7EBF;&#x7A0B;&#x5904;&#x7406;</h2><p>&#x7EBF;&#x7A0B;&#x65B9;&#x9762;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;<a href=\"https://github.com/idisfkj/android-startup/blob/master/android-startup/src/main/java/com/rousetime/android_startup/executor/StartupExecutor.kt\" target=\"_blank\" rel=\"noopener\">StartupExecutor</a>&#x63A5;&#x53E3;&#xFF0C; &#x5728;AndroidStartup&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x4E86;&#x5B83;&#x7684;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;createExecutor()</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun createExecutor(): Executor = ExecutorManager.instance.ioExecutor</span><br></pre></td></tr></table></figure>\n<p>&#x5728;<a href=\"https://github.com/idisfkj/android-startup/blob/master/android-startup/src/main/java/com/rousetime/android_startup/executor/ExecutorManager.kt\" target=\"_blank\" rel=\"noopener\">ExecutorManager</a>&#x4E2D;&#x63D0;&#x4F9B;&#x4E86;&#x4E09;&#x79CD;&#x7EBF;&#x7A0B;&#x5206;&#x522B;&#x4E3A;</p>\n<ol>\n<li>cpuExecutor: cpu&#x4F7F;&#x7528;&#x9891;&#x7387;&#x9AD8;&#xFF0C;&#x9AD8;&#x901F;&#x8BA1;&#x7B97;&#xFF1B;&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5927;&#x5C0F;&#x4E0E;cpu&#x6838;&#x6570;&#x76F8;&#x5173;&#x3002;</li>\n<li>ioExecutor: io&#x64CD;&#x4F5C;&#xFF0C;&#x7F51;&#x7EDC;&#x5904;&#x7406;&#x7B49;&#xFF1B;&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x7EBF;&#x7A0B;&#x6C60;&#x3002;</li>\n<li>mainExecutor: &#x4E3B;&#x7EBF;&#x7A0B;&#x3002;</li>\n</ol>\n<p>&#x6240;&#x4EE5;&#x5982;&#x679C;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x9ED8;&#x8BA4;&#x7EBF;&#x7A0B;&#xFF0C;&#x53EF;&#x4EE5;&#x91CD;&#x5199;createExecutor()&#x65B9;&#x6CD5;&#x3002;</p>\n<h2 id=\"&#x5F02;&#x6B65;&#x7B49;&#x5F85;\"><a href=\"#&#x5F02;&#x6B65;&#x7B49;&#x5F85;\" class=\"headerlink\" title=\"&#x5F02;&#x6B65;&#x7B49;&#x5F85;\"></a>&#x5F02;&#x6B65;&#x7B49;&#x5F85;</h2><p>&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4F9D;&#x8D56;&#x652F;&#x6301;&#x90E8;&#x5206;&#x5DF2;&#x7ECF;&#x63D0;&#x5230;&#x4F7F;&#x7528;dependencies()&#x6765;&#x8BBE;&#x7F6E;&#x4F9D;&#x8D56;&#x7684;&#x7EC4;&#x4EF6;&#x3002;&#x6BCF;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#x80FD;&#x591F;&#x6267;&#x884C;&#x7684;&#x524D;&#x63D0;&#x662F;&#x5B83;&#x81EA;&#x8EAB;&#x7684;&#x4F9D;&#x8D56;&#x7EC4;&#x4EF6;&#x5168;&#x90E8;&#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x662F;&#x540C;&#x6B65;&#x4F9D;&#x8D56;&#xFF0C;&#x81EA;&#x7136;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x6309;&#x7167;&#x4F9D;&#x8D56;&#x7684;&#x987A;&#x5E8F;&#x4F9D;&#x6B21;&#x6267;&#x884C;&#x5373;&#x53EF;&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x5F02;&#x6B65;&#x4F9D;&#x8D56;&#x4EFB;&#x52A1;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x6240;&#x6709;&#x7684;&#x5F02;&#x6B65;&#x4F9D;&#x8D56;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#xFF0C;&#x5F53;&#x524D;&#x7EC4;&#x4EF6;&#x624D;&#x80FD;&#x6B63;&#x5E38;&#x6267;&#x884C;&#x3002;</p>\n<p>&#x5728;Android Startup&#x501F;&#x52A9;&#x4E86;CountDownLatch&#x6765;&#x4FDD;&#x8BC1;&#x5F02;&#x6B65;&#x4F9D;&#x8D56;&#x7684;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x76D1;&#x542C;&#x3002;</p>\n<p>CountDownLatch&#x5B57;&#x9762;&#x610F;&#x601D;&#x5C31;&#x662F;&#x5012;&#x8BA1;&#x65F6;&#x9501;&#xFF0C;&#x5B83;&#x662F;&#x4F5C;&#x7528;&#x4E8E;&#x7EBF;&#x7A0B;&#x4E2D;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x4F1A;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;count&#x5927;&#x5C0F;&#x7684;&#x5012;&#x8BA1;&#x65F6;&#xFF0C;&#x901A;&#x8FC7;await()&#x6765;&#x7B49;&#x5F85;&#x5012;&#x8BA1;&#x65F6;&#x7684;&#x7ED3;&#x675F;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x5012;&#x8BA1;&#x65F6;&#x7684;&#x6570;&#x503C;&#x51CF;&#x5C11;&#x662F;&#x901A;&#x8FC7;&#x624B;&#x52A8;&#x8C03;&#x7528;countDown()&#x6765;&#x89E6;&#x53D1;&#x7684;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x5728;&#x62BD;&#x8C61;&#x7C7B;AndroidStartup&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;await()&#x4E0E;countDown()&#x6765;&#x4FDD;&#x8BC1;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x7684;&#x51C6;&#x786E;&#x6267;&#x884C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">abstract class AndroidStartup&lt;T&gt; : Startup&lt;T&gt; {</span><br><span class=\"line\"> </span><br><span class=\"line\">    private val mWaitCountDown by lazy { CountDownLatch(dependencies()?.size ?: 0) }</span><br><span class=\"line\">    private val mObservers by lazy { mutableListOf&lt;Dispatcher&gt;() }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun toWait() {</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            mWaitCountDown.await()</span><br><span class=\"line\">        } catch (e: InterruptedException) {</span><br><span class=\"line\">            e.printStackTrace()</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun toNotify() {</span><br><span class=\"line\">        mWaitCountDown.countDown()</span><br><span class=\"line\">    }</span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x901A;&#x8FC7;toWait()&#x65B9;&#x6CD5;&#x6765;&#x7B49;&#x5F85;&#x4F9D;&#x8D56;&#x7EC4;&#x4EF6;&#x7684;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#xFF0C;&#x800C;&#x4F9D;&#x8D56;&#x7684;&#x7EC4;&#x4EF6;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#xFF0C;&#x901A;&#x8FC7;toNotify()&#x6765;&#x901A;&#x77E5;&#x5F53;&#x524D;&#x7EC4;&#x4EF6;&#xFF0C;&#x4E00;&#x65E6;&#x6240;&#x6709;&#x7684;&#x4F9D;&#x8D56;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x91CA;&#x653E;&#x5F53;&#x524D;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x4F7F;&#x5B83;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x4E0B;&#x53BB;&#x3002;</p>\n<p>&#x800C;toWait()&#x4E0E;toNotify()&#x7684;&#x5177;&#x4F53;&#x8C03;&#x7528;&#x65F6;&#x673A;&#x5206;&#x522B;&#x5728;<a href=\"https://github.com/idisfkj/android-startup/blob/master/android-startup/src/main/java/com/rousetime/android_startup/run/StartupRunnable.kt\" target=\"_blank\" rel=\"noopener\">StartupRunnable</a>&#x4E0E;<a href=\"https://github.com/idisfkj/android-startup/blob/master/android-startup/src/main/java/com/rousetime/android_startup/dispatcher/StartupManagerDispatcher.kt\" target=\"_blank\" rel=\"noopener\">StartupManagerDispatcher</a>&#x4E2D;&#x6267;&#x884C;&#x3002;</p>\n<h2 id=\"&#x4F9D;&#x8D56;&#x56DE;&#x8C03;\"><a href=\"#&#x4F9D;&#x8D56;&#x56DE;&#x8C03;\" class=\"headerlink\" title=\"&#x4F9D;&#x8D56;&#x56DE;&#x8C03;\"></a>&#x4F9D;&#x8D56;&#x56DE;&#x8C03;</h2><p>&#x5728;&#x4F9D;&#x8D56;&#x56DE;&#x8C03;&#x4E4B;&#x524D;&#xFF0C;&#x5148;&#x6765;&#x8BA4;&#x8BC6;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;ManagerDispatcher</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface ManagerDispatcher {</span><br><span class=\"line\"> </span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * dispatch prepare</span><br><span class=\"line\">     */</span><br><span class=\"line\">    fun prepare()</span><br><span class=\"line\"> </span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * dispatch startup to executing.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    fun dispatch(startup: Startup&lt;*&gt;, sortStore: StartupSortStore)</span><br><span class=\"line\"> </span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * notify children when dependency startup completed.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    fun notifyChildren(dependencyParent: Startup&lt;*&gt;, result: Any?, sortStore: StartupSortStore)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;ManagerDispatcher&#x4E2D;&#x6709;&#x4E09;&#x4E2A;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#xFF0C;&#x5206;&#x522B;&#x7528;&#x6765;&#x7BA1;&#x7406;Startup&#x7684;&#x6267;&#x884C;&#x903B;&#x8F91;&#xFF0C;&#x4FDD;&#x8BC1;&#x6267;&#x884C;&#x524D;&#x7684;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#xFF0C;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x5206;&#x53D1;&#x4E0E;&#x6267;&#x884C;&#x540E;&#x7684;&#x56DE;&#x8C03;&#x3002;&#x6240;&#x4EE5;&#x4F9D;&#x8D56;&#x56DE;&#x8C03;&#x81EA;&#x7136;&#x4E5F;&#x5728;&#x5176;&#x4E2D;&#x3002;</p>\n<p>&#x8C03;&#x7528;&#x903B;&#x8F91;&#x88AB;&#x5C01;&#x88C5;&#x5230;notifyChildren()&#x65B9;&#x6CD5;&#x4E2D;&#x3002;&#x6700;&#x7EC8;&#x8C03;&#x7528;Startup&#x7684;onDependenciesCompleted()&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#x4E2D;&#x91CD;&#x5199;onDependenciesCompleted()&#x65B9;&#x6CD5;&#xFF0C;&#x4ECE;&#x800C;&#x62FF;&#x5230;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x7EC4;&#x4EF6;&#x5B8C;&#x6210;&#x540E;&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x4F8B;&#x5982;Sample&#x4E2D;&#x7684;SampleSyncFourStartup</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class SampleSyncFourStartup: AndroidStartup&lt;String&gt;() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    private var mResult: String? = null</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun create(context: Context): String? {</span><br><span class=\"line\">        return &quot;$mResult + sync four&quot;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun callCreateOnMainThread(): Boolean = true</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun waitOnMainThread(): Boolean = false</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun dependencies(): List&lt;Class&lt;out Startup&lt;*&gt;&gt;&gt;? {</span><br><span class=\"line\">        return listOf(SampleAsyncTwoStartup::class.java)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun onDependenciesCompleted(startup: Startup&lt;*&gt;, result: Any?) {</span><br><span class=\"line\">        mResult = result as? String?</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5F53;&#x7136;&#x8FD9;&#x662F;&#x5728;&#x5F53;&#x524D;&#x7EC4;&#x4EF6;&#x4E2D;&#x83B7;&#x53D6;&#x4F9D;&#x8D56;&#x7EC4;&#x4EF6;&#x7684;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF0C;Android Startup&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x5728;&#x4EFB;&#x610F;&#x65F6;&#x5019;&#x6765;&#x67E5;&#x8BE2;&#x4EFB;&#x610F;&#x7EC4;&#x4EF6;&#x7684;&#x6267;&#x884C;&#x72B6;&#x51B5;&#xFF0C;&#x5E76;&#x4E14;&#x652F;&#x6301;&#x83B7;&#x53D6;&#x4EFB;&#x610F;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x7684;&#x7EC4;&#x4EF6;&#x7684;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;</p>\n<p>Android Startup&#x63D0;&#x4F9B;StartupCacheManager&#x6765;&#x5B9E;&#x73B0;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x3002;&#x5177;&#x4F53;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x67E5;&#x770B;<a href=\"https://github.com/idisfkj/android-startup/tree/master/app/src/main/java/com/rousetime/sample\" target=\"_blank\" rel=\"noopener\">Sample</a>&#x6765;&#x83B7;&#x53D6;&#x3002;</p>\n<h2 id=\"&#x624B;&#x52A8;&#x901A;&#x77E5;\"><a href=\"#&#x624B;&#x52A8;&#x901A;&#x77E5;\" class=\"headerlink\" title=\"&#x624B;&#x52A8;&#x901A;&#x77E5;\"></a>&#x624B;&#x52A8;&#x901A;&#x77E5;</h2><p>&#x4E0A;&#x9762;&#x4ECB;&#x7ECD;&#x4E86;&#x4F9D;&#x8D56;&#x56DE;&#x8C03;&#xFF0C;&#x5B83;&#x662F;&#x81EA;&#x52A8;&#x8C03;&#x7528;&#x4F9D;&#x8D56;&#x5B8C;&#x6210;&#x540E;&#x7684;&#x4E00;&#x7CFB;&#x5217;&#x64CD;&#x4F5C;&#x3002;Android Startup&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x624B;&#x52A8;&#x901A;&#x77E5;&#x4F9D;&#x8D56;&#x4EFB;&#x52A1;&#x7684;&#x5B8C;&#x6210;&#x3002;</p>\n<p>&#x624B;&#x52A8;&#x901A;&#x77E5;&#x7684;&#x8BBE;&#x7F6E;&#x662F;&#x901A;&#x8FC7;manualDispatch()&#x65B9;&#x6CD5;&#x5F00;&#x542F;&#x3002;&#x5B83;&#x5C06;&#x914D;&#x5408;onDispatch()&#x4E00;&#x8D77;&#x5B8C;&#x6210;&#x3002;</p>\n<p>&#x5728;ManagerDispatcher&#x63A5;&#x53E3;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x7C7B;&#x7684;notifyChildren()&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x5F00;&#x542F;&#x624B;&#x52A8;&#x901A;&#x77E5;&#xFF0C;&#x5C31;&#x4E0D;&#x4F1A;&#x8D70;&#x81EA;&#x52A8;&#x901A;&#x77E5;&#x6D41;&#x7A0B;&#xFF0C;&#x8C03;&#x7528;toNotify()&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x662F;&#x4F1A;&#x5C06;&#x5F53;&#x524D;&#x7EC4;&#x4EF6;&#x7684;<a href=\"https://github.com/idisfkj/android-startup/blob/master/android-startup/src/main/java/com/rousetime/android_startup/dispatcher/Dispatcher.kt\" target=\"_blank\" rel=\"noopener\">Dispatcher</a>&#x6DFB;&#x52A0;&#x5230;&#x6CE8;&#x518C;&#x8868;&#x4E2D;&#x3002;&#x7B49;&#x5F85;onDispatche()&#x7684;&#x624B;&#x52A8;&#x8C03;&#x7528;&#x53BB;&#x5524;&#x9192;toNotify()&#x7684;&#x6267;&#x884C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun notifyChildren(dependencyParent: Startup&lt;*&gt;, result: Any?, sortStore: StartupSortStore) {</span><br><span class=\"line\">    // immediately notify main thread,Unblock the main thread.</span><br><span class=\"line\">    if (dependencyParent.waitOnMainThread()) {</span><br><span class=\"line\">        needAwaitCount.incrementAndGet()</span><br><span class=\"line\">        awaitCountDownLatch?.countDown()</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">     sortStore.startupChildrenMap[dependencyParent::class.java.getUniqueKey()]?.forEach {</span><br><span class=\"line\">        sortStore.startupMap[it]?.run {</span><br><span class=\"line\">            onDependenciesCompleted(dependencyParent, result)</span><br><span class=\"line\"> </span><br><span class=\"line\">            if (dependencyParent.manualDispatch()) {</span><br><span class=\"line\">                dependencyParent.registerDispatcher(this)</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                toNotify()</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x793A;&#x4F8B;&#x53EF;&#x4EE5;&#x67E5;&#x770B;<a href=\"https://github.com/idisfkj/android-startup/blob/master/app/src/main/java/com/rousetime/sample/startup/SampleManualDispatchStartup.kt\" target=\"_blank\" rel=\"noopener\">SampleManualDispatchStartup</a></p>\n<h2 id=\"&#x62D3;&#x6251;&#x4F18;&#x5316;\"><a href=\"#&#x62D3;&#x6251;&#x4F18;&#x5316;\" class=\"headerlink\" title=\"&#x62D3;&#x6251;&#x4F18;&#x5316;\"></a>&#x62D3;&#x6251;&#x4F18;&#x5316;</h2><p>Android Startup&#x4E2D;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#x4E0E;&#x7EC4;&#x4EF6;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x5F20;<a href=\"https://baike.baidu.com/item/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F\" target=\"_blank\" rel=\"noopener\">&#x6709;&#x5411;&#x65E0;&#x73AF;&#x62D3;&#x6251;&#x56FE;</a>&#x3002;</p>\n<p>&#x4EE5;Sample&#x4E2D;&#x7684;&#x4E00;&#x4E2A;demo&#x4E3A;&#x4F8B;&#xFF1A;</p>\n<p><img src=\"/2020/09/09/Android-Startup&#x5B9E;&#x73B0;&#x5206;&#x6790;/android_startup_diagram.png\" alt></p>\n<p>&#x6211;&#x4EEC;&#x5C06;&#x6BCF;&#x4E00;&#x4E2A;Startup&#x7684;&#x8FB9;&#x6307;&#x5411;&#x76EE;&#x6807;&#x4E3A;&#x4E00;&#x4E2A;&#x5165;&#x5EA6;&#x3002;&#x6839;&#x636E;&#x8FD9;&#x4E2A;&#x89C4;&#x5B9A;&#x5F88;&#x5BB9;&#x6613;&#x7B97;&#x51FA;&#x8FD9;&#x56DB;&#x4E2A;Startup&#x7684;&#x5165;&#x5EA6;</p>\n<ol>\n<li>SampleFirstStartup: 0</li>\n<li>SampleSecondStartup: 1</li>\n<li>SampleThirdStartup: 2</li>\n<li>SampleFourthStartup: 3</li>\n</ol>\n<p>&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x5165;&#x5EA6;&#x6709;&#x4EC0;&#x4E48;&#x7528;&#x5462;&#xFF1F;&#x6839;&#x636E;&#x7531;AOV&#x7F51;&#x6784;&#x9020;&#x62D3;&#x6251;&#x5E8F;&#x5217;&#x7684;&#x62D3;&#x6251;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;&#x4E3B;&#x8981;&#x662F;&#x5FAA;&#x73AF;&#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x4E24;&#x6B65;&#xFF0C;&#x76F4;&#x5230;&#x4E0D;&#x5B58;&#x5728;&#x5165;&#x5EA6;&#x4E3A;0&#x7684;&#x9876;&#x70B9;&#x4E3A;&#x6B62;&#x3002;</p>\n<p>&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x5165;&#x5EA6;&#x4E3A;0&#x7684;&#x9876;&#x70B9;&#x5E76;&#x8F93;&#x51FA;&#x4E4B;&#xFF1B;<br>&#x4ECE;&#x7F51;&#x4E2D;&#x5220;&#x9664;&#x6B64;&#x9876;&#x70B9;&#x53CA;&#x6240;&#x6709;&#x51FA;&#x8FB9;<br>&#x5FAA;&#x73AF;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x82E5;&#x8F93;&#x51FA;&#x7684;&#x9876;&#x70B9;&#x6570;&#x5C0F;&#x4E8E;&#x7F51;&#x4E2D;&#x7684;&#x9876;&#x70B9;&#x6570;&#xFF0C;&#x5219;&#x8F93;&#x51FA;&#x201C;&#x6709;&#x56DE;&#x8DEF;&#x201D;&#x4FE1;&#x606F;&#xFF0C;&#x5426;&#x5219;&#x8F93;&#x51FA;&#x7684;&#x9876;&#x70B9;&#x5E8F;&#x5217;&#x5C31;&#x662F;&#x4E00;&#x79CD;&#x62D3;&#x6251;&#x5E8F;&#x5217;&#x3002;</p>\n<p>&#x6839;&#x636E;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x53EF;&#x4EE5;&#x5F97;&#x51FA;&#x4E0A;&#x9762;&#x7684;&#x56DB;&#x4E2A;Startup&#x7684;&#x8F93;&#x51FA;&#x987A;&#x5E8F;&#x4E3A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SampleFirstStartup -&gt; SampleSecondStartup -&gt; SampleThirdStartup -&gt; SampleFourthStartup</span><br></pre></td></tr></table></figure>\n<p>&#x4EE5;&#x4E0A;&#x7684;&#x8F93;&#x51FA;&#x987A;&#x5E8F;&#x4E5F;&#x662F;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#x95F4;&#x7684;&#x6267;&#x884C;&#x987A;&#x5E8F;&#x3002;&#x8FD9;&#x6837;&#x5373;&#x4FDD;&#x8BC1;&#x4E86;&#x4F9D;&#x8D56;&#x7EC4;&#x4EF6;&#x95F4;&#x7684;&#x6B63;&#x5E38;&#x6267;&#x884C;&#xFF0C;&#x4E5F;&#x4FDD;&#x8BC1;&#x4E86;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#x7684;&#x6267;&#x884C;&#x987A;&#x5E8F;&#x7684;&#x6700;&#x4F18;&#x89E3;&#xFF0C;&#x5373;&#x4F9D;&#x8D56;&#x7EC4;&#x4EF6;&#x95F4;&#x7684;&#x7B49;&#x5019;&#x65F6;&#x95F4;&#x6700;&#x77ED;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x68C0;&#x67E5;&#x4E86;&#x4F9D;&#x8D56;&#x7EC4;&#x4EF6;&#x95F4;&#x662F;&#x5426;&#x5B58;&#x5728;&#x73AF;&#x3002;</p>\n<p>&#x65E2;&#x7136;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x65B9;&#x6848;&#x4E0E;&#x5B9E;&#x73B0;&#x6B65;&#x9AA4;&#xFF0C;&#x4E0B;&#x9762;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x7528;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x51FA;&#x6765;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun sort(startupList: List&lt;Startup&lt;*&gt;&gt;): StartupSortStore {</span><br><span class=\"line\">    TraceCompat.beginSection(TopologySort::class.java.simpleName)</span><br><span class=\"line\">    val mainResult = mutableListOf&lt;Startup&lt;*&gt;&gt;()</span><br><span class=\"line\">    val ioResult = mutableListOf&lt;Startup&lt;*&gt;&gt;()</span><br><span class=\"line\">    val temp = mutableListOf&lt;Startup&lt;*&gt;&gt;()</span><br><span class=\"line\">    val startupMap = hashMapOf&lt;String, Startup&lt;*&gt;&gt;()</span><br><span class=\"line\">    val zeroDeque = ArrayDeque&lt;String&gt;()</span><br><span class=\"line\">    val startupChildrenMap = hashMapOf&lt;String, MutableList&lt;String&gt;&gt;()</span><br><span class=\"line\">    val inDegreeMap = hashMapOf&lt;String, Int&gt;()</span><br><span class=\"line\">    startupList.forEach {</span><br><span class=\"line\">        val uniqueKey = it::class.java.getUniqueKey()</span><br><span class=\"line\">        if (!startupMap.containsKey(uniqueKey)) {</span><br><span class=\"line\">            startupMap[uniqueKey] = it</span><br><span class=\"line\">            // save in-degree</span><br><span class=\"line\">            inDegreeMap[uniqueKey] = it.dependencies()?.size ?: 0</span><br><span class=\"line\">            if (it.dependencies().isNullOrEmpty()) {</span><br><span class=\"line\">                zeroDeque.offer(uniqueKey)</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                // add key parent, value list children</span><br><span class=\"line\">                it.dependencies()?.forEach { parent -&gt;</span><br><span class=\"line\">                    val parentUniqueKey = parent.getUniqueKey()</span><br><span class=\"line\">                    if (startupChildrenMap[parentUniqueKey] == null) {</span><br><span class=\"line\">                        startupChildrenMap[parentUniqueKey] = arrayListOf()</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                    startupChildrenMap[parentUniqueKey]?.add(uniqueKey)</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            throw StartupException(&quot;$it multiple add.&quot;)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    while (!zeroDeque.isEmpty()) {</span><br><span class=\"line\">        zeroDeque.poll()?.let {</span><br><span class=\"line\">            startupMap[it]?.let { androidStartup -&gt;</span><br><span class=\"line\">                temp.add(androidStartup)</span><br><span class=\"line\">                // add zero in-degree to result list</span><br><span class=\"line\">                if (androidStartup.callCreateOnMainThread()) {</span><br><span class=\"line\">                    mainResult.add(androidStartup)</span><br><span class=\"line\">                } else {</span><br><span class=\"line\">                    ioResult.add(androidStartup)</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">            startupChildrenMap[it]?.forEach { children -&gt;</span><br><span class=\"line\">                inDegreeMap[children] = inDegreeMap[children]?.minus(1) ?: 0</span><br><span class=\"line\">                // add zero in-degree to deque</span><br><span class=\"line\">                if (inDegreeMap[children] == 0) {</span><br><span class=\"line\">                    zeroDeque.offer(children)</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    if (mainResult.size + ioResult.size != startupList.size) {</span><br><span class=\"line\">        throw StartupException(&quot;lack of dependencies or have circle dependencies.&quot;)</span><br><span class=\"line\">    }</span><br><span class=\"line\">    val result = mutableListOf&lt;Startup&lt;*&gt;&gt;().apply {</span><br><span class=\"line\">        addAll(ioResult)</span><br><span class=\"line\">        addAll(mainResult)</span><br><span class=\"line\">    }</span><br><span class=\"line\">    printResult(temp)</span><br><span class=\"line\">    TraceCompat.endSection()</span><br><span class=\"line\">    return StartupSortStore(</span><br><span class=\"line\">        result,</span><br><span class=\"line\">        startupMap,</span><br><span class=\"line\">        startupChildrenMap</span><br><span class=\"line\">    )</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x76F8;&#x4FE1;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x90FD;&#x80FD;&#x591F;&#x7406;&#x89E3;&#x3002;</p>\n<p>&#x9664;&#x4E86;&#x4E0A;&#x9762;&#x6240;&#x4ECB;&#x7ECD;&#x7684;&#x529F;&#x80FD;&#xFF0C;Android Startup&#x8FD8;&#x652F;&#x6301;Systrace&#x63D2;&#x6869;&#xFF0C;&#x4E3A;&#x7528;&#x6237;&#x63D0;&#x4F9B;&#x7CFB;&#x7EDF;&#x5206;&#x6790;&#x521D;&#x59CB;&#x5316;&#x7684;&#x8017;&#x65F6;&#x8BE6;&#x7EC6;&#x8FC7;&#x7A0B;&#xFF1B;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#x7684;&#x51C6;&#x786E;&#x8017;&#x65F6;&#x6536;&#x96C6;&#x7EDF;&#x8BA1;&#xFF0C;&#x65B9;&#x4FBF;&#x7528;&#x6237;&#x4E0B;&#x8F7D;&#x4E0E;&#x4E0A;&#x4F20;&#x5230;&#x6307;&#x5B9A;&#x670D;&#x52A1;&#x5668;&#x7B49;&#x7B49;&#x3002;</p>\n<p>Android Startup&#x7684;&#x6838;&#x5FC3;&#x529F;&#x80FD;&#x5206;&#x6790;&#x6682;&#x65F6;&#x5C31;&#x5230;&#x8FD9;&#x91CC;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#x5BF9;&#x4F60;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#x3002;</p>\n<p>&#x5F53;&#x7136;&#xFF0C;&#x672C;&#x4EBA;&#x771F;&#x8BDA;&#x7684;&#x9080;&#x8BF7;&#x4F60;&#x52A0;&#x5165;<a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">Android Startup</a>&#x7684;&#x5EFA;&#x8BBE;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x6709;&#x4EC0;&#x4E48;&#x597D;&#x7684;&#x5EFA;&#x8BAE;&#x4E5F;&#x8BF7;&#x4E0D;&#x541D;&#x8D50;&#x6559;&#x3002;</p>\n<h2 id=\"&#x9879;&#x76EE;\"><a href=\"#&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;\"></a>&#x9879;&#x76EE;</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">android_startup</a>: &#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>: &#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>: &#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;Github&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">android-api-analysis</a>: &#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/daily_algorithm\" target=\"_blank\" rel=\"noopener\">daily_algorithm</a>: &#x6BCF;&#x65E5;&#x4E00;&#x7B97;&#x6CD5;&#xFF0C;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;&#x4E00;&#x8D77;&#x5171;&#x52C9;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x559C;&#x6B22;&#x6211;&#x7684;&#x6587;&#x7AE0;&#x6A21;&#x5F0F;&#xFF0C;&#x6216;&#x8005;&#x5BF9;&#x6211;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x6587;&#x7AE0;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x6211;&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF1A;&#x3010;Android&#x8865;&#x7ED9;&#x7AD9;&#x3011;</p>\n<p>&#x6216;&#x8005;&#x626B;&#x63CF;&#x4E0B;&#x65B9;&#x4E8C;&#x7EF4;&#x7801;&#xFF0C;&#x4E0E;&#x6211;&#x5EFA;&#x7ACB;&#x6709;&#x6548;&#x7684;&#x6C9F;&#x901A;&#xFF0C;&#x540C;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x65B9;&#x4FBF;&#x7684;&#x6536;&#x5230;&#x76F8;&#x5173;&#x7684;&#x6280;&#x672F;&#x63A8;&#x9001;&#x3002;</p>\n<p><img src=\"/2020/09/09/Android-Startup&#x5B9E;&#x73B0;&#x5206;&#x6790;/Android&#x8865;&#x7ED9;&#x7AD9;.jpg\" alt></p>\n","categories":["android"],"tags":["jetpack"]},{"title":"我为何弃用Jetpack的App Startup?","url":"https://www.rousetime.com/2020/08/05/我为何弃用Jetpack的App-Startup/","content":"<h2 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h2><p>&#x6700;&#x8FD1;Jetpack&#x53C8;&#x6DFB;&#x52A0;&#x4E86;&#x65B0;&#x6210;&#x5458;App Startup&#xFF0C;&#x5B98;&#x65B9;&#x58F0;&#x660E;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5728;Android&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x9488;&#x5BF9;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#x8FDB;&#x884C;&#x4F18;&#x5316;&#x7684;&#x4F9D;&#x8D56;&#x5E93;&#x3002;&#x672C;&#x4EBA;&#x7B2C;&#x4E00;&#x6B21;&#x542C;&#x5230;&#x540E;&#x975E;&#x5E38;&#x9AD8;&#x5174;&#xFF0C;&#x56E0;&#x4E3A;&#x81EA;&#x5DF1;&#x8D1F;&#x8D23;&#x7684;&#x9879;&#x76EE;&#x5728;&#x542F;&#x52A8;&#x65F6;&#x9700;&#x8981;&#x521D;&#x59CB;&#x5316;&#x7684;&#x4E1C;&#x897F;&#x5B9E;&#x5728;&#x662F;&#x592A;&#x591A;&#xFF0C;&#x800C;&#x4E14;&#x6709;&#x70B9;&#x6742;&#x4E71;&#x65E0;&#x7AE0;&#xFF0C;&#x90FD;&#x8026;&#x5408;&#x5728;&#x4E00;&#x8D77;&#x4E86;&#x3002;&#x5BF9;&#x4E8E;&#x53EF;&#x4EE5;&#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;&#x7684;&#x7EC4;&#x4EF6;&#x4E5F;&#x6CA1;&#x6709;&#x8FDB;&#x884C;&#x5F02;&#x6B65;&#x5904;&#x7406;&#xFF0C;&#x800C;&#x5BF9;&#x4E8E;&#x5DF2;&#x7ECF;&#x5904;&#x7406;&#x8FC7;&#x7684;&#x5F02;&#x6B65;&#x7EC4;&#x4EF6;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x6216;&#x8005;&#x591A;&#x4E2A;&#x5F02;&#x6B65;&#x4E4B;&#x540E;&#x7684;&#x7EDF;&#x4E00;&#x903B;&#x8F91;&#x5904;&#x7406;&#x4E5F;&#x6CA1;&#x6709;&#x4E00;&#x4E2A;&#x5F88;&#x597D;&#x7684;&#x7EDF;&#x4E00;&#x89C4;&#x8303;&#x3002;&#x6240;&#x4EE5;&#x9488;&#x5BF9;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x65E9;&#x5C31;&#x60F3;&#x627E;&#x4E2A;&#x65B9;&#x6848;&#x6765;&#x4F18;&#x5316;&#x4E86;&#xFF0C;&#x8FD9;&#x6B21;&#x7EC8;&#x4E8E;&#x7B49;&#x5230;&#x4E86;App Startup&#x3002;</p>\n<p>&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x6211;&#x5143;&#x6C14;&#x6EE1;&#x6EE1;&#x7684;&#x53BB;&#x67E5;&#x770B;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x65F6;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x9884;&#x60F3;&#x4E2D;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x4E2D;&#x53EA;&#x63D0;&#x5230;&#x4E86;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;ContentProvider&#x6765;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;&#x9700;&#x8981;&#x521D;&#x59CB;&#x5316;&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x540C;&#x65F6;&#x901A;&#x8FC7;dependencies()&#x65B9;&#x6CD5;&#x89E3;&#x51B3;&#x7EC4;&#x4EF6;&#x95F4;&#x521D;&#x59CB;&#x5316;&#x7684;&#x4F9D;&#x8D56;&#x987A;&#x5E8F;&#xFF0C;&#x7136;&#x540E;&#x5462;&#xFF1F;&#x6CA1;&#x4E86;&#xFF1F;&#x7B49;&#x7B49;&#x5B98;&#x65B9;&#x4F60;&#x662F;&#x4E0D;&#x662F;&#x6F0F;&#x4E86;&#x4EC0;&#x4E48;&#xFF1F;</p>\n<p>&#x5F02;&#x6B65;&#x5904;&#x7406;&#x5462;&#xFF1F;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;create()&#x65B9;&#x6CD5;&#x4E2D;&#x624B;&#x52A8;&#x521B;&#x5EFA;&#x5B50;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#xFF0C;&#x4F46;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x4F9D;&#x8D56;&#x53E6;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x53C8;&#x8BE5;&#x5982;&#x4F55;&#x5904;&#x7406;&#x5462;&#xFF1F;&#x591A;&#x4E2A;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#xFF0C;&#x7EDF;&#x4E00;&#x903B;&#x8F91;&#x5904;&#x7406;&#x53C8;&#x5728;&#x54EA;&#x91CC;&#x5462;&#xFF1F;&#x4F9D;&#x8D56;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#x540E;&#x7684;&#x56DE;&#x8C03;&#x53C8;&#x5728;&#x54EA;&#x91CC;&#xFF1F;&#x4EA6;&#x6216;&#x8005;&#x662F;&#x4F9D;&#x8D56;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#x540E;&#x7684;&#x901A;&#x77E5;&#xFF1F;</p>\n<p>&#x6211;&#x6709;&#x70B9;&#x4E0D;&#x76F8;&#x4FE1;&#xFF0C;&#x6240;&#x4EE5;&#x53C8;&#x53BB;&#x67E5;&#x770B;&#x4E86;App Startup&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x6E90;&#x7801;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4E5F;&#x5C31;&#x51E0;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x6700;&#x540E;&#x53D1;&#x73B0;&#x786E;&#x5B9E;&#x53EA;&#x652F;&#x6301;&#x4E0A;&#x9762;&#x7684;&#x90A3;&#x51E0;&#x4E2A;&#x529F;&#x80FD;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x7684;&#x9879;&#x76EE;&#x90FD;&#x662F;&#x540C;&#x6B65;&#x521D;&#x59CB;&#x5316;&#x7684;&#x8BDD;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528;&#x5230;&#x4E86;&#x591A;&#x4E2A;ContentProvider&#xFF0C;App Startup&#x53EF;&#x80FD;&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#xFF0C;&#x6BD5;&#x7ADF;&#x7EDF;&#x4E00;&#x5230;&#x4E86;&#x4E00;&#x4E2A;ContentProvider&#x4E2D;&#xFF0C;&#x540C;&#x65F6;&#x652F;&#x6301;&#x4E86;&#x7B80;&#x5355;&#x7684;&#x987A;&#x5E8F;&#x4F9D;&#x8D56;&#x3002;</p>\n<p>&#x503C;&#x5F97;&#x4E00;&#x63D0;&#x7684;&#x662F;&#xFF0C;App Startup&#x4E2D;&#x53EA;&#x63D0;&#x4F9B;&#x4E86;&#x4F7F;&#x7528;&#x53CD;&#x5C04;&#x6765;&#x83B7;&#x53D6;&#x521D;&#x59CB;&#x5316;&#x7684;&#x7EC4;&#x4EF6;&#x5B9E;&#x4F8B;&#xFF0C;&#x8FD9;&#x5BF9;&#x4E8E;&#x4E00;&#x4E9B;&#x6CA1;&#x6709;&#x8FC7;&#x591A;&#x4F9D;&#x8D56;&#x7684;&#x521D;&#x59CB;&#x5316;&#x9879;&#x76EE;&#x6765;&#x8BF4;&#xFF0C;&#x76F2;&#x76EE;&#x4F7F;&#x7528;App Startup&#x6765;&#x4F18;&#x5316;&#x662F;&#x5426;&#x4F1A;&#x5BF9;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x8FDB;&#x4E00;&#x6B65;&#x9020;&#x6210;&#x5F71;&#x54CD;&#x5462;&#xFF1F;</p>\n<p>&#x6240;&#x4EE5;&#x7EC6;&#x60F3;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x4E0D;&#x7981;&#x8BA9;&#x6211;&#x60F3;&#x8D77;&#x4E86;&#x4E09;&#x56FD;&#x65F6;&#x7684;&#x4E00;&#x4E2A;&#x540D;&#x8BCD;&#xFF1A;&#x9E21;&#x808B;&#x3002;&#x98DF;&#x4E4B;&#x65E0;&#x5473;&#xFF0C;&#x5F03;&#x4E4B;&#x53EF;&#x60DC;&#x3002;</p>\n<p>&#x4F46;&#x6700;&#x7EC8;&#x6211;&#x8FD8;&#x662F;&#x51B3;&#x5B9A;&#x653E;&#x5F03;&#x4F7F;&#x7528;&#x5B83;&#x3002;</p>\n<p>&#x653E;&#x5F03;&#x4E4B;&#x540E;&#x6709;&#x70B9;&#x4E0D;&#x7518;&#x5FC3;&#xFF0C;&#x53EF;&#x80FD;&#x66F4;&#x591A;&#x7684;&#x662F;&#x5B83;&#x6CA1;&#x6709;&#x89E3;&#x51B3;&#x6211;&#x5F53;&#x524D;&#x7684;&#x9879;&#x76EE;&#x573A;&#x666F;&#x3002;&#x90FD;&#x5206;&#x6790;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x6E90;&#x7801;&#x90FD;&#x770B;&#x4E86;&#xFF0C;&#x603B;&#x4E0D;&#x80FD;&#x534A;&#x9014;&#x800C;&#x5E9F;&#x5427;&#xFF0C;&#x6240;&#x4EE5;&#x81EA;&#x5DF1;&#x54AC;&#x54AC;&#x7259;&#x518D;&#x8865;&#x5145;&#x4E00;&#x70B9;&#x5457;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x575A;&#x6301;&#x4E00;&#x4E0B;&#xFF0C;&#x5C31;&#x6709;&#x4E86;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x5E93;&#xFF0C;App Startup&#x7684;&#x8FDB;&#x9636;&#x7248;Android Startup&#x3002;</p>\n<h2 id=\"Android-Startup\"><a href=\"#Android-Startup\" class=\"headerlink\" title=\"Android Startup\"></a>Android Startup</h2><p><a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">Android Startup</a>&#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#x3002;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Android Startup&#x6765;&#x7B80;&#x5316;&#x542F;&#x52A8;&#x5E8F;&#x5217;&#xFF0C;&#x5E76;&#x663E;&#x5F0F;&#x5730;&#x8BBE;&#x7F6E;&#x521D;&#x59CB;&#x5316;&#x987A;&#x5E8F;&#x4E0E;&#x7EC4;&#x4EF6;&#x4E4B;&#x95F4;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x3002;<br>&#x4E0E;&#x6B64;&#x540C;&#x65F6;&#xFF0C;Android Startup&#x652F;&#x6301;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7B49;&#x5F85;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x6709;&#x5411;&#x65E0;&#x73AF;&#x56FE;<a href=\"https://github.com/idisfkj/android-startup/blob/master/android-startup/src/main/java/com/rousetime/android_startup/sort/TopologySort.kt\" target=\"_blank\" rel=\"noopener\">&#x62D3;&#x6251;&#x6392;&#x5E8F;</a>&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x4FDD;&#x8BC1;&#x5185;&#x90E8;&#x4F9D;&#x8D56;&#x7EC4;&#x4EF6;&#x7684;&#x521D;&#x59CB;&#x5316;&#x987A;&#x5E8F;&#x3002;</p>\n<p>&#x7531;&#x4E8E;Android Startup&#x662F;&#x57FA;&#x4E8E;App Startup&#x8FDB;&#x884C;&#x7684;&#x6269;&#x5C55;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x4E0E;App Startup&#x6709;&#x70B9;&#x7C7B;&#x4F3C;&#xFF0C;&#x8BE5;&#x6709;&#x7684;&#x529F;&#x80FD;&#x57FA;&#x672C;&#x4E0A;&#x90FD;&#x6709;&#xFF0C;&#x540C;&#x65F6;&#x989D;&#x5916;&#x8FD8;&#x9644;&#x52A0;&#x5176;&#x5B83;&#x529F;&#x80FD;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x5F20;&#x4E0E;google&#x7684;<a href=\"https://developer.android.com/topic/libraries/app-startup\" target=\"_blank\" rel=\"noopener\">App Startup</a>&#x529F;&#x80FD;&#x5BF9;&#x6BD4;&#x7684;&#x8868;&#x683C;&#x3002;</p>\n<p><img src=\"/2020/08/05/&#x6211;&#x4E3A;&#x4F55;&#x5F03;&#x7528;Jetpack&#x7684;App-Startup/1.jpg\" alt></p>\n<p>&#x4E0B;&#x9762;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;Android Startup&#x7684;&#x4F7F;&#x7528;&#x3002;</p>\n<h2 id=\"&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\"><a href=\"#&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\" class=\"headerlink\" title=\"&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\"></a>&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;</h2><p>&#x5C06;&#x4E0B;&#x9762;&#x7684;&#x4F9D;&#x8D56;&#x6DFB;&#x52A0;&#x5230;build.gradle&#x6587;&#x4EF6;&#x4E2D;:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    implementation &apos;com.rousetime.android:android-startup:1.0.1&apos;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x4F9D;&#x8D56;&#x7248;&#x672C;&#x7684;&#x66F4;&#x65B0;&#x4FE1;&#x606F;: <a href=\"https://github.com/idisfkj/android-startup/releases\" target=\"_blank\" rel=\"noopener\">Release</a></p>\n</blockquote>\n<h2 id=\"&#x5FEB;&#x901F;&#x4F7F;&#x7528;\"><a href=\"#&#x5FEB;&#x901F;&#x4F7F;&#x7528;\" class=\"headerlink\" title=\"&#x5FEB;&#x901F;&#x4F7F;&#x7528;\"></a>&#x5FEB;&#x901F;&#x4F7F;&#x7528;</h2><p>android-startup&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x79CD;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#xFF0C;&#x5728;&#x4F7F;&#x7528;&#x4E4B;&#x524D;&#x9700;&#x8981;&#x5148;&#x5B9A;&#x4E49;&#x521D;&#x59CB;&#x5316;&#x7684;&#x7EC4;&#x4EF6;&#x3002;</p>\n<h3 id=\"&#x5B9A;&#x4E49;&#x521D;&#x59CB;&#x5316;&#x7684;&#x7EC4;&#x4EF6;\"><a href=\"#&#x5B9A;&#x4E49;&#x521D;&#x59CB;&#x5316;&#x7684;&#x7EC4;&#x4EF6;\" class=\"headerlink\" title=\"&#x5B9A;&#x4E49;&#x521D;&#x59CB;&#x5316;&#x7684;&#x7EC4;&#x4EF6;\"></a>&#x5B9A;&#x4E49;&#x521D;&#x59CB;&#x5316;&#x7684;&#x7EC4;&#x4EF6;</h3><p>&#x6BCF;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x7684;&#x7EC4;&#x4EF6;&#x90FD;&#x9700;&#x8981;&#x5B9E;&#x73B0;AndroidStartup<t>&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x5B83;&#x5B9E;&#x73B0;&#x4E86;Startup<t>&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x4E3B;&#x8981;&#x6709;&#x4EE5;&#x4E0B;&#x56DB;&#x4E2A;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#xFF1A;</t></t></p>\n<ul>\n<li><p>callCreateOnMainThread(): Boolean&#x7528;&#x6765;&#x63A7;&#x5236;create()&#x65B9;&#x6CD5;&#x8C03;&#x65F6;&#x6240;&#x5728;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x8FD4;&#x56DE;true&#x4EE3;&#x8868;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x3002;</p>\n</li>\n<li><p>waitOnMainThread(): Boolean&#x7528;&#x6765;&#x63A7;&#x5236;&#x5F53;&#x524D;&#x521D;&#x59CB;&#x5316;&#x7684;&#x7EC4;&#x4EF6;&#x662F;&#x5426;&#x9700;&#x8981;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x7B49;&#x5F85;&#x5176;&#x5B8C;&#x6210;&#x3002;&#x5982;&#x679C;&#x8FD4;&#x56DE;true&#xFF0C;&#x5C06;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;&#xFF0C;&#x5E76;&#x4E14;&#x963B;&#x585E;&#x4E3B;&#x7EBF;&#x7A0B;&#x3002;</p>\n</li>\n<li><p>create(): T?&#x7EC4;&#x4EF6;&#x521D;&#x59CB;&#x5316;&#x65B9;&#x6CD5;&#xFF0C;&#x6267;&#x884C;&#x9700;&#x8981;&#x5904;&#x7406;&#x7684;&#x521D;&#x59CB;&#x5316;&#x903B;&#x8F91;&#xFF0C;&#x652F;&#x6301;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;T&#x7C7B;&#x578B;&#x7684;&#x5B9E;&#x4F8B;&#x3002;</p>\n</li>\n<li><p>dependencies(): List&lt;Class&lt;out Startup&lt;<em>&gt;&gt;&gt;?&#x8FD4;&#x56DE;Startup&lt;</em>&gt;&#x7C7B;&#x578B;&#x7684;list&#x96C6;&#x5408;&#x3002;&#x7528;&#x6765;&#x8868;&#x793A;&#x5F53;&#x524D;&#x7EC4;&#x4EF6;&#x5728;&#x6267;&#x884C;&#x4E4B;&#x524D;&#x9700;&#x8981;&#x4F9D;&#x8D56;&#x7684;&#x7EC4;&#x4EF6;&#x3002;</p>\n</li>\n</ul>\n<p>&#x4F8B;&#x5982;&#xFF0C;&#x4E0B;&#x9762;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;SampleFirstStartup&#x7C7B;&#x6765;&#x5B9E;&#x73B0;AndroidStartup<string>&#x62BD;&#x8C61;&#x7C7B;:</string></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class SampleFirstStartup : AndroidStartup&lt;String&gt;() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun callCreateOnMainThread(): Boolean = true</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun waitOnMainThread(): Boolean = false</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun create(context: Context): String? {</span><br><span class=\"line\">        // todo something</span><br><span class=\"line\">        return this.javaClass.simpleName</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun dependencies(): List&lt;Class&lt;out Startup&lt;*&gt;&gt;&gt;? {</span><br><span class=\"line\">        return null</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x56E0;&#x4E3A;SampleFirstStartup&#x5728;&#x6267;&#x884C;&#x4E4B;&#x524D;&#x4E0D;&#x9700;&#x8981;&#x4F9D;&#x8D56;&#x5176;&#x5B83;&#x7EC4;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x7684;dependencies()&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x8FD4;&#x56DE;&#x7A7A;&#xFF0C;&#x540C;&#x65F6;&#x5B83;&#x4F1A;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;&#x3002;</p>\n<blockquote>\n<p>&#x6CE8;&#x610F;&#xFF1A;&#xFE0F;&#x867D;&#x7136;waitOnMainThread()&#x8FD4;&#x56DE;&#x4E86;false&#xFF0C;&#x4F46;&#x7531;&#x4E8E;&#x5B83;&#x662F;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;&#xFF0C;&#x800C;&#x4E3B;&#x7EBF;&#x7A0B;&#x9ED8;&#x8BA4;&#x662F;&#x963B;&#x585E;&#x7684;&#xFF0C;&#x6240;&#x4EE5;callCreateOnMainThread()&#x8FD4;&#x56DE;true&#x65F6;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x8BBE;&#x7F6E;&#x5C06;&#x5931;&#x6548;&#x3002;</p>\n</blockquote>\n<p>&#x5047;&#x8BBE;&#x4F60;&#x8FD8;&#x9700;&#x8981;&#x5B9A;&#x4E49;SampleSecondStartup&#xFF0C;&#x5B83;&#x4F9D;&#x8D56;&#x4E8E;SampleFirstStartup&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5728;&#x6267;&#x884C;SampleSecondStartup&#x4E4B;&#x524D;SampleFirstStartup&#x5FC5;&#x987B;&#x5148;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class SampleSecondStartup : AndroidStartup&lt;Boolean&gt;() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun callCreateOnMainThread(): Boolean = false</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun waitOnMainThread(): Boolean = true</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun create(context: Context): Boolean {</span><br><span class=\"line\">        // &#x6A21;&#x4EFF;&#x6267;&#x884C;&#x8017;&#x65F6;</span><br><span class=\"line\">        Thread.sleep(5000)</span><br><span class=\"line\">        return true</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun dependencies(): List&lt;Class&lt;out Startup&lt;*&gt;&gt;&gt;? {</span><br><span class=\"line\">        return listOf(SampleFirstStartup::class.java)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;dependencies()&#x65B9;&#x6CD5;&#x4E2D;&#x8FD4;&#x56DE;&#x4E86;SampleFirstStartup&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x80FD;&#x4FDD;&#x8BC1;SampleFirstStartup&#x4F18;&#x5148;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x3002;<br>&#x5B83;&#x4F1A;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;&#xFF0C;&#x4F46;&#x7531;&#x4E8E;waitOnMainThread()&#x8FD4;&#x56DE;&#x4E86;true&#xFF0C;&#x6240;&#x4EE5;&#x4E3B;&#x7EBF;&#x7A0B;&#x4F1A;&#x963B;&#x585E;&#x7B49;&#x5F85;&#x76F4;&#x5230;&#x5B83;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#xFF0C;&#x4F60;&#x8FD8;&#x5B9A;&#x4E49;&#x4E86;<a href=\"https://github.com/idisfkj/android-startup/blob/master/app/src/main/java/com/rousetime/sample/startup/SampleThirdStartup.kt\" target=\"_blank\" rel=\"noopener\">SampleThirdStartup</a>&#x4E0E;<a href=\"https://github.com/idisfkj/android-startup/blob/master/app/src/main/java/com/rousetime/sample/startup/SampleFourthStartup.kt\" target=\"_blank\" rel=\"noopener\">SampleFourthStartup</a></p>\n<h3 id=\"Manifest&#x4E2D;&#x81EA;&#x52A8;&#x914D;&#x7F6E;\"><a href=\"#Manifest&#x4E2D;&#x81EA;&#x52A8;&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"Manifest&#x4E2D;&#x81EA;&#x52A8;&#x914D;&#x7F6E;\"></a>Manifest&#x4E2D;&#x81EA;&#x52A8;&#x914D;&#x7F6E;</h3><p>&#x7B2C;&#x4E00;&#x79CD;&#x521D;&#x59CB;&#x5316;&#x65B9;&#x6CD5;&#x662F;&#x5728;Manifest&#x4E2D;&#x8FDB;&#x884C;&#x81EA;&#x52A8;&#x914D;&#x7F6E;&#x3002;</p>\n<p>&#x5728;Android Startup&#x4E2D;&#x63D0;&#x4F9B;&#x4E86;StartupProvider&#x7C7B;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;content provider&#xFF0C;&#x63D0;&#x4F9B;&#x81EA;&#x52A8;&#x8BC6;&#x522B;&#x5728;manifest&#x4E2D;&#x914D;&#x7F6E;&#x7684;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#x3002;<br>&#x4E3A;&#x4E86;&#x8BA9;&#x5176;&#x80FD;&#x591F;&#x81EA;&#x52A8;&#x8BC6;&#x522B;&#xFF0C;&#x9700;&#x8981;&#x5728;StartupProvider&#x4E2D;&#x5B9A;&#x4E49;<meta-data>&#x6807;&#x7B7E;&#x3002;&#x5176;&#x4E2D;&#x7684;name&#x4E3A;&#x5B9A;&#x4E49;&#x7684;&#x7EC4;&#x4EF6;&#x7C7B;&#xFF0C;value&#x7684;&#x503C;&#x5BF9;&#x5E94;&#x4E3A;android.startup&#x3002;</meta-data></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;provider</span><br><span class=\"line\">    android:name=&quot;com.rousetime.android_startup.provider.StartupProvider&quot;</span><br><span class=\"line\">    android:authorities=&quot;${applicationId}.android_startup&quot;</span><br><span class=\"line\">    android:exported=&quot;false&quot;&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;meta-data</span><br><span class=\"line\">         android:name=&quot;com.rousetime.sample.startup.SampleFourthStartup&quot;</span><br><span class=\"line\">        android:value=&quot;android.startup&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;/provider&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x4F60;&#x4E0D;&#x9700;&#x8981;&#x5C06;SampleFirstStartup&#x3001;SampleSecondStartup&#x4E0E;SampleThirdStartup&#x6DFB;&#x52A0;&#x5230;<meta-data>&#x6807;&#x7B7E;&#x4E2D;&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x5728;SampleFourthStartup&#x4E2D;&#xFF0C;&#x5B83;&#x7684;dependencies()&#x4E2D;&#x4F9D;&#x8D56;&#x4E86;&#x8FD9;&#x4E9B;&#x7EC4;&#x4EF6;&#x3002;StartupProvider&#x4F1A;&#x81EA;&#x52A8;&#x8BC6;&#x522B;&#x5DF2;&#x7ECF;&#x58F0;&#x660E;&#x7684;&#x7EC4;&#x4EF6;&#x4E2D;&#x4F9D;&#x8D56;&#x7684;&#x5176;&#x5B83;&#x7EC4;&#x4EF6;&#x3002;</meta-data></p>\n<h3 id=\"Application&#x4E2D;&#x624B;&#x52A8;&#x914D;&#x7F6E;\"><a href=\"#Application&#x4E2D;&#x624B;&#x52A8;&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"Application&#x4E2D;&#x624B;&#x52A8;&#x914D;&#x7F6E;\"></a>Application&#x4E2D;&#x624B;&#x52A8;&#x914D;&#x7F6E;</h3><p>&#x7B2C;&#x4E8C;&#x79CD;&#x521D;&#x59CB;&#x5316;&#x65B9;&#x6CD5;&#x662F;&#x5728;Application&#x8FDB;&#x884C;&#x624B;&#x52A8;&#x914D;&#x7F6E;&#x3002;</p>\n<p>&#x624B;&#x52A8;&#x521D;&#x59CB;&#x5316;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5230;StartupManager.Builder()&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#x4F7F;&#x7528;StartupManager.Builder()&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x914D;&#x7F6E;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class SampleApplication : Application() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun onCreate() {</span><br><span class=\"line\">        super.onCreate()</span><br><span class=\"line\">        StartupManager.Builder()</span><br><span class=\"line\">            .addStartup(SampleFirstStartup())</span><br><span class=\"line\">            .addStartup(SampleSecondStartup())</span><br><span class=\"line\">            .addStartup(SampleThirdStartup())</span><br><span class=\"line\">            .addStartup(SampleFourthStartup())</span><br><span class=\"line\">            .build(this)</span><br><span class=\"line\">            .start()</span><br><span class=\"line\">            .await()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x4F60;&#x5F00;&#x542F;&#x4E86;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#xFF0C;&#x7136;&#x540E;&#x8FD0;&#x884C;&#x9879;&#x76EE;&#x4E4B;&#x540E;&#xFF0C;&#x5C06;&#x4F1A;&#x5728;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x8F93;&#x51FA;&#x7ECF;&#x8FC7;&#x62D3;&#x6251;&#x6392;&#x5E8F;&#x4F18;&#x5316;&#x4E4B;&#x540E;&#x7684;&#x521D;&#x59CB;&#x5316;&#x7EC4;&#x4EF6;&#x7684;&#x6267;&#x884C;&#x987A;&#x5E8F;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">D/StartupTrack: TopologySort result: </span><br><span class=\"line\">   ================================================ ordering start ================================================</span><br><span class=\"line\">   order [0] Class: SampleFirstStartup =&gt; Dependencies size: 0 =&gt; callCreateOnMainThread: true =&gt; waitOnMainThread: false</span><br><span class=\"line\">   order [1] Class: SampleSecondStartup =&gt; Dependencies size: 1 =&gt; callCreateOnMainThread: false =&gt; waitOnMainThread: true</span><br><span class=\"line\">   order [2] Class: SampleThirdStartup =&gt; Dependencies size: 2 =&gt; callCreateOnMainThread: false =&gt; waitOnMainThread: false</span><br><span class=\"line\">   order [3] Class: SampleFourthStartup =&gt; Dependencies size: 3 =&gt; callCreateOnMainThread: false =&gt; waitOnMainThread: false</span><br><span class=\"line\">   ================================================ ordering end ================================================</span><br></pre></td></tr></table></figure>\n<p>&#x5B8C;&#x6574;&#x7684;&#x4EE3;&#x7801;&#x5B9E;&#x4F8B;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x67E5;&#x770B;<a href=\"https://github.com/idisfkj/android-startup/tree/master/app\" target=\"_blank\" rel=\"noopener\">app</a>&#x83B7;&#x53D6;&#x3002;</p>\n<h2 id=\"&#x66F4;&#x591A;\"><a href=\"#&#x66F4;&#x591A;\" class=\"headerlink\" title=\"&#x66F4;&#x591A;\"></a>&#x66F4;&#x591A;</h2><h3 id=\"&#x53EF;&#x9009;&#x914D;&#x7F6E;\"><a href=\"#&#x53EF;&#x9009;&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"&#x53EF;&#x9009;&#x914D;&#x7F6E;\"></a>&#x53EF;&#x9009;&#x914D;&#x7F6E;</h3><ul>\n<li><p>LoggerLevel: &#x63A7;&#x5236;Android Startup&#x4E2D;&#x7684;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#xFF0C;&#x53EF;&#x9009;&#x503C;&#x5305;&#x62EC;LoggerLevel.NONE, LoggerLevel.ERROR and LoggerLevel.DEBUG&#x3002;</p>\n</li>\n<li><p>AwaitTimeout: &#x63A7;&#x5236;Android Startup&#x4E2D;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;&#x8D85;&#x65F6;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#xFF0C;&#x5373;&#x963B;&#x585E;&#x7684;&#x6700;&#x957F;&#x65F6;&#x95F4;&#x3002;</p>\n</li>\n</ul>\n<h3 id=\"Manifest&#x4E2D;&#x914D;&#x7F6E;\"><a href=\"#Manifest&#x4E2D;&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"Manifest&#x4E2D;&#x914D;&#x7F6E;\"></a>Manifest&#x4E2D;&#x914D;&#x7F6E;</h3><p>&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x914D;&#x7F6E;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x7C7B;&#x53BB;&#x5B9E;&#x73B0;StartupProviderConfig&#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x4E14;&#x5B9E;&#x73B0;&#x5B83;&#x7684;&#x5BF9;&#x5E94;&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class SampleStartupProviderConfig : StartupProviderConfig {</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun getConfig(): StartupConfig =</span><br><span class=\"line\">        StartupConfig.Builder()</span><br><span class=\"line\">            .setLoggerLevel(LoggerLevel.DEBUG)</span><br><span class=\"line\">            .setAwaitTimeout(12000L)</span><br><span class=\"line\">            .build()</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0E;&#x6B64;&#x540C;&#x65F6;&#xFF0C;&#x4F60;&#x8FD8;&#x9700;&#x8981;&#x5728;manifest&#x4E2D;&#x8FDB;&#x884C;&#x914D;&#x7F6E;StartupProviderConfig&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;provider</span><br><span class=\"line\">     android:name=&quot;com.rousetime.android_startup.provider.StartupProvider&quot;</span><br><span class=\"line\">    android:authorities=&quot;${applicationId}.android_startup&quot;</span><br><span class=\"line\">    android:exported=&quot;false&quot;&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;meta-data</span><br><span class=\"line\">         android:name=&quot;com.rousetime.sample.startup.SampleStartupProviderConfig&quot;</span><br><span class=\"line\">         android:value=&quot;android.startup.provider.config&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;/provider&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x7ECF;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x914D;&#x7F6E;&#xFF0C;StartupProvider&#x4F1A;&#x81EA;&#x52A8;&#x89E3;&#x6790;SampleStartupProviderConfig&#x3002;</p>\n<h3 id=\"Application&#x4E2D;&#x914D;&#x7F6E;\"><a href=\"#Application&#x4E2D;&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"Application&#x4E2D;&#x914D;&#x7F6E;\"></a>Application&#x4E2D;&#x914D;&#x7F6E;</h3><p>&#x5728;Application&#x9700;&#x8981;&#x501F;&#x52A9;StartupManager.Builder()&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun onCreate() {</span><br><span class=\"line\">    super.onCreate()</span><br><span class=\"line\"> </span><br><span class=\"line\">    val config = StartupConfig.Builder()</span><br><span class=\"line\">        .setLoggerLevel(LoggerLevel.DEBUG)</span><br><span class=\"line\">        .setAwaitTimeout(12000L)</span><br><span class=\"line\">        .build()</span><br><span class=\"line\"> </span><br><span class=\"line\">    StartupManager.Builder()</span><br><span class=\"line\">        .setConfig(config)</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        .build(this)</span><br><span class=\"line\">        .start()</span><br><span class=\"line\">        .await()</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x65B9;&#x6CD5;\"><a href=\"#&#x65B9;&#x6CD5;\" class=\"headerlink\" title=\"&#x65B9;&#x6CD5;\"></a>&#x65B9;&#x6CD5;</h3><h4 id=\"AndroidStartup\"><a href=\"#AndroidStartup\" class=\"headerlink\" title=\"AndroidStartup\"></a>AndroidStartup</h4><ul>\n<li><p>createExecutor(): Executor: &#x5982;&#x679C;&#x5B9A;&#x4E49;&#x7684;&#x7EC4;&#x4EF6;&#x6CA1;&#x6709;&#x8FD0;&#x884C;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BE5;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x63A7;&#x5236;&#x8FD0;&#x884C;&#x7684;&#x5B50;&#x7EBF;&#x7A0B;&#x3002;</p>\n</li>\n<li><p>onDependenciesCompleted(startup: Startup&lt;*&gt;, result: Any?): &#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x5728;&#x6BCF;&#x4E00;&#x4E2A;&#x4F9D;&#x8D56;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#x8FDB;&#x884C;&#x56DE;&#x8C03;&#x3002;</p>\n</li>\n</ul>\n<h2 id=\"&#x5B9E;&#x6218;&#x6D4B;&#x8BD5;\"><a href=\"#&#x5B9E;&#x6218;&#x6D4B;&#x8BD5;\" class=\"headerlink\" title=\"&#x5B9E;&#x6218;&#x6D4B;&#x8BD5;\"></a>&#x5B9E;&#x6218;&#x6D4B;&#x8BD5;</h2><p><a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x4E2D;&#x4F7F;&#x7528;&#x4E86;<a href=\"https://github.com/idisfkj/android-startup\" target=\"_blank\" rel=\"noopener\">Android Startup</a>&#xFF0C;&#x4F18;&#x5316;&#x914D;&#x7F6E;&#x7684;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x95F4;&#x4E0E;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#x7684;&#x914D;&#x7F6E;&#x6CE8;&#x5165;&#x65F6;&#x673A;&#xFF0C;&#x4F7F;&#x7528;&#x524D;&#x4E0E;&#x4F7F;&#x7528;&#x540E;&#x65F6;&#x95F4;&#x5BF9;&#x6BD4;:</p>\n<p><img src=\"/2020/08/05/&#x6211;&#x4E3A;&#x4F55;&#x5F03;&#x7528;Jetpack&#x7684;App-Startup/2.jpg\" alt></p>\n<h2 id=\"AwesomeGithub\"><a href=\"#AwesomeGithub\" class=\"headerlink\" title=\"AwesomeGithub\"></a>AwesomeGithub</h2><p><a href=\"https://github.com/idisfkj/AwesomeGithub/tree/master\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x662F;&#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><img src=\"/2020/08/05/&#x6211;&#x4E3A;&#x4F55;&#x5F03;&#x7528;Jetpack&#x7684;App-Startup/awesome_github.png\" alt><br>&#x9664;&#x4E86;Android&#x539F;&#x751F;&#x7248;&#x672C;&#xFF0C;&#x8FD8;&#x6709;&#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x559C;&#x6B22;&#x6211;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x6211;&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF1A;&#x3010;Android&#x8865;&#x7ED9;&#x7AD9;&#x3011;&#x6216;&#x8005;&#x626B;&#x63CF;&#x4E0B;&#x65B9;&#x4E8C;&#x7EF4;&#x7801;&#x8FDB;&#x884C;&#x5173;&#x6CE8;&#xFF0C;&#x5F53;&#x7136;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5173;&#x6CE8;&#x5F53;&#x524D;&#x7F51;&#x7AD9;&#x7684;&#x5E10;&#x53F7;&#x3002;&#x4E3B;&#x8981;&#x533A;&#x522B;&#x5C31;&#x662F;&#x5FAE;&#x4FE1;&#x80FD;&#x591F;&#x66F4;&#x65B9;&#x6CD5;&#x4E92;&#x52A8;&#x3002;</p>\n<blockquote>\n<p>&#x516C;&#x4F17;&#x53F7;&#x66F4;&#x65B0;&#x4E0D;&#x4F1A;&#x5F88;&#x9891;&#x7E41;&#xFF0C;&#x4F46;&#x4E00;&#x65E6;&#x66F4;&#x65B0;&#x5FC5;&#x5B9A;&#x662F;&#x7EAF;&#x5E72;&#x8D27;&#x3002;</p>\n</blockquote>\n<p><img src=\"/2020/08/05/&#x6211;&#x4E3A;&#x4F55;&#x5F03;&#x7528;Jetpack&#x7684;App-Startup/Android&#x8865;&#x7ED9;&#x7AD9;.jpg\" alt></p>\n","categories":["android"],"tags":["jetpack"]},{"title":"Android Hilt实战初体验: Dagger替换成Hilt","url":"https://www.rousetime.com/2020/07/16/Android-Hilt实战初体验-Dagger替换成Hilt/","content":"<p>&#x5728;&#x7EC4;&#x4EF6;&#x5316;<a href=\"https://github.com/idisfkj/AwesomeGithub/tree/feat_dagger\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Dagger&#x6765;&#x51CF;&#x5C11;&#x624B;&#x52A8;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;&#x4EE3;&#x7801;&#x3002;&#x867D;&#x7136;&#x5B83;&#x80FD;&#x81EA;&#x52A8;&#x5316;&#x5E2E;&#x6211;&#x4EEC;&#x7BA1;&#x7406;&#x4F9D;&#x8D56;&#x9879;&#xFF0C;&#x4F46;&#x662F;&#x5199;&#x8FC7;&#x4E4B;&#x540E;&#x7684;&#x5E94;&#x8BE5;&#x90FD;&#x4F1A;&#x4F53;&#x4F1A;&#x5230;&#x5B83;&#x8FD8;&#x662F;&#x6709;&#x70B9;&#x7E41;&#x7410;&#x7684;&#x3002;&#x9879;&#x76EE;&#x4E2D;&#x5230;&#x5904;&#x5145;&#x65A5;&#x7740;Component&#xFF0C;&#x8FD9;&#x8BA9;&#x6211;&#x60F3;&#x8D77;&#x4E86;&#x4F20;&#x7EDF;MVP&#x6A21;&#x5F0F;&#x7684;&#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x3002;</p>\n<p>&#x7B80;&#x5355;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#x8D39;&#x52B2;&#xFF0C;&#x6709;&#x8BB8;&#x591A;&#x5927;&#x91CF;&#x7684;&#x7C7B;&#x4F3C;&#x5B9A;&#x4E49;&#x3002;&#x53EF;&#x80FD;google&#x4E5F;&#x610F;&#x8BC6;&#x5230;&#x8FD9;&#x4E00;&#x70B9;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x524D;&#x4E0D;&#x4E45;&#x53D1;&#x5E03;&#x51FA;&#x4E86;Hilt&#x3002;</p>\n<h2 id=\"Hilt\"><a href=\"#Hilt\" class=\"headerlink\" title=\"Hilt\"></a>Hilt</h2><p>&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x6CA1;&#x542C;&#x8BF4;&#x8FC7;&#x7684;&#x5C0F;&#x4F19;&#x4F34;&#x4EEC;&#x4E00;&#x5934;&#x96FE;&#x6C34;&#xFF0C;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x6765;&#x4E86;&#x89E3;&#x4E0B;Hilt&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</p>\n<p>Hilt&#x662F;Android&#x7684;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;&#x5E93;&#xFF0C;&#x53EF;&#x51CF;&#x5C11;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x6267;&#x884C;&#x624B;&#x52A8;&#x4F9D;&#x8D56;&#x9879;&#x6CE8;&#x5165;&#x7684;&#x6837;&#x677F;&#x4EE3;&#x7801;&#x3002;</p>\n<p>Hilt&#x901A;&#x8FC7;&#x4E3A;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A; Android &#x7C7B;&#x63D0;&#x4F9B;&#x5BB9;&#x5668;&#x5E76;&#x81EA;&#x52A8;&#x7BA1;&#x7406;&#x5176;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x5728;&#x5E94;&#x7528;&#x4E2D;&#x4F7F;&#x7528; DI&#xFF08;&#x4F9D;&#x8D56;&#x9879;&#x6CE8;&#x5165;&#xFF09;&#x7684;&#x6807;&#x51C6;&#x65B9;&#x6CD5;&#x3002;Hilt &#x5728;Dagger &#x7684;&#x57FA;&#x7840;&#x4E0A;&#x6784;&#x5EFA;&#x800C;&#x6210;&#xFF0C;&#x56E0;&#x800C;&#x80FD;&#x591F;&#x5177;&#x6709; Dagger &#x7684;&#x7F16;&#x8BD1;&#x65F6;&#x6B63;&#x786E;&#x6027;&#x3001;&#x8FD0;&#x884C;&#x65F6;&#x6027;&#x80FD;&#x3001;&#x53EF;&#x4F38;&#x7F29;&#x6027;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x6709;&#x7684;&#x5C0F;&#x4F19;&#x4F34;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x7591;&#x95EE;&#xFF0C;&#x65E2;&#x7136;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;Dagger&#x90A3;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD8;&#x8981;Hilt&#x7684;&#x5462;&#xFF1F;</p>\n<p>Hilt&#x4E0E;Dagger&#x7684;&#x4E3B;&#x8981;&#x76EE;&#x6807;&#x90FD;&#x662F;&#x4E00;&#x81F4;&#x7684;&#xFF1A;</p>\n<ol>\n<li>&#x7B80;&#x5316; Android &#x5E94;&#x7528;&#x7684; Dagger &#x76F8;&#x5173;&#x57FA;&#x7840;&#x67B6;&#x6784;&#x3002;</li>\n<li>&#x521B;&#x5EFA;&#x4E00;&#x7EC4;&#x6807;&#x51C6;&#x7684;&#x7EC4;&#x4EF6;&#x548C;&#x4F5C;&#x7528;&#x57DF;&#xFF0C;&#x4EE5;&#x7B80;&#x5316;&#x8BBE;&#x7F6E;&#x3001;&#x63D0;&#x9AD8;&#x53EF;&#x8BFB;&#x6027;&#x4EE5;&#x53CA;&#x5728;&#x5E94;&#x7528;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#x4EE3;&#x7801;&#x3002;</li>\n<li>&#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x4E3A;&#x5404;&#x79CD;&#x6784;&#x5EFA;&#x7C7B;&#x578B;&#xFF08;&#x5982;&#x6D4B;&#x8BD5;&#x3001;&#x8C03;&#x8BD5;&#x6216;&#x53D1;&#x5E03;&#xFF09;&#x914D;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x7ED1;&#x5B9A;&#x3002;</li>\n</ol>\n<p>&#x4F46;&#x662F;Android&#x4E2D;&#x4F1A;&#x5B9E;&#x4F8B;&#x5316;&#x8BB8;&#x591A;&#x7EC4;&#x4EF6;&#x7C7B;&#xFF0C;&#x4F8B;&#x5982;Activity&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x5E94;&#x7528;&#x4E2D;&#x4F7F;&#x7528;Dagger&#x9700;&#x8981;&#x5F00;&#x53D1;&#x8005;&#x7F16;&#x5199;&#x5927;&#x91CF;&#x7684;&#x6837;&#x677F;&#x4EE3;&#x7801;&#x3002;Hilt&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x8FD9;&#x4E9B;&#x6837;&#x677F;&#x4EE3;&#x7801;&#x3002;</p>\n<p>Hilt&#x505A;&#x7684;&#x4F18;&#x5316;&#x5305;&#x62EC;</p>\n<ol>\n<li>&#x65E0;&#x9700;&#x7F16;&#x5199;&#x5927;&#x91CF;&#x7684;Component&#x4EE3;&#x7801;</li>\n<li>Scope&#x4E5F;&#x4F1A;&#x4E0E;Component&#x81EA;&#x52A8;&#x7ED1;&#x5B9A;</li>\n<li>&#x9884;&#x5B9A;&#x4E49;&#x7ED1;&#x5B9A;&#xFF0C;&#x4F8B;&#x5982; Application&#x4E0E;Activity</li>\n<li>&#x9884;&#x5B9A;&#x4E49;&#x7684;&#x9650;&#x5B9A;&#x7B26;&#xFF0C;&#x4F8B;&#x5982;@ApplicationContext&#x4E0E;@ActivityContext</li>\n</ol>\n<p>&#x4E0B;&#x9762;&#x901A;&#x8FC7;<a href=\"https://github.com/idisfkj/AwesomeGithub/tree/feat_dagger\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x4E2D;Dagger&#x6765;&#x5BF9;&#x6BD4;&#x4E86;&#x89E3;Hilt&#x7684;&#x5177;&#x4F53;&#x4F7F;&#x7528;&#x3002;</p>\n<h2 id=\"&#x4F9D;&#x8D56;\"><a href=\"#&#x4F9D;&#x8D56;\" class=\"headerlink\" title=\"&#x4F9D;&#x8D56;\"></a>&#x4F9D;&#x8D56;</h2><p>&#x4F7F;&#x7528;&#x4E4B;&#x524D;&#x5C06;Hilt&#x7684;&#x4F9D;&#x8D56;&#x6DFB;&#x52A0;&#x5230;&#x9879;&#x76EE;&#x4E2D;&#x3002;</p>\n<p>&#x9996;&#x5148;&#xFF0C;&#x5C06;hilt-android-gradle-plugin&#x63D2;&#x4EF6;&#x6DFB;&#x52A0;&#x5230;&#x9879;&#x76EE;&#x7684;&#x6839;&#x7EA7; build.gradle&#x6587;&#x4EF6;&#x4E2D;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buildscript {</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    dependencies {</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        classpath &apos;com.google.dagger:hilt-android-gradle-plugin:2.28-alpha&apos;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#xFF0C;&#x5E94;&#x7528;Gradle&#x63D2;&#x4EF6;&#x5E76;&#x5728;app/build.gradle&#x6587;&#x4EF6;&#x4E2D;&#x6DFB;&#x52A0;&#x4EE5;&#x4E0B;&#x4F9D;&#x8D56;&#x9879;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">apply plugin: &apos;kotlin-kapt&apos;</span><br><span class=\"line\">apply plugin: &apos;dagger.hilt.android.plugin&apos;</span><br><span class=\"line\"> </span><br><span class=\"line\">android {</span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">dependencies {</span><br><span class=\"line\">    implementation &quot;com.google.dagger:hilt-android:2.28-alpha&quot;</span><br><span class=\"line\">    kapt &quot;com.google.dagger:hilt-android-compiler:2.28-alpha&quot;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"Application&#x7C7B;\"><a href=\"#Application&#x7C7B;\" class=\"headerlink\" title=\"Application&#x7C7B;\"></a>Application&#x7C7B;</h2><p>&#x4F7F;&#x7528;Dagger&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x4E00;&#x4E2A;AppComponent&#x5355;&#x4F8B;&#x7EC4;&#x4EF6;&#xFF0C;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x5176;&#x5B83;SubComponent&#x90FD;&#x5C06;&#x4F9D;&#x8D56;&#x4E8E;&#x5B83;&#xFF0C;&#x6240;&#x4EE5;&#x5728;<a href=\"https://github.com/idisfkj/AwesomeGithub/tree/feat_dagger\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x4E2D;&#x5B83;&#x5927;&#x6982;&#x662F;&#x8FD9;&#x4E2A;&#x6837;&#x5B50;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Singleton</span><br><span class=\"line\">@Component(</span><br><span class=\"line\">    modules = [</span><br><span class=\"line\">        SubComponentModule::class,</span><br><span class=\"line\">        NetworkModule::class,</span><br><span class=\"line\">        ViewModelBuilderModule::class</span><br><span class=\"line\">    ]</span><br><span class=\"line\">)</span><br><span class=\"line\">interface AppComponent {</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Component.Factory</span><br><span class=\"line\">    interface Factory {</span><br><span class=\"line\">        fun create(@BindsInstance applicationContext: Context): AppComponent</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    fun welcomeComponent(): WelcomeComponent.Factory</span><br><span class=\"line\"> </span><br><span class=\"line\">    fun mainComponent(): MainComponent.Factory</span><br><span class=\"line\">     </span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    fun loginComponent(): LoginComponent.Factory</span><br><span class=\"line\"> </span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">@Module(</span><br><span class=\"line\">    subcomponents = [</span><br><span class=\"line\">        WelcomeComponent::class,</span><br><span class=\"line\">        MainComponent::class,</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        LoginComponent::class</span><br><span class=\"line\">    ]</span><br><span class=\"line\">)</span><br><span class=\"line\">object SubComponentModule</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x7684;&#x6211;&#x5DF2;&#x7ECF;&#x7701;&#x7565;&#x4E86;&#x5927;&#x534A;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x591A;&#xFF0C;&#x800C;&#x4E14;&#x6700;&#x91CD;&#x8981;&#x7684;&#x662F;&#x5F88;&#x591A;&#x91CD;&#x590D;&#x7684;&#x7ED3;&#x6784;&#x57FA;&#x672C;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;&#x6240;&#x4EE5;Hilt&#x57FA;&#x4E8E;&#x8FD9;&#x4E00;&#x70B9;&#x8FDB;&#x884C;&#x4E86;&#x7B80;&#x5316;&#xFF0C;&#x5C06;&#x8FD9;&#x4E9B;&#x91CD;&#x590D;&#x7684;&#x7F16;&#x5199;&#x8F6C;&#x6210;&#x6784;&#x5EFA;&#x7684;&#x65F6;&#x5019;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x3002;</p>\n<p>Hilt&#x8981;&#x505A;&#x7684;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x6DFB;&#x52A0;&#x51E0;&#x4E2A;&#x6CE8;&#x91CA;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@HiltAndroidApp</span><br><span class=\"line\">class App : Application() { ... }</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x6709;&#x7684;Hilt&#x5E94;&#x7528;&#x90FD;&#x5FC5;&#x987B;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x5E26;@HiltAndroidApp&#x6CE8;&#x91CA;&#x7684;Application&#x3002;&#x5B83;&#x5C06;&#x66FF;&#x4EE3;Dagger&#x4E2D;&#x7684;AppComponent&#x3002;</p>\n<h2 id=\"Android&#x7C7B;\"><a href=\"#Android&#x7C7B;\" class=\"headerlink\" title=\"Android&#x7C7B;\"></a>Android&#x7C7B;</h2><p>&#x5BF9;&#x4E8E;Android&#x7C7B;&#xFF0C;&#x4F7F;&#x7528;Dagger&#x65F6;&#x9700;&#x8981;&#x5B9A;&#x4E49;SubComponent&#x5E76;&#x5C06;&#x5B83;&#x4F9D;&#x8D56;&#x5230;Application&#x7C7B;&#x4E2D;&#x3002;&#x4E0B;&#x9762;&#x4EE5;WelcomeActivity&#x4E3A;&#x4F8B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Subcomponent(modules = [WelcomeModule::class])</span><br><span class=\"line\">interface WelcomeComponent {</span><br><span class=\"line\">    @Subcomponent.Factory</span><br><span class=\"line\">    interface Factory {</span><br><span class=\"line\">        fun create(): WelcomeComponent</span><br><span class=\"line\">    }</span><br><span class=\"line\">    fun inject(activity: WelcomeActivity)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>module&#x7684;&#x90E8;&#x5206;&#x5148;&#x4E0D;&#x8BF4;&#xFF0C;&#x540E;&#x9762;&#x4F1A;&#x63D0;&#x53CA;</p>\n</blockquote>\n<p>&#x4E0B;&#x9762;&#x770B;Hilt&#x7684;&#x5B9E;&#x73B0;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@AndroidEntryPoint</span><br><span class=\"line\">class MainActivity : BaseHiltActivity&lt;ActivityMainBinding, MainVM&gt;() { ... }</span><br></pre></td></tr></table></figure>\n<p>Hilt&#x8981;&#x505A;&#x7684;&#x662F;&#x6DFB;&#x52A0;@AndroidEntryPoint&#x6CE8;&#x91CA;&#x5373;&#x53EF;&#x3002;</p>\n<p>&#x60CA;&#x8BB6;&#xFF0C;&#x7ED3;&#x5408;&#x4E0A;&#x9762;&#x7684;&#xFF0C;&#x4E24;&#x4E2A;&#x6CE8;&#x89E3;&#x5C31;&#x66FF;&#x6362;&#x4E86;Dagger&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x73B0;&#x5728;&#x662F;&#x5426;&#x4F53;&#x4F1A;&#x5230;Hilt&#x7684;&#x7B80;&#x6D01;&#xFF1F;&#x5BF9;&#x65B0;&#x624B;&#x6765;&#x8BF4;&#x4E5F;&#x53EF;&#x4EE5;&#x964D;&#x4F4E;&#x5F88;&#x5927;&#x7684;&#x5B66;&#x4E60;&#x6210;&#x672C;&#x3002;</p>\n<p>&#x76EE;&#x524D;Hilt&#x652F;&#x6301;&#x4E0B;&#x9762;Android&#x7C7B;</p>\n<ol>\n<li>Application (@HiltAndroidApp)</li>\n<li>Activity</li>\n<li>Fragment</li>\n<li>View</li>\n<li>Searvice</li>\n<li>BroadcastReceiver<br>&#x6709;&#x4E00;&#x70B9;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;@AndroidEntryPoint&#x6CE8;&#x91CA;&#x4E86;&#x67D0;&#x4E2A;&#x7C7B;&#xFF0C;&#x90A3;&#x4E48;&#x4F9D;&#x8D56;&#x8BE5;&#x7C7B;&#x7684;&#x5176;&#x5B83;&#x7C7B;&#x4E5F;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x3002;</li>\n</ol>\n<p>&#x5178;&#x578B;&#x7684;&#x5C31;&#x662F;Fragment&#xFF0C;&#x6240;&#x4EE5;&#x9664;&#x4E86;Fragment&#x8FD8;&#x9700;&#x8981;&#x7ED9;&#x4F9D;&#x8D56;&#x5B83;&#x7684;&#x6240;&#x6709;Activity&#x8FDB;&#x884C;&#x6CE8;&#x91CA;&#x3002;</p>\n<p>@AndroidEntryPoint&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x5BF9;&#x7167;&#x4E00;&#x4E0B;Dagger&#x5C31;&#x77E5;&#x9053;&#x4E86;&#x3002;&#x5B83;&#x4F1A;&#x81EA;&#x52A8;&#x5E2E;&#x6211;&#x4EEC;&#x751F;&#x6210;&#x5BF9;&#x5E94;Android&#x7C7B;&#x7684;Componennt&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x6DFB;&#x52A0;&#x5230;Application&#x7C7B;&#x4E2D;&#x3002;</p>\n<h2 id=\"Inject\"><a href=\"#Inject\" class=\"headerlink\" title=\"@Inject\"></a>@Inject</h2><p>@Inject&#x7684;&#x4F7F;&#x7528;&#x57FA;&#x672C;&#x4E0E;Dagger&#x4E00;&#x81F4;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x5B9A;&#x4E49;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x6216;&#x8005;&#x5B57;&#x6BB5;&#xFF0C;&#x58F0;&#x660E;&#x8BE5;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x6216;&#x8005;&#x5B57;&#x6BB5;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x4F9D;&#x8D56;&#x83B7;&#x53D6;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class UserRepository @Inject constructor(</span><br><span class=\"line\">    private val service: GithubService</span><br><span class=\"line\">) : BaseRepository() { ... }</span><br></pre></td></tr></table></figure>\n<h2 id=\"Module\"><a href=\"#Module\" class=\"headerlink\" title=\"@Module\"></a>@Module</h2><p>Hilt&#x6A21;&#x5757;&#x4E5F;&#x9700;&#x8981;&#x6DFB;&#x52A0;@Module&#x6CE8;&#x91CA;&#xFF0C;&#x4E0E;Dagger&#x4E0D;&#x540C;&#x7684;&#x662F;&#x5B83;&#x8FD8;&#x5FC5;&#x987B;&#x4F7F;&#x7528;@InstallIn&#x4E3A;&#x6A21;&#x5757;&#x6DFB;&#x52A0;&#x6CE8;&#x91CA;&#x3002;&#x76EE;&#x7684;&#x662F;&#x544A;&#x77E5;&#x6A21;&#x5757;&#x7528;&#x5728;&#x54EA;&#x4E2A;Android&#x7C7B;&#x4E2D;&#x3002;</p>\n<h3 id=\"Binds\"><a href=\"#Binds\" class=\"headerlink\" title=\"@Binds\"></a>@Binds</h3><p>@Binds&#x6CE8;&#x91CA;&#x4F1A;&#x544A;&#x77E5;Hilt&#x5728;&#x9700;&#x8981;&#x63D0;&#x4F9B;&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x4F8B;&#x65F6;&#x8981;&#x4F7F;&#x7528;&#x54EA;&#x79CD;&#x5B9E;&#x73B0;&#x3002;<br>&#x5B83;&#x7684;&#x7528;&#x6CD5;&#x4E0E;Dagger&#x6CA1;&#x4EC0;&#x4E48;&#x533A;&#x522B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Module</span><br><span class=\"line\">@InstallIn(ActivityComponent::class)</span><br><span class=\"line\">abstract class WelcomeModule {</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Binds</span><br><span class=\"line\">    @IntoMap</span><br><span class=\"line\">    @ViewModelKey(WelcomeVM::class)</span><br><span class=\"line\">    abstract fun bindViewModel(viewModel: WelcomeVM): ViewModel</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0D;&#x540C;&#x7684;&#x662F;&#x9700;&#x8981;&#x6DFB;&#x52A0;@InstallIn&#xFF0C;ActivityComponent::class&#x7528;&#x6765;&#x8868;&#x660E;&#x8BE5;&#x6A21;&#x5757;&#x4F5C;&#x7528;&#x8303;&#x56F4;&#x4E3A;Activity</p>\n<blockquote>\n<p>&#x5176;&#x5B9E;&#x4E0A;&#x9762;&#x8FD9;&#x5757;&#x5BF9;ViewModel&#x7684;&#x6CE8;&#x5165;&#xFF0C;&#x4F7F;&#x7528;Hilt&#x65F6;&#x4F1A;&#x81EA;&#x52A8;&#x5E2E;&#x6211;&#x4EEC;&#x7F16;&#x5199;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x5C55;&#x793A;&#x4E0E;Dagger&#x7684;&#x4E0D;&#x540C;&#x4E4B;&#x5904;&#x3002;&#x540E;&#x7EED;&#x4F1A;&#x63D0;&#x5230;ViewModel&#x7684;&#x6CE8;&#x5165;&#x3002;</p>\n</blockquote>\n<h3 id=\"Providers\"><a href=\"#Providers\" class=\"headerlink\" title=\"@Providers\"></a>@Providers</h3><p>&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;FragmentManager&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x9996;&#x5148;&#x662F;Dagger&#x7684;&#x4F7F;&#x7528;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Module</span><br><span class=\"line\">class MainProviderModule(private val activity: FragmentActivity) {</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Provides</span><br><span class=\"line\">    fun providersFragmentManager(): FragmentManager = activity.supportFragmentManager</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x6BD4;&#x4E00;&#x4E0B;Hilt</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@InstallIn(ActivityComponent::class)</span><br><span class=\"line\">@Module</span><br><span class=\"line\">object MainProviderModule {</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Provides</span><br><span class=\"line\">    fun providerFragmentManager(@ActivityContext context: Context) = (context as FragmentActivity).supportFragmentManager</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x533A;&#x522B;&#x662F;&#x5728;Hilt&#x4E2D;@Providers&#x5FC5;&#x987B;&#x4E3A;static&#x7C7B;&#x5E76;&#x4E14;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E0D;&#x80FD;&#x6709;&#x53C2;&#x6570;&#x3002;</p>\n<blockquote>\n<p>@ActivityContext&#x662F;Hilt&#x63D0;&#x4F9B;&#x7684;&#x9884;&#x5B9A;&#x9650;&#x5B9A;&#x7B26;&#xFF0C;&#x5B83;&#x80FD;&#x63D0;&#x4F9B;&#x6765;&#x81EA;&#x4E0E;Activity&#x7684;Context&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x8FD8;&#x6709;@ApplicationContext</p>\n</blockquote>\n<h2 id=\"&#x63D0;&#x4F9B;&#x7684;&#x7EC4;&#x4EF6;\"><a href=\"#&#x63D0;&#x4F9B;&#x7684;&#x7EC4;&#x4EF6;\" class=\"headerlink\" title=\"&#x63D0;&#x4F9B;&#x7684;&#x7EC4;&#x4EF6;\"></a>&#x63D0;&#x4F9B;&#x7684;&#x7EC4;&#x4EF6;</h2><p>&#x5BF9;&#x4E8E;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;@InstallIn&#x4F1A;&#x5173;&#x8054;&#x4E0D;&#x540C;&#x7684;Android&#x7C7B;&#xFF0C;&#x9664;&#x4E86;@ActivityComponent&#x8FD8;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;</p>\n<p><img src=\"/2020/07/16/Android-Hilt&#x5B9E;&#x6218;&#x521D;&#x4F53;&#x9A8C;-Dagger&#x66FF;&#x6362;&#x6210;Hilt/hilt_1.png\" alt><br>&#x5BF9;&#x5E94;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x5982;&#x4E0B;</p>\n<p><img src=\"/2020/07/16/Android-Hilt&#x5B9E;&#x6218;&#x521D;&#x4F53;&#x9A8C;-Dagger&#x66FF;&#x6362;&#x6210;Hilt/hilt_2.png\" alt><br>&#x540C;&#x65F6;&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x76F8;&#x5E94;&#x7684;&#x4F5C;&#x7528;&#x57DF;</p>\n<p><img src=\"/2020/07/16/Android-Hilt&#x5B9E;&#x6218;&#x521D;&#x4F53;&#x9A8C;-Dagger&#x66FF;&#x6362;&#x6210;Hilt/hilt_3.png\" alt><br>&#x6240;&#x4EE5;Hilt&#x7684;&#x9ED8;&#x8BA4;&#x63D0;&#x4F9B;&#x5C06;&#x5927;&#x5E45;&#x63D0;&#x9AD8;&#x5F00;&#x53D1;&#x6548;&#x7387;&#xFF0C;&#x51CF;&#x5C11;&#x8BB8;&#x591A;&#x91CD;&#x590D;&#x7684;&#x5B9A;&#x4E49;</p>\n<h2 id=\"ViewModel\"><a href=\"#ViewModel\" class=\"headerlink\" title=\"ViewModel\"></a>ViewModel</h2><p>&#x6700;&#x540E;&#x518D;&#x6765;&#x8BF4;&#x4E0B;ViewModel&#x7684;&#x6CE8;&#x5165;&#x3002;&#x5982;&#x679C;&#x4F60;&#x4F7F;&#x7528;&#x5230;&#x4E86;Jetpack&#x76F8;&#x4FE1;&#x5C11;&#x4E0D;&#x4E86;&#x5B83;&#x7684;&#x6CE8;&#x5165;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;Dagger&#x6211;&#x4EEC;&#x9700;&#x8981;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;ViewModelFactory&#xFF0C;&#x5E76;&#x4E14;&#x63D0;&#x4F9B;&#x6CE8;&#x5165;&#x65B9;&#x5F0F;&#xFF0C;&#x4F8B;&#x5982;&#x5728;<a href=\"https://github.com/idisfkj/AwesomeGithub/tree/feat_dagger\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x7684;componentbridget&#x6A21;&#x5757;&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;ViewModelFactory</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Module</span><br><span class=\"line\">abstract class ViewModelBuilderModule {</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Binds</span><br><span class=\"line\">    abstract fun bindViewModelFactory(factory: ViewModelFactory): ViewModelProvider.Factory</span><br><span class=\"line\">  </span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">class ViewModelFactory @Inject constructor(private val creators: @JvmSuppressWildcards Map&lt;Class&lt;out ViewModel&gt;, Provider&lt;ViewModel&gt;&gt;) : ViewModelProvider.Factory {</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun &lt;T : ViewModel?&gt; create(modelClass: Class&lt;T&gt;): T {</span><br><span class=\"line\">        var creator = creators[modelClass]</span><br><span class=\"line\">        if (creator == null) {</span><br><span class=\"line\">            for ((key, value) in creators) {</span><br><span class=\"line\">                if (modelClass.isAssignableFrom(key)) {</span><br><span class=\"line\">                    creator = value</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        if (creator == null) {</span><br><span class=\"line\">            throw IllegalArgumentException(&quot;Unknown model class: $modelClass&quot;)</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        try {</span><br><span class=\"line\">            @Suppress(&quot;UNCHECKED_CAST&quot;)</span><br><span class=\"line\">            return creator.get() as T</span><br><span class=\"line\">        } catch (e: Exception) {</span><br><span class=\"line\">            throw RuntimeException()</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;@Inject&#x6765;&#x6CE8;&#x5165;&#x6784;&#x9020;&#x5B9E;&#x4F8B;&#xFF0C;&#x4F46;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#x9700;&#x8981;&#x63D0;&#x4F9B;Map&#x7C7B;&#x578B;&#x7684;creators&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;@IntoMap&#xFF0C;&#x4E3A;&#x4E86;&#x5339;&#x914D;Map&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x9700;&#x8981;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;@MapKey&#x7684;&#x6CE8;&#x91CA;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Target(AnnotationTarget.FUNCTION, AnnotationTarget.PROPERTY_GETTER, AnnotationTarget.PROPERTY_SETTER)</span><br><span class=\"line\">@Retention(AnnotationRetention.RUNTIME)</span><br><span class=\"line\">@MapKey</span><br><span class=\"line\">annotation class ViewModelKey(val value: KClass&lt;out ViewModel&gt;)</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x518D;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x7EC4;&#x4EF6;&#x4E0B;&#x4F7F;&#x7528;&#xFF0C;&#x4F8B;&#x5982;&#x5339;&#x914D;MainVM</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Module</span><br><span class=\"line\">abstract class MainModule {</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Binds</span><br><span class=\"line\">    @IntoMap</span><br><span class=\"line\">    @ViewModelKey(MainVM::class)</span><br><span class=\"line\">    abstract fun bindViewModel(viewModel: MainVM): ViewModel</span><br><span class=\"line\"> </span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x5C31;&#x63D0;&#x4F9B;&#x4E86;Map&lt;Class<mainvm>, MainVM&gt;&#x7684;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#xFF0C;&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;ViewModelFactory&#x5C31;&#x80FD;&#x591F;&#x88AB;&#x6210;&#x529F;&#x6CE8;&#x5165;&#x3002;</mainvm></p>\n<p>&#x4F8B;&#x5982;basic&#x6A21;&#x5757;&#x91CC;&#x9762;&#x7684;BaseDaggerActivity</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">abstract class BaseDaggerActivity&lt;V : ViewDataBinding, M : BaseVM&gt; : AppCompatActivity() {</span><br><span class=\"line\">    protected lateinit var viewDataBinding: V</span><br><span class=\"line\">    @Inject</span><br><span class=\"line\">    lateinit var viewModelFactory: ViewModelProvider.Factory</span><br><span class=\"line\">    protected val viewModel by lazy { ViewModelProvider(this, viewModelFactory)[getViewModelClass()] }</span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5F53;&#x7136;&#xFF0C;&#x522B;&#x5FD8;&#x4E86;MainVM&#x4E5F;&#x9700;&#x8981;&#x4F7F;&#x7528;@Inject&#x6765;&#x58F0;&#x660E;&#x6CE8;&#x5165;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class MainVM @Inject constructor() : BaseVM() { ... }</span><br></pre></td></tr></table></figure>\n<p>&#x4EE5;&#x4E0A;&#x662F;Dagger&#x7684;ViewModel&#x4F7F;&#x7528;&#x7684;&#x6CE8;&#x5165;&#x65B9;&#x5F0F;&#x3002;</p>\n<p>&#x867D;&#x7136;&#x81EA;&#x5B9A;&#x4E49;&#x7684;ViewModelFactory&#x662F;&#x516C;&#x7528;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x4E0D;&#x540C;&#x7684;ViewModel&#x8FD8;&#x662F;&#x8981;&#x624B;&#x52A8;&#x5B9A;&#x4E49;&#x4E0D;&#x540C;&#x7684;bindViewModel&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x800C;&#x5BF9;&#x4E8E;Hilt&#x5374;&#x53EF;&#x4EE5;&#x7701;&#x7565;&#x8FD9;&#x4E00;&#x6B65;&#xFF0C;&#x751A;&#x81F3;&#x8BF4;&#x4E0A;&#x9762;&#x7684;&#x5168;&#x90E8;&#x90FD;&#x4E0D;&#x9700;&#x8981;&#x624B;&#x52A8;&#x7F16;&#x5199;&#x3002;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x505A;&#x7684;&#x662F;&#x53EA;&#x9700;&#x5728;ViewModel&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E0A;&#x6DFB;&#x52A0;@ViewModelInject&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#x4E0A;&#x9762;&#x7684;MainVM&#xFF0C;&#x4F7F;&#x7528;Hilt&#x7684;&#x6548;&#x679C;&#x5982;&#x4E0B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class MainVM @ViewModelInject constructor() : BaseVM() { ... }</span><br></pre></td></tr></table></figure>\n<p>&#x81F3;&#x4E8E;Hilt&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x4E0D;&#x8981;&#x5FD8;&#x4E86;&#x5B83;&#x7684;&#x672C;&#x8D28;&#xFF0C;&#x5B83;&#x662F;&#x5728;Dagger&#x4E4B;&#x4E0A;&#x5EFA;&#x7ACB;&#x7684;&#xFF0C;&#x672C;&#x8D28;&#x662F;&#x4E3A;&#x4E86;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x51CF;&#x5C11;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x6837;&#x677F;&#x6A21;&#x677F;&#xFF0C;&#x65B9;&#x4FBF;&#x5F00;&#x53D1;&#x8005;&#x66F4;&#x597D;&#x7684;&#x4F7F;&#x7528;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;&#x3002;</p>\n<p>&#x5728;Hilt&#x4E2D;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x5B9E;&#x73B0;&#x4F1A;&#x81EA;&#x52A8;&#x5E2E;&#x6211;&#x4EEC;&#x751F;&#x6210;&#xFF0C;&#x6240;&#x4EE5;&#x624D;&#x4F1A;&#x4F7F;&#x7528;&#x8D77;&#x6765;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x53BB;&#x5BF9;&#x6BD4;&#x770B;<a href=\"https://github.com/idisfkj/AwesomeGithub/tree/master\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x4E0A;&#x7684;<a href=\"https://github.com/idisfkj/AwesomeGithub/tree/feat_dagger\" target=\"_blank\" rel=\"noopener\">feat_dagger</a>&#x4E0E;<a href=\"https://github.com/idisfkj/AwesomeGithub/tree/feat_hilt\" target=\"_blank\" rel=\"noopener\">feat_hilt</a>&#x4E24;&#x4E2A;&#x5206;&#x652F;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x4F7F;&#x7528;Hilt&#x660E;&#x663E;&#x5C11;&#x4E86;&#x8BB8;&#x591A;&#x4EE3;&#x7801;&#x3002;&#x5BF9;&#x4E8E;&#x7B80;&#x5355;&#x7684;Android&#x7C7B;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#x589E;&#x52A0;&#x51E0;&#x4E2A;&#x6CE8;&#x91CA;&#x800C;&#x5DF2;&#x3002;</p>\n<p>&#x76EE;&#x524D;&#x552F;&#x4E00;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x4E0D;&#x7406;&#x60F3;&#x7684;&#x662F;&#x5BF9;&#x4E8E;@Providers&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#x4E0D;&#x80FD;&#x6709;&#x53C2;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x7528;Dagger&#x4F7F;&#x7528;&#x65F6;&#x5DF2;&#x7ECF;&#x6709;&#x53C2;&#x6570;&#x4E86;&#xFF0C;&#x518D;&#x8F6C;&#x53D8;&#x6210;Hilt&#x53EF;&#x80FD;&#x4E0D;&#x4F1A;&#x90A3;&#x4E48;&#x5BB9;&#x6613;&#x3002;</p>\n<p>&#x5E86;&#x5E78;&#x7684;&#x662F;&#xFF0C;Dagger&#x4E0E;Hilt&#x53EF;&#x4EE5;&#x5171;&#x5B58;&#x3002;&#x6240;&#x4EE5;&#x4F60;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x6027;&#x7684;&#x4F7F;&#x7528;&#x3002;</p>\n<p>&#x4F46;&#x662F;&#x6574;&#x4F53;&#x800C;&#x8A00;Hilt&#x771F;&#x9999;&#xFF0C;&#x4F60;&#x53EA;&#x8981;&#x5C1D;&#x8BD5;&#x4E86;&#x7EDD;&#x4E0D;&#x4F1A;&#x540E;&#x6094;~</p>\n<h2 id=\"AwesomeGithub\"><a href=\"#AwesomeGithub\" class=\"headerlink\" title=\"AwesomeGithub\"></a>AwesomeGithub</h2><p><a href=\"https://github.com/idisfkj/AwesomeGithub/tree/master\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x662F;&#x57FA;&#x4E8E;Github&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7EAF;&#x7EC3;&#x4E60;&#x9879;&#x76EE;&#xFF0C;&#x652F;&#x6301;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;Kotlin&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;JetPack&amp;DataBinding&#x7684;MVVM&#xFF1B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Arouter&#x3001;Retrofit&#x3001;Coroutine&#x3001;Glide&#x3001;Dagger&#x4E0E;Hilt&#x7B49;&#x6D41;&#x884C;&#x5F00;&#x6E90;&#x6280;&#x672F;&#x3002;</p>\n<p><img src=\"/2020/07/16/Android-Hilt&#x5B9E;&#x6218;&#x521D;&#x4F53;&#x9A8C;-Dagger&#x66FF;&#x6362;&#x6210;Hilt/awesome_github.png\" alt><br>&#x9664;&#x4E86;Android&#x539F;&#x751F;&#x7248;&#x672C;&#xFF0C;&#x8FD8;&#x6709;&#x57FA;&#x4E8E;Flutter&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7248;&#x672C;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x559C;&#x6B22;&#x6211;&#x7684;&#x6587;&#x7AE0;&#x6A21;&#x5F0F;&#xFF0C;&#x6216;&#x8005;&#x5BF9;&#x6211;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x6587;&#x7AE0;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x6211;&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF1A;&#x3010;Android&#x8865;&#x7ED9;&#x7AD9;&#x3011;</p>\n<p>&#x6216;&#x8005;&#x626B;&#x63CF;&#x4E0B;&#x65B9;&#x4E8C;&#x7EF4;&#x7801;&#xFF0C;&#x4E0E;&#x6211;&#x5EFA;&#x7ACB;&#x6709;&#x6548;&#x7684;&#x6C9F;&#x901A;&#xFF0C;&#x540C;&#x65F6;&#x80FD;&#x591F;&#x66F4;&#x65B9;&#x4FBF;&#x7684;&#x6536;&#x5230;&#x76F8;&#x5173;&#x7684;&#x6280;&#x672F;&#x63A8;&#x9001;&#x3002;</p>\n<p><img src=\"/2020/07/16/Android-Hilt&#x5B9E;&#x6218;&#x521D;&#x4F53;&#x9A8C;-Dagger&#x66FF;&#x6362;&#x6210;Hilt/Android&#x8865;&#x7ED9;&#x7AD9;.jpg\" alt></p>\n","categories":["android"],"tags":["jetpack"]},{"title":"从零开始的Flutter之旅: MethodChannel","url":"https://www.rousetime.com/2020/07/09/从零开始的Flutter之旅-MethodChannel/","content":"<h2 id=\"&#x5F80;&#x671F;&#x56DE;&#x987E;\"><a href=\"#&#x5F80;&#x671F;&#x56DE;&#x987E;\" class=\"headerlink\" title=\"&#x5F80;&#x671F;&#x56DE;&#x987E;\"></a>&#x5F80;&#x671F;&#x56DE;&#x987E;</h2><p><a href=\"https://juejin.im/post/5e62f280e51d4534ec0066b8\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: StatelessWidget</a><br><a href=\"https://juejin.im/post/5e6f871bf265da572a0d160c\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: StatefulWidget</a><br><a href=\"https://juejin.im/post/5edf695fe51d457b3f4a1854\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: InheritedWidget</a><br><a href=\"https://juejin.im/post/5ef09403f265da02c6343319\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: Provider</a><br><a href=\"https://juejin.im/post/5ef7d6995188252e5d3076b0\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: Navigator</a></p>\n<p>&#x5728;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#x6709;&#x8FD9;&#x4E48;&#x4E00;&#x4E2A;&#x573A;&#x666F;&#xFF1A;&#x901A;&#x8FC7;authorization&#x8BA4;&#x8BC1;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x767B;&#x5F55;&#x3002;&#x800C;authorization&#x7684;&#x5177;&#x4F53;&#x767B;&#x5F55;&#x5F62;&#x5F0F;&#x662F;&#xFF0C;&#x901A;&#x8FC7;&#x8DF3;&#x8F6C;&#x4E00;&#x4E2A;&#x7F51;&#x9875;&#x94FE;&#x63A5;&#x8FDB;&#x884C;github&#x6388;&#x6743;&#x767B;&#x5F55;&#xFF0C;&#x6210;&#x529F;&#x4E4B;&#x540E;&#x4F1A;&#x643A;&#x5E26;&#x5BF9;&#x5E94;&#x7684;code&#x5230;&#x6307;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;code&#x6765;&#x8FDB;&#x884C;oauth&#x6388;&#x6743;&#x767B;&#x5F55;&#xFF0C;&#x6210;&#x529F;&#x4E4B;&#x540E;&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x62FF;&#x5230;&#x8BE5;&#x8D26;&#x6237;&#x7684;token&#xFF0C;&#x6240;&#x4EE5;&#x4E4B;&#x540E;&#x7684;github&#x64CD;&#x4F5C;&#x90FD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BE5;token&#x6765;&#x8FDB;&#x884C;&#x8BF7;&#x6C42;&#x3002;&#x7531;&#x4E8E;token&#x662F;&#x6709;&#x65F6;&#x6548;&#x6027;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x89E3;&#x9664;&#x6388;&#x6743;&#xFF0C;&#x6240;&#x4EE5;&#x76F8;&#x5BF9;&#x4E8E;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x8FDB;&#x884C;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x767B;&#x5F55;&#x6765;&#x8BF4;&#x66F4;&#x52A0;&#x5B89;&#x5168;&#x3002;</p>\n<p><img src=\"/2020/07/09/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-MethodChannel/method_channel.gif\" alt></p>\n<p>&#x90A3;&#x4E48;&#x8981;&#x5B9E;&#x73B0;&#x4E0A;&#x9762;&#x8FD9;&#x4E2A;&#x573A;&#x666F;&#xFF0C;Flutter&#x5C31;&#x9700;&#x8981;&#x4E0E;&#x539F;&#x751F;&#x5BA2;&#x6237;&#x7AEF;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF0C;&#x62FF;&#x5230;&#x8FD4;&#x56DE;&#x7684;code&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5230;Flutter&#x4E2D;&#x8FDB;&#x884C;oauth&#x6388;&#x6743;&#x767B;&#x5F55;&#x8BF7;&#x6C42;&#x3002;</p>\n<p>&#x901A;&#x4FE1;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;MethodChannel&#xFF0C;&#x8FD9;&#x4E2A;&#x5C31;&#x662F;&#x4ECA;&#x5929;&#x7684;&#x4E3B;&#x9898;&#x3002;</p>\n<h2 id=\"OAuth-App\"><a href=\"#OAuth-App\" class=\"headerlink\" title=\"OAuth App\"></a>OAuth App</h2><p>authorization&#x8BA4;&#x8BC1;&#x7684;&#x539F;&#x7406;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x76F4;&#x63A5;&#x6765;&#x770B;&#x5B9E;&#x73B0;&#x65B9;&#x6848;&#x3002;</p>\n<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x4E2A;<a href=\"https://github.com/settings/applications/1114138\" target=\"_blank\" rel=\"noopener\">OAuth App</a>&#x7528;&#x6765;&#x63D0;&#x4F9B;&#x7528;&#x6237;&#x901A;&#x8FC7;github&#x6388;&#x6743;&#x7684;&#x5E94;&#x7528;&#x3002;</p>\n<blockquote>\n<p>&#x8FD9;&#x4E2A;&#x5728;github&#x4E0A;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6CE8;&#x518C;&#x7684;</p>\n</blockquote>\n<p><img src=\"/2020/07/09/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-MethodChannel/method_channel_1.png\" alt></p>\n<p>&#x5728;&#x6CE8;&#x518C;&#x7684;OAuth App&#x65F6;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;Authorization callback URL&#x5FC5;&#x586B;&#x9879;&#x3002;&#x8FD9;&#x4E2A;callback url&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x5F53;&#x4F60;&#x901A;&#x8FC7;&#x8BE5;&#x94FE;&#x63A5;&#x8BA4;&#x8BC1;&#x901A;&#x8FC7;&#x540E;&#x4F1A;&#x4EE5;App Link&#x7684;&#x65B9;&#x5F0F;&#x4F7F;&#x7528;&#x8BE5;url&#x8DF3;&#x8F6C;&#x5230;&#x5BF9;&#x5E94;&#x7684;App&#x5E94;&#x7528;&#xFF0C;&#x540C;&#x65F6;&#x8FD4;&#x56DE;&#x8BA4;&#x8BC1;&#x6210;&#x529F;&#x7684;code&#x3002;&#x8FD9;&#x91CC;&#x5C06;&#x5176;&#x5B9A;&#x4E49;&#x4E3A;REDIRECT_URI</p>\n<p>&#x6CE8;&#x518C;&#x6210;&#x529F;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x62FF;&#x5230;&#x5B83;&#x7684;Client ID&#x3001;Client Secret&#x4E0E;Authorization callback URL&#xFF0C;&#x62FC;&#x63A5;&#x6210;&#x4E0B;&#x9762;&#x7684;&#x8FDE;&#x63A5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const String URL_AUTHORIZATION =</span><br><span class=\"line\">    &apos;https://github.com/login/oauth/authorize?client_id=$CLIENT_ID&amp;redirect_uri=$REDIRECT_URI&amp;scope=user%20repo%20notifications%20&apos;;</span><br></pre></td></tr></table></figure>\n<p>&#x6709;&#x4E86;&#x8DF3;&#x8F6C;&#x5230;&#x5916;&#x90E8;&#x7684;&#x8BA4;&#x8BC1;&#x94FE;&#x63A5;&#x4E4B;&#x540E;&#xFF0C;&#x4E0B;&#x9762;&#x5C31;&#x662F;&#x5728;&#x5E94;&#x7528;&#x4E2D;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x8DF3;&#x8F6C;&#x8BA4;&#x8BC1;&#x6D41;&#x7A0B;&#x3002;</p>\n<h2 id=\"url-launcher\"><a href=\"#url-launcher\" class=\"headerlink\" title=\"url_launcher\"></a>url_launcher</h2><p>&#x9996;&#x5148;&#x9700;&#x8981;&#x8DF3;&#x8F6C;&#x5916;&#x90E8;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#x4E0A;&#x9762;&#x7684;authorization&#x94FE;&#x63A5;&#x3002;&#x8FD9;&#x4E00;&#x6B65;&#x7684;&#x5B9E;&#x73B0;&#x9700;&#x8981;&#x501F;&#x52A9;url_launcher&#xFF0C;&#x5B83;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x68C0;&#x67E5;&#x94FE;&#x63A5;&#x662F;&#x5426;&#x6709;&#x6548;&#xFF0C;&#x540C;&#x65F6;&#x542F;&#x52A8;&#x5916;&#x90E8;&#x6D4F;&#x89C8;&#x5668;&#x8FDB;&#x884C;&#x8DF3;&#x8F6C;&#x3002;</p>\n<p>&#x5728;&#x4F7F;&#x7528;&#x4E4B;&#x524D;&#x9700;&#x8981;&#x5728;pubspec.yaml&#x4E2D;&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies:</span><br><span class=\"line\">  flutter:</span><br><span class=\"line\">    sdk: flutter</span><br><span class=\"line\">  http: 0.12.0+4</span><br><span class=\"line\">  dio: 3.0.7</span><br><span class=\"line\">  shared_preferences: 0.5.6+1</span><br><span class=\"line\">  url_launcher: 5.4.1</span><br><span class=\"line\">  ...</span><br></pre></td></tr></table></figure>\n<p>&#x4F9D;&#x8D56;&#x6210;&#x529F;&#x4E4B;&#x540E;&#xFF0C;&#x4F7F;&#x7528;canLaunch()&#x6765;&#x68C0;&#x67E5;&#x94FE;&#x63A5;&#x7684;&#x6709;&#x6548;&#x6027;&#xFF1B;launch()&#x6765;&#x542F;&#x52A8;&#x8DF3;&#x8F6C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">authorization() {</span><br><span class=\"line\">  return () async {</span><br><span class=\"line\">    FocusScope.of(context).requestFocus(FocusNode());</span><br><span class=\"line\">    if (await canLaunch(URL_AUTHORIZATION)) {</span><br><span class=\"line\">      // &#x4E3A;&#x8BBE;&#x7F6E;forceSafariVC&#xFF0C;IOS &#x9ED8;&#x8BA4;&#x4F1A;&#x6253;&#x5F00;APP&#x5185;&#x90E8;WebView</span><br><span class=\"line\">      // &#x800C;APP&#x5185;&#x90E8;WebView&#x4E0D;&#x652F;&#x6301;&#x91CD;&#x5B9A;&#x5411;&#x8DF3;&#x8F6C;&#x5230;APP</span><br><span class=\"line\">      await launch(URL_AUTHORIZATION, forceSafariVC: false);</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">      throw &apos;Can not launch $URL_AUTHORIZATION)&apos;;</span><br><span class=\"line\">    }</span><br><span class=\"line\">  };</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"Scheme\"><a href=\"#Scheme\" class=\"headerlink\" title=\"Scheme\"></a>Scheme</h2><p>&#x901A;&#x8FC7;authorization()&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x6210;&#x529F;&#x8DF3;&#x8F6C;&#x5230;&#x5916;&#x90E8;&#x6D4F;&#x89C8;&#x5668;&#x8FDB;&#x884C;&#x767B;&#x5F55;&#x6388;&#x8BA4;&#x8BC1;&#x3002;&#x6388;&#x6743;&#x6210;&#x529F;&#x4E4B;&#x540E;&#x4F1A;&#x8FD4;&#x56DE;&#x5230;&#x4E4B;&#x524D;&#x7684;app&#xFF0C;&#x5177;&#x4F53;&#x9875;&#x9762;&#x8DEF;&#x5F84;&#x4E0E;&#x94FE;&#x63A5;&#x4E2D;&#x914D;&#x7F6E;&#x7684;REDIRECT_URI&#x6709;&#x5173;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const String REDIRECT_URI = &apos;github://login&apos;;</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;Scheme&#xFF0C;&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x6210;&#x529F;&#x8FD4;&#x56DE;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x6307;&#x5B9A;&#x7684;&#x9875;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E3A;Android&#x4E0E;IOS&#x914D;&#x7F6E;&#x5BF9;&#x5E94;&#x7684;Scheme&#x3002;</p>\n<h3 id=\"Android\"><a href=\"#Android\" class=\"headerlink\" title=\"Android\"></a>Android</h3><p>&#x627E;&#x5230;AndroidManifest&#x6587;&#x4EF6;&#xFF0C;&#x5728;activity&#x4FBF;&#x7B7E;&#x4E0B;&#x6DFB;&#x52A0;intent-filter&#x5C5E;&#x6027;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;intent-filter&gt;</span><br><span class=\"line\">    &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;</span><br><span class=\"line\">    &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;data</span><br><span class=\"line\">        android:host=&quot;login&quot;</span><br><span class=\"line\">        android:scheme=&quot;github&quot; /&gt;</span><br><span class=\"line\">&lt;/intent-filter&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x524D;&#x9762;&#x7684;action&#x4E0E;category&#x914D;&#x7F6E;&#x662F;&#x56FA;&#x5B9A;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x652F;&#x6301;&#x4E0D;&#x540C;&#x7684;scheme&#xFF0C;&#x4E3B;&#x8981;&#x4FEE;&#x6539;&#x7684;&#x662F;data&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#x3002;</p>\n<p>&#x5C06;scheme&#x4E0E;host&#x5206;&#x522B;&#x5BF9;&#x5E94;&#x5230;REDIRECT_URI&#x4E2D;&#x7684;&#x6570;&#x503C;&#x3002;</p>\n<h3 id=\"IOS\"><a href=\"#IOS\" class=\"headerlink\" title=\"IOS\"></a>IOS</h3><p>&#x627E;&#x5230;info.plist&#x6587;&#x4EF6;&#xFF0C;&#x6DFB;&#x52A0;URL types&#x4FBF;&#x7B7E;&#xFF0C;&#x5728;&#x5B83;&#x7684;item&#x4E0B;&#x914D;&#x7F6E;&#x5BF9;&#x5E94;&#x7684;URL identifier&#x4E0E;URL Schemes</p>\n<p><img src=\"/2020/07/09/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-MethodChannel/method_channel_2.png\" alt></p>\n<p>&#x914D;&#x7F6E;&#x5B8C;scheme&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x80FD;&#x591F;&#x6B63;&#x5E38;&#x8FD4;&#x56DE;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x9875;&#x9762;&#x3002;</p>\n<p>&#x63A5;&#x4E0B;&#x6765;&#x9700;&#x8981;&#x8003;&#x8651;&#x7684;&#x662F;&#xFF0C;&#x5982;&#x4F55;&#x62FF;&#x5230;&#x8FD4;&#x56DE;&#x7684;code&#x503C;</p>\n<h2 id=\"MethodChannel\"><a href=\"#MethodChannel\" class=\"headerlink\" title=\"MethodChannel\"></a>MethodChannel</h2><p>&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x4ECA;&#x5929;&#x7684;&#x4E3B;&#x89D2;&#x5C31;&#x8BE5;&#x4E0A;&#x573A;&#x4E86;&#x3002;</p>\n<p>MethodChannel&#x7B80;&#x5355;&#x7684;&#x8BF4;&#x5C31;&#x662F;Flutter&#x63D0;&#x4F9B;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x4FE1;&#x7684;&#x6E20;&#x9053;&#xFF0C;&#x4F7F;&#x7528;&#x65F6;&#x4E92;&#x76F8;&#x7EA6;&#x5B9A;&#x4E00;&#x4E2A;&#x6E20;&#x9053;name&#x4E0E;&#x5BF9;&#x5E94;&#x7684;&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6307;&#x5B9A;&#x65B9;&#x6CD5;&#x7684;method&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x7EA6;&#x5B9A;&#x597D;&#x8FD9;&#x4E24;&#x4E2A;&#x503C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const String METHOD_CHANNEL_NAME = &apos;app.channel.shared.data&apos;;</span><br><span class=\"line\">const String CALL_LOGIN_CODE = &apos;getLoginCode&apos;;</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x901A;&#x8FC7;MethodChannel&#x6765;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;&#x6E20;&#x9053;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">callLoginCode(AppLifecycleState state) async {</span><br><span class=\"line\">  if (state == AppLifecycleState.resumed) {</span><br><span class=\"line\">    final platform = const MethodChannel(METHOD_CHANNEL_NAME);</span><br><span class=\"line\">    final code = await platform.invokeMethod(CALL_LOGIN_CODE);</span><br><span class=\"line\">    if (code != null) {</span><br><span class=\"line\">      _getAccessTokenFromCode(code);</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;invokeMethod&#x6765;&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x91CC;&#x662F;&#x7528;&#x6765;&#x83B7;&#x53D6;&#x6388;&#x6743;&#x6210;&#x529F;&#x540E;&#x8FD4;&#x56DE;&#x5BA2;&#x6237;&#x7AEF;&#x7684;code&#x3002;</p>\n<p>&#x8FD9;&#x662F;Flutter&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x65B9;&#x6CD5;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x4E0B;&#x9762;&#x518D;&#x770B;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x5B9E;&#x73B0;</p>\n<h3 id=\"Android-1\"><a href=\"#Android-1\" class=\"headerlink\" title=\"Android\"></a>Android</h3><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5C06;&#x7EA6;&#x5B9A;&#x597D;&#x7684;&#x6E20;&#x9053;&#x540D;&#x79F0;&#x4E0E;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x540D;&#x5B9A;&#x4E49;&#x4E3A;&#x5E38;&#x91CF;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">object Constants {</span><br><span class=\"line\">    const val AUTHORIZATION_CODE = &quot;code&quot;</span><br><span class=\"line\">    const val METHOD_CHANNEL_NAME = &quot;app.channel.shared.data&quot;</span><br><span class=\"line\">    const val CALL_LOGIN_CODE = &quot;getLoginCode&quot;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5728;AndroidManifest.xml&#x4E2D;&#x5B9A;&#x4E49;&#x7684;scheme&#xFF0C;&#x6240;&#x4EE5;&#x8BA4;&#x8BC1;&#x6210;&#x529F;&#x540E;&#x56DE;&#x8FD4;&#x56DE;&#x5BA2;&#x6237;&#x7AEF;&#x7684;MainActivity&#x9875;&#x9762;&#xFF0C;&#x540C;&#x65F6;&#x56DE;&#x8C03;onNewIntent&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x83B7;&#x53D6;&#x8FD4;&#x56DE;code&#x7684;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x5728;onNewIntent&#x4E2D;&#x8FDB;&#x884C;&#xFF0C;&#x540C;&#x65F6;&#x8FD8;&#x9700;&#x8981;&#x5EFA;&#x7ACB;&#x5BF9;&#x5E94;&#x7684;MethodChannel&#x4E0E;&#x63D0;&#x4F9B;&#x56DE;&#x8C03;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class MainActivity : FlutterActivity() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    private var mAuthorizationCode: String? = null</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun configureFlutterEngine(@NonNull flutterEngine: FlutterEngine) {</span><br><span class=\"line\">        GeneratedPluginRegistrant.registerWith(flutterEngine)</span><br><span class=\"line\">        setupMethodChannel()</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun onNewIntent(intent: Intent) {</span><br><span class=\"line\">        super.onNewIntent(intent)</span><br><span class=\"line\">        getExtra(intent)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    private fun getExtra(intent: Intent?) {</span><br><span class=\"line\">        // from author login</span><br><span class=\"line\">        mAuthorizationCode = intent?.data?.getQueryParameter(Constants.AUTHORIZATION_CODE)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    private fun setupMethodChannel() {</span><br><span class=\"line\">        MethodChannel(flutterEngine?.dartExecutor, Constants.METHOD_CHANNEL_NAME).setMethodCallHandler { call, result -&gt;</span><br><span class=\"line\">            if (call.method == Constants.CALL_LOGIN_CODE &amp;&amp; !TextUtils.isEmpty(mAuthorizationCode)) {</span><br><span class=\"line\">                result.success(mAuthorizationCode)</span><br><span class=\"line\">                mAuthorizationCode = null</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>MethodChannel&#x5EFA;&#x7ACB;&#x6E20;&#x9053;&#xFF0C;setMethodCallHandler&#x6765;&#x54CD;&#x5E94;Flutter&#x4E2D;&#x9700;&#x8981;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x901A;&#x8FC7;&#x5224;&#x65AD;&#x56DE;&#x8C03;&#x7684;&#x65B9;&#x6CD5;&#x540D;&#x79F0;&#xFF0C;&#x5373;&#x4E4B;&#x524D;&#x5728;Flutter&#x4E2D;&#x7EA6;&#x5B9A;&#x7684;CALL_LOGIN_CODE&#x3002;&#x6765;&#x6267;&#x884C;&#x5BF9;&#x5E94;&#x7684;&#x903B;&#x8F91;</p>\n<p>&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8FD4;&#x56DE;&#x7684;code&#x503C;&#xFF0C;&#x53EA;&#x9700;&#x901A;&#x8FC7;result&#x7684;success&#x65B9;&#x6CD5;&#xFF0C;&#x5C06;&#x83B7;&#x53D6;&#x5230;&#x7684;code&#x4F20;&#x9012;&#x8FC7;&#x53BB;&#x5373;&#x53EF;&#x3002;&#x4E4B;&#x540E;Flutter&#x5C31;&#x80FD;&#x591F;&#x83B7;&#x53D6;&#x5230;&#x8BE5;&#x503C;&#x3002;</p>\n<h3 id=\"IOS-1\"><a href=\"#IOS-1\" class=\"headerlink\" title=\"IOS\"></a>IOS</h3><p>&#x5728;AppDelegate.swift&#x4E2D;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;methodChannel&#xFF0C;&#x4F7F;&#x7528;&#x7EA6;&#x5B9A;&#x597D;&#x7684;name&#x3002;</p>\n<p>methodChannel&#x7684;&#x521B;&#x5EFA;IOS&#x662F;&#x901A;&#x8FC7;FlutterMethodChannel.init&#x6765;&#x751F;&#x6210;&#x3002;&#x4E4B;&#x540E;&#x7684;&#x56DE;&#x8C03;&#x4E0E;Android&#x7684;&#x57FA;&#x672C;&#x7C7B;&#x4F3C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@UIApplicationMain</span><br><span class=\"line\">@objc class AppDelegate: FlutterAppDelegate {</span><br><span class=\"line\">    var paramsMap: Dictionary&lt;String, String&gt; = [:]</span><br><span class=\"line\">  override func application(</span><br><span class=\"line\">    _ application: UIApplication,</span><br><span class=\"line\">    didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?</span><br><span class=\"line\">  ) -&gt; Bool {</span><br><span class=\"line\">    GeneratedPluginRegistrant.register(with: self)</span><br><span class=\"line\">     </span><br><span class=\"line\">    let controller: FlutterViewController = window?.rootViewController as! FlutterViewController</span><br><span class=\"line\">    let methodChannel = FlutterMethodChannel.init(name: &quot;app.channel.shared.data&quot;, binaryMessenger: controller.binaryMessenger)</span><br><span class=\"line\">     </span><br><span class=\"line\">    methodChannel.setMethodCallHandler { (call, result) in</span><br><span class=\"line\">        if &quot;getLoginCode&quot; == call.method &amp;&amp; !self.paramsMap.isEmpty {</span><br><span class=\"line\">            result(self.paramsMap[&quot;code&quot;])</span><br><span class=\"line\">            self.paramsMap.removeAll()</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">     </span><br><span class=\"line\">    return super.application(application, didFinishLaunchingWithOptions: launchOptions)</span><br><span class=\"line\">  }</span><br><span class=\"line\">    override func application(_ app: UIApplication, open url: URL, options: [UIApplication.OpenURLOptionsKey : Any] = [:]) -&gt; Bool {</span><br><span class=\"line\">        let absoluteString = url.absoluteURL.absoluteString</span><br><span class=\"line\">        let urlComponents = NSURLComponents(string: absoluteString)</span><br><span class=\"line\">        let queryItems = urlComponents?.queryItems</span><br><span class=\"line\">        for item in queryItems! {</span><br><span class=\"line\">            paramsMap[item.name] = item.value</span><br><span class=\"line\">        }</span><br><span class=\"line\">        return true</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;setMethodCallHandler&#x4E2D;&#x5224;&#x65AD;&#x56DE;&#x8C03;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x5426;&#x4E0E;&#x7EA6;&#x5B9A;&#x7684;&#x65B9;&#x6CD5;&#x540D;&#x4E00;&#x81F4;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x81F4;&#x518D;&#x901A;&#x8FC7;result&#x65B9;&#x6CD5;&#x5C06;code&#x4F20;&#x9012;&#x7ED9;Flutter&#x3002;</p>\n<p>&#x81F3;&#x6B64;Android&#x4E0E;IOS&#x90FD;&#x4E0E;Flutter&#x5EFA;&#x7ACB;&#x4E86;&#x901A;&#x4FE1;&#xFF0C;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x6865;&#x6881;&#x5C31;&#x662F;&#x901A;&#x8FC7;MethodChannel&#x6765;&#x642D;&#x5EFA;&#x7684;&#x3002;</p>\n<p>&#x6700;&#x540E;code&#x4F20;&#x56DE;&#x5230;Flutter&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x5C06;code&#x8FDB;&#x884C;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x5230;&#x5BF9;&#x5E94;&#x7684;token&#x3002;</p>\n<p>&#x5230;&#x8FD9;&#x91CC;&#x6574;&#x4E2A;&#x6388;&#x6743;&#x8BA4;&#x8BC1;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;token&#x6765;&#x8BF7;&#x6C42;&#x7528;&#x6237;&#x76F8;&#x5173;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;&#x6570;&#x636E;&#x3002;</p>\n<blockquote>\n<p>token&#x7684;&#x83B7;&#x53D6;&#x4E0E;&#x76F8;&#x5173;&#x63A5;&#x53E3;&#x7684;&#x8C03;&#x7528;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x67E5;&#x770B;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#x6E90;&#x7801;&#x83B7;&#x53D6;</p>\n</blockquote>\n<h2 id=\"&#x63A8;&#x8350;&#x9879;&#x76EE;\"><a href=\"#&#x63A8;&#x8350;&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;&#x9879;&#x76EE;\"></a>&#x63A8;&#x8350;&#x9879;&#x76EE;</h2><p>&#x4E0B;&#x9762;&#x4ECB;&#x7ECD;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;Flutter&#x9879;&#x76EE;&#xFF0C;&#x5BF9;&#x4E8E;&#x65B0;&#x624B;&#x6765;&#x8BF4;&#x662F;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x5165;&#x95E8;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;Flutter&#x7684;Github&#x5BA2;&#x6237;&#x7AEF;&#x540C;&#x65F6;&#x652F;&#x6301;Android&#x4E0E;IOS&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;dart&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;Model/State/ViewModel&#x7684;MSVM&#xFF1B;&#x4F7F;&#x7528;Navigator&#x8FDB;&#x884C;&#x9875;&#x9762;&#x7684;&#x8DF3;&#x8F6C;&#xFF1B;&#x7F51;&#x7EDC;&#x6846;&#x67B6;&#x4F7F;&#x7528;&#x4E86;dio&#x3002;&#x9879;&#x76EE;&#x6B63;&#x5728;&#x6301;&#x7EED;&#x66F4;&#x65B0;&#x4E2D;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x4E00;&#x4E0B;&#x3002;</p>\n<p><img src=\"/2020/07/09/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-MethodChannel/flutter_github_preview.png\" alt></p>\n<p>&#x5F53;&#x7136;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x4E86;&#x89E3;Android&#x539F;&#x751F;&#xFF0C;&#x76F8;&#x4FE1;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#x7684;&#x7EAF;Android&#x7248;&#x672C;<a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x559C;&#x6B22;&#x6211;&#x7684;&#x6587;&#x7AE0;&#x6A21;&#x5F0F;&#xFF0C;&#x6216;&#x8005;&#x5BF9;&#x6211;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x6587;&#x7AE0;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x5EFA;&#x8BAE;&#x60A8;&#x5173;&#x6CE8;&#x6211;&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF1A;&#x3010;Android&#x8865;&#x7ED9;&#x7AD9;&#x3011;</p>\n<p>&#x6216;&#x8005;&#x626B;&#x63CF;&#x4E0B;&#x65B9;&#x4E8C;&#x7EF4;&#x7801;&#xFF0C;&#x4E0E;&#x6211;&#x5EFA;&#x7ACB;&#x6709;&#x6548;&#x7684;&#x6C9F;&#x901A;&#xFF0C;&#x540C;&#x65F6;&#x66F4;&#x5FEB;&#x66F4;&#x51C6;&#x7684;&#x6536;&#x5230;&#x6211;&#x7684;&#x66F4;&#x65B0;&#x63A8;&#x9001;&#x3002;</p>\n<p><img src=\"/2020/07/09/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-MethodChannel/Android&#x8865;&#x7ED9;&#x7AD9;.jpg\" alt></p>\n","categories":["android"],"tags":["flutter"]},{"title":"从零开始的Flutter之旅: Navigator","url":"https://www.rousetime.com/2020/06/24/从零开始的Flutter之旅-Navigator/","content":"<h2 id=\"&#x5F80;&#x671F;&#x56DE;&#x987E;\"><a href=\"#&#x5F80;&#x671F;&#x56DE;&#x987E;\" class=\"headerlink\" title=\"&#x5F80;&#x671F;&#x56DE;&#x987E;\"></a>&#x5F80;&#x671F;&#x56DE;&#x987E;</h2><p><a href=\"https://juejin.im/post/5e62f280e51d4534ec0066b8\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: StatelessWidget</a><br><a href=\"https://juejin.im/post/5e6f871bf265da572a0d160c\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: StatefulWidget</a><br><a href=\"https://juejin.im/post/5edf695fe51d457b3f4a1854\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: InheritedWidget</a><br><a href=\"https://juejin.im/post/5ef09403f265da02c6343319\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: Provider</a></p>\n<p>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x662F;&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7CFB;&#x5217;&#x7684;&#x7B2C;&#x4E94;&#x671F;&#xFF0C;&#x524D;&#x9762;&#x6211;&#x4EEC;&#x8BB2;&#x5230;&#x4E86;Widget&#x4E0E;&#x7ED3;&#x5408;&#x6570;&#x636E;&#x5171;&#x4EAB;&#x7684;Provider&#x5904;&#x7406;&#x3002;</p>\n<p>&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x8DEF;&#x7531;&#x5BFC;&#x822A;Navigator&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x3002;</p>\n<p>Flutter&#x4E2D;&#x7684;&#x8DEF;&#x7531;&#x7BA1;&#x7406;&#x4E0E;&#x539F;&#x751F;&#x5F00;&#x53D1;&#x7C7B;&#x4F3C;&#xFF0C;&#x90FD;&#x4F1A;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;&#x8DEF;&#x7531;&#x6808;&#xFF0C;&#x901A;&#x8FC7;push&#x5165;&#x6808;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x9875;&#x9762;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x901A;&#x8FC7;pop&#x51FA;&#x6808;&#x5173;&#x95ED;&#x8001;&#x7684;&#x9875;&#x9762;&#x3002;</p>\n<h2 id=\"&#x793A;&#x4F8B;\"><a href=\"#&#x793A;&#x4F8B;\" class=\"headerlink\" title=\"&#x793A;&#x4F8B;\"></a>&#x793A;&#x4F8B;</h2><p>&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x5230; <a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#x4E2D;&#x627E;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5B9E;&#x4F8B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void _goToLogin() async {</span><br><span class=\"line\">  SharedPreferences prefs = await SharedPreferences.getInstance();</span><br><span class=\"line\">  String authorization = prefs.getString(SP_AUTHORIZATION);</span><br><span class=\"line\">  String token = prefs.getString(SP_ACCESS_TOKEN);</span><br><span class=\"line\">  if ((authorization != null &amp;&amp; authorization.isNotEmpty) ||</span><br><span class=\"line\">      (token != null &amp;&amp; token.isNotEmpty)) {</span><br><span class=\"line\">    Navigator.of(context).push(MaterialPageRoute(builder: (context) {</span><br><span class=\"line\">      return HomePage();</span><br><span class=\"line\">    }));</span><br><span class=\"line\">  } else {</span><br><span class=\"line\">    Navigator.of(context).push(MaterialPageRoute(builder: (context) {</span><br><span class=\"line\">      return LoginPage();</span><br><span class=\"line\">    }));</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x767B;&#x5F55;&#x4E86;&#x3002;&#x5982;&#x679C;&#x767B;&#x5F55;&#x4E86;&#x901A;&#x8FC7;&#x8FC7;Navigator&#x8DF3;&#x8F6C;&#x5230;HomePage&#x9875;&#x9762;&#xFF0C;&#x5426;&#x5219;&#x8DF3;&#x8F6C;&#x5230;LoginPage&#x9875;&#x9762;&#x3002;</p>\n<p>&#x7528;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#x901A;&#x8FC7;push&#x4F20;&#x9012;&#x4E00;&#x4E2A;Route&#x3002;&#x8FD9;&#x91CC;&#x5BF9;&#x5E94;&#x7684;&#x662F;MaterialPageRoute&#x3002;&#x5B83;&#x4F1A;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;builder&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x5728;builder&#x4E2D;&#x8FD4;&#x56DE;&#x60F3;&#x8981;&#x8DF3;&#x8F6C;&#x7684;&#x9875;&#x9762;&#x5B9E;&#x4F8B;&#x5373;&#x53EF;&#x3002;</p>\n<p>&#x5B83;&#x7EE7;&#x627F;&#x4E8E;PageRoute&#xFF0C;PageRoute&#x662F;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x8DEF;&#x7531;&#x5207;&#x6362;&#x65F6;&#x7684;&#x8FC7;&#x6E21;&#x52A8;&#x753B;&#x6548;&#x679C;&#x4E0E;&#x76F8;&#x5E94;&#x7684;&#x63A5;&#x53E3;&#x3002;&#x800C;MaterialPageRoute&#x901A;&#x8FC7;&#x8FD9;&#x4E9B;&#x63A5;&#x53E3;&#x6765;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x5E73;&#x53F0;&#x4E0A;&#x5BF9;&#x5E94;&#x98CE;&#x683C;&#x7684;&#x8DEF;&#x7531;&#x5207;&#x6362;&#x52A8;&#x753B;&#x6548;&#x679C;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</p>\n<ol>\n<li>Android&#x5E73;&#x53F0;&#xFF0C;push&#x65F6;&#x9875;&#x9762;&#x4F1A;&#x4ECE;&#x5C4F;&#x5E55;&#x5E95;&#x90E8;&#x6ED1;&#x52A8;&#x5230;&#x9876;&#x90E8;&#x8FDB;&#x5165;&#xFF0C;pop&#x65F6;&#x9875;&#x9762;&#x4F1A;&#x4ECE;&#x5C4F;&#x5E55;&#x9876;&#x90E8;&#x6ED1;&#x52A8;&#x5230;&#x5C4F;&#x5E55;&#x5E95;&#x90E8;&#x9000;&#x51FA;&#x3002;</li>\n<li>Ios&#x5E73;&#x53F0;&#xFF0C;push&#x65F6;&#x9875;&#x9762;&#x4F1A;&#x4ECE;&#x5C4F;&#x5E55;&#x53F3;&#x4FA7;&#x6ED1;&#x52A8;&#x5230;&#x5C4F;&#x5E55;&#x5DE6;&#x4FA7;&#x8FDB;&#x5165;&#xFF0C;pop&#x65F6;&#x9875;&#x9762;&#x4F1A;&#x4ECE;&#x5C4F;&#x5E55;&#x5DE6;&#x4FA7;&#x6ED1;&#x52A8;&#x5230;&#x5C4F;&#x5E55;&#x53F3;&#x4FA7;&#x9000;&#x51FA;&#x3002;</li>\n</ol>\n<blockquote>\n<p>&#x5982;&#x679C;&#x60F3;&#x81EA;&#x5B9A;&#x4E49;&#x5207;&#x6362;&#x52A8;&#x753B;&#xFF0C;&#x53EF;&#x4EE5;&#x4EFF;&#x7167;MaterialPageRoute&#xFF0C;&#x7EE7;&#x627F;&#x4E8E;PageRoute&#x6765;&#x5B9E;&#x73B0;&#x3002;</p>\n</blockquote>\n<h2 id=\"Navigator\"><a href=\"#Navigator\" class=\"headerlink\" title=\"Navigator\"></a>Navigator</h2><p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;push&#x64CD;&#x4F5C;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;Future&#xFF0C;&#x5B83;&#x662F;&#x7528;&#x6765;&#x63A5;&#x6536;&#x65B0;&#x7684;&#x8DEF;&#x7531;&#x5173;&#x95ED;&#x65F6;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x636E;&#x3002;&#x5728;Android&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;startActivityForResult() &#x548C; onActivityResult()API&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@optionalTypeArgs</span><br><span class=\"line\"> Future&lt;T&gt; push&lt;T extends Object&gt;(Route&lt;T&gt; route) {</span><br><span class=\"line\">   assert(!_debugLocked);</span><br><span class=\"line\">   assert(() {</span><br><span class=\"line\">     _debugLocked = true;</span><br><span class=\"line\">     return true;</span><br><span class=\"line\">   }());</span><br><span class=\"line\">   ....</span><br><span class=\"line\">   ....</span><br><span class=\"line\"> }</span><br></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x5E94;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x662F;pop&#x64CD;&#x4F5C;&#xFF0C;&#x51FA;&#x6808;&#x662F;&#x53EF;&#x4EE5;&#x5411;&#x4E4B;&#x524D;&#x7684;&#x9875;&#x9762;&#x4F20;&#x9012;&#x6570;&#x636E;&#xFF0C;&#x5728;Android&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;setResult() Api</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@optionalTypeArgs</span><br><span class=\"line\">bool pop&lt;T extends Object&gt;([ T result ]) {</span><br><span class=\"line\">  assert(!_debugLocked);</span><br><span class=\"line\">  assert(() {</span><br><span class=\"line\">    _debugLocked = true;</span><br><span class=\"line\">    return true;</span><br><span class=\"line\">  }());</span><br><span class=\"line\">  final Route&lt;dynamic&gt; route = _history.last;</span><br><span class=\"line\">  assert(route._navigator == this);</span><br><span class=\"line\">  bool debugPredictedWouldPop;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x9664;&#x4E86;&#x4E0A;&#x9762;&#x4E24;&#x4E2A;&#x5E38;&#x7528;&#x7684;&#xFF0C;&#x8FD8;&#x6709;&#x4E0B;&#x9762;&#x51E0;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x64CD;&#x4F5C;</p>\n<ol>\n<li>pushReplacement: &#x5C06;&#x5F53;&#x524D;&#x7684;&#x8DEF;&#x7531;&#x9875;&#x9762;&#x8FDB;&#x884C;&#x66FF;&#x6362;&#x6210;&#x65B0;&#x7684;&#x8DEF;&#x7531;&#x9875;&#x9762;, &#x4E4B;&#x524D;&#x7684;&#x8DEF;&#x7531;&#x5C06;&#x4F1A;&#x5931;&#x6548;&#x3002;</li>\n<li>pushAndRemoveUntil: &#x52A0;&#x5165;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8DEF;&#x7531;&#xFF0C;&#x540C;&#x65F6;&#x5B83;&#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x5224;&#x65AD;&#x6761;&#x4EF6;&#xFF0C;&#x5982;&#x679C;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x5C06;&#x4F1A;&#x79FB;&#x9664;&#x4E4B;&#x524D;&#x6240;&#x6709;&#x7684;&#x8DEF;&#x7531;&#x3002;<br>&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x6839;&#x636E;&#x7279;&#x5B9A;&#x573A;&#x666F;&#x4F7F;&#x7528;&#xFF0C;&#x4F8B;&#x5982;&#x6587;&#x7AE0;&#x6700;&#x5F00;&#x59CB;&#x7684;&#x767B;&#x5F55;&#x5224;&#x65AD;&#x793A;&#x4F8B;&#x3002;&#x8FD9;&#x6BB5;&#x5224;&#x65AD;&#x4EE3;&#x7801;&#x5176;&#x5B9E;&#x5728;App&#x542F;&#x52A8;&#x65F6;&#x7684;&#x5F15;&#x5BFC;&#x9875;&#x9762;&#x4E2D;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x7BA1;&#x6700;&#x7EC8;&#x8DF3;&#x8F6C;&#x5230;&#x54EA;&#x4E2A;&#x9875;&#x9762;&#xFF0C;&#x6700;&#x7EC8;&#x8FD9;&#x4E2A;&#x5F15;&#x5BFC;&#x9875;&#x9762;&#x90FD;&#x9700;&#x8981;&#x4ECE;&#x8DEF;&#x7531;&#x4E2D;&#x6D88;&#x5931;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;pushReplacement&#x6765;&#x5F00;&#x542F;&#x65B0;&#x7684;&#x8DEF;&#x7531;&#x9875;&#x9762;&#x3002;</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Navigator.of(context).pushReplacement(MaterialPageRoute(builder: (context){</span><br><span class=\"line\">   return HomePage();</span><br><span class=\"line\"> }));</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x4F20;&#x53C2;\"><a href=\"#&#x4F20;&#x53C2;\" class=\"headerlink\" title=\"&#x4F20;&#x53C2;\"></a>&#x4F20;&#x53C2;</h2><p>&#x8DEF;&#x7531;&#x8DF3;&#x8F6C;&#x9875;&#x9762;&#x81EA;&#x7136;&#x5C11;&#x4E0D;&#x4E86;&#x53C2;&#x6570;&#x7684;&#x4F20;&#x9012;&#xFF0C;&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x8DEF;&#x7531;&#x8DF3;&#x8F6C;&#xFF0C;&#x4F20;&#x53C2;&#x4E5F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x5B9E;&#x4F8B;&#x7C7B;&#x8FDB;&#x884C;&#x4F20;&#x53C2;&#x3002;</p>\n<p>&#x6211;&#x8FD9;&#x91CC;&#x4EE5;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#x4E2D;&#x7684;WebViePage&#x4E3A;&#x4F8B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class WebViewPage extends BasePage&lt;_WebViewState&gt; {</span><br><span class=\"line\">  final String url;</span><br><span class=\"line\">  final String requestUrl;</span><br><span class=\"line\">  final String title;</span><br><span class=\"line\"> </span><br><span class=\"line\">  WebViewPage({@required this.title, this.url = &apos;&apos;, this.requestUrl = &apos;&apos;});</span><br><span class=\"line\"> </span><br><span class=\"line\">  @override</span><br><span class=\"line\">  _WebViewState createBaseState() =&gt; _WebViewState(title, url, requestUrl);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x662F;WebViewPage&#x53C2;&#x6570;&#x7684;&#x63A5;&#x6536;&#xFF0C;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x5B9E;&#x4F8B;&#x5316;&#x8FDB;&#x884C;&#x53C2;&#x6570;&#x4F20;&#x9012;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">contentTap(int index, BuildContext context) {</span><br><span class=\"line\">  NotificationModel item = _notifications[index];</span><br><span class=\"line\">  if(item.unread) _markThreadRead(index, context);</span><br><span class=\"line\">  Navigator.push(context, MaterialPageRoute(builder: (_) {</span><br><span class=\"line\">    return WebViewPage(</span><br><span class=\"line\">      title: item.subject?.title ?? &apos;&apos;,</span><br><span class=\"line\">      requestUrl: item.subject?.url ?? &apos;&apos;,</span><br><span class=\"line\">    );</span><br><span class=\"line\">  }));</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x662F;&#x901A;&#x8FC7;&#x70B9;&#x51FB;&#x6587;&#x672C;&#x8DF3;&#x8F6C;&#x5230;WebViewPage&#x9875;&#x9762;&#xFF0C;&#x4F7F;&#x7528;push&#x64CD;&#x4F5C;&#x6765;&#x5BFC;&#x822A;&#x5230;WebViewPage&#x9875;&#x9762;&#xFF0C;&#x540C;&#x65F6;&#x5728;&#x5B9E;&#x4F8B;&#x5316;&#x65F6;&#x5C06;&#x76F8;&#x5E94;&#x7684;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x8FC7;&#x53BB;&#x3002;</p>\n<p>&#x4EE5;&#x4E0A;&#x662F;&#x76F8;&#x5BF9;&#x6BD4;&#x8F83;&#x539F;&#x59CB;&#x7684;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x53C2;&#x6570;&#x4F20;&#x9012;&#xFF0C;&#x8FD8;&#x6709;&#x53E6;&#x4E00;&#x79CD;</p>\n<p>&#x505A;&#x4E2A;Android&#x7684;&#x670B;&#x53CB;&#x90FD;&#x77E5;&#x9053;&#x5728;Activity&#x9875;&#x9762;&#x8DF3;&#x8F6C;&#x65F6;&#x53EF;&#x4EE5;&#x540C;Intent&#x8FDB;&#x884C;&#x53C2;&#x6570;&#x4F20;&#x9012;&#xFF0C;&#x800C;&#x63A5;&#x53D7;&#x9875;&#x9762;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Intent&#x6765;&#x83B7;&#x53D6;&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;&#x53C2;&#x6570;&#x3002;</p>\n<p>&#x5728;Flutter&#x4E2D;&#x4E5F;&#x6709;&#x7C7B;&#x4F3C;&#x7684;&#x4F20;&#x53C2;&#x65B9;&#x5F0F;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;MaterialPageRoute&#x4E2D;&#x7684;settings&#x6765;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;arguments&#x5BF9;&#x8C61;&#xFF0C;&#x5C06;&#x5176;&#x4F20;&#x9012;&#x5230;&#x8DF3;&#x8F6C;&#x7684;&#x9875;&#x9762;&#x4E2D;&#x3002;</p>\n<p>&#x5C06;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x6539;&#x7248;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">contentTap(int index, BuildContext context) {</span><br><span class=\"line\">  NotificationModel item = _notifications[index];</span><br><span class=\"line\">  if (item.unread) _markThreadRead(index, context);</span><br><span class=\"line\">  Navigator.push(</span><br><span class=\"line\">      context,</span><br><span class=\"line\">      MaterialPageRoute(</span><br><span class=\"line\">          builder: (_) {</span><br><span class=\"line\">            return WebViewPage();</span><br><span class=\"line\">          },</span><br><span class=\"line\">          settings: RouteSettings(</span><br><span class=\"line\">              arguments: {WebViewPage.ARGS_TITLE: item.subject?.title ?? &apos;&apos;, WebViewPage.ARGS_REQUEST_URL: item.subject?.url ?? &apos;&apos;})));</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x662F;&#x53C2;&#x6570;&#x4F20;&#x9012;&#xFF0C;&#x4E0B;&#x9762;&#x662F;WebViewPage&#x4E2D;&#x5BF9;&#x53C2;&#x6570;&#x7684;&#x63A5;&#x6536;&#x5904;&#x7406;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Map&lt;String, String&gt; arguments = ModalRoute.of(context).settings.arguments;</span><br><span class=\"line\">_title = arguments[WebViewPage.ARGS_TITLE];</span><br><span class=\"line\">_url = arguments[WebViewPage.ARGS_URL];</span><br><span class=\"line\">vm.requestUrl = arguments[WebViewPage.ARGS_REQUEST_URL];</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x63A5;&#x6536;&#x9875;&#x9762;&#x53C2;&#x6570;&#x662F;&#x901A;&#x8FC7;ModalRoute&#x6765;&#x83B7;&#x53D6;&#x7684;&#xFF0C;&#x83B7;&#x53D6;&#x5230;&#x7684;arguments&#x5C31;&#x662F;&#x4E0A;&#x9762;&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;&#x53C2;&#x6570;map&#x6570;&#x636E;&#x3002;</p>\n<p>ModalRoute.of()&#x5185;&#x90E8;&#x8FD0;&#x7528;&#x7684;&#x662F;context.dependOnInheritedWidgetOfExactType()</p>\n<p>&#x662F;&#x4E0D;&#x662F;&#x6709;&#x70B9;&#x773C;&#x719F;&#xFF1F;&#x5982;&#x679C;&#x4E0D;&#x8BB0;&#x5F97;&#x7684;&#x8BDD;&#x63A8;&#x8350;&#x91CD;&#x65B0;&#x6E29;&#x4E60;&#x4E00;&#x904D;<a href=\"https://juejin.im/post/5edf695fe51d457b3f4a1854\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: InheritedWidget</a></p>\n<p>&#x4EE5;&#x4E0A;&#x90FD;&#x662F;&#x975E;&#x547D;&#x540D;&#x8DEF;&#x7531;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x547D;&#x540D;&#x8DEF;&#x7531;&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x53C2;&#x6570;&#x65B9;&#x5F0F;&#x3002;</p>\n<h2 id=\"&#x547D;&#x540D;&#x8DEF;&#x7531;\"><a href=\"#&#x547D;&#x540D;&#x8DEF;&#x7531;\" class=\"headerlink\" title=\"&#x547D;&#x540D;&#x8DEF;&#x7531;\"></a>&#x547D;&#x540D;&#x8DEF;&#x7531;</h2><p>&#x547D;&#x540D;&#x8DEF;&#x7531;&#xFF0C;&#x987E;&#x540D;&#x601D;&#x4E49;&#x901A;&#x8FC7;&#x63D0;&#x524D;&#x6CE8;&#x518C;&#x597D;&#x7684;&#x540D;&#x79F0;&#x6765;&#x8DF3;&#x8F6C;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x9875;&#x9762;&#x3002;</p>\n<p>&#x9996;&#x9875;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x8DEF;&#x7531;&#x8868;&#xFF0C;&#x7EA6;&#x5B9A;&#x597D;&#x540D;&#x79F0;&#x4E0E;&#x9875;&#x9762;&#x7684;&#x4E00;&#x4E00;&#x5BF9;&#x5E94;&#x3002;</p>\n<p>&#x800C;&#x8DEF;&#x7531;&#x8868;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;routes&#x6765;&#x5B9A;&#x4E49;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">final Map&lt;String, WidgetBuilder&gt; routes;</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x5B9A;&#x4E49;&#xFF0C;&#x5E94;&#x8BE5;&#x5F88;&#x597D;&#x7406;&#x89E3;&#x3002;&#x5B83;&#x662F;&#x4E00;&#x4E2A;map&#xFF0C;key&#x4EE3;&#x8868;&#x8DEF;&#x7531;&#x540D;&#x79F0;&#xFF0C;value&#x4EE3;&#x8868;&#x5177;&#x4F53;&#x7684;&#x9875;&#x9762;&#x5B9E;&#x4F8B;&#x3002;</p>\n<p>&#x4EE5;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#x4E2D;&#x7684;GithubApp&#x4E3A;&#x4F8B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class _GithubAppState extends State&lt;GithubApp&gt; {</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) {</span><br><span class=\"line\">    return MaterialApp(</span><br><span class=\"line\">      title: &apos;Flutter Github&apos;,</span><br><span class=\"line\">      theme: ThemeData.light(),</span><br><span class=\"line\">      initialRoute: welcomeRoute.routeName,</span><br><span class=\"line\">      routes: {</span><br><span class=\"line\">        welcomeRoute.routeName: (BuildContext context) =&gt; WelcomePage(),</span><br><span class=\"line\">        loginRoute.routeName: (BuildContext context) =&gt; LoginPage(),</span><br><span class=\"line\">        homeRoute.routeName: (BuildContext context) =&gt; HomePage(),</span><br><span class=\"line\">        repositoryRoute.routeName: (BuildContext context) =&gt; RepositoryPage(),</span><br><span class=\"line\">        followersRoute.routeName: (BuildContext context) =&gt;</span><br><span class=\"line\">            FollowersPage(followersRoute.pageType),</span><br><span class=\"line\">        followingRoute.routeName: (BuildContext context) =&gt;</span><br><span class=\"line\">            FollowersPage(followingRoute.pageType),</span><br><span class=\"line\">        webViewRoute.routeName: (BuildContext context) =&gt; WebViewPage(),</span><br><span class=\"line\">      },</span><br><span class=\"line\">    );</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x6709;&#x4E24;&#x70B9;</p>\n<ol>\n<li>initialRoute&#x662F;&#x7528;&#x6765;&#x521D;&#x59CB;&#x5316;&#x8DEF;&#x7531;&#x9875;&#x9762;&#xFF0C;&#x5B83;&#x63A5;&#x6536;&#x7684;&#x4E5F;&#x662F;&#x5BF9;&#x5E94;&#x8DEF;&#x7531;&#x9875;&#x9762;&#x7684;&#x6CE8;&#x518C;&#x540D;&#x79F0;</li>\n<li>routes&#x5C31;&#x662F;&#x6CE8;&#x518C;&#x7684;&#x8DEF;&#x7531;&#x8868;&#xFF0C;&#x53EA;&#x9700;&#x901A;&#x8FC7;key&#x3001;value&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x6CE8;&#x518C;&#x5BF9;&#x5E94;&#x7684;&#x8DEF;&#x7531;&#x9875;&#x9762;&#x3002;</li>\n</ol>\n<p>&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x7BA1;&#x7406;&#x8DEF;&#x7531;&#x7684;&#x8DF3;&#x8F6C;&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E86;AppRoutes&#x6765;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;&#x8DEF;&#x7531;&#x7684;&#x540D;&#x79F0;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class AppRoutes {</span><br><span class=\"line\">  final String routeName;</span><br><span class=\"line\">  final String pageTitle;</span><br><span class=\"line\">  final String pageType;</span><br><span class=\"line\"> </span><br><span class=\"line\">  const AppRoutes(this.routeName, {this.pageTitle, this.pageType});</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">class PageType {</span><br><span class=\"line\">  static const String followers = &apos;followers&apos;;</span><br><span class=\"line\">  static const String following = &apos;following&apos;;</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">const AppRoutes welcomeRoute = AppRoutes(&apos;/&apos;);</span><br><span class=\"line\"> </span><br><span class=\"line\">const AppRoutes loginRoute = AppRoutes(&apos;/login&apos;);</span><br><span class=\"line\"> </span><br><span class=\"line\">const AppRoutes homeRoute = AppRoutes(&apos;/home&apos;);</span><br><span class=\"line\"> </span><br><span class=\"line\">const AppRoutes repositoryRoute =</span><br><span class=\"line\">    AppRoutes(&apos;/repository&apos;, pageTitle: &apos;repository&apos;);</span><br><span class=\"line\"> </span><br><span class=\"line\">const AppRoutes followersRoute = AppRoutes(&apos;/followers&apos;,</span><br><span class=\"line\">    pageTitle: &apos;followers&apos;, pageType: PageType.followers);</span><br><span class=\"line\">const AppRoutes followingRoute = AppRoutes(&apos;/following&apos;,</span><br><span class=\"line\">    pageTitle: &apos;following&apos;, pageType: PageType.following);</span><br><span class=\"line\"> </span><br><span class=\"line\">const AppRoutes webViewRoute = AppRoutes(&apos;/webview&apos;, pageTitle: &apos;WebView&apos;);</span><br></pre></td></tr></table></figure>\n<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x6CE8;&#x518C;&#x597D;&#x4E86;&#x9700;&#x8981;&#x8DF3;&#x8F6C;&#x7684;&#x9875;&#x9762;&#x8DEF;&#x7531;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x4F7F;&#x7528;&#x547D;&#x540D;&#x8DEF;&#x7531;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x66FF;&#x6362;&#x4E4B;&#x524D;&#x4ECB;&#x7ECD;&#x7684;&#x8DEF;&#x7531;&#x65B9;&#x5F0F;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void _goToLogin() async {</span><br><span class=\"line\">  SharedPreferences prefs = await SharedPreferences.getInstance();</span><br><span class=\"line\">  String authorization = prefs.getString(SP_AUTHORIZATION);</span><br><span class=\"line\">  String token = prefs.getString(SP_ACCESS_TOKEN);</span><br><span class=\"line\">  if ((authorization != null &amp;&amp; authorization.isNotEmpty) ||</span><br><span class=\"line\">      (token != null &amp;&amp; token.isNotEmpty)) {</span><br><span class=\"line\">    Navigator.pushReplacementNamed(context, homeRoute.routeName);</span><br><span class=\"line\">  } else {</span><br><span class=\"line\">    Navigator.pushReplacementNamed(context, loginRoute.routeName);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x767B;&#x5F55;&#x72B6;&#x6001;&#x5224;&#x65AD;&#x8DF3;&#x8F6C;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x901A;&#x8FC7;pushReplacementNamed()&#x6765;&#x8DF3;&#x8F6C;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x9875;&#x9762;&#x3002;&#x4E0E;&#x4E4B;&#x524D;&#x7684;&#x533A;&#x522B;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x4F20;&#x9012;&#x5BF9;&#x5E94;&#x8DF3;&#x8F6C;&#x9875;&#x9762;&#x7684;&#x8DEF;&#x7531;&#x540D;&#x79F0;&#x3002;&#x56E0;&#x4E3A;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x8DEF;&#x7531;&#x6CE8;&#x518C;&#x8868;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x81EA;&#x5DF1;&#x8F6C;&#x53D8;&#x6210;&#x76F8;&#x5E94;&#x7684;&#x9875;&#x9762;&#x3002;</p>\n<p>&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#x8FD8;&#x6709;pushNamed()&#x4E0E;pushNamedAndRemoveUntil()</p>\n<p>&#x5BF9;&#x4E8E;&#x547D;&#x540D;&#x8DEF;&#x7531;&#x7684;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x4E0E;&#x4E4B;&#x524D;&#x6700;&#x540E;&#x9762;&#x4ECB;&#x7ECD;&#x7684;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x65B9;&#x5F0F;&#x7C7B;&#x4F3C;&#xFF0C;&#x4F8B;&#x5982;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Navigator.of(context).pushNamed(webViewRoute.routeName, </span><br><span class=\"line\">    arguments: {WebViewPage.ARGS_TITLE: item.subject?.title ?? &apos;&apos;, WebViewPage.ARGS_REQUEST_URL: item.subject?.url ?? &apos;&apos;});</span><br></pre></td></tr></table></figure>\n<p>&#x57FA;&#x672C;&#x4E0A;&#x7C7B;&#x4F3C;&#xFF0C;&#x4E5F;&#x662F;&#x4F20;&#x9012;&#x4E00;&#x4E2A;arguments&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x9875;&#x9762;&#x63A5;&#x6536;&#x53C2;&#x6570;&#x7684;&#x65B9;&#x5F0F;&#x4FDD;&#x5B58;&#x4E0D;&#x53D8;&#x3002;</p>\n<h2 id=\"onGenerateRoute\"><a href=\"#onGenerateRoute\" class=\"headerlink\" title=\"onGenerateRoute\"></a>onGenerateRoute</h2><p>&#x547D;&#x540D;&#x8DEF;&#x7531;&#x4E2D;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;onGenerateRoute</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class _GithubAppState extends State&lt;GithubApp&gt; {</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) {</span><br><span class=\"line\">    return MaterialApp(</span><br><span class=\"line\">    ...</span><br><span class=\"line\">      onGenerateRoute: (RouteSettings setting) {</span><br><span class=\"line\">        return MaterialPageRoute(builder: (context) {</span><br><span class=\"line\">          String routeName = setting.name;</span><br><span class=\"line\">          // todo navigator</span><br><span class=\"line\">        });</span><br><span class=\"line\">      },</span><br><span class=\"line\">    );</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x7684;&#x56DE;&#x8C03;&#x6761;&#x4EF6;&#x662F;&#xFF1A;&#x8DF3;&#x8F6C;&#x7684;&#x9875;&#x9762;&#x6CA1;&#x6709;&#x5728;routes&#x4E2D;&#x8FDB;&#x884C;&#x8DEF;&#x7531;&#x6CE8;&#x518C;</p>\n<p>&#x901A;&#x8FC7;&#x8BE5;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x8FD9;&#x91CC;&#x8FDB;&#x884C;&#x8DEF;&#x7531;&#x62E6;&#x622A;&#xFF0C;&#x518D;&#x7EDF;&#x4E00;&#x505A;&#x4E00;&#x4E9B;&#x9875;&#x9762;&#x8DF3;&#x8F6C;&#x7684;&#x903B;&#x8F91;&#x5904;&#x7406;&#x3002;</p>\n<p>Navigator&#x65B9;&#x9762;&#x7684;&#x77E5;&#x8BC6;&#x5C31;&#x4ECB;&#x7ECD;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x5982;&#x679C;&#x6587;&#x7AE0;&#x4E2D;&#x6709;&#x4E0D;&#x8DB3;&#x7684;&#x5730;&#x65B9;&#x6B22;&#x8FCE;&#x6307;&#x51FA;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x4F60;&#x8FD9;&#x5176;&#x4E2D;&#x6709;&#x4EC0;&#x4E48;&#x7591;&#x95EE;&#x4E5F;&#x53EF;&#x4EE5;&#x7559;&#x8A00;&#x4E0E;&#x6211;&#xFF0C;&#x6211;&#x5C06;&#x529B;&#x6240;&#x80FD;&#x53CA;&#x7684;&#x8FDB;&#x884C;&#x89E3;&#x7B54;&#x3002;</p>\n<h2 id=\"&#x63A8;&#x8350;&#x9879;&#x76EE;\"><a href=\"#&#x63A8;&#x8350;&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;&#x9879;&#x76EE;\"></a>&#x63A8;&#x8350;&#x9879;&#x76EE;</h2><p>&#x4E0B;&#x9762;&#x4ECB;&#x7ECD;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;Flutter&#x9879;&#x76EE;&#xFF0C;&#x5BF9;&#x4E8E;&#x65B0;&#x624B;&#x6765;&#x8BF4;&#x662F;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x5165;&#x95E8;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;Flutter&#x7684;Github&#x5BA2;&#x6237;&#x7AEF;&#x540C;&#x65F6;&#x652F;&#x6301;Android&#x4E0E;IOS&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;dart&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;Model/State/ViewModel&#x7684;MSVM&#xFF1B;&#x4F7F;&#x7528;Navigator&#x8FDB;&#x884C;&#x9875;&#x9762;&#x7684;&#x8DF3;&#x8F6C;&#xFF1B;&#x7F51;&#x7EDC;&#x6846;&#x67B6;&#x4F7F;&#x7528;&#x4E86;dio&#x3002;&#x9879;&#x76EE;&#x6B63;&#x5728;&#x6301;&#x7EED;&#x66F4;&#x65B0;&#x4E2D;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x4E00;&#x4E0B;&#x3002;</p>\n<p><img src=\"/2020/06/24/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-Navigator/flutter_github_preview.png\" alt></p>\n<p>&#x5F53;&#x7136;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x4E86;&#x89E3;Android&#x539F;&#x751F;&#xFF0C;&#x76F8;&#x4FE1;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#x7684;&#x7EAF;Android&#x7248;&#x672C;<a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x559C;&#x6B22;&#x6211;&#x7684;&#x6587;&#x7AE0;&#x6A21;&#x5F0F;&#xFF0C;&#x6216;&#x8005;&#x5BF9;&#x6211;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x6587;&#x7AE0;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x5EFA;&#x8BAE;&#x60A8;&#x5173;&#x6CE8;&#x6211;&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF1A;&#x3010;Android&#x8865;&#x7ED9;&#x7AD9;&#x3011;</p>\n<p>&#x6216;&#x8005;&#x626B;&#x63CF;&#x4E0B;&#x65B9;&#x4E8C;&#x7EF4;&#x7801;&#xFF0C;&#x4E0E;&#x6211;&#x5EFA;&#x7ACB;&#x6709;&#x6548;&#x7684;&#x6C9F;&#x901A;&#xFF0C;&#x540C;&#x65F6;&#x66F4;&#x5FEB;&#x66F4;&#x51C6;&#x7684;&#x6536;&#x5230;&#x6211;&#x7684;&#x66F4;&#x65B0;&#x63A8;&#x9001;&#x3002;</p>\n<p><img src=\"/2020/06/24/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-Navigator/Android&#x8865;&#x7ED9;&#x7AD9;.jpg\" alt></p>\n","categories":["android"],"tags":["flutter"]},{"title":"从零开始的Flutter之旅: Provider","url":"https://www.rousetime.com/2020/06/04/从零开始的Flutter之旅-Provider/","content":"<h2 id=\"&#x5F80;&#x671F;&#x56DE;&#x987E;\"><a href=\"#&#x5F80;&#x671F;&#x56DE;&#x987E;\" class=\"headerlink\" title=\"&#x5F80;&#x671F;&#x56DE;&#x987E;\"></a>&#x5F80;&#x671F;&#x56DE;&#x987E;</h2><p><a href=\"https://juejin.im/post/5e62f280e51d4534ec0066b8\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: StatelessWidget</a><br><a href=\"https://juejin.im/post/5e6f871bf265da572a0d160c\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: StatefulWidget</a><br><a href=\"https://juejin.im/post/5edf695fe51d457b3f4a1854\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: InheritedWidget</a></p>\n<p>&#x5728;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x6211;&#x4EEC;&#x4ECB;&#x7ECD;&#x4E86;<a href=\"https://juejin.im/post/5edf695fe51d457b3f4a1854\" target=\"_blank\" rel=\"noopener\">InheritedWidget</a>&#xFF0C;&#x5E76;&#x5728;&#x6700;&#x540E;&#x5F15;&#x53D1;&#x51FA;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>\n<p>&#x867D;&#x7136;InheritedWidget&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x5171;&#x4EAB;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x8FC7;getElementForInheritedWidgetOfExactType&#x6765;&#x89E3;&#x9664;didChangeDependencies&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x4F46;&#x8FD8;&#x662F;&#x6CA1;&#x6709;&#x907F;&#x514D;CountWidget&#x7684;&#x91CD;&#x65B0;build&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x5C06;build&#x6700;&#x5C0F;&#x5316;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x4ECA;&#x5929;&#x5C31;&#x6765;&#x89E3;&#x51B3;&#x5982;&#x4F55;&#x907F;&#x514D;&#x4E0D;&#x5FC5;&#x8981;&#x7684;build&#x6784;&#x5EFA;&#xFF0C;&#x5C06;build&#x7F29;&#x5C0F;&#x5230;&#x6700;&#x5C0F;&#x7684;CountText&#x3002;</p>\n<h2 id=\"&#x5206;&#x6790;\"><a href=\"#&#x5206;&#x6790;\" class=\"headerlink\" title=\"&#x5206;&#x6790;\"></a>&#x5206;&#x6790;</h2><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x6765;&#x5206;&#x6790;&#x4E0B;&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x5BFC;&#x81F4;&#x7236;widget&#x7684;&#x91CD;&#x65B0;build&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class CountWidget extends StatefulWidget {</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  _CountState createState() {</span><br><span class=\"line\">    return _CountState();</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">class _CountState extends State&lt;CountWidget&gt; {</span><br><span class=\"line\">  int count = 0;</span><br><span class=\"line\"> </span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) {</span><br><span class=\"line\">    return MaterialApp(</span><br><span class=\"line\">      title: &apos;Count App&apos;,</span><br><span class=\"line\">      theme: new ThemeData(primarySwatch: Colors.blue),</span><br><span class=\"line\">      home: Scaffold(</span><br><span class=\"line\">        appBar: AppBar(</span><br><span class=\"line\">          title: Text(&quot;Count&quot;),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        body: Center(</span><br><span class=\"line\">          child: CountInheritedWidget(</span><br><span class=\"line\">            count: count,</span><br><span class=\"line\">            child: Column(</span><br><span class=\"line\">              mainAxisAlignment: MainAxisAlignment.center,</span><br><span class=\"line\">              children: &lt;Widget&gt;[</span><br><span class=\"line\">                CountText(),</span><br><span class=\"line\">                RaisedButton(</span><br><span class=\"line\">                  onPressed: () =&gt; setState(() =&gt; count++),</span><br><span class=\"line\">                  child: Text(&quot;Increment&quot;),</span><br><span class=\"line\">                )</span><br><span class=\"line\">              ],</span><br><span class=\"line\">            ),</span><br><span class=\"line\">          ),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x5206;&#x6790;&#xFF0C;&#x6211;&#x628A;&#x4E4B;&#x524D;&#x7684;&#x4EE3;&#x7801;&#x63D0;&#x5230;&#x8FD9;&#x91CC;&#x6765;&#x3002;</p>\n</blockquote>\n<p>&#x6211;&#x4EEC;&#x6765;&#x770B;&#xFF0C;&#x5728;&#x70B9;&#x51FB;RaisedButton&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x901A;&#x8FC7;setState&#x5C06;count&#x8FDB;&#x884C;&#x66F4;&#x65B0;&#x3002;&#x800C;&#x6B64;&#x65F6;&#x7684;setState&#x65B9;&#x6CD5;&#x7684;&#x63D0;&#x4F9B;&#x8005;&#x662F;_CountState&#xFF0C;&#x5373;CountWidget&#x3002;&#x800C;state&#x7684;&#x6539;&#x53D8;&#x4F1A;&#x5BFC;&#x81F4;build&#x7684;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#xFF0C;&#x5BFC;&#x81F4;&#x7684;&#x6548;&#x679C;&#x662F;CountWidget&#x7684;build&#x88AB;&#x91CD;&#x65B0;&#x8C03;&#x7528;&#xFF0C;&#x7EE7;&#x800C;&#x5B83;&#x7684;&#x5B50;widget&#x4E5F;&#x76F8;&#x7EE7;&#x88AB;&#x91CD;&#x65B0;build&#x3002;</p>\n<p>&#x65E2;&#x7136;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x4E86;&#x539F;&#x56E0;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x601D;&#x8003;&#x4E0B;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;</p>\n<p>1.&#x6700;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x7F29;&#x5C0F;setState&#x63D0;&#x4F9B;&#x8005;&#x7684;&#x8303;&#x56F4;&#x3002;&#x73B0;&#x5728;&#x662F;CountWidget&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5176;&#x7F29;&#x5C0F;&#x5230;Column&#x3002;<br>2.&#x867D;&#x7136;&#x5DF2;&#x7ECF;&#x7F29;&#x5C0F;&#x5230;&#x4E86;Column&#xFF0C;&#x4F46;&#x8FD8;&#x662F;&#x65E0;&#x6CD5;&#x907F;&#x514D;&#x81EA;&#x8EAB;&#x7684;build&#x4E0E;&#x5176;CountText&#x4E4B;&#x5916;&#x7684;&#x5B50;Widget(RaisedButton)&#x7684;&#x91CD;&#x65B0;build&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5C06;Column&#x5168;&#x90E8;&#x7F13;&#x5B58;&#x4E0B;&#x6765;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x5728;Column&#x5916;&#x5C42;&#x5957;&#x4E00;&#x4E2A;Widget&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#xFF0C;&#x4E00;&#x65E6;&#x5916;&#x5C42;&#x7684;Widget&#x91CD;&#x65B0;build&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x4F7F;&#x7528;Column&#x7684;&#x7F13;&#x5B58;&#xFF0C;&#x8FD9;&#x6837;&#x4E0D;&#x5C31;&#x907F;&#x514D;&#x4E86;Column&#x7684;&#x91CD;&#x65B0;build&#x3002;&#x4E0D;&#x8FC7;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x4EE5;&#x540E;&#x4F1A;&#x6709;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x65E2;&#x7136;&#x662F;&#x7F13;&#x5B58;&#xFF0C;Center&#x91CC;&#x9762;&#x7684;CountText&#x4E5F;&#x5C06;&#x4E0D;&#x4F1A;&#x6539;&#x53D8;&#x3002;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x8981;&#x4F7F;&#x7528;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x7684;InheritedWidget&#x3002;&#x5C06;&#x6574;&#x4E2A;Column&#x653E;&#x5230;InheritedWidget&#x4E2D;&#xFF0C;&#x867D;&#x7136;Column&#x662F;&#x7F13;&#x5B58;&#xFF0C;&#x4F46;&#x662F;CountText&#x4E2D;&#x5F15;&#x7528;&#x4E86;InheritedWidget&#x4E2D;&#x7684;count&#x6570;&#x636E;&#xFF0C;&#x4E00;&#x65E6;count&#x53D1;&#x751F;&#x6539;&#x53D8;&#xFF0C;&#x5C06;&#x4F1A;&#x901A;&#x77E5;&#x5176;&#x8FDB;&#x884C;&#x91CD;&#x65B0;build&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x4FDD;&#x8BC1;&#x4E86;&#x53EA;&#x5237;&#x65B0;CountText&#x3002;</p>\n<blockquote>\n<p>&#x5982;&#x679C;&#x4F60;&#x5BF9;InheritedWidget&#x4E0D;&#x719F;&#x6089;&#xFF0C;&#x63A8;&#x8350;&#x9605;&#x8BFB;<a href=\"https://juejin.im/post/5edf695fe51d457b3f4a1854\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: InheritedWidget</a></p>\n</blockquote>\n<p>&#x6211;&#x4EEC;&#x6765;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#xFF0C;&#x5728;Column&#x5916;&#x5957;&#x4E00;&#x5C42;Widget&#xFF0C;&#x5E76;&#x5C06;Column&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#xFF0C;&#x7136;&#x540E;&#x5916;&#x5C42;&#x7684;Widget&#x7ED3;&#x5408;InheritedWidget&#x6765;&#x63D0;&#x4F9B;&#x5171;&#x4EAB;count&#x7684;&#x6570;&#x636E;&#x6E90;&#x3002;&#x4E00;&#x65E6;count&#x66F4;&#x65B0;&#x5C06;&#x4F1A;&#x8C03;&#x7528;&#x5916;&#x5C42;Widget&#x7684;setState&#xFF0C;&#x5E76;&#x4E14;&#x91CD;&#x65B0;build&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x662F;Column&#x7F13;&#x5B58;&#xFF0C;&#x540C;&#x65F6;CountText&#x901A;&#x8FC7;&#x4F9D;&#x8D56;&#x7684;&#x65B9;&#x5F0F;&#x5F15;&#x7528;&#x4E86;&#x5171;&#x4EAB;&#x7684;count&#x6570;&#x636E;&#x6E90;&#xFF0C;&#x4ECE;&#x800C;&#x4F1A;&#x540C;&#x6B65;build&#x66F4;&#x65B0;&#x3002;&#x800C;RaisedButton&#x4F7F;&#x7528;&#x7684;&#x662F;&#x672A;&#x4F9D;&#x8D56;&#x7684;&#x5171;&#x4EAB;count&#x6570;&#x636E;&#x6E90;&#xFF0C;&#x6240;&#x4EE5;&#x5E76;&#x4E0D;&#x4F1A;&#x91CD;&#x65B0;build&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x4FDD;&#x8BC1;&#x4E86;&#x53EA;&#x5237;&#x65B0;CountText&#x3002;</p>\n<p>&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x7EDF;&#x4E00;&#x5B9A;&#x4E49;&#x4E3A;Provider&#xFF0C;&#x5176;&#x5B9E;Flutter&#x5185;&#x90E8;&#x5DF2;&#x7ECF;&#x6709;Provider&#x7684;&#x5B8C;&#x6574;&#x5B9E;&#x73B0;&#xFF0C;&#x4E0D;&#x8FC7;&#x6211;&#x4EEC;&#x4E3A;&#x4E86;&#x5B66;&#x4E60;&#x8FD9;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x81EA;&#x5DF1;&#x6765;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7B80;&#x6613;&#x7248;&#x7684;Provider&#x3002;&#x4E4B;&#x540E;&#x518D;&#x53BB;&#x770B;Flutter&#x7684;<a href=\"https://pub.dev/packages/provider\" target=\"_blank\" rel=\"noopener\">Provider</a>&#x5C06;&#x4F1A;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3002;</p>\n<p>&#x65B9;&#x6848;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x6765;&#x770B;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x3002;</p>\n<h2 id=\"&#x5B9E;&#x73B0;\"><a href=\"#&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;\"></a>&#x5B9E;&#x73B0;</h2><p>1.&#x5B9A;&#x4E49;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x7684;ProviderInheritedWidget<br>2.&#x5B9A;&#x4E49;&#x76D1;&#x542C;&#x5237;&#x65B0;&#x7684;NotifyModel<br>3.&#x63D0;&#x4F9B;&#x7F13;&#x5B58;Widget&#x7684;ModelProviderWidget<br>4.&#x7EC4;&#x88C5;&#x66FF;&#x6362;&#x539F;&#x6709;&#x5B9E;&#x73B0;&#x65B9;&#x6848;</p>\n<h3 id=\"ProviderInheritedWidget\"><a href=\"#ProviderInheritedWidget\" class=\"headerlink\" title=\"ProviderInheritedWidget\"></a>ProviderInheritedWidget</h3><p>&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x81EA;&#x5DF1;&#x7684;InheritedWidget&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x6765;&#x63D0;&#x4F9B;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x6E90;&#xFF0C;&#x5E76;&#x63A5;&#x53D7;&#x7F13;&#x5B58;&#x7684;child&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ProviderInheritedWidget&lt;T&gt; extends InheritedWidget {</span><br><span class=\"line\">  final T data;</span><br><span class=\"line\">  final Widget child;</span><br><span class=\"line\"> </span><br><span class=\"line\">  ProviderInheritedWidget({@required this.data, this.child})</span><br><span class=\"line\">      : super(child: child);</span><br><span class=\"line\"> </span><br><span class=\"line\">  @override</span><br><span class=\"line\">  bool updateShouldNotify(ProviderInheritedWidget oldWidget) {</span><br><span class=\"line\">    // true -&gt; &#x901A;&#x77E5;&#x6811;&#x4E2D;&#x4F9D;&#x8D56;&#x6539;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x7684;&#x5B50;widget</span><br><span class=\"line\">    return true;</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"NotifyModel\"><a href=\"#NotifyModel\" class=\"headerlink\" title=\"NotifyModel\"></a>NotifyModel</h3><p>&#x4E3A;&#x4E86;&#x76D1;&#x542C;&#x5171;&#x4EAB;&#x6570;&#x636E;count&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x89C2;&#x5BDF;&#x8005;&#x8BA2;&#x9605;&#x6A21;&#x5F0F;&#x6765;&#x5B9E;&#x73B0;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class NotifyModel implements Listenable {</span><br><span class=\"line\">  List _listeners = [];</span><br><span class=\"line\"> </span><br><span class=\"line\">  @override</span><br><span class=\"line\">  void addListener(listener) {</span><br><span class=\"line\">    _listeners.add(listener);</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  @override</span><br><span class=\"line\">  void removeListener(listener) {</span><br><span class=\"line\">    _listeners.remove(listener);</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  void notifyDataSetChanged() {</span><br><span class=\"line\">    _listeners.forEach((item) =&gt; item());</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>Listenable&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x76D1;&#x542C;&#x63A5;&#x53E3;&#xFF0C;&#x901A;&#x8FC7;add&#x4E0E;remove&#x6765;&#x589E;&#x52A0;&#x4E0E;&#x79FB;&#x9664;&#x76D1;&#x542C;&#xFF0C;&#x7136;&#x540E;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;notify&#x65B9;&#x6CD5;&#x6765;&#x8FDB;&#x884C;&#x901A;&#x77E5;&#x76D1;&#x542C;&#x8005;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x7EE7;&#x627F;NotifyModel&#x6765;&#x4F7F;count&#x5177;&#x6709;&#x53EF;&#x76D1;&#x542C;&#x80FD;&#x529B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class CountModel extends NotifyModel {</span><br><span class=\"line\">  int count = 0;</span><br><span class=\"line\"> </span><br><span class=\"line\">  CountModel({this.count});</span><br><span class=\"line\"> </span><br><span class=\"line\">  void increment() {</span><br><span class=\"line\">    count++;</span><br><span class=\"line\">    notifyDataSetChanged();</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E00;&#x65E6;count&#x81EA;&#x589E;&#xFF0C;&#x5C31;&#x8C03;&#x7528;notifyDataSetChanged&#x6765;&#x901A;&#x77E5;&#x8BA2;&#x9605;&#x7684;&#x76D1;&#x542C;&#x8005;&#x3002;</p>\n<h3 id=\"ModelProviderWidget\"><a href=\"#ModelProviderWidget\" class=\"headerlink\" title=\"ModelProviderWidget\"></a>ModelProviderWidget</h3><p>&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;Provider&#x4E0E;Model&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x5916;&#x90E8;Widget&#x6765;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;&#x5B83;&#x4EEC;&#xFF0C;&#x5C06;&#x5B83;&#x4EEC;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ModelProviderWidget&lt;T extends NotifyModel&gt; extends StatefulWidget {</span><br><span class=\"line\">  final T data;</span><br><span class=\"line\"> </span><br><span class=\"line\">  final Widget child;</span><br><span class=\"line\"> </span><br><span class=\"line\">  // context &#x5FC5;&#x987B;&#x4E3A;&#x5F53;&#x524D;widget&#x7684;context</span><br><span class=\"line\">  static T of&lt;T&gt;(BuildContext context, {bool listen = true}) {</span><br><span class=\"line\">    return (listen ? context.dependOnInheritedWidgetOfExactType&lt;ProviderInheritedWidget&lt;T&gt;&gt;()</span><br><span class=\"line\">            : (context.getElementForInheritedWidgetOfExactType&lt;ProviderInheritedWidget&lt;T&gt;&gt;()</span><br><span class=\"line\">        .widget as ProviderInheritedWidget&lt;T&gt;)).data;</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  ModelProviderWidget({Key key, @required this.data, @required this.child})</span><br><span class=\"line\">      : super(key: key);</span><br><span class=\"line\"> </span><br><span class=\"line\">  @override</span><br><span class=\"line\">  _ModelProviderState&lt;T&gt; createState() =&gt; _ModelProviderState&lt;T&gt;();</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">class _ModelProviderState&lt;T extends NotifyModel&gt;</span><br><span class=\"line\">    extends State&lt;ModelProviderWidget&gt; {</span><br><span class=\"line\">  void notify() {</span><br><span class=\"line\">    setState(() {</span><br><span class=\"line\">      print(&quot;notify&quot;);</span><br><span class=\"line\">    });</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  @override</span><br><span class=\"line\">  void initState() {</span><br><span class=\"line\">    // &#x6DFB;&#x52A0;&#x76D1;&#x542C;</span><br><span class=\"line\">    widget.data.addListener(notify);</span><br><span class=\"line\">    super.initState();</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  @override</span><br><span class=\"line\">  void dispose() {</span><br><span class=\"line\">    // &#x79FB;&#x9664;&#x76D1;&#x542C;</span><br><span class=\"line\">    widget.data.removeListener(notify);</span><br><span class=\"line\">    super.dispose();</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  @override</span><br><span class=\"line\">  void didUpdateWidget(ModelProviderWidget&lt;T&gt; oldWidget) {</span><br><span class=\"line\">    // data &#x66F4;&#x65B0;&#x65F6;&#x79FB;&#x9664;&#x8001;&#x7684;data&#x76D1;&#x542C;</span><br><span class=\"line\">    if (oldWidget.data != widget.data) {</span><br><span class=\"line\">      oldWidget.data.removeListener(notify);</span><br><span class=\"line\">      widget.data.addListener(notify);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    super.didUpdateWidget(oldWidget);</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) {</span><br><span class=\"line\">    return ProviderInheritedWidget&lt;T&gt;(</span><br><span class=\"line\">      data: widget.data,</span><br><span class=\"line\">      child: widget.child,</span><br><span class=\"line\">    );</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x53EF;&#x76D1;&#x542C;&#x7684;data&#x6570;&#x636E;&#x4E0E;&#x9700;&#x8981;&#x7F13;&#x5B58;&#x7684;child&#xFF0C;&#x540C;&#x65F6;&#x5728;state&#x4E2D;&#x5BF9;&#x53EF;&#x76D1;&#x542C;&#x7684;data&#x5728;&#x5408;&#x9002;&#x7684;&#x5730;&#x65B9;&#x8FDB;&#x884C;&#x76D1;&#x542C;&#x8BA2;&#x9605;&#x4E0E;&#x79FB;&#x9664;&#x8BA2;&#x9605;&#xFF0C;&#x5E76;&#x5728;&#x6536;&#x5230;data&#x6570;&#x636E;&#x6539;&#x53D8;&#x65F6;&#x8C03;&#x7528;notify&#x8FDB;&#x884C;setState&#x64CD;&#x4F5C;&#xFF0C;&#x901A;&#x77E5;widget&#x5237;&#x65B0;&#x3002;</p>\n<p>&#x5728;build&#x4E2D;&#x5F15;&#x7528;&#x4E86;ProviderInheritedWidget&#xFF0C;&#x6765;&#x5B9E;&#x73B0;&#x5BF9;&#x5171;&#x4EAB;&#x5B50;widget&#x7684;&#x6570;&#x636E;&#x5171;&#x4EAB;&#xFF0C;&#x540C;&#x65F6;&#x5728;ModelProviderWidget&#x4E2D;&#x63D0;&#x4F9B;of&#x65B9;&#x6CD5;&#x6765;&#x66B4;&#x9732;ProviderInheritedWidget&#x7684;&#x7EDF;&#x4E00;&#x83B7;&#x53D6;&#x65B9;&#x5F0F;&#x3002;</p>\n<p>&#x901A;&#x8FC7;&#x53C2;&#x6570;listen(&#x9ED8;&#x8BA4;true)&#x6765;&#x63A7;&#x5236;&#x83B7;&#x53D6;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x6765;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x5EFA;&#x7ACB;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;&#x5373;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x6539;&#x53D8;&#x65F6;&#xFF0C;&#x5F15;&#x7528;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x7684;widget&#x662F;&#x5426;&#x91CD;&#x65B0;build&#x3002;</p>\n<p>&#x8FD9;&#x4E00;&#x5E55;&#x662F;&#x4E0D;&#x662F;&#x6709;&#x70B9;&#x4F3C;&#x66FE;&#x76F8;&#x8BC6;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x90FD;&#x662F;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x63D0;&#x5230;&#x7684;InheritedWidget&#x4F7F;&#x7528;&#x7684;&#x7EC6;&#x8282;&#x3002;</p>\n<p>&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x662F;&#x6700;&#x7EC8;&#x7684;&#x65B9;&#x6848;&#x66FF;&#x6362;</p>\n<h3 id=\"&#x7EC4;&#x88C5;&#x66FF;&#x6362;&#x539F;&#x6709;&#x5B9E;&#x73B0;&#x65B9;&#x6848;\"><a href=\"#&#x7EC4;&#x88C5;&#x66FF;&#x6362;&#x539F;&#x6709;&#x5B9E;&#x73B0;&#x65B9;&#x6848;\" class=\"headerlink\" title=\"&#x7EC4;&#x88C5;&#x66FF;&#x6362;&#x539F;&#x6709;&#x5B9E;&#x73B0;&#x65B9;&#x6848;\"></a>&#x7EC4;&#x88C5;&#x66FF;&#x6362;&#x539F;&#x6709;&#x5B9E;&#x73B0;&#x65B9;&#x6848;</h3><p>&#x6211;&#x4EEC;&#x901A;&#x8FC7;ModelProviderWidget.of&#x6765;&#x83B7;&#x53D6;&#x5171;&#x4EAB;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x8981;&#x4F7F;&#x7528;&#x5230;&#x4E86;&#x5171;&#x4EAB;&#x6570;&#x636E;&#xFF0C;&#x5C06;&#x8981;&#x8C03;&#x7528;&#x8BE5;&#x65B9;&#x6CD5;&#x3002;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x91CD;&#x590D;&#x4E66;&#x5199;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5176;&#x5355;&#x72EC;&#x5C01;&#x88C5;&#x5230;Consumer&#x4E2D;&#xFF0C;&#x5185;&#x90E8;&#x6765;&#x5B9E;&#x73B0;&#x5BF9;&#x5176;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x5E76;&#x4E14;&#x5C06;&#x8C03;&#x7528;&#x7684;&#x7ED3;&#x679C;&#x66B4;&#x9732;&#x51FA;&#x6765;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Consumer&lt;T&gt; extends StatelessWidget {</span><br><span class=\"line\">  final Widget Function(BuildContext context, T value) builder;</span><br><span class=\"line\"> </span><br><span class=\"line\">  const Consumer({Key key, @required this.builder}) : super(key: key);</span><br><span class=\"line\"> </span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) {</span><br><span class=\"line\">    print(&quot;Consumer build&quot;);</span><br><span class=\"line\">    return builder(context, ModelProviderWidget.of&lt;T&gt;(context));</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E00;&#x5207;&#x51C6;&#x5907;&#x5C31;&#x7EEA;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x5BF9;&#x4E4B;&#x524D;&#x7684;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x4F18;&#x5316;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class CountWidget extends StatefulWidget {</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  _CountState createState() {</span><br><span class=\"line\">    return _CountState();</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">class _CountState extends State&lt;CountWidget&gt; {</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) {</span><br><span class=\"line\">    print(&quot;CountWidget build&quot;);</span><br><span class=\"line\">    return MaterialApp(</span><br><span class=\"line\">      title: &apos;Count App&apos;,</span><br><span class=\"line\">      theme: new ThemeData(primarySwatch: Colors.blue),</span><br><span class=\"line\">      home: Scaffold(</span><br><span class=\"line\">        appBar: AppBar(</span><br><span class=\"line\">          title: Text(&quot;Count&quot;),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        body: Center(</span><br><span class=\"line\">          child: ModelProviderWidget&lt;CountModel&gt;(</span><br><span class=\"line\">            data: CountModel(count: 0),</span><br><span class=\"line\">            child: Column(</span><br><span class=\"line\">              mainAxisAlignment: MainAxisAlignment.center,</span><br><span class=\"line\">              children: &lt;Widget&gt;[</span><br><span class=\"line\">                Consumer&lt;CountModel&gt;(</span><br><span class=\"line\">                    builder: (context, value) =&gt; Text(&quot;count: ${value.count}&quot;)),</span><br><span class=\"line\">                Builder(</span><br><span class=\"line\">                  builder: (context) {</span><br><span class=\"line\">                    print(&quot;RaiseButton build&quot;);</span><br><span class=\"line\">                    return RaisedButton(</span><br><span class=\"line\">                      onPressed: () =&gt; ModelProviderWidget.of&lt;CountModel&gt;(</span><br><span class=\"line\">                              context,</span><br><span class=\"line\">                              listen: false)</span><br><span class=\"line\">                          .increment(),</span><br><span class=\"line\">                      child: Text(&quot;Increment&quot;),</span><br><span class=\"line\">                    );</span><br><span class=\"line\">                  },</span><br><span class=\"line\">                ),</span><br><span class=\"line\">              ],</span><br><span class=\"line\">            ),</span><br><span class=\"line\">          ),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x5C06;Column&#x7F13;&#x5B58;&#x5230;ModelProviderWidget&#x4E2D;&#xFF0C;&#x540C;&#x65F6;&#x5BF9;CountModel&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5171;&#x4EAB;&#xFF1B;&#x901A;&#x8FC7;Consumer&#x8FDB;&#x884C;Text&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x5F15;&#x7528;&#x5171;&#x4EAB;&#x6570;&#x636E;CountModel&#x4E2D;&#x7684;count&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;RaisedButton&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EA;&#x662F;&#x63D0;&#x4F9B;&#x70B9;&#x51FB;&#xFF0C;&#x5E76;&#x4E14;&#x89E6;&#x53D1;count&#x7684;&#x81EA;&#x589E;&#x64CD;&#x4F5C;&#x3001;&#x6CA1;&#x6709;&#x53D1;&#x751F;ui&#x4E0A;&#x7684;&#x4EFB;&#x4F55;&#x53D8;&#x5316;&#x3002;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x907F;&#x514D;RaisedButton&#x5F15;&#x7528;&#x7684;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x81EA;&#x589E;&#x65F6;&#x91CD;&#x65B0;build&#xFF0C;&#x8FD9;&#x91CC;&#x5C06;listen&#x53C2;&#x6570;&#x7F6E;&#x4E3A;false&#x3002;</p>\n<p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x8FD0;&#x884C;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x70B9;&#x51FB;Increment&#x6309;&#x94AE;&#x65F6;&#xFF0C;&#x63A7;&#x5236;&#x53F0;&#x5C06;&#x4F1A;&#x8F93;&#x51FA;&#x5982;&#x4E0B;&#x65E5;&#x5FD7;&#xFF1A;</p>\n<p><img src=\"/2020/06/04/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-Provider/inherited_widget_1.png\" alt></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">I/flutter ( 3141): notify</span><br><span class=\"line\">I/flutter ( 3141): Consumer build</span><br></pre></td></tr></table></figure>\n<p>&#x8BF4;&#x660E;&#x53EA;&#x6709;Consumer&#x91CD;&#x65B0;&#x8C03;&#x7528;&#x4E86;build&#xFF0C;&#x5373;Text&#x8FDB;&#x884C;&#x4E86;&#x5237;&#x65B0;&#x3002;&#x5176;&#x5B83;&#x7684;widget&#x90FD;&#x6CA1;&#x6709;&#x53D8;&#x5316;&#x3002;</p>\n<p>&#x8FD9;&#x6837;&#x5C31;&#x89E3;&#x51B3;&#x4E86;&#x5F00;&#x7BC7;&#x63D0;&#x5230;&#x7684;&#x7591;&#x95EE;&#xFF0C;&#x8FBE;&#x5230;&#x4E86;widget&#x5237;&#x65B0;&#x7684;&#x6700;&#x5C0F;&#x5316;&#x3002;</p>\n<p>&#x4EE5;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x5730;Provider-Consumer&#x7684;&#x4F7F;&#x7528;&#x3002;Flutter&#x5BF9;&#x8FD9;&#x4E00;&#x5757;&#x6709;&#x66F4;&#x5B8C;&#x5584;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6848;&#x3002;&#x4F46;&#x662F;&#x7ECF;&#x8FC7;&#x6211;&#x4EEC;&#x8FD9;&#x4E00;&#x8F6E;&#x5206;&#x6790;&#xFF0C;&#x4F60;&#x518D;&#x53BB;&#x770B;Flutter&#x4E2D;Provider&#x7684;&#x6E90;&#x7801;&#x5C06;&#x4F1A;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x6613;&#x61C2;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x60F3;&#x4E86;&#x89E3;Flutter&#x4E2D;Provider&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#x6765;&#x4E86;&#x89E3;&#x5B83;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x6218;&#x4F7F;&#x7528;&#x6280;&#x5DE7;&#x3002;</p>\n<blockquote>\n<p>&#x60F3;&#x8981;&#x67E5;&#x770B;Provider&#x5B9E;&#x6218;&#x6280;&#x5DE7;&#xFF0C;&#x9700;&#x8981;&#x5C06;&#x5206;&#x652F;&#x5207;&#x6362;&#x5230;<strong>sample_provider</strong></p>\n</blockquote>\n<h2 id=\"&#x63A8;&#x8350;&#x9879;&#x76EE;\"><a href=\"#&#x63A8;&#x8350;&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;&#x9879;&#x76EE;\"></a>&#x63A8;&#x8350;&#x9879;&#x76EE;</h2><p>&#x4E0B;&#x9762;&#x4ECB;&#x7ECD;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;Flutter&#x9879;&#x76EE;&#xFF0C;&#x5BF9;&#x4E8E;&#x65B0;&#x624B;&#x6765;&#x8BF4;&#x662F;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x5165;&#x95E8;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;Flutter&#x7684;Github&#x5BA2;&#x6237;&#x7AEF;&#x540C;&#x65F6;&#x652F;&#x6301;Android&#x4E0E;IOS&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;dart&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;Model/State/ViewModel&#x7684;MSVM&#xFF1B;&#x4F7F;&#x7528;Navigator&#x8FDB;&#x884C;&#x9875;&#x9762;&#x7684;&#x8DF3;&#x8F6C;&#xFF1B;&#x7F51;&#x7EDC;&#x6846;&#x67B6;&#x4F7F;&#x7528;&#x4E86;dio&#x3002;&#x9879;&#x76EE;&#x6B63;&#x5728;&#x6301;&#x7EED;&#x66F4;&#x65B0;&#x4E2D;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x4E00;&#x4E0B;&#x3002;</p>\n<p><img src=\"/2020/06/04/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-Provider/flutter_github_preview.png\" alt></p>\n<p>&#x5F53;&#x7136;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x4E86;&#x89E3;Android&#x539F;&#x751F;&#xFF0C;&#x76F8;&#x4FE1;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#x7684;&#x7EAF;Android&#x7248;&#x672C;<a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x559C;&#x6B22;&#x6211;&#x7684;&#x6587;&#x7AE0;&#x6A21;&#x5F0F;&#xFF0C;&#x6216;&#x8005;&#x5BF9;&#x6211;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x6587;&#x7AE0;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x5EFA;&#x8BAE;&#x60A8;&#x5173;&#x6CE8;&#x6211;&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF1A;&#x3010;Android&#x8865;&#x7ED9;&#x7AD9;&#x3011;</p>\n<p>&#x6216;&#x8005;&#x626B;&#x63CF;&#x4E0B;&#x65B9;&#x4E8C;&#x7EF4;&#x7801;&#xFF0C;&#x4E0E;&#x6211;&#x5EFA;&#x7ACB;&#x6709;&#x6548;&#x7684;&#x6C9F;&#x901A;&#xFF0C;&#x540C;&#x65F6;&#x66F4;&#x5FEB;&#x66F4;&#x51C6;&#x7684;&#x6536;&#x5230;&#x6211;&#x7684;&#x66F4;&#x65B0;&#x63A8;&#x9001;&#x3002;</p>\n<p><img src=\"/2020/06/04/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-Provider/Android&#x8865;&#x7ED9;&#x7AD9;.jpg\" alt></p>\n","categories":["android"],"tags":["flutter"]},{"title":"从零开始的Flutter之旅: InheritedWidget","url":"https://www.rousetime.com/2020/05/09/从零开始的Flutter之旅-InheritedWidget/","content":"<h2 id=\"&#x5F80;&#x671F;&#x56DE;&#x987E;\"><a href=\"#&#x5F80;&#x671F;&#x56DE;&#x987E;\" class=\"headerlink\" title=\"&#x5F80;&#x671F;&#x56DE;&#x987E;\"></a>&#x5F80;&#x671F;&#x56DE;&#x987E;</h2><p><a href=\"https://juejin.im/post/5e62f280e51d4534ec0066b8\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: StatelessWidget</a><br><a href=\"https://juejin.im/post/5e6f871bf265da572a0d160c\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: StatefulWidget</a></p>\n<p>&#x5728;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#x4E2D;&#xFF0C;&#x4ECB;&#x7ECD;&#x4E86;StatelessWidget&#x4E0E;StatefulWidget&#x7684;&#x7279;&#x6027;&#x4E0E;&#x5B83;&#x4EEC;&#x7684;&#x5448;&#x73B0;&#x539F;&#x7406;&#x3002;</p>\n<p>&#x8FD9;&#x671F;&#x8981;&#x804A;&#x7684;&#x662F;&#x5B83;&#x4EEC;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x5144;&#x5F1F;InheritedWidget&#x3002;</p>\n<h2 id=\"&#x7279;&#x6027;\"><a href=\"#&#x7279;&#x6027;\" class=\"headerlink\" title=\"&#x7279;&#x6027;\"></a>&#x7279;&#x6027;</h2><p>InheritedWidget&#x662F;Flutter&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x529F;&#x80FD;&#x7EC4;&#x4EF6;&#xFF0C;&#x5B83;&#x80FD;&#x591F;&#x63D0;&#x4F9B;&#x6570;&#x636E;&#x5728;widget&#x6811;&#x4E2D;&#x4ECE;&#x4E0A;&#x5230;&#x4E0B;&#x8FDB;&#x884C;&#x4F20;&#x9012;&#x3002;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x5728;&#x4E0D;&#x540C;&#x5B50;widget&#x4E2D;&#x8FDB;&#x884C;&#x5171;&#x4EAB;&#x3002;&#x8FD9;&#x5BF9;&#x4E8E;&#x4E00;&#x4E9B;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x7684;&#x573A;&#x666F;&#x975E;&#x5E38;&#x6709;&#x6548;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5728;Flutter SDK&#x4E2D;&#x5C31;&#x662F;&#x901A;&#x8FC7;InheritedWidget&#x6765;&#x5171;&#x4EAB;&#x5E94;&#x7528;&#x7684;&#x4E3B;&#x9898;&#x4E0E;&#x8BED;&#x8A00;&#x4FE1;&#x606F;&#x3002;</p>\n<p>&#x53EF;&#x80FD;&#x4F60;&#x8FD8;&#x6709;&#x70B9;&#x6A21;&#x7CCA;&#xFF0C;&#x522B;&#x6025;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x793A;&#x4F8B;&#x6765;&#x4E86;&#x89E3;InheritedWidget&#x3002;</p>\n<h2 id=\"&#x793A;&#x4F8B;\"><a href=\"#&#x793A;&#x4F8B;\" class=\"headerlink\" title=\"&#x793A;&#x4F8B;\"></a>&#x793A;&#x4F8B;</h2><p>&#x76F8;&#x4FE1;&#x5F00;&#x59CB;&#x5B66;Flutter&#x65F6;&#x90FD;&#x770B;&#x8FC7;&#x5B98;&#x65B9;&#x7684;&#x8BA1;&#x6570;&#x5668;&#x793A;&#x4F8B;&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684;&#x8BA1;&#x6570;&#x5668;&#x793A;&#x4F8B;&#x4F7F;&#x7528;InheritedWidget&#x8FDB;&#x884C;&#x6539;&#x9020;&#x3002;</p>\n<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x4E2A;CountInheritedWidget&#xFF0C;&#x5B83;&#x7EE7;&#x627F;&#x4E8E;InheritedWidget&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class CountInheritedWidget extends InheritedWidget {</span><br><span class=\"line\">  CountInheritedWidget({@required this.count, Widget child})</span><br><span class=\"line\">      : super(child: child);</span><br><span class=\"line\"> </span><br><span class=\"line\">  // &#x5171;&#x4EAB;&#x6570;&#x636E;&#xFF0C;&#x8BA1;&#x6570;&#x7684;&#x6570;&#x91CF;</span><br><span class=\"line\">  final int count;</span><br><span class=\"line\"> </span><br><span class=\"line\">  // &#x7EDF;&#x4E00;&#x7684;&#x83B7;&#x53D6;CountInheritedWidget&#x5B9E;&#x4F8B;, &#x65B9;&#x4FBF;&#x6811;&#x4E2D;&#x5B50;widget&#x7684;&#x83B7;&#x53D6;&#x5171;&#x4EAB;&#x6570;&#x636E;</span><br><span class=\"line\">  // &#x5FC5;&#x987B;&#x5728;State&#x4E2D;&#x8C03;&#x7528;&#x624D;&#x4F1A;&#x6709;&#x6548;</span><br><span class=\"line\">  static CountInheritedWidget of(BuildContext context) {</span><br><span class=\"line\">    // &#x8C03;&#x7528;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x7684;&#x5B50;widget&#x5C06;&#x4E0D;&#x4F1A;&#x56DE;&#x8C03;didChangeDependencies&#x65B9;&#x6CD5;&#xFF0C;&#x5373;&#x5B50;widget&#x5C06;&#x4E0D;&#x4F1A;&#x66F4;&#x65B0;</span><br><span class=\"line\">    // return context.getElementForInheritedWidgetOfExactType&lt;CountInheritedWidget&gt;().widget;</span><br><span class=\"line\">    return context.dependOnInheritedWidgetOfExactType&lt;CountInheritedWidget&gt;();</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  // true -&gt; &#x901A;&#x77E5;&#x6811;&#x4E2D;&#x4F9D;&#x8D56;&#x6539;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x7684;&#x5B50;widget</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  bool updateShouldNotify(CountInheritedWidget oldWidget) {</span><br><span class=\"line\">    return oldWidget.count != count;</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>1.&#x5728;CountInheritedWidget&#x4E2D;&#x63D0;&#x4F9B;&#x5171;&#x4EAB;&#x8BA1;&#x6570;&#x7684;&#x6570;&#x91CF;count<br>2.&#x540C;&#x65F6;&#x4E3A;&#x5916;&#x90E8;&#x63D0;&#x4F9B;&#x7EDF;&#x4E00;&#x7684;&#x83B7;&#x53D6;CountInheritedWidget&#x5B9E;&#x4F8B;&#x7684;of&#x65B9;&#x6CD5;<br>3.&#x6700;&#x540E;&#x518D;&#x91CD;&#x5199;updateShouldNotify&#x65B9;&#x6CD5;&#xFF0C;&#x6765;&#x901A;&#x77E5;&#x4F9D;&#x8D56;&#x8BE5;&#x5171;&#x4EAB;count&#x7684;&#x5B50;widget&#x8FDB;&#x884C;&#x66F4;&#x65B0;</p>\n<p>&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x5171;&#x4EAB;&#x6570;&#x636E;count&#x7684;&#x63D0;&#x4F9B;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x662F;&#x5728;&#x5177;&#x4F53;&#x7684;&#x5B50;widget&#x4E2D;&#x8FDB;&#x884C;&#x4F7F;&#x7528;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x62BD;&#x79BB;&#x51FA;&#x4E00;&#x4E2A;CountText&#x5B50;widget</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class CountText extends StatefulWidget {</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  _CountTextState createState() {</span><br><span class=\"line\">    return _CountTextState();</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">class _CountTextState extends State&lt;CountText&gt; {</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) {</span><br><span class=\"line\">    return Text(&quot;count: ${CountInheritedWidget.of(context).count.toString()}&quot;);</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  @override</span><br><span class=\"line\">  void didChangeDependencies() {</span><br><span class=\"line\">    super.didChangeDependencies();</span><br><span class=\"line\">    print(&quot;didChangeDependencies&quot;);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>1.&#x5185;&#x90E8;&#x5F15;&#x7528;&#x4E86;CountInheritedWidget&#x4E2D;&#x7684;&#x5171;&#x4EAB;&#x6570;&#x636E;count&#xFF0C;&#x901A;&#x8FC7;of&#x65B9;&#x6CD5;&#x83B7;&#x53D6;CountInheritedWidget&#x5B9E;&#x4F8B;<br>2.didChangeDependencies&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x76D1;&#x542C;&#x5B50;widget&#x4F9D;&#x8D56;&#x662F;&#x5426;&#x53CD;&#x751F;&#x6539;&#x53D8;</p>\n<p>&#x6700;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x5C06;CountInheritedWidget&#x4E0E;CountText&#x7ED3;&#x5408;&#x8D77;&#x6765;&#xFF0C;&#x901A;&#x8FC7;&#x7B80;&#x5355;&#x7684;&#x70B9;&#x51FB;&#x81EA;&#x589E;&#x4E8B;&#x4EF6;&#x6765;&#x770B;&#x4E0B;&#x6548;&#x679C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class CountWidget extends StatefulWidget {</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  _CountState createState() {</span><br><span class=\"line\">    return _CountState();</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">class _CountState extends State&lt;CountWidget&gt; {</span><br><span class=\"line\">  int count = 0;</span><br><span class=\"line\"> </span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) {</span><br><span class=\"line\">    return MaterialApp(</span><br><span class=\"line\">      title: &apos;Count App&apos;,</span><br><span class=\"line\">      theme: new ThemeData(primarySwatch: Colors.blue),</span><br><span class=\"line\">      home: Scaffold(</span><br><span class=\"line\">        appBar: AppBar(</span><br><span class=\"line\">          title: Text(&quot;Count&quot;),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        body: Center(</span><br><span class=\"line\">          child: CountInheritedWidget(</span><br><span class=\"line\">            count: count,</span><br><span class=\"line\">            child: Column(</span><br><span class=\"line\">              mainAxisAlignment: MainAxisAlignment.center,</span><br><span class=\"line\">              children: &lt;Widget&gt;[</span><br><span class=\"line\">                CountText(),</span><br><span class=\"line\">                RaisedButton(</span><br><span class=\"line\">                  onPressed: () =&gt; setState(() =&gt; count++),</span><br><span class=\"line\">                  child: Text(&quot;Increment&quot;),</span><br><span class=\"line\">                )</span><br><span class=\"line\">              ],</span><br><span class=\"line\">            ),</span><br><span class=\"line\">          ),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x7684;&#x5C42;&#x7EA7;&#x5173;&#x7CFB;&#x662F;CountText&#x521A;&#x597D;&#x662F;CountInheritedWidget&#x7684;&#x5B50;widget&#x3002;</p>\n<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x76F4;&#x63A5;&#x6539;&#x53D8;&#x5916;&#x90E8;&#x7684;count&#x503C;&#xFF0C;&#x5982;&#x679C;InheritedWidget&#x4ECE;&#x4E0A;&#x5230;&#x4E0B;&#x6570;&#x636E;&#x4F20;&#x5230;&#x7684;&#x6548;&#x679C;&#x80FD;&#x591F;&#x751F;&#x6548;&#xFF0C;&#x90A3;&#x4E48;&#x5728;CountText&#x4E2D;&#x5F15;&#x7528;&#x7684;count&#x5C06;&#x4F1A;&#x4E0E;&#x5916;&#x90E8;count&#x540C;&#x6B65;&#xFF0C;&#x7A0B;&#x5E8F;&#x5448;&#x73B0;&#x7684;&#x6548;&#x679C;&#x5C06;&#x4F1A;&#x662F;&#x81EA;&#x589E;&#x7684;&#xFF0C;&#x540C;&#x65F6;&#x7531;&#x4E8E;&#x4F9D;&#x8D56;&#x7684;count&#x53D1;&#x751F;&#x6539;&#x53D8;CountText&#x4E2D;&#x7684;didChangeDependencies&#x4E5F;&#x4F1A;&#x56DE;&#x8C03;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x4E00;&#x4E0B;</p>\n<p><img src=\"/2020/05/09/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-InheritedWidget/inherited_widget_1.png\" alt><br>&#x70B9;&#x51FB;&#x540E;&#x7684;&#x8F93;&#x51FA;&#x65E5;&#x5FD7;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">I/flutter: didChangeDependencies</span><br></pre></td></tr></table></figure>\n<p>&#x8BF4;&#x660E;InheritedWidget&#x7684;&#x6548;&#x679C;&#x5DF2;&#x7ECF;&#x751F;&#x6548;&#xFF0C;&#x901A;&#x8FC7;InheritedWidget&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x65B9;&#x4FBF;&#x7684;&#x5728;&#x5D4C;&#x5957;&#x4E0B;&#x5C42;&#x7684;&#x5B50;widget&#x4E2D;&#x62FF;&#x5230;&#x4E0A;&#x5C42;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x6574;&#x4E2A;widget&#x7684;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x3002;</p>\n<h2 id=\"&#x5206;&#x6790;\"><a href=\"#&#x5206;&#x6790;\" class=\"headerlink\" title=\"&#x5206;&#x6790;\"></a>&#x5206;&#x6790;</h2><p>&#x5728;&#x4F9D;&#x8D56;&#x65B9;&#x5F0F;&#x6539;&#x53D8;&#x65F6;&#x5B50;widget&#x7684;didChangeDependencies&#x4F1A;&#x56DE;&#x8C03;&#xFF0C;&#x4F46;&#x7531;&#x4E8E;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x5728;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x505A;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x4F8B;&#x5982;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x3002;&#x53EA;&#x662F;&#x9700;&#x8981;&#x4E00;&#x6B21;&#x5C31;&#x53EF;&#x4EE5;&#x3002;&#x5982;&#x679C;&#x662F;&#x5957;&#x7528;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x7684;&#x793A;&#x4F8B;&#xFF0C;&#x5C06;&#x4F1A;&#x5728;count&#x5B50;&#x589E;&#x65F6;&#x53CD;&#x590D;&#x8C03;&#x7528;&#x3002;</p>\n<p>&#x4E3A;&#x4E86;&#x9632;&#x6B62;didChangeDependencies&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;CountInheritedWidget&#x7684;of&#x65B9;&#x6CD5;&#x4E2D;&#x6CE8;&#x91CA;&#x7684;&#x90A3;&#x90E8;&#x5206;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static CountInheritedWidget of(BuildContext context) {</span><br><span class=\"line\">  // &#x8C03;&#x7528;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x7684;&#x5B50;widget&#x5C06;&#x4E0D;&#x4F1A;&#x56DE;&#x8C03;didChangeDependencies&#x65B9;&#x6CD5;&#xFF0C;&#x5373;&#x5B50;widget&#x5C06;&#x4E0D;&#x4F1A;&#x66F4;&#x65B0;</span><br><span class=\"line\">  // return context.getElementForInheritedWidgetOfExactType&lt;CountInheritedWidget&gt;().widget;</span><br><span class=\"line\">  return context.dependOnInheritedWidgetOfExactType&lt;CountInheritedWidget&gt;();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x662F;dependOnInheritedWidgetOfExactType&#x65B9;&#x6CD5;&#xFF0C;&#x4F9D;&#x8D56;&#x7684;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x65F6;&#x4F1A;&#x56DE;&#x8C03;&#x5B50;widget&#x4E2D;&#x7684;didChangeDependencies&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E0D;&#x60F3;&#x8981;&#x5B50;widget&#x8C03;&#x7528;&#x8BE5;&#x65B9;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6CE8;&#x91CA;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x901A;&#x8FC7;getElementForInheritedWidgetOfExactType&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x6B64;&#x65F6;&#x6211;&#x4EEC;&#x518D;&#x8FD0;&#x884C;&#x4E00;&#x4E0B;&#x9879;&#x76EE;&#xFF0C;&#x70B9;&#x51FB;count&#x81EA;&#x589E;&#xFF0C;&#x63A7;&#x5236;&#x53F0;&#x5C06;&#x4E0D;&#x4F1A;&#x518D;&#x8F93;&#x51FA;&#x65E5;&#x5FD7;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;didChangeDependencies&#x7684;&#x53CD;&#x590D;&#x8C03;&#x7528;&#x3002;</p>\n<p>&#x800C;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x4E3B;&#x8981;&#x533A;&#x522B;&#x662F;&#x5728;dependOnInheritedWidgetOfExactType&#x8C03;&#x7528;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F1A;&#x8FDB;&#x884C;&#x6CE8;&#x518C;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@override</span><br><span class=\"line\">InheritedWidget dependOnInheritedElement(InheritedElement ancestor, { Object aspect }) {</span><br><span class=\"line\">  assert(ancestor != null);</span><br><span class=\"line\">  _dependencies ??= HashSet&lt;InheritedElement&gt;();</span><br><span class=\"line\">  _dependencies.add(ancestor);</span><br><span class=\"line\">  ancestor.updateDependencies(this, aspect);</span><br><span class=\"line\">  return ancestor.widget;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;dependOnInheritedWidgetOfExactType&#x66F4;&#x65B0;&#x4F9D;&#x8D56;&#x7684;&#x5B50;widget&#x4E2D;&#x7684;didChangeDependencies&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x601D;&#x8003;&#x4E0B;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x867D;&#x7136;&#x73B0;&#x5728;didChangeDependencies&#x65B9;&#x6CD5;&#x4E0D;&#x4F1A;&#x8C03;&#x7528;&#xFF0C;&#x4F46;&#x662F;CountText&#x7684;build&#x65B9;&#x6CD5;&#x8FD8;&#x662F;&#x4F1A;&#x6267;&#x884C;&#x3002;&#x539F;&#x56E0;&#x662F;&#x5728;CountWidget&#x4E2D;&#x901A;&#x8FC7;setState&#x6765;&#x6539;&#x53D8;count&#x503C;&#xFF0C;&#x4F1A;&#x91CD;&#x65B0;build&#x6240;&#x7528;&#x7684;&#x5B50;widget&#x3002;&#x4F46;&#x6211;&#x4EEC;&#x771F;&#x6B63;&#x60F3;&#x8981;&#x7684;&#x53EA;&#x662F;&#x66F4;&#x65B0;&#x5B50;widget&#x4E2D;&#x4F9D;&#x8D56;&#x7684;CountInheritedWidget&#x7684;&#x7EC4;&#x4EF6;&#x503C;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x89E3;&#x51B3;&#x5462;&#xFF1F;&#x8FD9;&#x91CC;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#x4E3A;&#x5B50;widget&#x63D0;&#x4F9B;&#x7F13;&#x5B58;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5C01;&#x88C5;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;StatefulWidget&#xFF0C;&#x5C06;&#x5B50;widget&#x7F13;&#x5B58;&#x8D77;&#x6765;&#x3002;&#x5982;&#x679C;&#x5BF9;&#x8FD9;&#x5757;&#x611F;&#x5174;&#x8DA3;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x671F;&#x5F85;&#x6211;&#x7684;&#x540E;&#x7EED;&#x6587;&#x7AE0;&#x3002;</p>\n<h2 id=\"&#x63A8;&#x8350;&#x9879;&#x76EE;\"><a href=\"#&#x63A8;&#x8350;&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;&#x9879;&#x76EE;\"></a>&#x63A8;&#x8350;&#x9879;&#x76EE;</h2><p>&#x4E0B;&#x9762;&#x4ECB;&#x7ECD;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;Flutter&#x9879;&#x76EE;&#xFF0C;&#x5BF9;&#x4E8E;&#x65B0;&#x624B;&#x6765;&#x8BF4;&#x662F;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x5165;&#x95E8;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;Flutter&#x7684;Github&#x5BA2;&#x6237;&#x7AEF;&#x540C;&#x65F6;&#x652F;&#x6301;Android&#x4E0E;IOS&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;dart&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;Model/State/ViewModel&#x7684;MSVM&#xFF1B;&#x4F7F;&#x7528;Navigator&#x8FDB;&#x884C;&#x9875;&#x9762;&#x7684;&#x8DF3;&#x8F6C;&#xFF1B;&#x7F51;&#x7EDC;&#x6846;&#x67B6;&#x4F7F;&#x7528;&#x4E86;dio&#x3002;&#x9879;&#x76EE;&#x6B63;&#x5728;&#x6301;&#x7EED;&#x66F4;&#x65B0;&#x4E2D;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x4E00;&#x4E0B;&#x3002;</p>\n<p><img src=\"/2020/05/09/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-InheritedWidget/flutter_github_preview.png\" alt></p>\n<p>&#x5F53;&#x7136;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x4E86;&#x89E3;Android&#x539F;&#x751F;&#xFF0C;&#x76F8;&#x4FE1;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#x7684;&#x7EAF;Android&#x7248;&#x672C;<a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x559C;&#x6B22;&#x6211;&#x7684;&#x6587;&#x7AE0;&#x6A21;&#x5F0F;&#xFF0C;&#x6216;&#x8005;&#x5BF9;&#x6211;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x6587;&#x7AE0;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x5EFA;&#x8BAE;&#x60A8;&#x5173;&#x6CE8;&#x6211;&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF1A;&#x3010;Android&#x8865;&#x7ED9;&#x7AD9;&#x3011;</p>\n<p>&#x6216;&#x8005;&#x626B;&#x63CF;&#x4E0B;&#x65B9;&#x4E8C;&#x7EF4;&#x7801;&#xFF0C;&#x4E0E;&#x6211;&#x5EFA;&#x7ACB;&#x6709;&#x6548;&#x7684;&#x6C9F;&#x901A;&#xFF0C;&#x540C;&#x65F6;&#x66F4;&#x5FEB;&#x66F4;&#x51C6;&#x7684;&#x6536;&#x5230;&#x6211;&#x7684;&#x66F4;&#x65B0;&#x63A8;&#x9001;&#x3002;</p>\n<p><img src=\"/2020/05/09/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-InheritedWidget/Android&#x8865;&#x7ED9;&#x7AD9;.jpg\" alt></p>\n","categories":["android"],"tags":["flutter"]},{"title":"从零开始的Flutter之旅: StatefulWidget","url":"https://www.rousetime.com/2020/03/14/从零开始的Flutter之旅-StatefulWidget/","content":"<h2 id=\"&#x5F80;&#x671F;&#x56DE;&#x987E;\"><a href=\"#&#x5F80;&#x671F;&#x56DE;&#x987E;\" class=\"headerlink\" title=\"&#x5F80;&#x671F;&#x56DE;&#x987E;\"></a>&#x5F80;&#x671F;&#x56DE;&#x987E;</h2><p><a href=\"https://juejin.im/post/5e62f280e51d4534ec0066b8\" target=\"_blank\" rel=\"noopener\">&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: StatelessWidget</a></p>\n<p>&#x5728;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4ECB;&#x7ECD;&#x4E86;StatelessWidget&#x7684;&#x7279;&#x6027;&#x4E0E;&#x5B83;&#x5728;Flutter&#x4E2D;&#x7684;&#x5448;&#x73B0;&#x539F;&#x7406;&#x3002;</p>\n<p>&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x804A;&#x804A;&#x5B83;&#x7684;&#x5144;&#x5F1F;StatefulWidget&#xFF0C;&#x4FD7;&#x79F0;&#x6709;&#x72B6;&#x6001;&#x5C0F;&#x90E8;&#x4EF6;&#x3002;</p>\n<h2 id=\"&#x7279;&#x6027;\"><a href=\"#&#x7279;&#x6027;\" class=\"headerlink\" title=\"&#x7279;&#x6027;\"></a>&#x7279;&#x6027;</h2><p>&#x5982;&#x679C;&#x4F60;&#x770B;&#x4E86;&#x6211;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x5DF2;&#x7ECF;&#x975E;&#x5E38;&#x719F;&#x6089;&#x65E0;&#x72B6;&#x6001;&#x5C0F;&#x90E8;&#x4EF6;StatelessWidget&#x3002;&#x5B83;&#x4EEC;&#x662F;&#x7531;&#x4E00;&#x4E2A;&#x84DD;&#x56FE;&#x4E0E;&#x4E0D;&#x53EF;&#x53D8;&#x7684;element&#x914D;&#x7F6E;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x5B9E;&#x9645;&#x5B89;&#x88C5;&#x5230;&#x5C4F;&#x5E55;&#x4E0A;&#x7684;&#x662F;&#x5404;&#x4E2A;StatelessElement&#x3002;</p>\n<p>&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x4E1C;&#x897F;&#x6211;&#x662F;&#x975E;&#x5E38;&#x559C;&#x6B22;&#x7684;&#xFF0C;&#x5C31;&#x50CF;&#x5199;&#x4EE3;&#x7801;&#x4E00;&#x6837;&#xFF0C;&#x4E00;&#x65E6;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x6211;&#x5C31;&#x4E0D;&#x7528;&#x518D;&#x5173;&#x5FC3;&#x5B83;&#x4E4B;&#x540E;&#x7684;&#x6240;&#x6709;&#x4E8B;&#x60C5;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x6027;&#x8D28;&#xFF0C;&#x81F4;&#x4F7F;&#x5B83;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x4E0D;&#x53EF;&#x9884;&#x671F;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x53EA;&#x9700;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5B83;&#x5373;&#x53EF;&#x3002;</p>\n<p>&#x4F46;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#x53EA;&#x6709;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x914D;&#x7F6E;&#x662F;&#x4E0D;&#x884C;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x53EF;&#x80FD;&#x7F16;&#x5199;&#x4E00;&#x4E2A;&#x53EA;&#x7ED8;&#x5236;&#x4E00;&#x6B21;&#x540E;&#x5C31;&#x505C;&#x6B62;&#x7684;&#x5E94;&#x7528;&#x3002;&#x56E0;&#x4E3A;&#x4E00;&#x65E6;&#x6570;&#x636E;&#x6539;&#x53D8;&#xFF0C;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x914D;&#x7F6E;&#x662F;&#x4E0D;&#x53EF;&#x80FD;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5237;&#x65B0;ui&#xFF0C;&#x8FBE;&#x5230;&#x6211;&#x4EEC;&#x9884;&#x671F;&#x7684;&#x6548;&#x679C;&#xFF1B;&#x800C;&#x6709;&#x72B6;&#x6001;&#x5C0F;&#x90E8;&#x4EF6;StatefulWidget&#x5374;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x89E3;&#x51B3;&#x8FD9;&#x4E9B;&#x4E8B;&#x60C5;&#x3002;</p>\n<p>StatefulWidget&#x63D0;&#x4F9B;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x4EE5;&#x53CA;&#x53EF;&#x4EE5;&#x968F;&#x7740;&#x65F6;&#x95F4;&#x53D8;&#x5316;&#x800C;&#x89E6;&#x53D1;&#x7684;&#x72B6;&#x6001;&#x5BF9;&#x8C61;&#xFF1B;&#x901A;&#x8FC7;&#x76D1;&#x542C;&#x72B6;&#x6001;&#x7684;&#x53D8;&#x5316;&#x6765;&#x8FBE;&#x5230;ui&#x7684;&#x66F4;&#x65B0;&#x3002;</p>\n<p>&#x7B80;&#x5355;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x4ECE;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#x6311;&#x9009;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x3002;</p>\n<p><img src=\"/2020/03/14/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-StatefulWidget/stateful_widget_2.png\" width=\"350\" height=\"700/\"></p>\n<p>&#x5F53;&#x6211;&#x4EEC;&#x70B9;&#x51FB;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x672A;&#x8BFB;&#x901A;&#x77E5;&#x4FE1;&#x606F;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5C06;&#x5176;ui&#x72B6;&#x6001;&#x53D8;&#x6210;&#x5DF2;&#x8BFB;&#x7684;&#x6837;&#x5F0F;&#x3002;&#x6839;&#x636E;&#x72B6;&#x6001;&#x6765;&#x6539;&#x53D8;ui&#xFF0C;StatefulWidget&#x80FD;&#x591F;&#x5F88;&#x597D;&#x7684;&#x5B9E;&#x73B0;&#x8FD9;&#x79CD;&#x573A;&#x666F;&#x3002;&#x6765;&#x770B;&#x4E00;&#x4E0B;&#x5176;&#x5B9E;&#x73B0;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class NotificationTabPage extends BasePage&lt;_NotificationPageState&gt; {</span><br><span class=\"line\">  const NotificationTabPage();</span><br><span class=\"line\"> </span><br><span class=\"line\">  @override</span><br><span class=\"line\">  _NotificationPageState createBaseState() =&gt; _NotificationPageState();</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">class _NotificationPageState</span><br><span class=\"line\">    extends BaseState&lt;NotificationVM, NotificationTabPage&gt; {</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  NotificationVM createVM() =&gt; NotificationVM(context);</span><br><span class=\"line\"> </span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget createContentWidget() {</span><br><span class=\"line\">    return RefreshIndicator(</span><br><span class=\"line\">      onRefresh: vm.handlerRefresh,</span><br><span class=\"line\">      child: Scrollbar(</span><br><span class=\"line\">        child: ListView.builder(</span><br><span class=\"line\">          itemCount: vm.notifications?.length ?? 0,</span><br><span class=\"line\">          itemBuilder: (BuildContext context, int index) {</span><br><span class=\"line\">            final NotificationModel item = vm.notifications[index];</span><br><span class=\"line\">            return GestureDetector(</span><br><span class=\"line\">              onTap: () {</span><br><span class=\"line\">                vm.contentTap(index);</span><br><span class=\"line\">              },</span><br><span class=\"line\">              child: Container(</span><br><span class=\"line\">                color: item.unread ? Colors.white : Color.fromARGB(13, 0, 0, 0),</span><br><span class=\"line\">                padding: EdgeInsets.only(left: 15.0, top: 10.0, right: 15.0),</span><br><span class=\"line\">                child: Column(</span><br><span class=\"line\">                  crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class=\"line\">                  children: &lt;Widget&gt;[</span><br><span class=\"line\">                    Text(</span><br><span class=\"line\">                      item.repository.fullName,</span><br><span class=\"line\">                      style: TextStyle(</span><br><span class=\"line\">                        fontWeight: FontWeight.bold,</span><br><span class=\"line\">                        fontSize: 16.0,</span><br><span class=\"line\">                        color: item.unread</span><br><span class=\"line\">                            ? Colors.black87</span><br><span class=\"line\">                            : Color.fromARGB(255, 102, 102, 102),</span><br><span class=\"line\">                      ),</span><br><span class=\"line\">                    ),</span><br><span class=\"line\">                    Row(</span><br><span class=\"line\">                      children: &lt;Widget&gt;[</span><br><span class=\"line\">                        Padding(</span><br><span class=\"line\">                          padding: EdgeInsets.only(top: 5.0),</span><br><span class=\"line\">                          child: Image.asset(</span><br><span class=\"line\">                            vm.getTypeFlagSrc(item.subject.type),</span><br><span class=\"line\">                            width: 18.0,</span><br><span class=\"line\">                            height: 18.0,</span><br><span class=\"line\">                          ),</span><br><span class=\"line\">                        ),</span><br><span class=\"line\">                        Expanded(</span><br><span class=\"line\">                          child: Padding(</span><br><span class=\"line\">                            padding: EdgeInsets.only(top: 5.0, left: 10.0),</span><br><span class=\"line\">                            child: Text(</span><br><span class=\"line\">                              item.subject.title,</span><br><span class=\"line\">                              overflow: TextOverflow.ellipsis,</span><br><span class=\"line\">                              maxLines: 1,</span><br><span class=\"line\">                              style: TextStyle(</span><br><span class=\"line\">                                fontSize: 14.0,</span><br><span class=\"line\">                                color: item.unread</span><br><span class=\"line\">                                    ? Color.fromARGB(255, 17, 17, 17)</span><br><span class=\"line\">                                    : Color.fromARGB(255, 102, 102, 102),</span><br><span class=\"line\">                              ),</span><br><span class=\"line\">                            ),</span><br><span class=\"line\">                          ),</span><br><span class=\"line\">                        ),</span><br><span class=\"line\">                      ],</span><br><span class=\"line\">                    ),</span><br><span class=\"line\">                    Padding(</span><br><span class=\"line\">                      padding: EdgeInsets.only(top: 10.0),</span><br><span class=\"line\">                      child: Divider(</span><br><span class=\"line\">                        height: 1.0,</span><br><span class=\"line\">                        endIndent: 0.0,</span><br><span class=\"line\">                        color: Color.fromARGB(255, 207, 216, 220),</span><br><span class=\"line\">                      ),</span><br><span class=\"line\">                    ),</span><br><span class=\"line\">                  ],</span><br><span class=\"line\">                ),</span><br><span class=\"line\">              ),</span><br><span class=\"line\">            );</span><br><span class=\"line\">          },</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x7684;BasePage&#x662F;<code>MSVM</code>&#x67B6;&#x6784;&#x4E2D;&#x7684;&#x57FA;&#x7C7B;&#xFF0C;&#x5B83;&#x7EE7;&#x627F;&#x4E8E;StatefulWidget&#xFF1B;_NotificationPageState&#x4E5F;&#x662F;&#x4E00;&#x6837;&#xFF0C;&#x5B83;&#x7EE7;&#x627F;&#x4E8E;State</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">abstract class BasePage&lt;S extends BaseState&gt;</span><br><span class=\"line\">    extends StatefulWidget {</span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">abstract class BaseState&lt;VM extends BaseVM, T extends StatefulWidget&gt;</span><br><span class=\"line\">    extends State implements VMSContract {</span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x5173;&#x4E8E;MSVM&#x540E;&#x7EED;&#x4F1A;&#x4E13;&#x95E8;&#x5F00;&#x6587;&#x7AE0;&#x4ECB;&#x7ECD;&#xFF0C;&#x60F3;&#x4E86;&#x89E3;&#x7684;&#x53EF;&#x4EE5;&#x671F;&#x5F85;&#x4E00;&#x4E0B;</p>\n</blockquote>\n<p>&#x6211;&#x4EEC;&#x6765;&#x770B;createContentWidget&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x5E03;&#x5C40;&#xFF0C;&#x627E;&#x5230;&#x4E0A;&#x8FF0;&#x60C5;&#x51B5;&#x5173;&#x8054;&#x7684;ui&#xFF0C;&#x5728;ListView&#x7684;item&#x4E2D;&#x3002;</p>\n<p><img src=\"/2020/03/14/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-StatefulWidget/stateful_widget_1.jpg\" alt></p>\n<p>tem&#x5E03;&#x5C40;&#x7684;&#x72B6;&#x6001;&#x662F;&#x6839;&#x636E;item.unread&#x6765;&#x5224;&#x65AD;&#x7684;&#xFF0C;&#x672A;&#x8BFB;&#x72B6;&#x6001;&#x4E3A;ture&#x3002;</p>\n<p>&#x5F53;&#x7528;&#x6237;onTap&#x70B9;&#x51FB;&#x65F6;&#xFF0C;&#x5C06;&#x4F1A;&#x5411;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;thread&#x9605;&#x8BFB;&#x8BF7;&#x6C42;&#xFF0C;&#x5F53;&#x8BF7;&#x6C42;&#x6210;&#x529F;&#x4E4B;&#x540E;&#xFF0C;&#x518D;&#x5C06;&#x76F8;&#x5E94;&#x4F4D;&#x7F6E;&#x7684;item.unread&#x503C;&#x6539;&#x4E3A;false&#x3002;</p>\n<p>&#x4F46;&#x5C31;&#x8FD9;&#x6837;&#x6539;&#x53D8;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;ui&#x662F;&#x4E0D;&#x4F1A;&#x5237;&#x65B0;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;StatefulWidget&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x6539;&#x53D8;&#x67D0;&#x4E2A;&#x503C;&#xFF0C;&#x540C;&#x65F6;&#x8981;&#x540C;&#x6B65;&#x66F4;&#x65B0;ui&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;setState&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_markThreadRead(int index) async {</span><br><span class=\"line\">  try {</span><br><span class=\"line\">    Response response =</span><br><span class=\"line\">        await dio.patch(&apos;/notifications/threads/${_notifications[index].id}&apos;);</span><br><span class=\"line\">    if (response != null &amp;&amp;</span><br><span class=\"line\">        response.statusCode &gt;= 200 &amp;&amp;</span><br><span class=\"line\">        response.statusCode &lt; 300) {</span><br><span class=\"line\">      _notifications[index].unread = false;</span><br><span class=\"line\">      notifyStateChanged();</span><br><span class=\"line\">    }</span><br><span class=\"line\">  } on DioError catch (e) {</span><br><span class=\"line\">    Toast.show(&apos;makThreadRead error: ${e.message}&apos;, context);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x5C06;setState&#x65B9;&#x6CD5;&#x5C01;&#x88C5;&#x5230;notifyStateChanged&#x65B9;&#x6CD5;&#x4E2D;&#x3002;&#x6240;&#x4EE5;&#x73B0;&#x5728;&#x518D;&#x56DE;&#x8FC7;&#x53BB;&#x770B;ui&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;ui&#x5DF2;&#x7ECF;&#x5237;&#x65B0;&#x4E86;&#x3002;</p>\n<p>&#x4EE5;&#x4E0A;&#x662F;&#x4F7F;&#x7528;StatefulWidget&#x6765;&#x8FBE;&#x5230;ui&#x7684;&#x52A8;&#x6001;&#x6539;&#x53D8;&#x3002;&#x518D;&#x5BF9;&#x6BD4;&#x4E8E;&#x4E4B;&#x524D;&#x7684;StatelessWidget&#xFF0C;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x533A;&#x522B;&#x663E;&#x800C;&#x6613;&#x89C1;&#x4E86;&#x3002;</p>\n<h2 id=\"&#x5448;&#x73B0;&#x539F;&#x7406;\"><a href=\"#&#x5448;&#x73B0;&#x539F;&#x7406;\" class=\"headerlink\" title=\"&#x5448;&#x73B0;&#x539F;&#x7406;\"></a>&#x5448;&#x73B0;&#x539F;&#x7406;</h2><p>&#x4E0E;StatelessWidget&#x4E00;&#x6837;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x770B;&#x4E0B;StatefulWidget&#x7684;&#x5448;&#x73B0;&#x539F;&#x7406;&#x3002;</p>\n<p>StatefulWidget&#x4E5F;&#x662F;&#x7EE7;&#x627F;&#x4E8E;Widget&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x7684;&#x5185;&#x90E8;&#x4E5F;&#x662F;&#x5B58;&#x5728;createElement&#x65B9;&#x6CD5;&#x3002;&#x672C;&#x8D28;&#x4E5F;&#x662F;&#x901A;&#x8FC7;createElement&#x6765;&#x521B;&#x5EFA;&#x5BF9;&#x5E94;&#x7684;Element Tree&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x521B;&#x5EFA;&#x7684;&#x662F;StatefulElement&#xFF1B;&#x7136;&#x540E;&#x518D;&#x8C03;&#x7528;&#x5BF9;&#x5E94;&#x7684;Widget Tree&#x4E2D;&#x7684;build&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x76F8;&#x5E94;&#x7684;&#x84DD;&#x56FE;&#x3002;</p>\n<p>&#x4F46;&#x4E0E;StatelessWidget&#x6240;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x5B83;&#x8FD8;&#x6709;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@protected</span><br><span class=\"line\">State createState();</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;createState&#x6765;&#x521B;&#x5EFA;&#x5BF9;&#x5E94;&#x7684;State&#x3002;StatefulWidget&#x4FDD;&#x7559;&#x4E86;StatelessWidget&#x7684;&#x7279;&#x6027;&#xFF0C;&#x5373;&#x4FDD;&#x8BC1;final&#x6570;&#x636E;&#x7684;&#x4E0D;&#x53D8;&#x6027;&#xFF0C;&#x800C;&#x5BF9;&#x4E8E;&#x975E;final&#x53EF;&#x53D8;&#x6570;&#x636E;&#xFF0C;&#x5C06;&#x901A;&#x8FC7;Stete&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#x3002;</p>\n<p><img src=\"/2020/03/14/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-StatefulWidget/stateless_widget_2.png\" alt><br>&#x4E0A;&#x9762;&#x662F;&#x4E4B;&#x524D;StatelessWidget&#x5448;&#x73B0;&#x539F;&#x7406;&#x56FE;&#xFF0C;&#x4E0B;&#x9762;&#x6765;&#x5BF9;&#x7167;&#x770B;&#x4E0B;StatefulWidget&#x7684;&#x3002;</p>\n<p><img src=\"/2020/03/14/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-StatefulWidget/stateful_widget_3.png\" alt></p>\n<p>&#x9664;&#x4E86;Widget Tree&#x4E0E;Element Tree&#xFF0C;&#x8FD8;&#x6709;&#x5BF9;&#x5E94;&#x7684;State&#xFF0C;&#x5B83;&#x7BA1;&#x7406;&#x7740;&#x53EF;&#x53D8;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F8B;&#x5982;item.unread&#x3002;</p>\n<p>&#x4E00;&#x65E6;item.unread&#x6539;&#x53D8;&#x4E86;&#xFF0C;&#x4E14;&#x901A;&#x77E5;&#x5230;State&#xFF0C;State&#x5C06;&#x4F1A;&#x518D;&#x4E0B;&#x4E00;&#x5E27;&#x91CD;&#x65B0;&#x8981;&#x6C42;Widget Tree&#x8FDB;&#x884C;&#x5237;&#x65B0;&#x3002;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;Container</p>\n<p><img src=\"/2020/03/14/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-StatefulWidget/stateful_widget_4.png\" alt></p>\n<p>&#x7531;&#x4E8E;&#x662F;&#x540C;&#x4E00;&#x79CD;&#x7C7B;&#x578B;Container&#xFF0C;&#x5C06;&#x4F1A;&#x76F4;&#x63A5;&#x88AB;&#x66FF;&#x6362;&#xFF0C;&#x540C;&#x65F6;&#x4F7F;&#x7528;&#x66F4;&#x65B0;&#x540E;&#x7684;item.unread&#xFF0C;&#x6240;&#x4EE5;&#x5BF9;&#x5E94;&#x7684;Container&#x7684;color&#x4E5F;&#x5C06;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x3002;&#x6700;&#x7EC8;&#x5448;&#x73B0;&#x7684;&#x662F;&#x5E03;&#x5C40;&#x7684;&#x5237;&#x65B0;&#x3002;</p>\n<p>&#x503C;&#x5F97;&#x4E00;&#x63D0;&#x7684;&#x662F;&#xFF0C;State&#x4F9D;&#x9644;&#x4E8E;Element Tree&#x4E2D;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x975E;&#x5E38;&#x957F;&#xFF0C;&#x5373;&#x4F7F;Widget Tree&#x4E2D;&#x7684;NotificationTabPage&#x88AB;&#x79FB;&#x9664;&#x91CD;&#x5EFA;&#xFF0C;&#x53EA;&#x8981;&#x4FDD;&#x8BC1;&#x91CD;&#x5EFA;&#x7684;&#x7C7B;&#x578B;&#x662F;&#x4E00;&#x81F4;&#x7684;&#xFF0C;&#x540C;&#x65F6;Widget Tree &#x4E0E;Element Tree&#x7684;&#x5BF9;&#x5E94;&#x4F4D;&#x7F6E;&#x662F;&#x6CA1;&#x6709;&#x53D8;&#x5316;&#x7684;&#xFF0C;&#x90A3;&#x4E48;Widget&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x91CD;&#x5EFA;&#xFF0C;&#x53EA;&#x662F;&#x4F1A;&#x5C06;&#x5176;&#x6807;&#x8BB0;&#x4E3A;&#x810F;&#x72B6;&#x6001;&#xFF0C;&#x7136;&#x540E;&#x5B83;&#x7684;&#x5B50;widget&#x5C06;&#x4F1A;&#x901A;&#x8FC7;build&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x91CD;&#x5EFA;&#xFF0C;&#x66FF;&#x6362;State&#x4E2D;&#x7684;&#x53D8;&#x5316;&#x7684;&#x503C;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x8981;&#x76D1;&#x542C;Widget&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x53EF;&#x4EE5;&#x91CD;&#x5199;didUpdateWidget</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@override</span><br><span class=\"line\">void didUpdateWidget(StatefulWidget oldWidget) {</span><br><span class=\"line\">  // TODO: implement didUpdateWidget</span><br><span class=\"line\">  super.didUpdateWidget(oldWidget);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x7EFC;&#x4E0A;&#x6240;&#x8FF0;&#xFF0C;StatefulWidget&#x4F7F;&#x4F60;&#x53EF;&#x4EE5;&#x968F;&#x65F6;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x7684;&#x53D8;&#x5316;&#x5E76;&#x66F4;&#x65B0;&#x5E94;&#x7528;&#x7684;ui&#x3002;&#x4F46;&#x4F60;&#x6DF1;&#x5165;Flutter&#x4E4B;&#x540E;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x81EA;&#x5DF1;&#x5199;&#x7684;&#x66F4;&#x591A;&#x7684;&#x662F;StatelessWidget&#xFF0C;&#x56E0;&#x4E3A;&#x9700;&#x8981;&#x7528;&#x5230;&#x7684;StatefulWidget&#x57FA;&#x672C;&#x4E0A;&#x5DF2;&#x7ECF;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x66F4;&#x591A;&#x7684;&#x662F;&#x5BF9;StatelessWidget&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x6709;&#x610F;&#x601D;&#x5462;&#xFF0C;&#x671F;&#x5F85;&#x4F60;&#x7684;&#x52A0;&#x5165;&#x3002;</p>\n<p>&#x6587;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x662F;&#x6765;&#x81EA;&#x4E8E;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;Flutter&#x7684;Github&#x5BA2;&#x6237;&#x7AEF;&#x540C;&#x65F6;&#x652F;&#x6301;Android&#x4E0E;IOS&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;dart&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;Model/State/ViewModel&#x7684;MSVM&#xFF1B;&#x4F7F;&#x7528;Navigator&#x8FDB;&#x884C;&#x9875;&#x9762;&#x7684;&#x8DF3;&#x8F6C;&#xFF1B;&#x7F51;&#x7EDC;&#x6846;&#x67B6;&#x4F7F;&#x7528;&#x4E86;dio&#x3002;&#x9879;&#x76EE;&#x6B63;&#x5728;&#x6301;&#x7EED;&#x66F4;&#x65B0;&#x4E2D;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x4E00;&#x4E0B;&#x3002;</p>\n<p>&#x5F53;&#x7136;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x4E86;&#x89E3;Android&#x539F;&#x751F;&#xFF0C;&#x76F8;&#x4FE1;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#x7684;&#x7EAF;Android&#x7248;&#x672C;<a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;</p>\n<h2 id=\"&#x4E0B;&#x671F;&#x9884;&#x544A;\"><a href=\"#&#x4E0B;&#x671F;&#x9884;&#x544A;\" class=\"headerlink\" title=\"&#x4E0B;&#x671F;&#x9884;&#x544A;\"></a>&#x4E0B;&#x671F;&#x9884;&#x544A;</h2><p><strong>&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: InheritWidget</strong></p>\n<p>&#x5982;&#x679C;&#x4F60;&#x559C;&#x6B22;&#x6211;&#x7684;&#x6587;&#x7AE0;&#x6A21;&#x5F0F;&#xFF0C;&#x6216;&#x8005;&#x5BF9;&#x6211;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x6587;&#x7AE0;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x53EF;&#x4EE5;&#x70B9;&#x51FB;&#x4E00;&#x4E0B;&#x6211;&#x7684;&#x5934;&#x50CF;&#x8FDB;&#x884C;&#x5173;&#x6CE8;&#xFF0C;&#x5F53;&#x7136;&#x60A8;&#x4E5F;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x6211;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF1A;&#x3010;Android&#x8865;&#x7ED9;&#x7AD9;&#x3011;</p>\n<p>&#x6216;&#x8005;&#x626B;&#x63CF;&#x4E0B;&#x65B9;&#x4E8C;&#x7EF4;&#x7801;&#xFF0C;&#x4E0E;&#x6211;&#x5EFA;&#x7ACB;&#x6709;&#x6548;&#x7684;&#x6C9F;&#x901A;&#xFF0C;&#x540C;&#x65F6;&#x66F4;&#x5FEB;&#x66F4;&#x51C6;&#x7684;&#x6536;&#x5230;&#x6211;&#x7684;&#x66F4;&#x65B0;&#x63A8;&#x9001;&#x3002;</p>\n<p><img src=\"/2020/03/14/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-StatefulWidget/Android&#x8865;&#x7ED9;&#x7AD9;.jpg\" alt></p>\n","categories":["android"],"tags":["flutter"]},{"title":"从零开始的Flutter之旅：StatelessWidget","url":"https://www.rousetime.com/2020/03/06/从零开始的Flutter之旅-StatelessWidget/","content":"<p>&#x8FD9;&#x6B21;&#x8981;&#x5C55;&#x793A;&#x7684;&#x662F;&#x4EC0;&#x4E48;&#x662F;Flutter&#x7684;Widget&#xFF0C;&#x5373;&#x5C0F;&#x90E8;&#x4EF6;&#xFF1B;&#x4EE5;&#x53CA;&#x5982;&#x4F55;&#x5728;Flutter&#x4E2D;&#x4F7F;&#x7528;StatelessWidget&#xFF0C;&#x5373;&#x65E0;&#x72B6;&#x6001;&#x5C0F;&#x90E8;&#x4EF6;&#x3002;</p>\n<p>&#x81F3;&#x4E8E;Flutter&#xFF0C;&#x901A;&#x4FD7;&#x7684;&#x8BB2;&#x662F;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x901A;&#x4E00;&#x5957;&#x7B80;&#x5355;&#x7684;&#x4EE3;&#x7801;&#x6765;&#x540C;&#x65F6;&#x6784;&#x5EFA;Android&#x4E0E;IOS&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>\n<h2 id=\"&#x7279;&#x6027;\"><a href=\"#&#x7279;&#x6027;\" class=\"headerlink\" title=\"&#x7279;&#x6027;\"></a>&#x7279;&#x6027;</h2><p>&#x5C0F;&#x90E8;&#x4EF6;&#x662F;Flutter&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x57FA;&#x672C;&#x6784;&#x5EFA;&#x6A21;&#x5757;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x90FD;&#x662F;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x58F0;&#x660E;&#xFF0C;&#x4E5F;&#x662F;&#x7528;&#x6237;&#x754C;&#x9762;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;&#x4F8B;&#x5982;button&#xFF0C;text&#xFF0C;color&#x4EE5;&#x53CA;&#x5E03;&#x5C40;&#x6240;&#x7528;&#x5230;&#x7684;padding&#x7B49;&#x7B49;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x3002;</p>\n<p><img src=\"/2020/03/06/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-StatelessWidget/stateless_widget_1.png\" width=\"350\" height=\"700\"></p>\n<p>&#x5708;&#x9009;&#x4E2D;&#x7684;item&#x53EA;&#x6709;&#x4E24;&#x4E2A;&#x4FE1;&#x606F;&#xFF0C;&#x5934;&#x50CF;&#x4E0E;&#x540D;&#x79F0;&#x3002;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x4EE3;&#x7801;&#x7684;&#x91CD;&#x590D;&#x4F7F;&#x7528;&#xFF0C;&#x5C06;&#x5176;&#x62BD;&#x79BB;&#x6210;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;widget&#xFF0C;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5982;&#x4E0B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class FollowersItemView extends StatelessWidget {</span><br><span class=\"line\">  final GestureTapCallback tapCallback;</span><br><span class=\"line\">  final String avatarUrl;</span><br><span class=\"line\">  final String name;</span><br><span class=\"line\"> </span><br><span class=\"line\">  const FollowersItemView(</span><br><span class=\"line\">      {Key key, this.avatarUrl, this.name, this.tapCallback})</span><br><span class=\"line\">      : super(key: key);</span><br><span class=\"line\"> </span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) {</span><br><span class=\"line\">    return Container(</span><br><span class=\"line\">      padding: EdgeInsets.symmetric(horizontal: 15.0),</span><br><span class=\"line\">      child: GestureDetector(</span><br><span class=\"line\">        behavior: HitTestBehavior.opaque,</span><br><span class=\"line\">        onTap: tapCallback,</span><br><span class=\"line\">        child: Column(</span><br><span class=\"line\">          children: &lt;Widget&gt;[</span><br><span class=\"line\">            Row(</span><br><span class=\"line\">              children: &lt;Widget&gt;[</span><br><span class=\"line\">                FadeInImage.assetNetwork(</span><br><span class=\"line\">                  placeholder: &apos;images/app_welcome.png&apos;,</span><br><span class=\"line\">                  image: avatarUrl,</span><br><span class=\"line\">                  width: 80.0,</span><br><span class=\"line\">                  height: 80.0,</span><br><span class=\"line\">                ),</span><br><span class=\"line\">                Expanded(</span><br><span class=\"line\">                  child: Padding(</span><br><span class=\"line\">                    padding: EdgeInsets.only(left: 15.0),</span><br><span class=\"line\">                    child: Text(</span><br><span class=\"line\">                      name,</span><br><span class=\"line\">                      overflow: TextOverflow.ellipsis,</span><br><span class=\"line\">                      maxLines: 1,</span><br><span class=\"line\">                      style: TextStyle(</span><br><span class=\"line\">                        color: Colors.grey[600],</span><br><span class=\"line\">                        fontSize: 20.0,</span><br><span class=\"line\">                        fontWeight: FontWeight.bold,</span><br><span class=\"line\">                      ),</span><br><span class=\"line\">                    ),</span><br><span class=\"line\">                  ),</span><br><span class=\"line\">                )</span><br><span class=\"line\">              ],</span><br><span class=\"line\">            ),</span><br><span class=\"line\">            Padding(</span><br><span class=\"line\">              padding: EdgeInsets.symmetric(vertical: 15.0),</span><br><span class=\"line\">              child: Divider(</span><br><span class=\"line\">                thickness: 1.0,</span><br><span class=\"line\">                color: colorEAEAEA,</span><br><span class=\"line\">                height: 1.0,</span><br><span class=\"line\">                endIndent: 0.0,</span><br><span class=\"line\">              ),</span><br><span class=\"line\">            ),</span><br><span class=\"line\">          ],</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x7EE7;&#x627F;&#x4E8E;StatelessWidget&#xFF0C;StatelessWidget&#x7684;&#x7279;&#x6027;&#x662F;&#x65E0;&#x72B6;&#x6001;&#xFF0C;&#x6570;&#x636E;&#x4E0D;&#x53EF;&#x53D8;&#x5316;&#x3002;&#x8FD9;&#x4E2A;&#x6027;&#x8D28;&#x6B63;&#x597D;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x5C06;&#x8981;&#x62BD;&#x79BB;&#x7684;&#x90E8;&#x4EF6;&#x3002;&#x62BD;&#x79BB;&#x7684;&#x90E8;&#x4EF6;&#x9700;&#x8981;&#x505A;&#x5934;&#x50CF;&#x4E0E;&#x540D;&#x79F0;&#x7684;&#x5C55;&#x793A;&#xFF0C;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5F62;&#x5F0F;&#x4E0A;&#x7684;&#x4EA4;&#x4E92;&#x53D8;&#x5316;&#x3002;&#x552F;&#x4E00;&#x7684;&#x4E00;&#x4E2A;&#x4EA4;&#x4E92;&#x4E5F;&#x662F;&#x70B9;&#x51FB;&#xFF0C;&#x4F46;&#x5B83;&#x5E76;&#x6CA1;&#x6709;&#x6D89;&#x53CA;&#x6570;&#x636E;&#x7684;&#x6539;&#x53D8;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x5C06;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x5B9A;&#x4E49;&#x6210;final&#x7C7B;&#x578B;&#x3002;&#x672C;&#x8D28;&#x5C31;&#x5982;Text&#x90E8;&#x4EF6;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x5982;&#x8F93;&#x5165;&#x6587;&#x672C;&#x6216;&#x8005;&#x5E26;&#x6709;&#x52A8;&#x753B;&#x7684;&#x90E8;&#x4EF6;&#x4E00;&#x6837;&#x968F;&#x7740;&#x65F6;&#x95F4;&#x5185;&#x90E8;&#x5C5E;&#x6027;&#x4F1A;&#x6709;&#x6240;&#x53D8;&#x5316;&#x3002;</p>\n<p>&#x65E2;&#x7136;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x53D8;&#x5316;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x6784;&#x9020;&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x4E3A;const&#x7C7B;&#x578B;&#x3002;</p>\n<p>&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x90E8;&#x4EF6;&#x62BD;&#x79BB;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;ListView&#x4E2D;&#x4F7F;&#x7528;&#x8BE5;&#x65E0;&#x72B6;&#x6001;&#x90E8;&#x4EF6;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@override</span><br><span class=\"line\">Widget createContentWidget() {</span><br><span class=\"line\">  return RefreshIndicator(</span><br><span class=\"line\">    onRefresh: vm.handlerRefresh,</span><br><span class=\"line\">    child: Scrollbar(</span><br><span class=\"line\">      child: ListView.builder(</span><br><span class=\"line\">          padding: EdgeInsets.only(top: 15.0),</span><br><span class=\"line\">          itemCount: vm.list?.length ?? 0,</span><br><span class=\"line\">          itemBuilder: (BuildContext context, int index) {</span><br><span class=\"line\">            final item = vm.list[index];</span><br><span class=\"line\">            return FollowersItemView(</span><br><span class=\"line\">              avatarUrl: item.avatar_url,</span><br><span class=\"line\">              name: item.login,</span><br><span class=\"line\">              tapCallback: () {</span><br><span class=\"line\">                Navigator.push(context, MaterialPageRoute(builder: (_) {</span><br><span class=\"line\">                  return WebViewPage(title: item.login, url: item.html_url);</span><br><span class=\"line\">                }));</span><br><span class=\"line\">              },</span><br><span class=\"line\">            );</span><br><span class=\"line\">          }),</span><br><span class=\"line\">    ),</span><br><span class=\"line\">  );</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;ListView&#x4E2D;&#x5F15;&#x7528;FollowItemView&#xFF0C;&#x5E76;&#x4F20;&#x5165;&#x4E0D;&#x53D8;&#x7684;&#x6570;&#x636E;&#x5373;&#x53EF;&#x3002;</p>\n<h2 id=\"&#x5448;&#x73B0;&#x539F;&#x7406;\"><a href=\"#&#x5448;&#x73B0;&#x539F;&#x7406;\" class=\"headerlink\" title=\"&#x5448;&#x73B0;&#x539F;&#x7406;\"></a>&#x5448;&#x73B0;&#x539F;&#x7406;</h2><p>&#x73B0;&#x5728;StatelessWidget&#x7684;&#x4F7F;&#x7528;&#x5927;&#x5BB6;&#x90FD;&#x4F1A;&#x4E86;&#xFF0C;&#x90A3;&#x5B83;&#x662F;&#x5982;&#x4F55;&#x8C03;&#x7528;&#x7684;&#x5462;&#xFF1F;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x5B83;&#x7684;&#x5448;&#x73B0;&#x539F;&#x7406;&#x3002;</p>\n<p>&#x6B63;&#x5982;&#x5F00;&#x5934;&#x6240;&#x8BF4;&#x7684;&#x5C06;&#x5C0F;&#x90E8;&#x4EF6;&#x4F5C;&#x4E3A;Flutter&#x5E94;&#x7528;&#x6784;&#x5EFA;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x5728;Flutter&#x4E2D;&#x6211;&#x4EEC;&#x5C06;&#x5C0F;&#x90E8;&#x4EF6;&#x7684;&#x6784;&#x5EFA;&#x79F0;&#x4F5C;&#x4E3A;Widget Tree&#xFF0C;&#x5373;&#x5C0F;&#x90E8;&#x4EF6;&#x6811;&#x3002;&#x5B83;&#x5C31;&#x50CF;&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x84DD;&#x56FE;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x84DD;&#x56FE;&#x521B;&#x5EFA;&#x597D;&#xFF0C;&#x7136;&#x540E;&#x5185;&#x90E8;&#x4F1A;&#x901A;&#x8FC7;&#x84DD;&#x56FE;&#x53BB;&#x521B;&#x5EFA;&#x5BF9;&#x5E94;&#x663E;&#x793A;&#x5728;&#x5C4F;&#x5E55;&#x4E0A;&#x7684;element&#x5143;&#x7D20;&#x3002;&#x5B83;&#x5305;&#x542B;&#x4E86;&#x84DD;&#x56FE;&#x4E0A;&#x5BF9;&#x5E94;&#x7684;&#x5C0F;&#x90E8;&#x4EF6;&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x3002;&#x6240;&#x4EE5;&#x5BF9;&#x5E94;&#x7684;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;Element Tree&#xFF0C;&#x5373;&#x5143;&#x7D20;&#x6811;&#x3002;</p>\n<p>&#x6BCF;&#x4E00;&#x4E2A;StatelWidget&#x90FD;&#x6709;&#x4E00;&#x4E2A;StatelessElement&#xFF0C;&#x5185;&#x90E8;&#x4F1A;&#x901A;&#x8FC7;createElement()&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x521B;&#x5EFA;&#x5176;&#x5B9E;&#x4F8B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@override</span><br><span class=\"line\">StatelessElement createElement() =&gt; StatelessElement(this);</span><br></pre></td></tr></table></figure>\n<p>&#x540C;&#x65F6;&#x5728;StatelessElement&#x4E2D;&#x4F1A;&#x901A;&#x8FC7;buid()&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;StalessWidget&#x4E2D;&#x6240;&#x6784;&#x5EFA;&#x7684;&#x84DD;&#x56FE;Widget&#xFF0C;&#x5E76;&#x5C06;&#x5143;&#x7D20;&#x663E;&#x793A;&#x5230;&#x5C4F;&#x5E55;&#x4E0A;&#x3002;</p>\n<p>Widget Tree&#x4E0E;Element Tree&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x4E92;&#x5982;&#x4E0B;</p>\n<p><img src=\"/2020/03/06/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-StatelessWidget/stateless_widget_2.png\" alt></p>\n<p>FollowerItemView&#x4E2D;&#x7684;StatelessElement&#x4F1A;&#x8C03;&#x7528;build&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x5B83;&#x662F;&#x5426;&#x6709;&#x5B50;&#x90E8;&#x4EF6;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x7684;&#x8BDD;&#x5BF9;&#x5E94;&#x7684;&#x5B50;&#x90E8;&#x4EF6;&#x4E5F;&#x4F1A;&#x521B;&#x5EFA;&#x5B83;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;Element&#xFF0C;&#x5E76;&#x628A;&#x5B83;&#x5B89;&#x88C5;&#x5230;&#x5143;&#x7D20;&#x6811;&#x4E0A;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x7684;&#x7A0B;&#x5E8F;&#x6709;&#x4E24;&#x9897;&#x5BF9;&#x5E94;&#x7684;&#x6811;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x9897;&#x4EE3;&#x8868;&#x5C4F;&#x5E55;&#x4E0A;&#x663E;&#x793A;&#x7684;&#x5185;&#x5BB9;Element&#xFF1B;&#x53E6;&#x4E00;&#x9897;&#x6811;&#x4EE3;&#x8868;&#x5176;&#x5C55;&#x793A;&#x7684;&#x84DD;&#x56FE;Widget&#xFF0C;&#x5B83;&#x4EEC;&#x7531;&#x8BB8;&#x591A;&#x7684;&#x5C0F;&#x90E8;&#x4EF6;&#x7EC4;&#x6210;&#x3002;</p>\n<p>&#x800C;&#x6211;&#x4EEC;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6240;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5C06;&#x8FD9;&#x4E9B;&#x4E0D;&#x540C;&#x7684;&#x5C0F;&#x90E8;&#x4EF6;&#x6784;&#x5EFA;&#x6210;&#x6211;&#x4EEC;&#x6240;&#x9700;&#x8981;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>\n<p>&#x6700;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x4E86;&#x89E3;&#x4E0B;&#x6700;&#x521D;&#x7684;&#x5B89;&#x88C5;&#x5165;&#x53E3;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void main() {</span><br><span class=\"line\">  runApp(GithubApp());</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x6211;&#x4EEC;&#x7684;main&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;main&#x51FD;&#x6570;&#xFF0C;&#x5176;&#x4E2D;&#x8C03;&#x7528;&#x4E86;runApp&#x65B9;&#x6CD5;&#xFF0C;&#x4F20;&#x5165;&#x7684;&#x662F;GithubApp&#x3002;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x4E0B;GithubApp&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class GithubApp extends StatefulWidget {</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  _GithubAppState createState() {</span><br><span class=\"line\">    return _GithubAppState();</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">class _GithubAppState extends State&lt;GithubApp&gt; {</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) {</span><br><span class=\"line\">    return MaterialApp(</span><br><span class=\"line\">      title: &apos;Flutter Github&apos;,</span><br><span class=\"line\">      theme: ThemeData.light(),</span><br><span class=\"line\">      initialRoute: welcomeRoute.routeName,</span><br><span class=\"line\">      routes: {</span><br><span class=\"line\">        welcomeRoute.routeName: (BuildContext context) =&gt; WelcomePage(),</span><br><span class=\"line\">        loginRoute.routeName: (BuildContext context) =&gt; LoginPage(),</span><br><span class=\"line\">        homeRoute.routeName: (BuildContext context) =&gt; HomePage(),</span><br><span class=\"line\">        repositoryRoute.routeName: (BuildContext context) =&gt; RepositoryPage(),</span><br><span class=\"line\">        followersRoute.routeName: (BuildContext context) =&gt;</span><br><span class=\"line\">            FollowersPage(followersRoute.pageType),</span><br><span class=\"line\">        followingRoute.routeName: (BuildContext context) =&gt;</span><br><span class=\"line\">            FollowersPage(followingRoute.pageType),</span><br><span class=\"line\">        webViewRoute.routeName: (BuildContext context) =&gt; WebViewPage(title: &apos;&apos;,),</span><br><span class=\"line\">      },</span><br><span class=\"line\">    );</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x53D1;&#x73B0;&#x6CA1;&#x5B83;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;Widget&#xFF0C;&#x6B63;&#x5982;&#x6587;&#x7AE0;&#x5F00;&#x5934;&#x6240;&#x8BF4;&#x7684;&#xFF0C;Flutter&#x662F;&#x7531;&#x5404;&#x4E2A;Widget&#x7EC4;&#x6210;&#x3002;main&#x662F;&#x7A0B;&#x5E8F;&#x7684;&#x5165;&#x53E3;&#xFF0C;&#x800C;&#x5176;&#x4E2D;&#x7684;runApp&#x4E2D;&#x7684;Widget&#x662F;&#x6574;&#x4E2A;&#x7A0B;&#x5E8F;&#x6302;&#x8F7D;&#x7684;&#x8D77;&#x70B9;&#x3002;&#x5B83;&#x4F1A;&#x521B;&#x5EFA;&#x6210;&#x4E00;&#x4E2A;&#x5177;&#x6709;&#x4E0E;&#x5C4F;&#x5E55;&#x5BBD;&#x9AD8;&#x4E00;&#x81F4;&#x7684;&#x6839;&#x5143;&#x7D20;&#xFF0C;&#x5E76;&#x628A;&#x5B83;&#x88C5;&#x8F7D;&#x5230;&#x5C4F;&#x5E55;&#x4E2D;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x5728;Flutter&#x4E2D;&#x4E00;&#x76F4;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x521B;&#x5EFA;Element&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;build&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x5176;&#x540E;&#x7EED;&#x7684;&#x5B50;Widget&#xFF0C;&#x6700;&#x7EC8;&#x6784;&#x5EFA;&#x6210;&#x6211;&#x4EEC;&#x6240;&#x770B;&#x5230;&#x7684;&#x7A0B;&#x5E8F;&#x3002;</p>\n<p>&#x6587;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x662F;&#x6765;&#x81EA;&#x4E8E;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;Flutter&#x7684;Github&#x5BA2;&#x6237;&#x7AEF;&#x540C;&#x65F6;&#x652F;&#x6301;Android&#x4E0E;IOS&#xFF0C;&#x652F;&#x6301;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x4E0E;&#x8BA4;&#x8BC1;&#x767B;&#x9646;&#x3002;&#x4F7F;&#x7528;dart&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#xFF0C;&#x9879;&#x76EE;&#x67B6;&#x6784;&#x662F;&#x57FA;&#x4E8E;Model/State/ViewModel&#x7684;MSVM&#xFF1B;&#x4F7F;&#x7528;Navigator&#x8FDB;&#x884C;&#x9875;&#x9762;&#x7684;&#x8DF3;&#x8F6C;&#xFF1B;&#x7F51;&#x7EDC;&#x6846;&#x67B6;&#x4F7F;&#x7528;&#x4E86;dio&#x3002;&#x9879;&#x76EE;&#x6B63;&#x5728;&#x6301;&#x7EED;&#x66F4;&#x65B0;&#x4E2D;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x4E00;&#x4E0B;&#x3002;</p>\n<p>&#x5F53;&#x7136;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x4E86;&#x89E3;Android&#x539F;&#x751F;&#xFF0C;&#x76F8;&#x4FE1;<a href=\"https://github.com/idisfkj/flutter_github\" target=\"_blank\" rel=\"noopener\">flutter_github</a>&#x7684;&#x7EAF;Android&#x7248;&#x672C;<a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;</p>\n<h2 id=\"&#x4E0B;&#x671F;&#x9884;&#x544A;\"><a href=\"#&#x4E0B;&#x671F;&#x9884;&#x544A;\" class=\"headerlink\" title=\"&#x4E0B;&#x671F;&#x9884;&#x544A;\"></a>&#x4E0B;&#x671F;&#x9884;&#x544A;</h2><p><strong>&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;: StatefulWidget</strong></p>\n<p>&#x5982;&#x679C;&#x4F60;&#x559C;&#x6B22;&#x6211;&#x7684;&#x6587;&#x7AE0;&#x6A21;&#x5F0F;&#xFF0C;&#x6216;&#x8005;&#x5BF9;&#x6211;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x6587;&#x7AE0;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x5EFA;&#x8BAE;&#x60A8;&#x5173;&#x6CE8;&#x6211;&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF1A;&#x3010;Android&#x8865;&#x7ED9;&#x7AD9;&#x3011;</p>\n<p>&#x6216;&#x8005;&#x626B;&#x63CF;&#x4E0B;&#x65B9;&#x4E8C;&#x7EF4;&#x7801;&#xFF0C;&#x4E0E;&#x6211;&#x5EFA;&#x7ACB;&#x6709;&#x6548;&#x7684;&#x6C9F;&#x901A;&#xFF0C;&#x540C;&#x65F6;&#x66F4;&#x5FEB;&#x66F4;&#x51C6;&#x7684;&#x6536;&#x5230;&#x6211;&#x7684;&#x66F4;&#x65B0;&#x63A8;&#x9001;&#x3002;</p>\n<p><img src=\"/2020/03/06/&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;Flutter&#x4E4B;&#x65C5;-StatelessWidget/Android&#x8865;&#x7ED9;&#x7AD9;.jpg\" alt></p>\n","categories":["android"],"tags":["flutter"]},{"title":"AwesomeGithub组件化探索之旅","url":"https://www.rousetime.com/2020/01/03/AwesomeGithub组件化探索之旅/","content":"<p>&#x4E4B;&#x524D;&#x4E00;&#x76F4;&#x542C;&#x8BF4;&#x8FC7;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#xFF0C;&#x800C;&#x4E14;&#x9762;&#x8BD5;&#x4E5F;&#x6709;&#x8FD9;&#x65B9;&#x9762;&#x7684;&#x63D0;&#x95EE;&#xFF0C;&#x4F46;&#x90FD;&#x672A;&#x66FE;&#x6709;&#x6D89;&#x53CA;&#x5177;&#x4F53;&#x7684;&#x9879;&#x76EE;&#x3002;&#x6240;&#x4EE5;&#x5C31;&#x840C;&#x751F;&#x4E86;&#x57FA;&#x4E8E;Github&#x7684;&#x5F00;&#x653E;Api&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x7EC4;&#x4EF6;&#x5316;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x4ECE;&#x96F6;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;Github&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x8D77;&#x540D;&#x4E3A;<a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x3002;</p>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x5BF9;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#x8FDB;&#x884C;&#x4E00;&#x4E2A;&#x603B;&#x7ED3;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x522B;&#x4EBA;&#x66F4;&#x597D;&#x7684;&#x7406;&#x89E3;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#x3002;</p>\n<p>&#x5148;&#x6765;&#x770B;&#x4E0B;&#x9879;&#x76EE;&#x7684;&#x6574;&#x4F53;&#x6548;&#x679C;</p>\n<p><img src=\"/2020/01/03/AwesomeGithub&#x7EC4;&#x4EF6;&#x5316;&#x63A2;&#x7D22;&#x4E4B;&#x65C5;/awesome_github.png\" alt=\"AwesomeGithub\"></p>\n<p>&#x4E0B;&#x9762;&#x662F;&#x9879;&#x76EE;&#x7684;&#x7ED3;&#x6784;</p>\n<p><img src=\"/2020/01/03/AwesomeGithub&#x7EC4;&#x4EF6;&#x5316;&#x63A2;&#x7D22;&#x4E4B;&#x65C5;/awesome_github_project.jpg\" alt></p>\n<h2 id=\"&#x4E3A;&#x4F55;&#x8981;&#x4F7F;&#x7528;&#x7EC4;&#x4EF6;&#x5316;\"><a href=\"#&#x4E3A;&#x4F55;&#x8981;&#x4F7F;&#x7528;&#x7EC4;&#x4EF6;&#x5316;\" class=\"headerlink\" title=\"&#x4E3A;&#x4F55;&#x8981;&#x4F7F;&#x7528;&#x7EC4;&#x4EF6;&#x5316;\"></a>&#x4E3A;&#x4F55;&#x8981;&#x4F7F;&#x7528;&#x7EC4;&#x4EF6;&#x5316;</h2><ol>\n<li>&#x5BF9;&#x4E8E;&#x4F20;&#x7EDF;&#x7684;&#x5F00;&#x53D1;&#x6A21;&#x5F0F;&#xFF0C;&#x4E00;&#x4E2A;app&#x4E0B;&#x9762;&#x662F;&#x5305;&#x542B;&#x9879;&#x76EE;&#x7684;&#x5168;&#x90E8;&#x9875;&#x9762;&#x6A21;&#x5757;&#x4E0E;&#x903B;&#x8F91;&#x3002;&#x8FD9;&#x6837;&#x9879;&#x76EE;&#x4E00;&#x65E6;&#x8FED;&#x4EE3;&#x65F6;&#x95F4;&#x8FC7;&#x957F;&#xFF0C;&#x4E1A;&#x52A1;&#x6A21;&#x5757;&#x9010;&#x6E10;&#x589E;&#x52A0;&#xFF0C;&#x76F8;&#x5E94;&#x7684;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x590D;&#x6742;&#x5EA6;&#x4E5F;&#x6210;&#x6307;&#x6570;&#x589E;&#x52A0;&#x3002;&#x6A21;&#x5757;&#x95F4;&#x7684;&#x4E92;&#x76F8;&#x8C03;&#x7528;&#x9891;&#x7E41;&#xFF0C;&#x8FD9;&#x6837;&#x5FC5;&#x5B9A;&#x4F1A;&#x5BFC;&#x81F4;&#x6A21;&#x5757;&#x95F4;&#x7684;&#x8026;&#x5408;&#x589E;&#x52A0;&#xFF0C;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x5D4C;&#x5957;&#x7A0B;&#x5EA6;&#x52A0;&#x6DF1;&#x3002;&#x4E00;&#x65E6;&#x4FEE;&#x6539;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x6A21;&#x5757;&#xFF0C;&#x53EF;&#x80FD;&#x5C31;&#x7275;&#x4E00;&#x53D1;&#x52A8;&#x5168;&#x8EAB;&#x4E86;&#x3002;</li>\n<li>&#x4F20;&#x7EDF;&#x7684;&#x5F00;&#x53D1;&#x6A21;&#x5F0F;&#x4E0D;&#x5229;&#x4E8E;&#x56E2;&#x961F;&#x7684;&#x96C6;&#x4F53;&#x5F00;&#x53D1;&#x5408;&#x4F5C;&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x4E2A;&#x5F00;&#x53D1;&#x8005;&#x90FD;&#x662F;&#x5728;&#x540C;&#x4E00;&#x4E2A;app&#x6A21;&#x5757;&#x4E0B;&#x5F00;&#x53D1;&#x3002;&#x8FD9;&#x6837;&#x5BFC;&#x81F4;&#x7684;&#x95EE;&#x9898;&#x662F;&#xFF0C;&#x4E0D;&#x80FD;&#x9884;&#x671F;&#x6BCF;&#x4E2A;&#x5F00;&#x53D1;&#x8005;&#x6240;&#x4F1A;&#x4FEE;&#x6539;&#x5230;&#x7684;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x90E8;&#x5206;&#xFF0C;&#x5373;&#x6240;&#x80FD;&#x591F;&#x4FEE;&#x6539;&#x7684;&#x4EE3;&#x7801;&#x533A;&#x57DF;&#x3002;&#x56E0;&#x4E3A;&#x6A21;&#x5757;&#x8026;&#x5408;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x6D89;&#x53CA;&#x7684;&#x533A;&#x57DF;&#x4E0D;&#x53EF;&#x9884;&#x671F;&#xFF0C;&#x5BFC;&#x81F4;&#x4E0D;&#x540C;&#x5F00;&#x53D1;&#x8005;&#x4F1A;&#x4FEE;&#x6539;&#x540C;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x6216;&#x8005;&#x540C;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#x903B;&#x8F91;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#x51B2;&#x7A81;&#x3002;</li>\n<li>&#x4F20;&#x7EDF;&#x5F00;&#x53D1;&#x6A21;&#x5F0F;&#x4E0D;&#x5229;&#x4E8E;&#x6D4B;&#x8BD5;&#xFF0C;&#x6BCF;&#x6B21;&#x8FED;&#x4EE3;&#x90FD;&#x8981;&#x5C06;&#x9879;&#x76EE;&#x6574;&#x4F53;&#x6D4B;&#x8BD5;&#x4E00;&#x904D;&#x3002;&#x56E0;&#x4E3A;&#x5728;&#x540C;&#x4E00;&#x4E2A;app&#x4E0B;&#x9762;&#x4EE3;&#x7801;&#x662F;&#x7F3A;&#x4E4F;&#x7EA6;&#x675F;&#x7684;&#xFF0C;&#x4F60;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x53EA;&#x4FEE;&#x6539;&#x4E86;&#x8FED;&#x4EE3;&#x8FC7;&#x7A0B;&#x4E2D;&#x6240;&#x6D89;&#x53CA;&#x7684;&#x9700;&#x6C42;&#x903B;&#x8F91;&#x3002;</li>\n</ol>\n<p>&#x4EE5;&#x4E0A;&#x95EE;&#x9898;&#x968F;&#x7740;&#x9879;&#x76EE;&#x7684;&#x8FED;&#x4EE3;&#x5468;&#x671F;&#x7684;&#x589E;&#x5927;&#xFF0C;&#x4F1A;&#x8868;&#x73B0;&#x7684;&#x8D8A;&#x6765;&#x8D8A;&#x660E;&#x663E;&#x3002;&#x90A3;&#x4E48;&#x4F7F;&#x7528;&#x7EC4;&#x4EF6;&#x5316;&#x53C8;&#x80FD;&#x591F;&#x89E3;&#x51B3;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x4E86;&#xFF1F;</p>\n<h2 id=\"&#x7EC4;&#x4EF6;&#x5316;&#x80FD;&#x591F;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;\"><a href=\"#&#x7EC4;&#x4EF6;&#x5316;&#x80FD;&#x591F;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;\" class=\"headerlink\" title=\"&#x7EC4;&#x4EF6;&#x5316;&#x80FD;&#x591F;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;\"></a>&#x7EC4;&#x4EF6;&#x5316;&#x80FD;&#x591F;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;</h2><ol>\n<li>&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;&#x662F;&#x5C06;&#x5404;&#x4E2A;&#x76F8;&#x5173;&#x529F;&#x80FD;&#x8FDB;&#x884C;&#x5206;&#x79BB;&#xFF0C;&#x5206;&#x522B;&#x72EC;&#x7ACB;&#x6210;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x53EF;&#x8FD0;&#x884C;&#x7684;app&#xFF0C;&#x5E76;&#x4E14;&#x7EC4;&#x4EF6;&#x4E4B;&#x95F4;&#x4E0D;&#x80FD;&#x76F8;&#x4E92;&#x76F4;&#x63A5;&#x5F15;&#x7528;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x51CF;&#x5C11;&#x4E86;&#x4EE3;&#x7801;&#x8026;&#x5408;&#xFF0C;&#x8FBE;&#x5230;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x5206;&#x5C42;&#x6548;&#x679C;&#x3002;</li>\n<li>&#x7EC4;&#x4EF6;&#x5316;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x56E2;&#x961F;&#x534F;&#x4F5C;&#x80FD;&#x529B;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x4EBA;&#x5458;&#x53EF;&#x4EE5;&#x5F00;&#x53D1;&#x4E0D;&#x540C;&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x4FDD;&#x8BC1;&#x4E0D;&#x540C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x4E92;&#x4E0D;&#x5F71;&#x54CD;&#x3002;</li>\n<li>&#x7EC4;&#x4EF6;&#x5316;&#x5C06;app&#x5206;&#x6210;&#x591A;&#x4E2A;&#x53EF;&#x5355;&#x72EC;&#x8FD0;&#x884C;&#x7684;&#x5B50;&#x9879;&#x76EE;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x81EA;&#x5DF1;&#x72EC;&#x7ACB;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x53EF;&#x4EE5;&#x72EC;&#x7ACB;&#x7F16;&#x8BD1;&#xFF0C;&#x6253;&#x5305;&#x3001;&#x6D4B;&#x8BD5;&#x4E0E;&#x90E8;&#x7F72;&#x3002;&#x8FD9;&#x6837;&#x4E0D;&#x4EC5;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x5355;&#x4E2A;&#x6A21;&#x5757;&#x7684;&#x7F16;&#x8BD1;&#x901F;&#x5EA6;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x6D4B;&#x8BD5;&#x7684;&#x6548;&#x7387;&#x3002;</li>\n<li>&#x7EC4;&#x4EF6;&#x5316;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x9879;&#x76EE;&#x7684;&#x7075;&#x6D3B;&#x6027;&#xFF0C;app&#x53EF;&#x4EE5;&#x6309;&#x9700;&#x52A0;&#x8F7D;&#x6240;&#x8981;&#x6709;&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x63D0;&#x9AD8;app&#x7684;&#x7075;&#x6D3B;&#x6027;&#xFF0C;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x751F;&#x6210;&#x53EF;&#x5B9A;&#x5236;&#x5316;&#x7684;&#x4EA7;&#x54C1;&#x3002;</li>\n</ol>\n<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x4E86;&#x89E3;&#x4E86;&#x7EC4;&#x4EF6;&#x5316;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x4F46;&#x8981;&#x5B9E;&#x73B0;&#x7EC4;&#x4EF6;&#x5316;&#xFF0C;&#x8FBE;&#x5230;&#x5176;&#x4F5C;&#x7528;&#xFF0C;&#x5FC5;&#x987B;&#x89E3;&#x51B3;&#x5B9E;&#x73B0;&#x7EC4;&#x4EF6;&#x5316;&#x8FC7;&#x7A0B;&#x4E2D;&#x6240;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;&#x3002;</p>\n<h2 id=\"&#x7EC4;&#x4EF6;&#x5316;&#x9700;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;\"><a href=\"#&#x7EC4;&#x4EF6;&#x5316;&#x9700;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;\" class=\"headerlink\" title=\"&#x7EC4;&#x4EF6;&#x5316;&#x9700;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;\"></a>&#x7EC4;&#x4EF6;&#x5316;&#x9700;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;</h2><ol>\n<li>&#x7EC4;&#x4EF6;&#x5355;&#x72EC;&#x8FD0;&#x884C;</li>\n<li>&#x7EC4;&#x4EF6;&#x95F4;&#x6570;&#x636E;&#x4F20;&#x9012;</li>\n<li>&#x7EC4;&#x4EF6;&#x95F4;&#x754C;&#x9762;&#x7684;&#x8DF3;&#x8F6C;</li>\n<li>&#x4E3B;&#x9879;&#x76EE;&#x4F7F;&#x7528;&#x7EC4;&#x4EF6;&#x4E2D;&#x7684;Fragment</li>\n<li>&#x7EC4;&#x4EF6;&#x89E3;&#x8026;</li>\n</ol>\n<p>&#x4EE5;&#x4E0A;&#x662F;&#x5B9E;&#x73B0;&#x7EC4;&#x4EF6;&#x5316;&#x65F6;&#x6240;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4F1A;&#x7ED3;&#x5408;<a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x6765;&#x5177;&#x4F53;&#x8BF4;&#x660E;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;</p>\n<h3 id=\"&#x7EC4;&#x4EF6;&#x5355;&#x72EC;&#x8FD0;&#x884C;\"><a href=\"#&#x7EC4;&#x4EF6;&#x5355;&#x72EC;&#x8FD0;&#x884C;\" class=\"headerlink\" title=\"&#x7EC4;&#x4EF6;&#x5355;&#x72EC;&#x8FD0;&#x884C;\"></a>&#x7EC4;&#x4EF6;&#x5355;&#x72EC;&#x8FD0;&#x884C;</h3><p>&#x7EC4;&#x4EF6;&#x7684;&#x521B;&#x5EFA;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;library&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x521B;&#x5EFA;&#x3002;&#x53EA;&#x4E0D;&#x8FC7;&#x5728;&#x521B;&#x5EFA;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x8981;&#x8BA9;&#x7EC4;&#x4EF6;&#x8FBE;&#x5230;&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x8FD0;&#x884C;&#x8C03;&#x8BD5;&#x7684;&#x5730;&#x6B65;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x76F8;&#x5173;&#x914D;&#x7F6E;&#x3002;</p>\n<h4 id=\"&#x8FD0;&#x884C;&#x65B9;&#x5F0F;&#x52A8;&#x6001;&#x914D;&#x7F6E;\"><a href=\"#&#x8FD0;&#x884C;&#x65B9;&#x5F0F;&#x52A8;&#x6001;&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"&#x8FD0;&#x884C;&#x65B9;&#x5F0F;&#x52A8;&#x6001;&#x914D;&#x7F6E;\"></a>&#x8FD0;&#x884C;&#x65B9;&#x5F0F;&#x52A8;&#x6001;&#x914D;&#x7F6E;</h4><p>&#x9996;&#x5148;&#xFF0C;&#x5F53;&#x521B;&#x5EFA;&#x5B8C;library&#x65F6;&#xFF0C;&#x5728;build.gradle&#x4E2D;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x8FD9;&#x4E48;&#x4E00;&#x884C;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply plugin: &apos;com.android.library&apos;</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x662F;gradle&#x63D2;&#x4EF6;&#x6240;&#x652F;&#x6301;&#x7684;&#x4E00;&#x79CD;&#x6784;&#x5EFA;&#x7C7B;&#x578B;&#xFF0C;&#x4EE3;&#x8868;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x4F9D;&#x8D56;&#x5230;&#x4E3B;&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x6784;&#x5EFA;&#x540E;&#x8F93;&#x51FA;aar&#x5305;&#x3002;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x5BF9;&#x4E8E;&#x6211;&#x4EEC;&#x5C06;&#x7EC4;&#x4EF6;&#x4F9D;&#x8D56;&#x5230;&#x4E3B;&#x9879;&#x76EE;&#x4E2D;&#x5B8C;&#x5168;&#x543B;&#x5408;&#x7684;&#x3002;</p>\n<p>&#x800C;gradle&#x63D2;&#x4EF6;&#x7684;&#x53E6;&#x4E00;&#x79CD;&#x6784;&#x5EFA;&#x65B9;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x4E3B;&#x9879;&#x76EE;&#x7684;build.gradle&#x4E2D;&#x770B;&#x5230;&#x8FD9;&#x4E48;&#x4E00;&#x884C;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply plugin: &apos;com.android.application&apos;</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4EE3;&#x8868;&#x5728;&#x9879;&#x76EE;&#x6784;&#x5EFA;&#x540E;&#x4F1A;&#x8F93;&#x51FA;apk&#x5B89;&#x88C5;&#x5305;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x53EF;&#x8FD0;&#x884C;&#x7684;&#x9879;&#x76EE;&#x3002;</p>\n<p>&#x660E;&#x767D;&#x4E86;gradle&#x7684;&#x8FD9;&#x4E24;&#x79CD;&#x6784;&#x5EFA;&#x65B9;&#x5F0F;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x9700;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x4E5F;&#x975E;&#x5E38;&#x660E;&#x4E86;&#xFF1A;&#x9700;&#x8981;&#x5C06;&#x8FD9;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x52A8;&#x6001;&#x914D;&#x7F6E;&#xFF0C;&#x4FDD;&#x8BC1;&#x7EC4;&#x4EF6;&#x5728;&#x4E3B;&#x9879;&#x76EE;&#x4E2D;&#x4EE5;library&#x65B9;&#x5F0F;&#x5B58;&#x5728;&#xFF0C;&#x800C;&#x81EA;&#x5DF1;&#x5355;&#x72EC;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5219;&#x4EE5;application&#x7684;&#x65B9;&#x5F0F;&#x5B58;&#x5728;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EE5;<a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x4E2D;&#x7684;login&#x7EC4;&#x4EF6;&#x4E3A;&#x4F8B;&#x3002;</p>\n<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5728;&#x6839;&#x9879;&#x76EE;&#x7684;gradle.properties&#x4E2D;&#x6DFB;&#x52A0;addLogin&#x53D8;&#x91CF;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">addLogin = true</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x5728;login&#x4E2D;&#x7684;build.gradle&#x901A;&#x8FC7;addLogin&#x53D8;&#x91CF;&#x6765;&#x63A7;&#x5236;&#x6784;&#x5EFA;&#x65B9;&#x5F0F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (addLogin.toBoolean()) {</span><br><span class=\"line\">    apply plugin: &apos;com.android.library&apos;</span><br><span class=\"line\">} else {</span><br><span class=\"line\">    apply plugin: &apos;com.android.application&apos;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x5C31;&#x5B9E;&#x73B0;&#x4E86;&#x5BF9;login&#x7684;&#x6784;&#x5EFA;&#x63A7;&#x5236;&#xFF0C;&#x53EF;&#x5355;&#x72EC;&#x8FD0;&#x884C;&#xFF0C;&#x4E5F;&#x53EF;&#x4F9D;&#x8D56;&#x4E8E;app&#x9879;&#x76EE;&#x3002;</p>\n<h4 id=\"ApplicationId&#x4E0E;AndroidManifest\"><a href=\"#ApplicationId&#x4E0E;AndroidManifest\" class=\"headerlink\" title=\"ApplicationId&#x4E0E;AndroidManifest\"></a>ApplicationId&#x4E0E;AndroidManifest</h4><p>&#x9664;&#x4E86;&#x4FEE;&#x6539;gradle&#x7684;&#x6784;&#x5EFA;&#x65B9;&#x5F0F;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x52A8;&#x6001;&#x914D;&#x7F6E;ApplicationId&#x4E0E;AndroidManifest&#x6587;&#x4EF6;&#x3002;</p>\n<p>&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#x3002;</p>\n<p>&#x53EF;&#x4EE5;&#x5728;defaultConfig&#x4E2D;&#x589E;&#x52A0;&#x5BF9;applicationId&#x7684;&#x52A8;&#x6001;&#x914D;&#x7F6E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defaultConfig {</span><br><span class=\"line\">    if (!addLogin.toBoolean()) {</span><br><span class=\"line\">        applicationId &quot;com.idisfkj.awesome.login&quot;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    minSdkVersion Versions.min_sdk</span><br><span class=\"line\">    targetSdkVersion Versions.target_sdk</span><br><span class=\"line\">    versionCode Versions.version_code</span><br><span class=\"line\">    versionName Versions.version_name</span><br><span class=\"line\"> </span><br><span class=\"line\">    testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x800C;AndroidManifest&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;sourceSets&#x6765;&#x914D;&#x7F6E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sourceSets {</span><br><span class=\"line\">    main {</span><br><span class=\"line\">        if (addLogin.toBoolean()) {</span><br><span class=\"line\">            manifest.srcFile &apos;src/main/AndroidManifest.xml&apos;</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            manifest.srcFile &apos;src/main/manifest/AndroidManifest.xml&apos;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2020/01/03/AwesomeGithub&#x7EC4;&#x4EF6;&#x5316;&#x63A2;&#x7D22;&#x4E4B;&#x65C5;/awesome_github_login.jpg\" alt></p>\n<p>&#x540C;&#x65F6;addLogin&#x4E5F;&#x53EF;&#x4EE5;&#x4F5C;&#x7528;&#x4E8E;app&#xFF0C;&#x8BA9;login&#x7EC4;&#x4EF6;&#x53EF;&#x914D;&#x7F6E;&#x4F9D;&#x8D56;</p>\n<p><img src=\"/2020/01/03/AwesomeGithub&#x7EC4;&#x4EF6;&#x5316;&#x63A2;&#x7D22;&#x4E4B;&#x65C5;/awesome_github_login_main.jpg\" alt></p>\n<p>&#x8FD9;&#x6837;login&#x7EC4;&#x4EF6;&#x5C31;&#x53EF;&#x4EE5;&#x72EC;&#x7ACB;&#x4E8E;app&#x8FDB;&#x884C;&#x5355;&#x72EC;&#x6784;&#x5EFA;&#x3001;&#x6253;&#x5305;&#x3001;&#x8C03;&#x8BD5;&#x4E0E;&#x8FD0;&#x884C;&#x3002;</p>\n<h3 id=\"&#x7EC4;&#x4EF6;&#x95F4;&#x7684;&#x6570;&#x636E;&#x4F20;&#x9012;\"><a href=\"#&#x7EC4;&#x4EF6;&#x95F4;&#x7684;&#x6570;&#x636E;&#x4F20;&#x9012;\" class=\"headerlink\" title=\"&#x7EC4;&#x4EF6;&#x95F4;&#x7684;&#x6570;&#x636E;&#x4F20;&#x9012;\"></a>&#x7EC4;&#x4EF6;&#x95F4;&#x7684;&#x6570;&#x636E;&#x4F20;&#x9012;</h3><p>&#x7531;&#x4E8E;&#x7EC4;&#x4EF6;&#x4E0E;&#x7EC4;&#x4EF6;&#x3001;&#x9879;&#x76EE;&#x95F4;&#x662F;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7C7B;&#x7684;&#x76F8;&#x4E92;&#x5F15;&#x7528;&#x6765;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x7684;&#x4F20;&#x9012;&#xFF0C;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x91CC;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x516C;&#x5171;&#x5E93;&#x6765;&#x505A;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x8C03;&#x7528;&#x7684;&#x6865;&#x6881;&#xFF0C;&#x5B83;&#x4EEC;&#x4E0D;&#x76F4;&#x63A5;&#x62FF;&#x5230;&#x5177;&#x4F53;&#x7684;&#x5F15;&#x7528;&#x5BF9;&#x8C61;&#xFF0C;&#x800C;&#x662F;&#x901A;&#x8FC7;&#x63A5;&#x53E3;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x83B7;&#x53D6;&#x6240;&#x9700;&#x8981;&#x7684;&#x6570;&#x636E;&#x3002;</p>\n<p>&#x5728;<a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x4E2D;&#x6211;&#x5C06;&#x5176;&#x547D;&#x540D;&#x4E3A;componentbridge&#xFF0C;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x90FD;&#x4F9D;&#x8D56;&#x4E8E;&#x8BE5;&#x516C;&#x5171;&#x6865;&#x6881;&#xFF0C;&#x901A;&#x8FC7;&#x8BE5;&#x516C;&#x5171;&#x6865;&#x6881;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x95F4;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x7684;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x4F20;&#x9012;&#x3002;</p>\n<p><img src=\"/2020/01/03/AwesomeGithub&#x7EC4;&#x4EF6;&#x5316;&#x63A2;&#x7D22;&#x4E4B;&#x65C5;/awesome_github_component_bridge.jpg\" alt></p>\n<p>&#x4E0A;&#x56FE;&#x5708;&#x8D77;&#x6765;&#x7684;&#x90E8;&#x5206;&#x90FD;&#x662F;componentbridge&#x7684;&#x91CD;&#x70B9;&#xFF0C;&#x4E5F;&#x662F;&#x516C;&#x5171;&#x6865;&#x6881;&#x5B9E;&#x73B0;&#x7684;&#x57FA;&#x7840;&#x3002;&#x4E0B;&#x9762;&#x6765;&#x5206;&#x522B;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#x3002;</p>\n<h4 id=\"BridgeInterface\"><a href=\"#BridgeInterface\" class=\"headerlink\" title=\"BridgeInterface\"></a>BridgeInterface</h4><p>&#x8FD9;&#x662F;&#x516C;&#x5171;&#x6865;&#x6881;&#x7684;&#x5E95;&#x5C42;&#x63A5;&#x53E3;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x7EC4;&#x4EF6;&#x8981;&#x5411;&#x5916;&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;&#x6865;&#x6881;&#x90FD;&#x8981;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface BridgeInterface {</span><br><span class=\"line\"></span><br><span class=\"line\">    fun onClear() {}</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5185;&#x90E8;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x65B9;&#x5F0F;onClear(), &#x7528;&#x6765;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x7684;&#x91CA;&#x653E;&#x3002;</p>\n<h4 id=\"BridgeStore\"><a href=\"#BridgeStore\" class=\"headerlink\" title=\"BridgeStore\"></a>BridgeStore</h4><p>&#x7528;&#x6765;&#x505A;&#x6570;&#x636E;&#x5B58;&#x50A8;&#xFF0C;&#x5BF9;&#x6865;&#x6881;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x7684;key&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#x3002;&#x907F;&#x514D;&#x6865;&#x6881;&#x5185;&#x90E8;&#x7684;&#x5B9E;&#x4F8B;&#x591A;&#x6B21;&#x521B;&#x5EFA;&#x3002;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class BridgeStore {</span><br><span class=\"line\"> </span><br><span class=\"line\">    private val mMap = HashMap&lt;String, BridgeInterface&gt;()</span><br><span class=\"line\"> </span><br><span class=\"line\">    fun put(key: String, bridge: BridgeInterface) {</span><br><span class=\"line\">        mMap.put(key, bridge)?.onClear()</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    fun get(key: String): BridgeInterface? = mMap[key]</span><br><span class=\"line\"> </span><br><span class=\"line\">    fun clear() {</span><br><span class=\"line\">        for (item in mMap.values) {</span><br><span class=\"line\">            item.onClear()</span><br><span class=\"line\">        }</span><br><span class=\"line\">        mMap.clear()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h4 id=\"Factory\"><a href=\"#Factory\" class=\"headerlink\" title=\"Factory\"></a>Factory</h4><p>&#x6865;&#x6881;&#x7684;&#x5B9E;&#x4F8B;&#x6784;&#x5EFA;&#x5DE5;&#x5382;&#xFF0C;&#x9ED8;&#x8BA4;&#x63D0;&#x4F9B;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x5B9E;&#x4F8B;&#x5316;&#x4E0D;&#x540C;&#x7684;&#x7C7B;&#x3002;Factory&#x63A5;&#x53E3;&#x53EA;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;create&#x65B9;&#x6CD5;&#xFF0C;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x7531;&#x5B50;&#x7C7B;&#x81EA;&#x884C;&#x89E3;&#x51B3;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface Factory {</span><br><span class=\"line\"> </span><br><span class=\"line\">    fun &lt;T : BridgeInterface&gt; create(bridgeClazz: Class&lt;T&gt;): T</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;<a href=\"https://github.com/idisfkj/AwesomeGithub\" target=\"_blank\" rel=\"noopener\">AwesomeGithub</a>&#x4E2D;&#x63D0;&#x4F9B;&#x4E86;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x65B9;&#x5F0F;&#x6765;&#x5B9E;&#x4F8B;&#x5316;&#x4E0D;&#x540C;&#x7C7B;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;NewInstanceFactory</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class NewInstanceFactory : Factory {</span><br><span class=\"line\"> </span><br><span class=\"line\">    companion object {</span><br><span class=\"line\">        val instance: NewInstanceFactory by lazy { NewInstanceFactory() }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun &lt;T : BridgeInterface&gt; create(bridgeClazz: Class&lt;T&gt;): T = try {</span><br><span class=\"line\">        bridgeClazz.newInstance()</span><br><span class=\"line\">    } catch (e: InstantiationException) {</span><br><span class=\"line\">        throw RuntimeException(&quot;Cannot create an instance of $bridgeClazz&quot;, e)</span><br><span class=\"line\">    } catch (e: IllegalAccessException) {</span><br><span class=\"line\">        throw RuntimeException(&quot;Cannot create an instance of $bridgeClazz&quot;, e)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>Factory&#x7684;&#x4F5C;&#x7528;&#x662F;&#x901A;&#x8FC7;&#x62BD;&#x8C61;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x83B7;&#x53D6;&#x6240;&#x9700;&#x8981;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x81F3;&#x4E8E;&#x8BE5;&#x7C7B;&#x5982;&#x4F55;&#x5B9E;&#x4F8B;&#x5316;&#xFF0C;&#x5C06;&#x901A;&#x8FC7;create&#x65B9;&#x6CD5;&#x81EA;&#x884C;&#x5B9E;&#x73B0;&#x3002;</p>\n<h4 id=\"Provider\"><a href=\"#Provider\" class=\"headerlink\" title=\"Provider\"></a>Provider</h4>","categories":["android"],"tags":["AwesomeGithub"]},{"title":"Android Navigation的四大要点你都知道吗？","url":"https://www.rousetime.com/2019/10/22/Android-Navigation的四大要点你都知道吗？/","content":"<p>&#x5728;JetPack&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x7EC4;&#x4EF6;&#x662F;Navigation&#xFF0C;&#x987E;&#x540D;&#x601D;&#x4E49;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x5BFC;&#x822A;&#x7EC4;&#x4EF6;&#xFF0C;&#x76F8;&#x5BF9;&#x4E8E;&#x5176;&#x4ED6;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x5BFC;&#x822A;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x5B83;&#x662F;&#x4E13;&#x95E8;&#x4E3A;Fragment&#x7684;&#x9875;&#x9762;&#x7BA1;&#x7406;&#x6240;&#x8BBE;&#x8BA1;&#x7684;&#x3002;&#x5B83;&#x5BF9;&#x4E8E;&#x5355;&#x4E2A;Activity&#x7684;App&#x6765;&#x8BF4;&#x975E;&#x5E38;&#x6709;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x4EE5;&#x4E00;&#x4E2A;Activity&#x4E3A;&#x67B6;&#x6784;&#x7684;App&#x9875;&#x9762;&#x7684;&#x5448;&#x73B0;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x4E0D;&#x540C;&#x7684;Fragment&#x6765;&#x5C55;&#x793A;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x5BF9;&#x4E8E;Fragment&#x7684;&#x7BA1;&#x7406;&#x81F3;&#x5173;&#x91CD;&#x8981;&#x3002;&#x901A;&#x5E38;&#x7684;&#x5B9E;&#x73B0;&#x90FD;&#x8981;&#x81EA;&#x5DF1;&#x7EF4;&#x62A4;Fragment&#x4E4B;&#x95F4;&#x7684;&#x6808;&#x5173;&#x7CFB;&#xFF0C;&#x540C;&#x65F6;&#x8981;&#x5BF9;Fragment&#x7684;Transaction&#x64CD;&#x4F5C;&#x975E;&#x5E38;&#x719F;&#x6089;&#x3002;&#x4E3A;&#x4E86;&#x964D;&#x4F4E;&#x4F7F;&#x7528;&#x4E0E;&#x7EF4;&#x62A4;&#x6210;&#x672C;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x6709;&#x4E86;&#x4ECA;&#x5929;&#x7684;&#x4E3B;&#x89D2;Navigation&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x5BF9;JetPack&#x7684;&#x5176;&#x5B83;&#x7EC4;&#x4EF6;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x63A8;&#x8350;&#x4F60;&#x9605;&#x8BFB;&#x6211;&#x4E4B;&#x524D;&#x7684;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#xFF0C;&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x76EE;&#x524D;&#x4E3A;JetPack&#x7CFB;&#x5217;&#x7684;&#x6700;&#x540E;&#x4E00;&#x7BC7;&#x3002;</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247483702&amp;idx=1&amp;sn=dc1a5cefe847412bd276cc1eff0b2b88&amp;chksm=e8e0f8a6df9771b0a003edcfc0b25c0e58418ba7fd3ec34064479d444a96958ee2efc7fc92c1&amp;token=482154268&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part1:Room</a><br><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247483706&amp;idx=1&amp;sn=4e5f7bb015b46d3ece8e3eff6437f8af&amp;chksm=e8e0f8aadf9771bc67aca66049f852165700c0f3c2e8ba38a8f83875dcc205089f402e76089d&amp;token=482154268&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part2:LiveData</a><br><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247483714&amp;idx=1&amp;sn=8d2137f92d0f8561cbf03c75456f122c&amp;chksm=e8e0f8d2df9771c41caa4f5cb285c6c99ba115e8c20ed8356eccdf998a640f01341028b8c9df&amp;token=482154268&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part3:Lifecycle</a><br><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247483721&amp;idx=1&amp;sn=7228254b03acde76c737b110f7619f73&amp;chksm=e8e0f8d9df9771cfe8b8d088d531efa9fecf8825586fb7f307572cacc45721a6dc577a69bca9&amp;token=482154268&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part4:ViewModel</a><br><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484096&amp;idx=1&amp;sn=c87f8a38fe75108ccdc1883116efc78e&amp;chksm=e8e0fb50df9772460b5ee546b4474c46b58f0433eb75a9029d7ec41bc9d50bea225f880183d6&amp;token=482154268&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Paging&#x5728;RecyclerView&#x4E2D;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x6709;&#x8FD9;&#x4E00;&#x7BC7;&#x5C31;&#x591F;&#x4E86;</a><br><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484164&amp;idx=1&amp;sn=8e1cf325a281340d5664a1826b870e34&amp;chksm=e8e0fa94df977382ec38fba3440723cc12d76a44d2f6e3b4ef59d0228aa21a98a25a6b0d2ac9&amp;token=482154268&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">WorkManager&#x4ECE;&#x5165;&#x95E8;&#x5230;&#x5B9E;&#x8DF5;&#xFF0C;&#x6709;&#x8FD9;&#x4E00;&#x7BC7;&#x5C31;&#x591F;&#x4E86;</a></p>\n<p>&#x5BF9;&#x4E8E;Navigation&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x6211;&#x5C06;&#x5176;&#x5F52;&#x7EB3;&#x4E8E;&#x4EE5;&#x4E0B;&#x56DB;&#x70B9;&#xFF1A;</p>\n<ul>\n<li>Navigation&#x7684;&#x57FA;&#x672C;&#x914D;&#x7F6E;</li>\n<li>Navigation&#x7684;&#x8DF3;&#x8F6C;&#x4E0E;&#x6570;&#x636E;&#x4F20;&#x9012;</li>\n<li>Navigation&#x7684;&#x9875;&#x9762;&#x52A8;&#x753B;</li>\n<li>Navigation&#x7684;deepLink</li>\n</ul>\n<h2 id=\"&#x914D;&#x7F6E;\"><a href=\"#&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;\"></a>&#x914D;&#x7F6E;</h2><p>&#x5728;&#x4F7F;&#x7528;&#x4E4B;&#x524D;&#x9700;&#x8981;&#x5F15;&#x5165;Navigation&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E3A;Navigation&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5B83;&#x5C06;&#x4F4D;&#x4E8E;res/navigation/nav_graph.xml&#x3002;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x7406;&#x89E3;&#x6587;&#x7AE0;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x5199;&#x4E86;&#x4E00;&#x4E2A;Demo&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<a href=\"https://github.com/idisfkj/android-api-analysis/tree/master\" target=\"_blank\" rel=\"noopener\">Android&#x7CBE;&#x534E;&#x5F55;</a>&#x67E5;&#x770B;&#x3002;</p>\n<p>&#x5728;&#x6211;&#x7684;Demo&#x4E2D;&#x6253;&#x5F00;nav_graph.xml&#x4F60;&#x5C06;&#x6E05;&#x6670;&#x7684;&#x770B;&#x5230;&#x5B83;&#x4EEC;&#x9875;&#x9762;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x7EBD;&#x5E26;</p>\n<p><img src=\"/2019/10/22/Android-Navigation&#x7684;&#x56DB;&#x5927;&#x8981;&#x70B9;&#x4F60;&#x90FD;&#x77E5;&#x9053;&#x5417;&#xFF1F;/1.png\" alt></p>\n<p>&#x4E00;&#x5171;&#x6709;6&#x4E2A;&#x9875;&#x9762;&#xFF0C;&#x6700;&#x5DE6;&#x8FB9;&#x7684;&#x4E3A;&#x7A0B;&#x5E8F;&#x5165;&#x53E3;&#x9875;&#x9762;&#xFF0C;&#x5B83;&#x4EEC;&#x95F4;&#x7684;&#x7EBF;&#x6761;&#x6307;&#x5411;&#x4E3A;&#x5B83;&#x4EEC;&#x95F4;&#x53EF;&#x8DF3;&#x8F6C;&#x7684;&#x65B9;&#x5411;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x5B83;&#x4EEC;&#x7684;xm&#x914D;&#x7F6E;&#x1F447;</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">navigation</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/nav_graph&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">app:startDestination</span>=<span class=\"string\">&quot;@id/welcome_fragment&quot;</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">fragment</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/welcome_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:name</span>=<span class=\"string\">&quot;com.idisfkj.androidapianalysis.navigation.fragment.WelcomeFragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:label</span>=<span class=\"string\">&quot;welcome_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">tools:layout</span>=<span class=\"string\">&quot;@layout/fragment_welcome&quot;</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">action</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/action_go_to_register_page&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">app:destination</span>=<span class=\"string\">&quot;@id/register_fragment&quot;</span> /&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">action</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/action_go_to_order_list_page&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">app:destination</span>=<span class=\"string\">&quot;@id/order_list_fragment&quot;</span>/&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">fragment</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">fragment</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/register_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:name</span>=<span class=\"string\">&quot;com.idisfkj.androidapianalysis.navigation.fragment.RegisterFragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:label</span>=<span class=\"string\">&quot;register_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">tools:layout</span>=<span class=\"string\">&quot;@layout/fragment_register&quot;</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">action</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/action_go_to_shop_list_page&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">app:destination</span>=<span class=\"string\">&quot;@id/shop_list_fragment&quot;</span> /&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">fragment</span>&gt;</span></span><br><span class=\"line\">     </span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">navigation</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>&#x9875;&#x9762;&#x6807;&#x7B7E;&#x4E3B;&#x8981;&#x5305;&#x542B;navigation&#x3001;fragment&#x4E0E;action</p>\n<ul>\n<li>navigation: &#x5B9A;&#x4E49;&#x5BFC;&#x822A;&#x6808;&#xFF0C;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x5D4C;&#x5957;&#x5B9A;&#x4E49;&#xFF0C;&#x5404;&#x4E2A;navigation&#x76F8;&#x4E92;&#x72EC;&#x7ACB;&#x3002;&#x5B83;&#x6709;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;startDestination&#x7528;&#x6765;&#x5B9A;&#x4E49;&#x5BFC;&#x822A;&#x6808;&#x7684;&#x6839;&#x5165;&#x53E3;fragment</li>\n<li>fragment: &#x987E;&#x540D;&#x601D;&#x4E49;fragment&#x9875;&#x9762;&#x3002;&#x901A;&#x8FC7;name&#x5C5E;&#x6027;&#x6765;&#x5B9A;&#x4E49;&#x5173;&#x8054;&#x7684;fragment</li>\n<li>action: &#x610F;&#x56FE;&#xFF0C;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;Intent&#xFF0C;&#x5373;&#x8DF3;&#x8F6C;&#x7684;&#x884C;&#x4E3A;&#x3002;&#x901A;&#x8FC7;destination&#x6765;&#x5173;&#x8054;&#x5C06;&#x8981;&#x8DF3;&#x8F6C;&#x7684;&#x76EE;&#x6807;fragment&#x3002;</li>\n</ul>\n<p>&#x4EE5;&#x4E0A;&#x662F;nav_graph.xml&#x7684;&#x57FA;&#x672C;&#x914D;&#x7F6E;&#x3002;</p>\n<p>&#x5728;&#x914D;&#x7F6E;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x5C06;&#x5176;&#x5173;&#x8054;&#x5230;Activity&#x4E2D;&#x3002;&#x56E0;&#x4E3A;&#x6240;&#x6709;&#x7684;Fragment&#x90FD;&#x79BB;&#x4E0D;&#x5F00;Activity&#x3002;</p>\n<p>Navigation&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x4E2A;&#x914D;&#x7F6E;&#x53C2;&#x6570;: defaultNavHost&#x4E0E;navGraph&#xFF0C;&#x6240;&#x4EE5;&#x5728;Activity&#x7684;xml&#x4E2D;&#x9700;&#x8981;&#x5982;&#x4E0B;&#x914D;&#x7F6E;&#x1F447;</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">&quot;match_parent&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">&quot;match_parent&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:background</span>=<span class=\"string\">&quot;@android:color/background_light&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">&quot;vertical&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:context</span>=<span class=\"string\">&quot;.navigation.NavigationMainActivity&quot;</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">fragment</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/nav_host_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:name</span>=<span class=\"string\">&quot;androidx.navigation.fragment.NavHostFragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">&quot;match_parent&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">&quot;match_parent&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">app:defaultNavHost</span>=<span class=\"string\">&quot;true&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">app:navGraph</span>=<span class=\"string\">&quot;@navigation/nav_graph&quot;</span> /&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>defaultNavHost: &#x5C06;&#x8BBE;&#x5907;&#x7684;&#x56DE;&#x9000;&#x64CD;&#x4F5C;&#x8FDB;&#x884C;&#x62E6;&#x622A;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x4EA4;&#x7ED9;Navigation&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#x3002;</li>\n<li>navGraph: Navigation&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5373;&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x914D;&#x7F6E;&#x7684;nav_graph.xml&#x6587;&#x4EF6;</li>\n</ul>\n<p>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;fragment&#x7684;name&#x5C5E;&#x6027;&#x5FC5;&#x987B;&#x4E3A;NavHostFragment&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4F1A;&#x4F5C;&#x4E3A;&#x6211;&#x4EEC;&#x914D;&#x7F6E;&#x7684;&#x6240;&#x6709;fragment&#x7684;&#x7BA1;&#x7406;&#x8005;&#x3002;&#x5177;&#x4F53;&#x901A;&#x8FC7;&#x5185;&#x90E8;&#x7684;NavController&#x4E2D;&#x7684;NavigationProvider&#x6765;&#x83B7;&#x53D6;Navigator&#x62BD;&#x8C61;&#x5B9E;&#x4F8B;&#xFF0C;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x7C7B;&#x662F;FragmentNavigator&#xFF0C;&#x6240;&#x4EE5;&#x6700;&#x7EC8;&#x901A;&#x8FC7;&#x5B83;&#x7684;navigate&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x521B;&#x5EFA;&#x6211;&#x4EEC;&#x914D;&#x7F6E;&#x7684;Fragment&#xFF0C;&#x5E76;&#x4E14;&#x6DFB;&#x52A0;&#x5230;NavHostFragment&#x7684;FrameLayout&#x6839;&#x5E03;&#x5C40;&#x4E2D;&#x3002;</p>\n<p>&#x6B64;&#x65F6;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x7A0B;&#x5E8F;&#x540E;&#x53D1;&#x73B0;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5165;&#x53E3;&#x9875;&#x9762;WelcomeFragment</p>\n<p><img src=\"/2019/10/22/Android-Navigation&#x7684;&#x56DB;&#x5927;&#x8981;&#x70B9;&#x4F60;&#x90FD;&#x77E5;&#x9053;&#x5417;&#xFF1F;/2.png\" alt></p>\n<p>&#x4F46;&#x70B9;&#x51FB;register&#x7B49;&#x64CD;&#x4F5C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x70B9;&#x51FB;&#x8DF3;&#x8F6C;&#x65E0;&#x6548;&#xFF0C;&#x6240;&#x4EE5;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E3A;&#x5176;&#x6DFB;&#x52A0;&#x8DF3;&#x8F6C;</p>\n<h2 id=\"&#x8DF3;&#x8F6C;\"><a href=\"#&#x8DF3;&#x8F6C;\" class=\"headerlink\" title=\"&#x8DF3;&#x8F6C;\"></a>&#x8DF3;&#x8F6C;</h2><p>&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x5728;nav_graph.xml&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;action&#xFF0C;&#x6240;&#x4EE5;&#x8DF3;&#x8F6C;&#x7684;&#x63A5;&#x5165;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;action&#x7684;&#x5173;&#x8054;&#x8DF3;&#x8F6C;&#x53EA;&#x9700;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x1F447;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WelcomeFragment</span> : <span class=\"type\">Fragment</span></span>() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreateView</span><span class=\"params\">(inflater: <span class=\"type\">LayoutInflater</span>, container: <span class=\"type\">ViewGroup</span>?, savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span>: View? {</span><br><span class=\"line\">        <span class=\"keyword\">return</span> inflater.inflate(R.layout.fragment_welcome, container, <span class=\"literal\">false</span>).apply {</span><br><span class=\"line\">            register_bt.setOnClickListener(Navigation.createNavigateOnClickListener(R.id.action_go_to_register_page))</span><br><span class=\"line\">            stroll_bt.setOnClickListener(Navigation.createNavigateOnClickListener(R.id.action_go_to_order_list_page))</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4EE3;&#x7801;&#x4E2D;&#x7684;id&#x5C31;&#x662F;&#x914D;&#x7F6E;&#x7684;action&#x7684;id&#xFF0C;&#x5185;&#x90E8;&#x539F;&#x7406;&#x662F;&#x5148;&#x83B7;&#x53D6;&#x5230;&#x5BF9;&#x5E94;&#x7684;NavController&#xFF0C;&#x901A;&#x8FC7;&#x70B9;&#x51FB;&#x7684;view&#x6765;&#x904D;&#x5386;&#x627E;&#x5230;&#x6700;&#x5916;&#x5C42;&#x7684;parent view&#xFF0C;&#x56E0;&#x4E3A;&#x6700;&#x5916;&#x5C42;&#x7684;parent view&#x4F1A;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5BFC;&#x5165;&#x65F6;&#xFF0C;&#x5373;NavHostFragment&#x4E2D;&#x7684;onViewCreated&#x65B9;&#x6CD5;&#x4E2D;&#x8FDB;&#x884C;&#x5173;&#x8054;&#x5BF9;&#x5E94;&#x7684;NavController&#x1F447;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onViewCreated</span><span class=\"params\">(@NonNull View view, @Nullable Bundle savedInstanceState)</span> </span>{</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.onViewCreated(view, savedInstanceState);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!(view <span class=\"keyword\">instanceof</span> ViewGroup)) {</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(<span class=\"string\">&quot;created host view &quot;</span> + view + <span class=\"string\">&quot; is not a ViewGroup&quot;</span>);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    Navigation.setViewNavController(view, mNavController);</span><br><span class=\"line\">    <span class=\"comment\">// When added programmatically, we need to set the NavController on the parent - i.e.,</span></span><br><span class=\"line\">    <span class=\"comment\">// the View that has the ID matching this NavHostFragment.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (view.getParent() != <span class=\"keyword\">null</span>) {</span><br><span class=\"line\">        View rootView = (View) view.getParent();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (rootView.getId() == getId()) {</span><br><span class=\"line\">            Navigation.setViewNavController(rootView, mNavController);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x518D;&#x8C03;&#x7528;navigate&#x8FDB;&#x884C;&#x9875;&#x9762;&#x8DF3;&#x8F6C;&#x5904;&#x7406;&#xFF0C;&#x6700;&#x7EC8;&#x901A;&#x8FC7;FragmentTransaction&#x7684;replace&#x8FDB;&#x884C;Fragment&#x66FF;&#x6362;&#x1F447;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-------------- NavController ------------------</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">navigate</span><span class=\"params\">(@NonNull NavDestination node, @Nullable Bundle args,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">        @Nullable NavOptions navOptions, @Nullable Navigator.Extras navigatorExtras)</span> </span>{</span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> popped = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (navOptions != <span class=\"keyword\">null</span>) {</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (navOptions.getPopUpTo() != -<span class=\"number\">1</span>) {</span><br><span class=\"line\">            popped = popBackStackInternal(navOptions.getPopUpTo(),</span><br><span class=\"line\">                    navOptions.isPopUpToInclusive());</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    Navigator&lt;NavDestination&gt; navigator = mNavigatorProvider.getNavigator(</span><br><span class=\"line\">            node.getNavigatorName());</span><br><span class=\"line\">    Bundle finalArgs = node.addInDefaultArgs(args);</span><br><span class=\"line\">    # ---- &#x5173;&#x952E;&#x4EE3;&#x7801; -------</span><br><span class=\"line\">    NavDestination newDest = navigator.navigate(node, finalArgs,</span><br><span class=\"line\">            navOptions, navigatorExtras);</span><br><span class=\"line\">    ....</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">-------------- FragmentNavigator ------------------</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> NavDestination <span class=\"title\">navigate</span><span class=\"params\">(@NonNull Destination destination, @Nullable Bundle args,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">        @Nullable NavOptions navOptions, @Nullable Navigator.Extras navigatorExtras)</span> </span>{</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mFragmentManager.isStateSaved()) {</span><br><span class=\"line\">        Log.i(TAG, <span class=\"string\">&quot;Ignoring navigate() call: FragmentManager has already&quot;</span></span><br><span class=\"line\">                + <span class=\"string\">&quot; saved its state&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    String className = destination.getClassName();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (className.charAt(<span class=\"number\">0</span>) == <span class=\"string\">&apos;.&apos;</span>) {</span><br><span class=\"line\">        className = mContext.getPackageName() + className;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Fragment frag = instantiateFragment(mContext, mFragmentManager,</span><br><span class=\"line\">            className, args);</span><br><span class=\"line\">    frag.setArguments(args);</span><br><span class=\"line\">    <span class=\"keyword\">final</span> FragmentTransaction ft = mFragmentManager.beginTransaction();</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">int</span> enterAnim = navOptions != <span class=\"keyword\">null</span> ? navOptions.getEnterAnim() : -<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> exitAnim = navOptions != <span class=\"keyword\">null</span> ? navOptions.getExitAnim() : -<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> popEnterAnim = navOptions != <span class=\"keyword\">null</span> ? navOptions.getPopEnterAnim() : -<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> popExitAnim = navOptions != <span class=\"keyword\">null</span> ? navOptions.getPopExitAnim() : -<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (enterAnim != -<span class=\"number\">1</span> || exitAnim != -<span class=\"number\">1</span> || popEnterAnim != -<span class=\"number\">1</span> || popExitAnim != -<span class=\"number\">1</span>) {</span><br><span class=\"line\">        enterAnim = enterAnim != -<span class=\"number\">1</span> ? enterAnim : <span class=\"number\">0</span>;</span><br><span class=\"line\">        exitAnim = exitAnim != -<span class=\"number\">1</span> ? exitAnim : <span class=\"number\">0</span>;</span><br><span class=\"line\">        popEnterAnim = popEnterAnim != -<span class=\"number\">1</span> ? popEnterAnim : <span class=\"number\">0</span>;</span><br><span class=\"line\">        popExitAnim = popExitAnim != -<span class=\"number\">1</span> ? popExitAnim : <span class=\"number\">0</span>;</span><br><span class=\"line\">        ft.setCustomAnimations(enterAnim, exitAnim, popEnterAnim, popExitAnim);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    # ------ &#x5173;&#x952E;&#x4EE3;&#x7801; ------</span><br><span class=\"line\">    ft.replace(mContainerId, frag);</span><br><span class=\"line\">    ft.setPrimaryNavigationFragment(frag);</span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6E90;&#x7801;&#x5C31;&#x5206;&#x6790;&#x5230;&#x8FD9;&#x91CC;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x6DF1;&#x5165;&#x4E86;&#x89E3;&#xFF0C;&#x5EFA;&#x8BAE;&#x9605;&#x8BFB;<strong>NavHostFragment</strong>&#x3001;<strong>NavController</strong>&#x3001;<strong>NavigatorProvider</strong>&#x4E0E;<strong>FragmentNavigator</strong></p>\n<h2 id=\"&#x4F20;&#x53C2;\"><a href=\"#&#x4F20;&#x53C2;\" class=\"headerlink\" title=\"&#x4F20;&#x53C2;\"></a>&#x4F20;&#x53C2;</h2><p>&#x4EE5;&#x4E0A;&#x662F;&#x9875;&#x9762;&#x7684;&#x65E0;&#x53C2;&#x8DF3;&#x8F6C;&#xFF0C;&#x90A3;&#x4E48;&#x5BF9;&#x4E8E;&#x6709;&#x53C2;&#x8DF3;&#x8F6C;&#x53C8;&#x8BE5;&#x5982;&#x4F55;&#x5462;&#xFF1F;</p>\n<p>&#x5927;&#x5BB6;&#x60F3;&#x5230;&#x7684;&#x5E94;&#x8BE5;&#x90FD;&#x662F;bundle&#xFF0C;&#x5C06;&#x4F20;&#x9012;&#x7684;&#x6570;&#x636E;&#x586B;&#x5165;&#x5230;bundle&#x4E2D;&#x3002;&#x6CA1;&#x9519;Navigator&#x63D0;&#x4F9B;&#x7684;navigate&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x4F20;&#x9012;bundle&#x6570;&#x636E;&#x1F447;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">findNavController().navigate(R.id.action_go_to_shop_detail_page, bundleOf(<span class=\"string\">&quot;title&quot;</span> to <span class=\"string\">&quot;I am title&quot;</span>))</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x79CD;&#x4F20;&#x7EDF;&#x7684;&#x65B9;&#x6CD5;&#x5728;&#x4F20;&#x9012;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x4E0A;&#x5E76;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x5176;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x4EBA;&#x4E3A;&#x7CBE;&#x529B;&#x4E0A;&#x7684;&#x9519;&#x8BEF;&#xFF0C;Navigation&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;Gradle&#x63D2;&#x4EF6;&#xFF0C;&#x4E13;&#x95E8;&#x7528;&#x6765;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x7684;&#x7C7B;&#x578B;&#x5B89;&#x5168;&#x3002;</p>\n<p>&#x4F7F;&#x7528;&#x5B83;&#x7684;&#x8BDD;&#x9700;&#x8981;&#x5F15;&#x5165;&#x8BE5;&#x63D2;&#x4EF6;&#xFF0C;&#x65B9;&#x5F0F;&#x5982;&#x4E0B;&#x1F447;</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buildscript {</span><br><span class=\"line\">    repositories {</span><br><span class=\"line\">        google()</span><br><span class=\"line\">    }</span><br><span class=\"line\">    dependencies {</span><br><span class=\"line\">        <span class=\"keyword\">def</span> nav_version = <span class=\"string\">&quot;2.1.0&quot;</span></span><br><span class=\"line\">        classpath <span class=\"string\">&quot;androidx.navigation:navigation-safe-args-gradle-plugin:$nav_version&quot;</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x518D;&#x5230;app&#x4E0B;&#x7684;build.gradle&#x4E2D;&#x5F15;&#x5165;&#x8BE5;&#x63D2;&#x4EF6;&#x1F447;</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply <span class=\"string\">plugin:</span> <span class=\"string\">&quot;androidx.navigation.safeargs.kotlin&quot;</span></span><br></pre></td></tr></table></figure>\n<p>&#x800C;&#x5B83;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x9996;&#x5148;&#x53C2;&#x6570;&#x9700;&#x8981;&#x5728;nav_graph.xml&#x4E2D;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002;&#x1F447;</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">fragment</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/shop_list_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:name</span>=<span class=\"string\">&quot;com.idisfkj.androidapianalysis.navigation.fragment.ShopListFragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:label</span>=<span class=\"string\">&quot;shop_list_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:layout</span>=<span class=\"string\">&quot;@layout/fragment_shop_list&quot;</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">action</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/action_go_to_shop_detail_page&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">app:destination</span>=<span class=\"string\">&quot;@id/shop_detail_fragment&quot;</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">argument</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:name</span>=<span class=\"string\">&quot;title&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">app:argType</span>=<span class=\"string\">&quot;string&quot;</span> /&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">fragment</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">fragment</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/shop_detail_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:name</span>=<span class=\"string\">&quot;com.idisfkj.androidapianalysis.navigation.fragment.ShopDetailFragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:label</span>=<span class=\"string\">&quot;shop_detail_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:layout</span>=<span class=\"string\">&quot;@layout/fragment_shop_detail&quot;</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">action</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/action_go_to_cart_page&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">app:destination</span>=<span class=\"string\">&quot;@id/cart_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">app:popUpTo</span>=<span class=\"string\">&quot;@id/cart_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">app:popUpToInclusive</span>=<span class=\"string\">&quot;true&quot;</span> /&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">argument</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:name</span>=<span class=\"string\">&quot;title&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">app:argType</span>=<span class=\"string\">&quot;string&quot;</span> /&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">fragment</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x4ECE;ShopListFragment&#x8DF3;&#x8F6C;&#x5230;ShopDetailFragment&#xFF0C;&#x9700;&#x8981;&#x5728;ShopListFragment&#x7684;&#x5BF9;&#x5E94;action&#x4E2D;&#x6DFB;&#x52A0;argument&#xFF0C;&#x58F0;&#x660E;&#x5BF9;&#x5E94;&#x7684;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x4E0E;&#x53C2;&#x6570;&#x540D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;defaultValue&#x5B9A;&#x4E49;&#x53C2;&#x6570;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x4E0E;nullable&#x6807;&#x660E;&#x662F;&#x5426;&#x53EF;&#x7A7A;&#x3002;&#x5BF9;&#x5E94;&#x7684;ShopDetailFragment&#x63A5;&#x6536;&#x53C2;&#x6570;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#x3002;</p>\n<p>&#x53E6;&#x5916;popUpTo&#x4E0E;popUpToInclusive&#x5C5E;&#x6027;&#x662F;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x8DF3;&#x8F6C;&#x5230;CartFragment&#x65F6;&#x8FBE;&#x5230;SingleTop&#x6548;&#x679C;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x770B;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x914D;&#x7F6E;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x9996;&#x5148;&#x662F;&#x5728;ShopListFragment&#x4E2D;&#x1F447;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">holder.item.setOnClickListener(Navigation.createNavigateOnClickListener(ShopListFragmentDirections.actionGoToShopDetailPage(shopList[position])))</span><br></pre></td></tr></table></figure>\n<p>&#x8FD8;&#x662F;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;createNavigateOnClickListener&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x73B0;&#x5728;&#x4F20;&#x9012;&#x7684;&#x4E0D;&#x518D;&#x662F;&#x8DF3;&#x8F6C;&#x7684;action id&#xFF0C;&#x800C;&#x662F;&#x901A;&#x8FC7;&#x63D2;&#x4EF6;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;ShopListFragmentDirections.actionGoToShopDetailPage&#x65B9;&#x6CD5;&#x3002;&#x4E00;&#x65E6;&#x6211;&#x4EEC;&#x5982;&#x4E0A;&#x914D;&#x7F6E;&#x4E86;argument&#xFF0C;&#x63D2;&#x4EF6;&#x5C31;&#x4F1A;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x4EE5;[&#x7C7B;&#x540D;]+Directions&#x7684;&#x7C7B;&#xFF0C;&#x800C;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x7C7B;&#x672C;&#x8D28;&#x662F;&#x505A;&#x4E86;&#x8DF3;&#x8F6C;&#x4E0E;&#x53C2;&#x6570;&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#x1F447;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ShopListFragmentDirections</span> <span class=\"keyword\">private</span> <span class=\"keyword\">constructor</span></span>() {</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">data</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ActionGoToShopDetailPage</span></span>(<span class=\"keyword\">val</span> title: String) : NavDirections {</span><br><span class=\"line\">        <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getActionId</span><span class=\"params\">()</span></span>: <span class=\"built_in\">Int</span> = R.id.action_go_to_shop_detail_page</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getArguments</span><span class=\"params\">()</span></span>: Bundle {</span><br><span class=\"line\">            <span class=\"keyword\">val</span> result = Bundle()</span><br><span class=\"line\">            result.putString(<span class=\"string\">&quot;title&quot;</span>, <span class=\"keyword\">this</span>.title)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> result</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">companion</span> <span class=\"keyword\">object</span> {</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">actionGoToShopDetailPage</span><span class=\"params\">(title: <span class=\"type\">String</span>)</span></span>: NavDirections = ActionGoToShopDetailPage(title)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x672C;&#x8D28;&#x662F;&#x5C06;action id&#x4E0E;argument&#x5C01;&#x88C5;&#x6210;&#x4E00;&#x4E2A;NavDirections&#xFF0C;&#x5185;&#x90E8;&#x901A;&#x8FC7;&#x89E3;&#x6790;&#x5B83;&#x6765;&#x83B7;&#x53D6;action id&#x4E0E;argument&#xFF0C;&#x4ECE;&#x800C;&#x6267;&#x884C;&#x8DF3;&#x8F6C;&#x3002;</p>\n<p>&#x800C;&#x5BF9;&#x4E8E;&#x63A5;&#x53D7;&#x65B9;ShopDetailFragment&#xFF0C;&#x63D2;&#x4EF6;&#x9875;&#x9762;&#x81EA;&#x52A8;&#x5E2E;&#x6211;&#x4EEC;&#x751F;&#x6210;&#x4E00;&#x4E2A;ShopDetailFragmentArgs&#xFF0C;&#x4EE5;[&#x7C7B;&#x540D;]+Args&#x7684;&#x7C7B;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x505A;&#x7684;&#x4E5F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x1F447;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ShopDetailFragment</span> : <span class=\"type\">Fragment</span></span>() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">val</span> args <span class=\"keyword\">by</span> navArgs&lt;ShopDetailFragmentArgs&gt;()</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreateView</span><span class=\"params\">(inflater: <span class=\"type\">LayoutInflater</span>, container: <span class=\"type\">ViewGroup</span>?, savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span>: View? {</span><br><span class=\"line\">        <span class=\"keyword\">return</span> inflater.inflate(R.layout.fragment_shop_detail, container, <span class=\"literal\">false</span>).apply {</span><br><span class=\"line\">            title.text = args.title</span><br><span class=\"line\">            add_cart.setOnClickListener(Navigation.createNavigateOnClickListener(ShopDetailFragmentDirections.actionGoToCartPage()))</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;navArgs&#x6765;&#x83B7;&#x53D6;ShopDetailFragmentArgs&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;&#x9875;&#x9762;&#x6570;&#x636E;&#x3002;</p>\n<h2 id=\"&#x52A8;&#x753B;\"><a href=\"#&#x52A8;&#x753B;\" class=\"headerlink\" title=\"&#x52A8;&#x753B;\"></a>&#x52A8;&#x753B;</h2><p>&#x5728;action&#x4E2D;&#x4E0D;&#x4EC5;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x8DF3;&#x8F6C;&#x7684;destination&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x5BF9;&#x5E94;&#x9875;&#x9762;&#x7684;&#x8F6C;&#x573A;&#x52A8;&#x753B;&#xFF0C;&#x4F7F;&#x7528;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x1F447;</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">navigation</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/nav_graph&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">app:startDestination</span>=<span class=\"string\">&quot;@id/welcome_fragment&quot;</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">fragment</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/welcome_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:name</span>=<span class=\"string\">&quot;com.idisfkj.androidapianalysis.navigation.fragment.WelcomeFragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:label</span>=<span class=\"string\">&quot;welcome_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">tools:layout</span>=<span class=\"string\">&quot;@layout/fragment_welcome&quot;</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">action</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/action_go_to_register_page&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">app:destination</span>=<span class=\"string\">&quot;@id/register_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">app:enterAnim</span>=<span class=\"string\">&quot;@anim/slide_in_right&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">app:exitAnim</span>=<span class=\"string\">&quot;@anim/slide_in_left&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">app:popEnterAnim</span>=<span class=\"string\">&quot;@anim/slide_out_left&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">app:popExitAnim</span>=<span class=\"string\">&quot;@anim/slide_out_right&quot;</span> /&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">action</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/action_go_to_order_list_page&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">app:destination</span>=<span class=\"string\">&quot;@id/order_list_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">app:enterAnim</span>=<span class=\"string\">&quot;@anim/slide_in_right&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">app:exitAnim</span>=<span class=\"string\">&quot;@anim/slide_in_left&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">app:popEnterAnim</span>=<span class=\"string\">&quot;@anim/slide_out_left&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">app:popExitAnim</span>=<span class=\"string\">&quot;@anim/slide_out_right&quot;</span> /&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">fragment</span>&gt;</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">navigation</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x5E94;&#x56DB;&#x4E2A;&#x52A8;&#x753B;&#x914D;&#x7F6E;&#x53C2;&#x6570;</p>\n<ul>\n<li>enterAnim: &#x914D;&#x7F6E;&#x8FDB;&#x573A;&#x65F6;&#x76EE;&#x6807;&#x9875;&#x9762;&#x52A8;&#x753B;</li>\n<li>exitAnim: &#x914D;&#x7F6E;&#x8FDB;&#x573A;&#x65F6;&#x539F;&#x9875;&#x9762;&#x52A8;&#x753B;</li>\n<li>popEnterAnim: &#x914D;&#x7F6E;&#x56DE;&#x9000;pop&#x65F6;&#x76EE;&#x6807;&#x9875;&#x9762;&#x52A8;&#x753B;</li>\n<li>popExitAnim: &#x914D;&#x7F6E;&#x56DE;&#x9000;pop&#x65F6;&#x539F;&#x9875;&#x9762;&#x52A8;&#x753B;</li>\n</ul>\n<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x914D;&#x7F6E;&#x4F60;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5982;&#x4E0B;&#x6548;&#x679C;&#x1F447;</p>\n<p><img src=\"/2019/10/22/Android-Navigation&#x7684;&#x56DB;&#x5927;&#x8981;&#x70B9;&#x4F60;&#x90FD;&#x77E5;&#x9053;&#x5417;&#xFF1F;/3.gif\" alt></p>\n<h2 id=\"deepLink\"><a href=\"#deepLink\" class=\"headerlink\" title=\"deepLink\"></a>deepLink</h2><p>&#x6211;&#x4EEC;&#x56DE;&#x60F3;&#x4E00;&#x4E0B;&#x5BF9;&#x4E8E;&#x591A;&#x4E2A;Activity&#x6211;&#x9700;&#x8981;&#x5B9E;&#x73B0;deepLink&#x6548;&#x679C;&#xFF0C;&#x5E94;&#x8BE5;&#x90FD;&#x662F;&#x5728;AndroidManifest.xml&#x4E2D;&#x8FDB;&#x884C;&#x914D;&#x7F6E;scheme&#x3001;host&#x7B49;&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x5355;&#x4E2A;Activity&#x4E5F;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x7C7B;&#x4F3C;&#x7684;&#x6548;&#x679C;&#xFF0C;Navigation&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x5BF9;&#x5E94;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x800C;&#x4E14;&#x64CD;&#x4F5C;&#x66F4;&#x7B80;&#x5355;&#x3002;</p>\n<p>Navigation&#x63D0;&#x4F9B;&#x7684;&#x662F;deepLink&#x6807;&#x7B7E;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;nav_graph.xml&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#xFF0C;&#x4F8B;&#x5982;&#x1F447;</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">fragment</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/register_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:name</span>=<span class=\"string\">&quot;com.idisfkj.androidapianalysis.navigation.fragment.RegisterFragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:label</span>=<span class=\"string\">&quot;register_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:layout</span>=<span class=\"string\">&quot;@layout/fragment_register&quot;</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">action</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/action_go_to_shop_list_page&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">app:destination</span>=<span class=\"string\">&quot;@id/shop_list_fragment&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">app:enterAnim</span>=<span class=\"string\">&quot;@anim/slide_in_right&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">app:exitAnim</span>=<span class=\"string\">&quot;@anim/slide_in_left&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">app:popEnterAnim</span>=<span class=\"string\">&quot;@anim/slide_out_left&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">app:popExitAnim</span>=<span class=\"string\">&quot;@anim/slide_out_right&quot;</span> /&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">deepLink</span> <span class=\"attr\">app:uri</span>=<span class=\"string\">&quot;api://register/&quot;</span> /&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">fragment</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x901A;&#x8FC7;deepLink&#x6211;&#x914D;&#x7F6E;&#x4E86;&#x4E00;&#x4E2A;&#x8DF3;&#x8F6C;&#x5230;&#x6CE8;&#x518C;&#x9875;RegisterFragment&#xFF0C;&#x5199;&#x6CD5;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x76F4;&#x63A5;&#x914D;&#x7F6E;uri&#x5373;&#x53EF;&#xFF1B;&#x540C;&#x65F6;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5360;&#x4F4D;&#x7B26;&#x914D;&#x7F6E;&#x4F20;&#x9012;&#x53C2;&#x6570;&#xFF0C;&#x4F8B;&#x5982;&#x1F447;</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">deepLink</span> <span class=\"attr\">app:uri</span>=<span class=\"string\">&quot;api://register/{id}&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x6CE8;&#x518C;&#x9875;&#x9762;&#x901A;&#x8FC7;argument&#x83B7;&#x53D6;key&#x4E3A;id&#x7684;&#x6570;&#x636E;&#x3002;</p>\n<p>&#x5F53;&#x7136;&#x8981;&#x5B9E;&#x73B0;&#x4E0A;&#x9762;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x524D;&#x63D0;&#xFF0C;&#x9700;&#x8981;&#x5728;AndroidManifest.xml&#x4E2D;&#x5C06;&#x6211;&#x4EEC;&#x7684;deepLink&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#xFF0C;&#x5728;Activity&#x4E2D;&#x4F7F;&#x7528;nav-graph&#x6807;&#x7B7E;&#x1F447;</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">application</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">...</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:theme</span>=<span class=\"string\">&quot;@style/AppTheme&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">activity</span> <span class=\"attr\">android:name</span>=<span class=\"string\">&quot;.navigation.NavigationMainActivity&quot;</span> &gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">intent-filter</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">android:name</span>=<span class=\"string\">&quot;android.intent.action.VIEW&quot;</span>/&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">android:name</span>=<span class=\"string\">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">category</span> <span class=\"attr\">android:name</span>=<span class=\"string\">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">intent-filter</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">nav-graph</span> <span class=\"attr\">android:value</span>=<span class=\"string\">&quot;@navigation/nav_graph&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">activity</span>&gt;</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">application</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>&#x73B0;&#x5728;&#x53EA;&#x9700;&#x5C06;&#x6587;&#x7AE0;&#x4E2D;&#x7684;demo&#x5B89;&#x88C5;&#x5230;&#x624B;&#x673A;&#x4E0A;&#xFF0C;&#x518D;&#x70B9;&#x51FB;&#x4E0B;&#x9762;&#x7684;link</p>\n<p><a href=\"api://register/\" target=\"_blank\" rel=\"noopener\">jump to register api</a></p>\n<p>&#x4E4B;&#x540E;&#x5C31;&#x4F1A;&#x542F;&#x52A8;App&#xFF0C;&#x5E76;&#x5B9A;&#x4F4D;&#x5230;&#x6CE8;&#x518C;&#x754C;&#x9762;&#x3002;&#x662F;&#x4E0D;&#x662F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x5462;&#xFF1F;</p>\n<p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x4E0B;&#x6548;&#x679C;&#x1F447;</p>\n<p><img src=\"/2019/10/22/Android-Navigation&#x7684;&#x56DB;&#x5927;&#x8981;&#x70B9;&#x4F60;&#x90FD;&#x77E5;&#x9053;&#x5417;&#xFF1F;/4.gif\" alt></p>\n<p>&#x6709;&#x5173;Navigation&#x6682;&#x65F6;&#x5C31;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x5E0C;&#x671B;&#x4F60;&#x80FD;&#x591F;&#x719F;&#x6089;&#x8FD0;&#x7528;Navigation&#xFF0C;&#x5E76;&#x4E14;&#x53D1;&#x73B0;&#x5355;Activity&#x7684;&#x9B45;&#x529B;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5BF9;&#x4F60;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x987A;&#x624B;&#x70B9;&#x8D5E;&#x3001;&#x5173;&#x6CE8;&#x4E00;&#x6CE2;&#xFF0C;&#x8FD9;&#x662F;&#x5BF9;&#x6211;&#x6700;&#x5927;&#x7684;&#x9F13;&#x52B1;&#xFF01;</p>\n<h2 id=\"&#x9879;&#x76EE;&#x5730;&#x5740;\"><a href=\"#&#x9879;&#x76EE;&#x5730;&#x5740;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;&#x5730;&#x5740;\"></a>&#x9879;&#x76EE;&#x5730;&#x5740;</h2><h3 id=\"Android&#x7CBE;&#x534E;&#x5F55;\"><a href=\"#Android&#x7CBE;&#x534E;&#x5F55;\" class=\"headerlink\" title=\"Android&#x7CBE;&#x534E;&#x5F55;\"></a>Android&#x7CBE;&#x534E;&#x5F55;</h3><p>&#x8BE5;&#x5E93;&#x7684;&#x76EE;&#x7684;&#x662F;&#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">Android&#x7CBE;&#x534E;&#x5F55;</a></p>\n","categories":["android"],"tags":["Android Architecture Components"]},{"title":"WorkManager从入门到实践，有这一篇就够了","url":"https://www.rousetime.com/2019/08/12/WorkManager从入门到实践，有这一篇就够了/","content":"<h2 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h2><p>&#x4E0A;&#x4E00;&#x6B21;&#x6211;&#x4EEC;&#x5BF9;Paging&#x7684;&#x5E94;&#x7528;&#x8FDB;&#x884C;&#x4E86;&#x4E00;&#x6B21;&#x5168;&#x9762;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x8FD9;&#x4E00;&#x6B21;&#x6211;&#x4EEC;&#x6765;&#x804A;&#x804A;WorkManager&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x5BF9;Paging&#x8FD8;&#x672A;&#x4E86;&#x89E3;&#xFF0C;&#x63A8;&#x8350;&#x9605;&#x8BFB;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF1A;</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247484096&amp;idx=1&amp;sn=c87f8a38fe75108ccdc1883116efc78e&amp;chksm=e8e0fb50df9772460b5ee546b4474c46b58f0433eb75a9029d7ec41bc9d50bea225f880183d6&amp;token=1929195340&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Paging&#x5728;RecyclerView&#x4E2D;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x6709;&#x8FD9;&#x4E00;&#x7BC7;&#x5C31;&#x591F;&#x4E86;</a></p>\n<p>&#x672C;&#x6765;&#x8FD9;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x4E0A;&#x5468;&#x5C31;&#x80FD;&#x591F;&#x53D1;&#x5E03;&#x51FA;&#x6765;&#xFF0C;&#x4F46;&#x6211;&#x5199;&#x6587;&#x7AE0;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x70B9;&#xFF0C;&#x90FD;&#x4F1A;&#x7ED3;&#x5408;&#x5177;&#x4F53;&#x7684;Demo&#x6765;&#x8FDB;&#x884C;&#x9610;&#x8FF0;&#xFF0C;&#x800C;WorkManager&#x7684;Demo&#x65E9;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x53EA;&#x662F;&#x8981;&#x7ED3;&#x5408;&#x6587;&#x7AE0;&#x4E00;&#x8D77;&#x9610;&#x8FF0;&#x5B9E;&#x5728;&#x9700;&#x8981;&#x65F6;&#x95F4;&#xFF0C;&#x4E0A;&#x5468;&#x81EA;&#x8EAB;&#x539F;&#x56E0;&#x4E5F;&#x5C31;&#x5EF6;&#x671F;&#x4E86;&#xFF0C;&#x60F3;&#x60F3;&#x8FD8;&#x662F;&#x5199;&#x4EE3;&#x7801;&#x5BB9;&#x6613;&#x554A;&#x2026;&#x1F63F;&#x1F63F;</p>\n<p>&#x54CE;&#x5440;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x8FDB;&#x5165;&#x6B63;&#x9898;&#xFF01;</p>\n<h2 id=\"WorkManager\"><a href=\"#WorkManager\" class=\"headerlink\" title=\"WorkManager\"></a>WorkManager</h2><p>WorkManager&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x5B98;&#x65B9;&#x7ED9;&#x7684;&#x89E3;&#x91CA;&#x662F;&#xFF1A;&#x5B83;&#x5BF9;&#x53EF;&#x5EF6;&#x671F;&#x4EFB;&#x52A1;&#x64CD;&#x4F5C;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x540C;&#x65F6;&#x7A33;&#x5B9A;&#x6027;&#x975E;&#x5E38;&#x5F3A;&#xFF0C;&#x5BF9;&#x4E8E;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#xFF0C;&#x5373;&#x4F7F;App&#x9000;&#x51FA;&#x8FD0;&#x884C;&#x6216;&#x8005;&#x8BBE;&#x5907;&#x91CD;&#x542F;&#xFF0C;&#x5B83;&#x90FD;&#x80FD;&#x591F;&#x5F88;&#x597D;&#x7684;&#x4FDD;&#x8BC1;&#x4EFB;&#x52A1;&#x7684;&#x987A;&#x5229;&#x6267;&#x884C;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x5173;&#x952E;&#x70B9;&#x662F;&#x7B80;&#x5355;&#x4E0E;&#x7A33;&#x5B9A;&#x6027;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x5E73;&#x5E38;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x540E;&#x53F0;&#x4EFB;&#x52A1;&#x5728;&#x6267;&#x884C;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;app&#x7A81;&#x7136;&#x9000;&#x51FA;&#x6216;&#x8005;&#x624B;&#x673A;&#x65AD;&#x7F51;&#xFF0C;&#x8FD9;&#x65F6;&#x540E;&#x53F0;&#x4EFB;&#x52A1;&#x5C06;&#x76F4;&#x63A5;&#x7EC8;&#x6B62;&#x3002;</p>\n<p>&#x5178;&#x578B;&#x7684;&#x573A;&#x666F;&#x662F;&#xFF1A;App&#x7684;&#x5173;&#x6CE8;&#x529F;&#x80FD;&#x3002;&#x5982;&#x679C;&#x7528;&#x6237;&#x5728;&#x5F31;&#x7F51;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x70B9;&#x51FB;&#x5173;&#x6CE8;&#x6309;&#x94AE;&#xFF0C;&#x6B64;&#x65F6;&#x7528;&#x6237;&#x7531;&#x4E8E;&#x67D0;&#x79CD;&#x539F;&#x56E0;&#x9A6C;&#x4E0A;&#x9000;&#x51FA;&#x4E86;App&#xFF0C;&#x4F46;&#x5173;&#x6CE8;&#x7684;&#x8BF7;&#x6C42;&#x5E76;&#x6CA1;&#x6709;&#x6210;&#x529F;&#x53D1;&#x9001;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x90A3;&#x4E48;&#x4E0B;&#x6B21;&#x7528;&#x6237;&#x518D;&#x8FDB;&#x5165;&#x65F6;&#xFF0C;&#x62FF;&#x5230;&#x7684;&#x8FD8;&#x662F;&#x4E4B;&#x524D;&#x672A;&#x5173;&#x6CE8;&#x7684;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#x3002;&#x8FD9;&#x5C31;&#x4EA7;&#x751F;&#x4E86;&#x64CD;&#x4F5C;&#x4E0A;&#x7684;bug&#xFF0C;&#x964D;&#x4F4E;&#x4E86;&#x7528;&#x6237;&#x7684;&#x4F53;&#x9A8C;&#xFF0C;&#x589E;&#x52A0;&#x4E86;&#x7528;&#x6237;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x8BE5;&#x5982;&#x4F55;&#x89E3;&#x51B3;&#x5462;&#xFF1F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x770B;WorkManager&#x7684;&#x5B9A;&#x4E49;&#xFF0C;&#x4F7F;&#x7528;WorkManager&#x5C31;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x89E3;&#x51B3;&#x3002;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x518D;&#x62D3;&#x5C55;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x4E86;&#xFF0C;&#x53EA;&#x8981;&#x4F60;&#x7EE7;&#x7EED;&#x770B;&#x5B8C;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x4F60;&#x5C31;&#x80FD;&#x8F7B;&#x677E;&#x5B9E;&#x73B0;&#x3002;</p>\n<p>&#x5F53;&#x7136;&#x4F60;&#x4E0D;&#x4F7F;&#x7528;WorkManager&#x4E5F;&#x80FD;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x5C31;&#x6D89;&#x53CA;&#x5230;&#x5B83;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x597D;&#x5904;&#xFF1A;&#x7B80;&#x5355;&#x3002;&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x4F7F;&#x7528;WorkManager&#xFF0C;&#x4F60;&#x5C31;&#x8981;&#x5BF9;&#x4E0D;&#x540C;API&#x7248;&#x672C;&#x8FDB;&#x884C;&#x533A;&#x5206;&#x3002;</p>\n<h3 id=\"JobScheduler\"><a href=\"#JobScheduler\" class=\"headerlink\" title=\"JobScheduler\"></a>JobScheduler</h3><figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">val</span> service = ComponentName(<span class=\"keyword\">this</span>, MyJobService::<span class=\"class\"><span class=\"keyword\">class</span>.<span class=\"title\">java</span>)</span></span><br><span class=\"line\"><span class=\"keyword\">val</span> mJobScheduler = getSystemService(Context.JOB_SCHEDULER_SERVICE) <span class=\"keyword\">as</span> JobScheduler</span><br><span class=\"line\"><span class=\"keyword\">val</span> builder = JobInfo.Builder(jobId, serviceComponent)</span><br><span class=\"line\"> .setRequiredNetworkType(jobInfoNetworkType)</span><br><span class=\"line\"> .setRequiresCharging(<span class=\"literal\">false</span>)</span><br><span class=\"line\"> .setRequiresDeviceIdle(<span class=\"literal\">false</span>)</span><br><span class=\"line\"> .setExtras(extras).build()</span><br><span class=\"line\">mJobScheduler.schedule(jobInfo)</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;JobScheduler&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Job&#xFF0C;&#x4E00;&#x65E6;&#x6240;&#x8BBE;&#x7684;&#x6761;&#x4EF6;&#x8FBE;&#x5230;&#xFF0C;&#x5C31;&#x4F1A;&#x6267;&#x884C;&#x8BE5;Job&#x3002;&#x4F46;JobScheduler&#x662F;&#x5728;API21&#x52A0;&#x5165;&#x7684;&#xFF0C;&#x540C;&#x65F6;&#x5728;API21&amp;22&#x6709;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;Bug</p>\n<p><img src=\"https://miro.medium.com/max/700/1*WW4PPUhUV47MbAiBC1wxFQ.png\" alt></p>\n<p><img src=\"https://miro.medium.com/max/700/1*q5OvGQThDySJnNudb1paWg.png\" alt></p>\n<p><img src=\"https://miro.medium.com/max/700/1*pzfHagD5tJCHjDf6w7oWpg.png\" alt></p>\n<p>&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#x5B83;&#x53EA;&#x80FD;&#x7528;&#x5728;API23&#x53CA;&#x4EE5;&#x4E0A;&#x7684;&#x7248;&#x672C;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &gt;= <span class=\"number\">23</span>) {</span><br><span class=\"line\">\t<span class=\"comment\">// use JobScheduler</span></span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x65E2;&#x7136;&#x53EA;&#x80FD;API23&#x53CA;&#x4EE5;&#x4E0A;&#x624D;&#x80FD;&#x4F7F;&#x7528;JobScheduler&#xFF0C;&#x90A3;&#x4E48;&#x5728;API23&#x4EE5;&#x4E0B;&#x53C8;&#x8BE5;&#x5982;&#x4F55;&#x5462;&#xFF1F;</p>\n<h3 id=\"AlarmManager-amp-BroadcastReceiver\"><a href=\"#AlarmManager-amp-BroadcastReceiver\" class=\"headerlink\" title=\"AlarmManager &amp; BroadcastReceiver\"></a>AlarmManager &amp; BroadcastReceiver</h3><p>&#x8FD9;&#x65F6;&#x5BF9;&#x4E8E;API23&#x4EE5;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;AlarmManager&#x6765;&#x8FDB;&#x884C;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;&#xFF0C;&#x540C;&#x65F6;&#x7ED3;&#x5408;BoradcastReceiver&#x6765;&#x8FDB;&#x884C;&#x4EFB;&#x52A1;&#x7684;&#x6761;&#x4EF6;&#x76D1;&#x542C;&#xFF0C;&#x4F8B;&#x5982;&#x7F51;&#x7EDC;&#x7684;&#x8FDE;&#x63A5;&#x72B6;&#x6001;&#x3001;&#x8BBE;&#x5907;&#x7684;&#x542F;&#x52A8;&#x7B49;&#x3002;</p>\n<p>&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x662F;&#x4E0D;&#x662F;&#x5F00;&#x59CB;&#x5934;&#x5927;&#x4E86;&#x5462;&#xFF0C;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x7684;&#x76EE;&#x7684;&#x53EA;&#x662F;&#x60F3;&#x505A;&#x4E00;&#x4E2A;&#x7A33;&#x5B9A;&#x6027;&#x7684;&#x540E;&#x53F0;&#x4EFB;&#x52A1;&#xFF0C;&#x6700;&#x540E;&#x53D1;&#x73B0;&#x5C45;&#x7136;&#x8FD8;&#x8981;&#x8FDB;&#x884C;&#x7248;&#x672C;&#x517C;&#x5BB9;&#x3002;&#x517C;&#x5BB9;&#x6027;&#x4E0E;&#x5B9E;&#x73B0;&#x6027;&#x8FDB;&#x4E00;&#x6B65;&#x52A0;&#x5927;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x6709;&#x6CA1;&#x6709;&#x7EDF;&#x4E00;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x5462;&#xFF1F;&#x5F53;&#x7136;&#x6709;&#xFF0C;&#x5B83;&#x5C31;&#x662F;WorkManager&#xFF0C;&#x5B83;&#x7684;&#x6838;&#x5FC3;&#x539F;&#x7406;&#x4F7F;&#x7528;&#x7684;&#x5C31;&#x662F;&#x4E0A;&#x9762;&#x6240;&#x5206;&#x6790;&#x7684;&#x7ED3;&#x5408;&#x4F53;&#x3002;</p>\n<p>&#x4ED6;&#x4F1A;&#x7ED3;&#x5408;&#x7248;&#x672C;&#x81EA;&#x52A8;&#x4F7F;&#x7528;&#x6700;&#x4F73;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF0C;&#x540C;&#x65F6;&#x8FD8;&#x4F1A;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x4FBF;&#x5229;&#x64CD;&#x4F5C;&#xFF0C;&#x4F8B;&#x5982;&#x72B6;&#x6001;&#x76D1;&#x542C;&#x3001;&#x94FE;&#x5F0F;&#x8BF7;&#x6C42;&#x7B49;&#x7B49;&#x3002;</p>\n<p>WorkManager&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x6211;&#x5C06;&#x5176;&#x5206;&#x4E3A;&#x4EE5;&#x4E0B;&#x51E0;&#x6B65;&#xFF1A;</p>\n<ol>\n<li>&#x6784;&#x5EFA;Work</li>\n<li>&#x914D;&#x7F6E;WorkRequest</li>\n<li>&#x6DFB;&#x52A0;&#x5230;WorkContinuation&#x4E2D;</li>\n<li>&#x83B7;&#x53D6;&#x54CD;&#x5E94;&#x7ED3;&#x679C;</li>\n</ol>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x901A;&#x8FC7;Demo&#x9010;&#x6B65;&#x4E86;&#x89E3;&#x3002;</p>\n<h2 id=\"&#x6784;&#x5EFA;Work\"><a href=\"#&#x6784;&#x5EFA;Work\" class=\"headerlink\" title=\"&#x6784;&#x5EFA;Work\"></a>&#x6784;&#x5EFA;Work</h2><p>WorkManager&#x6BCF;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x90FD;&#x662F;&#x7531;Work&#x6784;&#x6210;&#xFF0C;&#x6240;&#x4EE5;Work&#x662F;&#x4EFB;&#x52A1;&#x5177;&#x4F53;&#x6267;&#x884C;&#x7684;&#x6838;&#x5FC3;&#x6240;&#x5728;&#x3002;&#x65E2;&#x7136;&#x662F;&#x6838;&#x5FC3;&#x6240;&#x5728;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x8BA4;&#x4E3A;&#x5B83;&#x4F1A;&#x975E;&#x5E38;&#x96BE;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x6070;&#x6070;&#x76F8;&#x53CD;&#xFF0C;&#x5B83;&#x7684;&#x5B9E;&#x73B0;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x4F60;&#x53EA;&#x9700;&#x5B9E;&#x73B0;&#x5B83;&#x7684;<strong>doWork</strong>&#x65B9;&#x6CD5;&#x5373;&#x53EF;&#x3002;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x6765;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x6E05;&#x9664;&#x76F8;&#x5173;&#x76EE;&#x5F55;&#x4E0B;&#x7684;.png&#x56FE;&#x7247;&#x7684;Work</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CleanUpWorker</span></span>(context: Context, workerParams: WorkerParameters) : Worker(context, workerParams) {</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">doWork</span><span class=\"params\">()</span></span>: Result {</span><br><span class=\"line\">        <span class=\"keyword\">val</span> outputDir = File(applicationContext.filesDir, Constants.OUTPUT_PATH)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (outputDir.exists()) {</span><br><span class=\"line\">            <span class=\"keyword\">val</span> fileLists = outputDir.listFiles()</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (file <span class=\"keyword\">in</span> fileLists) {</span><br><span class=\"line\">                <span class=\"keyword\">val</span> fileName = file.name</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!TextUtils.isEmpty(fileName) &amp;&amp; fileName.endsWith(<span class=\"string\">&quot;.png&quot;</span>)) {</span><br><span class=\"line\">                    file.delete()</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Result.success()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x6709;&#x4EE3;&#x7801;&#x90FD;&#x5728;doWork&#x4E2D;&#xFF0C;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#x4E5F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF1A;&#x627E;&#x5230;&#x76F8;&#x5173;&#x76EE;&#x5F55;&#xFF0C;&#x7136;&#x540E;&#x9010;&#x4E00;&#x5224;&#x65AD;&#x76EE;&#x5F55;&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x4E3A;.png&#x56FE;&#x7247;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x5C31;&#x5220;&#x9664;&#x3002;</p>\n<p>&#x4EE5;&#x4E0A;&#x662F;&#x903B;&#x8F91;&#x4EE3;&#x7801;&#xFF0C;&#x5173;&#x952E;&#x70B9;&#x662F;&#x8FD4;&#x56DE;&#x503C;Result.success()&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;Result&#x7C7B;&#x578B;&#xFF0C;&#x53EF;&#x7528;&#x503C;&#x6709;&#x4E09;&#x4E2A;</p>\n<ol>\n<li>Result.success(): &#x6210;&#x529F;</li>\n<li>Result.failure(): &#x5931;&#x8D25;</li>\n<li>Result.retry(): &#x91CD;&#x8BD5;</li>\n</ol>\n<p>&#x5BF9;&#x4E8E;success&#x4E0E;failure&#xFF0C;&#x5B83;&#x8FD8;&#x652F;&#x6301;&#x4F20;&#x9012;Data&#x7C7B;&#x578B;&#x7684;&#x503C;&#xFF0C;Data&#x5185;&#x90E8;&#x662F;&#x4E00;&#x4E2A;Map&#x6765;&#x7BA1;&#x7406;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5BF9;&#x4E8E;kotlin&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;workDataOf</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">return</span> Result.success(workDataOf(Constants.KEY_IMAGE_URI to outputFileUri.toString()))</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x4F20;&#x9012;&#x7684;&#x503C;&#x5C06;&#x653E;&#x5165;OutputData&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x94FE;&#x5F0F;&#x8BF7;&#x6C42;&#x4E2D;&#x4F20;&#x9012;&#xFF0C;&#x4E0E;&#x6700;&#x7EC8;&#x7684;&#x54CD;&#x5E94;&#x7ED3;&#x679C;&#x83B7;&#x53D6;&#x3002;&#x5176;&#x5B9E;&#x672C;&#x8D28;&#x662F;WorkManager&#x7ED3;&#x5408;&#x4E86;Room&#xFF0C;&#x5C06;&#x6570;&#x636E;&#x4FDD;&#x5B58;&#x5728;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x3002;</p>\n<p>&#x8FD9;&#x4E00;&#x6B65;&#x8981;&#x70B9;&#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x4E0B;&#x9762;&#x8FDB;&#x5165;&#x4E0B;&#x4E00;&#x6B65;&#x3002;</p>\n<h2 id=\"&#x914D;&#x7F6E;WorkRequest\"><a href=\"#&#x914D;&#x7F6E;WorkRequest\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;WorkRequest\"></a>&#x914D;&#x7F6E;WorkRequest</h2><p>WorkManager&#x4E3B;&#x8981;&#x662F;&#x901A;&#x8FC7;WorkRequest&#x6765;&#x914D;&#x7F6E;&#x4EFB;&#x52A1;&#x7684;&#xFF0C;&#x800C;&#x5B83;&#x7684;WorkRequest&#x79CD;&#x7C7B;&#x5305;&#x62EC;&#xFF1A;</p>\n<ol>\n<li>OneTimeWorkRequest</li>\n<li>PeriodicWorkRequest</li>\n</ol>\n<h3 id=\"OneTimeWorkRequest\"><a href=\"#OneTimeWorkRequest\" class=\"headerlink\" title=\"OneTimeWorkRequest\"></a>OneTimeWorkRequest</h3><p>&#x9996;&#x5148;OneTimeWorkRequest&#x662F;&#x4F5C;&#x7528;&#x4E8E;&#x4E00;&#x6B21;&#x6027;&#x4EFB;&#x52A1;&#xFF0C;&#x5373;&#x4EFB;&#x52A1;&#x53EA;&#x6267;&#x884C;&#x4E00;&#x6B21;&#xFF0C;&#x4E00;&#x65E6;&#x6267;&#x884C;&#x5B8C;&#x5C31;&#x81EA;&#x52A8;&#x7ED3;&#x675F;&#x3002;&#x5B83;&#x7684;&#x6784;&#x5EFA;&#x4E5F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF1A;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">val</span> cleanUpRequest = OneTimeWorkRequestBuilder&lt;CleanUpWorker&gt;().build()</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x5C31;&#x914D;&#x7F6E;&#x4E86;&#x4E0E;CleanUpWorker&#x76F8;&#x5173;&#x7684;WorkRequest&#xFF0C;&#x800C;&#x4E14;&#x662F;&#x4E00;&#x6B21;&#x6027;&#x7684;&#x3002;</p>\n<p>&#x5728;&#x914D;&#x7F6E;WorkRequest&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x5BF9;&#x5176;&#x6DFB;&#x52A0;&#x522B;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x4F8B;&#x5982;&#x6DFB;&#x52A0;tag&#x3001;&#x4F20;&#x5165;inputData&#x4E0E;&#x6DFB;&#x52A0;constraint&#x7EA6;&#x675F;&#x6761;&#x4EF6;&#x7B49;&#x7B49;&#x3002;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">val</span> constraint = Constraints.Builder()</span><br><span class=\"line\">        .setRequiredNetworkType(NetworkType.CONNECTED)</span><br><span class=\"line\">        .build()</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">val</span> blurRequest = OneTimeWorkRequestBuilder&lt;BlurImageWorker&gt;()</span><br><span class=\"line\">        .setInputData(workDataOf(Constants.KEY_IMAGE_RES_ID to R.drawable.yaodaoji))</span><br><span class=\"line\">        .addTag(Constants.TAG_BLUR_IMAGE)</span><br><span class=\"line\">        .setConstraints(constraint)</span><br><span class=\"line\">        .build()</span><br></pre></td></tr></table></figure>\n<p>&#x6DFB;&#x52A0;tag&#x662F;&#x4E3A;&#x4E86;&#x6253;&#x4E0A;&#x6807;&#x7B7E;&#xFF0C;&#x4EE5;&#x4FBF;&#x540E;&#x7EED;&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#xFF1B;&#x4F20;&#x5165;&#x7684;inputData&#x53EF;&#x4EE5;&#x5728;BlurImageWork&#x4E2D;&#x83B7;&#x53D6;&#x4F20;&#x5165;&#x7684;&#x503C;&#xFF1B;&#x6DFB;&#x52A0;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;constraint&#x7EA6;&#x675F;&#x6761;&#x4EF6;&#xFF0C;&#x4EE3;&#x8868;&#x53EA;&#x6709;&#x5728;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x7684;&#x72B6;&#x6001;&#x4E0B;&#x624D;&#x4F1A;&#x89E6;&#x53D1;&#x8BE5;WorkRequest&#x3002;</p>\n<p>&#x800C;BlurImageWork&#x7684;&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"keyword\">suspend</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">doWork</span><span class=\"params\">()</span></span>: Result {</span><br><span class=\"line\">    <span class=\"keyword\">val</span> resId = inputData.getInt(Constants.KEY_IMAGE_RES_ID, -<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (resId != -<span class=\"number\">1</span>) {</span><br><span class=\"line\">        <span class=\"keyword\">val</span> bitmap = BitmapFactory.decodeResource(applicationContext.resources, resId)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> outputBitmap = apply(bitmap)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> outputFileUri = writeToFile(outputBitmap)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Result.success(workDataOf(Constants.KEY_IMAGE_URI to outputFileUri.toString()))</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Result.failure()</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;doWork&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;InputData&#x6765;&#x83B7;&#x53D6;&#x4E0A;&#x8FF0;blurRequest&#x4E2D;&#x4F20;&#x5165;&#x7684;InputData&#x6570;&#x636E;&#x3002;&#x7136;&#x540E;&#x901A;&#x8FC7;apply&#x6765;&#x5904;&#x7406;&#x56FE;&#x7247;&#xFF0C;&#x6700;&#x540E;&#x4F7F;&#x7528;writeToFile&#x5199;&#x5165;&#x5230;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x8DEF;&#x5F84;&#x3002;</p>\n<p>&#x7531;&#x4E8E;&#x7BC7;&#x5E45;&#x6709;&#x9650;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x4E00;&#x4E00;&#x5C55;&#x5F00;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x67E5;&#x770B;<a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">&#x6E90;&#x7801;</a></p>\n<h3 id=\"PeriodicWorkRequest\"><a href=\"#PeriodicWorkRequest\" class=\"headerlink\" title=\"PeriodicWorkRequest\"></a>PeriodicWorkRequest</h3><p>PeriodicWorkRequest&#x662F;&#x53EF;&#x4EE5;&#x5468;&#x671F;&#x6027;&#x7684;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#xFF0C;&#x5B83;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x4E0E;&#x914D;&#x7F6E;&#x548C;OneTimeWorkRequest&#x4E00;&#x81F4;&#x3002;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">val</span> constraint = Constraints.Builder()</span><br><span class=\"line\">        .setRequiredNetworkType(NetworkType.CONNECTED)</span><br><span class=\"line\">        .build()</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">// at least 15 minutes</span></span><br><span class=\"line\">mPeriodicRequest = PeriodicWorkRequestBuilder&lt;DataSourceWorker&gt;(<span class=\"number\">15</span>, TimeUnit.MINUTES)</span><br><span class=\"line\">        .setConstraints(constraint)</span><br><span class=\"line\">        .addTag(Constants.TAG_DATA_SOURCE)</span><br><span class=\"line\">        .build()</span><br></pre></td></tr></table></figure>\n<p>&#x4E0D;&#x8FC7;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF1A;&#x5B83;&#x7684;&#x5468;&#x671F;&#x95F4;&#x9694;&#x6700;&#x5C11;&#x4E3A;15&#x5206;&#x949F;&#x3002;</p>\n<h2 id=\"&#x6DFB;&#x52A0;&#x5230;WorkContinuation&#x4E2D;\"><a href=\"#&#x6DFB;&#x52A0;&#x5230;WorkContinuation&#x4E2D;\" class=\"headerlink\" title=\"&#x6DFB;&#x52A0;&#x5230;WorkContinuation&#x4E2D;\"></a>&#x6DFB;&#x52A0;&#x5230;WorkContinuation&#x4E2D;</h2><p>&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5C06;WorkRequest&#x914D;&#x7F6E;&#x597D;&#x4E86;&#xFF0C;&#x5269;&#x4E0B;&#x8981;&#x505A;&#x7684;&#x662F;&#x5C06;&#x5176;&#x52A0;&#x5165;&#x5230;work&#x5DE5;&#x4F5C;&#x94FE;&#x4E2D;&#x8FDB;&#x884C;&#x6267;&#x884C;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x5355;&#x4E2A;&#x7684;WorkRequest&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x901A;&#x8FC7;WorkManager&#x7684;enqueue&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">val</span> mWorkManager: WorkManager = WorkManager.getInstance(application)</span><br><span class=\"line\"> </span><br><span class=\"line\">mWorkManager.enqueue(cleanUpRequest)</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x4F60;&#x60F3;&#x4F7F;&#x7528;&#x94FE;&#x5F0F;&#x5DE5;&#x4F5C;&#xFF0C;&#x53EA;&#x9700;&#x8C03;&#x7528;beginWith&#x6216;&#x8005;beginUniqueWork&#x65B9;&#x6CD5;&#x5373;&#x53EF;&#x3002;&#x5176;&#x5B9E;&#x5B83;&#x4EEC;&#x672C;&#x8D28;&#x90FD;&#x662F;&#x5B9E;&#x4F8B;&#x5316;&#x4E86;&#x4E00;&#x4E2A;WorkContinuationImpl&#xFF0C;&#x53EA;&#x662F;&#x8C03;&#x7528;&#x4E86;&#x4E0D;&#x540C;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x3002;&#x800C;&#x6700;&#x7EC8;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E3A;&#xFF1A;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WorkContinuationImpl(<span class=\"meta\">@NonNull</span> WorkManagerImpl workManagerImpl,</span><br><span class=\"line\">        String name,</span><br><span class=\"line\">        ExistingWorkPolicy existingWorkPolicy,</span><br><span class=\"line\">        <span class=\"meta\">@NonNull</span> List&lt;? extends WorkRequest&gt; work,</span><br><span class=\"line\">        <span class=\"meta\">@Nullable</span> List&lt;WorkContinuationImpl&gt; parents) { }</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;beginWith&#x65B9;&#x6CD5;&#x53EA;&#x9700;&#x4F20;&#x5165;WorkRequest</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">val</span> workContinuation = mWorkManager.beginWith(cleanUpWork)</span><br></pre></td></tr></table></figure>\n<p>beginUniqueWork&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x72EC;&#x4E00;&#x65E0;&#x4E8C;&#x7684;&#x94FE;&#x5F0F;&#x8BF7;&#x6C42;&#x3002;&#x4F7F;&#x7528;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF1A;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">val</span> workContinuation = mWorkManager.beginUniqueWork(Constants.IMAGE_UNIQUE_WORK, ExistingWorkPolicy.REPLACE, cleanUpWork)</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x8BBE;&#x7F6E;&#x8BE5;&#x94FE;&#x5F0F;&#x8BF7;&#x6C42;&#x7684;name&#xFF1B;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;ExistingWorkPolicy&#x662F;&#x8BBE;&#x7F6E;name&#x76F8;&#x540C;&#x65F6;&#x7684;&#x8868;&#x73B0;&#xFF0C;&#x5B83;&#x4E09;&#x4E2A;&#x503C;&#xFF0C;&#x5206;&#x522B;&#x4E3A;&#xFF1A;</p>\n<ol>\n<li>REPLACE: &#x5F53;&#x6709;&#x76F8;&#x540C;name&#x4E14;&#x672A;&#x5B8C;&#x6210;&#x7684;&#x94FE;&#x5F0F;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5C06;&#x539F;&#x6765;&#x7684;&#x8FDB;&#x5EA6;&#x53D6;&#x6D88;&#x5E76;&#x5220;&#x9664;&#xFF0C;&#x91CD;&#x65B0;&#x52A0;&#x5165;&#x65B0;&#x7684;&#x94FE;&#x5F0F;&#x8BF7;&#x6C42;</li>\n<li>KEEP: &#x5F53;&#x6709;&#x76F8;&#x540C;name&#x4E14;&#x672A;&#x5B8C;&#x6210;&#x7684;&#x94FE;&#x5F0F;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x94FE;&#x5F0F;&#x8BF7;&#x6C42;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;</li>\n<li>APPEND: &#x5F53;&#x6709;&#x76F8;&#x540C;name&#x4E14;&#x672A;&#x5B8C;&#x6210;&#x7684;&#x94FE;&#x5F0F;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5C06;&#x65B0;&#x7684;&#x94FE;&#x5F0F;&#x8BF7;&#x6C42;&#x8FFD;&#x52A0;&#x5230;&#x539F;&#x6765;&#x7684;&#x5B50;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x5373;&#x5F53;&#x539F;&#x6765;&#x7684;&#x94FE;&#x5F0F;&#x8BF7;&#x6C42;&#x5168;&#x90E8;&#x6267;&#x884C;&#x540E;&#x624D;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x3002;</li>\n</ol>\n<p>&#x800C;&#x4E0D;&#x7BA1;&#x662F;beginWith&#x8FD8;&#x662F;beginUniqueWork&#xFF0C;&#x5B83;&#x90FD;&#x4F1A;&#x8FD4;&#x56DE;WorkContinuation&#x5BF9;&#x8C61;&#xFF0C;&#x901A;&#x8FC7;&#x8BE5;&#x5BF9;&#x8C61;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x540E;&#x7EED;&#x4EFB;&#x52A1;&#x52A0;&#x5165;&#x5230;&#x94FE;&#x5F0F;&#x8BF7;&#x6C42;&#x4E2D;&#x3002;&#x4F8B;&#x5982;&#x5C06;&#x4E0A;&#x9762;&#x7684;cleanUpRequest(&#x6E05;&#x9664;)&#x3001;blurRequest(&#x56FE;&#x7247;&#x6A21;&#x7CCA;&#x5904;&#x7406;)&#x4E0E;saveRequest(&#x4FDD;&#x5B58;)&#x4E32;&#x884C;&#x8D77;&#x6765;&#x6267;&#x884C;&#xFF0C;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">val</span> cleanUpRequest = OneTimeWorkRequestBuilder&lt;CleanUpWorker&gt;().build()</span><br><span class=\"line\"><span class=\"keyword\">val</span> workContinuation = mWorkManager.beginUniqueWork(Constants.IMAGE_UNIQUE_WORK, ExistingWorkPolicy.REPLACE, cleanUpRequest)</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">val</span> blurRequest = OneTimeWorkRequestBuilder&lt;BlurImageWorker&gt;()</span><br><span class=\"line\">        .setInputData(workDataOf(Constants.KEY_IMAGE_RES_ID to R.drawable.yaodaoji))</span><br><span class=\"line\">        .addTag(Constants.TAG_BLUR_IMAGE)</span><br><span class=\"line\">        .build()</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">val</span> saveRequest = OneTimeWorkRequestBuilder&lt;SaveImageToMediaWorker&gt;()</span><br><span class=\"line\">        .addTag(Constants.TAG_SAVE_IMAGE)</span><br><span class=\"line\">        .build()</span><br><span class=\"line\"> </span><br><span class=\"line\">workContinuation.then(blurRequest)</span><br><span class=\"line\">        .then(saveRequest)</span><br><span class=\"line\">        .enqueue()</span><br></pre></td></tr></table></figure>\n<p>&#x9664;&#x4E86;&#x4E32;&#x884C;&#x6267;&#x884C;&#xFF0C;&#x8FD8;&#x652F;&#x6301;&#x5E76;&#x884C;&#x3002;&#x4F8B;&#x5982;&#x5C06;cleanUpRequest&#x4E0E;blurRequest&#x5E76;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x518D;&#x4E0E;saveRequest&#x4E32;&#x884C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val left = mWorkManager.beginWith(cleanUpRequest)</span><br><span class=\"line\">val right = mWorkManager.beginWith(blurRequest)</span><br><span class=\"line\"> </span><br><span class=\"line\">WorkContinuation.combine(arrayListOf(left, right))</span><br><span class=\"line\">        .then(saveRequest)</span><br><span class=\"line\">        .enqueue()</span><br></pre></td></tr></table></figure>\n<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF1A;&#x5982;&#x679C;&#x4F60;&#x7684;WorkRequest&#x662F;PeriodicWorkRequest&#x7C7B;&#x578B;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x4E0D;&#x652F;&#x6301;&#x5EFA;&#x7ACB;&#x94FE;&#x5F0F;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x4E86;&#x3002;&#x7B80;&#x5355;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x5468;&#x671F;&#x6027;&#x7684;&#x4EFB;&#x52A1;&#x539F;&#x5219;&#x4E0A;&#x662F;&#x6CA1;&#x6709;&#x7EC8;&#x6B62;&#x7684;&#xFF0C;&#x662F;&#x4E2A;&#x95ED;&#x73AF;&#xFF0C;&#x4E5F;&#x5C31;&#x4E0D;&#x5B58;&#x5728;&#x6240;&#x8C13;&#x7684;&#x94FE;&#x4E86;&#x3002;</p>\n<h2 id=\"&#x83B7;&#x53D6;&#x54CD;&#x5E94;&#x7ED3;&#x679C;\"><a href=\"#&#x83B7;&#x53D6;&#x54CD;&#x5E94;&#x7ED3;&#x679C;\" class=\"headerlink\" title=\"&#x83B7;&#x53D6;&#x54CD;&#x5E94;&#x7ED3;&#x679C;\"></a>&#x83B7;&#x53D6;&#x54CD;&#x5E94;&#x7ED3;&#x679C;</h2><p>&#x8FD9;&#x5C31;&#x5230;&#x6700;&#x540E;&#x4E00;&#x6B65;&#x4E86;&#xFF0C;&#x83B7;&#x53D6;&#x54CD;&#x5E94;&#x7ED3;&#x679C;WorkInfo&#x3002;WorkManager&#x652F;&#x6301;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x83B7;&#x53D6;&#x54CD;&#x5E94;&#x7ED3;&#x679C;</p>\n<ol>\n<li>Request.id: WorkRequest&#x7684;id</li>\n<li>Tag.name: WorkRequest&#x4E2D;&#x8BBE;&#x7F6E;&#x7684;tag</li>\n</ol>\n<p>&#x540C;&#x65F6;&#x8FD4;&#x56DE;&#x7684;WorkInfo&#x8FD8;&#x652F;&#x6301;LiveData&#x6570;&#x636E;&#x683C;&#x5F0F;&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x8981;&#x76D1;&#x542C;&#x4E0A;&#x8FF0;blurRequest&#x4E0E;saveRequest&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x4F7F;&#x7528;tag&#x6765;&#x83B7;&#x53D6;&#xFF1A;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ViewModel</span></span><br><span class=\"line\"><span class=\"keyword\">internal</span> <span class=\"keyword\">val</span> blurWorkInfo: LiveData&lt;List&lt;WorkInfo&gt;&gt;</span><br><span class=\"line\"><span class=\"keyword\">get</span>() = mWorkManager.getWorkInfosByTagLiveData(Constants.TAG_BLUR_IMAGE)</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">internal</span> <span class=\"keyword\">val</span> saveWorkInfo: LiveData&lt;List&lt;WorkInfo&gt;&gt;</span><br><span class=\"line\"><span class=\"keyword\">get</span>() = mWorkManager.getWorkInfosByTagLiveData(Constants.TAG_SAVE_IMAGE)</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">// Activity</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">addObserver</span><span class=\"params\">()</span></span> {</span><br><span class=\"line\">    vm.blurWorkInfo.observe(<span class=\"keyword\">this</span>, Observer {</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (it == <span class=\"literal\">null</span> || it.isEmpty()) <span class=\"keyword\">return</span><span class=\"symbol\">@Observer</span></span><br><span class=\"line\">        with(it[<span class=\"number\">0</span>]) {</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!state.isFinished) {</span><br><span class=\"line\">                vm.processEnable.value = <span class=\"literal\">false</span></span><br><span class=\"line\">            } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">                vm.processEnable.value = <span class=\"literal\">true</span></span><br><span class=\"line\">                <span class=\"keyword\">val</span> uri = outputData.getString(Constants.KEY_IMAGE_URI)</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!TextUtils.isEmpty(uri)) {</span><br><span class=\"line\">                    vm.blurUri.value = Uri.parse(uri)</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    })</span><br><span class=\"line\"> </span><br><span class=\"line\">    vm.saveWorkInfo.observe(<span class=\"keyword\">this</span>, Observer {</span><br><span class=\"line\">        saveImageUri = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (it == <span class=\"literal\">null</span> || it.isEmpty()) <span class=\"keyword\">return</span><span class=\"symbol\">@Observer</span></span><br><span class=\"line\">        with(it[<span class=\"number\">0</span>]) {</span><br><span class=\"line\">            saveImageUri = outputData.getString(Constants.KEY_SHOW_IMAGE_URI)</span><br><span class=\"line\">            vm.showImageEnable.value = state.isFinished &amp;&amp; !TextUtils.isEmpty(saveImageUri)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    })</span><br><span class=\"line\"> </span><br><span class=\"line\">\t......</span><br><span class=\"line\"> \t......</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x518D;&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x901A;&#x8FC7;id&#x83B7;&#x53D6;&#x7684;&#xFF1A;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ViewModel</span></span><br><span class=\"line\">   <span class=\"keyword\">internal</span> <span class=\"keyword\">val</span> dataSourceInfo: MediatorLiveData&lt;WorkInfo&gt; = MediatorLiveData()</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">addSource</span><span class=\"params\">()</span></span> {</span><br><span class=\"line\">       <span class=\"keyword\">val</span> periodicWorkInfo = mWorkManager.getWorkInfoByIdLiveData(mPeriodicRequest.id)</span><br><span class=\"line\">       dataSourceInfo.addSource(periodicWorkInfo) {</span><br><span class=\"line\">           dataSourceInfo.value = it</span><br><span class=\"line\">       }</span><br><span class=\"line\">   }</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">// Activity</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">addObserver</span><span class=\"params\">()</span></span> {</span><br><span class=\"line\">       vm.dataSourceInfo.observe(<span class=\"keyword\">this</span>, Observer {</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (it == <span class=\"literal\">null</span>) <span class=\"keyword\">return</span><span class=\"symbol\">@Observer</span></span><br><span class=\"line\">           with(it) {</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (state == WorkInfo.State.ENQUEUED) {</span><br><span class=\"line\">                   <span class=\"keyword\">val</span> result = outputData.getString(Constants.KEY_DATA_SOURCE)</span><br><span class=\"line\">                   <span class=\"keyword\">if</span> (!TextUtils.isEmpty(result)) {</span><br><span class=\"line\">                       Toast.makeText(<span class=\"keyword\">this</span><span class=\"symbol\">@OtherWorkerActivity</span>, result, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">                   }</span><br><span class=\"line\">               }</span><br><span class=\"line\">           }</span><br><span class=\"line\">       })</span><br><span class=\"line\">   }</span><br></pre></td></tr></table></figure>\n<p>&#x7ED3;&#x5408;LiveData&#x4F7F;&#x7528;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x5462;&#xFF1F; WorkInfo&#x83B7;&#x53D6;&#x7684;&#x672C;&#x8D28;&#x662F;&#x901A;&#x8FC7;&#x64CD;&#x4F5C;Room&#x6570;&#x636E;&#x5E93;&#x6765;&#x83B7;&#x53D6;&#x3002;&#x5728;&#x6587;&#x7AE0;&#x7684;Work&#x90E8;&#x5206;&#x5DF2;&#x7ECF;&#x63D0;&#x5230;&#xFF0C;&#x5728;&#x6267;&#x884C;&#x5B8C;Work&#x4EFB;&#x52A1;&#x4E4B;&#x540E;&#x4F20;&#x9012;&#x7684;&#x6570;&#x636E;&#x5C06;&#x4F1A;&#x4FDD;&#x5B58;&#x5230;Room&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x3002;</p>\n<p>&#x6240;&#x4EE5;WorkManager&#x4E0E;AAC&#x7684;&#x7ED3;&#x5408;&#x5EA6;&#x975E;&#x5E38;&#x9AD8;&#xFF0C;&#x76EE;&#x7684;&#x4E5F;&#x662F;&#x81F4;&#x529B;&#x4E8E;&#x4E3A;&#x6211;&#x4EEC;&#x5F00;&#x53D1;&#x8005;&#x63D0;&#x4F9B;&#x4E00;&#x5957;&#x5B8C;&#x6574;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x8BF4;&#x660E;Google&#x5BF9;AAC&#x6846;&#x67B6;&#x7684;&#x91CD;&#x89C6;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x672A;&#x4E86;&#x89E3;AAC&#xFF0C;&#x63A8;&#x8350;&#x4F60;&#x9605;&#x8BFB;&#x6211;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247483702&amp;idx=1&amp;sn=dc1a5cefe847412bd276cc1eff0b2b88&amp;chksm=e8e0f8a6df9771b0a003edcfc0b25c0e58418ba7fd3ec34064479d444a96958ee2efc7fc92c1&amp;token=1605536465&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Room</a><br><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247483706&amp;idx=1&amp;sn=4e5f7bb015b46d3ece8e3eff6437f8af&amp;chksm=e8e0f8aadf9771bc67aca66049f852165700c0f3c2e8ba38a8f83875dcc205089f402e76089d&amp;token=1605536465&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">LiveData</a><br><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247483714&amp;idx=1&amp;sn=8d2137f92d0f8561cbf03c75456f122c&amp;chksm=e8e0f8d2df9771c41caa4f5cb285c6c99ba115e8c20ed8356eccdf998a640f01341028b8c9df&amp;token=1605536465&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">Lifecycle</a><br><a href=\"https://mp.weixin.qq.com/s?__biz=MzIzNTc5NDY4Nw==&amp;mid=2247483721&amp;idx=1&amp;sn=7228254b03acde76c737b110f7619f73&amp;chksm=e8e0f8d9df9771cfe8b8d088d531efa9fecf8825586fb7f307572cacc45721a6dc577a69bca9&amp;token=1605536465&amp;lang=zh_CN#rd\" target=\"_blank\" rel=\"noopener\">ViewModel</a></p>\n<p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x5C06;&#x4E0A;&#x9762;&#x7684;&#x51E0;&#x4E2A;WorkRequest&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x6267;&#x884C;&#xFF0C;&#x770B;&#x4E0B;&#x5B83;&#x4EEC;&#x7684;&#x6700;&#x7EC8;&#x6548;&#x679C;&#xFF1A;</p>\n<p><img src=\"/2019/08/12/WorkManager&#x4ECE;&#x5165;&#x95E8;&#x5230;&#x5B9E;&#x8DF5;&#xFF0C;&#x6709;&#x8FD9;&#x4E00;&#x7BC7;&#x5C31;&#x591F;&#x4E86;/WorkManager&#x4ECE;&#x5165;&#x95E8;&#x5230;&#x5B9E;&#x8DF5;&#xFF0C;&#x6709;&#x8FD9;&#x4E00;&#x7BC7;&#x5C31;&#x591F;&#x4E86;_1.gif\" alt></p>\n<p>&#x901A;&#x8FC7;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x5E0C;&#x671B;&#x4F60;&#x80FD;&#x591F;&#x719F;&#x6089;&#x8FD0;&#x7528;WorkManager&#x3002;&#x5982;&#x679C;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5BF9;&#x4F60;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x987A;&#x624B;&#x70B9;&#x8D5E;&#x3001;&#x5173;&#x6CE8;&#x4E00;&#x6CE2;&#xFF0C;&#x8FD9;&#x662F;&#x5BF9;&#x6211;&#x6700;&#x5927;&#x7684;&#x9F13;&#x52B1;&#xFF01;</p>\n<h2 id=\"&#x9879;&#x76EE;&#x5730;&#x5740;\"><a href=\"#&#x9879;&#x76EE;&#x5730;&#x5740;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;&#x5730;&#x5740;\"></a>&#x9879;&#x76EE;&#x5730;&#x5740;</h2><h3 id=\"Android&#x7CBE;&#x534E;&#x5F55;\"><a href=\"#Android&#x7CBE;&#x534E;&#x5F55;\" class=\"headerlink\" title=\"Android&#x7CBE;&#x534E;&#x5F55;\"></a>Android&#x7CBE;&#x534E;&#x5F55;</h3><p>&#x8BE5;&#x5E93;&#x7684;&#x76EE;&#x7684;&#x662F;&#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">Android&#x7CBE;&#x534E;&#x5F55;</a></p>\n<p><a href=\"https://www.rousetime.com/archives/\">blog</a></p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/7/31/16c45287d667775c?w=258&amp;h=258&amp;f=webp&amp;s=5898\" alt></p>\n","categories":["android"],"tags":["Android Architecture Components"]},{"title":"Paging在RecyclerView中的应用，有这一篇就够了","url":"https://www.rousetime.com/2019/07/25/Paging在RecyclerView中的应用，有这一篇就够了/","content":"<h2 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h2><p>AAC&#x662F;&#x975E;&#x5E38;&#x4E0D;&#x9519;&#x7684;&#x4E00;&#x5957;&#x6846;&#x67B6;&#x7EC4;&#x4EF6;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x672A;&#x8FDB;&#x884C;&#x4E86;&#x89E3;&#xFF0C;&#x63A8;&#x8350;&#x4F60;&#x9605;&#x8BFB;&#x6211;&#x4E4B;&#x524D;&#x7684;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#xFF1A;</p>\n<p><a href=\"https://www.rousetime.com/2018/06/07/Android-Architecture-Components-Part1-Room/\">Android Architecture Components Part1:Room</a></p>\n<p><a href=\"https://www.rousetime.com/2018/06/10/Android-Architecture-Components-Part2-LiveData/\">Android Architecture Components Part2:LiveData</a></p>\n<p><a href=\"https://www.rousetime.com/2018/06/14/Android-Architecture-Components-Part3-Lifecycle/\">Android Architecture Components Part3:Lifecycle</a></p>\n<p><a href=\"https://www.rousetime.com/2018/06/22/Android-Architecture-Components-Part4-ViewModel/\">Android Architecture Components Part4:ViewModel</a></p>\n<p>&#x7ECF;&#x8FC7;&#x4E00;&#x5E74;&#x7684;&#x53D1;&#x5C55;&#xFF0C;AAC&#x53C8;&#x63A8;&#x51FA;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x65B0;&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x66F4;&#x5FEB;&#x7684;&#x8FDB;&#x884C;&#x9879;&#x76EE;&#x6846;&#x67B6;&#x7684;&#x6784;&#x5EFA;&#x4E0E;&#x5F00;&#x53D1;&#x3002;&#x8FD9;&#x6B21;&#x4E3B;&#x8981;&#x6D89;&#x53CA;&#x7684;&#x662F;&#x5BF9;Paging&#x8FD0;&#x7528;&#x7684;&#x5168;&#x9762;&#x4ECB;&#x7ECD;&#xFF0C;&#x76F8;&#x4FE1;&#x4F60;&#x9605;&#x8BFB;&#x4E86;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E4B;&#x540E;&#x5C06;&#x5BF9;Paging&#x7684;&#x8FD0;&#x7528;&#x4E86;&#x5982;&#x6307;&#x638C;&#x3002;</p>\n<p>Paging&#x4E13;&#x6CE8;&#x4E8E;&#x6709;&#x5927;&#x91CF;&#x6570;&#x636E;&#x8BF7;&#x6C42;&#x7684;&#x5217;&#x8868;&#x5904;&#x7406;&#xFF0C;&#x8BA9;&#x5F00;&#x53D1;&#x8005;&#x65E0;&#x9700;&#x5173;&#x5FC3;&#x6570;&#x636E;&#x7684;&#x5206;&#x9875;&#x903B;&#x8F91;&#xFF0C;&#x5C06;&#x6570;&#x636E;&#x7684;&#x83B7;&#x53D6;&#x903B;&#x8F91;&#x5B8C;&#x5168;&#x4E0E;ui&#x9694;&#x79BB;&#xFF0C;&#x964D;&#x4F4E;&#x9879;&#x76EE;&#x7684;&#x8026;&#x5408;&#x3002;</p>\n<p>&#x4F46;Paging&#x7684;&#x552F;&#x4E00;&#x5C40;&#x9650;&#x6027;&#x662F;&#xFF0C;&#x5B83;&#x9700;&#x8981;&#x4E0E;RecyclerView&#x7ED3;&#x5408;&#x4F7F;&#x7528;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x8981;&#x4F7F;&#x7528;&#x4E13;&#x6709;&#x7684;PagedListAdapter&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#xFF0C;&#x5B83;&#x4F1A;&#x5C06;&#x6570;&#x636E;&#x7EDF;&#x4E00;&#x5C01;&#x88C5;&#x6210;&#x4E00;&#x4E2A;PagedList&#x5BF9;&#x8C61;&#xFF0C;&#x800C;adapter&#x6301;&#x6709;&#x8BE5;&#x5BF9;&#x8C61;&#xFF0C;&#x4E00;&#x5207;&#x6570;&#x636E;&#x7684;&#x66F4;&#x65B0;&#x4E0E;&#x53D8;&#x52A8;&#x90FD;&#x662F;&#x901A;&#x8FC7;PagedList&#x6765;&#x89E6;&#x53D1;&#x3002;</p>\n<p>&#x8FD9;&#x6837;&#x7684;&#x597D;&#x5904;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7ED3;&#x5408;LiveData&#x6216;&#x8005;RxJava&#x6765;&#x5BF9;PagedList&#x5BF9;&#x8C61;&#x7684;&#x521B;&#x5EFA;&#x8FDB;&#x884C;&#x89C2;&#x5BDF;&#xFF0C;&#x4E00;&#x65E6;PagedList&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#xFF0C;&#x53EA;&#x9700;&#x5C06;&#x5176;&#x4F20;&#x5165;&#x7ED9;adapter&#x5373;&#x53EF;&#xFF0C;&#x5269;&#x4E0B;&#x7684;&#x6570;&#x636E;&#x64CD;&#x66F4;&#x65B0;&#x64CD;&#x4F5C;&#x5C06;&#x7531;adapter&#x81EA;&#x52A8;&#x5B8C;&#x6210;&#x3002;&#x76F8;&#x6BD4;&#x4E8E;&#x6B63;&#x5E38;&#x7684;RecyclerView&#x5F00;&#x53D1;&#xFF0C;&#x7B80;&#x5355;&#x4E86;&#x8BB8;&#x591A;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x4E24;&#x4E2A;&#x5177;&#x4F53;&#x5B9E;&#x4F8B;&#x6765;&#x5BF9;Paging&#x8FDB;&#x884C;&#x4E86;&#x89E3;</p>\n<ol>\n<li>Database&#x4E2D;&#x7684;&#x4F7F;&#x7528;</li>\n<li>&#x81EA;&#x5B9A;&#x4E49;DataSource</li>\n</ol>\n<h2 id=\"Database&#x4E2D;&#x7684;&#x4F7F;&#x7528;\"><a href=\"#Database&#x4E2D;&#x7684;&#x4F7F;&#x7528;\" class=\"headerlink\" title=\"Database&#x4E2D;&#x7684;&#x4F7F;&#x7528;\"></a>Database&#x4E2D;&#x7684;&#x4F7F;&#x7528;</h2><p>Paging&#x5728;Database&#x4E2D;&#x7684;&#x4F7F;&#x7528;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x5B83;&#x4E0E;Room&#x7ED3;&#x5408;&#x5C06;&#x64CD;&#x4F5C;&#x7B80;&#x5355;&#x5230;&#x4E86;&#x6781;&#x81F4;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x5C06;&#x5176;&#x5F52;&#x7EB3;&#x4E8E;&#x4E09;&#x6B65;&#x3002;</p>\n<ol>\n<li>&#x4F7F;&#x7528;DataSource.Factory&#x6765;&#x83B7;&#x53D6;Room&#x4E2D;&#x7684;&#x6570;&#x636E;</li>\n<li>&#x4F7F;&#x7528;LiveData&#x6765;&#x89C2;&#x5BDF;PagedList</li>\n<li>&#x4F7F;&#x7528;PagedListAdapter&#x6765;&#x4E0E;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#x4E0E;&#x66F4;&#x65B0;</li>\n</ol>\n<h3 id=\"DataSource-Factory\"><a href=\"#DataSource-Factory\" class=\"headerlink\" title=\"DataSource.Factory\"></a>DataSource.Factory</h3><p>&#x9996;&#x5148;&#x7B2C;&#x4E00;&#x6B65;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F7F;&#x7528;DataSource.Factory&#x62BD;&#x8C61;&#x7C7B;&#x6765;&#x83B7;&#x53D6;Room&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5B83;&#x5185;&#x90E8;&#x53EA;&#x8981;&#x4E00;&#x4E2A;create&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x65E0;&#x9700;&#x5B9E;&#x73B0;&#xFF0C;Room&#x4F1A;&#x81EA;&#x52A8;&#x5E2E;&#x6211;&#x4EEC;&#x521B;&#x5EFA;PositionalDataSource&#x5B9E;&#x4F8B;&#xFF0C;&#x5B83;&#x5C06;&#x4F1A;&#x5B9E;&#x73B0;create&#x65B9;&#x6CD5;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Dao</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ArticleDao</span> </span>{</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// PositionalDataSource</span></span><br><span class=\"line\">    <span class=\"meta\">@Query(<span class=\"meta-string\">&quot;SELECT * FROM article&quot;</span>)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getAll</span><span class=\"params\">()</span></span>: DataSource.Factory&lt;<span class=\"built_in\">Int</span>, ArticleModel&gt;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x62FF;&#x5230;&#x5B9E;&#x73B0;DataSource.Factory&#x62BD;&#x8C61;&#x7684;&#x5B9E;&#x4F8B;&#x5373;&#x53EF;&#x3002;</p>\n<p>&#x7B2C;&#x4E00;&#x6B65;&#x5C31;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x770B;&#x7B2C;&#x4E8C;&#x6B65;</p>\n<h3 id=\"LiveData\"><a href=\"#LiveData\" class=\"headerlink\" title=\"LiveData\"></a>LiveData</h3><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5728;ViewMode&#x4E2D;&#x8C03;&#x7528;&#x4E0A;&#x9762;&#x7684;getAll&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x7684;&#x6587;&#x7AE0;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x4E14;&#x5C06;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x636E;&#x5C01;&#x88C5;&#x6210;&#x4E00;&#x4E2A;LiveData&#xFF0C;&#x5177;&#x4F53;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PagingViewModel</span></span>(app: Application) : AndroidViewModel(app) {</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">val</span> dao: ArticleDao <span class=\"keyword\">by</span> lazy { AppDatabase.getInstance(app).articleDao() }</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">val</span> articleList = dao.getAll()</span><br><span class=\"line\">            .toLiveData(Config(</span><br><span class=\"line\">                    pageSize = <span class=\"number\">5</span></span><br><span class=\"line\">            ))</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;DataSource.Factory&#x7684;toLiveData&#x6269;&#x5C55;&#x65B9;&#x6CD5;&#x6765;&#x6784;&#x5EFA;PagedList&#x7684;LiveData&#x6570;&#x636E;&#x3002;&#x5176;&#x4E2D;Config&#x4E2D;&#x7684;&#x53C2;&#x6570;&#x4EE3;&#x8868;&#x6BCF;&#x9875;&#x8BF7;&#x6C42;&#x7684;&#x6570;&#x636E;&#x4E2A;&#x6570;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x62FF;&#x5230;&#x4E86;LiveData&#x6570;&#x636E;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x8FDB;&#x5165;&#x7B2C;&#x4E09;&#x6B65;</p>\n<h3 id=\"PagedListAdapter\"><a href=\"#PagedListAdapter\" class=\"headerlink\" title=\"PagedListAdapter\"></a>PagedListAdapter</h3><p>&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x8BF4;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x5B9E;&#x73B0;PagedListAdapter&#xFF0C;&#x5E76;&#x5C06;&#x7B2C;&#x4E8C;&#x6B65;&#x62FF;&#x5230;&#x7684;&#x6570;&#x636E;&#x4F20;&#x5165;&#x7ED9;&#x5B83;&#x3002;</p>\n<p>PagedListAdapter&#x4E0E;RecyclerView.Adapter&#x7684;&#x4F7F;&#x7528;&#x533A;&#x522B;&#x4E0D;&#x5927;&#xFF0C;&#x53EA;&#x662F;&#x5BF9;getItemCount&#x4E0E;getItem&#x8FDB;&#x884C;&#x4E86;&#x91CD;&#x5199;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4F7F;&#x7528;&#x5230;&#x4E86;DiffUtil&#xFF0C;&#x907F;&#x514D;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x65E0;&#x7528;&#x66F4;&#x65B0;&#x3002;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PagingAdapter</span> : <span class=\"type\">PagedListAdapter</span>&lt;<span class=\"type\">ArticleModel, PagingVH</span>&gt;</span>(diffCallbacks) {</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">companion</span> <span class=\"keyword\">object</span> {</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">val</span> diffCallbacks = <span class=\"keyword\">object</span> : DiffUtil.ItemCallback&lt;ArticleModel&gt;() {</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">areItemsTheSame</span><span class=\"params\">(oldItem: <span class=\"type\">ArticleModel</span>, newItem: <span class=\"type\">ArticleModel</span>)</span></span>: <span class=\"built_in\">Boolean</span> = oldItem.id == newItem.id</span><br><span class=\"line\"> </span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">areContentsTheSame</span><span class=\"params\">(oldItem: <span class=\"type\">ArticleModel</span>, newItem: <span class=\"type\">ArticleModel</span>)</span></span>: <span class=\"built_in\">Boolean</span> = oldItem == newItem</span><br><span class=\"line\"></span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreateViewHolder</span><span class=\"params\">(parent: <span class=\"type\">ViewGroup</span>, viewType: <span class=\"type\">Int</span>)</span></span>: PagingVH = PagingVH(R.layout.item_paging_article_layout, parent)</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onBindViewHolder</span><span class=\"params\">(holder: <span class=\"type\">PagingVH</span>, position: <span class=\"type\">Int</span>)</span></span> = holder.bind(getItem(position))</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;adapter&#x4E5F;&#x5DF2;&#x7ECF;&#x6784;&#x5EFA;&#x5B8C;&#x6210;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x65E6;PagedList&#x88AB;&#x89C2;&#x5BDF;&#x5230;&#xFF0C;&#x4F7F;&#x7528;submitList&#x4F20;&#x5165;&#x5230;adapter&#x5373;&#x53EF;&#x3002;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">viewModel.articleList.observe(<span class=\"keyword\">this</span>, Observer {</span><br><span class=\"line\">    adapter.submitList(it)</span><br><span class=\"line\">})</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2019/07/25/Paging&#x5728;RecyclerView&#x4E2D;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x6709;&#x8FD9;&#x4E00;&#x7BC7;&#x5C31;&#x591F;&#x4E86;/Paging&#x5728;RecyclerView&#x4E2D;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x6709;&#x8FD9;&#x4E00;&#x7BC7;&#x5C31;&#x591F;&#x4E86;_1.gif\" alt></p>\n<p>&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;Paging&#x7684;Database&#x5217;&#x8868;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x5462;&#xFF1F;&#x5982;&#x679C;&#x9700;&#x8981;&#x5B8C;&#x6574;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x67E5;&#x770B;<a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">Github</a></p>\n<h2 id=\"&#x81EA;&#x5B9A;&#x4E49;DataSource\"><a href=\"#&#x81EA;&#x5B9A;&#x4E49;DataSource\" class=\"headerlink\" title=\"&#x81EA;&#x5B9A;&#x4E49;DataSource\"></a>&#x81EA;&#x5B9A;&#x4E49;DataSource</h2><p>&#x4E0A;&#x9762;&#x662F;&#x901A;&#x8FC7;Room&#x6765;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x77E5;&#x9053;&#x7684;&#x662F;&#xFF0C;Room&#x4E4B;&#x6240;&#x4EE5;&#x7B80;&#x5355;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x4F1A;&#x5E2E;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x8BB8;&#x591A;&#x6570;&#x636E;&#x5E93;&#x76F8;&#x5173;&#x7684;&#x903B;&#x8F91;&#x4EE3;&#x7801;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x5173;&#x6CE8;&#x4E0E;&#x81EA;&#x5DF1;&#x4E1A;&#x52A1;&#x76F8;&#x5173;&#x7684;&#x903B;&#x8F91;&#x5373;&#x53EF;&#x3002;&#x800C;&#x8FD9;&#x5176;&#x4E2D;&#x4E0E;Paging&#x76F8;&#x5173;&#x7684;&#x662F;&#x5BF9;DataSource&#x4E0E;DataSource.Factory&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x3002;</p>\n<p>&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x4E2D;&#x6570;&#x636E;&#x7EDD;&#x5927;&#x591A;&#x6570;&#x6765;&#x81EA;&#x4E8E;&#x7F51;&#x7EDC;&#xFF0C;&#x6240;&#x4EE5;DataSource&#x4E0E;DataSource.Factory&#x7684;&#x5B9E;&#x73B0;&#x8FD8;&#x662F;&#x8981;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x6765;&#x5543;&#x3002;</p>\n<p>&#x6240;&#x5E78;&#x7684;&#x662F;&#xFF0C;&#x5BF9;&#x4E8E;DataSource&#x7684;&#x5B9E;&#x73B0;&#xFF0C;Paging&#x5DF2;&#x7ECF;&#x5E2E;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x4E09;&#x4E2A;&#x975E;&#x5E38;&#x5168;&#x9762;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5206;&#x522B;&#x662F;: </p>\n<ol>\n<li>PageKeyedDataSource: &#x901A;&#x8FC7;&#x5F53;&#x524D;&#x9875;&#x76F8;&#x5173;&#x7684;key&#x6765;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x975E;&#x5E38;&#x5E38;&#x89C1;&#x7684;&#x662F;key&#x4F5C;&#x4E3A;&#x8BF7;&#x6C42;&#x7684;page&#x7684;&#x5927;&#x5C0F;&#x3002;</li>\n<li>ItemKeyedDataSource: &#x901A;&#x8FC7;&#x5177;&#x4F53;item&#x6570;&#x636E;&#x4F5C;&#x4E3A;key&#xFF0C;&#x6765;&#x83B7;&#x53D6;&#x4E0B;&#x4E00;&#x9875;&#x6570;&#x636E;&#x3002;&#x4F8B;&#x5982;&#x804A;&#x5929;&#x4F1A;&#x8BDD;&#xFF0C;&#x8BF7;&#x6C42;&#x4E0B;&#x4E00;&#x9875;&#x6570;&#x636E;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x4E0A;&#x4E00;&#x6761;&#x6570;&#x636E;&#x7684;id&#x3002;</li>\n<li>PositionalDataSource: &#x901A;&#x8FC7;&#x5728;&#x6570;&#x636E;&#x4E2D;&#x7684;position&#x4F5C;&#x4E3A;key&#xFF0C;&#x6765;&#x83B7;&#x53D6;&#x4E0B;&#x4E00;&#x9875;&#x6570;&#x636E;&#x3002;&#x8FD9;&#x4E2A;&#x5178;&#x578B;&#x7684;&#x5C31;&#x662F;&#x4E0A;&#x9762;&#x6240;&#x8BF4;&#x7684;&#x5728;Database&#x4E2D;&#x7684;&#x8FD0;&#x7528;&#x3002;</li>\n</ol>\n<p>PositionalDataSource&#x76F8;&#x4FE1;&#x5DF2;&#x7ECF;&#x6709;&#x70B9;&#x5370;&#x8C61;&#x4E86;&#x5427;&#xFF0C;Room&#x4E2D;&#x9ED8;&#x8BA4;&#x5E2E;&#x6211;&#x5B9E;&#x73B0;&#x7684;&#x5C31;&#x662F;&#x901A;&#x8FC7;PositionalDataSource&#x6765;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x7684;&#x3002;</p>\n<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x6700;&#x5E7F;&#x7684;PageKeyedDataSource&#x6765;&#x5B9E;&#x73B0;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#x3002;</p>\n<p>&#x57FA;&#x4E8E;Databases&#x7684;&#x4E09;&#x6B65;&#xFF0C;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x5C06;&#x5B83;&#x7684;&#x7B2C;&#x4E00;&#x6B65;&#x62C6;&#x5206;&#x4E3A;&#x4E24;&#x6B65;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x56DB;&#x6B65;&#x5C31;&#x80FD;&#x5B9E;&#x73B0;Paging&#x5BF9;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#x7684;&#x5904;&#x7406;&#x3002;</p>\n<ol>\n<li>&#x57FA;&#x4E8E;PageKeyedDataSource&#x5B9E;&#x73B0;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;</li>\n<li>&#x5B9E;&#x73B0;DataSource.Factory</li>\n<li>&#x4F7F;&#x7528;LiveData&#x6765;&#x89C2;&#x5BDF;PagedList</li>\n<li>&#x4F7F;&#x7528;PagedListAdapter&#x6765;&#x4E0E;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#x4E0E;&#x66F4;</li>\n</ol>\n<h3 id=\"PageKeyedDataSource\"><a href=\"#PageKeyedDataSource\" class=\"headerlink\" title=\"PageKeyedDataSource\"></a>PageKeyedDataSource</h3><p>&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;DataSource&#x9700;&#x8981;&#x5B9E;&#x73B0;PageKeyedDataSource&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x4E4B;&#x540E;&#x4F1A;&#x6709;&#x5982;&#x4E0B;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x53BB;&#x5B9E;&#x73B0;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NewsDataSource</span></span>(<span class=\"keyword\">private</span> <span class=\"keyword\">val</span> newsApi: NewsApi,</span><br><span class=\"line\">                     <span class=\"keyword\">private</span> <span class=\"keyword\">val</span> domains: String,</span><br><span class=\"line\">                     <span class=\"keyword\">private</span> <span class=\"keyword\">val</span> retryExecutor: Executor) : PageKeyedDataSource&lt;<span class=\"built_in\">Int</span>, ArticleModel&gt;() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">loadInitial</span><span class=\"params\">(params: <span class=\"type\">LoadInitialParams</span>&lt;<span class=\"type\">Int</span>&gt;, callback: <span class=\"type\">LoadInitialCallback</span>&lt;<span class=\"type\">Int</span>, ArticleModel&gt;)</span></span> {</span><br><span class=\"line\">    \t<span class=\"comment\">// &#x521D;&#x59CB;&#x5316;&#x7B2C;&#x4E00;&#x9875;&#x6570;&#x636E;</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">loadAfter</span><span class=\"params\">(params: <span class=\"type\">LoadParams</span>&lt;<span class=\"type\">Int</span>&gt;, callback: <span class=\"type\">LoadCallback</span>&lt;<span class=\"type\">Int</span>, ArticleModel&gt;)</span></span> {</span><br><span class=\"line\">    \t<span class=\"comment\">// &#x52A0;&#x8F7D;&#x4E0B;&#x4E00;&#x9875;&#x6570;&#x636E;</span></span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">loadBefore</span><span class=\"params\">(params: <span class=\"type\">LoadParams</span>&lt;<span class=\"type\">Int</span>&gt;, callback: <span class=\"type\">LoadCallback</span>&lt;<span class=\"type\">Int</span>, ArticleModel&gt;)</span></span> {</span><br><span class=\"line\">    \t<span class=\"comment\">// &#x52A0;&#x8F7D;&#x524D;&#x4E00;&#x9875;&#x6570;&#x636E;</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;loadBefore&#x6682;&#x65F6;&#x7528;&#x4E0D;&#x5230;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x662F;&#x83B7;&#x53D6;&#x65B0;&#x95FB;&#x5217;&#x8868;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x9700;&#x8981;loadInitial&#x4E0E;loadAfter&#x5373;&#x53EF;&#x3002;</p>\n<p>&#x81F3;&#x4E8E;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#xFF0C;&#x5176;&#x5B9E;&#x6CA1;&#x4EC0;&#x4E48;&#x591A;&#x8BF4;&#x7684;&#xFF0C;&#x6839;&#x636E;&#x4F60;&#x7684;&#x4E1A;&#x52A1;&#x8981;&#x6C42;&#x6765;&#x5373;&#x53EF;&#xFF0C;&#x8FD9;&#x91CC;&#x8981;&#x8BF4;&#x7684;&#x662F;&#xFF0C;&#x6570;&#x636E;&#x83B7;&#x53D6;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#x8981;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;callback&#x7684;onResult&#x65B9;&#x6CD5;&#x3002;&#x4F8B;&#x5982;loadInitial:</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">loadInitial</span><span class=\"params\">(params: <span class=\"type\">LoadInitialParams</span>&lt;<span class=\"type\">Int</span>&gt;, callback: <span class=\"type\">LoadInitialCallback</span>&lt;<span class=\"type\">Int</span>, ArticleModel&gt;)</span></span> {</span><br><span class=\"line\">    initStatus.postValue(Loading(<span class=\"string\">&quot;&quot;</span>))</span><br><span class=\"line\">    CompositeDisposable().add(getEverything(domains, <span class=\"number\">1</span>, ArticleListModel::<span class=\"class\"><span class=\"keyword\">class</span>.<span class=\"title\">java</span>)</span></span><br><span class=\"line\">            .subscribeWith(<span class=\"keyword\">object</span> : DisposableObserver&lt;ArticleListModel&gt;() {</span><br><span class=\"line\">                <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onComplete</span><span class=\"params\">()</span></span> {</span><br><span class=\"line\">                }</span><br><span class=\"line\"> </span><br><span class=\"line\">                <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onError</span><span class=\"params\">(e: <span class=\"type\">Throwable</span>)</span></span> {</span><br><span class=\"line\">                    retry = {</span><br><span class=\"line\">                        loadInitial(params, callback)</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                    initStatus.postValue(Error(e.localizedMessage))</span><br><span class=\"line\">                }</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onNext</span><span class=\"params\">(t: <span class=\"type\">ArticleListModel</span>)</span></span> {</span><br><span class=\"line\">                    initStatus.postValue(Success(<span class=\"number\">200</span>))</span><br><span class=\"line\">                    callback.onResult(t.articles, <span class=\"number\">1</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }))</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;onNext&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x83B7;&#x53D6;&#x7684;&#x6570;&#x636E;&#x586B;&#x5145;&#x5230;onResult&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x540C;&#x65F6;&#x4F20;&#x5165;&#x4E86;&#x4E4B;&#x524D;&#x7684;&#x9875;&#x7801;previousPageKey(&#x521D;&#x59CB;&#x5316;&#x4E3A;&#x7B2C;&#x4E00;&#x9875;)&#x4E0E;&#x4E4B;&#x540E;&#x7684;&#x9875;&#x9762;nextPageKey&#xFF0C;nextPageKey&#x81EA;&#x7136;&#x662F;&#x4F5C;&#x7528;&#x4E8E;loadAfter&#x65B9;&#x6CD5;&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5728;loadAfter&#x4E2D;&#x7684;params&#x53C2;&#x6570;&#x4E2D;&#x83B7;&#x53D6;&#x5230;:</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">loadAfter</span><span class=\"params\">(params: <span class=\"type\">LoadParams</span>&lt;<span class=\"type\">Int</span>&gt;, callback: <span class=\"type\">LoadCallback</span>&lt;<span class=\"type\">Int</span>, ArticleModel&gt;)</span></span> {</span><br><span class=\"line\">    loadStatus.postValue(Loading(<span class=\"string\">&quot;&quot;</span>))</span><br><span class=\"line\">    CompositeDisposable().add(getEverything(domains, params.key, ArticleListModel::<span class=\"class\"><span class=\"keyword\">class</span>.<span class=\"title\">java</span>)</span></span><br><span class=\"line\">            .subscribeWith(<span class=\"keyword\">object</span> : DisposableObserver&lt;ArticleListModel&gt;() {</span><br><span class=\"line\">                <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onComplete</span><span class=\"params\">()</span></span> {</span><br><span class=\"line\">                }</span><br><span class=\"line\"> </span><br><span class=\"line\">                <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onError</span><span class=\"params\">(e: <span class=\"type\">Throwable</span>)</span></span> {</span><br><span class=\"line\">                    retry = {</span><br><span class=\"line\">                        loadAfter(params, callback)</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                    loadStatus.postValue(Error(e.localizedMessage))</span><br><span class=\"line\">                }</span><br><span class=\"line\"> </span><br><span class=\"line\">                <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onNext</span><span class=\"params\">(t: <span class=\"type\">ArticleListModel</span>)</span></span> {</span><br><span class=\"line\">                    loadStatus.postValue(Success(<span class=\"number\">200</span>))</span><br><span class=\"line\">                    callback.onResult(t.articles, params.key + <span class=\"number\">1</span>)</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }))</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;DataSource&#x5C31;&#x57FA;&#x672C;&#x4E0A;&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x8981;&#x505A;&#x7684;&#x662F;&#xFF0C;&#x5B9E;&#x73B0;DataSource.Factory&#x6765;&#x751F;&#x6210;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;DataSource</p>\n<h3 id=\"DataSource-Factory-1\"><a href=\"#DataSource-Factory-1\" class=\"headerlink\" title=\"DataSource.Factory\"></a>DataSource.Factory</h3><p>&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x5C31;&#x5DF2;&#x7ECF;&#x63D0;&#x53CA;&#x5230;&#xFF0C;DataSource.Factory&#x53EA;&#x6709;&#x4E00;&#x4E2A;abstract&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x5B9E;&#x73B0;&#x5B83;&#x7684;create&#x65B9;&#x6CD5;&#x6765;&#x521B;&#x5EFA;&#x81EA;&#x5B9A;&#x4E49;&#x7684;DataSource&#x5373;&#x53EF;:</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NewsDataSourceFactory</span></span>(<span class=\"keyword\">private</span> <span class=\"keyword\">val</span> newsApi: NewsApi,</span><br><span class=\"line\">                            <span class=\"keyword\">private</span> <span class=\"keyword\">val</span> domains: String,</span><br><span class=\"line\">                            <span class=\"keyword\">private</span> <span class=\"keyword\">val</span> executor: Executor) : DataSource.Factory&lt;<span class=\"built_in\">Int</span>, ArticleModel&gt;() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">val</span> dataSourceLiveData = MutableLiveData&lt;NewsDataSource&gt;()</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">create</span><span class=\"params\">()</span></span>: DataSource&lt;<span class=\"built_in\">Int</span>, ArticleModel&gt; {</span><br><span class=\"line\">        <span class=\"keyword\">val</span> dataSource = NewsDataSource(newsApi, domains, executor)</span><br><span class=\"line\">        dataSourceLiveData.postValue(dataSource)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dataSource</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x55EF;&#xFF0C;&#x4EE3;&#x7801;&#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#xFF0C;&#x8FD9;&#x4E00;&#x6B65;&#x4E5F;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x8981;&#x505A;&#x7684;&#x662F;&#x5C06;pagedList&#x8FDB;&#x884C;LiveData&#x5C01;&#x88C5;&#x3002;</p>\n<h3 id=\"Repository-amp-ViewModel\"><a href=\"#Repository-amp-ViewModel\" class=\"headerlink\" title=\"Repository &amp; ViewModel\"></a>Repository &amp; ViewModel</h3><p>&#x8FD9;&#x91CC;&#x4E0E;Database&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x5728;ViewModel&#x4E2D;&#x901A;&#x8FC7;DataSource.Factory&#x6765;&#x83B7;&#x53D6;pagedList&#xFF0C;&#x800C;&#x662F;&#x8FDB;&#x4E00;&#x6B65;&#x4F7F;&#x7528;Repository&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#xFF0C;&#x7EDF;&#x4E00;&#x901A;&#x8FC7;sendRequest&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;NewsListingModel&#x7684;&#x5C01;&#x88C5;&#x7ED3;&#x679C;&#x5B9E;&#x4F8B;&#x3002;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">data</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NewsListingModel</span></span>(<span class=\"keyword\">val</span> pagedList: LiveData&lt;PagedList&lt;ArticleModel&gt;&gt;,</span><br><span class=\"line\">                            <span class=\"keyword\">val</span> loadStatus: LiveData&lt;LoadStatus&gt;,</span><br><span class=\"line\">                            <span class=\"keyword\">val</span> refreshStatus: LiveData&lt;LoadStatus&gt;,</span><br><span class=\"line\">                            <span class=\"keyword\">val</span> retry: () -&gt; <span class=\"built_in\">Unit</span>,</span><br><span class=\"line\">                            <span class=\"keyword\">val</span> refresh: () -&gt; <span class=\"built_in\">Unit</span>)</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">sealed</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LoadStatus</span> : <span class=\"type\">BaseModel</span></span>()</span><br><span class=\"line\"><span class=\"keyword\">data</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Success</span></span>(<span class=\"keyword\">val</span> status: <span class=\"built_in\">Int</span>) : LoadStatus()</span><br><span class=\"line\"><span class=\"keyword\">data</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NoMore</span></span>(<span class=\"keyword\">val</span> content: String) : LoadStatus()</span><br><span class=\"line\"><span class=\"keyword\">data</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Loading</span></span>(<span class=\"keyword\">val</span> content: String) : LoadStatus()</span><br><span class=\"line\"><span class=\"keyword\">data</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Error</span></span>(<span class=\"keyword\">val</span> message: String) : LoadStatus()</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;Repository&#x4E2D;&#x7684;sendRequest&#x8FD4;&#x56DE;&#x7684;&#x5C06;&#x662F;NewsListingModel&#xFF0C;&#x5B83;&#x91CC;&#x9762;&#x5305;&#x542B;&#x4E86;&#x6570;&#x636E;&#x5217;&#x8868;&#x3001;&#x52A0;&#x8F7D;&#x72B6;&#x6001;&#x3001;&#x5237;&#x65B0;&#x72B6;&#x6001;&#x3001;&#x91CD;&#x8BD5;&#x4E0E;&#x5237;&#x65B0;&#x8BF7;&#x6C42;&#x3002;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NewsRepository</span></span>(<span class=\"keyword\">private</span> <span class=\"keyword\">val</span> newsApi: NewsApi,</span><br><span class=\"line\">                     <span class=\"keyword\">private</span> <span class=\"keyword\">val</span> domains: String,</span><br><span class=\"line\">                     <span class=\"keyword\">private</span> <span class=\"keyword\">val</span> executor: Executor) : BaseRepository&lt;NewsListingModel&gt; {</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">sendRequest</span><span class=\"params\">(pageSize: <span class=\"type\">Int</span>)</span></span>: NewsListingModel {</span><br><span class=\"line\">        <span class=\"keyword\">val</span> newsDataSourceFactory = NewsDataSourceFactory(newsApi, domains, executor)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> newsPagingList = newsDataSourceFactory.toLiveData(</span><br><span class=\"line\">                pageSize = pageSize,</span><br><span class=\"line\">                fetchExecutor = executor</span><br><span class=\"line\">        )</span><br><span class=\"line\">        <span class=\"keyword\">val</span> loadStatus = Transformations.switchMap(newsDataSourceFactory.dataSourceLiveData) {</span><br><span class=\"line\">            it.loadStatus</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">val</span> initStatus = Transformations.switchMap(newsDataSourceFactory.dataSourceLiveData) {</span><br><span class=\"line\">            it.initStatus</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">return</span> NewsListingModel(</span><br><span class=\"line\">                pagedList = newsPagingList,</span><br><span class=\"line\">                loadStatus = loadStatus,</span><br><span class=\"line\">                refreshStatus = initStatus,</span><br><span class=\"line\">                retry = {</span><br><span class=\"line\">                    newsDataSourceFactory.dataSourceLiveData.value?.retryAll()</span><br><span class=\"line\">                },</span><br><span class=\"line\">                refresh = {</span><br><span class=\"line\">                    newsDataSourceFactory.dataSourceLiveData.value?.invalidate()</span><br><span class=\"line\">                }</span><br><span class=\"line\">        )</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x63A5;&#x4E0B;&#x6765;ViewModel&#x4E2D;&#x5C31;&#x76F8;&#x5BF9;&#x6765;&#x5C31;&#x7B80;&#x5355;&#x8BB8;&#x591A;&#x4E86;&#xFF0C;&#x5B83;&#x9700;&#x8981;&#x5173;&#x6CE8;&#x7684;&#x5C31;&#x662F;&#x5BF9;NewsListingModel&#x4E2D;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5206;&#x79BB;&#x6210;&#x5355;&#x4E2A;LiveData&#x5BF9;&#x8C61;&#x5373;&#x53EF;&#xFF0C;&#x7531;&#x4E8E;&#x672C;&#x8EAB;&#x5176;&#x6210;&#x5458;&#x5C31;&#x662F;LiveDate&#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x4EE5;&#x5206;&#x79BB;&#x4E5F;&#x662F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3002;&#x5206;&#x79BB;&#x662F;&#x4E3A;&#x4E86;&#x4EE5;&#x4FBF;&#x5728;Activity&#x8FDB;&#x884C;observe&#x89C2;&#x5BDF;&#x3002;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NewsVM</span></span>(app: Application, <span class=\"keyword\">private</span> <span class=\"keyword\">val</span> newsRepository: BaseRepository&lt;NewsListingModel&gt;) : AndroidViewModel(app) {</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">val</span> newsListing = MutableLiveData&lt;NewsListingModel&gt;()</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">val</span> adapter = NewsAdapter {</span><br><span class=\"line\">        retry()</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">val</span> newsLoadStatus = Transformations.switchMap(newsListing) {</span><br><span class=\"line\">        it.loadStatus</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">val</span> refreshLoadStatus = Transformations.switchMap(newsListing) {</span><br><span class=\"line\">        it.refreshStatus</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">val</span> articleList = Transformations.switchMap(newsListing) {</span><br><span class=\"line\">        it.pagedList</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getData</span><span class=\"params\">()</span></span> {</span><br><span class=\"line\">        newsListing.value = newsRepository.sendRequest(<span class=\"number\">20</span>)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">retry</span><span class=\"params\">()</span></span> {</span><br><span class=\"line\">        newsListing.value?.retry?.invoke()</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">refresh</span><span class=\"params\">()</span></span> {</span><br><span class=\"line\">        newsListing.value?.refresh?.invoke()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"PagedListAdapter-amp-Activity\"><a href=\"#PagedListAdapter-amp-Activity\" class=\"headerlink\" title=\"PagedListAdapter &amp; Activity\"></a>PagedListAdapter &amp; Activity</h3><p>Adapter&#x90E8;&#x5206;&#x4E0E;Database&#x7684;&#x57FA;&#x672C;&#x7C7B;&#x4F3C;&#xFF0C;&#x4E3B;&#x8981;&#x4E5F;&#x662F;&#x9700;&#x8981;&#x5B9E;&#x73B0;DiffUtil.ItemCallback&#xFF0C;&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F;&#x6B63;&#x5E38;&#x7684;Adapter&#x5B9E;&#x73B0;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x518D;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x7684;&#x8BDD;&#x8BF7;&#x9605;&#x8BFB;&#x6E90;&#x7801;</p>\n<p>&#x6700;&#x540E;&#x7684;observe&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private fun addObserve() {</span><br><span class=\"line\">    newsVM.articleList.observe(this, Observer {</span><br><span class=\"line\">        newsVM.adapter.submitList(it)</span><br><span class=\"line\">    })</span><br><span class=\"line\">    newsVM.newsLoadStatus.observe(this, Observer {</span><br><span class=\"line\">        newsVM.adapter.updateLoadStatus(it)</span><br><span class=\"line\">    })</span><br><span class=\"line\">    newsVM.refreshLoadStatus.observe(this, Observer {</span><br><span class=\"line\">        refresh_layout.isRefreshing = it is Loading</span><br><span class=\"line\">    })</span><br><span class=\"line\">    refresh_layout.setOnRefreshListener {</span><br><span class=\"line\">        newsVM.refresh()</span><br><span class=\"line\">    }</span><br><span class=\"line\">    newsVM.getData()</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2019/07/25/Paging&#x5728;RecyclerView&#x4E2D;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x6709;&#x8FD9;&#x4E00;&#x7BC7;&#x5C31;&#x591F;&#x4E86;/Paging&#x5728;RecyclerView&#x4E2D;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x6709;&#x8FD9;&#x4E00;&#x7BC7;&#x5C31;&#x591F;&#x4E86;_2.gif\" alt></p>\n<p>Paging&#x5C01;&#x88C5;&#x7684;&#x8FD8;&#x662F;&#x975E;&#x5E38;&#x597D;&#x7684;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x9879;&#x76EE;&#x4E2D;&#x5BF9;RecyclerView&#x975E;&#x5E38;&#x4F9D;&#x8D56;&#x7684;&#xFF0C;&#x8FD8;&#x662F;&#x6548;&#x679C;&#x4E0D;&#x9519;&#x7684;&#x3002;&#x5F53;&#x7136;&#x5B83;&#x7684;&#x4F18;&#x70B9;&#x4E5F;&#x662F;&#x5B83;&#x7684;&#x5C40;&#x9650;&#x6027;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x4E5F;&#x662F;&#x6CA1;&#x529E;&#x6CD5;&#x7684;&#x4E8B;&#x60C5;&#x3002;</p>\n<p>&#x5E0C;&#x671B;&#x4F60;&#x901A;&#x8FC7;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x80FD;&#x591F;&#x719F;&#x6089;&#x8FD0;&#x7528;Paging&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5BF9;&#x4F60;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x987A;&#x624B;&#x5173;&#x6CE8;&#x4E00;&#x6CE2;&#xFF0C;&#x8FD9;&#x662F;&#x5BF9;&#x6211;&#x6700;&#x5927;&#x7684;&#x9F13;&#x52B1;&#xFF01;</p>\n<h2 id=\"&#x9879;&#x76EE;&#x5730;&#x5740;\"><a href=\"#&#x9879;&#x76EE;&#x5730;&#x5740;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;&#x5730;&#x5740;\"></a>&#x9879;&#x76EE;&#x5730;&#x5740;</h2><h4 id=\"Android&#x7CBE;&#x534E;&#x5F55;\"><a href=\"#Android&#x7CBE;&#x534E;&#x5F55;\" class=\"headerlink\" title=\"Android&#x7CBE;&#x534E;&#x5F55;\"></a>Android&#x7CBE;&#x534E;&#x5F55;</h4><p>&#x8BE5;&#x5E93;&#x7684;&#x76EE;&#x7684;&#x662F;&#x7ED3;&#x5408;&#x8BE6;&#x7EC6;&#x7684;Demo&#x6765;&#x5168;&#x9762;&#x89E3;&#x6790;Android&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;, &#x5E2E;&#x52A9;&#x8BFB;&#x8005;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x7684;&#x638C;&#x63E1;&#x4E0E;&#x7406;&#x89E3;&#x6240;&#x9610;&#x8FF0;&#x7684;&#x8981;&#x70B9;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">Android&#x7CBE;&#x534E;&#x5F55;</a></p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/7/31/16c45287d667775c?w=258&amp;h=258&amp;f=webp&amp;s=5898\" alt></p>\n","categories":["android"],"tags":["Android Architecture Components"]},{"title":"只需三步实现Databinding插件化","url":"https://www.rousetime.com/2019/07/09/只需三步实现Databinding插件化/","content":"<p>&#x9996;&#x5148;&#x4E3A;&#x4F55;&#x6211;&#x8981;&#x5B9E;&#x73B0;Databinding&#x8FD9;&#x4E2A;&#x5C0F;&#x63D2;&#x4EF6;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x5728;&#x65E5;&#x5E38;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x53D1;&#x73B0;&#x6BCF;&#x6B21;&#x901A;&#x8FC7;Android Studio&#x7684;Layout resource file&#x6765;&#x521B;&#x5EFA;xml&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x90FD;&#x6CA1;&#x6709;&#x5305;&#x542B;Databinding&#x6240;&#x8981;&#x7684;&#x6807;&#x7B7E;<layout>&#x3002;&#x5BFC;&#x81F4;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x6BCF;&#x6B21;&#x90FD;&#x8981;&#x91CD;&#x590D;&#x624B;&#x52A8;&#x4FEE;&#x6539;&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#xFF0C;&#x6DFB;&#x52A0;layout&#x6807;&#x7B7E;&#x7B49;&#x3002;</layout></p>\n<p>&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x5077;&#x61D2;&#xFF0C;&#x5C31;&#x6709;&#x4E2A;&#x8FD9;&#x4E2A;&#x4E00;&#x6B65;&#x751F;&#x6210;&#x7B26;&#x5408;Databinding&#x7684;&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#x3002;</p>\n<p>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E0D;&#x4F1A;&#x8BE6;&#x7EC6;&#x8BB2;&#x6BCF;&#x4E00;&#x4E2A;&#x4EE3;&#x7801;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x6837;&#x592A;&#x6D6A;&#x8D39;&#x5927;&#x5BB6;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x6211;&#x4F1A;&#x901A;&#x8FC7;&#x51E0;&#x4E2A;&#x8981;&#x70B9;&#x4E0E;&#x5173;&#x952E;&#x4EE3;&#x7801;&#x6765;&#x68B3;&#x7406;&#x5B9E;&#x73B0;&#x8FC7;&#x7A0B;&#xFF0C;&#x800C;&#x4E14;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x4E4B;&#x540E;&#x518D;&#x53BB;&#x770B;&#x6E90;&#x7801;&#x4E5F;&#x4F1A;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x3002;</p>\n<p>&#x6E90;&#x7801;&#x5730;&#x5740;(&#x6B22;&#x8FCE;&#x6765;&#x8FD9;&#x70B9;&#x51FB;start&#x1F601;)&#xFF1A;</p>\n<p><a href=\"https://github.com/idisfkj/databinding_autorun\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/databinding_autorun</a></p>\n<p>&#x5E9F;&#x8BDD;&#x4E0D;&#x591A;&#x8BF4;&#xFF0C;&#x5148;&#x6765;&#x770B;&#x4E0B;&#x8FD9;&#x4E2A;&#x63D2;&#x4EF6;&#x7684;&#x6548;&#x679C;</p>\n<p><img src=\"/2019/07/09/&#x53EA;&#x9700;&#x4E09;&#x6B65;&#x5B9E;&#x73B0;Databinding&#x63D2;&#x4EF6;&#x5316;/databinding_autorun_show.gif\" alt></p>\n<h2 id=\"&#x4E09;&#x6B65;&#x8D70;\"><a href=\"#&#x4E09;&#x6B65;&#x8D70;\" class=\"headerlink\" title=\"&#x4E09;&#x6B65;&#x8D70;\"></a>&#x4E09;&#x6B65;&#x8D70;</h2><p>&#x5B9E;&#x73B0;&#x4E0A;&#x9762;&#x7684;&#x63D2;&#x4EF6;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x5F52;&#x7EB3;&#x4E3A;&#x4E09;&#x6B65;&#xFF0C;&#x53EA;&#x8981;&#x4F60;&#x638C;&#x63E1;&#x4E86;&#x8FD9;&#x4E09;&#x6B65;&#xFF0C;&#x4F60;&#x4E5F;&#x80FD;&#x591F;&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;&#x63D2;&#x4EF6;&#xFF0C;&#x63D0;&#x9AD8;&#x65E5;&#x5E38;&#x5F00;&#x53D1;&#xFF0C;&#x51CF;&#x5C11;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x91CD;&#x590D;&#x64CD;&#x4F5C;&#x3002;</p>\n<ol>\n<li>&#x521B;&#x5EFA;Actions</li>\n<li>&#x751F;&#x6210;Panel&#x5E03;&#x5C40;</li>\n<li>&#x914D;&#x7F6E;&#x6301;&#x4E45;&#x5316;Component</li>\n</ol>\n<h2 id=\"&#x521B;&#x5EFA;Actions\"><a href=\"#&#x521B;&#x5EFA;Actions\" class=\"headerlink\" title=\"&#x521B;&#x5EFA;Actions\"></a>&#x521B;&#x5EFA;Actions</h2><p>&#x81F3;&#x4E8E;&#x5982;&#x4F55;&#x4F7F;&#x7528;Gradle&#x6765;&#x521B;&#x5EFA;plugin&#x9879;&#x76EE;&#xFF0C;&#x8FD9;&#x4E0D;&#x662F;&#x4ECA;&#x5929;&#x7684;&#x4E3B;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x4E0D;&#x591A;&#x4ECB;&#x7ECD;&#x4E86;&#x3002;&#x6211;&#x8FD9;&#x91CC;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x94FE;&#x63A5;&#xFF0C;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x4F60;&#x5FEB;&#x901F;&#x4F7F;&#x7528;Gradle&#x521B;&#x5EFA;plugin&#x9879;&#x76EE;</p>\n<p><a href=\"http://www.jetbrains.org/intellij/sdk/docs/tutorials/build_system.html\" target=\"_blank\" rel=\"noopener\">http://www.jetbrains.org/intellij/sdk/docs/tutorials/build_system.html</a></p>\n<p>&#x5C31;&#x5982;&#x4E0A;&#x9762;&#x7684;gif&#x6548;&#x679C;&#x56FE;&#x4E00;&#x6837;&#xFF0C;&#x9996;&#x5148;&#x7B2C;&#x4E00;&#x6B65;&#x662F;&#x901A;&#x8FC7;layout&#x6587;&#x4EF6;&#x8282;&#x70B9;&#xFF0C;&#x5F39;&#x51FA;&#x83DC;&#x5355;&#x5217;&#x8868;&#xFF0C;&#x6700;&#x540E;&#x5728;New&#x9009;&#x9879;&#x5B50;&#x5217;&#x8868;&#x4E2D;&#x5448;&#x73B0;Databinding layout resource file&#x9009;&#x9879;&#x3002;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;</p>\n<p><img src=\"/2019/07/09/&#x53EA;&#x9700;&#x4E09;&#x6B65;&#x5B9E;&#x73B0;Databinding&#x63D2;&#x4EF6;&#x5316;/databinding_autorun_1.png\" alt></p>\n<p>&#x4E0A;&#x9762;&#x7684;&#x8FD9;&#x6574;&#x4E2A;&#x6B65;&#x9AA4;&#xFF0C;&#x53EF;&#x4EE5;&#x5F52;&#x7EB3;&#x4E3A;&#x4E00;&#x70B9;&#xFF0C;&#x5C31;&#x662F;Action&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6765;&#x9700;&#x8981;&#x81EA;&#x5B9A;&#x4E49;Action&#x3002;</p>\n<p>&#x4F46;&#x6240;&#x5E78;&#x7684;&#x662F;intellij openapi&#x5DF2;&#x7ECF;&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;<strong>AnAction</strong>&#x7C7B;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x505A;&#x7684;&#x53EA;&#x9700;&#x7EE7;&#x627F;&#x5B83;&#xFF0C;&#x6765;&#x5B9E;&#x73B0;&#x5177;&#x4F53;&#x7684;update&#x4E0E;actionPerformed&#x65B9;&#x6CD5;&#x5373;&#x53EF;&#x3002;</p>\n<h3 id=\"config\"><a href=\"#config\" class=\"headerlink\" title=\"config\"></a>config</h3><p>&#x5728;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;resources/META-INF/plugin.xml&#x6587;&#x4EF6;&#x4E2D;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;actions&gt;</span><br><span class=\"line\">    &lt;!-- Add your actions here --&gt;</span><br><span class=\"line\">    &lt;action class=&quot;com.idisfkj.databinding.autorun.actions.DataBindingAutorunAction&quot;</span><br><span class=\"line\">            id=&quot;DataBindingAutorunAction&quot;</span><br><span class=\"line\">            text=&quot;_DataBinding layout resource file&quot;</span><br><span class=\"line\">            description=&quot;Create DataBinding Resource File&quot;&gt;</span><br><span class=\"line\">        &lt;add-to-group group-id=&quot;NewGroup&quot; anchor=&quot;first&quot;/&gt;</span><br><span class=\"line\">    &lt;/action&gt;</span><br><span class=\"line\">&lt;/actions&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x8BE5;&#x914D;&#x7F6E;&#x6700;&#x91CD;&#x8981;&#x7684;&#x662F;&#x6700;&#x540E;&#x4E00;&#x6761;add-to-group&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5C06;&#x5F53;&#x524D;Action&#x6DFB;&#x52A0;&#x5230;NewGroup&#x7684;&#x7CFB;&#x7EDF;&#x5217;&#x8868;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x624D;&#x80FD;&#x5728;&#x4E0A;&#x56FE;&#x4E2D;&#x7684;New&#x7684;&#x6269;&#x5C55;&#x5217;&#x8868;&#x4E2D;&#x770B;&#x5230;Databinding layout resources file&#x9009;&#x9879;&#x3002;</p>\n<blockquote>\n<p>&#x539F;&#x5219;&#x4E0A;&#x6211;&#x4EEC;&#x5728;AS&#x80FD;&#x591F;&#x770B;&#x5230;&#x7684;&#x5217;&#x8868;&#xFF0C;&#x90FD;&#x80FD;&#x591F;&#x8FDB;&#x884C;&#x63D2;&#x5165;&#x3002;&#x4F8B;&#x5982;&#x9876;&#x90E8;&#x7684;File&#x3001;Edit&#x3001;View&#x7B49;&#x83DC;&#x5355;&#x680F;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x9876;&#x90E8;&#x83DC;&#x5355;&#x680F;&#x3002;</p>\n</blockquote>\n<p><img src=\"/2019/07/09/&#x53EA;&#x9700;&#x4E09;&#x6B65;&#x5B9E;&#x73B0;Databinding&#x63D2;&#x4EF6;&#x5316;/databinding_autorun_2.png\" alt></p>\n<h3 id=\"update\"><a href=\"#update\" class=\"headerlink\" title=\"update\"></a>update</h3><p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x662F;&#x7528;&#x6765;&#x66F4;&#x65B0;Action&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x5B83;&#x7684;&#x56DE;&#x8C03;&#x4F1A;&#x975E;&#x5E38;&#x9891;&#x7E41;&#x4E0E;&#x8FC5;&#x901F;&#x3002;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x6765;&#x63A7;&#x5236;Databinding layout resource file&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x7684;&#x663E;&#x9690;&#x3002;</p>\n<p>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x63A7;&#x5236;&#x663E;&#x9690;&#x5462;&#xFF1F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4E00;&#x65B9;&#x9762;&#x6211;&#x4EEC;&#x521B;&#x5EFA;.xml&#x8D44;&#x6E90;&#x6587;&#x4EF6;&#x53EA;&#x80FD;&#x5728;layout&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8981;&#x63A7;&#x5236;&#x5B83;&#x7684;&#x521B;&#x5EFA;&#x4F4D;&#x7F6E;&#xFF1B;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#x4E5F;&#x662F;&#x4E3A;&#x4E86;&#x4E0E;&#x539F;&#x751F;&#x7684;Layout resource file&#x9009;&#x9879;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#xFF0C;&#x4E0D;&#x81F3;&#x4E8E;&#x8FDD;&#x548C;&#x3002;</p>\n<p>&#x800C;Action&#x7684;&#x663E;&#x9690;&#x662F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;presentation.isVisible&#x6765;&#x63A7;&#x5236;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x6700;&#x7EC8;&#x6548;&#x679C;&#x4E0E;&#x63A7;&#x5236;&#x91CF;&#x90FD;&#x77E5;&#x9053;&#x4E86;&#xFF0C;&#x6700;&#x540E;&#x6211;&#x4EEC;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x903B;&#x8F91;&#x5224;&#x65AD;&#x3002;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x6765;Look at the code</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">update</span><span class=\"params\">(e: <span class=\"type\">AnActionEvent</span>)</span></span> {</span><br><span class=\"line\">    with(e) {</span><br><span class=\"line\">        <span class=\"comment\">// &#x9ED8;&#x8BA4;&#x4E0D;&#x663E;&#x793A;</span></span><br><span class=\"line\">        presentation.isVisible = <span class=\"literal\">false</span></span><br><span class=\"line\">        <span class=\"comment\">// AnActionEvent&#x7684;&#x6269;&#x5C55;&#x65B9;&#x6CD5;&#xFF0C;&#x76EE;&#x7684;&#x662F;&#x627E;&#x5230;&#x5F53;&#x524D;&#x64CD;&#x4F5C;&#x7684;&#x865A;&#x62DF;&#x6587;&#x4EF6;</span></span><br><span class=\"line\">        handleVirtualFile { project, virtualFile -&gt;</span><br><span class=\"line\">            <span class=\"comment\">// &#x627E;&#x5230;&#x5F53;&#x524D;module&#xFF0C;&#x5E76;&#x4E14;&#x5B9A;&#x4F4D;&#x5230;layout&#x6587;&#x4EF6;&#x76EE;&#x5F55;</span></span><br><span class=\"line\">            ModuleUtil.findModuleForFile(virtualFile, project)?.sourceRoots?.map {</span><br><span class=\"line\">                <span class=\"keyword\">val</span> layout = PsiManager.getInstance(project)</span><br><span class=\"line\">                    .findDirectory(it)</span><br><span class=\"line\">                    ?.findSubdirectory(<span class=\"string\">&quot;layout&quot;</span>)</span><br><span class=\"line\"> </span><br><span class=\"line\">                <span class=\"comment\">// &#x5F53;&#x524D;&#x64CD;&#x4F5C;&#x8303;&#x56F4;&#x5728;layout&#x8282;&#x70B9;&#x4E0B;</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (layout != <span class=\"literal\">null</span> &amp;&amp; virtualFile.path.contains(layout.virtualFile.path)) {</span><br><span class=\"line\">                    <span class=\"comment\">// &#x663E;&#x793A;</span></span><br><span class=\"line\">                    presentation.isVisible = <span class=\"literal\">true</span></span><br><span class=\"line\">                    <span class=\"keyword\">return</span><span class=\"symbol\">@map</span></span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x6709;&#x4E24;&#x4E2A;&#x77E5;&#x8BC6;&#x70B9;</p>\n<ol>\n<li><p>VirtualFile: &#x7B80;&#x5355;&#x7684;&#x6765;&#x8BF4;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x4E0E;&#x6587;&#x4EF6;&#x5939;&#x3002; &#x8FD9;&#x91CC;&#x901A;&#x8FC7;&#x5B83;&#x6765;&#x5B9A;&#x4F4D;&#x5F53;&#x524D;&#x6240;&#x5904;&#x7684;module&#x3002;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x94FE;&#x63A5;:<br><a href=\"http://www.jetbrains.org/intellij/sdk/docs/basics/virtual_file_system.html\" target=\"_blank\" rel=\"noopener\">http://www.jetbrains.org/intellij/sdk/docs/basics/virtual_file_system.html</a></p>\n</li>\n<li><p>PsiManager&#xFF1A;&#x9879;&#x76EE;&#x7ED3;&#x6784;&#x7BA1;&#x7406;&#x5668;&#xFF0C;&#x8FD9;&#x91CC;&#x901A;&#x8FC7;&#x5B83;&#x6765;&#x627E;&#x5230;layout&#x6587;&#x4EF6;&#x76EE;&#x5F55;&#xFF0C;&#x540E;&#x7EED;&#x8FD8;&#x4F1A;&#x4F7F;&#x7528;&#x5B83;&#x6765;&#x5B9E;&#x73B0;&#x81EA;&#x52A8;&#x6DFB;&#x52A0;&#x6587;&#x4EF6;&#x3002;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x94FE;&#x63A5;:<br><a href=\"http://www.jetbrains.org/intellij/sdk/docs/basics/architectural_overview/psi.html\" target=\"_blank\" rel=\"noopener\">http://www.jetbrains.org/intellij/sdk/docs/basics/architectural_overview/psi.html</a></p>\n</li>\n</ol>\n<h3 id=\"actionPerformed\"><a href=\"#actionPerformed\" class=\"headerlink\" title=\"actionPerformed\"></a>actionPerformed</h3><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x63A7;&#x5236;&#x4E86;Action&#x7684;&#x663E;&#x9690;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5B9E;&#x73B0;&#x5B83;&#x7684;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x3002;</p>\n<p>&#x903B;&#x8F91;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#xFF0C;&#x5F39;&#x51FA;&#x4E00;&#x4E2A;&#x7F16;&#x8F91;&#x6846;&#x3002;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">actionPerformed</span><span class=\"params\">(e: <span class=\"type\">AnActionEvent</span>)</span></span> {</span><br><span class=\"line\">    <span class=\"comment\">// AnActionEvent&#x7684;&#x6269;&#x5C55;&#x65B9;&#x6CD5;&#xFF0C;&#x76EE;&#x7684;&#x662F;&#x627E;&#x5230;&#x5F53;&#x524D;&#x64CD;&#x4F5C;&#x7684;&#x865A;&#x62DF;&#x6587;&#x4EF6;</span></span><br><span class=\"line\">    e.handleVirtualFile { project, virtualFile -&gt;</span><br><span class=\"line\">        NewLayoutDialog(project, virtualFile).show()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x91CD;&#x70B9;&#x662F;NewLayoutDialog&#x7684;&#x5185;&#x90E8;&#x5904;&#x7406;&#x903B;&#x8F91;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x3002;</p>\n<h2 id=\"&#x751F;&#x6210;Panel&#x5E03;&#x5C40;\"><a href=\"#&#x751F;&#x6210;Panel&#x5E03;&#x5C40;\" class=\"headerlink\" title=\"&#x751F;&#x6210;Panel&#x5E03;&#x5C40;\"></a>&#x751F;&#x6210;Panel&#x5E03;&#x5C40;</h2><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x8981;&#x505A;&#x7684;&#x662F;</p>\n<ol>\n<li>&#x521B;&#x5EFA;Dialog&#x5F39;&#x7A97;</li>\n<li>&#x7ED8;&#x5236;&#x5F39;&#x7A97;&#x5E03;&#x5C40;</li>\n<li>&#x5B9E;&#x73B0;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;</li>\n<li>&#x521B;&#x5EFA;&#x8D44;&#x6E90;&#x5E03;&#x5C40;&#x6587;&#x4EF6;</li>\n</ol>\n<p><img src=\"/2019/07/09/&#x53EA;&#x9700;&#x4E09;&#x6B65;&#x5B9E;&#x73B0;Databinding&#x63D2;&#x4EF6;&#x5316;/databinding_autorun_3.png\" alt></p>\n<h3 id=\"&#x521B;&#x5EFA;Dialog&#x5F39;&#x7A97;\"><a href=\"#&#x521B;&#x5EFA;Dialog&#x5F39;&#x7A97;\" class=\"headerlink\" title=\"&#x521B;&#x5EFA;Dialog&#x5F39;&#x7A97;\"></a>&#x521B;&#x5EFA;Dialog&#x5F39;&#x7A97;</h3><p>&#x5BF9;&#x4E8E;Dialog&#x5F39;&#x7A97;&#x7684;&#x521B;&#x5EFA;&#x4E5F;&#x662F;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x7684;&#xFF0C;&#x53EA;&#x9700;&#x7EE7;&#x627F;<strong>DialogWrapper</strong>&#x3002;&#x5728;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x8C03;&#x7528;&#x5B83;&#x7684;init&#x65B9;&#x6CD5;&#xFF0C;&#x4E4B;&#x540E;&#x5C31;&#x662F;&#x5B9E;&#x73B0;&#x5177;&#x4F53;&#x7684;&#x5E03;&#x5C40;createCenterPanel&#x4E0E;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;doOKAction&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">init</span> {</span><br><span class=\"line\">    title = <span class=\"string\">&quot;New DataBinding Layout Resource File&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">init</span>()</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">createCenterPanel</span><span class=\"params\">()</span></span>: JComponent? = panel</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">doOKAction</span><span class=\"params\">()</span></span> {}</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x7ED8;&#x5236;&#x5F39;&#x7A97;&#x5E03;&#x5C40;\"><a href=\"#&#x7ED8;&#x5236;&#x5F39;&#x7A97;&#x5E03;&#x5C40;\" class=\"headerlink\" title=\"&#x7ED8;&#x5236;&#x5F39;&#x7A97;&#x5E03;&#x5C40;\"></a>&#x7ED8;&#x5236;&#x5F39;&#x7A97;&#x5E03;&#x5C40;</h3><p>&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4F20;&#x7EDF;&#x7684;GUI&#x5E03;&#x5C40;&#xFF0C;&#x4E2A;&#x4EBA;&#x611F;&#x89C9;&#x975E;&#x5E38;&#x9EBB;&#x70E6;&#x3002;&#x56E0;&#x4E3A;&#x9879;&#x76EE;&#x4F7F;&#x7528;&#x7684;&#x662F;kotlin&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E86;<strong>Kotlin UI DSL</strong>&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x4E86;&#x89E3;&#x7684;&#x8BDD;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x94FE;&#x63A5;&#x3002;</p>\n<p><a href=\"http://www.jetbrains.org/intellij/sdk/docs/user_interface_components/kotlin_ui_dsl.html\" target=\"_blank\" rel=\"noopener\">http://www.jetbrains.org/intellij/sdk/docs/user_interface_components/kotlin_ui_dsl.html</a></p>\n<p>&#x8981;&#x5B9E;&#x73B0;&#x4E0A;&#x8FF0;&#x7684;&#x5E03;&#x5C40;&#x6548;&#x679C;&#xFF0C;&#x9700;&#x8981;&#x7EE7;&#x627F;<strong>JPanel</strong>&#xFF0C;&#x7136;&#x540E;&#x6DFB;&#x52A0;&#x4E24;&#x4E2A;&#x6587;&#x672C;label&#x4E0E;&#x8F93;&#x5165;&#x6846;JTextField&#x3002;&#x5177;&#x4F53;&#x5982;&#x4E0B;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NewLayoutPanel</span></span>(project: Project) : JPanel() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">val</span> fileName = JTextField()</span><br><span class=\"line\">    <span class=\"keyword\">val</span> rootElement = JTextField()</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">init</span> {</span><br><span class=\"line\">        layout = BorderLayout()</span><br><span class=\"line\">        <span class=\"keyword\">val</span> panel = panel(LCFlags.fill) {</span><br><span class=\"line\">            row(<span class=\"string\">&quot;File name:&quot;</span>) { fileName() }</span><br><span class=\"line\">            row(<span class=\"string\">&quot;Root element:&quot;</span>) { rootElement() }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        rootElement.text = SettingsComponent.getInstance(project).defaultRootElement</span><br><span class=\"line\"> </span><br><span class=\"line\">        add(panel, BorderLayout.CENTER)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getPreferredSize</span><span class=\"params\">()</span></span>: Dimension = Dimension(<span class=\"number\">300</span>, <span class=\"number\">40</span>)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4EE3;&#x7801;&#x4E2D;&#x7684;SettingsComponent&#x662F;&#x7528;&#x6765;&#x4FDD;&#x5B58;&#x6301;&#x4E45;&#x5316;&#x914D;&#x7F6E;&#x7684;&#xFF0C;&#x800C;&#x8FD9;&#x91CC;&#x662F;&#x83B7;&#x53D6;&#x8BBE;&#x7F6E;&#x9875;&#x9762;&#x914D;&#x7F6E;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x540E;&#x7EED;&#x4F1A;&#x63D0;&#x53CA;&#x5230;&#x3002;</p>\n<p>&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x5E03;&#x5C40;&#xFF0C;&#x518D;&#x5C06;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5E03;&#x5C40;&#x6DFB;&#x52A0;&#x5230;createCenterPanel&#x65B9;&#x6CD5;&#x4E2D;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x8981;&#x505A;&#x7684;&#x662F;&#x5B9E;&#x73B0;&#x5F39;&#x7A97;&#x7684;OK&#x70B9;&#x51FB;</p>\n<h3 id=\"&#x5B9E;&#x73B0;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;\"><a href=\"#&#x5B9E;&#x73B0;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;\"></a>&#x5B9E;&#x73B0;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;</h3><p>&#x70B9;&#x51FB;&#x7684;&#x903B;&#x8F91;&#x662F;&#xFF0C;&#x9996;&#x5148;&#x67E5;&#x770B;&#x5F53;&#x524D;&#x5C06;&#x8981;&#x521B;&#x5EFA;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x79F0;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#xFF0C;&#x5176;&#x6B21;&#x624D;&#x662F;&#x521B;&#x5EFA;&#x6587;&#x4EF6;&#xFF0C;&#x6DFB;&#x52A0;&#x5230;&#x76EE;&#x5F55;&#x4E2D;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x6587;&#x4EF6;&#x540D;&#x79F0;&#x662F;&#x5426;&#x91CD;&#x540D;&#xFF0C;&#x5F00;&#x59CB;&#x6211;&#x662F;&#x901A;&#x8FC7;&#x67E5;&#x627E;&#x8BE5;&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x6765;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x7684;&#xFF0C;&#x4F46;&#x540E;&#x6765;&#x53D1;&#x73B0;&#x65E0;&#x9700;&#x8FD9;&#x4E48;&#x9EBB;&#x70E6;&#x3002;&#x56E0;&#x4E3A;&#x5728;&#x6DFB;&#x52A0;&#x6587;&#x4EF6;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x8FDB;&#x884C;&#x81EA;&#x52A8;&#x5224;&#x65AD;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x91CD;&#x540D;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6355;&#x83B7;&#x5F02;&#x5E38;&#x6765;&#x8FDB;&#x884C;&#x5F39;&#x7A97;&#x63D0;&#x793A;&#x3002;</p>\n<p>&#x6587;&#x4EF6;&#x7684;&#x521B;&#x5EFA;&#x901A;&#x8FC7;PsiFileFactory&#x7684;createFileFromText&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">val</span> file = PsiFileFactory.getInstance(project)</span><br><span class=\"line\">    .createFileFromText(</span><br><span class=\"line\">        (panel.fileName.text</span><br><span class=\"line\">            ?: TemplateUtils.TEMPLATE_DATABINDING_FILE_NAME) + TemplateUtils.TEMPLATE_LAYOUT_SUFFIX,</span><br><span class=\"line\">        XMLLanguage.INSTANCE,</span><br><span class=\"line\">        TemplateUtils.getTemplateContent(panel.rootElement.text)</span><br><span class=\"line\">    )</span><br></pre></td></tr></table></figure>\n<p>&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x503C;&#x5206;&#x522B;&#x4E3A;</p>\n<ul>\n<li>&#x6587;&#x4EF6;&#x540D;: &#x901A;&#x8FC7;&#x5E03;&#x5C40;panel&#x83B7;&#x53D6;text</li>\n<li>&#x8BED;&#x8A00;: &#x56E0;&#x4E3A;&#x662F;.xml&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x7528;&#x662F;xml&#x8BED;&#x8A00;</li>\n<li>&#x5185;&#x5BB9;: &#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E86;&#x9884;&#x5148;&#x5B9A;&#x5236;&#x7684;&#x6A21;&#x677F;(&#x53EF;&#x4EFB;&#x610F;&#x4FEE;&#x6539;)</li>\n</ul>\n<p>&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x662F;&#x5C06;&#x6587;&#x4EF6;&#x6DFB;&#x52A0;&#x5230;layout&#x4E0B;&#xFF0C;&#x8FD9;&#x91CC;&#x8FD8;&#x662F;&#x8981;&#x4F7F;&#x7528;&#x4E4B;&#x524D;&#x7684;PsiManager&#x6765;&#x5B9A;&#x4F4D;&#x5230;layout&#x76EE;&#x5F55;&#x4E0B;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// &#x901A;&#x8FC7;Swing dispatch thread&#x6765;&#x8FDB;&#x884C;&#x5199;&#x64CD;&#x4F5C;</span></span><br><span class=\"line\">ApplicationManager.getApplication().runWriteAction {</span><br><span class=\"line\">    <span class=\"comment\">// module&#x7684;&#x6269;&#x5C55;&#x65B9;&#x6CD5;&#xFF0C;&#x76EE;&#x7684;&#x662F;&#x901A;&#x8FC7;PsiManager&#x5B9A;&#x4F4D;&#x5230;layout&#x76EE;&#x5F55;&#x4E0B;</span></span><br><span class=\"line\">    getModule()?.handleVirtualFile {</span><br><span class=\"line\">        <span class=\"comment\">// &#x5224;&#x65AD;&#x8BE5;&#x64CD;&#x4F5C;&#x662F;&#x5426;&#x5728;&#x53EF;&#x63A5;&#x53D7;&#x7684;&#x8303;&#x56F4;&#x5185;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (actionVirtualFile.path.contains(it.virtualFile.path)) {</span><br><span class=\"line\">            <span class=\"keyword\">try</span> {</span><br><span class=\"line\">                <span class=\"comment\">// &#x6DFB;&#x52A0;&#x6587;&#x4EF6;</span></span><br><span class=\"line\">                it.add(file)</span><br><span class=\"line\">                <span class=\"comment\">// &#x5173;&#x95ED;&#x5F39;&#x7A97;</span></span><br><span class=\"line\">                close(OK_EXIT_CODE)</span><br><span class=\"line\">            } <span class=\"keyword\">catch</span> (e: IncorrectOperationException) {</span><br><span class=\"line\">                <span class=\"comment\">// &#x5F02;&#x5E38;&#x5F39;&#x7A97;&#x63D0;&#x9192;</span></span><br><span class=\"line\">                NotificationUtils.showMessage(</span><br><span class=\"line\">                    project, <span class=\"string\">&quot;error&quot;</span>,</span><br><span class=\"line\">                    e.localizedMessage</span><br><span class=\"line\">                )</span><br><span class=\"line\">                e.printStackTrace()</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x73B0;&#x5728;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x5C06;&#x8981;&#x521B;&#x5EFA;&#x7684;&#x6587;&#x4EF6;&#x5B58;&#x5728;&#x91CD;&#x540D;&#xFF0C;&#x5C06;&#x4F1A;&#x5F39;&#x51FA;&#x5982;&#x4E0B;&#x63D0;&#x793A;</p>\n<p><img src=\"/2019/07/09/&#x53EA;&#x9700;&#x4E09;&#x6B65;&#x5B9E;&#x73B0;Databinding&#x63D2;&#x4EF6;&#x5316;/databinding_autorun_4.png\" alt></p>\n<p>&#x5F53;&#x7136;&#x5982;&#x679C;&#x6210;&#x529F;&#xFF0C;&#x6587;&#x4EF6;&#x5C31;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x5728;layout&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x540C;&#x65F6;&#x662F;Databinding&#x6A21;&#x5F0F;&#x7684;xml&#x6587;&#x4EF6;&#x3002;</p>\n<h2 id=\"&#x914D;&#x7F6E;&#x6301;&#x4E45;&#x5316;Component\"><a href=\"#&#x914D;&#x7F6E;&#x6301;&#x4E45;&#x5316;Component\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;&#x6301;&#x4E45;&#x5316;Component\"></a>&#x914D;&#x7F6E;&#x6301;&#x4E45;&#x5316;Component</h2><p>&#x5176;&#x5B9E;&#x5230;&#x8FD9;&#x91CC;&#x57FA;&#x672C;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x4F7F;&#x7528;&#x4E86;&#xFF0C;&#x4F46;&#x4E3A;&#x4E86;&#x8BE5;&#x63D2;&#x4EF6;&#x80FD;&#x66F4;&#x7075;&#x6D3B;&#x70B9;&#xFF0C;&#x6211;&#x8FD8;&#x662F;&#x589E;&#x52A0;&#x4E86;&#x914D;&#x7F6E;&#x529F;&#x80FD;&#x3002;</p>\n<p><img src=\"/2019/07/09/&#x53EA;&#x9700;&#x4E09;&#x6B65;&#x5B9E;&#x73B0;Databinding&#x63D2;&#x4EF6;&#x5316;/databinding_autorun_5.png\" alt></p>\n<p>&#x8FD9;&#x662F;&#x63D2;&#x4EF6;&#x7684;&#x8BBE;&#x7F6E;&#x9875;&#x9762;&#xFF0C;&#x6211;&#x5728;&#x8FD9;&#x91CC;&#x63D0;&#x4F9B;&#x4E86;Default Root Element&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x5B83;&#x662F;&#x521B;&#x5EFA;xml&#x6587;&#x4EF6;&#x7684;&#x5E03;&#x5C40;&#x6839;&#x8282;&#x70B9;&#x6807;&#x7B7E;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;LinearLayout&#xFF0C;&#x6240;&#x4EE5;&#x4F60;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4FEE;&#x6539;&#x5B83;&#x6765;&#x6539;&#x53D8;&#x6BCF;&#x6B21;&#x5F39;&#x7A97;&#x7684;&#x9ED8;&#x8BA4;&#x6839;&#x5E03;&#x5C40;&#x8282;&#x70B9;&#x6807;&#x7B7E;&#x3002;</p>\n<p>&#x5F53;&#x7136;&#x8FD9;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x5C0F;&#x529F;&#x80FD;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x63D0;&#x51FA;&#x662F;&#x4E3A;&#x4E86;&#x8BA9;&#x5927;&#x5BB6;&#x4E86;&#x89E3;&#x8BBE;&#x7F6E;&#x9875;&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>\n<p>&#x4E4B;&#x524D;&#x6211;&#x8FD8;&#x5B9E;&#x73B0;&#x4E86;&#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;xml&#x7684;&#x5185;&#x5BB9;&#x6A21;&#x677F;&#xFF0C;&#x4F46;&#x540E;&#x6765;&#x60F3;&#x610F;&#x4E49;&#x5E76;&#x4E0D;&#x5927;&#x5C31;&#x5220;&#x9664;&#x6389;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x65E5;&#x5E38;&#x5F00;&#x53D1;&#x4E2D;&#x5E03;&#x5C40;&#x7684;&#x5185;&#x5BB9;&#x90FD;&#x662F;&#x591A;&#x53D8;&#x7684;&#xFF0C;&#x552F;&#x4E00;&#x80FD;&#x7A0D;&#x5FAE;&#x56FA;&#x5B9A;&#x7684;&#x4E5F;&#x5C31;&#x662F;&#x5E03;&#x5C40;&#x7684;&#x6839;&#x8282;&#x70B9;&#x4E86;&#x3002;</p>\n<h3 id=\"Setting&#x5E03;&#x5C40;\"><a href=\"#Setting&#x5E03;&#x5C40;\" class=\"headerlink\" title=\"Setting&#x5E03;&#x5C40;\"></a>Setting&#x5E03;&#x5C40;</h3><p>&#x5BF9;&#x4E8E;&#x8BBE;&#x7F6E;&#x9875;&#x7684;&#x5E03;&#x5C40;&#xFF0C;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;label&#x4E0E;JTextField&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x6E90;&#x7801;</p>\n<h3 id=\"Configurable\"><a href=\"#Configurable\" class=\"headerlink\" title=\"Configurable\"></a>Configurable</h3><p>&#x8BBE;&#x7F6E;&#x9875;&#x9700;&#x8981;&#x5B9E;&#x73B0;Configurable&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x4F1A;&#x63D0;&#x4F9B;&#x662F;4&#x4E2A;&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">isModified</span><span class=\"params\">()</span></span>: <span class=\"built_in\">Boolean</span> = modified</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getDisplayName</span><span class=\"params\">()</span></span>: String = <span class=\"string\">&quot;DataBinding Autorun&quot;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">apply</span><span class=\"params\">()</span></span> {</span><br><span class=\"line\">    SettingsComponent.getInstance(project).defaultRootElement = settingsPanel.defaultRootElement.text</span><br><span class=\"line\">    modified = <span class=\"literal\">false</span></span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">createComponent</span><span class=\"params\">()</span></span>: JComponent? = settingsPanel.apply {</span><br><span class=\"line\">    defaultRootElement.text = SettingsComponent.getInstance(project).defaultRootElement</span><br><span class=\"line\">    defaultRootElement.document.addDocumentListener(<span class=\"keyword\">this</span><span class=\"symbol\">@SettingsConfigurable</span>)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<ul>\n<li>isModified: &#x662F;&#x5426;&#x8FDB;&#x884C;&#x4E86;&#x4FEE;&#x6539;&#xFF0C;&#x4E3A;true&#x7684;&#x8BDD;&#x8BBE;&#x7F6E;&#x9875;&#x7684;Apply&#x5C31;&#x4F1A;&#x53D8;&#x6210;&#x53EF;&#x70B9;&#x51FB;</li>\n<li>getDisplayName: &#x5728;Android Studio&#x7684;OtherSettings&#x4E2D;&#x5C55;&#x793A;&#x7684;&#x540D;&#x79F0;</li>\n<li>apply: Apply&#x7684;&#x70B9;&#x51FB;&#x56DE;&#x8C03;</li>\n<li>createComponent: &#x5E03;&#x5C40;</li>\n</ul>\n<p>&#x5BF9;&#x4E8E;isModified&#x7684;&#x5224;&#x65AD;&#x903B;&#x8F91;&#xFF0C;&#x5F15;&#x5165;&#x5BF9;document&#x7684;&#x76D1;&#x542C;DocumentListener</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">changedUpdate</span><span class=\"params\">(e: <span class=\"type\">DocumentEvent</span>?)</span></span> {</span><br><span class=\"line\">    modified = <span class=\"literal\">true</span></span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">insertUpdate</span><span class=\"params\">(e: <span class=\"type\">DocumentEvent</span>?)</span></span> {</span><br><span class=\"line\">    modified = <span class=\"literal\">true</span></span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">removeUpdate</span><span class=\"params\">(e: <span class=\"type\">DocumentEvent</span>?)</span></span> {</span><br><span class=\"line\">    modified = <span class=\"literal\">true</span></span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x63D0;&#x4F9B;&#x7684;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;&#x53EA;&#x8981;&#x53D1;&#x751F;&#x4E86;&#x56DE;&#x8C03;&#xFF0C;&#x5C31;&#x8BA4;&#x4E3A;&#x662F;&#x7F16;&#x8F91;&#x4E86;&#x8BE5;&#x8BBE;&#x7F6E;&#x9875;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x5728;apply&#x4E0E;createComponent&#x4E2D;&#x90FD;&#x7528;&#x5230;&#x4E86;SettingsComponent&#xFF0C;&#x5B83;&#x662F;&#x7528;&#x6765;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x7684;&#xFF0C;&#x4FDD;&#x8BC1;&#x8BBE;&#x7F6E;&#x7684;defaultRootElement&#x80FD;&#x591F;&#x5B9E;&#x65F6;&#x4FDD;&#x5B58;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;Android&#x7684;sharedpreferences</p>\n<h3 id=\"PersistentStateComponent\"><a href=\"#PersistentStateComponent\" class=\"headerlink\" title=\"PersistentStateComponent\"></a>PersistentStateComponent</h3><p>&#x8981;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x7684;&#x6301;&#x4E45;&#x8BDD;&#xFF0C;&#x9700;&#x8981;&#x5B9E;&#x73B0;PersistentStateComponent&#x63A5;&#x53E3;&#x3002;&#x5B83;&#x4F1A;&#x66B4;&#x9732;getState&#x4E0E;loadState&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x6765;&#x83B7;&#x53D6;&#x4E0E;&#x4FDD;&#x5B58;&#x72B6;&#x6001;&#x3002;</p>\n<p>&#x5B83;&#x7684;&#x4FDD;&#x5B58;&#x65B9;&#x5F0F;&#x4E5F;&#x662F;&#x901A;&#x8FC7;.xml&#x7684;&#x6587;&#x4EF6;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x4FDD;&#x5B58;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x4F7F;&#x7528;@state&#x6765;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#xFF0C;&#x5177;&#x4F53;&#x5982;&#x4E0B;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@State(</span></span><br><span class=\"line\"><span class=\"meta\">    name = <span class=\"meta-string\">&quot;SettingsConfiguration&quot;</span>,</span></span><br><span class=\"line\"><span class=\"meta\">    storages = [Storage(value = <span class=\"meta-string\">&quot;settingsConfiguration.xml&quot;</span>)</span>]</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SettingsComponent</span> : <span class=\"type\">PersistentStateComponent</span>&lt;<span class=\"type\">SettingsComponent</span>&gt; </span>{</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">var</span> defaultRootElement = <span class=\"string\">&quot;LinearLayout&quot;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">companion</span> <span class=\"keyword\">object</span> {</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getInstance</span><span class=\"params\">(project: <span class=\"type\">Project</span>)</span></span>: SettingsComponent =</span><br><span class=\"line\">            ServiceManager.getService(project, SettingsComponent::<span class=\"class\"><span class=\"keyword\">class</span>.<span class=\"title\">java</span>)</span></span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getState</span><span class=\"params\">()</span></span>: SettingsComponent? = <span class=\"keyword\">this</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">loadState</span><span class=\"params\">(state: <span class=\"type\">SettingsComponent</span>)</span></span> {</span><br><span class=\"line\">        XmlSerializerUtil.copyBean(state, <span class=\"keyword\">this</span>)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8BE5;&#x72B6;&#x6001;&#x540D;&#x4E3A;SettingConfiguration&#xFF0C;&#x4FDD;&#x5B58;&#x5728;settingConfiguration.xml&#x6587;&#x4EF6;&#x4E2D;&#x3002;&#x4FDD;&#x5B58;&#x65B9;&#x5F0F;&#x4F1A;&#x501F;&#x52A9;XmlSerializerUtil&#x6765;&#x5B9E;&#x73B0;&#x3002;</p>\n<p>&#x5F53;&#x7136;&#x4E3A;&#x4E86;&#x4FDD;&#x5B58;&#x8BE5;&#x5B9E;&#x4F8B;&#x7684;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;ServiceManager&#x7684;getService&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x5B83;&#x7684;&#x5B9E;&#x4F8B;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x4E0A;&#x9762;&#x7684;Configurable&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#x65B9;&#x5F0F;&#x3002;</p>\n<h3 id=\"&#x914D;&#x7F6E;\"><a href=\"#&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;\"></a>&#x914D;&#x7F6E;</h3><p>&#x81EA;&#x5B9A;&#x4E49;&#x7684;SettingsConfigurable&#x4E0E;SettingsComponent&#x90FD;&#x9700;&#x8981;&#x5230;plugin.xml&#x4E2D;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#xFF0C;&#x8FD9;&#x4E0E;&#x4E4B;&#x524D;&#x7684;Action&#x7C7B;&#x4F3C;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;Android&#x7684;&#x56DB;&#x5927;&#x7EC4;&#x4EF6;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;extensions defaultExtensionNs=&quot;com.intellij&quot;&gt;</span><br><span class=\"line\">    &lt;!-- Add your extensions here --&gt;</span><br><span class=\"line\">    &lt;defaultProjectTypeProvider type=&quot;Android&quot;/&gt;</span><br><span class=\"line\">    &lt;projectConfigurable instance=&quot;com.idisfkj.databinding.autorun.ui.settings.SettingsConfigurable&quot;/&gt;</span><br><span class=\"line\">    &lt;projectService serviceInterface=&quot;com.idisfkj.databinding.autorun.component.SettingsComponent&quot;</span><br><span class=\"line\">                    serviceImplementation=&quot;com.idisfkj.databinding.autorun.component.SettingsComponent&quot;/&gt;</span><br><span class=\"line\">&lt;/extensions&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;project-components&gt;</span><br><span class=\"line\">    &lt;component&gt;</span><br><span class=\"line\">        &lt;implementation-class&gt;</span><br><span class=\"line\">            com.idisfkj.databinding.autorun.component.SettingsComponent</span><br><span class=\"line\">        &lt;/implementation-class&gt;</span><br><span class=\"line\">    &lt;/component&gt;</span><br><span class=\"line\">&lt;/project-components&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x7531;&#x4E8E;SettingsComponent&#x662F;project&#x7EA7;&#x522B;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5305;&#x542B;&#x5728;project-components&#x6807;&#x7B7E;&#x4E2D;&#xFF1B;&#x53E6;&#x4E00;&#x65B9;&#x9762;SettingsConfigurable&#x5728;&#x914D;&#x7F6E;&#x4E2D;&#x7EDF;&#x4E00;&#x5F52;&#x4E8E;extensions&#x6807;&#x7B7E;&#xFF0C;&#x81F3;&#x4E8E;&#x4E3A;&#x4EC0;&#x4E48;&#xFF0C;&#x8FD9;&#x5C31;&#x6D89;&#x53CA;&#x5230;&#x6269;&#x5C55;&#x4E86;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x8BF4;&#x5C31;&#x662F;&#x522B;&#x4EBA;&#x53EF;&#x4EE5;&#x5728;&#x4F60;&#x7684;&#x63D2;&#x4EF6;&#x57FA;&#x7840;&#x4E0A;&#x8FDB;&#x884C;&#x4E0D;&#x540C;&#x7A0B;&#x5EA6;&#x7684;&#x6269;&#x5C55;&#xFF0C;&#x5C31;&#x662F;&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;&#x7684;&#x3002;&#x7531;&#x4E8E;&#x8FD9;&#x53C8;&#x662F;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x8BDD;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x53BB;&#x4E86;&#x89E3;&#x3002;</p>\n<h2 id=\"&#x7ED3;&#x8BED;\"><a href=\"#&#x7ED3;&#x8BED;\" class=\"headerlink\" title=\"&#x7ED3;&#x8BED;\"></a>&#x7ED3;&#x8BED;</h2><p>&#x5173;&#x4E8E;Databinding&#x63D2;&#x4EF6;&#x5316;&#x7684;&#x5B9A;&#x5236;&#x5C31;&#x5230;&#x8FD9;&#x91CC;&#x4E86;&#xFF0C;&#x6E90;&#x7801;&#x5DF2;&#x7ECF;&#x5728;&#x6587;&#x7AE0;&#x5F00;&#x5934;&#x7ED9;&#x51FA;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x5BF9;&#x8BE5;&#x63D2;&#x4EF6;&#x6709;&#x522B;&#x7684;&#x5EFA;&#x8BAE;&#xFF0C;&#x6B22;&#x8FCE;@&#x6211;&#xFF1B;&#x4EA6;&#x6216;&#x8005;&#x4F60;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x4FBF;&#x7684;&#x5730;&#x65B9;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;github&#x4E2D;&#x63D0;issue&#xFF0C;&#x6211;&#x4E5F;&#x4F1A;&#x7B2C;&#x4E00;&#x65F6;&#x95F4;&#x8FDB;&#x884C;&#x4F18;&#x5316;&#x3002;</p>\n","categories":["android"],"tags":["plugin"]},{"title":"What? 你还不知道Kotlin Coroutine?","url":"https://www.rousetime.com/2019/06/17/What-你还不知道Kotlin-Coroutine/","content":"<p>&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x6765;&#x804A;&#x804A;Kotlin Coroutine&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x6CA1;&#x6709;&#x4E86;&#x89E3;&#x8FC7;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x8981;&#x63D0;&#x524D;&#x606D;&#x559C;&#x4F60;&#xFF0C;&#x56E0;&#x4E3A;&#x4F60;&#x5C06;&#x638C;&#x63E1;&#x4E00;&#x4E2A;&#x65B0;&#x6280;&#x80FD;&#xFF0C;&#x5BF9;&#x4F60;&#x7684;&#x4EE3;&#x7801;&#x65B9;&#x9762;&#x7684;&#x63D0;&#x5347;&#x5C06;&#x662F;&#x5F88;&#x597D;&#x7684;&#x52A9;&#x529B;&#x3002;</p>\n<h2 id=\"What-Coroutine\"><a href=\"#What-Coroutine\" class=\"headerlink\" title=\"What Coroutine\"></a>What Coroutine</h2><p>&#x7B80;&#x5355;&#x7684;&#x6765;&#x8BF4;&#xFF0C;Coroutine&#x662F;&#x4E00;&#x4E2A;&#x5E76;&#x53D1;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x4F60;&#x80FD;&#x901A;&#x8FC7;&#x5B83;&#x4F7F;&#x7528;&#x66F4;&#x7B80;&#x6D01;&#x7684;&#x4EE3;&#x7801;&#x6765;&#x89E3;&#x51B3;&#x5F02;&#x6B65;&#x95EE;&#x9898;&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#xFF0C;&#x5728;Android&#x65B9;&#x9762;&#x5B83;&#x4E3B;&#x8981;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x4F60;&#x89E3;&#x51B3;&#x4EE5;&#x4E0B;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;</p>\n<ol>\n<li>&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;&#x8017;&#x65F6;&#x4EFB;&#x52A1;&#x5BFC;&#x81F4;&#x7684;&#x4E3B;&#x7EBF;&#x7A0B;&#x963B;&#x585E;&#xFF0C;&#x4ECE;&#x800C;&#x4F7F;App&#x53D1;&#x751F;ANR&#x3002;</li>\n<li>&#x63D0;&#x4F9B;&#x4E3B;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#xFF0C;&#x540C;&#x65F6;&#x5BF9;&#x6765;&#x81EA;&#x4E8E;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;&#x7F51;&#x7EDC;&#x56DE;&#x8C03;&#x3001;&#x78C1;&#x76D8;&#x64CD;&#x63D0;&#x4F9B;&#x4FDD;&#x969C;&#x3002;</li>\n</ol>\n<p>&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x5728;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x6587;&#x7AE0;&#x4E2D;&#x6211;&#x90FD;&#x4F1A;&#x7ED9;&#x51FA;&#x89E3;&#x51B3;&#x7684;&#x793A;&#x4F8B;&#x3002;</p>\n<h2 id=\"Callback\"><a href=\"#Callback\" class=\"headerlink\" title=\"Callback\"></a>Callback</h2><p>&#x8BF4;&#x5230;&#x5F02;&#x6B65;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x4E0B;&#x6211;&#x4EEC;&#x5E38;&#x89C4;&#x7684;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x3002;&#x9996;&#x5148;&#x7B2C;&#x4E00;&#x79CD;&#x662F;&#x6700;&#x57FA;&#x672C;&#x7684;callback&#x65B9;&#x5F0F;&#x3002;</p>\n<p>callback&#x7684;&#x597D;&#x5904;&#x662F;&#x4F7F;&#x7528;&#x8D77;&#x6765;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x4F60;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x53EF;&#x80FD;&#x4F1A;&#x9047;&#x5230;&#x5982;&#x4E0B;&#x60C5;&#x5F62;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GatheringVoiceSettingRepository.getInstance().getGeneralSettings(RequestLanguage::<span class=\"class\"><span class=\"keyword\">class</span>.<span class=\"title\">java</span>)</span></span><br><span class=\"line\">        .observe(<span class=\"keyword\">this</span>, { language -&gt;</span><br><span class=\"line\">            convertResult(language, { enable -&gt; </span><br><span class=\"line\">                <span class=\"comment\">// todo something</span></span><br><span class=\"line\">            })</span><br><span class=\"line\">        })</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x79CD;&#x5728;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;callback&#x4E2D;&#x56DE;&#x8C03;&#x53E6;&#x4E00;&#x4E2A;callback&#x56DE;&#x8C03;&#xFF0C;&#x751A;&#x81F3;&#x66F4;&#x591A;&#x7684;callback&#x90FD;&#x662F;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x3002;&#x8FD9;&#x4E9B;&#x60C5;&#x51B5;&#x5BFC;&#x81F4;&#x7684;&#x95EE;&#x9898;&#x662F;&#x4EE3;&#x7801;&#x95F4;&#x7684;&#x5D4C;&#x5957;&#x5C42;&#x7EA7;&#x592A;&#x6DF1;&#xFF0C;&#x5BFC;&#x81F4;&#x903B;&#x8F91;&#x5D4C;&#x5957;&#x590D;&#x6742;&#xFF0C;&#x540E;&#x7EED;&#x7684;&#x7EF4;&#x62A4;&#x6210;&#x672C;&#x4E5F;&#x8981;&#x63D0;&#x9AD8;&#xFF0C;&#x8FD9;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x6240;&#x8981;&#x770B;&#x5230;&#x7684;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x6709;&#x4EC0;&#x4E48;&#x65B9;&#x6CD5;&#x80FD;&#x591F;&#x89E3;&#x51B3;&#x5462;&#xFF1F;&#x5F53;&#x7136;&#x6709;&#xFF0C;&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x6211;&#x63A5;&#x4E0B;&#x6765;&#x8981;&#x8BF4;&#x7684;&#x7B2C;&#x4E8C;&#x79CD;&#x65B9;&#x5F0F;&#x3002;</p>\n<h2 id=\"Rx&#x7CFB;&#x5217;\"><a href=\"#Rx&#x7CFB;&#x5217;\" class=\"headerlink\" title=\"Rx&#x7CFB;&#x5217;\"></a>Rx&#x7CFB;&#x5217;</h2><p>&#x5BF9;&#x591A;&#x5D4C;&#x5957;&#x56DE;&#x8C03;&#xFF0C;Rx&#x7CFB;&#x5217;&#x5728;&#x8FD9;&#x65B9;&#x9762;&#x5904;&#x7406;&#x7684;&#x5DF2;&#x7ECF;&#x975E;&#x5E38;&#x597D;&#x4E86;&#xFF0C;&#x4F8B;&#x5982;RxJava&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x4E0B;RxJava&#x7684;&#x89E3;&#x51B3;&#x6848;&#x4F8B;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">disposable = createCall().map {</span><br><span class=\"line\">    <span class=\"comment\">// return RequestType</span></span><br><span class=\"line\">}.subscribeWith(<span class=\"keyword\">object</span> : SMDefaultDisposableObserver&lt;RequestType&gt;{</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onNext</span><span class=\"params\">(t: <span class=\"type\">RequestType</span>)</span></span> {</span><br><span class=\"line\">        <span class=\"comment\">// todo something</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">})</span><br></pre></td></tr></table></figure>\n<p>RxJava&#x4E30;&#x5BCC;&#x7684;&#x64CD;&#x4F5C;&#x7B26;&#xFF0C;&#x518D;&#x7ED3;&#x5408;Observable&#x4E0E;Subscribe&#x80FD;&#x591F;&#x5F88;&#x597D;&#x7684;&#x89E3;&#x51B3;&#x5F02;&#x6B65;&#x5D4C;&#x5957;&#x56DE;&#x8C03;&#x95EE;&#x9898;&#x3002;&#x4F46;&#x662F;&#x5B83;&#x7684;&#x4F7F;&#x7528;&#x6210;&#x672C;&#x5C31;&#x76F8;&#x5BF9;&#x63D0;&#x9AD8;&#x4E86;&#xFF0C;&#x4F60;&#x8981;&#x5BF9;&#x5B83;&#x7684;&#x64CD;&#x4F5C;&#x7B26;&#x8981;&#x975E;&#x5E38;&#x4E86;&#x89E3;&#xFF0C;&#x907F;&#x514D;&#x5728;&#x4F7F;&#x7528;&#x8FC7;&#x7A0B;&#x4E2D;&#x6EE5;&#x7528;&#x6216;&#x8005;&#x8FC7;&#x5EA6;&#x4F7F;&#x7528;&#xFF0C;&#x8FD9;&#x6837;&#x81EA;&#x7136;&#x590D;&#x6742;&#x5EA6;&#x5C31;&#x63D0;&#x5347;&#x4E86;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x6E34;&#x671B;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#x80FD;&#x591F;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x5168;&#x9762;&#x4E0E;&#x5065;&#x58EE;&#xFF0C;&#x800C;&#x6211;&#x4EEC;&#x4ECA;&#x5929;&#x7684;&#x4E3B;&#x9898;Coroutine&#x5C31;&#x80FD;&#x591F;&#x8FBE;&#x5230;&#x8FD9;&#x79CD;&#x6548;&#x679C;&#x3002;</p>\n<h2 id=\"Coroutine&#x5728;Kotlin&#x4E2D;&#x7684;&#x57FA;&#x672C;&#x8981;&#x70B9;\"><a href=\"#Coroutine&#x5728;Kotlin&#x4E2D;&#x7684;&#x57FA;&#x672C;&#x8981;&#x70B9;\" class=\"headerlink\" title=\"Coroutine&#x5728;Kotlin&#x4E2D;&#x7684;&#x57FA;&#x672C;&#x8981;&#x70B9;\"></a>Coroutine&#x5728;Kotlin&#x4E2D;&#x7684;&#x57FA;&#x672C;&#x8981;&#x70B9;</h2><p>&#x5728;Android&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x5E94;&#x8BE5;&#x653E;&#x5230;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#xFF0C;&#x76F8;&#x5E94;&#x7684;&#x56DE;&#x8C03;&#x5904;&#x7406;&#x4E00;&#x822C;&#x90FD;&#x662F;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF0C;&#x5373;ui&#x7EBF;&#x7A0B;&#x3002;&#x6B63;&#x5E38;&#x7684;&#x5199;&#x6CD5;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x4F7F;&#x7528;Coroutine&#x53C8;&#x8BE5;&#x662F;&#x600E;&#x4E48;&#x6837;&#x7684;&#x5462;&#xFF1F;&#x8BF7;&#x770B;&#x4E0B;&#x9762;&#x4EE3;&#x7801;&#x793A;&#x4F8B;&#xFF1A;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">suspend</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">get</span><span class=\"params\">(url: <span class=\"type\">String</span>)</span></span> = withContext(Dispatchers.IO) {</span><br><span class=\"line\">    <span class=\"comment\">// to do network request</span></span><br><span class=\"line\">    url</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">suspend</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">fetch</span><span class=\"params\">()</span></span> { <span class=\"comment\">// &#x5728;Main&#x4E2D;&#x8C03;&#x7528;</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> result = <span class=\"keyword\">get</span>(<span class=\"string\">&quot;https://rousetime.com&quot;</span>) <span class=\"comment\">// &#x5728;IO&#x4E2D;&#x8C03;&#x7528;</span></span><br><span class=\"line\">    showToast(result) <span class=\"comment\">// &#x5728;Main&#x4E2D;&#x8C03;&#x7528;</span></span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;fetch&#x65B9;&#x6CD5;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x8C03;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x4F7F;&#x7528;Coroutine&#x6765;&#x5904;&#x7406;&#x5F02;&#x6B65;&#x56DE;&#x8C03;&#x5C31;&#x50CF;&#x662F;&#x5728;&#x5904;&#x7406;&#x540C;&#x6B65;&#x56DE;&#x8C03;&#x4E00;&#x6837;&#xFF0C;&#x7B80;&#x6D01;&#x660E;&#x4E86;&#x3001;&#x884C;&#x4E91;&#x6D41;&#x6C34;&#xFF0C;&#x540C;&#x65F6;&#x518D;&#x4E5F;&#x6CA1;&#x6709;&#x5D4C;&#x5957;&#x7684;&#x903B;&#x8F91;&#x4E86;&#x3002;</p>\n<p>&#x6CE8;&#x610F;&#x770B;&#x65B9;&#x6CD5;&#xFF0C;Coroutine&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x5B9E;&#x73B0;&#x8FD9;&#x79CD;&#x7B80;&#x5355;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x589E;&#x52A0;&#x4E86;&#x4E24;&#x4E2A;&#x64CD;&#x4F5C;&#x6765;&#x89E3;&#x51B3;&#x8017;&#x65F6;&#x4EFB;&#x52A1;&#xFF0C;&#x5206;&#x522B;&#x4E3A;suspend&#x4E0E;resume</p>\n<ul>\n<li>suspend: &#x6302;&#x8D77;&#x5F53;&#x524D;&#x6267;&#x884C;&#x7684;&#x534F;&#x540C;&#x7A0B;&#x5E8F;&#xFF0C;&#x5E76;&#x4E14;&#x4FDD;&#x5B58;&#x6B64;&#x523B;&#x7684;&#x6240;&#x6709;&#x672C;&#x5730;&#x53D8;&#x91CF;</li>\n<li>resume: &#x4ECE;&#x5B83;&#x88AB;&#x6302;&#x8D77;&#x7684;&#x4F4D;&#x7F6E;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#xFF0C;&#x5E76;&#x4E14;&#x6302;&#x8D77;&#x65F6;&#x4FDD;&#x5B58;&#x7684;&#x6570;&#x636E;&#x4E5F;&#x88AB;&#x8FD8;&#x539F;</li>\n</ul>\n<p>&#x89E3;&#x91CA;&#x7684;&#x6709;&#x70B9;&#x751F;&#x786C;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x6765;&#x8BF4;&#x5C31;&#x662F;suspend&#x53EF;&#x4EE5;&#x5C06;&#x8BE5;&#x4EFB;&#x52A1;&#x6302;&#x8D77;&#xFF0C;&#x4F7F;&#x5B83;&#x6682;&#x65F6;&#x4E0D;&#x5728;&#x8C03;&#x7528;&#x7684;&#x7EBF;&#x7A0B;&#x4E2D;&#xFF0C;&#x4EE5;&#x81F3;&#x4E8E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x522B;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x4E00;&#x65E6;&#x88AB;&#x6302;&#x8D77;&#x7684;&#x4EFB;&#x52A1;&#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x901A;&#x8FC7;resume&#x5C06;&#x5176;&#x91CD;&#x65B0;&#x63D2;&#x5165;&#x5230;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E2D;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x4E0A;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x5C55;&#x793A;&#x7684;&#x662F;&#xFF0C;&#x5F53;get&#x8FD8;&#x5728;&#x8BF7;&#x6C42;&#x7684;&#x65F6;&#x5019;&#xFF0C;fetch&#x65B9;&#x6CD5;&#x5C06;&#x4F1A;&#x88AB;&#x6302;&#x8D77;&#xFF0C;&#x76F4;&#x5230;get&#x7ED3;&#x675F;&#xFF0C;&#x6B64;&#x65F6;&#x624D;&#x4F1A;&#x63D2;&#x5165;&#x5230;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x5E76;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;</p>\n<p>&#x4E00;&#x56FE;&#x80DC;&#x5343;&#x8A00;&#xFF0C;&#x6211;&#x505A;&#x4E86;&#x4E00;&#x5F20;&#x56FE;&#xFF0C;&#x5E0C;&#x671B;&#x80FD;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#x3002;</p>\n<p><img src=\"/2019/06/17/What-&#x4F60;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;Kotlin-Coroutine/coroutine.png\" alt></p>\n<p>&#x53E6;&#x5916;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;suspend&#x65B9;&#x6CD5;&#x53EA;&#x80FD;&#x591F;&#x88AB;&#x5176;&#x5B83;&#x7684;suspend&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x6216;&#x8005;&#x88AB;&#x4E00;&#x4E2A;coroutine&#x8C03;&#x7528;&#xFF0C;&#x4F8B;&#x5982;launch&#x3002;</p>\n<h3 id=\"Dispatchers\"><a href=\"#Dispatchers\" class=\"headerlink\" title=\"Dispatchers\"></a>Dispatchers</h3><p>&#x53E6;&#x4E00;&#x65B9;&#x9762;Coroutine&#x4F7F;&#x7528;Dispatchers&#x6765;&#x8D1F;&#x8D23;&#x8C03;&#x5EA6;&#x534F;&#x8C03;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x4E0E;RxJava&#x7684;schedules&#x6709;&#x70B9;&#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x4E0D;&#x540C;&#x7684;&#x662F;Coroutine&#x4E00;&#x5B9A;&#x8981;&#x6267;&#x884C;&#x5728;Dispatchers&#x8C03;&#x5EA6;&#x4E2D;&#xFF0C;&#x56E0;&#x4E3A;Dispatchers&#x5C06;&#x8D1F;&#x8D23;resume&#x88AB;suspend&#x7684;&#x4EFB;&#x52A1;&#x3002;</p>\n<p>Dispatchers&#x63D0;&#x4F9B;&#x4E09;&#x79CD;&#x6A21;&#x5F0F;&#x5207;&#x6362;&#xFF0C;&#x5206;&#x522B;&#x4E3A;</p>\n<ol>\n<li>Dispatchers.Main: &#x4F7F;Coroutine&#x8FD0;&#x884C;&#x4E2D;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF0C;&#x4EE5;&#x4FBF;UI&#x64CD;&#x4F5C;</li>\n<li>Dispatchers.IO: &#x4F7F;Coroutine&#x8FD0;&#x884C;&#x5728;IO&#x7EBF;&#x7A0B;&#xFF0C;&#x4EE5;&#x4FBF;&#x6267;&#x884C;&#x7F51;&#x7EDC;&#x6216;&#x8005;I/O&#x64CD;&#x4F5C;</li>\n<li>Dispatchers.Default: &#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E4B;&#x5916;&#x63D0;&#x9AD8;&#x5BF9;CPU&#x7684;&#x5229;&#x7528;&#x7387;&#xFF0C;&#x4F8B;&#x5982;&#x5BF9;list&#x7684;&#x6392;&#x5E8F;&#x6216;&#x8005;JSON&#x7684;&#x89E3;&#x6790;&#x3002;</li>\n</ol>\n<p>&#x518D;&#x6765;&#x770B;&#x4E0A;&#x9762;&#x7684;&#x793A;&#x4F8B;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">suspend</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">get</span><span class=\"params\">(url: <span class=\"type\">String</span>)</span></span> = withContext(Dispatchers.IO) {</span><br><span class=\"line\">    <span class=\"comment\">// to do network request</span></span><br><span class=\"line\">    url</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">suspend</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">fetch</span><span class=\"params\">()</span></span> { <span class=\"comment\">// &#x5728;Main&#x4E2D;&#x8C03;&#x7528;</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> result = <span class=\"keyword\">get</span>(<span class=\"string\">&quot;https://rousetime.com&quot;</span>) <span class=\"comment\">// &#x5728;IO&#x4E2D;&#x8C03;&#x7528;</span></span><br><span class=\"line\">    showToast(result) <span class=\"comment\">// &#x5728;Main&#x4E2D;&#x8C03;&#x7528;</span></span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E3A;&#x4E86;&#x8BA9;get&#x64CD;&#x4F5C;&#x8FD0;&#x884C;&#x5728;IO&#x7EBF;&#x7A0B;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;withContext&#x65B9;&#x6CD5;&#xFF0C;&#x5BF9;&#x8BE5;&#x65B9;&#x6CD5;&#x4F20;&#x5165;Dispatchers.IO&#xFF0C;&#x4F7F;&#x5F97;&#x5B83;&#x95ED;&#x5305;&#x4E0B;&#x7684;&#x4EFB;&#x52A1;&#x90FD;&#x5904;&#x4E8E;IO&#x7EBF;&#x7A0B;&#x4E2D;&#xFF0C;&#x540C;&#x65F6;witchContext&#x4E5F;&#x662F;&#x4E00;&#x4E2A;suspend&#x51FD;&#x6570;&#x3002;</p>\n<h3 id=\"&#x521B;&#x5EFA;Coroutine\"><a href=\"#&#x521B;&#x5EFA;Coroutine\" class=\"headerlink\" title=\"&#x521B;&#x5EFA;Coroutine\"></a>&#x521B;&#x5EFA;Coroutine</h3><p>&#x4E0A;&#x9762;&#x63D0;&#x5230;suspend&#x51FD;&#x6570;&#x53EA;&#x80FD;&#x5728;&#x76F8;&#x5E94;&#x7684;suspend&#x4E2D;&#x6216;&#x8005;Coroutine&#x4E2D;&#x8C03;&#x7528;&#x3002;&#x90A3;&#x4E48;Coroutine&#x53C8;&#x8BE5;&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x5462;&#xFF1F;</p>\n<p>&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x5206;&#x522B;&#x4E3A;launch&#x4E0E;async</p>\n<ol>\n<li>launch: &#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x65B0;&#x7684;Coroutine&#xFF0C;&#x4F46;&#x4E0D;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</li>\n<li>async: &#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x65B0;&#x7684;Coroutine&#xFF0C;&#x4F46;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</li>\n</ol>\n<p>&#x8FD8;&#x662F;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6267;&#x884C;fetch&#x65B9;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;launch&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Coroutine</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">excute</span><span class=\"params\">()</span></span> {</span><br><span class=\"line\">    CoroutineScope(Dispatchers.Main).launch {</span><br><span class=\"line\">        fetch()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x53E6;&#x4E00;&#x79CD;async&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x7B49;&#x6240;&#x6709;async&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;await&#x6216;&#x8005;awaitAll</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">suspend</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">fetchAll</span><span class=\"params\">()</span></span> {</span><br><span class=\"line\">        coroutineScope {</span><br><span class=\"line\">            <span class=\"keyword\">val</span> deferredFirst = async { <span class=\"keyword\">get</span>(<span class=\"string\">&quot;first&quot;</span>) }</span><br><span class=\"line\">            <span class=\"keyword\">val</span> deferredSecond = async { <span class=\"keyword\">get</span>(<span class=\"string\">&quot;second&quot;</span>) }</span><br><span class=\"line\">            deferredFirst.await()</span><br><span class=\"line\">            deferredSecond.await()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//            val deferred = listOf(</span></span><br><span class=\"line\"><span class=\"comment\">//                    async { get(&quot;first&quot;) },</span></span><br><span class=\"line\"><span class=\"comment\">//                    async { get(&quot;second&quot;) }</span></span><br><span class=\"line\"><span class=\"comment\">//            )</span></span><br><span class=\"line\"><span class=\"comment\">//            deferred.awaitAll()</span></span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x901A;&#x8FC7;await&#x6216;&#x8005;awaitAll&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x6240;&#x6709;async&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x518D;&#x8FDB;&#x884C;resume&#x8C03;&#x7528;&#x3002;</p>\n<h2 id=\"Architecture-Components\"><a href=\"#Architecture-Components\" class=\"headerlink\" title=\"Architecture Components\"></a>Architecture Components</h2><p>&#x5982;&#x679C;&#x4F60;&#x4F7F;&#x7528;&#x4E86;Architecture Component&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x5176;&#x57FA;&#x7840;&#x4E0A;&#x4F7F;&#x7528;Coroutine&#xFF0C;&#x56E0;&#x4E3A;Kotlin Coroutine&#x5DF2;&#x7ECF;&#x63D0;&#x4F9B;&#x4E86;&#x76F8;&#x5E94;&#x7684;api&#x5E76;&#x4E14;&#x5B9A;&#x5236;&#x4E86;CoroutineScope&#x3002;</p>\n<blockquote>\n<p>&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x4E0D;&#x4E86;&#x89E3;Architecture Component&#xFF0C;&#x5F3A;&#x70C8;&#x63A8;&#x8350;&#x4F60;&#x9605;&#x8BFB;&#x6211;&#x7684;<a href=\"https://www.rousetime.com/2018/06/22/Android-Architecture-Components-Part4-ViewModel/\">Android Architecture Components &#x7CFB;&#x5217;</a></p>\n</blockquote>\n<p>&#x5728;&#x4F7F;&#x7528;&#x4E4B;&#x524D;&#xFF0C;&#x9700;&#x8981;&#x66F4;&#x65B0;architecture component&#x7684;&#x4F9D;&#x8D56;&#x7248;&#x672C;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">object</span> Versions {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"keyword\">val</span> arch_version = <span class=\"string\">&quot;2.2.0-alpha01&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"keyword\">val</span> arch_room_version = <span class=\"string\">&quot;2.1.0-rc01&quot;</span></span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">object</span> Dependencies {</span><br><span class=\"line\">    <span class=\"keyword\">val</span> arch_lifecycle = <span class=\"string\">&quot;androidx.lifecycle:lifecycle-extensions:<span class=\"subst\">${Versions.arch_version}</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> arch_viewmodel = <span class=\"string\">&quot;androidx.lifecycle:lifecycle-viewmodel-ktx:<span class=\"subst\">${Versions.arch_version}</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> arch_livedata = <span class=\"string\">&quot;androidx.lifecycle:lifecycle-livedata-ktx:<span class=\"subst\">${Versions.arch_version}</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> arch_runtime = <span class=\"string\">&quot;androidx.lifecycle:lifecycle-runtime-ktx:<span class=\"subst\">${Versions.arch_version}</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> arch_room_runtime = <span class=\"string\">&quot;androidx.room:room-runtime:<span class=\"subst\">${Versions.arch_room_version}</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> arch_room_compiler = <span class=\"string\">&quot;androidx.room:room-compiler:<span class=\"subst\">${Versions.arch_room_version}</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> arch_room = <span class=\"string\">&quot;androidx.room:room-ktx:<span class=\"subst\">${Versions.arch_room_version}</span>&quot;</span></span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"ViewModelScope\"><a href=\"#ViewModelScope\" class=\"headerlink\" title=\"ViewModelScope\"></a>ViewModelScope</h3><p>&#x5728;ViewModel&#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x4F7F;&#x7528;Coroutine&#x63D0;&#x4F9B;&#x4E86;viewModelScope.launch&#xFF0C;&#x540C;&#x65F6;&#x4E00;&#x65E6;ViewModel&#x88AB;&#x6E05;&#x9664;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;Coroutine&#x4E5F;&#x4F1A;&#x81EA;&#x52A8;&#x53D6;&#x6D88;&#x3002;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getAll</span><span class=\"params\">()</span></span> {</span><br><span class=\"line\">    viewModelScope.launch {</span><br><span class=\"line\">        <span class=\"keyword\">val</span> articleList = withContext(Dispatchers.IO) {</span><br><span class=\"line\">            articleDao.getAll()</span><br><span class=\"line\">        }</span><br><span class=\"line\">        adapter.clear()</span><br><span class=\"line\">        adapter.addAllData(articleList)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;IO&#x7EBF;&#x7A0B;&#x901A;&#x8FC7;articleDao&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x4E00;&#x65E6;&#x6570;&#x636E;&#x8FD4;&#x56DE;&#xFF0C;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;&#x5982;&#x679C;&#x5728;&#x53D6;&#x6570;&#x636E;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;ViewModel&#x5DF2;&#x7ECF;&#x6E05;&#x9664;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x6570;&#x636E;&#x83B7;&#x53D6;&#x4E5F;&#x4F1A;&#x505C;&#x6B62;&#xFF0C;&#x9632;&#x6B62;&#x8D44;&#x6E90;&#x7684;&#x6D6A;&#x8D39;&#x3002;</p>\n<h3 id=\"LifecycleScope\"><a href=\"#LifecycleScope\" class=\"headerlink\" title=\"LifecycleScope\"></a>LifecycleScope</h3><p>&#x5BF9;&#x4E8E;Lifecycle&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;LifecycleScope&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x901A;&#x8FC7;launch&#x6765;&#x521B;&#x5EFA;Coroutine</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">coroutine</span><span class=\"params\">()</span></span> {</span><br><span class=\"line\">    lifecycleScope.launch {</span><br><span class=\"line\">        delay(<span class=\"number\">2000</span>)</span><br><span class=\"line\">        showToast(<span class=\"string\">&quot;coroutine first&quot;</span>)</span><br><span class=\"line\">        delay(<span class=\"number\">2000</span>)</span><br><span class=\"line\">        showToast(<span class=\"string\">&quot;coroutine second&quot;</span>)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x56E0;&#x4E3A;Lifecycle&#x662F;&#x53EF;&#x4EE5;&#x611F;&#x77E5;&#x7EC4;&#x4EF6;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x65E6;&#x7EC4;&#x4EF6;onDestroy&#x4E86;&#xFF0C;&#x76F8;&#x5E94;&#x7684;LifecycleScope.launch&#x95ED;&#x5305;&#x4E2D;&#x7684;&#x8C03;&#x7528;&#x4E5F;&#x5C06;&#x53D6;&#x6D88;&#x505C;&#x6B62;&#x3002;</p>\n<p>lifecycleScope&#x672C;&#x8D28;&#x662F;Lifecycle.coroutineScope</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">val</span> LifecycleOwner.lifecycleScope: LifecycleCoroutineScope</span><br><span class=\"line\">    <span class=\"keyword\">get</span>() = lifecycle.coroutineScope</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onStateChanged</span><span class=\"params\">(source: <span class=\"type\">LifecycleOwner</span>, event: <span class=\"type\">Lifecycle</span>.<span class=\"type\">Event</span>)</span></span> {</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (lifecycle.currentState &lt;= Lifecycle.State.DESTROYED) {</span><br><span class=\"line\">            lifecycle.removeObserver(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">            coroutineContext.cancel()</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x4F1A;&#x5728;onStateChanged&#x4E2D;&#x76D1;&#x542C;DESTROYED&#x72B6;&#x6001;&#xFF0C;&#x540C;&#x65F6;&#x8C03;&#x7528;cancel&#x53D6;&#x6D88;Coroutine&#x3002;</p>\n<p>&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;lifecycleScope&#x8FD8;&#x53EF;&#x4EE5;&#x6839;&#x636E;Lifecycle&#x4E0D;&#x540C;&#x7684;&#x751F;&#x547D;&#x72B6;&#x6001;&#x8FDB;&#x884C;suspend&#x5904;&#x7406;&#x3002;&#x4F8B;&#x5982;&#x5BF9;&#x5B83;&#x7684;STARTED&#x8FDB;&#x884C;&#x7279;&#x6B8A;&#x5904;&#x7406;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">coroutine</span><span class=\"params\">()</span></span> {</span><br><span class=\"line\">    lifecycleScope.launchWhenStarted {</span><br><span class=\"line\"></span><br><span class=\"line\">    }</span><br><span class=\"line\">    lifecycleScope.launch {</span><br><span class=\"line\">        whenStarted {  }</span><br><span class=\"line\">        delay(<span class=\"number\">2000</span>)</span><br><span class=\"line\">        showToast(<span class=\"string\">&quot;coroutine first&quot;</span>)</span><br><span class=\"line\">        delay(<span class=\"number\">2000</span>)</span><br><span class=\"line\">        showToast(<span class=\"string\">&quot;coroutine second&quot;</span>)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0D;&#x7BA1;&#x662F;&#x76F4;&#x63A5;&#x8C03;&#x7528;launchWhenStarted&#x8FD8;&#x662F;&#x5728;launch&#x4E2D;&#x8C03;&#x7528;whenStarted&#x90FD;&#x80FD;&#x8FBE;&#x5230;&#x540C;&#x6837;&#x7684;&#x6548;&#x679C;&#x3002;</p>\n<h3 id=\"LiveData\"><a href=\"#LiveData\" class=\"headerlink\" title=\"LiveData\"></a>LiveData</h3><p>LiveData&#x4E2D;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;liveData&#xFF0C;&#x5728;&#x5B83;&#x7684;&#x53C2;&#x6570;&#x4E2D;&#x4F1A;&#x8C03;&#x7528;&#x4E00;&#x4E2A;suspend&#x51FD;&#x6570;&#xFF0C;&#x540C;&#x65F6;&#x4F1A;&#x8FD4;&#x56DE;LiveData&#x5BF9;&#x8C61;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"type\">&lt;T&gt;</span> <span class=\"title\">liveData</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">    context: <span class=\"type\">CoroutineContext</span> = EmptyCoroutineContext,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">    timeoutInMs: <span class=\"type\">Long</span> = DEFAULT_TIMEOUT,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">    <span class=\"meta\">@BuilderInference</span> block: <span class=\"type\">suspend</span> <span class=\"type\">LiveDataScope</span>&lt;<span class=\"type\">T</span>&gt;.() -&gt; <span class=\"type\">Unit</span></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">)</span></span>: LiveData&lt;T&gt; = CoroutineLiveData(context, timeoutInMs, block)</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;liveData&#x6765;&#x662F;&#x5B9E;&#x73B0;Coroutine&#x6548;&#x679C;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x9762;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Room</span></span><br><span class=\"line\">   <span class=\"meta\">@Query(<span class=\"meta-string\">&quot;SELECT * FROM article_model WHERE title = :title LIMIT 1&quot;</span>)</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">findByTitle</span><span class=\"params\">(title: <span class=\"type\">String</span>)</span></span>: ArticleModel?</span><br><span class=\"line\">   <span class=\"comment\">// ViewModel</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">findByTitle</span><span class=\"params\">(title: <span class=\"type\">String</span>)</span></span> = liveData(Dispatchers.IO) {</span><br><span class=\"line\">       MyApp.db.articleDao().findByTitle(title)?.let {</span><br><span class=\"line\">           emit(it)</span><br><span class=\"line\">       }</span><br><span class=\"line\">   }</span><br><span class=\"line\">   <span class=\"comment\">// Activity</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">checkArticle</span><span class=\"params\">()</span></span> {</span><br><span class=\"line\">       vm.findByTitle(<span class=\"string\">&quot;Android Architecture Components Part1:Room&quot;</span>).observe(<span class=\"keyword\">this</span>, Observer {</span><br><span class=\"line\">       })</span><br><span class=\"line\">   }</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;title&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x6570;&#x636E;&#x7684;&#x83B7;&#x53D6;&#x53D1;&#x751F;&#x5728;IO&#x7EBF;&#x7A0B;&#xFF0C;&#x4E00;&#x65E6;&#x6570;&#x636E;&#x8FD4;&#x56DE;&#xFF0C;&#x518D;&#x901A;&#x8FC7;emit&#x65B9;&#x6CD5;&#x5C06;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x636E;&#x53D1;&#x9001;&#x51FA;&#x53BB;&#x3002;&#x6240;&#x4EE5;&#x5728;View&#x5C42;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;checkArticle&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x76D1;&#x542C;&#x6570;&#x636E;&#x7684;&#x72B6;&#x6001;&#x3002;</p>\n<p>&#x53E6;&#x4E00;&#x65B9;&#x9762;LiveData&#x6709;&#x5B83;&#x7684;active&#x4E0E;inactive&#x72B6;&#x6001;&#xFF0C;&#x5BF9;&#x4E8E;Coroutine&#x4E5F;&#x4F1A;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x6FC0;&#x6D3B;&#x4E0E;&#x53D6;&#x6D88;&#x3002;&#x5BF9;&#x4E8E;&#x6FC0;&#x6D3B;&#xFF0C;&#x5982;&#x679C;&#x5B83;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x4E86;&#x6216;&#x8005;&#x975E;&#x6B63;&#x5E38;&#x7684;&#x53D6;&#x6D88;&#xFF0C;&#x4F8B;&#x5982;&#x629B;&#x51FA;CancelationException&#x5F02;&#x5E38;&#xFF0C;&#x6B64;&#x65F6;&#x5C06;&#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x6FC0;&#x6D3B;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x53D1;&#x9001;&#x6570;&#x636E;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;emitSource&#xFF0C;&#x5B83;&#x4E0E;emit&#x5171;&#x540C;&#x70B9;&#x662F;&#x5728;&#x53D1;&#x9001;&#x65B0;&#x7684;&#x6570;&#x636E;&#x4E4B;&#x524D;&#x90FD;&#x4F1A;&#x5C06;&#x539F;&#x6570;&#x636E;&#x6E05;&#x9664;&#xFF0C;&#x800C;&#x4E0D;&#x540C;&#x70B9;&#x662F;&#xFF0C;emitSource&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;DisposableHandle&#x5BF9;&#x8C61;&#xFF0C;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x5B83;&#x7684;dispose&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x53D6;&#x6D88;&#x53D1;&#x9001;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x6211;&#x4F7F;&#x7528;Architecture Component&#x4E0E;Coroutine&#x5199;&#x4E86;&#x4E2A;&#x7B80;&#x5355;&#x7684;Demo&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x5728;Github&#x4E2D;&#x8FDB;&#x884C;&#x67E5;&#x770B;</p>\n<p>&#x6E90;&#x7801;&#x5730;&#x5740;: <a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/android-api-analysis</a></p>\n<h2 id=\"&#x63A8;&#x8350;&#x9605;&#x8BFB;\"><a href=\"#&#x63A8;&#x8350;&#x9605;&#x8BFB;\" class=\"headerlink\" title=\"&#x63A8;&#x8350;&#x9605;&#x8BFB;\"></a>&#x63A8;&#x8350;&#x9605;&#x8BFB;</h2><p><a href=\"https://www.rousetime.com/2018/06/07/Android-Architecture-Components-Part1-Room/\">Android Architecture Components Part1:Room</a></p>\n<p><a href=\"https://www.rousetime.com/2018/06/10/Android-Architecture-Components-Part2-LiveData/\">Android Architecture Components Part2:LiveData</a></p>\n<p><a href=\"https://www.rousetime.com/2018/06/14/Android-Architecture-Components-Part3-Lifecycle/\">Android Architecture Components Part3:Lifecycle</a></p>\n<p><a href=\"https://www.rousetime.com/2018/06/22/Android-Architecture-Components-Part4-ViewModel/\">Android Architecture Components Part4:ViewModel</a></p>\n<p><img src=\"/2019/06/17/What-&#x4F60;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;Kotlin-Coroutine/Android&#x8865;&#x7ED9;&#x7AD9;.jpg\" alt></p>\n","categories":["android"],"tags":["kotlin"]},{"title":"Android Gradle系列-进阶篇","url":"https://www.rousetime.com/2019/06/03/Android-Gradle系列-进阶篇/","content":"<p>&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5C06;Gradle&#x57FA;&#x7840;&#x8FD0;&#x7528;&#x4ECB;&#x7ECD;&#x4E86;&#x4E00;&#x904D;&#xFF0C;&#x53EF;&#x4EE5;&#x8FD9;&#x4E48;&#x8BF4;&#xFF0C;&#x53EA;&#x8981;&#x4F60;&#x4E00;&#x76F4;&#x770B;&#x4E86;&#x6211;&#x8FD9;&#x4E2A;Gradle&#x7CFB;&#x5217;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x7684;Gradle&#x4E5F;&#x5C06;&#x8FC7;&#x5173;&#x4E86;&#xFF0C;&#x5E94;&#x5BF9;&#x6B63;&#x5E38;&#x7684;&#x5DE5;&#x4F5C;&#x5F00;&#x53D1;&#x5DF2;&#x7ECF;&#x4E0D;&#x6210;&#x95EE;&#x9898;&#x4E86;&#x3002;</p>\n<p>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x6211;&#x8981;&#x5411;&#x4F60;&#x4ECB;&#x7ECD;&#x7684;&#x662F;&#x5173;&#x4E8E;&#x5982;&#x4F55;&#x4F7F;&#x7528;Gradle&#x6765;&#x66F4;&#x52A0;&#x4F18;&#x96C5;&#x7684;&#x7BA1;&#x7406;&#x591A;&#x4E2A;module&#x4E4B;&#x95F4;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x3002;</p>\n<p>&#x76F8;&#x4FE1;&#x4F60;&#x4E00;&#x5B9A;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x7ECF;&#x5386;&#xFF1A;&#x4E3B;&#x9879;&#x76EE;&#x4F9D;&#x8D56;&#x4E8E;&#x591A;&#x4E2A;&#x5B50;&#x9879;&#x76EE;&#xFF0C;&#x6216;&#x8005;&#x9879;&#x76EE;&#x95F4;&#x4E92;&#x76F8;&#x4F9D;&#x8D56;&#x3002;&#x4E0D;&#x540C;&#x5B50;&#x9879;&#x76EE;&#x95F4;&#x7684;&#x4F9D;&#x8D56;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#x7248;&#x672C;&#x53C8;&#x6CA1;&#x6709;&#x8FDB;&#x884C;&#x7EDF;&#x4E00;&#xFF0C;&#x5347;&#x7EA7;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x7684;&#x9879;&#x76EE;&#x90FD;&#x8981;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF1B;&#x751A;&#x81F3;minSdkVersion&#x4E0E;targetSdkVersion&#x4E5F;&#x4E0D;&#x76F8;&#x540C;&#x3002;</p>\n<p>&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x5C31;&#x6765;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x8BA9;Gradle&#x7248;&#x672C;&#x7BA1;&#x7406;&#x66F4;&#x52A0;&#x4F18;&#x96C5;&#x3002;</p>\n<h2 id=\"Google&#x63A8;&#x8350;\"><a href=\"#Google&#x63A8;&#x8350;\" class=\"headerlink\" title=\"Google&#x63A8;&#x8350;\"></a>Google&#x63A8;&#x8350;</h2><p>&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;<a href=\"https://www.rousetime.com/2019/05/23/Gradle%E7%B3%BB%E5%88%97-%E8%BF%90%E7%94%A8%E7%AF%87/\">Android Gradle&#x7CFB;&#x5217;-&#x8FD0;&#x7528;&#x7BC7;</a>&#x4E2D;&#x7684;dependencies&#x4F7F;&#x7528;&#x7684;&#x662F;&#x6700;&#x57FA;&#x672C;&#x7684;&#x5F15;&#x7528;&#x65B9;&#x5F0F;&#x3002;&#x5982;&#x679C;&#x4F60;&#x6709;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;kotlin&#x9879;&#x76EE;&#x7684;&#x7ECF;&#x5386;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x5C06;&#x770B;&#x5230;Google&#x63A8;&#x8350;&#x7684;&#x65B9;&#x6848;</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buildscript {</span><br><span class=\"line\">    ext.kotlin_version = <span class=\"string\">&apos;1.1.51&apos;</span></span><br><span class=\"line\">    repositories {</span><br><span class=\"line\">        google()</span><br><span class=\"line\">        jcenter()</span><br><span class=\"line\">    }</span><br><span class=\"line\">    dependencies {</span><br><span class=\"line\">        classpath <span class=\"string\">&apos;com.android.tools.build:gradle:3.0.0&apos;</span></span><br><span class=\"line\">        classpath <span class=\"string\">&quot;org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version&quot;</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;rootProject&#x7684;build.gradle&#x4E2D;&#x4F7F;&#x7528;<strong>ext</strong>&#x6765;&#x5B9A;&#x4E49;&#x7248;&#x672C;&#x53F7;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5728;module&#x7684;build.gradle&#x4E2D;&#x76F4;&#x63A5;&#x5F15;&#x7528;&#x8FD9;&#x4E9B;&#x5B9A;&#x4E49;&#x7684;&#x53D8;&#x91CF;&#x3002;&#x5F15;&#x7528;&#x65B9;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    implementation fileTree(<span class=\"string\">dir:</span> <span class=\"string\">&apos;libs&apos;</span>, <span class=\"string\">include:</span> [<span class=\"string\">&apos;*.jar&apos;</span>])</span><br><span class=\"line\">    implementation<span class=\"string\">&quot;org.jetbrains.kotlin:kotlin-stdlib-jre7:$kotlin_version&quot;</span></span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4F60;&#x53EF;&#x4EE5;&#x5C06;&#x8FD9;&#x4E9B;&#x53D8;&#x91CF;&#x7406;&#x89E3;&#x4E3A;java&#x7684;&#x9759;&#x6001;&#x53D8;&#x91CF;&#x3002;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x80FD;&#x591F;&#x8FBE;&#x5230;&#x4E0D;&#x540C;module&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#x7EDF;&#x4E00;&#xFF0C;&#x4F46;&#x5C40;&#x9650;&#x6027;&#x662F;&#xFF0C;&#x4E00;&#x4F46;&#x914D;&#x7F6E;&#x9879;&#x8FC7;&#x591A;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x914D;&#x7F6E;&#x90FD;&#x5C06;&#x5199;&#x5230;rootProject&#x9879;&#x76EE;&#x7684;build.gradle&#x4E2D;&#xFF0C;&#x5BFC;&#x81F4;build.gradle&#x81C3;&#x80BF;&#x3002;&#x8FD9;&#x4E0D;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x7684;&#x6240;&#x63D0;&#x5021;&#x7684;&#x6A21;&#x5757;&#x5F00;&#x53D1;&#xFF0C;&#x6240;&#x4EE5;&#x5E94;&#x8BE5;&#x60F3;&#x529E;&#x6CD5;&#x5C06;ext&#x7684;&#x914D;&#x7F6E;&#x5355;&#x72EC;&#x5206;&#x79BB;&#x51FA;&#x6765;&#x3002;</p>\n<p>&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x6211;&#x5C31;&#x8981;&#x7528;&#x5230;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;<a href=\"https://www.rousetime.com/2019/05/13/Android-Gradle%E7%B3%BB%E5%88%97-%E5%8E%9F%E7%90%86%E7%AF%87/\">Android Gradle&#x7CFB;&#x5217;-&#x539F;&#x7406;&#x7BC7;</a>&#x4E2D;&#x6240;&#x4ECB;&#x7ECD;&#x7684;apply&#x51FD;&#x6570;&#x3002;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#x6211;&#x4EEC;&#x53EA;&#x4F7F;&#x7528;&#x4E86;apply&#x4E09;&#x79CD;&#x60C5;&#x51B5;&#x4E4B;&#x4E00;&#x7684;plugin(&#x5E94;&#x7528;&#x4E00;&#x4E2A;&#x63D2;&#x4EF6;&#xFF0C;&#x901A;&#x8FC7;id&#x6216;&#x8005;class&#x540D;)&#xFF0C;&#x53EA;&#x4F7F;&#x7528;&#x5728;&#x5B50;&#x9879;&#x76EE;&#x7684;build.gradle&#x4E2D;&#x3002;</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply <span class=\"string\">plugin:</span> <span class=\"string\">&apos;com.android.application&apos;</span></span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5B83;&#x7684;<strong>from</strong>&#xFF0C;&#x5B83;&#x4E3B;&#x8981;&#x662F;&#x7684;&#x4F5C;&#x7528;&#x662F;<strong>&#x5E94;&#x7528;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x6587;&#x4EF6;</strong>&#x3002;&#x4F5C;&#x7528;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x505A;&#x7684;&#x662F;&#x5C06;ext&#x914D;&#x7F6E;&#x5355;&#x72EC;&#x653E;&#x5230;&#x4E00;&#x4E2A;gradle&#x811A;&#x672C;&#x6587;&#x4EF6;&#x4E2D;&#x3002;</p>\n<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5728;rootProject&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;gradle&#x811A;&#x672C;&#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x53D6;&#x540D;&#x4E3A;version.gradle&#x3002;</p>\n<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5728;version.gradle&#x6587;&#x4EF6;&#x4E2D;&#x4F7F;&#x7528;ext&#x6765;&#x5B9A;&#x4E49;&#x53D8;&#x91CF;&#x3002;&#x4F8B;&#x5982;&#x4E4B;&#x524D;&#x7684;kotlin&#x7248;&#x672C;&#x53F7;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ext.deps = [:]</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">def</span> versions = [:]</span><br><span class=\"line\">versions.support = <span class=\"string\">&quot;26.1.0&quot;</span></span><br><span class=\"line\">versions.kotlin = <span class=\"string\">&quot;1.2.51&quot;</span></span><br><span class=\"line\">versions.gradle = <span class=\"string\">&apos;3.2.1&apos;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">def</span> support = [:]</span><br><span class=\"line\">support.app_compat = <span class=\"string\">&quot;com.android.support:appcompat-v7:$versions.support&quot;</span></span><br><span class=\"line\">support.recyclerview = <span class=\"string\">&quot;com.android.support:recyclerview-v7:$versions.support&quot;</span></span><br><span class=\"line\">deps.support = support</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">def</span> kotlin = [:]</span><br><span class=\"line\">kotlin.kotlin_stdlib = <span class=\"string\">&quot;org.jetbrains.kotlin:kotlin-stdlib-jre7:$versions.kotlin&quot;</span></span><br><span class=\"line\">kotlin.plugin = <span class=\"string\">&quot;org.jetbrains.kotlin:kotlin-gradle-plugin:$versions.kotlin&quot;</span></span><br><span class=\"line\">deps.kotlin = kotlin</span><br><span class=\"line\"> </span><br><span class=\"line\">deps.gradle_plugin = <span class=\"string\">&quot;com.android.tools.build:gradle:$versions.gradle&quot;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">ext.deps = deps</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">def</span> build_versions = [:]</span><br><span class=\"line\">build_versions.target_sdk = <span class=\"number\">26</span></span><br><span class=\"line\">build_versions.min_sdk = <span class=\"number\">16</span></span><br><span class=\"line\">build_versions.build_tools = <span class=\"string\">&quot;28.0.3&quot;</span></span><br><span class=\"line\">ext.build_versions = build_versions</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">def</span> addRepos(RepositoryHandler handler) {</span><br><span class=\"line\">    handler.google()</span><br><span class=\"line\">    handler.jcenter()</span><br><span class=\"line\">    handler.maven { url <span class=\"string\">&apos;https://oss.sonatype.org/content/repositories/snapshots&apos;</span> }</span><br><span class=\"line\">}</span><br><span class=\"line\">ext.addRepos = <span class=\"keyword\">this</span>.&amp;addRepos</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x56E0;&#x4E3A;gradle&#x4F7F;&#x7528;&#x7684;&#x662F;groovy&#x8BED;&#x8A00;&#xFF0C;&#x6240;&#x4EE5;&#x4EE5;&#x4E0A;&#x90FD;&#x662F;groovy&#x8BED;&#x6CD5;</p>\n</blockquote>\n<p>&#x4F8B;&#x5982;kotlin&#x7248;&#x672C;&#x63A7;&#x5236;&#xFF0C;&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x7684;&#x610F;&#x601D;&#x5C31;&#x662F;&#x5C06;&#x6709;&#x4E2A;kotlin&#x76F8;&#x5173;&#x7684;&#x7248;&#x672C;&#x4F9D;&#x8D56;&#x653E;&#x5230;deps&#x7684;kotlin&#x53D8;&#x91CF;&#x4E2D;&#xFF0C;&#x540C;&#x65F6;deps&#x653E;&#x5230;&#x4E86;ext&#x4E2D;&#x3002;&#x5176;&#x5B83;&#x7684;&#x4EA6;&#x662F;&#x5982;&#x6B64;&#x3002;</p>\n<p>&#x65E2;&#x7136;&#x5B9A;&#x4E49;&#x597D;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x5F15;&#x5165;&#x5230;&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x8BA9;&#x6240;&#x6709;&#x7684;&#x5B50;&#x9879;&#x76EE;&#x90FD;&#x80FD;&#x591F;&#x8BBF;&#x95EE;&#x5230;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<strong>apply from</strong>&#x5C06;&#x5176;&#x5F15;&#x5165;&#x5230;rootProject&#x7684;build.gradle&#x4E2D;</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buildscript {</span><br><span class=\"line\">    apply <span class=\"string\">from:</span> <span class=\"string\">&apos;versions.gradle&apos;</span></span><br><span class=\"line\">    addRepos(repositories)</span><br><span class=\"line\">    dependencies {</span><br><span class=\"line\">        classpath deps.gradle_plugin</span><br><span class=\"line\">        classpath deps.kotlin.plugin</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;build.gradle&#x4E2D;&#x5C31;&#x9ED8;&#x8BA4;&#x6709;&#x4E86;ext&#x6240;&#x58F0;&#x660E;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x5C31;&#x5982;dependencies&#x4E2D;&#x7684;&#x5F15;&#x7528;&#x4E00;&#x6837;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x518D;&#x770B;&#x4E0A;&#x9762;&#x7684;addRepos&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x5173;&#x4E8E;Gradle&#x539F;&#x7406;&#x7684;&#x6587;&#x7AE0;&#x4E2D;&#x5DF2;&#x7ECF;&#x5206;&#x6790;&#x4E86;repositories&#x4F1A;&#x901A;&#x8FC7;RepositoryHandler&#x6765;&#x6267;&#x884C;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x6765;&#x7EDF;&#x4E00;&#x8C03;&#x7528;RepositoryHandler&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5728;build.gradle&#x4E2D;&#x5C31;&#x65E0;&#x9700;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x65B9;&#x5F0F;&#xFF0C;&#x76F4;&#x63A5;&#x8C03;&#x7528;addRepos&#x65B9;&#x6CD5;&#x5373;&#x53EF;</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//&#x4E4B;&#x524D;&#x8C03;&#x7528;</span></span><br><span class=\"line\">repositories {</span><br><span class=\"line\">    google()</span><br><span class=\"line\">    jcenter()</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">//&#x73B0;&#x5728;&#x8C03;&#x7528;</span></span><br><span class=\"line\">addRepos(repositories)</span><br></pre></td></tr></table></figure>\n<p>&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x591A;&#x4E2A;module&#xFF0C;&#x4F8B;&#x5982;&#x6709;module1&#xFF0C;&#x73B0;&#x5728;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;module1&#x4E2D;&#x7684;build.gradle&#x4E2D;&#x4F7F;&#x7528;&#x5B9A;&#x4E49;&#x597D;&#x7684;&#x914D;&#x7F6E;</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    implementation fileTree(<span class=\"string\">dir:</span> <span class=\"string\">&apos;libs&apos;</span>, <span class=\"string\">include:</span> [<span class=\"string\">&apos;*.jar&apos;</span>])</span><br><span class=\"line\">    <span class=\"comment\">// support</span></span><br><span class=\"line\">    implementation deps.support.app_compat</span><br><span class=\"line\">    <span class=\"comment\">//kotlin</span></span><br><span class=\"line\">    implementation deps.kotlin.kotlin_stdlib</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x8FD8;&#x5B9A;&#x4E49;&#x4E86;sdk&#x4E0E;tools&#x7248;&#x672C;&#xFF0C;&#x6240;&#x4EE5;&#x4E5F;&#x53EF;&#x4EE5;&#x4E00;&#x8D77;&#x7EDF;&#x4E00;&#x4F7F;&#x7528;&#xFF0C;&#x6548;&#x679C;&#x5982;&#x4E0B;</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android {</span><br><span class=\"line\">    compileSdkVersion build_versions.target_sdk</span><br><span class=\"line\">    buildToolsVersion build_versions.build_tools</span><br><span class=\"line\">    defaultConfig {</span><br><span class=\"line\">        applicationId <span class=\"string\">&quot;com.idisfkj.androidapianalysis&quot;</span></span><br><span class=\"line\">        minSdkVersion build_versions.min_sdk</span><br><span class=\"line\">        targetSdkVersion build_versions.target_sdk</span><br><span class=\"line\">        versionCode <span class=\"number\">1</span></span><br><span class=\"line\">        versionName <span class=\"string\">&quot;1.0&quot;</span></span><br><span class=\"line\">        testInstrumentationRunner <span class=\"string\">&quot;android.support.test.runner.AndroidJUnitRunner&quot;</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E00;&#x65E6;&#x5B9E;&#x73B0;&#x4E86;&#x7EDF;&#x4E00;&#x914D;&#x7F6E;&#xFF0C;&#x90A3;&#x4E48;&#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x8981;&#x4FEE;&#x6539;&#x76F8;&#x5173;&#x7684;&#x7248;&#x672C;&#x5C31;&#x53EA;&#x9700;&#x5728;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x7684;version.gradle&#x4E2D;&#x4FEE;&#x6539;&#x5373;&#x53EF;&#x3002;&#x65E0;&#x9700;&#x518D;&#x5BF9;&#x6240;&#x7528;&#x7684;module&#x8FDB;&#x884C;&#x9010;&#x4E00;&#x4FEE;&#x6539;&#x4E0E;&#x7EDF;&#x4E00;&#x914D;&#x7F6E;&#x3002;</p>\n<h2 id=\"BuildSrc-amp-Kotlin\"><a href=\"#BuildSrc-amp-Kotlin\" class=\"headerlink\" title=\"BuildSrc&amp;Kotlin\"></a>BuildSrc&amp;Kotlin</h2><p>&#x5982;&#x679C;&#x4F60;&#x7684;&#x9879;&#x76EE;&#x4F7F;&#x7528;&#x4E86;kotlin&#xFF0C;&#x90A3;&#x4E48;<strong>buildSrc&amp;Kotlin</strong>&#x7684;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;&#x65B9;&#x6848;&#x5C06;&#x66F4;&#x9002;&#x5408;&#x4F60;&#x3002;</p>\n<p>Gradle&#x9879;&#x76EE;&#x4F1A;&#x9ED8;&#x8BA4;&#x8BC6;&#x522B;buildSrc&#x76EE;&#x5F55;&#xFF0C;&#x5E76;&#x4E14;&#x4F1A;&#x5C06;&#x8BE5;&#x76EE;&#x5F55;&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#x6CE8;&#x5165;&#x5230;build.gradle&#x4E2D;&#xFF0C;&#x4EE5;&#x81F3;&#x4E8E;&#x8BA9;build.gradle&#x80FD;&#x591F;&#x76F4;&#x63A5;&#x5F15;&#x7528;buildSrc&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#x9879;&#x3002;</p>\n<p>&#x6709;&#x4E86;&#x8FD9;&#x4E00;&#x7279;&#x6027;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5C06;&#x4E4B;&#x524D;version.gradle&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#x653E;&#x5165;&#x5230;buildSrc&#x4E2D;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x5B9E;&#x73B0;&#x3002;</p>\n<p>&#x9996;&#x5148;&#x5728;&#x6839;&#x76EE;&#x5F55;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;buildSrc&#x76EE;&#x5F55;(&#x4E0E;app&#x540C;&#x7EA7;)&#xFF0C;&#x7136;&#x540E;&#x5728;&#x8BE5;&#x76EE;&#x5F55;&#x65B0;&#x5EFA;src/main/java&#x76EE;&#x5F55;&#xFF0C;&#x8BE5;&#x76EE;&#x5F55;&#x662F;&#x4F60;&#x4E4B;&#x540E;&#x914D;&#x7F6E;&#x9879;&#x6240;&#x5728;&#x7684;&#x76EE;&#x5F55;&#xFF1B;&#x540C;&#x65F6;&#x518D;&#x65B0;&#x5EFA;build.gradle.kts&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x5728;&#x8BE5;&#x6587;&#x4EF6;&#x4E2D;&#x6DFB;&#x52A0;kotlin-dsl</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins {</span><br><span class=\"line\">    `kotlin-dsl`</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">repositories {</span><br><span class=\"line\">    jcenter()</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E4B;&#x540E;&#x518D;sync project&#xFF0C;&#x6700;&#x7EC8;&#x7684;&#x76EE;&#x5F55;&#x7ED3;&#x6784;&#x5982;&#x4E0B;</p>\n<p><img src=\"/2019/06/03/Android-Gradle&#x7CFB;&#x5217;-&#x8FDB;&#x9636;&#x7BC7;/Android-Gradle&#x7CFB;&#x5217;-&#x8FDB;&#x9636;&#x7BC7;1.jpg\" alt></p>\n<p>&#x642D;&#x5EFA;&#x597D;&#x4E86;&#x76EE;&#x5F55;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5728;src/main/java&#x4E0B;&#x4F7F;&#x7528;kotlin&#x65B0;&#x5EFA;Dependencies&#x6587;&#x4EF6;(&#x6587;&#x4EF6;&#x540D;&#x4EFB;&#x610F;)&#xFF0C;&#x5728;&#x8BE5;&#x6587;&#x4EF6;&#x4E2D;&#x5C06;&#x4E4B;&#x524D;&#x7684;&#x914D;&#x7F6E;&#x9879;&#x653E;&#x8FDB;&#x6765;&#xFF0C;&#x53EA;&#x662F;&#x4F7F;&#x7528;kotlin&#x8BED;&#x6CD5;&#x8FDB;&#x884C;&#x5B9E;&#x73B0;&#x800C;&#x5DF2;&#xFF0C;&#x8F6C;&#x5316;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">object</span> Versions {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"keyword\">val</span> support = <span class=\"string\">&quot;26.1.0&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"keyword\">val</span> kotlin = <span class=\"string\">&quot;1.3.31&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"keyword\">val</span> gradle = <span class=\"string\">&quot;3.4.1&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"keyword\">val</span> target_sdk = <span class=\"number\">26</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"keyword\">val</span> min_sdk = <span class=\"number\">16</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"keyword\">val</span> build_tools = <span class=\"string\">&quot;28.0.3&quot;</span></span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">object</span> Dependencies {</span><br><span class=\"line\">    <span class=\"keyword\">val</span> app_compat = <span class=\"string\">&quot;com.android.support:appcompat-v7:<span class=\"subst\">${Versions.support}</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> kotlin_stdlib = <span class=\"string\">&quot;org.jetbrains.kotlin:kotlin-stdlib-jdk7:<span class=\"subst\">${Versions.kotlin}</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> kotlin_plugin = <span class=\"string\">&quot;org.jetbrains.kotlin:kotlin-gradle-plugin:<span class=\"subst\">${Versions.kotlin}</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> gradle_plugin = <span class=\"string\">&quot;com.android.tools.build:gradle:<span class=\"subst\">${Versions.gradle}</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> addRepos: (handler: RepositoryHandler) -&gt; <span class=\"built_in\">Unit</span> = {</span><br><span class=\"line\">        it.google()</span><br><span class=\"line\">        it.jcenter()</span><br><span class=\"line\">        it.maven { url = URI(<span class=\"string\">&quot;https://oss.sonatype.org/content/repositories/snapshots&quot;</span>) }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;Dependencies&#x4E0E;Versions&#x5728;&#x5404;&#x4E2A;build.gradle&#x4E2D;&#x5F15;&#x7528;&#xFF0C;&#x4F8B;&#x5982;app&#x4E0B;&#x7684;build.gradle</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android {</span><br><span class=\"line\">    compileSdkVersion Versions.target_sdk</span><br><span class=\"line\">    buildToolsVersion Versions.build_tools</span><br><span class=\"line\">    defaultConfig {</span><br><span class=\"line\">        applicationId <span class=\"string\">&quot;com.idisfkj.androidapianalysis&quot;</span></span><br><span class=\"line\">        minSdkVersion Versions.min_sdk</span><br><span class=\"line\">        targetSdkVersion Versions.target_sdk</span><br><span class=\"line\">        versionCode <span class=\"number\">1</span></span><br><span class=\"line\">        versionName <span class=\"string\">&quot;1.0&quot;</span></span><br><span class=\"line\">        testInstrumentationRunner <span class=\"string\">&quot;android.support.test.runner.AndroidJUnitRunner&quot;</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br><span class=\"line\">dependencies {</span><br><span class=\"line\">    implementation fileTree(<span class=\"string\">dir:</span> <span class=\"string\">&apos;libs&apos;</span>, <span class=\"string\">include:</span> [<span class=\"string\">&apos;*.jar&apos;</span>])</span><br><span class=\"line\">    <span class=\"comment\">// support</span></span><br><span class=\"line\">    implementation Dependencies.app_compat</span><br><span class=\"line\">    <span class=\"comment\">//kotlin</span></span><br><span class=\"line\">    implementation Dependencies.kotlin_stdlib</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6839;&#x76EE;&#x5F55;&#x7684;build.gradle&#x4EA6;&#x662F;&#x5982;&#x6B64;</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buildscript {</span><br><span class=\"line\">    Dependencies.addRepos.invoke(repositories)</span><br><span class=\"line\">    dependencies {</span><br><span class=\"line\">        classpath Dependencies.gradle_plugin</span><br><span class=\"line\">        classpath Dependencies.kotlin_plugin</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">allprojects {</span><br><span class=\"line\">    Dependencies.addRepos.invoke(repositories)</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">task clean(<span class=\"string\">type:</span> Delete) {</span><br><span class=\"line\">    delete rootProject.buildDir</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x771F;&#x6B63;&#x9700;&#x8981;get&#x5230;&#x7684;&#x662F;&#x4E00;&#x79CD;&#x601D;&#x60F3;&#xFF0C;&#x5C06;&#x914D;&#x7F6E;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;&#x3002;&#x81F3;&#x4E8E;&#x5230;&#x5E95;&#x4F7F;&#x7528;&#x54EA;&#x4E00;&#x79CD;&#xFF0C;&#x8FD9;&#x5C31;&#x770B;&#x4E2A;&#x4EBA;&#x559C;&#x597D;&#x4E86;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x4F60;&#x7684;&#x9879;&#x76EE;&#x4F7F;&#x7528;&#x4E86;kotlin&#xFF0C;&#x6211;&#x8FD8;&#x662F;&#x5EFA;&#x8BAE;&#x4F60;&#x4F7F;&#x7528;buildSrc&#x6A21;&#x5F0F;&#xFF0C;&#x56E0;&#x4E3A;&#x5BF9;&#x4E8E;Groovy&#x8BED;&#x6CD5;&#x800C;&#x8A00;&#xFF0C;&#x6211;&#x76F8;&#x4FE1;&#x4F60;&#x8FD8;&#x662F;&#x5BF9;Kotlin&#x66F4;&#x52A0;&#x719F;&#x6089;&#x3002;</p>\n<p>&#x6E90;&#x7801;&#x5730;&#x5740;: <a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/android-api-analysis</a></p>\n<p><img src=\"/2019/06/03/Android-Gradle&#x7CFB;&#x5217;-&#x8FDB;&#x9636;&#x7BC7;/Android&#x8865;&#x7ED9;&#x7AD9;.jpg\" alt></p>\n","categories":["android"],"tags":["gradle"]},{"title":"Android Gradle系列-运用篇","url":"https://www.rousetime.com/2019/05/23/Gradle系列-运用篇/","content":"<p>&#x4E0A;&#x6B21;&#x6211;&#x4EEC;&#x8BF4;&#x5230;gradle&#x7684;&#x539F;&#x7406;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x504F;&#x7406;&#x8BBA;&#x4E0A;&#x7684;&#x77E5;&#x8BC6;&#x70B9;&#xFF0C;&#x76F4;&#x901A;&#x8F66;&#x5728;&#x8FD9;<a href=\"https://www.rousetime.com/2019/05/13/Android-Gradle%E7%B3%BB%E5%88%97-%E5%8E%9F%E7%90%86%E7%AF%87/\">Android Gradle&#x7CFB;&#x5217;-&#x539F;&#x7406;&#x7BC7;</a>&#x3002;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x6765;&#x70B9;&#x5B9E;&#x6218;&#x7684;&#xFF0C;&#x968F;&#x4FBF;&#x5DE9;&#x56FA;&#x4E0B;&#x4E4B;&#x524D;&#x7684;&#x77E5;&#x8BC6;&#x70B9;&#x3002;</p>\n<h2 id=\"android\"><a href=\"#android\" class=\"headerlink\" title=\"android\"></a>android</h2><p>&#x5728;app module&#x4E0B;&#x7684;gradle.build&#x4E2D;&#x90FD;&#x6709;&#x4E00;&#x4E2A;android&#x95ED;&#x5305;&#xFF0C;&#x4E3B;&#x8981;&#x914D;&#x7F6E;&#x90FD;&#x5728;&#x8FD9;&#x91CC;&#x8BBE;&#x7F6E;&#x3002;&#x4F8B;&#x5982;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x9879;&#xFF1A;defaultConfig&#xFF1B;&#x7B7E;&#x540D;&#x76F8;&#x5173;&#xFF1A;signingConfig&#xFF1B;&#x6784;&#x5EFA;&#x53D8;&#x4F53;&#xFF1A;buildTypes&#xFF1B;&#x4EA7;&#x54C1;&#x98CE;&#x683C;&#xFF1A;productFlavors&#xFF1B;&#x6E90;&#x96C6;&#x914D;&#x7F6E;&#xFF1A;sourceSets&#x7B49;&#x3002;</p>\n<h3 id=\"defaultConfig\"><a href=\"#defaultConfig\" class=\"headerlink\" title=\"defaultConfig\"></a>defaultConfig</h3><p>&#x5BF9;&#x4E8E;defaultConfig&#x5176;&#x5B9E;&#x5B83;&#x662F;&#x4E5F;&#x4E00;&#x4E2A;productFlavor&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC;&#x662F;&#x7528;&#x6765;&#x63D0;&#x4F9B;&#x9ED8;&#x8BA4;&#x7684;&#x8BBE;&#x7F6E;&#x9879;&#xFF0C;&#x5982;&#x679C;&#x4E4B;&#x540E;&#x7684;productFlavor&#x6CA1;&#x6709;&#x7279;&#x6B8A;&#x6307;&#x5B9A;&#x7684;&#x914D;&#x7F6E;&#x90FD;&#x4F1A;&#x4F7F;&#x7528;defaultConfig&#x4E2D;&#x7684;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class DefaultConfig extends BaseFlavor {</span><br><span class=\"line\">    @Inject</span><br><span class=\"line\">    public DefaultConfig(</span><br><span class=\"line\">            @NonNull String name,</span><br><span class=\"line\">            @NonNull Project project,</span><br><span class=\"line\">            @NonNull ObjectFactory objectFactory,</span><br><span class=\"line\">            @NonNull DeprecationReporter deprecationReporter,</span><br><span class=\"line\">            @NonNull Logger logger) {</span><br><span class=\"line\">        super(name, project, objectFactory, deprecationReporter, logger);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">public abstract class BaseFlavor extends DefaultProductFlavor implements CoreProductFlavor {</span><br><span class=\"line\">\t...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;defaultConfig&#x7684;&#x8D85;&#x7EA7;&#x7236;&#x7C7B;&#x5C31;&#x662F;DefaultProductFlavor&#x3002;&#x800C;&#x5728;DefaultProductFlavor&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;&#x8BB8;&#x591A;&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x89C1;&#x5230;&#x7684;&#x914D;&#x7F6E;&#xFF1A;VersionCode&#x3001;VersionName&#x3001;minSdkVersion&#x3001;targetSdkVersion&#x4E0E;applicationId&#x7B49;&#x7B49;&#x3002;</p>\n<p>&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x90A3;&#x4E48;&#x5728;defaultConfig&#x4E2D;&#x6211;&#x4EEC;&#x8981;&#x914D;&#x7F6E;&#x7684;&#x53D8;&#x91CF;&#x5C31;&#x663E;&#x800C;&#x6613;&#x89C1;&#x4E86;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defaultConfig {</span><br><span class=\"line\">    applicationId &quot;com.idisfkj.androidapianalysis&quot;</span><br><span class=\"line\">    minSdkVersion 16</span><br><span class=\"line\">    targetSdkVersion 26</span><br><span class=\"line\">    versionCode 1</span><br><span class=\"line\">    versionName &quot;1.0&quot;</span><br><span class=\"line\">    testInstrumentationRunner &quot;android.support.test.runner.AndroidJUnitRunner&quot;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"signingConfigs\"><a href=\"#signingConfigs\" class=\"headerlink\" title=\"signingConfigs\"></a>signingConfigs</h3><p>signingConfig&#x662F;&#x7528;&#x6765;&#x914D;&#x7F6E;keyStore&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x7684;&#x7248;&#x672C;&#x914D;&#x7F6E;&#x4E0D;&#x540C;&#x7684;keyStore&#xFF0C;&#x4F8B;&#x5982;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">signingConfigs {</span><br><span class=\"line\">    config { //&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;</span><br><span class=\"line\">        storeFile file(&apos;key.store&apos;)</span><br><span class=\"line\">        storePassword &apos;android123&apos;</span><br><span class=\"line\">        keyAlias &apos;android&apos;</span><br><span class=\"line\">        keyPassword &apos;android123&apos;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    dev { //dev&#x6D4B;&#x8BD5;&#x7248;&#x914D;&#x7F6E;</span><br><span class=\"line\">        storeFile file(&apos;xxxx&apos;)</span><br><span class=\"line\">        storePassword &apos;xxx&apos;</span><br><span class=\"line\">        keyAlias &apos;xxx&apos;</span><br><span class=\"line\">        keyPassword &apos;xxx&apos;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6709;&#x4EBA;&#x53EF;&#x80FD;&#x4F1A;&#x8BF4;&#x8FD9;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x5BC6;&#x7801;&#x90FD;&#x662F;&#x660E;&#x6587;&#xFF0C;&#x90FD;&#x66B4;&#x9732;&#x51FA;&#x53BB;&#x4E86;&#x3002;&#x662F;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x9879;&#x76EE;&#x53D1;&#x5E03;&#x5230;&#x8FDC;&#x7A0B;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E9B;&#x79D8;&#x94A5;&#x5C31;&#x6CC4;&#x9732;&#x51FA;&#x53BB;&#x4E86;&#x3002;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x5B89;&#x5168;&#x8D77;&#x89C1;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5BF9;&#x5176;&#x8FDB;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x5904;&#x7406;&#x3002;</p>\n<ol>\n<li>&#x901A;&#x8FC7;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x83B7;&#x53D6;&#x79D8;&#x94A5;</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">storePassword System.getenv(&quot;KSTOREPWD&quot;)</span><br><span class=\"line\">keyPassword System.getenv(&quot;KEYPWD&quot;)</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>&#x4ECE;&#x547D;&#x4EE4;&#x884C;&#x4E2D;&#x83B7;&#x53D6;&#x79D8;&#x94A5;</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">storePassword System.console().readLine(&quot;\\nKeystore password: &quot;)</span><br><span class=\"line\">keyPassword System.console().readLine(&quot;\\nKey password: &quot;)</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x4E24;&#x79CD;&#x662F;Android Develop&#x5B98;&#x7F51;&#x63D0;&#x4F9B;&#x7684;&#xFF0C;&#x4F46;&#x7ECF;&#x8FC7;&#x6D4B;&#x8BD5;&#x90FD;&#x4F1A;&#x62A5;null&#x5F02;&#x5E38;&#xFF0C;&#x67E5;&#x4E86;&#x4E0B;&#x8D44;&#x6599;&#x90FD;&#x8BF4;&#x662F;gradle&#x4E0D;&#x652F;&#x6301;(&#x5982;&#x679C;&#x6709;&#x6210;&#x529F;&#x7684;&#x53EF;&#x4EE5;&#x544A;&#x77E5;&#x6211;)&#xFF0C;&#x6240;&#x4EE5;&#x8FD8;&#x662F;&#x63A8;&#x8350;&#x4E0B;&#x9762;&#x7684;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;</p>\n<p>&#x5728;&#x9879;&#x76EE;&#x7684;&#x6839;&#x76EE;&#x5F55;&#x4E0B;(settings.gradle&#x5E73;&#x7EA7;)&#x521B;&#x5EFA;keystore.properties&#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4E2D;&#x8FDB;&#x884C;&#x5B58;&#x50A8;&#x79D8;&#x94A5;&#xFF0C;&#x5B83;&#x662F;&#x652F;&#x6301;key-value&#x6A21;&#x5F0F;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x6570;&#x636E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">storePassword = android123</span><br><span class=\"line\">keyPassword = android123</span><br></pre></td></tr></table></figure>\n<p>&#x4E4B;&#x540E;&#x5C31;&#x662F;&#x8BFB;&#x53D6;&#x5176;&#x4E2D;&#x7684;password&#xFF0C;&#x5728;build.gradle&#x901A;&#x8FC7;afterEvaluate&#x56DE;&#x8C03;&#x8FDB;&#x884C;&#x8BFB;&#x53D6;&#x4E0E;&#x8BBE;&#x7F6E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">afterEvaluate {</span><br><span class=\"line\">    def propsFile = rootProject.file(&apos;keystore.properties&apos;)</span><br><span class=\"line\">    def configName = &apos;config&apos;</span><br><span class=\"line\">    if (propsFile.exists() &amp;&amp; android.signingConfigs.hasProperty(configName)) {</span><br><span class=\"line\">        def props = new Properties()</span><br><span class=\"line\">        props.load(new FileInputStream(propsFile))</span><br><span class=\"line\">        android.signingConfigs[configName].keyPassword = props[&apos;keyPassword&apos;]</span><br><span class=\"line\">        android.signingConfigs[configName].storePassword = props[&apos;storePassword&apos;]</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x901A;&#x8FC7;&#x52A8;&#x6001;&#x8BFB;&#x53D6;&#x4E86;password&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x4E4B;&#x524D;&#x7684;signingConfigs&#x4E2D;&#x5C31;&#x65E0;&#x9700;&#x518D;&#x914D;&#x7F6E;password</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">signingConfigs {</span><br><span class=\"line\">    config {</span><br><span class=\"line\">        storeFile file(&apos;key.store&apos;)</span><br><span class=\"line\">        keyAlias &apos;android&apos;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x4E00;&#x6B65;&#xFF0C;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x79D8;&#x94A5;&#x7684;&#x5B89;&#x5168;&#x6027;&#xFF0C;&#x5728;.gitignore&#x4E2D;&#x6DFB;&#x52A0;keystore.properties&#x7684;&#x5FFD;&#x7565;&#x914D;&#x7F6E;&#xFF0C;&#x9632;&#x6B62;&#x4E0A;&#x4F20;&#x5230;&#x8FDC;&#x7A0B;&#x4ED3;&#x50A8;&#x66B4;&#x9732;&#x79D8;&#x94A5;&#x3002;</p>\n<h3 id=\"buildTypes\"><a href=\"#buildTypes\" class=\"headerlink\" title=\"buildTypes\"></a>buildTypes</h3><p>&#x6784;&#x5EFA;&#x53D8;&#x4F53;&#x4E3B;&#x8981;&#x7528;&#x6765;&#x914D;&#x7F6E;shrinkResources&#xFF1A;&#x8D44;&#x6E90;&#x662F;&#x5426;&#x9700;&#x8981;&#x538B;&#x7F29;&#x3001;zipAlignEnabled&#xFF1A;&#x538B;&#x7F29;&#x662F;&#x5426;&#x5BF9;&#x9F50;&#x3001;minifyEnabled&#xFF1A;&#x662F;&#x5426;&#x4EE3;&#x7801;&#x6DF7;&#x6DC6;&#x4E0E;signingConfig&#xFF1A;&#x7B7E;&#x540D;&#x914D;&#x7F6E;&#x7B49;&#x7B49;&#x3002;&#x65B0;&#x5EFA;&#x9879;&#x76EE;&#x65F6;&#xFF0C;&#x9ED8;&#x8BA4;&#x6709;&#x4E00;&#x4E2A;release&#x914D;&#x7F6E;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x4E2D;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x591A;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x4F8B;&#x5982;debug&#x6A21;&#x5F0F;&#xFF0C;&#x4E3A;&#x4E86;&#x65B9;&#x6CD5;&#x8C03;&#x8BD5;&#xFF0C;&#x4E00;&#x822C;&#x90FD;&#x4E0D;&#x9700;&#x8981;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x4EE3;&#x7801;&#x6DF7;&#x6DC6;&#x3001;&#x538B;&#x7F29;&#x7B49;&#x5904;&#x7406;&#x3002;&#x6216;&#x8005;outer&#x6A21;&#x5F0F;&#xFF0C;&#x9700;&#x8981;&#x7684;&#x7B7E;&#x540D;&#x914D;&#x7F6E;&#x4E0D;&#x540C;&#xFF0C;&#x6240;&#x4EE5;&#x6700;&#x7EC8;&#x7684;&#x914D;&#x7F6E;&#x53EF;&#x4EE5;&#x662F;&#x8FD9;&#x6837;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buildTypes {</span><br><span class=\"line\">    debug {</span><br><span class=\"line\">        minifyEnabled false</span><br><span class=\"line\">        zipAlignEnabled false</span><br><span class=\"line\">        shrinkResources false</span><br><span class=\"line\">        signingConfig signingConfigs.config</span><br><span class=\"line\">    }</span><br><span class=\"line\">    outer {</span><br><span class=\"line\">        minifyEnabled false</span><br><span class=\"line\">        zipAlignEnabled false</span><br><span class=\"line\">        shrinkResources false</span><br><span class=\"line\">        signingConfig signingConfigs.outConfig</span><br><span class=\"line\">    }</span><br><span class=\"line\">    release {</span><br><span class=\"line\">        minifyEnabled true</span><br><span class=\"line\">        zipAlignEnabled true</span><br><span class=\"line\">        shrinkResources true</span><br><span class=\"line\">        signingConfig signingConfigs.config</span><br><span class=\"line\">        proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>Sync Now&#x4E4B;&#x540E;&#xFF0C;&#x6253;&#x5F00;Android Studio &#x53F3;&#x8FB9;&#x7684;Gradle&#xFF0C;&#x627E;&#x5230;app-&gt;Tasks-&gt;build&#xFF0C;&#x53D1;&#x73B0;&#x5DF2;&#x7ECF;&#x6DFB;&#x52A0;&#x4E86;assembleDebug&#x4E0E;assembleOuter&#x6784;&#x5EFA;task&#x3002;</p>\n<h3 id=\"productFlavors\"><a href=\"#productFlavors\" class=\"headerlink\" title=\"productFlavors\"></a>productFlavors</h3><p>&#x4E00;&#x4E2A;&#x9879;&#x76EE;&#x53EF;&#x80FD;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x7248;&#x672C;&#x73AF;&#x5883;&#xFF0C;&#x4F8B;&#x5982;&#x5F00;&#x53D1;&#x529F;&#x80FD;&#x4E2D;&#x7684;&#x5F00;&#x53D1;&#x7248;&#x3001;&#x9879;&#x76EE;&#x4E0A;&#x7EBF;&#x7684;&#x6B63;&#x5F0F;&#x7248;&#x3002;&#x5F00;&#x53D1;&#x7248;&#x4E0E;&#x6B63;&#x5F0F;&#x7248;&#x8BF7;&#x6C42;&#x7684;&#x6570;&#x636E;api&#x53EF;&#x80FD;&#x4E0D;&#x540C;&#xFF0C;&#x5BF9;&#x4E8E;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;productFlavor&#x6765;&#x6784;&#x5EFA;&#x4E0D;&#x540C;&#x7684;&#x4EA7;&#x54C1;&#x98CE;&#x683C;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x4E0B;&#x9762;&#x7684;dev&#x4E0E;prod&#x914D;&#x7F6E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flavorDimensions &quot;mode&quot;</span><br><span class=\"line\">productFlavors {</span><br><span class=\"line\">    dev {</span><br><span class=\"line\">        applicationIdSuffix &quot;.dev&quot;</span><br><span class=\"line\">        dimension &quot;mode&quot;</span><br><span class=\"line\">        manifestPlaceholders = [PROJECT_NAME: &quot;@string/app_name_dev&quot;,</span><br><span class=\"line\">                                APP_ID      : &quot;21321843&quot;]</span><br><span class=\"line\">        buildConfigField &apos;String&apos;, &apos;API_URL&apos;, &apos;&quot;https://dev.idisfkj.android.com&quot;&apos;</span><br><span class=\"line\">        buildConfigField &apos;String&apos;, &apos;APP_KEY&apos;, &apos;&quot;3824yk32&quot;&apos;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    prod {</span><br><span class=\"line\">        applicationIdSuffix &quot;.prod&quot;</span><br><span class=\"line\">        dimension &quot;mode&quot;</span><br><span class=\"line\">        manifestPlaceholders = [PROJECT_NAME: &quot;@string/app_name&quot;,</span><br><span class=\"line\">                                APP_ID      : &quot;12932843&quot;]</span><br><span class=\"line\">        buildConfigField &apos;String&apos;, &apos;API_URL&apos;, &apos;&quot;https://prod.idisfkj.android.com&quot;&apos;</span><br><span class=\"line\">        buildConfigField &apos;String&apos;, &apos;APP_KEY&apos;, &apos;&quot;32143dsk2&quot;&apos;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x4E8E;&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;&#x540C;&#x4E00;&#x4E2A;app&#xFF0C;&#x624B;&#x673A;&#x7CFB;&#x7EDF;&#x662F;&#x6839;&#x636E;app&#x7684;applicationId&#x6765;&#x8BC6;&#x522B;&#x7684;&#xFF0C;&#x9ED8;&#x8BA4;applicationId&#x662F;packageName&#x3002;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x8BA9;dev&#x4E0E;prod&#x7684;&#x7248;&#x672C;&#x90FD;&#x80FD;&#x5171;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x624B;&#x673A;&#x4E0A;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;applicationIdSuffix&#x6765;&#x4E3A;applicationId&#x589E;&#x52A0;&#x540E;&#x7F00;&#xFF0C;&#x6539;&#x53D8;&#x5B89;&#x88C5;&#x5305;&#x7684;&#x552F;&#x4E00;&#x6807;&#x8BC6;&#x3002;</p>\n<p>&#x8FD8;&#x6709;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;manifestPlaceholders&#x6765;&#x914D;&#x7F6E;&#x53EF;&#x7528;&#x4E8E;AndroidManifest&#x4E2D;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x4F8B;&#x5982;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x4EA7;&#x54C1;&#x98CE;&#x683C;&#x663E;&#x793A;&#x4E0D;&#x540C;&#x7684;app&#x540D;&#x79F0;</p>\n<p>dev&#x4E0E;prod&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x65F6;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;api host&#xFF0C;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;buildConfigField&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x901A;&#x8FC7;BuildConfig&#x83B7;&#x53D6;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun getApiUlr(): String {</span><br><span class=\"line\">    return BuildConfig.API_URL</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x7684;BuildConfig&#x4F1A;&#x6839;&#x636E;&#x4F60;&#x6784;&#x5EFA;&#x7684;&#x4EA7;&#x54C1;&#x98CE;&#x683C;&#x8FD4;&#x56DE;&#x4E0D;&#x540C;&#x7684;&#x503C;&#xFF0C;&#x5B83;&#x4F4D;&#x4E8E;build-&gt;generated-&gt;source-&gt;buildConfig-&gt;&#x53D8;&#x4F53;&#xFF0C;&#x5927;&#x81F4;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public final class BuildConfig {</span><br><span class=\"line\">  public static final boolean DEBUG = Boolean.parseBoolean(&quot;true&quot;);</span><br><span class=\"line\">  public static final String APPLICATION_ID = &quot;com.idisfkj.androidapianalysis.dev&quot;;</span><br><span class=\"line\">  public static final String BUILD_TYPE = &quot;debug&quot;;</span><br><span class=\"line\">  public static final String FLAVOR = &quot;devMinApi21&quot;;</span><br><span class=\"line\">  public static final int VERSION_CODE = 20001;</span><br><span class=\"line\">  public static final String VERSION_NAME = &quot;1.0-minApi21&quot;;</span><br><span class=\"line\">  public static final String FLAVOR_mode = &quot;dev&quot;;</span><br><span class=\"line\">  public static final String FLAVOR_api = &quot;minApi21&quot;;</span><br><span class=\"line\">  // Fields from product flavor: dev</span><br><span class=\"line\">  public static final String API_URL = &quot;https://dev.idisfkj.android.com&quot;;</span><br><span class=\"line\">  public static final String APP_KEY = &quot;3824yk32&quot;;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>Sync Now&#x4E4B;&#x540E;&#xFF0C;&#x6253;&#x5F00;Android Studio &#x53F3;&#x8FB9;&#x7684;Gradle&#xFF0C;&#x627E;&#x5230;app-&gt;Tasks-&gt;build&#xFF0C;&#x53D1;&#x73B0;&#x65B0;&#x6DFB;&#x52A0;&#x4E86;assembleDev&#x4E0E;assembleProd&#x6784;&#x5EFA;task&#x3002;</p>\n<p>flavorDimensions&#x662F;&#x7528;&#x6765;&#x8BBE;&#x7F6E;&#x591A;&#x7EF4;&#x5EA6;&#x7684;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x53EA;&#x5C55;&#x793A;&#x4E86;&#x4E00;&#x4E2A;&#x7EF4;&#x5EA6;&#xFF0C;&#x6240;&#x4EE5;dimension&#x4E3A;mode&#x7684;&#x5F62;&#x5F0F;&#x3002;&#x6211;&#x4EEC;&#x65B0;&#x589E;&#x4E00;&#x4E2A;api&#x7EF4;&#x5EA6;&#xFF0C;&#x6784;&#x5EFA;&#x4E0D;&#x540C;&#x7684;minSkdVerison&#x7248;&#x672C;&#x7684;apk</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flavorDimensions &quot;mode&quot;, &quot;api&quot;</span><br><span class=\"line\">productFlavors {</span><br><span class=\"line\">    dev {</span><br><span class=\"line\">        applicationIdSuffix &quot;.dev&quot;</span><br><span class=\"line\">        dimension &quot;mode&quot;</span><br><span class=\"line\">        manifestPlaceholders = [PROJECT_NAME: &quot;@string/app_name_dev&quot;,</span><br><span class=\"line\">                                APP_ID      : &quot;21321843&quot;]</span><br><span class=\"line\">        buildConfigField &apos;String&apos;, &apos;API_URL&apos;, &apos;&quot;https://dev.idisfkj.android.com&quot;&apos;</span><br><span class=\"line\">        buildConfigField &apos;String&apos;, &apos;APP_KEY&apos;, &apos;&quot;3824yk32&quot;&apos;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    prod {</span><br><span class=\"line\">        applicationIdSuffix &quot;.prod&quot;</span><br><span class=\"line\">        dimension &quot;mode&quot;</span><br><span class=\"line\">        manifestPlaceholders = [PROJECT_NAME: &quot;@string/app_name&quot;,</span><br><span class=\"line\">                                APP_ID      : &quot;12932843&quot;]</span><br><span class=\"line\">        buildConfigField &apos;String&apos;, &apos;API_URL&apos;, &apos;&quot;https://prod.idisfkj.android.com&quot;&apos;</span><br><span class=\"line\">        buildConfigField &apos;String&apos;, &apos;APP_KEY&apos;, &apos;&quot;32143dsk2&quot;&apos;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    minApi16 {</span><br><span class=\"line\">        dimension &quot;api&quot;</span><br><span class=\"line\">        minSdkVersion 16</span><br><span class=\"line\">        versionCode 10000 + android.defaultConfig.versionCode</span><br><span class=\"line\">        versionNameSuffix &quot;-minApi16&quot;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    minApi21 {</span><br><span class=\"line\">        dimension &quot;api&quot;</span><br><span class=\"line\">        minSdkVersion 21</span><br><span class=\"line\">        versionCode 20000 + android.defaultConfig.versionCode</span><br><span class=\"line\">        versionNameSuffix &quot;-minApi21&quot;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>gradle&#x521B;&#x5EFA;&#x7684;&#x6784;&#x5EFA;&#x53D8;&#x4F53;&#x6570;&#x91CF;&#x7B49;&#x4E8E;&#x6BCF;&#x4E2A;&#x98CE;&#x683C;&#x7EF4;&#x5EA6;&#x4E2D;&#x7684;&#x98CE;&#x683C;&#x6570;&#x91CF;&#x4E0E;&#x4F60;&#x914D;&#x7F6E;&#x7684;&#x6784;&#x5EFA;&#x7C7B;&#x578B;&#x6570;&#x91CF;&#x7684;&#x4E58;&#x79EF;&#xFF0C;&#x6240;&#x4EE5;&#x4E0A;&#x9762;&#x4F8B;&#x5B50;&#x7684;&#x6784;&#x5EFA;&#x53D8;&#x4F53;&#x6570;&#x91CF;&#x4E3A;12&#x4E2A;&#x3002;&#x5728;gradle&#x4E3A;&#x6BCF;&#x4E2A;&#x6784;&#x5EFA;&#x53D8;&#x4F53;&#x6216;&#x5BF9;&#x5E94;apk&#x547D;&#x540D;&#x65F6;&#xFF0C;&#x5C5E;&#x4E8E;&#x8F83;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x98CE;&#x683C;&#x7EF4;&#x5EA6;&#x7684;&#x4EA7;&#x54C1;&#x98CE;&#x683C;&#x9996;&#x5148;&#x663E;&#x793A;&#xFF0C;&#x4E4B;&#x540E;&#x662F;&#x8F83;&#x4F4E;&#x4F18;&#x5148;&#x7EA7;&#x7EF4;&#x5EA6;&#x7684;&#x4EA7;&#x54C1;&#x98CE;&#x683C;&#xFF0C;&#x518D;&#x4E4B;&#x540E;&#x662F;&#x6784;&#x5EFA;&#x7C7B;&#x578B;&#x3002;&#x800C;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x5224;&#x65AD;&#x5219;&#x4EE5;flavorDimensions&#x7684;&#x503C;&#x987A;&#x5E8F;&#x4E3A;&#x4F9D;&#x636E;&#xFF0C;&#x4EE5;&#x4E0A;&#x9762;&#x7684;&#x6784;&#x5EFA;&#x914D;&#x7F6E;&#x4E3A;&#x4F8B;&#xFF1A;</p>\n<p>&#x6784;&#x5EFA;&#x53D8;&#x4F53;&#xFF1A;[dev, prod][minApi16, minApi21][debug, outer, release]<br>&#x5BF9;&#x5E94;apk&#xFF1A;app-[dev, prod]-[minApi16, minApi21]-[debug, outer, release].apk</p>\n<p>&#x6784;&#x5EFA;&#x53D8;&#x4F53;&#x6709;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x4F46;&#x6709;&#x65F6;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x5168;&#x90E8;&#x9700;&#x8981;&#xFF0C;&#x4F8B;&#x5982;&#x4F60;&#x4E0D;&#x9700;&#x8981;mode&#x4E3A;dev&#xFF0C;api&#x4E3A;minApi16&#x7684;&#x53D8;&#x4F53;&#xFF0C;&#x8FD9;&#x65F6;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;variantFilter&#x65B9;&#x6CD5;&#x6765;&#x8FC7;&#x6EE4;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">variantFilter { variant -&gt;</span><br><span class=\"line\">    def names = variant.flavors*.name</span><br><span class=\"line\">    if (names.contains(&quot;minApi16&quot;) &amp;&amp; names.contains(&quot;dev&quot;)) {</span><br><span class=\"line\">        setIgnore(true)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4F60;&#x518D;&#x56DE;&#x5230;app-&gt;Tasks&#x4E2D;&#x67E5;&#x770B;&#x53D8;&#x4F53;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5DF2;&#x7ECF;&#x5C06;devMinApi16&#x76F8;&#x5173;&#x7684;&#x53D8;&#x4F53;&#x8FC7;&#x6EE4;&#x4E86;&#x3002;</p>\n<p>&#x4F60;&#x4E0D;&#x4EC5;&#x53EF;&#x4EE5;&#x8FC7;&#x6EE4;&#x6784;&#x5EFA;&#x53D8;&#x4F53;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x9ED8;&#x8BA4;&#x7684;apk&#x8F93;&#x51FA;&#x540D;&#x79F0;&#x3002;&#x4F8B;&#x5982;&#x4F60;&#x60F3;&#x4FEE;&#x6539;buildType&#x4E3A;release&#x7684;apk&#x540D;&#x79F0;&#xFF0C;&#x8FD9;&#x65F6;&#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;android.applicationVariants.all</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android.applicationVariants.all { variant -&gt;</span><br><span class=\"line\">    if (variant.buildType.name == buildTypes.release.name) {</span><br><span class=\"line\">        variant.outputs.all {</span><br><span class=\"line\">            outputFileName = &quot;analysis-release-${defaultConfig.versionName}.apk&quot;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x5728;release&#x4E0B;&#x7684;&#x5305;&#x540D;&#x90FD;&#x662F;&#x4EE5;analysis&#x6253;&#x5934;</p>\n<h3 id=\"sourceSets\"><a href=\"#sourceSets\" class=\"headerlink\" title=\"sourceSets\"></a>sourceSets</h3><p>Android Studio&#x4F1A;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x9ED8;&#x8BA4;&#x7684;main&#x6E90;&#x96C6;&#x4E0E;&#x76EE;&#x5F55;(&#x4F4D;&#x4E8E;app/src/main)&#xFF0C;&#x7528;&#x6765;&#x5B58;&#x50A8;&#x6240;&#x6709;&#x6784;&#x5EFA;&#x53D8;&#x4F53;&#x95F4;&#x7684;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x3002;&#x6240;&#x4EE5;&#x4F60;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;main&#x6E90;&#x96C6;&#x6765;&#x66F4;&#x6539;&#x9ED8;&#x8BA4;&#x7684;&#x914D;&#x7F6E;&#x3002;&#x4F8B;&#x5982;&#x73B0;&#x5728;&#x4F60;&#x60F3;&#x5C06;res&#x7684;&#x8DEF;&#x5F84;&#x4FEE;&#x6539;&#x6210;src/custom/res</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sourceSets {</span><br><span class=\"line\">    main {</span><br><span class=\"line\">        res.srcDirs = [&apos;src/custom/res&apos;]</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;res&#x8D44;&#x6E90;&#x8DEF;&#x5F84;&#x5C31;&#x5B9A;&#x4F4D;&#x5230;&#x4E86;src/custom/res&#x4E0B;&#xFF0C;&#x5F53;&#x7136;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x5176;&#x5B83;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x4F8B;&#x5982;java&#x3001;assets&#x3001;jni&#x7B49;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x914D;&#x7F6E;&#x4E86;&#x591A;&#x4E2A;&#x8DEF;&#x5F84;&#xFF0C;&#x5373;&#x8DEF;&#x5F84;&#x96C6;&#x5408;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sourceSets {</span><br><span class=\"line\">    main {</span><br><span class=\"line\">        res.srcDirs = [&apos;src/custom/res&apos;, &apos;scr/main/res&apos;]</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#x4F60;&#x8981;&#x4FDD;&#x8BC1;&#x4E0D;&#x80FD;&#x6709;&#x76F8;&#x540C;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x5373;&#x6BCF;&#x4E2A;&#x6587;&#x4EF6;&#x53EA;&#x80FD;&#x552F;&#x4E00;&#x5B58;&#x5728;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#x4E0B;&#x3002;</p>\n<p>&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x6240;&#x4EE5;&#x7684;&#x6784;&#x5EFA;&#x53D8;&#x4F53;&#x7684;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x8DEF;&#x5F84;: &#x70B9;&#x51FB;&#x53F3;&#x8FB9;gradle-&gt;app-&gt;android-&gt;sourceSets&#xFF0C;&#x4F60;&#x5C06;&#x4F1A;&#x770B;&#x5230;&#x5982;&#x4E0B;&#x7C7B;&#x4F3C;&#x4FE1;&#x606F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\">Project :app</span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\"> </span><br><span class=\"line\">androidTest</span><br><span class=\"line\">-----------</span><br><span class=\"line\">Compile configuration: androidTestCompile</span><br><span class=\"line\">build.gradle name: android.sourceSets.androidTest</span><br><span class=\"line\">Java sources: [app/src/androidTest/java]</span><br><span class=\"line\">Manifest file: app/src/androidTest/AndroidManifest.xml</span><br><span class=\"line\">Android resources: [app/src/androidTest/res]</span><br><span class=\"line\">Assets: [app/src/androidTest/assets]</span><br><span class=\"line\">AIDL sources: [app/src/androidTest/aidl]</span><br><span class=\"line\">RenderScript sources: [app/src/androidTest/rs]</span><br><span class=\"line\">JNI sources: [app/src/androidTest/jni]</span><br><span class=\"line\">JNI libraries: [app/src/androidTest/jniLibs]</span><br><span class=\"line\">Java-style resources: [app/src/androidTest/resources]</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x662F;androidTest&#x53D8;&#x4F53;&#x7684;&#x9ED8;&#x8BA4;&#x8DEF;&#x5F84;&#xFF0C;&#x9996;&#x5148;&#x5B83;&#x4F1A;&#x53BB;&#x67E5;&#x627E;&#x76F8;&#x5E94;&#x7684;&#x6784;&#x5EFA;&#x53D8;&#x4F53;&#x7684;&#x9ED8;&#x8BA4;&#x4F4D;&#x7F6E;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x627E;&#x5230;&#xFF0C;&#x5C31;&#x4F1A;&#x4F7F;&#x7528;main&#x6E90;&#x96C6;&#x4E0B;&#x7684;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x6240;&#x719F;&#x6089;&#x7684;app/src/main&#x8DEF;&#x5F84;&#x4E0B;&#x7684;&#x8D44;&#x6E90;&#x3002;</p>\n<p>&#x56E0;&#x4E3A;&#x5B83;&#x662F;&#x8DDF;&#x6784;&#x5EFA;&#x53D8;&#x4F53;&#x6765;&#x641C;&#x7D22;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x6709;&#x4E2A;&#x4F18;&#x5148;&#x7EA7;&#xFF1A;</p>\n<ol>\n<li>src/modeApiDebug: &#x6784;&#x5EFA;&#x53D8;&#x4F53;</li>\n<li>src/debug&#xFF1A;&#x6784;&#x5EFA;&#x7C7B;&#x578B;</li>\n<li>src/modeApi&#xFF1A;&#x4EA7;&#x54C1;&#x98CE;&#x683C;</li>\n<li>src/main&#xFF1A;&#x9ED8;&#x8BA4;main&#x6E90;</li>\n</ol>\n<p>&#x5BF9;&#x4E8E;&#x6E90;&#x96C6;&#x7684;&#x521B;&#x5EFA;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#x5728;app/src&#x4E0B;&#x53F3;&#x952E;&#x65B0;&#x5EFA;&#xFF0C;&#x4F46;&#x5B83;&#x53EA;&#x4F1A;&#x5E2E;&#x4F60;&#x521B;&#x5EFA;&#x6E90;&#x96C6;&#x4E0B;&#x7684;java&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x5176;&#x5B83;&#x7684;&#x90FD;&#x8981;&#x4F60;&#x81EA;&#x5DF1;&#x9010;&#x4E2A;&#x521B;&#x5EFA;</p>\n<p><img src=\"/2019/05/23/Gradle&#x7CFB;&#x5217;-&#x8FD0;&#x7528;&#x7BC7;/Gradle&#x7CFB;&#x5217;-&#x8FD0;&#x7528;&#x7BC7;1.png\" alt></p>\n<p>&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;debug&#x6E90;&#x96C6;&#xFF0C;&#x6240;&#x4EE5;&#x8FDB;&#x53BB;&#x4E4B;&#x540E;Target Source Set&#x9009;&#x62E9;debug&#xFF0C;&#x518D;&#x70B9;&#x51FB;finish&#x7ED3;&#x675F;&#x3002;&#x8FD9;&#x65F6;&#x4F60;&#x5C06;&#x4F1A;&#x5728;src&#x4E0B;&#x770B;&#x5230;debug&#x6587;&#x4EF6;&#x5939;</p>\n<p>&#x73B0;&#x5728;&#x4F60;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;debug&#x7684;&#x6E90;&#x96C6;&#x76EE;&#x5F55;&#xFF0C;&#x5047;&#x8BBE;&#x4F60;&#x73B0;&#x5728;&#x8981;&#x4F7F;debug&#x4E0B;&#x7684;app&#x540D;&#x79F0;&#x5C55;&#x793A;&#x6210;Android&#x7CBE;&#x534E;&#x5F55;debug(&#x9ED8;&#x8BA4;&#x662F;Android&#x7CBE;&#x534E;&#x5F55;)&#x3002;&#x8FD9;&#x65F6;&#x4F60;&#x53EF;&#x4EE5;&#x53F3;&#x952E;debug&#x65B0;&#x5EFA;values</p>\n<p><img src=\"/2019/05/23/Gradle&#x7CFB;&#x5217;-&#x8FD0;&#x7528;&#x7BC7;/Gradle&#x7CFB;&#x5217;-&#x8FD0;&#x7528;&#x7BC7;2.png\" alt></p>\n<p>&#x5728;values&#x76EE;&#x5F55;&#x4E0B;&#x65B0;&#x5EFA;strings.xml&#xFF0C;&#x7136;&#x540E;&#x5728;&#x5176;&#x4E2D;&#x914D;&#x7F6E;app_name</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;resources&gt;</span><br><span class=\"line\">    &lt;string name=&quot;app_name&quot;&gt;Android&#x7CBE;&#x534E;&#x5F55;debug&lt;/string&gt;</span><br><span class=\"line\">&lt;/resources&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x4F60;&#x518D;&#x53BB;&#x6784;&#x5EFA;debug&#x76F8;&#x5173;&#x7684;&#x53D8;&#x4F53;&#x65F6;&#xFF0C;&#x4F60;&#x5B89;&#x88C5;&#x7684;app&#x5C55;&#x793A;&#x7684;&#x540D;&#x79F0;&#x5C06;&#x662F;Android&#x7CBE;&#x534E;&#x5F55;debug&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x901A;&#x8FC7;&#x4FEE;&#x6539;mian&#x6E90;&#x96C6;&#x6216;&#x8005;&#x914D;&#x7F6E;&#x5176;&#x5B83;&#x7684;&#x53D8;&#x4F53;&#x6E90;&#x96C6;&#xFF0C;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x6839;&#x636E;&#x53D8;&#x4F53;&#x52A0;&#x8F7D;&#x4E0D;&#x540C;&#x7684;&#x6570;&#x636E;&#x6E90;&#x3002;&#x8FD9;&#x6837;&#x7CFB;&#x7EDF;&#x5316;&#x7684;&#x914D;&#x7F6E;&#x52A0;&#x8F7D;&#x8D44;&#x6E90;&#x5C06;&#x66F4;&#x52A0;&#x65B9;&#x4FBF;&#x9879;&#x76EE;&#x6D4B;&#x8BD5;&#x4E0E;&#x7248;&#x672C;&#x9700;&#x8981;&#x7684;&#x914D;&#x7F6E;&#x3002;</p>\n<h2 id=\"dependencies\"><a href=\"#dependencies\" class=\"headerlink\" title=\"dependencies\"></a>dependencies</h2><p>dependencies&#x95ED;&#x5305;&#x4E0A;&#x7528;&#x6765;&#x914D;&#x7F6E;&#x9879;&#x76EE;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x4F9D;&#x8D56;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x6839;&#x636E;&#x4E0A;&#x9762;&#x7684;&#x914D;&#x7F6E;&#x6709;&#x8BBE;&#x7F6E;&#x53D8;&#x4F53;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x5C06;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x53D8;&#x4F53;&#x6765;&#x9009;&#x62E9;&#x6027;&#x7684;&#x4F9D;&#x8D56;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    implementation fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])</span><br><span class=\"line\">    implementation &quot;org.jetbrains.kotlin:kotlin-stdlib-jre7:$kotlin_version&quot;</span><br><span class=\"line\">    implementation &apos;com.android.support:appcompat-v7:26.1.0&apos;</span><br><span class=\"line\">    implementation &apos;com.android.support.constraint:constraint-layout:1.0.2&apos;</span><br><span class=\"line\">    testImplementation &apos;junit:junit:4.12&apos;</span><br><span class=\"line\">    androidTestImplementation &apos;com.android.support.test:runner:1.0.1&apos;</span><br><span class=\"line\">    androidTestImplementation &apos;com.android.support.test.espresso:espresso-core:3.0.1&apos;</span><br><span class=\"line\">    //&#x6839;&#x636E;&#x53D8;&#x4F53;&#x9009;&#x62E9;&#x6027;&#x4F9D;&#x8D56;</span><br><span class=\"line\">    outerImplementation &apos;...&apos;</span><br><span class=\"line\">    prodMinApi21Implementation &apos;...&apos;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5173;&#x4E8E;dependencies&#xFF0C;&#x8FD9;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x914D;&#x7F6E;&#x65B9;&#x5F0F;&#xFF0C;&#x4E4B;&#x540E;&#x6211;&#x8FD8;&#x4F1A;&#x5355;&#x72EC;&#x62BD;&#x51FA;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x6765;&#x5199;&#x7CFB;&#x7EDF;&#x5316;&#x7684;&#x914D;&#x7F6E;dependencies&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x4E0B;&#x3002;</p>\n<p>gradle&#x76F8;&#x5173;&#x7684;&#x914D;&#x7F6E;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x51B0;&#x5C71;&#x4E00;&#x89D2;&#xFF0C;&#x4F46;&#x6211;&#x7684;&#x5EFA;&#x8BAE;&#x662F;&#x6839;&#x636E;&#x4F60;&#x7684;&#x5B9E;&#x9645;&#x9700;&#x6C42;&#x53BB;&#x5B66;&#x4E60;&#x4E0E;&#x7814;&#x7A76;&#xFF0C;&#x76F8;&#x4FE1;&#x4F60;&#x4E5F;&#x4F1A;&#x6709;&#x610F;&#x60F3;&#x4E0D;&#x5230;&#x7684;&#x6210;&#x957F;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x9644;&#x4E0A;&#x6E90;&#x7801;&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/android-api-analysis</a></p>\n<h2 id=\"&#x7CFB;&#x5217;\"><a href=\"#&#x7CFB;&#x5217;\" class=\"headerlink\" title=\"&#x7CFB;&#x5217;\"></a>&#x7CFB;&#x5217;</h2><p><a href=\"https://www.rousetime.com/2019/05/05/Android-Gradle%E7%B3%BB%E5%88%97-%E5%85%A5%E9%97%A8%E7%AF%87/\">Android Gradle&#x7CFB;&#x5217;-&#x5165;&#x95E8;&#x7BC7;</a><br><a href=\"https://www.rousetime.com/2019/05/13/Android-Gradle%E7%B3%BB%E5%88%97-%E5%8E%9F%E7%90%86%E7%AF%87/\">Android Gradle&#x7CFB;&#x5217;-&#x539F;&#x7406;&#x7BC7;</a></p>\n<p><img src=\"/2019/05/23/Gradle&#x7CFB;&#x5217;-&#x8FD0;&#x7528;&#x7BC7;/Android&#x8865;&#x7ED9;&#x7AD9;.jpg\" alt></p>\n","categories":["android"],"tags":["gradle"]},{"title":"Android Gradle系列-原理篇","url":"https://www.rousetime.com/2019/05/13/Android-Gradle系列-原理篇/","content":"<p>&#x4E0A;&#x5468;&#x6211;&#x4EEC;&#x5728;<a href=\"https://www.rousetime.com/2019/05/05/Android-Gradle%E7%B3%BB%E5%88%97-%E5%85%A5%E9%97%A8%E7%AF%87/\">Android Gradle&#x7CFB;&#x5217;-&#x5165;&#x95E8;&#x7BC7;</a>&#x6587;&#x7AE0;&#x4E2D;&#x5DF2;&#x7ECF;&#x5C06;gradle&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x7ED3;&#x6784;&#x8FC7;&#x4E86;&#x4E00;&#x904D;&#x3002;&#x5BF9;&#x4E8E;gradle&#xFF0C;&#x6211;&#x4EEC;&#x8BB8;&#x591A;&#x65F6;&#x5019;&#x90FD;&#x4E0D;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x7C7B;&#x4F3C;&#x4E0E;*.gradle&#x6587;&#x4EF6;&#xFF0C;&#x505A;&#x7684;&#x6700;&#x591A;&#x7684;&#x5E94;&#x8BE5;&#x662F;&#x5728;dependencies&#x4E2D;&#x6DFB;&#x52A0;&#x7B2C;&#x4E09;&#x65B9;&#x4F9D;&#x8D56;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x4FEE;&#x6539;sdk&#x7248;&#x672C;&#x53F7;&#xFF0C;&#x4EA6;&#x6216;&#x8005;&#x6BCF;&#x6B21;&#x53D1;&#x7248;&#x672C;&#x6539;&#x4E0B;versionCode&#x4E0E;versionName&#x3002;&#x5373;&#x4F7F;&#x78B0;&#x5230;&#x95EE;&#x9898;&#x4E5F;&#x662F;&#x76F4;&#x63A5;&#x4E0A;google&#x5BFB;&#x627E;&#x7B54;&#x6848;&#xFF0C;&#x800C;&#x5E76;&#x6CA1;&#x6709;&#x771F;&#x6B63;&#x7406;&#x89E3;&#x5B83;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x4E48;&#x505A;&#xFF0C;&#x6216;&#x8005;&#x5B83;&#x662F;&#x5982;&#x4F55;&#x8FD0;&#x884C;&#x7684;&#xFF1F;</p>\n<p>&#x4ECA;&#x5929;&#xFF0C;&#x6211;&#x4F1A;&#x901A;&#x8FC7;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x7684;&#x7F16;&#x5199;gradle&#x6587;&#x4EF6;&#xFF0C;&#x4ECE;&#x9879;&#x76EE;&#x7684;&#x521B;&#x5EFA;&#xFF0C;&#x5230;gradle&#x7684;&#x914D;&#x7F6E;&#x3002;&#x76F8;&#x4FE1;&#x6709;&#x4E86;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x4F60;&#x5C06;&#x5BF9;gradle&#x7684;&#x5185;&#x90E8;&#x8FD0;&#x884C;&#x5C06;&#x6709;&#x4E00;&#x4E2A;&#x5168;&#x65B0;&#x7684;&#x8BA4;&#x8BC6;&#x3002;</p>\n<h2 id=\"Groovy\"><a href=\"#Groovy\" class=\"headerlink\" title=\"Groovy\"></a>Groovy</h2><p>&#x5728;&#x8BB2;gradle&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x660E;&#x767D;&#x4E00;&#x70B9;&#xFF0C;gradle&#x8BED;&#x6CD5;&#x662F;&#x57FA;&#x4E8E;groovy&#x7684;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x4E86;&#x89E3;&#x4E00;&#x4E9B;groovy&#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x8FD9;&#x6709;&#x52A9;&#x4E8E;&#x6211;&#x4EEC;&#x4E4B;&#x540E;&#x7684;&#x7406;&#x89E3;&#x3002;&#x5F53;&#x7136;&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x6709;groovy&#x7684;&#x57FA;&#x7840;&#x4F60;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8DF3;&#x8FC7;&#xFF0C;&#x6CA1;&#x6709;&#x7684;&#x4E5F;&#x4E0D;&#x7528;&#x614C;&#xFF0C;&#x56E0;&#x4E3A;&#x53EA;&#x8981;&#x4F60;&#x61C2;java&#x5C31;&#x4E0D;&#x662F;&#x4EC0;&#x4E48;&#x96BE;&#x9898;&#x3002;</p>\n<h3 id=\"syntax\"><a href=\"#syntax\" class=\"headerlink\" title=\"syntax\"></a>syntax</h3><p>&#x4E0B;&#x9762;&#x6211;&#x5C06;&#x901A;&#x8FC7;code&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x5217;&#x51FA;&#x51E0;&#x70B9;</p>\n<ul>\n<li>&#x5F53;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x6709;&#x53C2;&#x6570;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;()&#xFF0C;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">def printAge(String name, int age) {</span><br><span class=\"line\">\tprint(&quot;$name is $age years old&quot;)</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">def printEmptyLine() {</span><br><span class=\"line\">\tprintln()</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">def callClosure(Closure closure) {</span><br><span class=\"line\">\tclosure()</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">printAge &quot;John&quot;, 24 //&#x8F93;&#x51FA;John is 24 years old</span><br><span class=\"line\">printEmptyLine() //&#x8F93;&#x51FA;&#x7A7A;&#x884C;</span><br><span class=\"line\">callClosure { println(&quot;From closure&quot;) } //&#x8F93;&#x51FA;From closure</span><br></pre></td></tr></table></figure>\n<ul>\n<li>&#x5982;&#x679C;&#x6700;&#x540E;&#x7684;&#x53C2;&#x6570;&#x662F;&#x95ED;&#x5305;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x5B83;&#x5199;&#x5728;&#x62EC;&#x53F7;&#x7684;&#x5916;&#x9762;</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">def callWithParam(String param, Closure&lt;String&gt; closure) {</span><br><span class=\"line\">\tclosure(param)</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">callWithParam(&quot;param&quot;, { println it }) //&#x8F93;&#x51FA;param</span><br><span class=\"line\">callWithParam(&quot;param&quot;) { println it } //&#x8F93;&#x51FA;param</span><br><span class=\"line\">callWithParam &quot;param&quot;, { println it } //&#x8F93;&#x51FA;param</span><br></pre></td></tr></table></figure>\n<ul>\n<li>&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x65F6;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x53C2;&#x6570;&#x540D;&#x8FDB;&#x884C;&#x4F20;&#x53C2;&#xFF0C;&#x6709;&#x6307;&#x5B9A;&#x7684;&#x4F1A;&#x8F6C;&#x5316;&#x5230;Map&#x5BF9;&#x8C61;&#x4E2D;&#xFF0C;&#x6CA1;&#x6709;&#x7684;&#x5C06;&#x6309;&#x6B63;&#x5E38;&#x4F20;&#x53C2;</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">def printPersonInfo(Map&lt;String, Object&gt; person) {</span><br><span class=\"line\">\tprintln(&quot;${person.name} is ${person.age} years old&quot;)</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">def printJobInfo(Map&lt;String, Object&gt; job, String employeeName) {</span><br><span class=\"line\">\tprintln(&quot;${employeeName} works as ${job.name} at ${job.company}&quot;)</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">printPersonInfo name: &quot;Jake&quot;, age: 29</span><br><span class=\"line\">printJobInfo &quot;Payne&quot;, name: &quot;Android Engineer&quot;, company: &quot;Google&quot;</span><br></pre></td></tr></table></figure>\n<p>&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x4ED6;&#x4EEC;&#x7684;&#x8C03;&#x7528;&#x90FD;&#x4E0D;&#x9700;&#x8981;&#x62EC;&#x53F7;&#xFF0C;&#x540C;&#x65F6;printJobInfo&#x7684;&#x8C03;&#x7528;&#x53C2;&#x6570;&#x7684;&#x987A;&#x5E8F;&#x4E0D;&#x53D7;&#x5F71;&#x54CD;&#x3002;</p>\n<h3 id=\"Closure\"><a href=\"#Closure\" class=\"headerlink\" title=\"Closure\"></a>Closure</h3><p>&#x5728;gradle&#x4E2D;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x8BB8;&#x591A;&#x95ED;&#x5305;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5BF9;<a href=\"http://groovy-lang.org/closures.html\" target=\"_blank\" rel=\"noopener\">&#x95ED;&#x5305;</a>&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x4E86;&#x89E3;&#x3002;&#x5982;&#x679C;&#x4F60;&#x719F;&#x6089;kotlin&#xFF0C;&#x5B83;&#x4E0E;<a href=\"https://kotlinlang.org/docs/reference/lambdas.html#function-literals-with-receiver\" target=\"_blank\" rel=\"noopener\">Function literals with receiver</a>&#x7C7B;&#x4F3C;&#x3002;</p>\n<p>&#x5728;groovy&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;Closures&#x5F53;&#x505A;&#x6210;lambdas&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5F53;&#x505A;&#x4EE3;&#x7801;&#x5757;&#x6267;&#x884C;&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x53C2;&#x6570;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x6709;&#x8FD4;&#x56DE;&#x503C;&#x3002;&#x4F46;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x5B83;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x5176;&#x81EA;&#x8EAB;&#x7684;&#x4EE3;&#x7406;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class DelegateOne {</span><br><span class=\"line\">\tdef callContent(String content) {</span><br><span class=\"line\">\t\tprintln &quot;From delegateOne: $content&quot;</span><br><span class=\"line\">\t}</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">class DelegateTow {</span><br><span class=\"line\">\tdef callContent(String content) {</span><br><span class=\"line\">\t\tprintln &quot;From delegateTwo: $content&quot;</span><br><span class=\"line\">\t}</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">def callClosure = {</span><br><span class=\"line\">\tcallContent &quot;I am bird&quot;</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">callClosure.delegate = new DelegateOne()</span><br><span class=\"line\">callClosure() //&#x8F93;&#x51FA;From delegateOne: I am bird</span><br><span class=\"line\">callClosure.delegate = new DelegateTow()</span><br><span class=\"line\">callClosure() //&#x8F93;&#x51FA;From delegateTow: I am bird</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x6539;&#x53D8;callClosure&#x7684;delegate&#xFF0C;&#x8BA9;&#x5176;&#x8C03;&#x7528;&#x4E0D;&#x540C;&#x7684;callContent&#x3002;<br>&#x5982;&#x679C;&#x4F60;&#x60F3;&#x4E86;&#x89E3;&#x66F4;&#x591A;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x9605;&#x8BFB;groovy<a href=\"http://groovy-lang.org/closures.html#_delegation_strategy\" target=\"_blank\" rel=\"noopener\">&#x6587;&#x6863;</a></p>\n<h2 id=\"Gradle\"><a href=\"#Gradle\" class=\"headerlink\" title=\"Gradle\"></a>Gradle</h2><p>&#x5728;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x5DF2;&#x7ECF;&#x63D0;&#x5230;&#x6709;&#x5173;gradle&#x7684;&#x811A;&#x6B65;&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x518D;&#x7D2F;&#x8D58;&#x3002;<br>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x6784;&#x5EFA;gradle&#x3002;</p>\n<h3 id=\"&#x642D;&#x5EFA;&#x9879;&#x76EE;&#x5C42;&#x7EA7;\"><a href=\"#&#x642D;&#x5EFA;&#x9879;&#x76EE;&#x5C42;&#x7EA7;\" class=\"headerlink\" title=\"&#x642D;&#x5EFA;&#x9879;&#x76EE;&#x5C42;&#x7EA7;\"></a>&#x642D;&#x5EFA;&#x9879;&#x76EE;&#x5C42;&#x7EA7;</h3><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;example&#xFF0C;cd&#x8FDB;&#x5165;&#x8BE5;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x5728;&#x8BE5;&#x76EE;&#x5F55;&#x4E0B;&#x6267;&#x884C;gradle projects&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x5DF2;&#x7ECF;&#x662F;&#x4E00;&#x4E2A;gradle&#x9879;&#x76EE;&#x4E86;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ gradle projects</span><br><span class=\"line\">&gt; Task :projects</span><br><span class=\"line\"> </span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\">Root project</span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\"> </span><br><span class=\"line\">Root project &apos;example&apos;</span><br><span class=\"line\">No sub-projects</span><br><span class=\"line\"> </span><br><span class=\"line\">To see a list of the tasks of a project, run gradle &lt;project-path&gt;:tasks</span><br><span class=\"line\">For example, try running gradle :tasks</span><br><span class=\"line\"> </span><br><span class=\"line\">BUILD SUCCESSFUL in 5s</span><br></pre></td></tr></table></figure>\n<p>&#x56E0;&#x4E3A;&#x8FD9;&#x91CC;&#x4E0D;&#x662F;&#x5728;Android Studio&#x4E2D;&#x521B;&#x5EFA;&#x7684;&#x9879;&#x76EE;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x4F60;&#x672C;&#x5730;&#x6CA1;&#x6709;&#x5B89;&#x88C5;&#x4E0E;&#x914D;&#x7F6E;gradle&#x73AF;&#x5883;&#xFF0C;&#x5C06;&#x4E0D;&#x4F1A;&#x6709;gradle&#x547D;&#x4EE4;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x4E00;&#x70B9;&#x8981;&#x6CE8;&#x610F;&#x4E00;&#x4E0B;&#x3002;</p>\n<p>&#x6BCF;&#x4E00;&#x4E2A;android&#x9879;&#x76EE;&#x5728;&#x5B83;&#x7684;root project&#x4E0B;&#x90FD;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x4E00;&#x4E2A;settings.gradle&#xFF0C;&#x5B83;&#x4EE3;&#x8868;&#x7740;&#x9879;&#x76EE;&#x7684;&#x5168;&#x5C40;&#x914D;&#x7F6E;&#x3002;&#x540C;&#x65F6;&#x4F7F;&#x7528;void include(String[] projectPaths)&#x65B9;&#x6CD5;&#x6765;&#x6DFB;&#x52A0;&#x5B50;&#x9879;&#x76EE;&#xFF0C;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x4E3A;example&#x6DFB;&#x52A0;app&#x5B50;&#x9879;&#x76EE;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ echo &quot;include &apos;:app&apos;&quot; &gt; settings.gradle</span><br><span class=\"line\">$ gradle projects</span><br><span class=\"line\">&gt; Task :projects</span><br><span class=\"line\"> </span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\">Root project</span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\"> </span><br><span class=\"line\">Root project &apos;example&apos;</span><br><span class=\"line\">\\--- Project &apos;:app&apos;</span><br><span class=\"line\"> </span><br><span class=\"line\">To see a list of the tasks of a project, run gradle &lt;project-path&gt;:tasks</span><br><span class=\"line\">For example, try running gradle :app:tasks</span><br><span class=\"line\"> </span><br><span class=\"line\">BUILD SUCCESSFUL in 1s</span><br><span class=\"line\">1 actionable task: 1 executed</span><br></pre></td></tr></table></figure>\n<p>:app&#x4E2D;&#x7684;:&#x4EE3;&#x8868;&#x7684;&#x662F;&#x8DEF;&#x5F84;&#x7684;&#x5206;&#x9694;&#x7B26;&#xFF0C;&#x540C;&#x65F6;&#x5728;settings.gradle&#x4E2D;&#x9ED8;&#x8BA4;root project&#x662F;&#x8BE5;&#x6587;&#x4EF6;&#x7684;&#x6587;&#x4EF6;&#x5939;&#x540D;&#x79F0;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;rootProject.name = name&#x6765;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x3002;</p>\n<h3 id=\"&#x642D;&#x5EFA;Android&#x5B50;&#x9879;&#x76EE;\"><a href=\"#&#x642D;&#x5EFA;Android&#x5B50;&#x9879;&#x76EE;\" class=\"headerlink\" title=\"&#x642D;&#x5EFA;Android&#x5B50;&#x9879;&#x76EE;\"></a>&#x642D;&#x5EFA;Android&#x5B50;&#x9879;&#x76EE;</h3><p>&#x73B0;&#x5728;&#x9700;&#x8981;&#x505A;&#x7684;&#x662F;&#x5C06;&#x5B50;&#x9879;&#x76EE;app&#x6784;&#x5EFA;&#x6210;Android&#x9879;&#x76EE;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x914D;&#x7F6E;app&#x7684;build.gradle&#x3002;&#x56E0;&#x4E3A;gradle&#x53EA;&#x662F;&#x6784;&#x5EFA;&#x5DE5;&#x5177;&#xFF0C;&#x5B83;&#x662F;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x63D2;&#x4EF6;&#x6765;&#x6784;&#x5EFA;&#x4E0D;&#x540C;&#x7684;&#x9879;&#x76EE;&#xFF0C;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x7B26;&#x5408;Android&#x7684;&#x6784;&#x5EFA;&#xFF0C;&#x9700;&#x8981;&#x7533;&#x660E;&#x5E94;&#x7528;&#x7684;&#x63D2;&#x4EF6;&#x3002;&#x8FD9;&#x91CC;&#x901A;&#x8FC7;apply&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x6709;&#x4EE5;&#x4E0B;&#x4E09;&#x79CD;&#x7C7B;&#x578B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void apply(Closure closure)</span><br><span class=\"line\">void apply(Map&lt;String, ?&gt; options)</span><br><span class=\"line\">void apply(Action&lt;? super ObjectConfigurationAction&gt; action)</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x7B2C;&#x4E8C;&#x79CD;&#xFF0C;&#x5B83;&#x7684;map&#x53C2;&#x6570;&#x9700;&#x8981;&#x4E0E;ObjectConfigurationAction&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x540D;&#x76F8;&#x5339;&#x914D;&#xFF0C;&#x800C;&#x5B83;&#x7684;&#x65B9;&#x6CD5;&#x540D;&#x6709;&#x4EE5;&#x4E0B;&#x4E09;&#x79CD;</p>\n<ul>\n<li>from: &#x5E94;&#x7528;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x6587;&#x4EF6;</li>\n<li>plugin: &#x5E94;&#x7528;&#x4E00;&#x4E2A;&#x63D2;&#x4EF6;&#xFF0C;&#x901A;&#x8FC7;id&#x6216;&#x8005;class&#x540D;</li>\n<li>to: &#x5E94;&#x7528;&#x4E00;&#x4E2A;&#x76EE;&#x6807;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;</li>\n</ul>\n<p>&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x8981;&#x4F7F;&#x7528;android&#x63D2;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x4F7F;&#x7528;apply(plugin: &#x2018;com.android.application&#x2019;)&#xFF0C;&#x53C8;&#x7531;&#x4E8E;groovy&#x7684;&#x8BED;&#x6CD5;&#x7279;&#x6027;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x62EC;&#x53F7;&#x7701;&#x7565;&#xFF0C;&#x6240;&#x4EE5;&#x6700;&#x7EC8;&#x5728;build.gradle&#x4E2D;&#x7684;&#x8868;&#x73B0;&#x53EF;&#x4EE5;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ echo &quot;apply plugin: &apos;com.android.application&apos;&quot; &gt; app/build.gradle</span><br></pre></td></tr></table></figure>\n<p>&#x6DFB;&#x52A0;&#x5B8C;&#x4EE5;&#x540E;&#xFF0C;&#x518D;&#x6765;&#x6267;&#x884C;&#x4E00;&#x4E0B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ gradle app:tasks</span><br><span class=\"line\"></span><br><span class=\"line\">FAILURE: Build failed with an exception.</span><br><span class=\"line\"> </span><br><span class=\"line\">* Where:</span><br><span class=\"line\">Build file &apos;/Users/idisfkj/example/app/build.gradle&apos; line: 1</span><br><span class=\"line\"> </span><br><span class=\"line\">* What went wrong:</span><br><span class=\"line\">A problem occurred evaluating project &apos;:app&apos;.</span><br><span class=\"line\">&gt; Plugin with id &apos;com.android.application&apos; not found.</span><br><span class=\"line\"> </span><br><span class=\"line\">* Try:</span><br><span class=\"line\">Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.</span><br><span class=\"line\"> </span><br><span class=\"line\">* Get more help at https://help.gradle.org</span><br><span class=\"line\"> </span><br><span class=\"line\">BUILD FAILED in 6s</span><br></pre></td></tr></table></figure>\n<p>&#x53D1;&#x73B0;&#x62A5;&#x9519;&#x4E86;&#xFF0C;&#x663E;&#x793A;com.android.application&#x7684;&#x63D2;&#x4EF6;id&#x627E;&#x4E0D;&#x5230;&#x3002;&#x8FD9;&#x6B63;&#x5E38;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x8FD8;&#x6CA1;&#x6709;&#x58F0;&#x660E;&#x5B83;&#x3002;&#x6240;&#x4EE5;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x8981;&#x5728;project&#x4E0B;&#x7684;build.gradle&#x4E2D;&#x58F0;&#x660E;&#x5B83;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x76F4;&#x63A5;&#x5230;app&#x4E0B;&#x7684;build.gradle&#x58F0;&#x660E;&#x5462;&#xFF1F;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x662F;android&#x9879;&#x76EE;&#xFF0C;project&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;sub-project&#xFF0C;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x5728;&#x5B50;&#x9879;&#x76EE;&#x4E2D;&#x91CD;&#x590D;&#x58F0;&#x660E;&#xFF0C;&#x7EDF;&#x4E00;&#x5230;&#x4E3B;&#x9879;&#x76EE;&#x4E2D;&#x58F0;&#x660E;&#x3002;</p>\n<p>project&#x7684;build.gradle&#x58F0;&#x660E;&#x63D2;&#x4EF6;&#x9700;&#x8981;&#x5728;buildscript&#x4E2D;&#xFF0C;&#x800C;buildscript&#x4F1A;&#x901A;&#x8FC7;ScriptHandler&#x6765;&#x6267;&#x884C;&#xFF0C;&#x4EE5;&#x81F3;&#x4E8E;sub-project&#x4E5F;&#x80FD;&#x591F;&#x4F7F;&#x7528;&#x3002;&#x6240;&#x4EE5;&#x6700;&#x7EC8;&#x7684;&#x7533;&#x660E;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buildscript {</span><br><span class=\"line\">    repositories {</span><br><span class=\"line\">        google()</span><br><span class=\"line\">        jcenter()</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    dependencies {</span><br><span class=\"line\">        classpath &apos;com.android.tools.build:gradle:3.3.2&apos;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x7684;buildscript&#x3001;repositories&#x4E0E;dependencies&#x65B9;&#x6CD5;&#x90FD;&#x662F;&#x4EE5;Closure&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x901A;&#x8FC7;delegate&#x8FDB;&#x884C;&#x8C03;&#x7528;</p>\n<ul>\n<li>buildscript(Closure)&#x5728;Project&#x4E2D;&#x8C03;&#x7528;&#xFF0C;&#x901A;&#x8FC7;ScriptHandler&#x6765;&#x6267;&#x884C;Closure</li>\n<li>repositories(Closure)&#x5728;ScriptHandler&#x4E2D;&#x8C03;&#x7528;&#xFF0C;&#x901A;&#x8FC7;RepositoryHandler&#x6765;&#x6267;&#x884C;Closure</li>\n<li>dependencies(Closure)&#x5728;ScriptHandler&#x4E2D;&#x8C03;&#x7528;&#xFF0C;&#x901A;&#x8FC7;DependencyHandler&#x6765;&#x6267;&#x884C;Closure</li>\n</ul>\n<p>&#x76F8;&#x5E94;&#x7684;google()&#x4E0E;jcenter()&#x4F1A;&#x5728;RepositoryHandler&#x6267;&#x884C;&#xFF0C;classpaht(String)&#x4F1A;&#x5728;DependencyHandler(*)&#x6267;&#x884C;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x60F3;&#x66F4;&#x8BE6;&#x7EC6;&#x7684;&#x4E86;&#x89E3;&#x53EF;&#x4EE5;&#x67E5;&#x770B;<a href=\"https://docs.gradle.org/current/dsl/org.gradle.api.Project.html#org.gradle.api.Project:buildscript%28groovy.lang.Closure%29\" target=\"_blank\" rel=\"noopener\">&#x6587;&#x6863;</a></p>\n<p>&#x8BA9;&#x6211;&#x4EEC;&#x518D;&#x4E00;&#x6B21;&#x6267;&#x884C;gradle projects</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ gradle projects</span><br><span class=\"line\"></span><br><span class=\"line\">FAILURE: Build failed with an exception.</span><br><span class=\"line\"> </span><br><span class=\"line\">* What went wrong:</span><br><span class=\"line\">A problem occurred configuring project &apos;:app&apos;.</span><br><span class=\"line\">&gt; compileSdkVersion is not specified.</span><br><span class=\"line\"> </span><br><span class=\"line\">* Try:</span><br><span class=\"line\">Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.</span><br><span class=\"line\"> </span><br><span class=\"line\">* Get more help at https://help.gradle.org</span><br><span class=\"line\"> </span><br><span class=\"line\">BUILD FAILED in 1s</span><br></pre></td></tr></table></figure>\n<p>&#x53D1;&#x73B0;&#x62A5;&#x6CA1;&#x6709;&#x6307;&#x5B9A;compileSdkVersion&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x8FD8;&#x6CA1;&#x6709;&#x5BF9;app&#x8FDB;&#x884C;&#x76F8;&#x5173;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x53EA;&#x662F;&#x5F15;&#x7528;&#x4E86;android&#x63D2;&#x4EF6;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x6765;&#x8FDB;&#x884C;&#x57FA;&#x672C;&#x914D;&#x7F6E;&#xFF0C;&#x5728;app/build.gradle&#x4E2D;&#x6DFB;&#x52A0;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android {</span><br><span class=\"line\">   buildToolsVersion &quot;28.0.1&quot;</span><br><span class=\"line\">   compileSdkVersion 28</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x5728;android&#x4E2D;&#x8FDB;&#x884C;&#x58F0;&#x660E;&#xFF0C;android&#x65B9;&#x6CD5;&#x4F1A;&#x52A0;&#x5165;&#x5230;project&#x5B9E;&#x4F8B;&#x4E2D;&#x3002;buildToolsVersion&#x4E0E;compileSdkVersion&#x5C06;&#x901A;&#x8FC7;Closure&#x5BF9;&#x8C61;&#x8FDB;&#x884C;delegate&#x3002;</p>\n<h3 id=\"Extensions\"><a href=\"#Extensions\" class=\"headerlink\" title=\"Extensions\"></a>Extensions</h3><p>android&#x65B9;&#x6CD5;&#x4F1A;&#x662F;&#x5982;&#x4F55;&#x4E0E;project&#x8FDB;&#x884C;&#x5173;&#x8054;&#x7684;&#xFF1F;&#x5728;&#x6211;&#x4EEC;&#x58F0;&#x660E;&#x7684;Android&#x63D2;&#x4EF6;&#x4E2D;&#xFF0C;&#x4F1A;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;AppExtension&#x7C7B;&#xFF0C;&#x8FD9;&#x4E2A;extension&#x5C06;&#x4F1A;&#x4E0E;android&#x547D;&#x540D;&#x3002;&#x6240;&#x4EE5;gradle&#x80FD;&#x591F;&#x8C03;&#x7528;android&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x5728;<a href=\"https://google.github.io/android-gradle-dsl/current/com.android.build.gradle.AppExtension.html\" target=\"_blank\" rel=\"noopener\">AppExtension</a>&#x4E2D;&#x5DF2;&#x7ECF;&#x58F0;&#x660E;&#x4E86;&#x5404;&#x79CD;&#x65B9;&#x6CD5;&#x5C5E;&#x6027;&#xFF0C;&#x4F8B;&#x5982;buildTypes&#x3001;defaultConfig&#x4E0E;signingConfigs&#x7B49;&#x3002;&#x8FD9;&#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x5728;android&#x65B9;&#x6CD5;&#x4E2D;&#x8C03;&#x7528;&#x5B83;&#x4EEC;&#x7684;&#x539F;&#x56E0;&#x3002;&#x4E0B;&#x9762;&#x662F;extension&#x7684;&#x521B;&#x5EFA;&#x90E8;&#x5206;&#x6E90;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> @Override</span><br><span class=\"line\"> void apply(Project project) {</span><br><span class=\"line\">     super.apply(project)</span><br><span class=\"line\">     // This is for testing.</span><br><span class=\"line\">     if (pluginHolder != null) {</span><br><span class=\"line\">         pluginHolder.plugin = this;</span><br><span class=\"line\">     }</span><br><span class=\"line\">     def buildTypeContainer = project.container(DefaultBuildType,</span><br><span class=\"line\">             new BuildTypeFactory(instantiator,  project.fileResolver))</span><br><span class=\"line\">     def productFlavorContainer = project.container(GroupableProductFlavorDsl,</span><br><span class=\"line\">             new GroupableProductFlavorFactory(instantiator, project.fileResolver))</span><br><span class=\"line\">     def signingConfigContainer = project.container(SigningConfig,</span><br><span class=\"line\">             new SigningConfigFactory(instantiator))</span><br><span class=\"line\">     extension = project.extensions.create(&apos;android&apos;, AppExtension,</span><br><span class=\"line\">             this, (ProjectInternal) project, instantiator,</span><br><span class=\"line\">             buildTypeContainer, productFlavorContainer, signingConfigContainer)</span><br><span class=\"line\">     setBaseExtension(extension)</span><br><span class=\"line\">     ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"Dependencies\"><a href=\"#Dependencies\" class=\"headerlink\" title=\"Dependencies\"></a>Dependencies</h3><p>android&#x65B9;&#x6CD5;&#x4E0B;&#x9762;&#x5C31;&#x662F;dependencies&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;dependencies</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    implementation &apos;io.reactivex.rxjava2:rxjava:2.0.4&apos;</span><br><span class=\"line\">    testImplementation &apos;junit:junit:4.12&apos;</span><br><span class=\"line\">    annotationProcessor &apos;org.parceler:parceler:1.1.6&apos;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x5E94;&#x8BE5;&#x4F1A;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x3002;dependencies&#x662F;&#x4F1A;&#x88AB;delegate&#x7ED9;DependencyHandler&#xFF0C;&#x4E0D;&#x8FC7;&#x5982;&#x679C;&#x4F60;&#x5230;<a href=\"https://docs.gradle.org/current/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html#N162FA\" target=\"_blank\" rel=\"noopener\">DependencyHandler</a>&#x4E2D;&#x53BB;&#x67E5;&#x627E;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x627E;&#x4E0D;&#x5230;&#x4E0A;&#x9762;&#x7684;implementation&#x3001;testImplementation&#x7B49;&#x65B9;&#x6CD5;&#x3002;&#x90A3;&#x5B83;&#x4EEC;&#x6709;&#x5230;&#x5E95;&#x662F;&#x600E;&#x4E48;&#x6765;&#x7684;&#x5462;&#xFF1F;&#x4EA6;&#x6216;&#x8005;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6DFB;&#x52A0;&#x4E86;dev flavor&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x53C8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;devImplementation&#x3002;&#x8FD9;&#x91CC;&#x5C31;&#x6D89;&#x53CA;&#x5230;&#x4E86;groovy&#x7684;<a href=\"http://www.groovy-lang.org/metaprogramming.html#_methodmissing\" target=\"_blank\" rel=\"noopener\">methodMissing</a>&#x65B9;&#x6CD5;&#x3002;&#x5B83;&#x80FD;&#x591F;&#x5728;runtime(*)&#x4E2D;&#x6355;&#x83B7;&#x5230;&#x6CA1;&#x6709;&#x5B9A;&#x4E49;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x81F3;&#x4E8E;(*)&#x662F;gradle&#x7684;methodMissing&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x611F;&#x5FF5;&#xFF0C;&#x5B83;&#x7533;&#x660E;&#x5728;MethodMixIn&#x4E2D;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;DependencyHandler&#x7684;&#x5B9E;&#x73B0;&#x89C4;&#x5219;&#x662F;&#xFF1A;<br>&#x5728;DependencyHandler&#x4E2D;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x56DE;&#x8C03;&#x4E86;&#x4E00;&#x4E2A;&#x6CA1;&#x6709;&#x5B9A;&#x4E49;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4E14;&#x5B83;&#x6709;&#x76F8;&#x5E94;&#x7684;&#x53C2;&#x6570;&#xFF1B;&#x540C;&#x65F6;&#x5B83;&#x7684;&#x65B9;&#x6CD5;&#x540D;&#x5728;configuration(*)&#x4E2D;&#xFF1B;&#x90A3;&#x4E48;&#x5C06;&#x4F1A;&#x6839;&#x636E;&#x65B9;&#x6CD5;&#x540D;&#x4E0E;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x6765;&#x8C03;&#x7528;doAdd&#x7684;&#x76F8;&#x5E94;&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;configuration(*)&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;plugin&#x90FD;&#x6709;&#x4ED6;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x4F8B;&#x5982;java&#x63D2;&#x4EF6;&#x5B9A;&#x4E49;&#x4E86;compile&#x3001;compileClassPath&#x3001;testCompile&#x7B49;&#x3002;&#x800C;&#x5BF9;&#x4E8E;Android&#x63D2;&#x4EF6;&#x5728;&#x8FD9;&#x57FA;&#x7840;&#x4E0A;&#x8FD8;&#x4F1A;&#x5B9A;&#x4E49;annotationProcessor&#xFF0C;(variant)Implementation&#x3001;(variant)TestImplementation&#x7B49;&#x3002;&#x5BF9;&#x4E8E;variant&#x5219;&#x662F;&#x57FA;&#x4E8E;&#x4F60;&#x8BBE;&#x7F6E;&#x7684;buildTypes&#x4E0E;flavors&#x3002;</p>\n<p>&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x7531;&#x4E8E;doAdd()&#x662F;&#x79C1;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;add()&#x662F;&#x516C;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x6240;&#x4EE5;&#x5728;dependencies&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;add</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    add(&apos;implementation&apos;, &apos;io.reactivex.rxjava2:rxjava:2.0.4&apos;)</span><br><span class=\"line\">    add(&apos;testImplementation&apos;, &apos;junit:junit:4.12&apos;)</span><br><span class=\"line\">    add(&apos;annotationProcessor&apos;, &apos;org.parceler:parceler:1.1.6&apos;)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x79CD;&#x5199;&#x6CD5;&#x5E76;&#x4E0D;&#x63A8;&#x8350;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x7406;&#x89E3;&#x5B83;&#x7684;&#x539F;&#x7406;&#x3002;</p>\n<p>gradle&#x7684;&#x77E5;&#x8BC6;&#x70B9;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#xFF0C;&#x8FD9;&#x53EA;&#x662F;&#x5BF9;&#x6709;&#x5173;Android&#x7684;&#x4E00;&#x90E8;&#x5206;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x3002;&#x5F53;&#x6211;&#x4EEC;&#x8FDB;&#x884C;gradle&#x914D;&#x7F6E;&#x7684;&#x65F6;&#xFF0C;&#x4E0D;&#x81F3;&#x4E8E;&#x5BF9;gradle&#x7684;&#x8BED;&#x6CD5;&#x611F;&#x5230;&#x9B54;&#x5E7B;&#xFF0C;&#x6216;&#x8005;&#x5BF9;&#x5B83;&#x7684;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;&#x611F;&#x5230;&#x4E0D;&#x89E3;&#x3002;</p>\n<p>&#x6211;&#x5728;github&#x4E0A;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x4ED3;&#x5E93;<a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">Android&#x7CBE;&#x534E;&#x5F55;</a>&#xFF0C;&#x6536;&#x96C6;Android&#x76F8;&#x5173;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x9700;&#x8981;&#x7684;&#x53EF;&#x4EE5;&#x53BB;&#x770B;&#x4E00;&#x4E0B;&#xFF0C;&#x6709;&#x597D;&#x7684;&#x6587;&#x7AE0;&#x53EF;&#x4EE5;&#x52A0;&#x6211;&#x5FAE;&#x4FE1;fan331100&#x63A8;&#x8350;&#x7ED9;&#x6211;&#x3002;</p>\n<p><img src=\"/2019/05/13/Android-Gradle&#x7CFB;&#x5217;-&#x539F;&#x7406;&#x7BC7;/Android&#x8865;&#x7ED9;&#x7AD9;.jpg\" alt=\"Android&#x8865;&#x7ED9;&#x7AD9;\"></p>\n","categories":["android"],"tags":["gradle"]},{"title":"Gson与List<T>对象间的相亲之旅","url":"https://www.rousetime.com/2019/05/08/Gson与List-T-对象间的相亲之旅/","content":"<p>&#x968F;&#x7740;&#x4EBA;&#x4EEC;&#x7684;&#x751F;&#x6D3B;&#x6C34;&#x5E73;&#x7684;&#x63D0;&#x9AD8;&#xFF0C;&#x8FDE;&#x5E26;&#x7740;&#x4EBA;&#x4E0E;&#x4EBA;&#x4E4B;&#x95F4;&#x7684;&#x76F8;&#x4EB2;&#x6E20;&#x9053;&#x4E5F;&#x8FDB;&#x4E00;&#x6B65;&#x6539;&#x5584;&#x3002;&#x6700;&#x8FD1;&#x5076;&#x5C14;&#x770B;&#x5230;&#x51E0;&#x6863;&#x76F8;&#x4EB2;&#x7684;&#x7EFC;&#x827A;&#x8282;&#x76EE;&#xFF0C;&#x4E0D;&#x7BA1;&#x662F;&#x5E73;&#x6C11;&#x8FD8;&#x662F;&#x660E;&#x661F;&#x3002;&#x53EF;&#x89C1;&#x76F8;&#x4EB2;&#x7684;&#x70ED;&#x6F6E;&#x6B63;&#x6251;&#x9762;&#x800C;&#x6765;&#x3002;&#x8FD9;&#x4E0D;Google&#x4E0E;Java&#x4E24;&#x4E2A;&#x8001;&#x5BB6;&#x4F19;&#x4E5F;&#x5750;&#x4E0D;&#x4F4F;&#x4E86;&#xFF0C;&#x5206;&#x522B;&#x60F3;&#x7740;&#x81EA;&#x5DF1;&#x6392;&#x884C;285&#x7684;&#x513F;&#x5B50;Gson&#x4E0E;&#x81EA;&#x5DF1;&#x6392;&#x884C;570&#x7684;&#x5973;&#x513F;List<t>&#x4E5F;&#x8BE5;&#x5230;&#x4E86;&#x76F8;&#x4EB2;&#x7684;&#x5E74;&#x9F84;&#x4E86;&#x3002;&#x4E8E;&#x662F;Google&#x4E0E;Java&#x4E24;&#x4E2A;&#x8001;&#x6CB9;&#x6761;&#x4F1A;&#x5FC3;&#x4E00;&#x7B11;&#xFF0C;&#x4E00;&#x8D77;&#x7B56;&#x5212;&#x4E86;&#x4ECA;&#x5929;&#x7684;&#x8FD9;&#x6B21;&#x76F8;&#x4EB2;&#x4E4B;&#x65C5;&#x3002;</t></p>\n<h2 id=\"&#x5730;&#x4E0B;&#x604B;&#x60C5;\"><a href=\"#&#x5730;&#x4E0B;&#x604B;&#x60C5;\" class=\"headerlink\" title=\"&#x5730;&#x4E0B;&#x604B;&#x60C5;\"></a>&#x5730;&#x4E0B;&#x604B;&#x60C5;</h2><p>Google&#x56DE;&#x5230;&#x5BB6;&#x5C31;&#x5C06;&#x6B64;&#x4E8B;&#x544A;&#x8BC9;&#x4E86;Gson&#xFF0C;&#x901A;&#x77E5;&#x4ED6;&#x660E;&#x5929;&#x5C31;&#x53BB;Android Studio&#x5306;&#x5306;&#x90A3;&#x5E74;&#x9910;&#x5385;&#x89C1;&#x9762;&#x3002;Gson&#x6B32;&#x8A00;&#x6B32;&#x6B62;&#xFF0C;&#x597D;&#x50CF;&#x53E6;&#x6709;&#x9690;&#x60C5;&#xFF0C;&#x4F46;&#x5728;&#x7236;&#x4EB2;&#x9AD8;&#x5927;&#x8EAB;&#x8EAF;&#x4E0E;&#x51CC;&#x5389;&#x7684;&#x773C;&#x795E;&#x4E0B;&#x7B54;&#x5E94;&#x4E86;&#x4E0B;&#x6765;&#xFF0C;&#x800C;&#x4E14;&#x7236;&#x4EB2;&#x80FD;&#x591F;&#x5728;&#x8FD9;&#x4F17;&#x591A;&#x7684;&#x513F;&#x5B50;&#x4E2D;&#x60F3;&#x5230;&#x81EA;&#x5DF1;&#xFF0C;&#x4E5F;&#x4E0D;&#x5FCD;&#x5FC3;&#x62D2;&#x7EDD;&#x7236;&#x4EB2;&#x7684;&#x5584;&#x610F;&#x3002;</p>\n<p>Gson&#x56DE;&#x5230;&#x623F;&#xFF0C;&#x8EBA;&#x7740;&#x5E8A;&#x4E0A;&#xFF0C;&#x8111;&#x6D77;&#x56DE;&#x60F3;&#x8D77;&#x81EA;&#x5DF1;&#x4E0E;Java&#x6392;&#x884C;520&#x7684;&#x5973;&#x513F;Object&#x7684;&#x5730;&#x4E0B;&#x604B;&#x60C5;&#x3002;</p>\n<p>Gson&#x4E0E;Object&#x7684;&#x7B2C;&#x4E00;&#x6B21;&#x89C1;&#x9762;&#x8FD8;&#x662F;&#x88AB;&#x5B83;&#x7684;Json&#x5B57;&#x7B26;&#x4E32;&#x88C5;&#x626E;&#x6240;&#x5438;&#x5F15;&#x3002;&#x90A3;&#x4E00;&#x5929;&#x5979;&#x5B9B;&#x5982;&#x4E00;&#x6735;&#x542B;&#x82DE;&#x5F85;&#x653E;&#x7684;&#x7261;&#x4E39;&#x82B1;&#xFF0C;&#x7F8E;&#x800C;&#x4E0D;&#x5996;&#xFF0C;&#x8273;&#x800C;&#x4E0D;&#x4FD7;&#xFF0C;&#x5343;&#x5A07;&#x767E;&#x5A9A;&#xFF0C;&#x65E0;&#x4E0E;&#x4F26;&#x6BD4;&#x3002;(&#x4EE5;&#x4E0A;&#x5747;&#x4E3A;Gson&#x89C6;&#x89D2;&#xFF0C;&#x8BF7;&#x52FF;&#x8FF7;&#x604B;&#x3002;&#x4EE5;&#x4E0B;&#x4E3A;code&#x89C6;&#x89D2;)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">{</span><br><span class=\"line\">    &quot;marquee&quot;: {</span><br><span class=\"line\">        &quot;content&quot;: &quot;&#x7FE0;&#x7EFF;&#x70DF;&#x7EB1;&#x6563;&#x82B1;&#x88D9;&quot;,</span><br><span class=\"line\">        &quot;status&quot;: true</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E00;&#x4E0B;&#x5C31;&#x6FC0;&#x8D77;&#x4E86;Gson&#x7684;&#x6B32;&#x671B;&#xFF0C;&#x800C;&#x4E14;Gson&#x8FD8;&#x6709;&#x70B9;&#x5C0F;&#x5F97;&#x610F;&#xFF0C;&#x5BF9;&#x4E8E;&#x8FD9;&#x79CD;&#x5973;&#x5B69;&#x4ED6;&#x5DF2;&#x7ECF;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x4E00;&#x5957;&#x5B8C;&#x6574;&#x653B;&#x7565;&#x65B9;&#x6848;&#x3002;&#x65E2;&#x7136;&#x77E5;&#x9053;&#x4E86;&#x5B83;&#x7684;Json&#x5B57;&#x7B26;&#x4E32;&#x683C;&#x5F0F;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8FC5;&#x901F;&#x521B;&#x5EFA;&#x51FA;&#x5B83;&#x5BF9;&#x5E94;&#x7684;java&#x7C7B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class HomeMarqueeModel {</span><br><span class=\"line\"> </span><br><span class=\"line\">    private MarqueeModel marquee;</span><br><span class=\"line\"> </span><br><span class=\"line\">    public static class MarqueeModel {</span><br><span class=\"line\">        private String content;</span><br><span class=\"line\">        private boolean status;</span><br><span class=\"line\"> </span><br><span class=\"line\">        public String getContent() {</span><br><span class=\"line\">            return content;</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        public boolean isStatus() {</span><br><span class=\"line\">            return status;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    public MarqueeModel getMarquee() {</span><br><span class=\"line\">        return marquee;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x518D;&#x6839;&#x636E;API&#x653B;&#x7565;&#x6CD5;&#x5219;&#x7B2C;3089&#x6761;&#xFF0C;&#x4F7F;&#x7528;fromJson&#x65B9;&#x6848;&#x8FDB;&#x884C;&#x653B;&#x7565;&#xFF0C;&#x6210;&#x529F;&#x7387;&#x9AD8;&#x8FBE;100%</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HomeMarqueeModel model = new Gson().fromJson(jsonStr, HomeMarqueeModel.class);</span><br></pre></td></tr></table></figure>\n<p>&#x5C31;&#x8FD9;&#x6837;Gson&#x5B8C;&#x6210;&#x4E86;&#x5BF9;Object&#x7684;&#x7B2C;&#x4E00;&#x6B21;&#x653B;&#x7565;&#xFF0C;&#x83B7;&#x53D6;&#x5230;&#x4E86;Object&#x7684;&#x597D;&#x611F;&#x3002;&#x4F46;Gson&#x4E0D;&#x6EE1;&#x8DB3;&#xFF0C;&#x4E3A;&#x4E86;&#x5B8C;&#x5168;&#x8BA9;Object&#x5BF9;&#x81EA;&#x5DF1;&#x6B7B;&#x5FC3;&#x584C;&#x5730;&#xFF0C;&#x5FC5;&#x987B;&#x5E94;&#x5BF9;Object&#x7684;&#x6240;&#x6709;Json&#x5B57;&#x7B26;&#x4E32;&#x683C;&#x5F0F;&#x3002;</p>\n<p>&#x56DE;&#x53BB;&#x4E4B;&#x540E;&#xFF0C;Gson&#x5728;Android Studio&#x5FAE;&#x4FE1;&#x5E73;&#x53F0;&#x4E0E;Java&#x4E2D;&#x7684;&#x597D;&#x54E5;&#x4EEC;&#x6CDB;&#x578B;T&#x6253;&#x63A2;Object&#x7684;&#x7279;&#x6027;&#x3002;&#x7ECF;&#x8FC7;&#x4EA4;&#x6D41;&#xFF0C;&#x53D1;&#x73B0;T&#x5B83;&#x521A;&#x597D;&#x662F;&#x8FD9;&#x65B9;&#x9762;&#x7684;&#x80FD;&#x624B;&#xFF0C;T&#x544A;&#x8BC9;Gson&#x6BCF;&#x4E00;&#x4E2A;Object&#x90FD;&#x6709;&#x5B83;&#x72EC;&#x7528;&#x7684;Class&#x5C5E;&#x6027;&#xFF0C;&#x4E3A;&#x4E86;&#x4EE3;&#x8868;&#x6240;&#x6709;&#x7684;Class&#x7C7B;&#x578B;&#xFF0C;&#x521A;&#x597D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B83;&#x7684;&#x6CDB;&#x578B;T&#x6765;&#x8868;&#x793A;&#xFF0C;&#x4E8E;&#x662F;&#x5C31;&#x6709;&#x4E86;<code>Class&lt;T&gt;</code>&#x3002;</p>\n<p>&#x7B2C;&#x4E8C;&#x5929;&#xFF0C;Gson&#x4E3B;&#x52A8;&#x51FA;&#x51FB;&#x9080;&#x8BF7;Object&#x53BB;Android Studio&#x5306;&#x5306;&#x90A3;&#x5E74;&#x9910;&#x5385;&#x5403;&#x996D;&#x3002;Gson&#x8FD8;&#x662F;&#x4F7F;&#x7528;&#x5B83;&#x7684;fromJson&#x65B9;&#x6CD5;&#xFF0C;&#x53EA;&#x662F;&#x5728;&#x8FD9;&#x65B9;&#x6CD5;&#x4E0A;&#x52A0;&#x5165;&#x4E86;T&#x7684;&#x601D;&#x60F3;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public &lt;T&gt; T getObjectGirl(String jsonStr, Class&lt;T&gt; tGirl) {</span><br><span class=\"line\">    T girl = getGson().fromJson(jsonStr, tGirl);</span><br><span class=\"line\">    return girl;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5C31;&#x8FD9;&#x6837;&#xFF0C;Gson&#x5B8C;&#x6210;&#x5BF9;Object&#x7684;&#x6240;&#x6709;&#x7C7B;&#x578B;&#x7684;&#x653B;&#x7565;&#xFF0C;&#x4ECE;&#x6B64;&#x4E0D;&#x518D;&#x4E3A;&#x5973;&#x53CB;&#x800C;&#x53D1;&#x6101;&#x3002;<br>&#x56DE;&#x60F3;&#x7ED3;&#x675F;&#xFF0C;&#x62C9;&#x56DE;&#x5230;&#x73B0;&#x5B9E;&#xFF0C;&#x5BF9;&#x4E8E;&#x660E;&#x5929;&#x7684;&#x76F8;&#x4EB2;&#xFF0C;Gson&#x6253;&#x7B97;&#x5148;&#x7528;&#x4E4B;&#x524D;&#x7684;&#x65B9;&#x6CD5;&#x8BD5;&#x4E00;&#x4E0B;&#xFF0C;&#x6BD5;&#x7ADF;Gson&#x7ECF;&#x8FC7;&#x524D;&#x9762;&#x7684;&#x6210;&#x529F;&#x5B9E;&#x4F8B;&#xFF0C;&#x8FD8;&#x662F;&#x6709;&#x70B9;&#x5C0F;&#x81A8;&#x80C0;&#xFF0C;</p>\n<h2 id=\"&#x521D;&#x6B21;&#x89C1;&#x9762;\"><a href=\"#&#x521D;&#x6B21;&#x89C1;&#x9762;\" class=\"headerlink\" title=\"&#x521D;&#x6B21;&#x89C1;&#x9762;\"></a>&#x521D;&#x6B21;&#x89C1;&#x9762;</h2><p>&#x65E9;&#x4E0A;9&#x70B9;&#xFF0C;Gson&#x6574;&#x88C5;&#x5F85;&#x53D1;&#xFF0C;&#x5F00;&#x7740;&#x81EA;&#x5DF1;&#x7684;&#x5170;&#x535A;&#x57FA;&#x5C3C;&#x5411;Android Studio&#x5306;&#x5306;&#x90A3;&#x5E74;&#x9910;&#x5385;&#x8FDB;&#x53D1;&#x3002;&#x5927;&#x7EA6;10&#x70B9;Gson&#x5230;&#x8FBE;&#x9910;&#x5385;&#xFF0C;&#x4E14;&#x5DF2;&#x7ECF;&#x9009;&#x597D;&#x4E86;&#x4E00;&#x5904;&#x98CE;&#x666F;&#x4F18;&#x96C5;&#x4E14;&#x9762;&#x671D;&#x5927;&#x6D77;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x9759;&#x9759;&#x7684;&#x7B49;&#x5019;List&#x7684;&#x5230;&#x6765;&#x3002;&#x534A;&#x5C0F;&#x65F6;&#x4E4B;&#x540E;&#xFF0C;&#x53EA;&#x89C1;&#x4E00;&#x4E2A;&#x8EAB;&#x7A7F;&#x85D5;&#x8272;&#x7EB1;&#x886B;&#x7684;&#x5973;&#x5B69;&#xFF0C;&#x8138;&#x5E26;&#x5FAE;&#x7B11;&#xFF0C;&#x8EAB;&#x5F62;&#x82D7;&#x6761;&#xFF0C;&#x957F;&#x53D1;&#x62AB;&#x5411;&#x80CC;&#x5FC3;&#xFF0C;&#x7528;&#x4E00;&#x6839;&#x94F6;&#x8272;&#x4E1D;&#x5E26;&#x8F7B;&#x8F7B;&#x633D;&#x4F4F;&#xFF0C;&#x8FCE;&#x9762;&#x800C;&#x6765;&#x3002;Gson&#x671B;&#x7740;&#x5979;&#x7684;&#x8EAB;&#x5F71;&#xFF0C;&#x53EA;&#x89C9;&#x8FD9;&#x5973;&#x5B69;&#x8EAB;&#x65C1;&#x4F3C;&#x6709;&#x70DF;&#x971E;&#x8F7B;&#x7B3C;&#xFF0C;&#x5F53;&#x771F;&#x975E;&#x5C18;&#x4E16;&#x4E2D;&#x4EBA;&#x3002;(&#x4EE5;&#x4E0A;&#x5747;&#x4E3A;Gson&#x89C6;&#x89D2;&#xFF0C;&#x8BF7;&#x52FF;&#x8FF7;&#x604B;&#x3002;&#x4EE5;&#x4E0B;&#x4E3A;code&#x89C6;&#x89D2;)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">    {</span><br><span class=\"line\">        &quot;title&quot;: &quot;&#x8EAB;&#x7A7F;&#x85D5;&#x8272;&#x7EB1;&#x886B;&quot;,</span><br><span class=\"line\">        &quot;url&quot;: &quot;http://127.0.0.1:8000/admin2/operation/banner-list/&quot;,</span><br><span class=\"line\">        &quot;status&quot;: true</span><br><span class=\"line\">    },</span><br><span class=\"line\">    {</span><br><span class=\"line\">        &quot;title&quot;: &quot;&#x957F;&#x53D1;&#x62AB;&#x5411;&#x80CC;&#x5FC3;&quot;,</span><br><span class=\"line\">        &quot;url&quot;: &quot;http://127.0.0.1:8000/admin2/operation/banner-list/&quot;,</span><br><span class=\"line\">        &quot;status&quot;: true</span><br><span class=\"line\">    }</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>&#x4E3A;&#x4E86;&#x4FDD;&#x5B88;&#x8D77;&#x89C1;&#xFF0C;Gson&#x51B3;&#x5B9A;&#x8FD8;&#x662F;&#x6309;&#x90E8;&#x5C31;&#x73ED;&#x6765;&#xFF0C;&#x9996;&#x5148;&#x521B;&#x5EFA;&#x51FA;&#x8BE5;Json&#x5B57;&#x7B26;&#x4E32;&#x5217;&#x8868;&#x7684;java&#x7C7B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class HomeBannerModel {</span><br><span class=\"line\">    private String title;</span><br><span class=\"line\">    private String url;</span><br><span class=\"line\">    private boolean status;</span><br><span class=\"line\"> </span><br><span class=\"line\">    public String getTitle() {</span><br><span class=\"line\">        return title;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    public String getUrl() {</span><br><span class=\"line\">        return url;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    public boolean isStatus() {</span><br><span class=\"line\">        return status;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x518D;&#x4F7F;&#x7528;fromJson&#x65B9;&#x6848;&#x8FDB;&#x884C;&#x653B;&#x7565;&#xFF0C;&#x7A0D;&#x5FAE;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x8FD9;&#x91CC;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HomeBannerModel[] array = new Gson().fromJson(jsonStr, HomeBannerModel[].class);</span><br><span class=\"line\">List&lt;HomeBannerModel&gt; list = Arrays.asList(array);</span><br></pre></td></tr></table></figure>\n<p>&#x55EF;&#xFF0C;&#x770B;&#x6837;&#x5B50;&#x6548;&#x679C;&#x4E0D;&#x9519;&#xFF0C;&#x6709;&#x8FDB;&#x4E00;&#x6B65;&#x53D1;&#x5C55;&#x7684;&#x673A;&#x4F1A;&#x3002;&#x4E8E;&#x662F;Gson&#x53C8;&#x5C55;&#x793A;&#x5B83;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x653B;&#x7565;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Type type = new TypeToken&lt;List&lt;HomeBannerModel&gt;&gt;(){}.getType();</span><br><span class=\"line\">List&lt;HomeBannerModel&gt; list = new Gson().fromJson(jsonStr, type);</span><br></pre></td></tr></table></figure>\n<p>&#x679C;&#x7136;&#xFF0C;Gson&#x518D;&#x4E00;&#x6B21;&#x6210;&#x529F;&#x9017;&#x7B11;&#x4E86;List&#x3002;Gson&#x7684;&#x81A8;&#x80C0;&#x5FC3;&#x518D;&#x4E00;&#x6B21;&#x66B4;&#x6DA8;&#x3002;Gson&#x4E8E;&#x662F;&#x5927;&#x80C6;&#x8D77;&#x6765;&#xFF0C;&#x5957;&#x7528;&#x4E4B;&#x524D;&#x6CDB;&#x578B;T&#x7684;&#x601D;&#x60F3;&#x3002;&#x4E8E;&#x662F;&#x6709;&#x4E86;&#x4E0B;&#x9762;&#x7684;&#x7B2C;&#x4E00;&#x6B21;T&#x5C1D;&#x8BD5;</p>\n<p><img src=\"/2019/05/08/Gson&#x4E0E;List-T-&#x5BF9;&#x8C61;&#x95F4;&#x7684;&#x76F8;&#x4EB2;&#x4E4B;&#x65C5;/Gson&#x4E0E;List-T-&#x5BF9;&#x8C61;&#x95F4;&#x7684;&#x76F8;&#x4EB2;&#x4E4B;&#x65C5;1.jpg\" alt></p>\n<p>&#x53D1;&#x73B0;&#x4E0D;&#x884C;&#xFF0C;&#x4E0D;&#x652F;&#x6301;&#x8FD9;&#x79CD;&#x6CDB;&#x578B;T&#x89E3;&#x6790;&#x3002;&#x65E2;&#x7136;&#x8FD9;&#x79CD;&#x4E0D;&#x884C;&#xFF0C;&#x8FD8;&#x5C31;&#x6362;&#x53E6;&#x4E00;&#x79CD;,&#x4E8E;&#x662F;&#x5C31;&#x6709;&#x4E86;&#x7B2C;&#x4E8C;&#x6B21;T&#x7684;&#x5C1D;&#x8BD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public &lt;T&gt; List&lt;T&gt; getListGirl(String jsonStr) {</span><br><span class=\"line\">      Type type = new TypeToken&lt;List&lt;T&gt;&gt;(){}.getType();</span><br><span class=\"line\">      List&lt;T&gt; listGirl = new Gson().fromJson(jsonStr, type);</span><br><span class=\"line\">      return listGirl;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x53D1;&#x73B0;&#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x90A3;&#x4E48;&#x518D;&#x6765;&#x5B9E;&#x8DF5;&#x8FD0;&#x884C;&#x4E00;&#x4E0B;&#x3002;&#x53D1;&#x73B0;&#x4F1A;&#x62A5;&#x5982;&#x4E0B;&#x5F02;&#x5E38;&#xFF0C;&#x5BFC;&#x81F4;&#x5C0F;&#x59D0;&#x59D0;&#x4E0D;&#x5F00;&#x5FC3;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java.lang.AssertionError: illegal type variable reference</span><br></pre></td></tr></table></figure>\n<p>&#x8BF4;&#x660E;Gson&#x89E3;&#x6790;&#x4E0D;&#x652F;&#x6301;&#x8BE5;&#x6CDB;&#x578B;T&#x4E66;&#x5199;&#xFF0C;&#x5BFC;&#x81F4;Type&#x89E3;&#x6790;&#x51FA;&#x9519;&#xFF0C;Gson&#x4E00;&#x4E0B;&#x61F5;&#x4E86;&#xFF0C;&#x90A3;&#x8BE5;&#x548B;&#x6574;&#x5462;&#xFF1F;&#x867D;&#x7136;&#x524D;&#x9762;&#x7684;&#x653B;&#x7565;&#x6709;&#x6548;&#x679C;&#xFF0C;&#x4F46;&#x6700;&#x540E;&#x7684;&#x5C1D;&#x8BD5;&#x6CA1;&#x6709;&#x6210;&#x529F;&#x3002;&#x4F46;&#x5929;&#x8272;&#x4EE5;&#x665A;&#xFF0C;&#x4ECA;&#x5929;&#x7684;&#x76F8;&#x4EB2;&#x4E5F;&#x53EA;&#x80FD;&#x5C31;&#x6B64;&#x6253;&#x4F4F;&#xFF0C;&#x6709;&#x5F85;&#x8FDB;&#x4E00;&#x6B65;&#x5546;&#x69B7;&#x3002;</p>\n<h2 id=\"&#x8BF7;&#x6559;\"><a href=\"#&#x8BF7;&#x6559;\" class=\"headerlink\" title=\"&#x8BF7;&#x6559;\"></a>&#x8BF7;&#x6559;</h2><p>&#x56DE;&#x5230;&#x5BB6;Gson&#x4E00;&#x76F4;&#x6302;&#x5FF5;&#x7740;&#x8FD9;&#x4EF6;&#x4E8B;&#xFF0C;&#x4E00;&#x7B79;&#x83AB;&#x5C55;&#x3002;Google&#x770B;&#x5230;&#x81EA;&#x5DF1;&#x513F;&#x5B50;&#x6101;&#x7709;&#x82E6;&#x5C55;&#x7684;&#x6837;&#x5B50;&#xFF0C;&#x4E0D;&#x7ECF;&#x8BE2;&#x95EE;&#x4ECA;&#x5929;&#x7684;&#x8FDB;&#x5C55;&#x3002;&#x4E86;&#x89E3;&#x60C5;&#x51B5;&#x540E;&#xFF0C;Google&#x7ED9;Gson&#x7684;&#x5EFA;&#x8BAE;&#x662F;&#xFF0C;&#x53EF;&#x4EE5;&#x53BB;&#x8BF7;&#x6559;&#x4E0B;ParameterizedType&#x3002;&#x4E8E;&#x662F;Gson&#x8FEB;&#x4E0D;&#x53CA;&#x5F85;&#x7684;&#x53BB;&#x627E;ParameterizedType&#x5B66;&#x4E60;&#x4EBA;&#x751F;&#x771F;&#x8C1B;&#x3002;</p>\n<p>&#x7ECF;&#x8FC7;&#x8BF7;&#x6559;&#xFF0C;&#x53D1;&#x73B0;ParameterizedType&#x662F;&#x7EE7;&#x627F;&#x4E8E;Type&#xFF0C;&#x81EA;&#x5DF1;&#x53E6;&#x5916;&#x63D0;&#x4F9B;&#x4E86;&#x4E09;&#x4E2A;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#xFF0C;&#x5206;&#x522B;&#x4E3A;</p>\n<ol>\n<li>Type[] getActualTypeArguments() &#x8FD4;&#x56DE;&#x771F;&#x6B63;&#x6240;&#x9700;&#x7684;Type&#x7C7B;&#x578B;&#x6570;&#x7EC4;</li>\n<li>Type getRawType() &#x8FD4;&#x56DE;&#x539F;&#x59CB;&#x7684;Type&#x7C7B;&#x578B;</li>\n<li>Type getOwnerType() &#x8FD4;&#x56DE;&#x6B64;&#x7C7B;&#x7684;&#x6210;&#x5458;&#x7C7B;&#x578B;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;<code>O&lt;T&gt;.I&lt;S&gt;</code>&#x3002;&#x5982;&#x679C;&#x4E3A;&#x9876;&#x5C42;&#x7C7B;&#x578B;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;null&#x3002;</li>\n</ol>\n<p>&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x4E4B;&#x524D;&#x7684;&#x95EE;&#x9898;&#xFF0C;Gson&#x6253;&#x7B97;&#x5148;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;GirlParameterizedType&#x7C7B;&#xFF0C;&#x8BA9;&#x5B83;&#x5B9E;&#x73B0;ParameterizedType&#x63A5;&#x53E3;&#x3002;code&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private static class GirlParameterizedType implements ParameterizedType {</span><br><span class=\"line\"> </span><br><span class=\"line\">    private Class aClass;</span><br><span class=\"line\"> </span><br><span class=\"line\">    GirlParameterizedType(Class aClass) {</span><br><span class=\"line\">        this.aClass = aClass;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @NonNull</span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public Type[] getActualTypeArguments() {</span><br><span class=\"line\">        return new Type[]{aClass};</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @NonNull</span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public Type getRawType() {</span><br><span class=\"line\">        return List.class;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public Type getOwnerType() {</span><br><span class=\"line\">        return null;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x65E2;&#x7136;&#x627E;&#x5230;&#x95EE;&#x9898;&#x6240;&#x5728;&#xFF0C;Gson&#x8FEB;&#x4E0D;&#x53CA;&#x5F85;&#x7684;&#x9080;&#x8BF7;List&#x53BB;&#x901B;Android Studio&#x5546;&#x57CE;&#xFF0C;&#x5E0C;&#x671B;&#x660E;&#x5929;&#x80FD;&#x591F;&#x987A;&#x5229;&#x62FF;&#x4E0B;List&#x5973;&#x795E;&#x3002;</p>\n<h2 id=\"&#x518D;&#x6B21;&#x76F8;&#x89C1;\"><a href=\"#&#x518D;&#x6B21;&#x76F8;&#x89C1;\" class=\"headerlink\" title=\"&#x518D;&#x6B21;&#x76F8;&#x89C1;\"></a>&#x518D;&#x6B21;&#x76F8;&#x89C1;</h2><p>&#x5728;Android Studio&#x5546;&#x57CE;&#xFF0C;Gson&#x518D;&#x4E00;&#x6B21;&#x770B;&#x5230;&#x4E86;List&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x5979;&#x4ECA;&#x5929;&#x5DF2;&#x7ECF;&#x6362;&#x4E86;&#x4E00;&#x8EAB;&#x88C5;&#x626E;&#x3002;&#x53EA;&#x89C1;&#x5979;&#x8EAB;&#x7A7F;&#x7C89;&#x7EA2;&#x73AB;&#x7470;&#x9999;&#x7D27;&#x8EAB;&#x888D;&#x888D;&#x8896;&#x4E0A;&#x8863;&#xFF0C;&#x4E0B;&#x7F69;&#x7FE0;&#x7EFF;&#x70DF;&#x7EB1;&#x6563;&#x82B1;&#x88D9;&#xFF0C;&#x8170;&#x95F4;&#x7528;&#x91D1;&#x4E1D;&#x8F6F;&#x70DF;&#x7F57;&#x7CFB;&#x6210;&#x4E00;&#x4E2A;&#x5927;&#x5927;&#x7684;&#x8774;&#x8776;&#x7ED3;&#xFF0C;&#x9B13;&#x53D1;&#x4F4E;&#x5782;&#x659C;&#x63D2;&#x78A7;&#x7389;&#x74D2;&#x51E4;&#x9497;&#xFF0C;&#x663E;&#x7684;&#x4F53;&#x6001;&#x4FEE;&#x957F;&#x5996;&#x5996;&#x8273;&#x8273;&#x52FE;&#x4EBA;&#x9B42;&#x9B44;&#x3002;&#x4E0D;&#x8FC7;Gson&#x5DF2;&#x65E9;&#x6709;&#x51C6;&#x5907;&#xFF0C;&#x76F4;&#x63A5;&#x6B65;&#x5165;&#x4E3B;&#x9898;&#xFF0C;&#x62FF;&#x51FA;&#x6628;&#x5929;&#x51C6;&#x5907;&#x597D;&#x7684;GirlParameterizedType&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public &lt;T&gt; List&lt;T&gt; getListGirl(String jsonStr, Class&lt;T&gt; tClass) {</span><br><span class=\"line\">      Type type =  getGson().fromJson(response, new HttpClientParameterizedType(tClass));</span><br><span class=\"line\">      List&lt;T&gt; listGirl = new Gson().fromJson(jsonStr, type);</span><br><span class=\"line\">      return listGirl;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x53D1;&#x73B0;&#x662F;&#x5982;&#x6B64;&#x7684;&#x7B80;&#x5355;&#xFF0C;&#x4E00;&#x51FB;&#x5FC5;&#x4E2D;&#xFF0C;&#x76F4;&#x51FB;List&#x82B3;&#x5FC3;&#x3002;&#x4E8E;&#x662F;&#x4E00;&#x5C0F;&#x65F6;&#x4E4B;&#x540E;&#xFF0C;Gson&#x53CC;&#x624B;&#x5DF2;&#x7ECF;&#x6302;&#x6EE1;&#x4E86;&#x5546;&#x54C1;&#xFF0C;&#x989D;&#x5934;&#x4E5F;&#x6EE1;&#x5934;&#x5927;&#x6C57;&#xFF0C;&#x4F46;List&#x8FD8;&#x6709;&#x610F;&#x672A;&#x5C3D;&#x7684;&#x6837;&#x5B50;&#xFF0C;Gson&#x4E07;&#x4E07;&#x6CA1;&#x60F3;&#x5230;&#x6700;&#x540E;&#x5C45;&#x7136;&#x8D25;&#x5728;&#x8D2D;&#x7269;&#x4E0A;&#xFF0C;&#x679C;&#x7136;&#x5E26;&#x5973;&#x5B69;&#x6765;&#x5546;&#x57CE;&#x5C31;&#x662F;&#x4E2A;&#x9519;&#x8BEF;&#x7684;&#x9009;&#x62E9;&#x2026;</p>\n<p>&#x8FD9;&#x6B21;&#x7684;&#x76F8;&#x4EB2;&#x4E5F;&#x7B97;&#x5B8C;&#x7F8E;&#x7ED3;&#x675F;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;Gson&#x5FC3;&#x4E2D;&#x53C8;&#x6709;&#x4E86;&#x5FC3;&#x7684;&#x7591;&#x8651;&#xFF0C;&#x5BF9;&#x4E8E;Object&#x4E0E;List&#x90FD;&#x662F;&#x767E;&#x5E74;&#x96BE;&#x9047;&#x7684;&#x5973;&#x5B69;&#xFF0C;&#x8BE5;&#x5982;&#x4F55;&#x6289;&#x62E9;&#x5462;&#xFF1F;&#x8981;&#x4E0D;&#x5404;&#x4F4D;&#x770B;&#x5B98;&#x8FD9;&#x4E2A;&#x6289;&#x62E9;&#x5C31;&#x4EA4;&#x7ED9;&#x4F60;&#x4EEC;&#xFF0C;&#x76F8;&#x4FE1;&#x4F60;&#x4EEC;&#x4F1A;&#x505A;&#x51FA;&#x6B63;&#x786E;&#x7684;&#x6289;&#x62E9;&#x7684;&#xFF0C;&#x6BD5;&#x7ADF;&#x5927;&#x5BB6;&#x90FD;&#x4E0D;&#x60F3;&#x5728;code&#x7684;&#x4EBA;&#x751F;&#x4E2D;&#x7559;&#x4E0B;&#x4E00;&#x4E1D;bug&#x7684;&#x8EAB;&#x5F71;&#x3002;</p>\n<p>&#x6700;&#x540E;&#xFF0C;&#x4E0D;&#x77E5;&#x5927;&#x5BB6;&#x770B;&#x7684;&#x611F;&#x53D7;&#x5982;&#x4F55;&#xFF0C;&#x6709;&#x4EC0;&#x4E48;&#x611F;&#x53D7;&#x4E5F;&#x53EF;&#x4EE5;&#x53CD;&#x9988;&#x7ED9;&#x6211;&#x3002;&#x5982;&#x679C;&#x559C;&#x6B22;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x6211;&#x7684;&#x516C;&#x4F17;&#x53F7;&#xFF1A;Android&#x8865;&#x7ED9;&#x7AD9;&#xFF0C;&#x4EE5;&#x4FBF;&#x53CA;&#x65F6;&#x63A8;&#x9001;&#x6700;&#x65B0;&#x6587;&#x7AE0;&#x7ED9;&#x4F60;&#x54DF;~</p>\n<p><img src=\"/2019/05/08/Gson&#x4E0E;List-T-&#x5BF9;&#x8C61;&#x95F4;&#x7684;&#x76F8;&#x4EB2;&#x4E4B;&#x65C5;/Android&#x8865;&#x7ED9;&#x7AD9;.jpg\" alt></p>\n","categories":["android"],"tags":["gson"]},{"title":"Android Gradle系列-入门篇","url":"https://www.rousetime.com/2019/05/05/Android-Gradle系列-入门篇/","content":"<p>&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x4F1A;&#x5BF9;Android Gradle&#x7684;&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x8FDB;&#x884C;&#x68B3;&#x7406;&#xFF0C;&#x6240;&#x4EE5;&#x501F;&#x6B64;&#x6574;&#x7406;&#x6210;&#x4E00;&#x4E2A;&#x7CFB;&#x5217;&#x3002;&#x5982;&#x679C;&#x4F60;&#x662F;&#x521A;&#x5165;&#x884C;&#x7684;&#x65B0;&#x79C0;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x7CFB;&#x5217;&#x5C06;&#x4F1A;&#x975E;&#x5E38;&#x9002;&#x5408;&#x4F60;&#xFF0C;&#x56E0;&#x4E3A;Android&#x57FA;&#x672C;&#x7684;&#x914D;&#x7F6E;&#x90FD;&#x4E0E;Gradle&#x6709;&#x5173;&#x3002;&#x5F53;&#x7136;&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x5165;&#x884C;&#xFF0C;&#x4F46;&#x5BF9;Gradle&#x8FD8;&#x662F;&#x505C;&#x7559;&#x5728;&#x8868;&#x9762;&#x7684;&#x8BA4;&#x77E5;&#x4E0A;&#xFF0C;&#x8FD9;&#x4E2A;&#x7CFB;&#x5217;&#x4E5F;&#x4F1A;&#x5BF9;&#x4F60;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#x3002;</p>\n<p>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5B9A;&#x4E49;&#x4E3A;&#x5165;&#x95E8;&#x7BC7;&#xFF0C;&#x5C06;&#x7ED3;&#x5408;&#x81EA;&#x5DF1;&#x521A;&#x5F00;&#x59CB;&#x5B66;&#x4E60;Android&#x65F6;&#x7684;&#x7591;&#x60D1;&#x4E0E;&#x73B0;&#x5728;&#x5BF9;Gradle&#x7684;&#x8BA4;&#x8BC6;&#xFF0C;&#x8FDB;&#x4E00;&#x6B65;&#x6574;&#x7406;Gradle&#x5728;Android&#x4E2D;&#x7684;&#x6574;&#x4F53;&#x7ED3;&#x6784;&#x3002;</p>\n<h2 id=\"&#x601D;&#x8003;\"><a href=\"#&#x601D;&#x8003;\" class=\"headerlink\" title=\"&#x601D;&#x8003;\"></a>&#x601D;&#x8003;</h2><p>&#x5F53;&#x6211;&#x4F7F;&#x7528;Android Studio&#x65F6;&#xFF0C;&#x4E00;&#x76F4;&#x6709;&#x51E0;&#x4E2A;&#x7591;&#x95EE;&#x56F4;&#x7ED5;&#x7740;&#x6211;&#xFF1A;</p>\n<ol>\n<li>Android Studio&#x662F;&#x600E;&#x6837;&#x5C06;Java&#x4E0E;Kotlin&#x4EE3;&#x7801;&#x7684;&#x7F16;&#x8BD1;&#x6210;APK&#x6587;&#x4EF6;&#xFF1F;</li>\n<li>Gradle&#x662F;&#x600E;&#x6837;&#x5C06;Java&#x4E0E;Kotlin&#x4EE3;&#x7801;&#x7F16;&#x8BD1;&#x6210;APK&#x6587;&#x4EF6;&#xFF1F;</li>\n</ol>\n<p>&#x540E;&#x6765;&#x77E5;&#x9053;Android Studio&#x81EA;&#x8EAB;&#x662F;&#x4E0D;&#x80FD;&#x591F;&#x7F16;&#x8BD1;&#x6210;APK&#x7684;&#xFF0C;&#x5B83;&#x662F;&#x96C6;&#x6210;&#x4E86;Gradle&#x3002;&#x901A;&#x8FC7;&#x7814;&#x7A76;Gradle&#xFF0C;&#x53D1;&#x73B0;Gradle&#x4E5F;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x6784;&#x5EFA;&#x5DE5;&#x5177;&#xFF0C;&#x771F;&#x6B63;&#x7F16;&#x8BD1;&#x6210;APK&#x7684;&#x529F;&#x80FD;&#x662F;&#x7531;Android app plugins&#x63D0;&#x4F9B;&#x7684;&#x3002;Gradle&#x53EA;&#x662F;&#x81EA;&#x52A8;&#x5316;&#x6784;&#x5EFA;&#x5DE5;&#x5177;&#xFF0C;&#x63D0;&#x4F9B;&#x6784;&#x5EFA;&#x65F6;&#x7684;&#x5404;&#x79CD;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;building&#x3001;testing&#x3001;publishing&#x7B49;&#x3002;&#x6240;&#x4EE5;Gradle&#x4E0D;&#x4EC5;&#x652F;&#x6301;Android&#x8FD8;&#x652F;&#x6301;C/C++&#x3001;Scale&#x7B49;&#x3002;</p>\n<p>&#x800C;&#x8FD9;&#x4E2A;plugin&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5728;project&#x4E2D;&#x7684;build.gradle&#x4E2D;&#x58F0;&#x660E;&#x7684;classpath</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buildscript {</span><br><span class=\"line\">    repositories {</span><br><span class=\"line\">        // Gradle 4.1 and higher include support for Google&apos;s Maven repo using</span><br><span class=\"line\">        // the google() method. And you need to include this repo to download</span><br><span class=\"line\">        // Android Gradle plugin 3.0.0 or higher.</span><br><span class=\"line\">        google()</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    }</span><br><span class=\"line\">    dependencies {</span><br><span class=\"line\">        classpath &apos;com.android.tools.build:gradle:3.4.0&apos;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x6709;&#x6BCF;&#x6B21;&#x5BF9;Android&#x6784;&#x5EFA;&#x8FDB;&#x884C;&#x4E86;&#x4F18;&#x5316;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x8981;&#x6765;&#x66F4;&#x65B0;&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x3002;</p>\n<h2 id=\"Scripts\"><a href=\"#Scripts\" class=\"headerlink\" title=\"Scripts\"></a>Scripts</h2><p>&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;Android&#x9879;&#x76EE;&#x65F6;&#xFF0C;&#x4F60;&#x5C06;&#x4F1A;&#x770B;&#x5230;&#x5982;&#x4E0B;&#x4E0E;Gradle&#x76F8;&#x5173;&#x7684;&#x6587;&#x4EF6;&#xFF1A;</p>\n<p><img src=\"/2019/05/05/Android-Gradle&#x7CFB;&#x5217;-&#x5165;&#x95E8;&#x7BC7;/Android-Gradle&#x7CFB;&#x5217;-&#x5165;&#x95E8;&#x7BC7;1.jpg\" alt></p>\n<p>&#x4F60;&#x4F1A;&#x770B;&#x5230;&#x6587;&#x4EF6;&#x540D;&#x51E0;&#x4E4E;&#x90FD;&#x6709;gradle&#x5B57;&#x6BB5;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4F1A;&#x4E00;&#x4E00;&#x4ECB;&#x7ECD;&#x5B83;&#x4EEC;&#x7684;&#x4F5C;&#x7528;</p>\n<h3 id=\"Gradle-Wrapper\"><a href=\"#Gradle-Wrapper\" class=\"headerlink\" title=\"Gradle Wrapper\"></a>Gradle Wrapper</h3><p>&#x9996;&#x5148;&#x662F;gradle-wrapper.properties&#x6587;&#x4EF6;&#xFF0C;&#x6253;&#x5F00;&#x5B83;&#x4F60;&#x5C06;&#x4F1A;&#x770B;&#x5230;&#x5982;&#x4E0B;&#x7C7B;&#x4F3C;&#x4FE1;&#x606F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#Sat Jan 19 08:25:46 CST 2019</span><br><span class=\"line\">distributionBase=GRADLE_USER_HOME</span><br><span class=\"line\">distributionPath=wrapper/dists</span><br><span class=\"line\">zipStoreBase=GRADLE_USER_HOME</span><br><span class=\"line\">zipStorePath=wrapper/dists</span><br><span class=\"line\">distributionUrl=https\\://services.gradle.org/distributions/gradle-4.6-all.zip</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;&#x662F;gradle&#x7248;&#x672C;&#x7684;&#x914D;&#x7F6E;&#x9879;&#xFF0C;&#x7533;&#x660E;&#x4F60;&#x5F53;&#x524D;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x7684;gradle&#x7248;&#x672C;&#x3002;&#x5F53;&#x6211;&#x4EEC;&#x6784;&#x5EFA;&#x9879;&#x76EE;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B83;&#x4F1A;&#x6839;&#x636E;&#x7248;&#x672C;&#x81EA;&#x52A8;&#x4E0B;&#x8F7D;&#x3002;&#x5E76;&#x4E14;&#x4FDD;&#x5B58;&#x5230;&#x4F60;&#x7684;&#x7535;&#x8111;&#x672C;&#x5730;&#x4E2D;&#x3002;&#x5982;&#x679C;&#x4F60;&#x4F7F;&#x7528;&#x7684;&#x662F;Mac&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x4F60;&#x7684;&#x6240;&#x6709;&#x5DF2;&#x7ECF;&#x4E0B;&#x8F7D;&#x7684;gradle&#x7248;&#x672C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls ~/.gradle/wrapper/dists/</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x6EE1;&#x610F;&#x5F53;&#x524D;&#x7248;&#x672C;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x67E5;&#x770B;<a href=\"https://gradle.org/releases/\" target=\"_blank\" rel=\"noopener\">version of Gradle</a>&#x4FEE;&#x6539;&#x5230;&#x76F8;&#x5E94;&#x7684;&#x7248;&#x672C;</p>\n<h3 id=\"settings-gradle\"><a href=\"#settings-gradle\" class=\"headerlink\" title=\"settings.gradle\"></a>settings.gradle</h3><p>&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x662F;&#x9879;&#x76EE;&#x4E0E;&#x5176;&#x5B50;&#x9879;&#x76EE;&#x6216;&#x8005;module&#x95F4;&#x7684;&#x914D;&#x7F6E;&#x3002;&#x91CC;&#x9762;&#x901A;&#x8FC7;include&#x51FD;&#x6570;&#x6765;&#x544A;&#x8BC9;&#x8BE5;&#x9879;&#x76EE;&#x6240;&#x5305;&#x6362;&#x7684;&#x5B50;&#x9879;&#x76EE;&#x6216;&#x8005;&#x4F9D;&#x8D56;&#x7684;module&#x3002;&#x4F8B;&#x5982;&#x521A;&#x65B0;&#x5EFA;&#x9879;&#x76EE;&#x65F6;&#x53EA;&#x6709;&#x4E00;&#x4E2A;app&#x5B50;&#x9879;&#x76EE;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">include &apos;:app&apos;</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;settings.gradle&#x662F;&#x4F4D;&#x4E8E;project&#x7684;&#x6700;&#x5916;&#x5C42;&#xFF0C;&#x5373;&#x4E0E;app&#x540C;&#x7EA7;&#x3002;</p>\n<h3 id=\"build-gradle\"><a href=\"#build-gradle\" class=\"headerlink\" title=\"build.gradle\"></a>build.gradle</h3><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x4E00;&#x4E2A;project&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A;sub-projects&#xFF0C;&#x800C;Android&#x4E00;&#x822C;&#x4F1A;&#x5C06;sub-projects&#x5F53;&#x505A;module&#xFF0C;&#x6240;&#x4EE5;&#x4F60;&#x4F1A;&#x5728;&#x8FD9;&#x770B;&#x5230;&#x4E24;&#x4E2A;build.gradle&#x3002;&#x6839;&#x636E;&#x540E;&#x9762;&#x7684;hint&#x63D0;&#x793A;&#xFF0C;&#x53D1;&#x73B0;&#x5B83;&#x4EEC;&#x5206;&#x522B;&#x6765;&#x81EA;&#x4E0E;project&#x4E0E;module&#x3002;</p>\n<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x6765;&#x770B;project&#x4E2D;&#x7684;build.gradle&#xFF0C;&#x5373;&#x4F4D;&#x4E8E;&#x6839;&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x6587;&#x4EF6;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buildscript { //1</span><br><span class=\"line\"> </span><br><span class=\"line\">    ext.objectboxVersion = &apos;2.3.0&apos; //4</span><br><span class=\"line\">      </span><br><span class=\"line\">    repositories { //2</span><br><span class=\"line\">        google()</span><br><span class=\"line\">        jcenter()</span><br><span class=\"line\">    }</span><br><span class=\"line\">    dependencies { //3</span><br><span class=\"line\">        classpath &apos;com.android.tools.build:gradle:3.3.2&apos;</span><br><span class=\"line\">        classpath &quot;io.objectbox:objectbox-gradle-plugin:$objectboxVersion&quot;        </span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">allprojects { //5</span><br><span class=\"line\">    repositories {</span><br><span class=\"line\">        google()</span><br><span class=\"line\">        jcenter()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">task clean(type: Delete) { //6</span><br><span class=\"line\">    delete rootProject.buildDir</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<ol>\n<li>buildscript&#x95ED;&#x5305;&#x662F;&#x7533;&#x660E;&#x7F16;&#x8BD1;&#x8BE5;&#x9879;&#x76EE;&#x6240;&#x9700;&#x7684;&#x76F8;&#x5173;&#x914D;&#x7F6E;</li>\n<li>&#x544A;&#x77E5;gradle&#x8FD9;&#x4E9B;&#x914D;&#x7F6E;&#x5C06;&#x4ECE;google()&#x4E0E;jcenter()&#x4E2D;&#x83B7;&#x53D6;</li>\n<li>&#x7533;&#x660E;&#x76F8;&#x5173;&#x7684;plugin&#xFF0C;&#x4F8B;&#x5982;Android Plugin for Gradle&#x3002;</li>\n<li>&#x5728;gradle&#x4E2D;&#x6709;&#x4E00;&#x4E2A;<a href=\"https://docs.gradle.org/current/javadoc/org/gradle/api/Project.html#extraproperties\" target=\"_blank\" rel=\"noopener\">extra property</a>&#x5C5E;&#x6027;&#xFF0C;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x5B83;&#x6765;&#x7533;&#x660E;&#x4E00;&#x4E9B;&#x53D8;&#x91CF;&#xFF0C;&#x4F8B;&#x5982;plugin&#x7684;&#x7248;&#x672C;&#x53F7;&#x3002;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x6027;&#x5C31;&#x662F;&#x8FD9;&#x4E9B;&#x53D8;&#x91CF;&#x5728;gradle&#x4E2D;&#x90FD;&#x662F;&#x5168;&#x5C40;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x5BF9;&#x4E8E;&#x591A;&#x4E2A;module&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B83;&#x6765;&#x7EDF;&#x4E00;&#x76F8;&#x5173;&#x7684;&#x7248;&#x672C;&#x53F7;&#x3002;&#x6700;&#x540E;&#x5728;3&#x4E2D;&#x901A;&#x8FC7;${name}&#x6765;&#x5F15;&#x7528;</li>\n<li>&#x56E0;&#x4E3A;&#x53EF;&#x80FD;&#x6709;&#x591A;&#x4E2A;sub-project&#xFF0C;&#x5BF9;&#x4E8E;&#x4E00;&#x4E9B;&#x76F8;&#x540C;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;allprojects&#x6765;&#x8FDB;&#x884C;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;&#x3002;</li>\n<li>&#x7533;&#x660E;&#x4E00;&#x4E2A;task&#xFF0C;&#x7528;&#x6765;&#x6267;&#x884C;&#x76F8;&#x5173;&#x4EFB;&#x52A1;&#xFF0C;&#x8FD9;&#x91CC;&#x662F;clean&#x64CD;&#x4F5C;&#xFF0C;&#x76EE;&#x7684;&#x662F;&#x5220;&#x9664;build&#x6587;&#x4EF6;&#x5939;&#x4E2D;&#x7684;&#x6570;&#x636E;</li>\n</ol>\n<p>&#x4E0B;&#x9762;&#x662F;module&#x4E2D;&#x7684;build.gradle</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply plugin: &apos;com.android.application&apos;</span><br><span class=\"line\">apply plugin: &apos;io.objectbox&apos; //1</span><br><span class=\"line\"> </span><br><span class=\"line\">android { //2</span><br><span class=\"line\">    compileSdkVersion 28</span><br><span class=\"line\">    defaultConfig {</span><br><span class=\"line\">        minSdkVersion 21</span><br><span class=\"line\">        targetSdkVersion 27</span><br><span class=\"line\">        versionCode 100005</span><br><span class=\"line\">        versionName &quot;1.0.5&quot;</span><br><span class=\"line\">        testInstrumentationRunner &quot;android.support.test.runner.AndroidJUnitRunner&quot;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    buildTypes {</span><br><span class=\"line\">       release {</span><br><span class=\"line\">            minifyEnabled false</span><br><span class=\"line\">            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">dependencies { //3</span><br><span class=\"line\">    implementation fileTree(include: [&apos;*.jar&apos;], dir: &apos;libs&apos;)</span><br><span class=\"line\">    implementation &apos;com.android.support:appcompat-v7:28.0.0&apos;</span><br><span class=\"line\">    implementation &apos;com.android.support:support-v4:28.0.0&apos;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<ol>\n<li>&#x901A;&#x8FC7;&#x8C03;&#x7528;apply&#x51FD;&#x6570;&#xFF0C;&#x5F15;&#x5165;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F9D;&#x8D56;&#x7684;plugin&#xFF0C;&#x8FD9;&#x4E2A;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x5728;&#x6839;build.gradle&#x4E2D;&#x7533;&#x660E;&#x7684;classpath</li>\n<li>android&#x95ED;&#x5305;&#x662F;gradle&#x6700;&#x91CD;&#x8981;&#x7684;&#x914D;&#x7F6E;&#x7533;&#x660E;&#xFF0C;&#x4F8B;&#x5982;&#x9ED8;&#x8BA4;&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;defaultConfig&#xFF0C;&#x5305;&#x542B;minSdkVersion&#x6700;&#x5C0F;&#x652F;&#x6301;&#x7684;android&#x7248;&#x672C;&#xFF0C;versionCode&#x4E0E;versionName&#x7B49;&#x3002;&#x8FD9;&#x4E9B;&#x914D;&#x7F6E;&#x90FD;&#x4E0E;&#x7F16;&#x8BD1;&#x606F;&#x606F;&#x76F8;&#x5173;&#xFF0C;&#x6700;&#x597D;&#x4F60;&#x5E94;&#x8BE5;&#x719F;&#x6089;&#x5B83;&#x4EEC;&#x3002;&#x4F60;&#x5B9E;&#x5728;&#x8BB0;&#x4E0D;&#x4F4F;&#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x4E5F;&#x6709;&#x79D8;&#x7C4D;&#xFF0C;<a href=\"https://google.github.io/android-gradle-dsl/current/com.android.build.gradle.AppExtension.html\" target=\"_blank\" rel=\"noopener\">AppExtension</a>&#x8FD9;&#x91CC;&#x9762;&#x5305;&#x542B;&#x6240;&#x6709;&#x7684;&#x914D;&#x7F6E;&#x9879;&#x4E0E;&#x6240;&#x4EE3;&#x8868;&#x7684;&#x610F;&#x4E49;&#x3002;</li>\n<li>&#x8FD9;&#x91CC;&#x7684;dependencies&#x7528;&#x6765;&#x7533;&#x660E;&#x9879;&#x76EE;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x5E93;&#x7684;&#x83B7;&#x53D6;&#x6765;&#x6E90;&#x65E0;&#x9700;&#x518D;&#x6B21;&#x7533;&#x660E;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x6839;&#x76EE;&#x5F55;&#x7684;build.gradle&#x4E2D;&#x7684;allprojects&#x95ED;&#x5305;&#x4E2D;&#x8FDB;&#x884C;&#x4E86;&#x7533;&#x660E;&#x3002;&#x518D;&#x8005;&#x4E4B;&#x524D;&#x7684;ext&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x3002;</li>\n</ol>\n<h3 id=\"gradle-properties\"><a href=\"#gradle-properties\" class=\"headerlink\" title=\"gradle.properties\"></a>gradle.properties</h3><p>&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4E00;&#x822C;&#x90FD;&#x662F;&#x672C;&#x5730;&#x6587;&#x4EF6;&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x6765;&#x5BF9;gradle&#x6784;&#x5EFA;&#x7684;&#x4E00;&#x4E9B;&#x4E2A;&#x4EBA;&#x914D;&#x7F6E;&#x9879;&#x3002;&#x4F8B;&#x5982;gradle&#x8FD0;&#x884C;&#x662F;&#x5426;&#x5E76;&#x884C;&#xFF0C;gradle&#x7684;jvmargs&#x5927;&#x5C0F;&#x3001;&#x662F;&#x5426;&#x5F00;&#x542F;daemon&#x7B49;&#x7B49;&#x3002;&#x5B83;&#x4F1A;&#x5728;gradle&#x8FD0;&#x884C;&#x65F6;&#x6CE8;&#x5165;&#x5230;&#x76F8;&#x5E94;&#x7684;build.gradle&#x4E2D;&#x3002;</p>\n<h3 id=\"local-properties\"><a href=\"#local-properties\" class=\"headerlink\" title=\"local.properties\"></a>local.properties</h3><p>&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4E5F;&#x662F;&#x672C;&#x5730;&#x6587;&#x4EF6;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x5B83;&#x7528;&#x6765;&#x914D;&#x7F6E;gradle&#x4E4B;&#x5916;&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x4F8B;&#x5982;ndk&#x4E0E;sdk&#x76EE;&#x5F55;&#xFF0C;&#x6216;&#x8005;&#x4E00;&#x4E9B;&#x654F;&#x611F;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x4F8B;&#x5982;&#x63D2;&#x4EF6;&#x5F00;&#x53D1;&#x6253;&#x5305;&#x4E0A;&#x4F20;&#x5230;&#x8FDC;&#x7A0B;&#x4ED3;&#x5E93;&#x8FD9;&#x65F6;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x8D26;&#x53F7;&#x3001;&#x5BC6;&#x7801;&#x3001;api_key&#x7B49;&#xFF0C;&#x9632;&#x6B62;&#x6253;&#x5305;&#x65F6;&#x66B4;&#x9732;&#x3002;</p>\n<h2 id=\"Gradle-Tasks\"><a href=\"#Gradle-Tasks\" class=\"headerlink\" title=\"Gradle Tasks\"></a>Gradle Tasks</h2><p>gradle tasks&#x662F;&#x7528;&#x6765;&#x6267;&#x884C;&#x7279;&#x5B9A;&#x7684;gradle&#x4EFB;&#x52A1;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x70B9;&#x51FB;Android Studio&#x53F3;&#x8FB9;&#x7684;Gradle&#x6309;&#x94AE;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x5728;Tasks&#x4E0B;&#x4F1A;&#x5217;&#x51FA;&#x8BE5;&#x9879;&#x76EE;&#x7684;&#x6240;&#x7528;&#x53EF;&#x6267;&#x884C;&#x7684;gradle&#x4EFB;&#x52A1;&#x3002;</p>\n<p><img src=\"/2019/05/05/Android-Gradle&#x7CFB;&#x5217;-&#x5165;&#x95E8;&#x7BC7;/Android-Gradle&#x7CFB;&#x5217;-&#x5165;&#x95E8;&#x7BC7;2.jpg\" alt></p>\n<p>&#x6216;&#x8005;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x4E2D;&#x6267;&#x884C;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#xFF0C;&#x67E5;&#x770B;app&#x4E0B;&#x7684;&#x6240;&#x6709;tasks</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew app:tasks</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2019/05/05/Android-Gradle&#x7CFB;&#x5217;-&#x5165;&#x95E8;&#x7BC7;/Android-Gradle&#x7CFB;&#x5217;-&#x5165;&#x95E8;&#x7BC7;3.jpg\" alt></p>\n<p>&#x6211;&#x4EEC;&#x987A;&#x4FBF;&#x70B9;&#x51FB;&#x4E00;&#x4E2A;&#xFF0C;&#x4F8B;&#x5982;assembleDebug&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4F1A;&#x5728;Run&#x65E5;&#x5FD7;&#x7CFB;&#x7EDF;&#x4E2D;&#x770B;&#x5230;&#x5982;&#x4E0B;&#x6267;&#x884C;&#x7ED3;&#x679C;</p>\n<p><img src=\"/2019/05/05/Android-Gradle&#x7CFB;&#x5217;-&#x5165;&#x95E8;&#x7BC7;/Android-Gradle&#x7CFB;&#x5217;-&#x5165;&#x95E8;&#x7BC7;4.jpg\" alt></p>\n<p>&#x6839;&#x636E;&#x8F93;&#x51FA;&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x4E5F;&#x6807;&#x660E;&#x5B83;&#x662F;&#x6267;&#x884C;&#x4E86;task: assembleDebug</p>\n<p>&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x6267;&#x884C;&#x6307;&#x5B9A;&#x7684;task&#xFF0C;&#x4F8B;&#x5982;&#x8981;&#x8FBE;&#x5230;&#x4E0A;&#x9762;&#x76F8;&#x540C;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8F93;&#x5165;&#x5982;&#x4E0B;&#x547D;&#x4EE4;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew assembleDebug --console plain</span><br></pre></td></tr></table></figure>\n<ol>\n<li>./gradlew &#x4EE3;&#x8868;&#x7684;&#x662F;&#x4F7F;&#x7528;Gradle Wrapper&#x4E2D;&#x7684;gradle&#xFF0C;&#x5C31;&#x662F;&#x8BE5;&#x9879;&#x76EE;&#x672C;&#x8EAB;&#x7684;gradle&#x7248;&#x672C;&#xFF0C;&#x907F;&#x514D;&#x76F4;&#x63A5;&#x4F7F;&#x7528;gradle&#x547D;&#x4EE4;</li>\n<li>assembleDebug&#x662F;task&#x7684;&#x540D;&#x79F0;</li>\n<li>&#x2013;console plain&#x8F93;&#x51FA;&#x5B8C;&#x6574;&#x7684;&#x65E5;&#x5FD7;</li>\n</ol>\n<p>&#x65E2;&#x7136;&#x8BF4;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x518D;&#x8BF4;&#x4E00;&#x4E2A;&#x521D;&#x7EA7;&#x8005;&#x5BB9;&#x6613;&#x505A;&#x7684;&#x65E0;&#x610F;&#x4E49;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x6709;&#x65F6;&#x4F1A;&#x78B0;&#x5230;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#x800C;&#x53BB;&#x70B9;&#x51FB;Clean Project&#xFF0C;&#x518D;&#x70B9;&#x51FB;Rebuild Project&#x3002;&#x5176;&#x5B9E;Clean Project&#x662F;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5148;&#x70B9;&#x51FB;Rebuild Project&#xFF0C;&#x67E5;&#x770B;&#x65E5;&#x5FD7;</p>\n<p><img src=\"/2019/05/05/Android-Gradle&#x7CFB;&#x5217;-&#x5165;&#x95E8;&#x7BC7;/Android-Gradle&#x7CFB;&#x5217;-&#x5165;&#x95E8;&#x7BC7;5.jpg\" alt></p>\n<p>&#x7ED3;&#x679C;&#x662F;&#x5B83;&#x5206;&#x522B;&#x6267;&#x884C;&#x4E86;task: clean&#xFF0C;assembleDebug&#x3002;&#x6240;&#x4EE5;Rebuild Project&#x5C31;&#x5DF2;&#x7ECF;&#x5305;&#x542B;&#x4E86;Clean Project&#xFF0C;&#x6211;&#x4EEC;&#x65E0;&#x9700;&#x591A;&#x6B64;&#x4E00;&#x4E3E;&#x6267;&#x884C;Clean Project&#x3002;</p>\n<p>&#x55EF;&#xFF0C;&#x5C31;&#x8FD9;&#x4E9B;&#x3002;&#x6700;&#x540E;&#xFF0C;&#x5E0C;&#x671B;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x80FD;&#x591F;&#x8BA9;&#x5927;&#x5BB6;&#x5BF9;gradle&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x7ED3;&#x6784;&#x4E0E;&#x6240;&#x5904;&#x7684;&#x5730;&#x4F4D;&#x6709;&#x4E00;&#x4E2A;&#x66F4;&#x6E05;&#x6670;&#x7684;&#x7406;&#x89E3;&#x3002;</p>\n","categories":[],"tags":["gradle"]},{"title":"Vue:scoped与module的使用与利弊","url":"https://www.rousetime.com/2019/01/11/Vue-scoped与module的使用与利弊/","content":"<p>&#x4E00;&#x4E2A;web&#x5E94;&#x7528;&#x662F;&#x79BB;&#x4E0D;&#x5F00;html&#x3001;css&#x4E0E;js&#xFF0C;&#x5176;&#x4E2D;css&#x5145;&#x65A5;&#x7684;&#x6574;&#x4E2A;web&#x9879;&#x76EE;&#x4E2D;&#x3002;css&#x5B83;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#xFF0C;&#x5B83;&#x662F;&#x5168;&#x5C40;&#x7684;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x7279;&#x6027;&#x5BFC;&#x81F4;&#x7684;&#x7ED3;&#x679C;&#x662F;&#xFF0C;&#x4E00;&#x65E6;&#x4F60;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x5730;&#x65B9;&#x5B9A;&#x4E49;&#x4E86;&#x76F8;&#x540C;&#x7684;css&#x547D;&#x540D;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x4EEC;&#x7684;&#x6837;&#x5F0F;&#x5C31;&#x4F1A;&#x76F8;&#x4E92;&#x8986;&#x76D6;&#xFF0C;&#x6700;&#x7EC8;&#x5BFC;&#x81F4;&#x7684;style&#x9519;&#x4E71;&#xFF0C;&#x4ECE;&#x800C;&#x5F71;&#x54CD;&#x6574;&#x4E2A;&#x7F51;&#x9875;&#x5E03;&#x5C40;&#x3002;</p>\n<p>&#x6211;&#x76F8;&#x4FE1;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E00;&#x4E2A;&#x524D;&#x7AEF;&#x5F00;&#x53D1;&#x8005;&#x90FD;&#x9047;&#x5230;&#x8FC7;&#x8FD9;&#x79CD;css&#x6837;&#x5F0F;&#x8986;&#x76D6;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x503C;&#x5F97;&#x5E86;&#x5E78;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x524D;&#x8F88;&#x90FD;&#x5DF2;&#x7ECF;&#x7ED9;&#x51FA;&#x4E86;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;</p>\n<p>&#x5728;Vue&#x4E2D;&#x6211;&#x4EEC;&#x901A;&#x8FC7;Scoped&#x4E0E;Module&#x6765;&#x89E3;&#x51B3;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4F1A;&#x5206;&#x522B;&#x5BF9;scoped&#x4E0E;module&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x8FDB;&#x884C;&#x8BF4;&#x660E;&#xFF0C;&#x6700;&#x540E;&#x5728;&#x5206;&#x6790;&#x5B83;&#x4EEC;&#x7684;&#x5229;&#x5F0A;&#x4E0E;&#x9009;&#x62E9;&#x3002;&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x672A;&#x4F7F;&#x7528;&#x8FC7;&#x6216;&#x8005;&#x8BF4;&#x5BF9;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x5229;&#x5F0A;&#x4E0E;&#x9009;&#x62E9;&#x5B58;&#x5728;&#x7591;&#x95EE;&#x7684;&#xFF0C;&#x76F8;&#x4FE1;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x80FD;&#x591F;&#x5E2E;&#x4F60;&#x89E3;&#x60D1;&#x3002;</p>\n<h2 id=\"Scoped\"><a href=\"#Scoped\" class=\"headerlink\" title=\"Scoped\"></a>Scoped</h2><p>&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x6709;&#x5982;&#x4E0B;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#xFF1A;</p>\n<p>index.vue</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div class=&quot;content&quot;&gt;</span><br><span class=\"line\">    &lt;div class=&quot;title-wrap&quot;&gt;&#x6211;&#x662F;&#x7EA2;&#x8272;&#x7684;&lt;/div&gt;</span><br><span class=\"line\">    &lt;green-title&gt;&lt;/green-title&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class=\"line\">.content {</span><br><span class=\"line\">  .title-wrap {</span><br><span class=\"line\">    font-size: 20px;</span><br><span class=\"line\">    color: red;</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\">&lt;/style&gt;</span><br></pre></td></tr></table></figure>\n<p>GreenTitle.vue</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div class=&quot;content&quot;&gt;</span><br><span class=\"line\">    &lt;div class=&quot;title-wrap&quot;&gt;&#x6211;&#x662F;&#x7EFF;&#x8272;&#x7684;&lt;/div&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class=\"line\">.content {</span><br><span class=\"line\">  .title-wrap {</span><br><span class=\"line\">    font-size: 20px;</span><br><span class=\"line\">    color: green;</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\">&lt;/style&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2019/01/11/Vue-scoped&#x4E0E;module&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x5229;&#x5F0A;/1.jpg\" alt></p>\n<p>&#x6700;&#x7EC8;&#x8FD9;&#x5C4F;&#x5E55;&#x4E0A;&#x5C55;&#x793A;&#x7684;&#x662F;&#x4E24;&#x884C;&#x7EA2;&#x8272;&#x7684;&#x6587;&#x5B57;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x7236;&#x7EC4;&#x4EF6;&#x4E0E;&#x5B50;&#x7EC4;&#x4EF6;&#x90FD;&#x5B9A;&#x4E49;&#x4E86;title-wrap&#x7684;&#x6837;&#x5F0F;&#xFF0C;&#x5BFC;&#x81F4;&#x5B50;&#x7EC4;&#x4EF6;&#x7684;&#x6837;&#x5F0F;&#x88AB;&#x7236;&#x7EC4;&#x4EF6;&#x6240;&#x8986;&#x76D6;&#x3002;</p>\n<p>&#x9047;&#x5230;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;style&#x6807;&#x7B7E;&#x4E2D;&#x6DFB;&#x52A0;scoped&#x5C5E;&#x6027;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class=\"line\">.content {</span><br><span class=\"line\">  .title-wrap {</span><br><span class=\"line\">    font-size: 20px;</span><br><span class=\"line\">    color: red;</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\">&lt;/style&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2019/01/11/Vue-scoped&#x4E0E;module&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x5229;&#x5F0A;/2.jpg\" alt></p>\n<p>scoped&#x4F5C;&#x7528;&#x7684;&#x963B;&#x6B62;&#x4E0A;&#x5C42;&#x7684;css&#x6837;&#x5F0F;&#x4F20;&#x9012;&#x5230;&#x4E0B;&#x5C42;&#xFF0C;&#x9650;&#x5236;&#x5F53;&#x524D;css&#x4F5C;&#x7528;&#x57DF;&#xFF0C;&#x4F7F;&#x5176;&#x53EA;&#x5BF9;&#x5F53;&#x524D;&#x7EC4;&#x4EF6;&#x751F;&#x6548;&#x3002;</p>\n<p>&#x77E5;&#x9053;&#x4E86;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5728;&#x5F00;&#x6DF1;&#x5165;&#x770B;&#x4E0B;&#x5B83;&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>\n<p><img src=\"/2019/01/11/Vue-scoped&#x4E0E;module&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x5229;&#x5F0A;/3.jpg\" alt><br><img src=\"/2019/01/11/Vue-scoped&#x4E0E;module&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x5229;&#x5F0A;/4.jpg\" alt><br>&#x524D;&#x9762;&#x7684;&#x662F;&#x6CA1;&#x6709;&#x6DFB;&#x52A0;scoped&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x540E;&#x9762;&#x662F;&#x6DFB;&#x52A0;&#x4E86;scoped&#x7684;&#x6E90;&#x7801;&#x3002;&#x6211;&#x4EEC;&#x8FDB;&#x884C;&#x4E00;&#x4E00;&#x5BF9;&#x6BD4;&#xFF0C;&#x53D1;&#x73B0;&#x524D;&#x9762;&#x7684;&#x4E24;&#x4E2A;div&#x6807;&#x7B7E;&#x90FD;&#x4F7F;&#x7528;&#x4E86;title-wrap&#x6837;&#x5F0F;&#xFF0C;&#x81EA;&#x7136;&#x5BFC;&#x81F4;&#x6837;&#x5F0F;&#x8986;&#x76D6;&#xFF1B;&#x800C;&#x540E;&#x9762;&#x7684;&#x4E24;&#x4E2A;div&#x6807;&#x7B7E;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x589E;&#x52A0;&#x4E86;data-v-67e6b31f&#x7684;&#x524D;&#x7F00;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x7236;&#x7EC4;&#x7684;style&#x4E2D;&#x589E;&#x52A0;scoped&#x7684;&#x6548;&#x679C;&#xFF0C;&#x533A;&#x522B;&#x4E0E;&#x7B2C;&#x4E8C;&#x4E2A;div&#x4E2D;&#x7684;title-wrap&#x6837;&#x5F0F;&#x3002;</p>\n<p>scoped&#x7684;&#x5B9E;&#x73B0;&#x662F;&#x501F;&#x52A9;&#x4E86;PostCSS&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x4E00;&#x65E6;&#x589E;&#x52A0;&#x4E86;scoped&#xFF0C;&#x4ED6;&#x4F1A;&#x5C06;&#x4E4B;&#x524D;&#x8986;&#x76D6;&#x7684;&#x6837;&#x5F0F;&#x8F6C;&#x6362;&#x6210;&#x4E0B;&#x9762;&#x7684;&#x6837;&#x5F0F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class=\"line\">.content[data-v-67e6b31f] {</span><br><span class=\"line\">  .title-wrap[data-v-67e6b31f] {</span><br><span class=\"line\">    font-size: 20px;</span><br><span class=\"line\">    color: red;</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\">&lt;/style&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x8F6C;&#x6362;&#x65B9;&#x5F0F;&#xFF0C;&#x95F4;&#x63A5;&#x7684;&#x6539;&#x53D8;&#x4E86;&#x539F;&#x6709;&#x7684;css&#x547D;&#x540D;&#x3002;&#x9632;&#x6B62;&#x4E0A;&#x5C42;&#x7EC4;&#x4EF6;&#x6837;&#x5F0F;&#x8986;&#x76D6;&#x4E0B;&#x5C42;&#x7EC4;&#x4EF6;&#x6837;&#x5F0F;&#x3002;</p>\n<h3 id=\"&#x7279;&#x6027;\"><a href=\"#&#x7279;&#x6027;\" class=\"headerlink\" title=\"&#x7279;&#x6027;\"></a>&#x7279;&#x6027;</h3><p>&#x7EC6;&#x5FC3;&#x7684;&#x8BFB;&#x8005;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x73B0;&#x4E0A;&#x9762;&#x7684;&#x540E;&#x4E00;&#x5F20;&#x6E90;&#x7801;&#x56FE;&#x4E2D;&#x7B2C;&#x4E8C;&#x4E2A;div&#x7684;content&#x4E2D;&#x4E5F;&#x6709;data-v-67e6b31f&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x7591;&#x95EE;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;content&#x4E0D;&#x662F;&#x5B50;&#x7EC4;&#x4EF6;&#x4E2D;&#x7684;css&#x5417;&#xFF1F;&#x5B50;&#x7EC4;&#x4EF6;&#x4E2D;&#x672A;&#x6DFB;&#x52A0;scoped&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD8;&#x4F1A;&#x6DFB;&#x52A0;data-v-67e6b31f&#x524D;&#x7F00;&#xFF1F;</p>\n<p>&#x8FD9;&#x662F;scoped&#x7684;&#x4E00;&#x4E2A;&#x7279;&#x6027;&#xFF0C;&#x4F7F;&#x7528; scoped &#x540E;&#xFF0C;&#x7236;&#x7EC4;&#x4EF6;&#x7684;&#x6837;&#x5F0F;&#x5C06;&#x4E0D;&#x4F1A;&#x6E17;&#x900F;&#x5230;&#x5B50;&#x7EC4;&#x4EF6;&#x4E2D;&#x3002;&#x4E0D;&#x8FC7;&#x4E00;&#x4E2A;&#x5B50;&#x7EC4;&#x4EF6;&#x7684;&#x6839;&#x8282;&#x70B9;&#x4F1A;&#x540C;&#x65F6;&#x53D7;&#x5176;&#x7236;&#x7EC4;&#x4EF6;&#x6709;&#x4F5C;&#x7528;&#x57DF;&#x7684; CSS &#x548C;&#x5B50;&#x7EC4;&#x4EF6;&#x6709;&#x4F5C;&#x7528;&#x57DF;&#x7684; CSS &#x7684;&#x5F71;&#x54CD;&#x3002;&#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#x662F;&#x4E3A;&#x4E86;&#x8BA9;&#x7236;&#x7EC4;&#x4EF6;&#x53EF;&#x4EE5;&#x4ECE;&#x5E03;&#x5C40;&#x7684;&#x89D2;&#x5EA6;&#x51FA;&#x53D1;&#xFF0C;&#x8C03;&#x6574;&#x5176;&#x5B50;&#x7EC4;&#x4EF6;&#x6839;&#x5143;&#x7D20;&#x7684;&#x6837;&#x5F0F;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5C06;&#x5B50;&#x7EC4;&#x4EF6;&#x505A;&#x5982;&#x4E0B;&#x4FEE;&#x6539;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;!-- &lt;div class=&quot;content&quot;&gt; --&gt;</span><br><span class=\"line\">    &lt;div class=&quot;title-wrap&quot;&gt;&#x6211;&#x662F;&#x7EFF;&#x8272;&#x7684;&lt;/div&gt;</span><br><span class=\"line\">  &lt;!-- &lt;/div&gt; --&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2019/01/11/Vue-scoped&#x4E0E;module&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x5229;&#x5F0A;/1.jpg\" alt><br><img src=\"/2019/01/11/Vue-scoped&#x4E0E;module&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x5229;&#x5F0A;/5.jpg\" alt><br>&#x7531;&#x4E8E;&#x7236;&#x7EC4;&#x4EF6;scoped&#x7279;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x5B50;&#x7EC4;&#x4EF6;&#x7684;title-wrap&#xFF0C;&#x4E5F;&#x4F1A;&#x6DFB;&#x52A0;data-v-67e6b31f&#x524D;&#x7F00;</p>\n<p>&#x90A3;&#x4E48;&#x53C8;&#x6709;&#x4E2A;&#x7591;&#x95EE;&#xFF0C;&#x589E;&#x52A0;&#x4E86;scoped&#x662F;&#x5426;&#x5C31;&#x4E00;&#x5B9A;&#x4E0D;&#x80FD;&#x4F20;&#x9012;&#x7684;&#x4E0B;&#x5C42;&#x7EC4;&#x4EF6;&#x5462;&#xFF1F;&#x6BD5;&#x7ADF;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x6709;&#x9700;&#x8981;&#x4E2A;&#x522B;&#x6837;&#x5F0F;&#x4F20;&#x9012;&#x5230;&#x4E0B;&#x5C42;&#x7684;&#x9700;&#x6C42;&#x3002;&#x522B;&#x6025;&#xFF0C;&#x63A5;&#x7740;&#x770B;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E5F;&#x80FD;&#x5F88;&#x65B9;&#x4FBF;&#x7684;&#x89E3;&#x51B3;&#x3002;</p>\n<h3 id=\"&#x6DF1;&#x5EA6;&#x4F5C;&#x7528;\"><a href=\"#&#x6DF1;&#x5EA6;&#x4F5C;&#x7528;\" class=\"headerlink\" title=\"&#x6DF1;&#x5EA6;&#x4F5C;&#x7528;\"></a>&#x6DF1;&#x5EA6;&#x4F5C;&#x7528;</h3><p>&#x5982;&#x679C;&#x4F60;&#x5E0C;&#x671B;scoped&#x4E2D;&#x7684;&#x67D0;&#x4E2A;&#x6837;&#x5F0F;&#x80FD;&#x591F;&#x4F5C;&#x7528;&#x7684;&#x66F4;&#x6DF1;&#xFF0C;&#x5F71;&#x54CD;&#x5230;&#x5B50;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>&gt;&gt;&gt;</code>&#x64CD;&#x4F5C;&#x7B26;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;style scoped&gt;</span><br><span class=\"line\">.content &gt;&gt;&gt; .title-wrap {</span><br><span class=\"line\">    font-size: 20px;</span><br><span class=\"line\">    color: red;</span><br><span class=\"line\">}</span><br><span class=\"line\">&lt;/style&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x6CE8;&#x610F;&#x770B;&#x6211;&#x5C06;style&#x4E2D;&#x7684;lang=&#x201D;scss&#x201D;&#x53BB;&#x6389;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x52A0;&#x4E86;&#x9884;&#x5904;&#x7406;&#x5668;&#x540E;&#x65E0;&#x6CD5;&#x6B63;&#x786E;&#x89E3;&#x6790;<code>&gt;&gt;&gt;</code>&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;/deep/&#x4EE3;&#x66FF;&#xFF0C;&#x672C;&#x8D28;&#x662F;<code>&gt;&gt;&gt;</code>&#x7684;&#x522B;&#x540D;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class=\"line\">.content {</span><br><span class=\"line\">  /deep/ {</span><br><span class=\"line\">    .title-wrap {</span><br><span class=\"line\">      font-size: 20px;</span><br><span class=\"line\">      color: red;</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\">&lt;/style&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x5C06;&#x4F1A;&#x7F16;&#x8BD1;&#x6210;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.content[data-v-67e6b31f] .title-wrap {</span><br><span class=\"line\">    font-size: 20px;</span><br><span class=\"line\">    color: red;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2019/01/11/Vue-scoped&#x4E0E;module&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x5229;&#x5F0A;/1.jpg\" alt></p>\n<blockquote>\n<p>&#x901A;&#x8FC7; v-html &#x521B;&#x5EFA;&#x7684; DOM &#x5185;&#x5BB9;&#x4E0D;&#x53D7;&#x4F5C;&#x7528;&#x57DF;&#x5185;&#x7684;&#x6837;&#x5F0F;&#x5F71;&#x54CD;&#xFF0C;&#x4F46;&#x662F;&#x4F60;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6DF1;&#x5EA6;&#x4F5C;&#x7528;&#x9009;&#x62E9;&#x5668;&#x6765;&#x4E3A;&#x4ED6;&#x4EEC;&#x8BBE;&#x7F6E;&#x6837;&#x5F0F;</p>\n</blockquote>\n<h2 id=\"Module\"><a href=\"#Module\" class=\"headerlink\" title=\"Module\"></a>Module</h2><p>&#x9488;&#x5BF9;&#x4E0A;&#x9762;&#x7684;&#x8986;&#x76D6;&#x95EE;&#x9898;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;module&#x6765;&#x89E3;&#x51B3;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div :class=&quot;$style.content&quot;&gt;</span><br><span class=\"line\">    &lt;div :class=&quot;$style[&apos;title-wrap&apos;]&quot;&gt;&#x6211;&#x662F;&#x7EA2;&#x8272;&#x7684;&lt;/div&gt;</span><br><span class=\"line\">    &lt;green-title&gt;&lt;/green-title&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;style lang=&quot;scss&quot; module&gt;</span><br><span class=\"line\">.content {</span><br><span class=\"line\">  .title-wrap {</span><br><span class=\"line\">    font-size: 20px;</span><br><span class=\"line\">    color: red;</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\">&lt;/style&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2019/01/11/Vue-scoped&#x4E0E;module&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x5229;&#x5F0A;/2.jpg\" alt></p>\n<p>module&#x7684;&#x7528;&#x6CD5;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x8981;&#x5728;style&#x4E2D;&#x589E;&#x52A0;<code>module</code>&#x5C5E;&#x6027;&#x5373;&#x53EF;&#x3002;&#x4E0D;&#x540C;&#x4E4B;&#x5904;&#x662F;&#x5B83;&#x5728;&#x5E03;&#x5C40;&#x4E2D;&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x524D;&#x7F00;<code>$style</code>&#x3002;&#x56E0;&#x4E3A;&#x901A;&#x8FC7;module&#x4F5C;&#x7528;&#x7684;style&#x90FD;&#x88AB;&#x4FDD;&#x5B58;&#x5230;<code>$style</code>&#x5BF9;&#x8C61;&#x4E2D;&#x3002;&#x6211;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;console&#x67E5;&#x770B;&#x5B83;&#x7684;&#x5177;&#x4F53;&#x5F15;&#x7528;&#x540D;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mounted() {</span><br><span class=\"line\">  console.log(this.$style)</span><br><span class=\"line\">  console.log(this.$style[&apos;title-wrap&apos;])</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2019/01/11/Vue-scoped&#x4E0E;module&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x5229;&#x5F0A;/6.jpg\" alt></p>\n<p>&#x901A;&#x8FC7;&#x89C2;&#x5BDF;&#xFF0C;&#x53D1;&#x73B0;&#x5F15;&#x7528;&#x540D;&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x89C4;&#x5F8B;&#x3002;&#x90FD;&#x662F;&#x5DF2;index&#x5F00;&#x5934;&#xFF0C;&#x540E;&#x9762;&#x518D;&#x63A5;&#x7740;style&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x547D;&#x540D;&#xFF0C;&#x6700;&#x540E;&#x518D;&#x63A5;&#x4E2A;&#x540E;&#x7F00;&#x3002;&#x8FD9;&#x91CC;&#x7684;index&#x662F;&#x7236;&#x7EC4;&#x4EF6;&#x7684;&#x6587;&#x4EF6;&#x540D;index.vue&#x3002;&#x6240;&#x4EE5;&#x901A;&#x8FC7;module&#x4F5C;&#x7528;&#x7684;style&#x5C06;&#x4F1A;&#x91CD;&#x65B0;&#x547D;&#x540D;&#x4E3A;&#xFF1A;&#x6587;&#x4EF6;&#x540D;<em>&#x539F;style&#x540D;</em>&#x4E0D;&#x5B9A;&#x540E;&#x7F00;&#x3002;</p>\n<p>&#x8FD9;&#x4E48;&#x547D;&#x540D;&#x53C8;&#x6709;&#x4EC0;&#x4E48;&#x597D;&#x5904;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x4E0B;&#x5C55;&#x793A;&#x7684;&#x6548;&#x679C;</p>\n<p><img src=\"/2019/01/11/Vue-scoped&#x4E0E;module&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x5229;&#x5F0A;/7.jpg\" alt></p>\n<p>&#x5F53;&#x6211;&#x4EEC;&#x5728;&#x6D4F;&#x89C8;&#x7684;&#x63A7;&#x5236;&#x53F0;&#x67E5;&#x770B;Elements&#x65F6;&#xFF0C;&#x4F18;&#x70B9;&#x663E;&#x800C;&#x6613;&#x89C1;&#x3002;&#x76F8;&#x5BF9;&#x4E8E;scoped&#x7684;&#x65B9;&#x5F0F;&#xFF0C;module&#x7684;&#x65B9;&#x5F0F;&#x80FD;&#x591F;&#x4E00;&#x773C;&#x77E5;&#x9053;&#x8BE5;&#x5143;&#x7D20;&#x65F6;&#x5C5E;&#x4E8E;&#x54EA;&#x4E2A;&#x6587;&#x4EF6;&#x7EC4;&#x4EF6;&#x4E2D;&#x3002;&#x5728;&#x5927;&#x578B;&#x9879;&#x76EE;&#x4E2D;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x8FC5;&#x901F;&#x5B9A;&#x4F4D;&#x5230;&#x8981;&#x67E5;&#x627E;&#x7684;&#x7EC4;&#x4EF6;&#x3002;</p>\n<p>&#x9664;&#x4E86;&#x4E0A;&#x8FF0;&#x7684;&#x5FEB;&#x901F;&#x5B9A;&#x4F4D;&#xFF0C;&#x7531;&#x4E8E;module&#x4F1A;&#x5C06;&#x6240;&#x6709;&#x7684;style&#x90FD;&#x5F52;&#x5165;<code>$style</code>&#x4E2D;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x7075;&#x6D3B;&#x7684;&#x5C06;&#x4EFB;&#x610F;&#x7684;&#x7236;&#x7EC4;&#x4EF6;&#x6837;&#x5F0F;&#x4F20;&#x9012;&#x5230;&#x4EFB;&#x610F;&#x6DF1;&#x5C42;&#x7684;&#x5B50;&#x7EC4;&#x4EF6;&#x4E2D;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5C06;&#x7236;&#x7EC4;&#x4EF6;&#x4E2D;&#x7684;<code>title-wrap</code>&#x901A;&#x8FC7;props&#x4F20;&#x9012;&#x5230;&#x5B50;&#x7EC4;&#x4EF6;&#x4E2D;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div :class=&quot;$style.content&quot;&gt;</span><br><span class=\"line\">    &lt;div :class=&quot;$style[&apos;title-wrap&apos;]&quot;&gt;&#x6211;&#x662F;&#x7EA2;&#x8272;&#x7684;&lt;/div&gt;</span><br><span class=\"line\">    &lt;green-title :styleTitle=&quot;$style[&apos;title-wrap&apos;]&quot;&gt;&lt;/green-title&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div class=&quot;content&quot;&gt;</span><br><span class=\"line\">    &lt;div :class=&quot;styleTitle&quot;&gt;&#x6211;&#x662F;&#x7EFF;&#x8272;&#x7684;&lt;/div&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">export default {</span><br><span class=\"line\">  props: {</span><br><span class=\"line\">    styleTitle: String,</span><br><span class=\"line\">  },</span><br><span class=\"line\">}</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2019/01/11/Vue-scoped&#x4E0E;module&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x5229;&#x5F0A;/1.jpg\" alt><br><img src=\"/2019/01/11/Vue-scoped&#x4E0E;module&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x5229;&#x5F0A;/8.jpg\" alt></p>\n<p>module&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x6027;&#x975E;&#x5E38;&#x4E0D;&#x9519;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x5BFC;&#x51FA;&#x5B9A;&#x4E49;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x5C06;&#x53D8;&#x91CF;&#x5F52;&#x5165;<code>$style</code>&#x4E2D;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div :class=&quot;$style.content&quot;&gt;</span><br><span class=\"line\">    &lt;div :class=&quot;$style[&apos;title-wrap&apos;]&quot;&gt;&#x6211;&#x662F;&#x7EA2;&#x8272;&#x7684;&lt;/div&gt;</span><br><span class=\"line\">    &lt;green-title :styleTitle=&quot;$style[&apos;title-wrap&apos;]&quot;&gt;&lt;/green-title&gt;</span><br><span class=\"line\">    &lt;div&gt;{{$style.titleColor}}&lt;/div&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;style lang=&quot;scss&quot; module&gt;</span><br><span class=\"line\">$title-color: red;</span><br><span class=\"line\">:export {</span><br><span class=\"line\">  titleColor: $title-color</span><br><span class=\"line\">}</span><br><span class=\"line\">.content {</span><br><span class=\"line\">  .title-wrap {</span><br><span class=\"line\">    font-size: 20px;</span><br><span class=\"line\">    color: $title-color;</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\">&lt;/style&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2019/01/11/Vue-scoped&#x4E0E;module&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x5229;&#x5F0A;/9.jpg\" alt></p>\n<blockquote>\n<p>&#x66F4;&#x591A;module&#x76F8;&#x5173;&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;<a href=\"https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fcss-modules%2Fcss-modules\" target=\"_blank\" rel=\"noopener\">&#x70B9;&#x51FB;&#x67E5;&#x770B;</a></p>\n</blockquote>\n<h2 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h2><p>scoped&#x4E0E;module&#x90FD;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3001;&#x6613;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x53C8;&#x8BE5;&#x5982;&#x4F55;&#x9009;&#x62E9;&#x5462;&#xFF1F;</p>\n<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x4F7F;&#x7528;&#x5BF9;&#x6BD4;&#xFF0C;&#x53D1;&#x73B0;scoped&#x4E0D;&#x9700;&#x8981;&#x989D;&#x5916;&#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x53EA;&#x8981;&#x5728;style&#x4E2D;&#x5B9A;&#x4E49;scoped&#x5C5E;&#x6027;&#x5373;&#x53EF;&#xFF0C;&#x4F7F;&#x7528;&#x975E;&#x5E38;&#x7B80;&#x4FBF;&#x3002;&#x4F46;&#x5B83;&#x7684;&#x5C40;&#x9650;&#x6027;&#x662F;&#x9002;&#x7528;&#x4E8E;&#x4E2D;&#x5C0F;&#x9879;&#x76EE;&#x4E2D;&#x3002;&#x56E0;&#x4E3A;scoped&#x4F5C;&#x7528;&#x7684;style&#x5BF9;&#x4E8E;&#x6211;&#x4EEC;&#x6765;&#x8BF4;&#x4E0D;&#x76F4;&#x89C2;&#xFF0C;&#x5BF9;&#x4E8E;&#x5FEB;&#x901F;&#x67E5;&#x627E;&#x5B9A;&#x4F4D;&#xFF0C;module&#x66F4;&#x52A0;&#x5408;&#x9002;&#xFF0C;&#x540C;&#x65F6;module&#x5BF9;&#x4E8E;style&#x5411;&#x4E0B;&#x4F20;&#x9012;&#x7684;&#x63A7;&#x5236;&#x6743;&#x4E5F;&#x975E;&#x5E38;&#x7075;&#x6D3B;&#xFF1B;&#x989D;&#x5916;&#x7684;&#x8FD8;&#x6709;&#x53D8;&#x91CF;&#x5BFC;&#x51FA;&#x7B49;&#x4FBF;&#x6377;&#x529F;&#x80FD;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x5982;&#x679C;&#x4F60;&#x662F;&#x5C0F;&#x9879;&#x76EE;&#x4E2D;&#x4E14;&#x4F4E;&#x6210;&#x672C;&#x7684;&#x4F7F;&#x7528;&#xFF0C;scoped&#x66F4;&#x52A0;&#x9002;&#x5408;&#xFF1B;&#x800C;&#x5BF9;&#x5927;&#x9879;&#x76EE;module&#x66F4;&#x52A0;&#x5408;&#x9002;&#xFF0C;&#x867D;&#x7136;&#x6709;&#x4E00;&#x70B9;&#x5B66;&#x4E60;&#x6210;&#x672C;&#xFF0C;&#x4F46;&#x5BF9;&#x4E8E;&#x7528;&#x66F4;&#x597D;&#x7684;&#x63A7;&#x5236;&#x6743;&#x3001;&#x53EF;&#x89C2;&#x6027;&#x4E0E;&#x5B9A;&#x4F4D;&#x901F;&#x5EA6;&#x6765;&#x8BF4;&#x4E5F;&#x5C31;&#x4E0D;&#x503C;&#x4E00;&#x63D0;&#x3002;</p>\n<h2 id=\"&#x516C;&#x4F17;&#x53F7;\"><a href=\"#&#x516C;&#x4F17;&#x53F7;\" class=\"headerlink\" title=\"&#x516C;&#x4F17;&#x53F7;\"></a>&#x516C;&#x4F17;&#x53F7;</h2><p>&#x611F;&#x89C9;&#x4E0D;&#x9519;&#x7684;&#x53EF;&#x4EE5;&#x6765;&#x4E00;&#x6CE2;&#x5173;&#x6CE8;&#xFF0C;&#x626B;&#x63CF;&#x4E0B;&#x65B9;&#x4E8C;&#x7EF4;&#x7801;&#xFF0C;&#x5173;&#x6CE8;&#x516C;&#x4F17;&#x53F7;:<code>&#x602A;&#x8C08;&#x65F6;&#x95F4;</code>&#xFF0C;&#x53CA;&#x65F6;&#x83B7;&#x53D6;&#x6700;&#x65B0;&#x77E5;&#x8BC6;&#x6280;&#x5DE7;&#x4E0E;&#x4E92;&#x8054;&#x7F51;&#x65B0;&#x52A8;&#x6001;&#x3002;</p>\n<p><img src=\"/2019/01/11/Vue-scoped&#x4E0E;module&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x5229;&#x5F0A;/wx.jpg\" alt></p>\n","categories":["web"],"tags":["vue"]},{"title":"vps携手hexo的博客搭建之旅","url":"https://www.rousetime.com/2019/01/06/vps携手hexo的博客搭建之旅/","content":"<p>&#x7531;&#x4E8E;&#x81EA;&#x5DF1;&#x641E;&#x4E86;&#x4E2A;vps&#xFF0C;&#x4E5F;&#x642D;&#x5EFA;&#x4E86;vpn&#xFF0C;&#x65E5;&#x5E38;&#x79D1;&#x5B66;&#x4E0A;&#x7F51;&#x4E0E;&#x770B;&#x770B;&#x89C6;&#x9891;&#x8FD8;&#x662F;&#x6CA1;&#x4EC0;&#x4E48;&#x538B;&#x529B;&#x7684;&#x3002;&#x60F3;&#x7740;&#x4E5F;&#x4E0D;&#x80FD;&#x767D;&#x767D;&#x6D6A;&#x8D39;&#x6BCF;&#x4E2A;&#x6708;500G&#x7684;&#x6D41;&#x91CF;&#xFF0C;&#x4E8E;&#x662F;&#x60F3;&#x8D77;&#x81EA;&#x5DF1;&#x73B0;&#x5728;&#x7684;hexo&#x535A;&#x5BA2;&#x3002;&#x76EE;&#x524D;&#x8FD8;&#x6CA1;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x79C1;&#x6709;&#x57DF;&#x540D;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x7528;&#x7684;&#x8FD8;&#x662F;&#x4F20;&#x7EDF;&#x7684;github.io&#x901A;&#x7528;&#x57DF;&#x540D;&#x3002;&#x4F5C;&#x4E3A;it&#x754C;&#x7684;&#x4E00;&#x5458;&#xFF0C;&#x65E2;&#x7136;&#x6709;&#x6761;&#x4EF6;&#x80FD;&#x53D8;&#x5F97;&#x66F4;&#x597D;&#x5C31;&#x4E0D;&#x5E94;&#x8BE5;&#x4E0D;&#x53BB;&#x505A;&#x3002;&#x4E8E;&#x662F;&#x82B1;&#x4E00;&#x5929;&#x65F6;&#x95F4;&#x6298;&#x817E;&#x51FA;&#x6765;&#x7684;&#x81EA;&#x5DF1;&#x7684;&#x4E13;&#x5C5E;&#x535A;&#x5BA2;&#x7CFB;&#x7EDF;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4F1A;&#x5C06;&#x81EA;&#x5DF1;&#x642D;&#x5EFA;&#x8FC7;&#x7A0B;&#x4E2D;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;&#x4E0E;&#x6B65;&#x9AA4;&#x7F57;&#x5217;&#x51FA;&#x6765;&#xFF0C;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x6709;&#x540C;&#x6837;&#x9700;&#x6C42;&#x7684;&#x4F60;&#x3002;</p>\n<h2 id=\"&#x524D;&#x63D0;&#x6761;&#x4EF6;\"><a href=\"#&#x524D;&#x63D0;&#x6761;&#x4EF6;\" class=\"headerlink\" title=\"&#x524D;&#x63D0;&#x6761;&#x4EF6;\"></a>&#x524D;&#x63D0;&#x6761;&#x4EF6;</h2><p>&#x9996;&#x5148;&#x6211;&#x7684;&#x642D;&#x5EFA;&#x662F;&#x57FA;&#x4E8E;&#x4EE5;&#x4E0B;&#x6761;&#x4EF6;&#x4E4B;&#x4E0A;&#x7684;</p>\n<ol>\n<li>&#x672C;&#x5730;hexo&#x535A;&#x5BA2;&#x5DF2;&#x5B8C;&#x6210;(github.io&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;)</li>\n<li>&#x6709;&#x81EA;&#x5DF1;&#x7684;vps</li>\n<li>&#x670D;&#x52A1;&#x5668;&#x7CFB;&#x7EDF;Centos 6 x86_64</li>\n<li>&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x57DF;&#x540D;</li>\n<li>&#x57DF;&#x540D;&#x5DF2;&#x8FDB;&#x884C;&#x89E3;&#x6790;</li>\n</ol>\n<blockquote>\n<p>&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x4ECB;&#x7ECD;hexo&#x535A;&#x5BA2;&#x672C;&#x5730;&#x6784;&#x5EFA;&#xFF0C;&#x60F3;&#x4E86;&#x89E3;&#x7684;&#x63A8;&#x8350;&#x9605;&#x8BFB;<a href=\"https://rousetime.com/2016/03/04/Hexo-install/\" target=\"_blank\" rel=\"noopener\">Hexo&#x7684;&#x5B89;&#x88C5;&#x4E0E;&#x914D;&#x7F6E;</a></p>\n</blockquote>\n<p>&#x6211;&#x4EEC;&#x5C06;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x4E3B;&#x8981;&#x95EE;&#x9898;&#x662F;&#xFF1A;</p>\n<ol>\n<li>SSH&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;</li>\n<li>&#x4E0B;&#x8F7D;git&#x4E0E;&#x521B;&#x5EFA;git&#x670D;&#x52A1;&#x5668;</li>\n<li>&#x4E0B;&#x8F7D;nginx&#x4E0E;&#x914D;&#x7F6E;nginx&#x73AF;&#x5883;</li>\n<li>&#x672C;&#x5730;hexo&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x5173;&#x8054;</li>\n</ol>\n<h2 id=\"SSH&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;\"><a href=\"#SSH&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;\" class=\"headerlink\" title=\"SSH&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;\"></a>SSH&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;</h2><p>SSH&#x975E;&#x5E38;&#x5F3A;&#x5927;&#xFF0C;&#x5728;&#x6211;&#x65E5;&#x5E38;&#x5DE5;&#x4F5C;&#x4E2D;&#x65F6;&#x523B;&#x76F8;&#x9047;&#x3002;&#x76F8;&#x4FE1;&#x4F60;&#x4E5F;&#x662F;&#xFF0C;&#x53EF;&#x80FD;&#x4F60;&#x4E0D;&#x66FE;&#x6CE8;&#x610F;&#x5230;&#x5B83;&#x800C;&#x5DF2;&#x3002;&#x65E5;&#x5E38;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x62C9;&#x53D6;&#x4E0E;&#x4E0A;&#x4F20;&#x4EE3;&#x7801;&#x90FD;&#x662F;&#x901A;&#x8FC7;SSH&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x7684;&#x3002;&#x867D;&#x7136;&#x5C06;&#x751F;&#x6210;&#x7684;id_rsa.pub&#x516C;&#x94A5;&#x4EA4;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#x540E;&#x5C31;&#x518D;&#x6CA1;&#x600E;&#x4E48;&#x63A5;&#x89E6;&#x8FC7;&#x5B83;&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x80FD;&#x5426;&#x8BA4;&#x5B83;&#x7684;&#x5B58;&#x5728;&#x3002;</p>\n<p>&#x7531;&#x4E8E;SSH&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x5B89;&#x5168;&#x4E0E;&#x7A33;&#x5B9A;&#x7684;&#x901A;&#x4FE1;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x8FD9;&#x91CC;&#x4E5F;&#x4F7F;&#x7528;SSH&#x6765;&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;&#x3002;</p>\n<p>&#x5728;&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x524D;&#xFF0C;&#x4F60;&#x9700;&#x77E5;&#x9053;&#x81EA;&#x5DF1;&#x670D;&#x52A1;&#x5668;&#x7684;IP&#x5730;&#x5740;&#xFF0C;&#x76F8;&#x4FE1;&#x90FD;&#x80FD;&#x591F;&#x62FF;&#x5230;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#x4EE5;root&#x7528;&#x6237;&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;</span><br><span class=\"line\"># &#x5C06;12.12.12.12&#x6362;&#x6210;&#x81EA;&#x5DF1;&#x670D;&#x52A1;&#x5668;IP</span><br><span class=\"line\"># &#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x57DF;&#x540D;&#x4E14;&#x5DF2;&#x7ECF;&#x8FDB;&#x884C;&#x4E86;&#x89E3;&#x6790;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x57DF;&#x540D;&#x4EE3;&#x66FF;</span><br><span class=\"line\">ssh root@12.12.12.12</span><br></pre></td></tr></table></figure>\n<p>&#x76F8;&#x4FE1;&#x8FD9;&#x4E00;&#x6B65;&#x5927;&#x90E8;&#x5206;&#x4EBA;&#x90FD;&#x4F1A;&#x62A5;&#x4E0B;&#x9762;&#x4E00;&#x6BB5;&#x9519;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh: connect to host 12.12.12.12 port 22: Connection refused</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x662F;&#x7531;&#x4E8E;&#x4F60;&#x7684;ssh&#x9ED8;&#x8BA4;&#x8FDE;&#x63A5;&#x7AEF;&#x53E3;22&#x4E0E;&#x4F60;&#x7684;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x53E3;&#x4E0D;&#x4E00;&#x81F4;&#x5BFC;&#x81F4;&#x7684;&#x3002;&#x8BE5;&#x95EE;&#x9898;&#x6709;&#x4E24;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x4E00;&#x662F;&#x6539;&#x53D8;ssh&#x7684;&#x9ED8;&#x8BA4;&#x7AEF;&#x53E3;&#xFF1B;&#x5176;&#x4E8C;&#x662F;&#x6307;&#x5B9A;&#x8FDE;&#x63A5;&#x7AEF;&#x53E3;&#x3002;&#x7B2C;&#x4E00;&#x4E2D;&#x4E0D;&#x63A8;&#x8350;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x90FD;&#x575A;&#x6301;&#x80FD;&#x4E0D;&#x52A8;&#x9ED8;&#x8BA4;&#x7684;&#x7684;&#x5C31;&#x4E0D;&#x51FA;&#x4FEE;&#x6539;&#x9ED8;&#x8BA4;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7B2C;&#x4E8C;&#x4E2D;&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x8FDE;&#x63A5;&#x547D;&#x4EE4;&#x884C;&#x540E;&#x518D;&#x52A0;&#x4E0A;&#x7AEF;&#x53E3;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh root@12.12.12.12 -p &#x7AEF;&#x53E3;</span><br></pre></td></tr></table></figure>\n<p>&#x63A5;&#x4E0B;&#x6765;&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F;&#x8F93;&#x5165;&#x5BC6;&#x7801;&#x4E86;&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x8FDE;&#x63A5;&#x4E0A;&#x670D;&#x52A1;&#x5668;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x5728;&#x81EA;&#x5DF1;&#x7684;&#x7535;&#x8111;&#x4E0A;&#x8FDC;&#x7A0B;&#x64CD;&#x4F5C;&#x670D;&#x52A1;&#x5668;&#x4E86;&#x3002;</p>\n<h3 id=\"&#x63D2;&#x66F2;\"><a href=\"#&#x63D2;&#x66F2;\" class=\"headerlink\" title=\"&#x63D2;&#x66F2;\"></a>&#x63D2;&#x66F2;</h3><p>&#x5982;&#x679C;&#x4F60;&#x5BA2;&#x6237;&#x7AEF;&#x4E0A;&#x6CA1;&#x6709;ssh&#x516C;&#x94A5;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;<a href=\"https://rousetime.com/2016/03/04/Hexo-install/\" target=\"_blank\" rel=\"noopener\">Hexo&#x7684;&#x5B89;&#x88C5;&#x4E0E;&#x914D;&#x7F6E;</a>&#x6765;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002;</p>\n<p>&#x627E;&#x5230;&#x516C;&#x94A5;&#xFF0C;&#x516C;&#x94A5;&#x4F4D;&#x7F6E;&#xFF1A;~/.ssh/id_rsa.pub&#xFF0C;&#x540E;&#x7EED;&#x4F1A;&#x7528;&#x5230;&#x3002;</p>\n<h2 id=\"git&#x670D;&#x52A1;&#x5668;\"><a href=\"#git&#x670D;&#x52A1;&#x5668;\" class=\"headerlink\" title=\"git&#x670D;&#x52A1;&#x5668;\"></a>git&#x670D;&#x52A1;&#x5668;</h2><p>&#x8FDE;&#x63A5;&#x4E0A;&#x670D;&#x52A1;&#x4E4B;&#x540E;&#xFF0C;&#x9996;&#x5148;&#x67E5;&#x770B;&#x662F;&#x5426;&#x5B89;&#x88C5;&#x4E86;git&#xFF0C;&#x6CA1;&#x6709;&#x7684;&#x4F7F;&#x7528;yum&#x8FDB;&#x884C;&#x6309;&#x7167;&#x5373;&#x53EF;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install git</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x88F8;&#x5E93;\"><a href=\"#&#x88F8;&#x5E93;\" class=\"headerlink\" title=\"&#x88F8;&#x5E93;\"></a>&#x88F8;&#x5E93;</h3><p>&#x5728;&#x5F00;&#x59CB;&#x642D;&#x5EFA;git&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5C06;&#x73B0;&#x6709;&#x7684;&#x4ED3;&#x5E93;&#x5BFC;&#x51FA;&#x4E3A;&#x88F8;&#x4ED3;&#x5E93;&#x3002;&#x610F;&#x601D;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x5305;&#x542B;&#x5F53;&#x524D;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#x7684;&#x4ED3;&#x5E93;&#x3002;&#x4E3B;&#x8981;&#x662F;&#x4F7F;&#x7528;git&#x7684;&#x2013;bare&#x3002;&#x5728;&#x64CD;&#x4F5C;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x5148;&#x56DE;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x518D;&#x6267;&#x884C;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone --bare my_project blog.git</span><br></pre></td></tr></table></figure>\n<p>my_project&#x5982;&#x679C;&#x4E3A;&#x8FDC;&#x7A0B;&#x4ED3;&#x5E93;&#x5C31;&#x4F7F;&#x7528;&#x8FDC;&#x7A0B;&#x4ED3;&#x5E93;&#x7684;ssh&#x94FE;&#x63A5;, blog.git&#x53EF;&#x4EE5;&#x968F;&#x4FBF;&#x547D;&#x540D;&#x4F46;&#x5FC5;&#x987B;&#x4EE5;.git&#x7ED3;&#x5C3E;&#x3002;</p>\n<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x4ED3;&#x5E93;&#x7684;&#x88F8;&#x5E93;&#x4E86;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x9700;&#x8981;&#x5C06;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x88F8;&#x5E93;copy&#x5230;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x672C;&#x8D28;&#x4E5F;&#x662F;&#x901A;&#x8FC7;ssh&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;</p>\n<p>&#x5047;&#x8BBE;&#x4F60;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5DF2;&#x7ECF;&#x6709;/opt/git/&#x76EE;&#x5F55;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x547D;&#x4EE4;copy&#x5230;&#x670D;&#x52A1;&#x5668;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp -r blog.git user@Ip:/opt/git</span><br></pre></td></tr></table></figure>\n<p>user&#x4E3A;&#x8FDE;&#x63A5;&#x7528;&#x6237;&#xFF0C;&#x4F8B;&#x5982;root&#x3002;&#x5982;&#x679C;&#x53C8;&#x9047;&#x5230;&#x7AEF;&#x53E3;&#x95EE;&#x9898;&#xFF0C;&#x66FF;&#x6362;&#x6210;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp -P &#x7AEF;&#x53E3; -r blog.git user@IP:/opt/git</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x6CE8;&#x610F;&#x5927;&#x5199;P</p>\n</blockquote>\n<p>&#x5982;&#x679C;&#x901A;&#x8FC7;ssh&#x8FDE;&#x63A5;&#x7684;&#x7528;&#x6237;&#x5BF9;blog.git&#x62E5;&#x6709;&#x53EF;&#x8BFB;&#x6743;&#x9650;&#xFF0C;&#x90A3;&#x4E48;&#x4ED6;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x514B;&#x9686;&#x4F60;&#x7684;&#x4ED3;&#x5E93;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone user@IP:/opt/git/blog.git</span><br></pre></td></tr></table></figure>\n<p>&#x5F53;&#x7136;&#x5982;&#x62E5;&#x6709;&#x53EF;&#x5199;&#x6743;&#x9650;&#xFF0C;&#x4ED6;&#x4E5F;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x63A8;&#x9001;&#x3002;<strong>&#x6240;&#x4EE5;&#x5982;&#x679C;&#x540E;&#x7EED;&#x4F60;&#x53D1;&#x73B0;&#x64CD;&#x4F5C;&#x4E0D;&#x4E86;&#x4ED3;&#x5E93;&#x65F6;&#xFF0C;&#x5F88;&#x5927;&#x53EF;&#x80FD;&#x662F;&#x8BE5;&#x7528;&#x6237;&#x6CA1;&#x6709;&#x8BFB;&#x6216;&#x5199;&#x6743;&#x9650;</strong>&#x3002;</p>\n<p>&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6765;&#x521B;&#x5EFA;git&#x7528;&#x6237;</p>\n<h3 id=\"git&#x7528;&#x6237;&#x4E0E;&#x8BA4;&#x8BC1;\"><a href=\"#git&#x7528;&#x6237;&#x4E0E;&#x8BA4;&#x8BC1;\" class=\"headerlink\" title=\"git&#x7528;&#x6237;&#x4E0E;&#x8BA4;&#x8BC1;\"></a>git&#x7528;&#x6237;&#x4E0E;&#x8BA4;&#x8BC1;</h3><p>&#x56DE;&#x5230;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5BF9;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x8BA4;&#x8BC1;&#x3002;&#x7528;&#x6237;&#x8BA4;&#x8BC1;&#x4F7F;&#x7528;authorized_keys&#x8FDB;&#x884C;&#xFF0C;&#x9996;&#x5148;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7528;&#x6237;git&#xFF0C;&#x5E76;&#x4E3A;&#x5B83;&#x5EFA;&#x7ACB;.ssh&#x76EE;&#x5F55;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo adduser git</span><br><span class=\"line\">su git</span><br><span class=\"line\">cd</span><br><span class=\"line\">mkdir .ssh &amp;&amp; chomd 700 .ssh</span><br><span class=\"line\">touch .ssh/authorized_keys &amp;&amp; chmod 600 .ssh/authorized_keys</span><br></pre></td></tr></table></figure>\n<p>&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x6743;&#x9650;&#x95EE;&#x9898;&#xFF0C;&#x7EC8;&#x6781;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;git&#x6DFB;&#x52A0;&#x5230;sudo&#x7528;&#x6237;&#x7EC4;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#x5207;&#x6362;&#x5230;root&#x7528;&#x6237;</span><br><span class=\"line\">su root</span><br><span class=\"line\">sudo vi /etc/sudoers</span><br></pre></td></tr></table></figure>\n<p>&#x6253;&#x5F00;&#x6587;&#x4EF6;&#xFF0C;&#x4F7F;&#x7528;:/root&#x8FDB;&#x884C;&#x641C;&#x7D22;&#xFF0C;&#x5728;root&#x4E0B;&#x6DFB;&#x52A0;git&#x7528;&#x6237;</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">## Next comes the main part: which users can run what software on</span><br><span class=\"line\">## which machines (the sudoers file can be shared between multiple</span><br><span class=\"line\">## systems).</span><br><span class=\"line\">## Syntax:</span><br><span class=\"line\">##</span><br><span class=\"line\">##      user    MACHINE=COMMANDS</span><br><span class=\"line\">##</span><br><span class=\"line\">## The COMMANDS section may have other options added to it.</span><br><span class=\"line\">##</span><br><span class=\"line\">## Allow root to run any commands anywhere</span><br><span class=\"line\">root    ALL=(ALL)       ALL</span><br><span class=\"line\">git     ALL=(ALL)       ALL</span><br><span class=\"line\"></span><br><span class=\"line\">## Allows members of the &apos;sys&apos; group to run networking, software,</span><br><span class=\"line\">## service management apps and more.</span><br><span class=\"line\"># %sys ALL = NETWORKING, SOFTWARE, SERVICES, STORAGE, DELEGATING, PROCESSES, LOCATE, DRIVERS</span><br></pre></td></tr></table></figure>\n<p>&#x56DE;&#x5230;&#x8BA4;&#x8BC1;&#xFF0C;&#x6211;&#x4EEC;&#x4E3A;&#x7CFB;&#x7EDF;&#x7528;&#x6237;git&#x7684;authorized_keys&#x6587;&#x4EF6;&#x6DFB;&#x52A0;&#x64CD;&#x4F5C;&#x7528;&#x6237;&#x7684;ssh&#x516C;&#x94A5;&#xFF0C;&#x5C31;&#x662F;&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x5BA2;&#x6237;&#x7AEF;&#x751F;&#x6210;&#x7684;&#x516C;&#x94A5;&#x3002;&#x5047;&#x8BBE;&#x4F60;&#x5DF2;&#x7ECF;&#x5C06;id_rsa.pub&#x4FDD;&#x5B58;&#x5230;&#x4E34;&#x65F6;&#x6587;&#x4EF6;/tmp/id_rsa.pub&#x4E2D;&#x3002;&#x6267;&#x884C;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#xFF0C;&#x5C06;&#x516C;&#x94A5;&#x52A0;&#x5165;&#x5230;authorized_keys&#x6587;&#x4EF6;&#x7684;&#x672B;&#x5C3E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /tmp/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>\n<p>&#x8BBE;&#x7F6E;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x8FD4;&#x56DE;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x6267;&#x884C;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#xFF0C;&#x6D4B;&#x8BD5;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x8FDE;&#x63A5;&#x4E0A;&#x670D;&#x52A1;&#x5668;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh -v git@IP -p &#x7AEF;&#x53E3;</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;git&#x670D;&#x52A1;&#x5668;&#x3001;&#x7528;&#x6237;&#x8BA4;&#x8BC1;&#x4E0E;&#x64CD;&#x4F5C;&#x6743;&#x9650;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5BF9;&#x4ED3;&#x5E93;&#x7684;&#x4EBA;&#x5458;&#x6DFB;&#x52A0;&#x4E0E;&#x4ED3;&#x5E93;&#x5206;&#x652F;&#x7B49;&#x7684;&#x64CD;&#x4F5C;&#x6743;&#x9650;&#x9650;&#x5236;&#x3002;&#x8BE5;&#x529F;&#x80FD;&#x5C31;&#x4E5F;&#x5E02;&#x9762;&#x4E0A;&#x7684;&#x4EE3;&#x7801;&#x6258;&#x7BA1;&#x5E73;&#x53F0;&#x7C7B;&#x4F3C;&#x3002;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x53BB;&#x7814;&#x7A76;&#x3002;</p>\n<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x4E00;&#x5927;&#x534A;&#x4E86;&#xFF0C;&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F;&#x670D;&#x52A1;&#x5668;&#x6307;&#x5411;&#x57DF;&#x540D;&#x4E0E;&#x4EE3;&#x7801;&#x4E0A;&#x4F20;&#x670D;&#x52A1;&#x5668;&#x3002;</p>\n<h2 id=\"Nginx&#x914D;&#x7F6E;\"><a href=\"#Nginx&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"Nginx&#x914D;&#x7F6E;\"></a>Nginx&#x914D;&#x7F6E;</h2><p>nginx&#x76F8;&#x4FE1;&#x6216;&#x591A;&#x6216;&#x5C11;&#x90FD;&#x6709;&#x4E00;&#x70B9;&#x63A5;&#x89E6;&#x5427;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x670D;&#x52A1;&#x7AEF;&#x4E0E;&#x524D;&#x7AEF;&#x3002;&#x6700;&#x8FD1;&#x5B66;&#x4E60;&#x4E86;&#x524D;&#x7AEF;&#xFF0C;&#x6240;&#x4EE5;&#x81EA;&#x5DF1;&#x5BF9;nginx&#x4E5F;&#x4E0D;&#x662F;&#x90A3;&#x4E48;&#x964C;&#x751F;&#x3002;&#x6211;&#x4EEC;&#x516C;&#x53F8;&#x524D;&#x7AEF;&#x4E3B;&#x8981;&#x662F;&#x7528;nginx&#x6765;&#x8FDB;&#x884C;&#x672C;&#x5730;&#x4EE3;&#x7406;&#xFF0C;&#x65B9;&#x4FBF;&#x672C;&#x5730;&#x6D4B;&#x8BD5;&#x3002;</p>\n<p>&#x8BDD;&#x4E0D;&#x591A;&#x8BF4;&#xFF0C;&#x73B0;&#x5728;&#x8FDB;&#x884C;nginx&#x914D;&#x7F6E;</p>\n<h3 id=\"&#x5B89;&#x88C5;\"><a href=\"#&#x5B89;&#x88C5;\" class=\"headerlink\" title=\"&#x5B89;&#x88C5;\"></a>&#x5B89;&#x88C5;</h3><p>&#x5982;&#x679C;&#x4F60;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x547D;&#x4EE4;&#x5C31;&#x5B89;&#x88C5;&#x6210;&#x529F;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x662F;&#x5E78;&#x8FD0;&#x7684;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install nginx</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x4E00;&#x5207;&#x987A;&#x5229;&#xFF0C;&#x8BF7;&#x8DF3;&#x8FC7;&#x5B89;&#x88C5;&#x8FD9;&#x90E8;&#x5206;&#xFF0C;&#x5982;&#x679C;&#x63D0;&#x793A;&#x6CA1;&#x6709;&#x627E;&#x5230;nginx&#xFF0C;&#x8BF7;&#x63A5;&#x4E0B;&#x770B;&#x3002;</p>\n<p>&#x7531;&#x4E8E;&#x6211;&#x662F;&#x4F7F;&#x7528;Centos 6&#xFF0C;nginx&#x4F4D;&#x4E8E;&#x7B2C;&#x4E09;&#x65B9;&#x7684;yum&#x6E90;&#x4E2D;&#xFF0C;&#x800C;nginx&#x4E0D;&#x5728;Centos 6&#x5B98;&#x65B9;yum&#x4E2D;&#xFF0C;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x5B89;&#x88C5;epel(Extra Packages for Enterprise Linux)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install epel-release</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x518D;&#x67E5;&#x770B;&#x662F;&#x5426;&#x5728;&#x6E90;&#x5217;&#x8868;&#x4E2D;&#xFF0C;&#x8FD9;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EF;&#x80FD;&#x4E0D;&#x5728;&#x6E90;&#x5217;&#x8868;&#x4E2D;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum repolist</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2019/01/06/vps&#x643A;&#x624B;hexo&#x7684;&#x535A;&#x5BA2;&#x642D;&#x5EFA;&#x4E4B;&#x65C5;/1.jpg\" alt></p>\n<p>&#x53EA;&#x6709;&#x663E;&#x793A;&#x4E86;epel&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x4F60;&#x6267;&#x884C;nginx&#x7684;&#x5B89;&#x88C5;&#x547D;&#x4EE4;&#x624D;&#x4E0D;&#x4F1A;&#x5931;&#x8D25;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install nginx</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x4F60;&#x6267;&#x884C;&#x4E0A;&#x8FF0;&#x547D;&#x4EE4;nginx&#x8FD8;&#x662F;&#x627E;&#x4E0D;&#x5230;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x610F;&#x601D;&#x5230;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x5C31;&#x662F;&#x65E0;&#x5934;&#x7EEA;&#x4E3A;&#x4EC0;&#x4E48;&#x4E00;&#x76F4;&#x62A5;nginx&#x627E;&#x4E0D;&#x5230;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x5728;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x8D70;&#x3002;</p>\n<p>&#x6253;&#x5F00;&#x6587;&#x4EF6;epel.repo&#xFF0C;&#x5C06;&#x5176;&#x4E2D;&#x7684;enable=0&#x6539;&#x4E3A;enable=1</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/yum.repos.d/epel.repo</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2019/01/06/vps&#x643A;&#x624B;hexo&#x7684;&#x535A;&#x5BA2;&#x642D;&#x5EFA;&#x4E4B;&#x65C5;/2.jpg\" alt></p>\n<p>&#x7136;&#x540E;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x547D;&#x4EE4;&#x67E5;&#x770B;epel&#x662F;&#x5426;&#x5B58;&#x5728;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum repolist 2&gt;&amp;1 | grep epel</span><br><span class=\"line\">epel          Extra Packages for Enterprise Linux 6 - x86_64              12,517</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x5C55;&#x793A;&#x4E86;epel&#xFF0C;&#x4EE3;&#x8868;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x3002;&#x8FD9;&#x65F6;&#x4F60;&#x518D;&#x6267;&#x884C;&#x5B89;&#x88C5;nginx&#x7684;&#x547D;&#x4EE4;&#x5C31;&#x53EF;&#x4EE5;&#x6210;&#x529F;&#x4E86;&#x3002;</p>\n<p>&#x5B89;&#x88C5;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x5C06;&#x5176;&#x542F;&#x52A8;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service nginx start</span><br><span class=\"line\"># &#x8BBE;&#x7F6E;&#x5F00;&#x673A;&#x542F;&#x52A8;</span><br><span class=\"line\">chkconfig nginx on</span><br></pre></td></tr></table></figure>\n<p>&#x8FDB;&#x884C;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5C06;&#x670D;&#x52A1;&#x5668;&#x7684;ip&#x590D;&#x5236;&#x5230;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x770B;&#x5230;nginx&#x7684;welcome&#x754C;&#x9762;&#xFF0C;&#x8BF4;&#x660E;nginx&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#x6210;&#x529F;&#x3002;</p>\n<h3 id=\"&#x914D;&#x7F6E;\"><a href=\"#&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;\"></a>&#x914D;&#x7F6E;</h3><p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x8981;&#x914D;&#x7F6E;nginx&#xFF0C;&#x8BA9;&#x5176;&#x6307;&#x5411;&#x6211;&#x4EEC;&#x7684;blog&#x5730;&#x5740;&#x3002;&#x6253;&#x5F00;nginx&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/nginx/conf.d/default.conf</span><br></pre></td></tr></table></figure>\n<p>&#x5B89;&#x88C5;&#x5982;&#x4E0B;&#x8BF4;&#x660E;&#x66FF;&#x6362;&#x81EA;&#x5DF1;&#x7684;&#x4FE1;&#x606F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#</span><br><span class=\"line\"># The default server</span><br><span class=\"line\">#</span><br><span class=\"line\"> </span><br><span class=\"line\">server {</span><br><span class=\"line\">    listen       80;</span><br><span class=\"line\">    # listen       [::]:80 default_server;</span><br><span class=\"line\">    server_name  rousetime.com; # &#x66FF;&#x6362;&#x6210;&#x81EA;&#x5DF1;&#x7684;&#x57DF;&#x540D;</span><br><span class=\"line\">    root         /usr/share/nginx/html/blog; # &#x535A;&#x5BA2;&#x6240;&#x5728;&#x76EE;&#x5F55;</span><br><span class=\"line\"> </span><br><span class=\"line\">    # Load configuration files for the default server block.</span><br><span class=\"line\">    include /etc/nginx/default.d/*.conf;</span><br><span class=\"line\"> </span><br><span class=\"line\">    location / {</span><br><span class=\"line\">        root /usr/share/nginx/html/blog; # &#x535A;&#x5BA2;&#x6240;&#x5728;&#x76EE;&#x5F55;</span><br><span class=\"line\">        index index.html index.htm;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    error_page 404 /404.html;</span><br><span class=\"line\">        location = /40x.html {</span><br><span class=\"line\">        root /usr/share/nginx/html/blog; # &#x535A;&#x5BA2;&#x6240;&#x5728;&#x76EE;&#x5F55;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    error_page 500 502 503 504 /50x.html;</span><br><span class=\"line\">        location = /50x.html {</span><br><span class=\"line\">        root /usr/share/nginx/html/blog; # &#x535A;&#x5BA2;&#x6240;&#x5728;&#x76EE;&#x5F55;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p><strong>/usr/share/nginx/html/blog</strong>&#x662F;&#x6211;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5B58;&#x653E;&#x535A;&#x5BA2;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x6539;&#x6210;&#x81EA;&#x5DF1;&#x7684;&#x76EE;&#x5F55;&#x3002;&#x8FD9;&#x6837;nginx&#x5C31;&#x914D;&#x7F6E;&#x5B8C;&#x6210;&#x3002;</p>\n<h2 id=\"&#x672C;&#x5730;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x540C;&#x6B65;\"><a href=\"#&#x672C;&#x5730;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x540C;&#x6B65;\" class=\"headerlink\" title=\"&#x672C;&#x5730;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x540C;&#x6B65;\"></a>&#x672C;&#x5730;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x540C;&#x6B65;</h2><p>&#x73B0;&#x5728;&#x5C31;&#x5269;&#x6700;&#x540E;&#x4E00;&#x6B65;&#x4E86;&#xFF0C;&#x5C06;&#x672C;&#x5730;hexo&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x5230;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x540C;&#x65F6;&#x6BCF;&#x6B21;&#x901A;&#x8FC7;git&#x66F4;&#x65B0;&#x4EE3;&#x7801;&#x540E;&#x90FD;&#x4F1A;&#x540C;&#x6B65;&#x5230;&#x670D;&#x52A1;&#x5668;&#x3002;</p>\n<p>&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5EFA;&#x7ACB;&#x4E86;git&#x670D;&#x52A1;&#x5668;&#x4E0E;git&#x88F8;&#x5E93;&#xFF0C;&#x4E3A;&#x4E86;&#x4E4B;&#x540E;&#x7684;&#x4E0A;&#x4F20;&#x4EE3;&#x7801;&#x5173;&#x8054;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x501F;&#x52A9;git&#x7684;&#x670D;&#x52A1;&#x94A9;&#x5B50;post-receive&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x5728;&#x4ED3;&#x5E93;&#x6536;&#x5230;push&#x4EE3;&#x7801;&#x540E;&#xFF0C;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x76F8;&#x5173;&#x64CD;&#x4F5C;&#xFF0C;&#x4F8B;&#x5982;&#x901A;&#x77E5;&#x4E0E;&#x66F4;&#x65B0;&#x7B49;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x5728;blog.git/hooks&#x4E2D;&#x65B0;&#x5EFA;post-receive&#x6587;&#x4EF6; (&#x8FD9;&#x91CC;&#x6211;&#x5DF2;&#x5C06;blog.git&#x8F6C;&#x79FB;&#x5230;git&#x7528;&#x6237;&#x4E0B;/home/git)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su git</span><br><span class=\"line\">vi ~/blog.git/hooks/post-receive</span><br></pre></td></tr></table></figure>\n<p>&#x5411;&#x5176;&#x4E2D;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF0C;&#x6307;&#x660E;git&#x7684;&#x5DE5;&#x4F5C;&#x6811;&#x8DEF;&#x5F84;&#x4E0E;&#x4ED3;&#x5E93;&#x8DEF;&#x5F84;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#! /bin/sh</span><br><span class=\"line\">git --work-tree=/usr/share/nginx/html/blog --git-dir=/home/git/blog.git checkout -f</span><br></pre></td></tr></table></figure>\n<p>&#x4FDD;&#x5B58;&#x540E;&#x9000;&#x51FA;&#xFF0C;&#x518D;&#x7ED9;&#x5176;&#x8D4B;&#x4E88;&#x53EF;&#x6267;&#x884C;&#x6743;&#x9650;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x ~/blog.git/hooks/post-receive</span><br></pre></td></tr></table></figure>\n<h3 id=\"hexo&#x4EE3;&#x7801;&#x540C;&#x6B65;\"><a href=\"#hexo&#x4EE3;&#x7801;&#x540C;&#x6B65;\" class=\"headerlink\" title=\"hexo&#x4EE3;&#x7801;&#x540C;&#x6B65;\"></a>hexo&#x4EE3;&#x7801;&#x540C;&#x6B65;</h3><p>&#x8FD4;&#x56DE;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x6253;&#x5F00;hexo&#x7684;_config.xml&#x6587;&#x4EF6;&#xFF0C;&#x627E;&#x5230;deploy&#xFF0C;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x8BBE;&#x7F6E;&#x540E;&#x9762;&#x518D;&#x6DFB;&#x52A0;&#x6211;&#x4EEC;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4ED3;&#x5E93;&#x5730;&#x5740;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deploy:</span><br><span class=\"line\">- type: git</span><br><span class=\"line\">  repository: xxx # &#x4E4B;&#x524D;&#x7684;github&#x4ED3;&#x5E93;&#x5730;&#x5740;</span><br><span class=\"line\">  branch: master</span><br><span class=\"line\">- type: git</span><br><span class=\"line\">  # repository: git@rousetime.com:/~/blog.git # &#x9ED8;&#x8BA4;&#x7AEF;&#x53E3;&#x751F;&#x6548;&#x4F7F;&#x7528;</span><br><span class=\"line\">  # repository: ssh://git@rousetime.com:&#x7AEF;&#x53E3;/~/blog.git # &#x9ED8;&#x8BA4;&#x7AEF;&#x53E3;&#x4E0D;&#x751F;&#x6548;&#x4F7F;&#x7528;&#xFF0C;&#x8BBE;&#x7F6E;&#x7AEF;&#x53E3;</span><br><span class=\"line\">  branch: master</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x5C06;hexo&#x76F8;&#x5173;&#x914D;&#x7F6E;&#x4E2D;&#x7684;github.io&#x57DF;&#x540D;&#x90FD;&#x6362;&#x6210;&#x4F60;&#x81EA;&#x5DF1;&#x7684;</p>\n</blockquote>\n<p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x518D;&#x63D0;&#x4EA4;&#x4E00;&#x904D;hexo&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo clean</span><br><span class=\"line\">hexo g</span><br><span class=\"line\">heox d</span><br></pre></td></tr></table></figure>\n<p>&#x64CD;&#x4F5C;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;git&#x5C06;&#x4EE3;&#x7801;push&#x5230;&#x4E4B;&#x524D;&#x7684;github&#x4ED3;&#x5E93;&#x4E0E;&#x6211;&#x4EEC;&#x7684;&#x642D;&#x5EFA;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4ED3;&#x5E93;&#x3002;</p>\n<p>&#x90E8;&#x7F72;&#x5B8C;&#x6BD5;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x8F93;&#x5165;&#x57DF;&#x540D;&#x8FDB;&#x884C;&#x8BBF;&#x95EE;&#x3002;&#x4F8B;&#x5982;&#xFF1A;&#x8FD9;&#x662F;&#x6211;&#x7684;<a href=\"https://www.rousetime.com\">blog&#x5730;&#x5740;</a>&#x6B22;&#x8FCE;&#x8BBF;&#x95EE;&#x3002;</p>\n<p>&#x8FD9;&#x5C31;&#x662F;&#x6211;&#x6298;&#x817E;&#x4E86;&#x4E00;&#x5929;&#x642D;&#x5EFA;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x5E0C;&#x671B;&#x5BF9;&#x4F60;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#x3002;&#x5982;&#x6709;&#x4EFB;&#x4F55;&#x95EE;&#x9898;&#x53EF;&#x4EE5;&#x968F;&#x65F6;@&#x6211;&#x3002;</p>\n<h2 id=\"&#x8D44;&#x6599;\"><a href=\"#&#x8D44;&#x6599;\" class=\"headerlink\" title=\"&#x8D44;&#x6599;\"></a>&#x8D44;&#x6599;</h2><p><a href=\"http://www.voidcn.com/article/p-zqxjbnjm-brx.html\" target=\"_blank\" rel=\"noopener\">SSH&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;</a><br><a href=\"https://git-scm.com/book/zh/v2/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84-Git-%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E6%90%AD%E5%BB%BA-Git\" target=\"_blank\" rel=\"noopener\">&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684; Git</a><br><a href=\"https://hexo.io/zh-cn/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">hexo&#x90E8;&#x7F72;</a><br><a href=\"https://www.binarytides.com/setup-epel-repository-centos/\" target=\"_blank\" rel=\"noopener\">EPEL</a><br><a href=\"https://unix.stackexchange.com/questions/165916/trying-to-enable-epel-on-centos-6-and-it-wont-show-in-repolist\" target=\"_blank\" rel=\"noopener\">EPEL&#x672A;&#x6FC0;&#x6D3B;&#x89E3;&#x51B3;&#x65B9;&#x6848;</a><br><a href=\"https://teddysun.com/342.html\" target=\"_blank\" rel=\"noopener\">Shadowsocks Python&#x7248;&#x4E00;&#x952E;&#x5B89;&#x88C5;&#x811A;&#x672C;</a></p>\n<p><img src=\"/2019/01/06/vps&#x643A;&#x624B;hexo&#x7684;&#x535A;&#x5BA2;&#x642D;&#x5EFA;&#x4E4B;&#x65C5;/wx_qr_code.png\" alt></p>\n","categories":["hexo"],"tags":["hexo"]},{"title":"你不该忽略的LaunchMode","url":"https://www.rousetime.com/2019/01/03/你不该忽略的LaunchMode/","content":"<p>&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x597D;&#x7684;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#xFF0C;&#x4E0D;&#x5E94;&#x8BE5;&#x5FFD;&#x89C6;&#x6389;Activity&#x7684;&#x542F;&#x52A8;&#x65B9;&#x5F0F;launchMode&#x3002;&#x6BCF;&#x6B21;&#x65B0;&#x5EFA;Activity&#x65F6;&#xFF0C;&#x5185;&#x5FC3;&#x90FD;&#x8981;&#x95EE;&#x95EE;&#x81EA;&#x5DF1;&#x8FD9;&#x4E2A;&#x754C;&#x9762;&#x542F;&#x52A8;&#x573A;&#x666F;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x5B83;&#x5E94;&#x8BE5;&#x9002;&#x5E94;&#x4E8E;&#x54EA;&#x79CD;&#x542F;&#x52A8;&#x65B9;&#x5F0F;&#xFF1F;&#x5982;&#x679C;&#x8981;&#x5FEB;&#x901F;&#x7075;&#x6D3B;&#x7684;&#x89E3;&#x51B3;&#x4E0A;&#x8FF0;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5BF9;launchMode&#x7684;&#x56DB;&#x79CD;&#x542F;&#x52A8;&#x65B9;&#x5F0F;&#x4E86;&#x7136;&#x4E8E;&#x80F8;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4F1A;&#x9010;&#x4E00;&#x901A;&#x8FC7;&#x7B80;&#x6D01;&#x7684;&#x8BED;&#x8A00;&#x4ECB;&#x7ECD;&#x5B83;&#x4EEC;&#x7684;&#x610F;&#x4E49;&#xFF0C;&#x540C;&#x65F6;&#x4F7F;&#x7528;&#x4E00;&#x53E5;&#x8BDD;&#x6765;&#x603B;&#x7ED3;&#x5B83;&#x4EEC;&#x5404;&#x81EA;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x8FC5;&#x901F;&#x4E86;&#x7136;&#x4E8E;&#x80F8;&#x3002;</p>\n<h2 id=\"standard\"><a href=\"#standard\" class=\"headerlink\" title=\"standard\"></a>standard</h2><p>&#x5982;&#x679C;&#x4E0D;&#x5BF9;&#x65B0;&#x5EFA;&#x7684;Activity&#x4E0D;&#x505A;&#x4EFB;&#x4F55;&#x4FEE;&#x6539;&#xFF0C;&#x5B83;&#x5728;&#x6E05;&#x5355;&#x6587;&#x4EF6;&#x4E2D;&#x9ED8;&#x8BA4;&#x7684;launchMode&#x4E3A;standard</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;activity </span><br><span class=\"line\">\tandroid:name=<span class=\"string\">&quot;.MainActivity&quot;</span></span><br><span class=\"line\">\tandroid:launchMode=<span class=\"string\">&quot;standard&quot;</span>&gt;</span><br><span class=\"line\">&lt;/activity&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x4EA6;&#x6216;&#x8005;&#x76F4;&#x63A5;&#x6CA1;&#x6709;launchMode&#xFF0C;&#x4F46;&#x5185;&#x90E8;&#x9ED8;&#x8BA4;&#x8FD8;&#x662F;standard&#x3002;&#x5927;&#x5BB6;&#x90FD;&#x77E5;&#x9053;&#x6211;&#x4EEC;&#x542F;&#x52A8;&#x7684;Activity&#x7684;&#x4FDD;&#x5B58;&#x5728;stack&#x4E2D;&#xFF0C;&#x5047;&#x8BBE;&#x5F53;&#x524D;Activity&#x5806;&#x6808;&#x4E3A;</p>\n<ul>\n<li>D</li>\n<li>C</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x6B64;&#x65F6;&#x6211;&#x4E3A;B&#x6DFB;&#x52A0;launchMode=&#x201D;standard&#x201D;&#xFF0C;&#x5E76;&#x4E14;&#x5728;D&#x4E2D;&#x542F;&#x52A8;B&#xFF0C;&#x6B64;&#x65F6;Activity&#x5806;&#x6808;&#x4E3A;</p>\n<ul>\n<li>B &#xFF08;&#x65B0;&#x7684;&#x5B9E;&#x4F8B;B&#xFF09;</li>\n<li>D</li>\n<li>C</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x6240;&#x4EE5;standard&#x6A21;&#x5F0F;&#x8868;&#x73B0;&#x4E3A;&#xFF1A;<strong>&#x4E0D;&#x5173;&#x5FC3;&#x5F53;&#x524D;Activity&#x5806;&#x6808;&#xFF0C;&#x5B83;&#x603B;&#x4F1A;&#x65B0;&#x589E;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x52A0;&#x5165;&#x5F53;&#x524D;&#x5806;&#x6808;&#x4E2D;</strong>&#x3002;</p>\n<h2 id=\"singleTop\"><a href=\"#singleTop\" class=\"headerlink\" title=\"singleTop\"></a>singleTop</h2><p>1.&#x8FD8;&#x662F;&#x4E4B;&#x524D;&#x7684;Activity&#x5806;&#x6808;</p>\n<ul>\n<li>D</li>\n<li>C</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x73B0;&#x5728;&#x6211;&#x5BF9;C&#x6DFB;&#x52A0;launchMode=&#x201D;singleTop&#x201D;&#xFF0C;&#x5E76;&#x5728;D&#x4E2D;&#x542F;&#x52A8;C&#xFF0C;&#x6B64;&#x65F6;&#x7684;Activity&#x5806;&#x6808;&#x4E3A;</p>\n<ul>\n<li>C &#xFF08;&#x65B0;&#x7684;&#x5B9E;&#x4F8B;C&#xFF09;</li>\n<li>D</li>\n<li>C</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x8868;&#x73B0;&#x65B9;&#x5F0F;&#x4E0E;&#x9ED8;&#x8BA4;&#x7684;standard&#x6A21;&#x5F0F;&#x4E00;&#x81F4;</p>\n<p>2.&#x5982;&#x679C;&#x6211;&#x5C06;&#x4E4B;&#x524D;&#x7684;Activity&#x5806;&#x6808;&#x7A0D;&#x4F5C;&#x4FEE;&#x6539;</p>\n<ul>\n<li>C</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x518D;&#x6B21;&#x542F;&#x52A8;C&#xFF0C;&#x6B64;&#x65F6;Activity&#x5806;&#x6808;&#x4E3A;</p>\n<ul>\n<li>C &#xFF08;&#x4E4B;&#x524D;&#x7684;&#x5B9E;&#x4F8B;C&#xFF0C;&#x65B0;&#x7684;intent&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;onNewIntent&#x83B7;&#x53D6;&#xFF09;</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>3.&#x5982;&#x679C;&#x4E4B;&#x524D;&#x7684;Activity&#x5806;&#x6808;&#x4E2D;&#x6CA1;&#x6709;C</p>\n<ul>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x518D;&#x6B21;&#x542F;&#x52A8;C&#xFF0C;&#x6B64;&#x65F6;Activity&#x5806;&#x6808;&#x4E3A;</p>\n<ul>\n<li>C &#xFF08;&#x65B0;&#x7684;&#x5B9E;&#x4F8B;C&#xFF09;</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x8868;&#x73B0;&#x65B9;&#x5F0F;&#x4E0E;&#x9ED8;&#x8BA4;&#x7684;standard&#x6A21;&#x5F0F;&#x4E00;&#x81F4;</p>\n<p>&#x6240;&#x4EE5;singleTop&#x6A21;&#x5F0F;&#x8868;&#x73B0;&#x4E3A;&#xFF1A;<strong>&#x53EA;&#x5173;&#x5FC3;&#x5F53;&#x524D;Activity&#x5806;&#x6808;&#x7684;&#x6808;&#x9876;&#x662F;&#x5426;&#x5B58;&#x5728;&#x5B83;&#x7684;&#x7C7B;&#x578B;&#x5B9E;&#x4F8B;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x5219;&#x4E0D;&#x65B0;&#x5EFA;&#x5B9E;&#x4F8B;&#xFF1B;&#x5426;&#x5219;&#x65B0;&#x5EFA;&#x5B9E;&#x4F8B;</strong></p>\n<h2 id=\"singleTask\"><a href=\"#singleTask\" class=\"headerlink\" title=\"singleTask\"></a>singleTask</h2><p>1.&#x5F53;&#x524D;Activity&#x5806;&#x6808;&#x4E3A;</p>\n<ul>\n<li>D</li>\n<li>C</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x73B0;&#x5728;&#x6211;&#x5BF9;C&#x6DFB;&#x52A0;launchMode=&#x201D;singleTask&#x201D;&#xFF0C;&#x5E76;&#x5728;D&#x4E2D;&#x542F;&#x52A8;C&#xFF0C;&#x6B64;&#x65F6;Activity&#x5806;&#x6808;&#x4E3A;</p>\n<ul>\n<li>C &#xFF08;&#x4E4B;&#x524D;&#x7684;&#x5B9E;&#x4F8B;C&#xFF0C;&#x65B0;&#x7684;intent&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;onNewIntent&#x83B7;&#x53D6;&#xFF09;</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>D&#x4F1A;&#x88AB;&#x4ECE;Activity&#x5806;&#x6808;&#x4E2D;&#x79FB;&#x9664;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x590D;&#x7528;&#x4E4B;&#x524D;&#x7684;&#x5B9E;&#x4F8B;</p>\n<p>2.&#x5F53;&#x524D;Activity&#x5806;&#x6808;&#x4E3A;</p>\n<ul>\n<li>C</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x518D;&#x6B21;&#x542F;&#x52A8;C&#xFF0C;&#x6B64;&#x65F6;Activity&#x5806;&#x6808;&#x4E3A;</p>\n<ul>\n<li>C &#xFF08;&#x4E4B;&#x524D;&#x7684;&#x5B9E;&#x4F8B;C&#xFF0C;&#x65B0;&#x7684;intent&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;onNewIntent&#x83B7;&#x53D6;&#xFF09;</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x8868;&#x73B0;&#x65B9;&#x5F0F;&#x4E0E;singlTop&#x6A21;&#x5F0F;&#x4E00;&#x81F4;</p>\n<p>3.&#x5F53;&#x524D;Activity&#x5806;&#x6808;&#x4E3A;</p>\n<ul>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x518D;&#x6B21;&#x542F;&#x52A8;C&#xFF0C;&#x6B64;&#x65F6;Activity&#x5806;&#x6808;&#x4E3A;</p>\n<ul>\n<li>C &#xFF08;&#x65B0;&#x7684;&#x5B9E;&#x4F8B;C&#xFF09;</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x8868;&#x73B0;&#x65B9;&#x5F0F;&#x4E0E;&#x9ED8;&#x8BA4;&#x7684;standard&#x6A21;&#x5F0F;&#x4E00;&#x81F4;</p>\n<p>&#x6240;&#x4EE5;singleTask&#x8868;&#x73B0;&#x4E3A;&#xFF1A;<strong>&#x53EA;&#x5173;&#x5FC3;&#x5F53;&#x524D;Activity&#x5806;&#x6808;&#x4E2D;&#x662F;&#x5426;&#x5B58;&#x5728;&#x5B83;&#x7684;&#x7C7B;&#x578B;&#x5B9E;&#x4F8B;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x5219;&#x5148;&#x5C06;&#x5B83;&#x9876;&#x90E8;&#x6240;&#x6709;&#x5806;&#x6808;&#x5B9E;&#x4F8B;&#x51FA;&#x6808;&#xFF0C;&#x4F7F;&#x5176;&#x56DE;&#x5230;&#x6808;&#x9876;&#xFF0C;&#x518D;&#x590D;&#x7528;&#x5F53;&#x524D;&#x6808;&#x9876;&#x5B9E;&#x4F8B;&#xFF0C;&#x5426;&#x5219;&#x65B0;&#x5EFA;&#x5B9E;&#x4F8B;</strong></p>\n<h2 id=\"singleInstance\"><a href=\"#singleInstance\" class=\"headerlink\" title=\"singleInstance\"></a>singleInstance</h2><p>1.&#x5F53;&#x524D;Activity&#x5806;&#x6808;&#x4E3A;</p>\n<ul>\n<li>D</li>\n<li>C</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x73B0;&#x5728;&#x6211;&#x4E3A;E&#x6DFB;&#x52A0;launchMode=&#x201D;singleInstance&#x201D;&#xFF0C;&#x7136;&#x540E;&#x5728;D&#x4E2D;&#x542F;&#x52A8;E&#xFF0C;&#x6B64;&#x65F6;Activity&#x5806;&#x6808;&#x4E3A;</p>\n<p>&#x7B2C;&#x4E00;&#x4E2A;Activity&#x5806;&#x6808;</p>\n<ul>\n<li>D</li>\n<li>C</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x7B2C;&#x4E8C;&#x4E2A;Activity&#x5806;&#x6808;</p>\n<ul>\n<li>E</li>\n</ul>\n<p>&#x4F60;&#x4F1A;&#x53D1;&#x73B0;E&#x4E0D;&#x5B58;&#x5728;&#x4E8E;&#x4E4B;&#x524D;&#x7684;&#x5806;&#x6808;&#x4E2D;&#xFF0C;&#x800C;&#x662F;&#x65B0;&#x5F00;&#x4E00;&#x4E2A;Activity&#x5806;&#x6808;&#x3002;</p>\n<p>2.&#x5982;&#x679C;&#x5728;1&#x7684;&#x7ED3;&#x679C;&#x57FA;&#x7840;&#x4E0A;&#xFF0C;&#x6211;&#x5728;E&#x4E2D;&#x7EE7;&#x7EED;&#x542F;&#x52A8;F&#xFF0C;&#x6B64;&#x65F6;Activity&#x5806;&#x6808;&#x4E3A;</p>\n<p>&#x7B2C;&#x4E00;&#x4E2A;Activity&#x5806;&#x6808;</p>\n<ul>\n<li>F</li>\n<li>D</li>\n<li>C</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x7B2C;&#x4E8C;&#x4E2A;Activity&#x5806;&#x6808;</p>\n<ul>\n<li>E</li>\n</ul>\n<p>&#x540E;&#x7EED;&#x542F;&#x52A8;&#x7684;&#x5B9E;&#x4F8B;&#x8FD8;&#x662F;&#x4F1A;&#x52A0;&#x5165;&#x5230;&#x4E4B;&#x524D;&#x7684;Activity&#x5806;&#x6808;&#x4E2D;&#x3002;</p>\n<p>3.&#x5F53;&#x524D;Activity&#x5806;&#x6808;&#x4E3A;</p>\n<p>&#x7B2C;&#x4E00;&#x4E2A;Activity&#x5806;&#x6808;</p>\n<ul>\n<li>D</li>\n<li>C</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x7B2C;&#x4E8C;&#x4E2A;Activity&#x5806;&#x6808;</p>\n<ul>\n<li>E</li>\n</ul>\n<p>&#x73B0;&#x5728;&#x6211;&#x5728;D&#x4E2D;&#x542F;&#x52A8;E&#xFF0C;&#x6B64;&#x65F6;Activity&#x5806;&#x6808;&#x4E3A;</p>\n<p>&#x7B2C;&#x4E00;&#x4E2A;Activity&#x5806;&#x6808;</p>\n<ul>\n<li>D</li>\n<li>C</li>\n<li>B</li>\n<li>A</li>\n</ul>\n<p>&#x7B2C;&#x4E8C;&#x4E2A;Activity&#x5806;&#x6808;</p>\n<ul>\n<li>E &#xFF08;&#x4E4B;&#x524D;&#x7684;&#x5B9E;&#x4F8B;E&#xFF0C;&#x65B0;&#x7684;intent&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;onNewIntent&#x83B7;&#x53D6;&#xFF09;</li>\n</ul>\n<p>E&#x5DF2;&#x7ECF;&#x5904;&#x4E8E;&#x5355;&#x72EC;&#x7684;Activity&#x5806;&#x6808;&#x4E2D;&#xFF0C;&#x4E0D;&#x4F1A;&#x518D;&#x65B0;&#x5EFA;&#x5B9E;&#x4F8B;</p>\n<p>&#x6240;&#x4EE5;singleInstance&#x8868;&#x73B0;&#x4E3A;&#xFF1A;<strong>&#x53EA;&#x5173;&#x5FC3;&#x81EA;&#x5DF1;&#x662F;&#x5426;&#x5904;&#x4E8E;&#x5355;&#x72EC;&#x7684;Activity&#x5806;&#x6808;&#x4E2D;&#xFF0C;&#x5373;&#x5806;&#x6808;&#x4E2D;&#x53EA;&#x80FD;&#x6709;&#x5B83;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#xFF0C;&#x4E5F;&#x4E0D;&#x65B0;&#x52A0;&#x5176;&#x5B83;&#x5B9E;&#x4F8B;&#xFF1B;&#x5426;&#x5219;&#x65B0;&#x5F00;Activity&#x5806;&#x6808;</strong></p>\n<h2 id=\"End\"><a href=\"#End\" class=\"headerlink\" title=\"End\"></a>End</h2><p>&#x5E0C;&#x671B;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x4F60;&#x5DF2;&#x7ECF;&#x5BF9;&#x8FD9;&#x56DB;&#x79CD;&#x542F;&#x52A8;&#x6A21;&#x5F0F;&#x6709;&#x4E86;&#x5168;&#x65B0;&#x7684;&#x7406;&#x89E3;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x6211;&#x60F3;&#x95EE;&#x7684;&#x662F;&#xFF1A;&#x4F60;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x4E86;&#x7136;&#x4E8E;&#x80F8;&#x4E86;&#xFF1F;</p>\n<p><img src=\"/2019/01/03/&#x4F60;&#x4E0D;&#x8BE5;&#x5FFD;&#x7565;&#x7684;LaunchMode/wx_qr_code.png\" alt></p>\n","categories":["android"],"tags":["interview"]},{"title":"React Native Fetch封装那点事...","url":"https://www.rousetime.com/2018/08/28/React-Native-Fetch封装那点事/","content":"<p>&#x6BCF;&#x4E00;&#x95E8;&#x8BED;&#x8A00;&#x90FD;&#x79BB;&#x4E0D;&#x5F00;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x4E00;&#x5957;Networking Api&#x3002;React Native&#x4F7F;&#x7528;&#x7684;&#x662F;Fetch&#x3002;    &#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x6765;&#x8C08;&#x8C08;&#x4E0E;Fetch&#x76F8;&#x5173;&#x7684;&#x4E00;&#x4E9B;&#x4E8B;&#x60C5;&#x3002;</p>\n<h2 id=\"purpose\"><a href=\"#purpose\" class=\"headerlink\" title=\"purpose\"></a>purpose</h2><p>&#x901A;&#x8FC7;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x4F60;&#x5C06;&#x4E86;&#x89E3;&#x5230;&#x4EE5;&#x4E0B;&#x51E0;&#x70B9;&#x5173;&#x4E8E;Fetch&#x7684;&#x72EC;&#x5BB6;&#x62A5;&#x9053;</p>\n<ul>\n<li>Fetch&#x7684;&#x7B80;&#x5355;&#x8FD0;&#x7528;</li>\n<li>Fetch&#x7684;&#x4E3B;&#x8981;Api</li>\n<li>Fetch&#x4F7F;&#x7528;&#x6CE8;&#x610F;&#x4E8B;&#x9879;</li>\n<li>Fetch&#x7684;Promise&#x5C01;&#x88C5;</li>\n</ul>\n<h2 id=\"fetch\"><a href=\"#fetch\" class=\"headerlink\" title=\"fetch\"></a>fetch</h2><p>fetch&#x7684;&#x4F7F;&#x7528;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x9700;&#x4F20;&#x5165;&#x8BF7;&#x6C42;&#x7684;url</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fetch(&apos;https://facebook.github.io/react-native/movies.json&apos;);</span><br></pre></td></tr></table></figure>\n<p>&#x5F53;&#x7136;&#x662F;&#x5426;&#x8BF7;&#x6C42;&#x6210;&#x529F;&#x4E0E;&#x6570;&#x636E;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x5904;&#x7406;&#x6210;&#x529F;&#x4E0E;&#x5931;&#x8D25;&#x7684;&#x56DE;&#x8C03;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function getMoviesFromApiAsync() {</span><br><span class=\"line\">  return fetch(&apos;https://facebook.github.io/react-native/movies.json&apos;)</span><br><span class=\"line\">    .then((response) =&gt; response.json())</span><br><span class=\"line\">    .then((responseJson) =&gt; {</span><br><span class=\"line\">      return responseJson.movies;</span><br><span class=\"line\">    })</span><br><span class=\"line\">    .catch((error) =&gt; {</span><br><span class=\"line\">      console.error(error);</span><br><span class=\"line\">    });</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;response.json()&#x5C06;&#x8BF7;&#x6C42;&#x7684;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x8F6C;&#x5316;&#x6210;json&#x6570;&#x636E;&#x4EE5;&#x4FBF;&#x4F7F;&#x7528;&#x3002;&#x901A;&#x8FC7;<code>.then</code>&#x6765;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x8F6C;&#x5316;&#x5904;&#x7406;&#x6216;&#x6700;&#x7EC8;&#x66B4;&#x9732;&#x7ED9;&#x8C03;&#x7528;&#x8005;&#xFF1B;<code>.catch</code>&#x5BF9;&#x5F02;&#x5E38;&#x7684;&#x5904;&#x7406;&#x3002;</p>\n<p>&#x4EE5;&#x4E0A;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x8BE5;&#x8BF7;&#x6C42;&#x9ED8;&#x8BA4;&#x662F;get&#x65B9;&#x5F0F;&#x3002;&#x90A3;&#x4E48;post&#x53C8;&#x8BE5;&#x5982;&#x4F55;&#x8BF7;&#x6C42;&#x5462;&#xFF1F;</p>\n<h2 id=\"Api-amp-Note\"><a href=\"#Api-amp-Note\" class=\"headerlink\" title=\"Api &amp; Note\"></a>Api &amp; Note</h2><p>&#x5728;fetch&#x4E2D;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x4F20;&#x5165;url&#x8FDB;&#x884C;&#x8BF7;&#x6C42;&#xFF0C;&#x5176;&#x5B9E;&#x5185;&#x90E8;&#x672C;&#x8D28;&#x662F;&#x4F7F;&#x7528;&#x4E86;Request&#x5BF9;&#x8C61;&#xFF0C;&#x53EA;&#x662F;&#x5C06;url&#x51FA;&#x5165;&#x5230;&#x4E86;Request&#x5BF9;&#x8C61;&#x4E2D;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const myRequest = new Request(&apos;https://facebook.github.io/react-native/movies.json&apos;);</span><br><span class=\"line\"> </span><br><span class=\"line\">const myURL = myRequest.url; // https://facebook.github.io/react-native/movies.jsonflowers.jpg</span><br><span class=\"line\">const myMethod = myRequest.method; // GET</span><br><span class=\"line\"> </span><br><span class=\"line\">fetch(myRequest)</span><br><span class=\"line\">  .then(response =&gt; response.json())</span><br><span class=\"line\">  .then(responseJson =&gt; {</span><br><span class=\"line\">    //todo</span><br><span class=\"line\">  });</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8BF7;&#x6C42;post&#xFF0C;&#x9700;&#x8981;&#x6539;&#x53D8;Request&#x7684;method&#x5C5E;&#x6027;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fetch(&apos;https://mywebsite.com/endpoint/&apos;, {</span><br><span class=\"line\">  method: &apos;POST&apos;,</span><br><span class=\"line\">  headers: {</span><br><span class=\"line\">    Accept: &apos;application/json&apos;,</span><br><span class=\"line\">    &apos;Content-Type&apos;: &apos;application/json&apos;,</span><br><span class=\"line\">  },</span><br><span class=\"line\">  body: JSON.stringify({</span><br><span class=\"line\">    firstParam: &apos;yourValue&apos;,</span><br><span class=\"line\">    secondParam: &apos;yourOtherValue&apos;,</span><br><span class=\"line\">  }),</span><br><span class=\"line\">});</span><br></pre></td></tr></table></figure>\n<p>&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x5728;url&#x540E;&#x76F4;&#x63A5;&#x4F20;&#x5165;{}&#x5BF9;&#x8C61;&#xFF0C;&#x5176;&#x4E2D;&#x6307;&#x5B9A;method&#x4F7F;&#x7528;post&#x3002;</p>\n<p>&#x76F8;&#x4FE1;&#x5927;&#x5BB6;&#x5E94;&#x8BE5;&#x90FD;&#x77E5;&#x9053;get&#x4E0E;post&#x7684;&#x4E00;&#x4E2A;&#x4E3B;&#x8981;&#x533A;&#x522B;&#x662F;get&#x53EF;&#x4EE5;&#x5728;url&#x4E0A;&#x76F4;&#x63A5;&#x6DFB;&#x52A0;&#x53C2;&#x6570;&#xFF0C;&#x800C;post&#x4E3A;&#x4E86;&#x5B89;&#x5168;&#x90FD;&#x4E0D;&#x91C7;&#x7528;&#x76F4;&#x63A5;&#x5C06;&#x53C2;&#x6570;&#x8FFD;&#x52A0;&#x5230;url&#x4E0A;&#xFF0C;&#x800C;&#x662F;&#x4F7F;&#x7528;body&#x6765;&#x4F20;&#x7ED9;service&#x7AEF;&#x3002;</p>\n<p>&#x5728;&#x4F7F;&#x7528;body&#x524D;&#xFF0C;&#x8FD9;&#x91CC;&#x8FD8;&#x9700;&#x77E5;&#x9053;headers&#x3002;&#x4E0B;&#x9762;&#x67D0;&#x4E2A;post&#x8BF7;&#x6C42;&#x7684;headers&#x4FE1;&#x606F;</p>\n<p><img src=\"/2018/08/28/React-Native-Fetch&#x5C01;&#x88C5;&#x90A3;&#x70B9;&#x4E8B;/fetch_headers.jpg\" alt></p>\n<blockquote>\n<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;Content-Type&#x5B57;&#x6BB5;&#xFF0C;&#x5B83;&#x4EE3;&#x8868;&#x7684;&#x662F;service&#x7AEF;&#x63A5;&#x6536;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x56FE;&#x7247;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x662F;application/x-www-form-urlencoded&#x3002;&#x8FD9;&#x5BF9;&#x4E8E;&#x6211;&#x4EEC;&#x7684;body&#x6765;&#x8BF4;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x3002;&#x53EA;&#x6709;&#x5339;&#x914D;Content-Type&#x7684;&#x7C7B;&#x578B;&#x624D;&#x80FD;&#x6B63;&#x786E;&#x7684;&#x4F20;&#x9012;&#x53C2;&#x6570;&#x4FE1;&#x606F;&#x3002;</p>\n</blockquote>\n<p>&#x793A;&#x4F8B;&#x7684;&#x4EE3;&#x7801;&#x4F7F;&#x7528;&#x7684;&#x662F;application/json&#xFF0C;&#x6240;&#x4EE5;body&#x4F7F;&#x7528;Json.stringify()&#x8FDB;&#x884C;&#x53C2;&#x6570;&#x8F6C;&#x6362;&#xFF0C;&#x800C;&#x5BF9;&#x4E8E;Content-Type&#x4E3A;application/x-www-form-urlencoded&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;queryString.stringify()&#x3002;</p>\n<p>Request&#x4E2D;&#x9664;&#x4E86;method&#x3001;headers&#x4E0E;body&#xFF0C;&#x8FD8;&#x6709;&#x4EE5;&#x4E0B;&#x5C5E;&#x6027;</p>\n<ul>\n<li>Request.cache: &#x8BF7;&#x6C42;&#x7684;&#x7F13;&#x5B58;&#x6A21;&#x5F0F;(default/reload/no-cache)</li>\n<li>Request.context: &#x8BF7;&#x6C42;&#x7684;&#x4E0A;&#x4E0B;&#x6587;(audio/image/iframe)</li>\n<li>Request.credentials: &#x8BF7;&#x6C42;&#x7684;&#x8BC1;&#x4E66;(omit/same-origin/include)</li>\n<li>Request.destination: &#x8BF7;&#x6C42;&#x7684;&#x5185;&#x5BB9;&#x63CF;&#x8FF0;&#x7C7B;&#x578B;</li>\n<li>Request.integrity: &#x8BF7;&#x6C42;&#x7684; subresource integrity </li>\n<li>Request.mode: &#x8BF7;&#x6C42;&#x7684;&#x6A21;&#x5F0F;(cors/no-cors/same-origin/navigate)</li>\n<li>Request.redirect: &#x8BF7;&#x6C42;&#x7684;&#x91CD;&#x5B9A;&#x5411;&#x65B9;&#x5F0F;(follow/error/manual)</li>\n<li>Request.referrer: &#x8BF7;&#x6C42;&#x7684;&#x6765;&#x6E90;(client)</li>\n<li>Request.referrerPolicy: &#x8BF7;&#x6C42;&#x7684;&#x6765;&#x6E90;&#x653F;&#x7B56;(no-referrer)</li>\n<li>Request.bodyUsed: &#x58F0;&#x660E;body&#x662F;&#x5426;&#x4F7F;&#x7528;&#x5728;response&#x4E2D;</li>\n</ul>\n<p>&#x8BF7;&#x6C42;&#x6210;&#x529F;&#x4E4B;&#x540E;&#xFF0C;&#x4F7F;&#x7528;.then&#x6765;&#x8F6C;&#x6362;&#x6570;&#x636E;&#xFF0C;&#x4F7F;&#x7528;&#x6700;&#x591A;&#x7684;&#x662F;Body.json()&#xFF0C;&#x5F53;&#x7136;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x7684;&#x51E0;&#x79CD;&#x6570;&#x636E;&#x8F6C;&#x6362;&#x7C7B;&#x578B;</p>\n<ul>\n<li>Body.arrayBuffer</li>\n<li>Body.blob</li>\n<li>Body.formData</li>\n<li>Body.text</li>\n</ul>\n<p>&#x4EE5;&#x4E0A;&#x662F;fetch&#x8BF7;&#x6C42;&#x76F8;&#x5173;&#x7684;&#x5C5E;&#x6027;&#x4E0E;&#x65B9;&#x6CD5;&#x3002;&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x6709;&#x6240;&#x4E86;&#x89E3;&#xFF0C;&#x90A3;&#x4E48;&#x606D;&#x559C;&#x4F60;&#x5BF9;fetch&#x7684;&#x57FA;&#x672C;&#x4F7F;&#x7528;&#x5DF2;&#x7ECF;&#x8FC7;&#x5173;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x5BF9;fetch&#x7684;&#x4F7F;&#x7528;&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#x3002;</p>\n<h2 id=\"&#x5C01;&#x88C5;\"><a href=\"#&#x5C01;&#x88C5;\" class=\"headerlink\" title=\"&#x5C01;&#x88C5;\"></a>&#x5C01;&#x88C5;</h2><p>&#x5728;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;url&#x7684;host&#x90FD;&#x662F;&#x76F8;&#x540C;&#x7684;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x8BF7;&#x6C42;&#x7684;&#x65B9;&#x6CD5;&#x540D;&#x4E0E;&#x53C2;&#x6570;&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x73AF;&#x5883;(debug|release)&#x8BF7;&#x6C42;&#x7684;&#x65B9;&#x5F0F;&#x4E5F;&#x53EF;&#x80FD;&#x4E0D;&#x540C;&#x3002;&#x4F8B;&#x5982;&#xFF1A;&#x5728;debug&#x73AF;&#x5883;&#x4E2D;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x8C03;&#x8BD5;&#x67E5;&#x770B;&#x8BF7;&#x6C42;&#x7684;&#x53C2;&#x6570;&#x662F;&#x5426;&#x6B63;&#x786E;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x4F7F;&#x7528;get&#x6765;&#x8FDB;&#x884C;&#x8BF7;&#x6C42;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x5C01;&#x88C5;&#x4E4B;&#x524D;&#x8981;&#x660E;&#x786E;&#x4EC0;&#x4E48;&#x662F;&#x4E0D;&#x53D8;&#x7684;&#xFF0C;&#x4EC0;&#x4E48;&#x662F;&#x53D8;&#x5316;&#x7684;&#xFF0C;&#x6210;&#x529F;&#x4E0E;&#x5931;&#x8D25;&#x7684;&#x54CD;&#x5E94;&#x5904;&#x7406;&#x3002;</p>\n<p>&#x7ECF;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x7F57;&#x5217;&#x4E00;&#x4E0B;&#x5C01;&#x88C5;&#x9700;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x3002;</p>\n<ul>\n<li>&#x4E0D;&#x53D8;&#x7684;: host,headers,body.json()</li>\n<li>&#x53D8;&#x5316;&#x7684;: url,method,body</li>\n<li>&#x54CD;&#x5E94;&#x65B9;&#x5F0F;: Promise(resolve/reject)</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function convertUrl(url, params) {</span><br><span class=\"line\">    let realUrl = ApiModule.isDebug?</span><br><span class=\"line\">        url + &quot;?&quot; + queryString.stringify(Object.assign({}, params, commonParams)) : url;</span><br><span class=\"line\"></span><br><span class=\"line\">    if (ApiModule.isDebug) {</span><br><span class=\"line\">        console.log(&quot;request: &quot; + realUrl);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return realUrl;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x9996;&#x5148;&#x5BF9;url&#x4E0E;&#x53C2;&#x6570;params&#x8FDB;&#x884C;&#x62FC;&#x63A5;&#xFF0C;&#x5982;&#x679C;&#x4E3A;debug&#x6A21;&#x5F0F;&#x5C06;params&#x62FC;&#x63A5;&#x5230;url&#x540E;&#x3002;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x5230;&#x4E86;Object.assign()&#x5C06;params&#x4E0E;commonParams&#x7EC4;&#x5408;&#x6210;&#x4E00;&#x4E2A;{}&#x5BF9;&#x8C61;&#x3002;&#x6700;&#x7EC8;&#x901A;&#x8FC7;queryString.stringify&#x8F6C;&#x5316;&#x6210;string&#x3002;</p>\n<blockquote>\n<p>ApiModule.isDebug&#x662F;&#x539F;&#x751F;&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;&#x503C;&#xFF0C;&#x5BF9;&#x4E8E;Android/IOS&#x53EA;&#x9700;&#x4F20;&#x9012;&#x81EA;&#x5DF1;&#x7684;ApiModule&#x5373;&#x53EF;&#x3002;</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function getMethod() {</span><br><span class=\"line\">    return ApiModule.isDebug? &quot;get&quot;: &quot;post&quot;;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x8FF0;&#x63D0;&#x5230;&#x7684;get&#x4E0E;post&#x7684;&#x8BF7;&#x6C42;&#x65F6;&#x673A;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const headers = {</span><br><span class=\"line\">    Accept: &apos;application/json&apos;,</span><br><span class=\"line\">    &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded;charset=UTF-8&quot;</span><br><span class=\"line\">};</span><br></pre></td></tr></table></figure>\n<p>&#x5728;headers&#x4E2D;Content-Type&#x7C7B;&#x578B;&#x4E3A;application/x-www-form-urlencode</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function convertBody(params) {</span><br><span class=\"line\">    return ApiModule.isDebug? undefined : queryString.stringify(Object.assign({}, params, commonParams));</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x7531;&#x4E8E;debug&#x6A21;&#x5F0F;&#x4F7F;&#x7528;&#x7684;&#x662F;get&#x65B9;&#x5F0F;&#xFF0C;&#x4F46;get&#x89C4;&#x5B9A;&#x662F;&#x4E0D;&#x80FD;&#x6709;body&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E86;undefined&#x6765;&#x6807;&#x8BC6;&#x3002;&#x540C;&#x65F6;&#x4E3A;&#x4E86;&#x5339;&#x914D;headers&#x4E2D;&#x7684;Content-Type&#xFF0C;params&#x7684;&#x8F6C;&#x5316;&#x5FC5;&#x987B;&#x4F7F;&#x7528;queryString.stringify&#xFF1B;&#x5982;&#x679C;&#x63A5;&#x53D7;&#x7684;&#x662F;json,&#x53EF;&#x4EE5;&#x4F7F;&#x7528;JSON.stringify&#x3002;</p>\n<p>&#x5B9A;&#x4E49;&#x5B8C;&#x4E4B;&#x540E;fetch&#x5BF9;&#x5916;&#x53EA;&#x9700;&#x63A5;&#x53D7;params&#x53C2;&#x6570;&#x5373;&#x53EF;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">async function fetchRequest(params){</span><br><span class=\"line\">    let body = convertBody(params);</span><br><span class=\"line\">    fetch(convertUrl(baseUrl, params),{</span><br><span class=\"line\">        method: method,</span><br><span class=\"line\">        headers: headers,</span><br><span class=\"line\">        body: body</span><br><span class=\"line\">    })</span><br><span class=\"line\">    .then((response) =&gt; response.json())</span><br><span class=\"line\">    .then((responseJson) =&gt; {</span><br><span class=\"line\">        //todo success</span><br><span class=\"line\">    })</span><br><span class=\"line\">    .catch((error) =&gt; {</span><br><span class=\"line\">        if (ApiModule.isDebug) {</span><br><span class=\"line\">            console.error(&quot;request error: &quot; + error);</span><br><span class=\"line\">        };</span><br><span class=\"line\">        //todo error</span><br><span class=\"line\">    });</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>fetch&#x7684;&#x8BF7;&#x6C42;&#x5C01;&#x88C5;&#x5B8C;&#x6210;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x7684;&#x6210;&#x529F;&#x4E0E;&#x5931;&#x8D25;&#x7684;&#x72B6;&#x6001;&#x5E76;&#x6CA1;&#x6709;&#x901A;&#x77E5;&#x7ED9;&#x8C03;&#x7528;&#x8005;&#xFF0C;&#x6240;&#x4EE5;&#x8FD8;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x56DE;&#x8C03;&#x673A;&#x5236;&#x3002;Promise&#x662F;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#x6700;&#x7EC8;&#x5B8C;&#x6210;&#x6216;&#x8005;&#x5931;&#x8D25;&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x4E24;&#x4E2A;&#x51FD;&#x6570;resolve&#x3001;reject</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const p = new Promise((resolve, reject){</span><br><span class=\"line\">\t...</span><br><span class=\"line\">\t//success</span><br><span class=\"line\">\tresolve(&apos;success&apos;)</span><br><span class=\"line\">\t//error</span><br><span class=\"line\">\treject(&apos;error&apos;)</span><br><span class=\"line\">});</span><br><span class=\"line\">//use</span><br><span class=\"line\">p.then(success =&gt; {</span><br><span class=\"line\">\t\tconsole.log(success);</span><br><span class=\"line\">\t}, error =&gt; {</span><br><span class=\"line\">  \t\tconsole.log(error)\t</span><br><span class=\"line\">});</span><br></pre></td></tr></table></figure>\n<p>&#x5C06;fetch&#x8BF7;&#x6C42;&#x653E;&#x5165;&#x5230;Promise&#x7684;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x4E00;&#x65E6;&#x6570;&#x636E;&#x6210;&#x529F;&#x8FD4;&#x56DE;&#x5C31;&#x8C03;&#x7528;resolve&#x51FD;&#x6570;&#x56DE;&#x8C03;&#x7ED9;&#x8C03;&#x7528;&#x8005;&#xFF1B;&#x5931;&#x8D25;&#x8C03;&#x7528;reject&#x51FD;&#x6570;&#xFF0C;&#x8FD4;&#x56DE;&#x5931;&#x8D25;&#x4FE1;&#x606F;&#x3002;&#x800C;&#x8C03;&#x7528;&#x8005;&#x53EA;&#x9700;&#x4F7F;&#x7528;Promise&#x7684;.then&#x65B9;&#x6CD5;&#x7B49;&#x5019;&#x6570;&#x636E;&#x7684;&#x56DE;&#x8C03;&#x901A;&#x77E5;&#x3002;&#x4E0B;&#x9762;&#x6765;&#x770B;&#x4E0B;&#x5B8C;&#x6574;&#x7684;fetch&#x5C01;&#x88C5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">async function fetchRequest(params){</span><br><span class=\"line\">    let body = convertBody(params);</span><br><span class=\"line\">    return new Promise(function(resolve, reject){</span><br><span class=\"line\">        fetch(convertUrl(baseUrl, params),{</span><br><span class=\"line\">            method: method,</span><br><span class=\"line\">            headers: headers,</span><br><span class=\"line\">            body: body</span><br><span class=\"line\">        })</span><br><span class=\"line\">        .then((response) =&gt; response.json())</span><br><span class=\"line\">        .then((responseJson) =&gt; {</span><br><span class=\"line\">            resolve(responseJson);</span><br><span class=\"line\">        })</span><br><span class=\"line\">        .catch((error) =&gt; {</span><br><span class=\"line\">            if (ApiModule.isDebug) {</span><br><span class=\"line\">                console.error(&quot;request error: &quot; + error);</span><br><span class=\"line\">            };</span><br><span class=\"line\">            reject(error);</span><br><span class=\"line\">        });</span><br><span class=\"line\">    });</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E4B;&#x540E;&#x5BF9;fetch&#x7684;&#x4F7F;&#x7528;&#x5C31;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x53EA;&#x9700;&#x4F20;&#x5165;&#x9700;&#x8981;&#x7684;&#x53C2;&#x6570;&#x5373;&#x53EF;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fetchRequest({method: &quot;goods.getInfo&quot;, goodsId: 27021599158370074})</span><br><span class=\"line\">.then(res =&gt;{</span><br><span class=\"line\">    this.setState({</span><br><span class=\"line\">        shareInfo: res.data.shareInfo</span><br><span class=\"line\">    });</span><br><span class=\"line\">});</span><br></pre></td></tr></table></figure>\n<p>&#x4EE5;&#x4E0A;&#x662F;&#x6709;&#x5173;fetch&#x7684;&#x5168;&#x90E8;&#x5185;&#x5BB9;&#xFF0C;&#x5F53;&#x7136;&#x5728;React Native&#x4E2D;&#x8FD8;&#x6709;&#x5176;&#x5B83;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x8BF7;&#x6C42;&#x5E93;&#xFF1A;XMLHttpRequest&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x652F;&#x6301;WebSockets&#x3002;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x4E5F;&#x53EF;&#x4EE5;&#x53BB;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#xFF0C;&#x76F8;&#x4FE1;&#x4F1A;&#x6709;&#x4E0D;&#x9519;&#x7684;&#x6536;&#x83B7;&#x3002;</p>\n<p>&#x62C9;&#x7C89;&#x73AF;&#x8282;&#xFF1A;&#x611F;&#x89C9;&#x4E0D;&#x9519;&#x7684;&#x53EF;&#x4EE5;&#x6765;&#x4E00;&#x6CE2;&#x5173;&#x6CE8;&#xFF0C;&#x626B;&#x63CF;&#x4E0B;&#x65B9;&#x4E8C;&#x7EF4;&#x7801;&#xFF0C;&#x5173;&#x6CE8;&#x516C;&#x4F17;&#x53F7;&#xFF0C;&#x53CA;&#x65F6;&#x83B7;&#x53D6;&#x6700;&#x65B0;&#x77E5;&#x8BC6;&#x6280;&#x5DE7;&#x3002;</p>\n<p><img src=\"/2018/08/28/React-Native-Fetch&#x5C01;&#x88C5;&#x90A3;&#x70B9;&#x4E8B;/wx_qr_code.png\" alt></p>\n","categories":["react native"],"tags":["fetch"]},{"title":"5分钟吃透React Native Flexbox","url":"https://www.rousetime.com/2018/08/23/5分钟吃透React-Native-Flexbox/","content":"<p>&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x6765;&#x804A;&#x804A;Flexbox&#xFF0C;&#x5B83;&#x662F;&#x524D;&#x7AEF;&#x7684;&#x4E00;&#x4E2A;&#x5E03;&#x5C40;&#x65B9;&#x5F0F;&#x3002;&#x5728;React Native&#x4E2D;&#x662F;&#x4E3B;&#x6D41;&#x5E03;&#x5C40;&#x65B9;&#x5F0F;&#x3002;&#x5982;&#x679C;&#x4F60;&#x521A;&#x521A;&#x5165;&#x95E8;React Native&#xFF0C;&#x6216;&#x8005;&#x6CA1;&#x6709;&#x591A;&#x5C11;&#x524D;&#x7AEF;&#x7684;&#x6280;&#x672F;&#x7ECF;&#x9A8C;&#xFF0C;&#x4EA6;&#x6216;&#x8005;&#x5BF9;&#x5176;&#x534A;&#x77E5;&#x534A;&#x89E3;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5C06;&#x5F88;&#x597D;&#x7684;&#x5E2E;&#x52A9;&#x4F60;&#x53C2;&#x900F;Flexbox&#x7684;&#x6574;&#x4E2A;&#x5168;&#x8C8C;&#x3002;</p>\n<h2 id=\"purpose\"><a href=\"#purpose\" class=\"headerlink\" title=\"purpose\"></a>purpose</h2><p>&#x901A;&#x8FC7;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4F60;&#x5C06;&#x5FEB;&#x901F;&#x5403;&#x900F;&#x6574;&#x4E2A;Flexbox&#xFF0C;&#x56E0;&#x4E3A;&#x5BF9;&#x4E8E;Flexbox&#x4F60;&#x53EA;&#x9700;&#x638C;&#x63E1;&#x4EE5;&#x4E0B;&#x51E0;&#x70B9;&#x5C5E;&#x6027;&#x5373;&#x53EF;&#x3002;</p>\n<ul>\n<li>flex</li>\n<li>flexDirection</li>\n<li>justifyContent</li>\n<li>alignItems</li>\n<li>flexWrap</li>\n<li>alignSelf</li>\n</ul>\n<h2 id=\"flex\"><a href=\"#flex\" class=\"headerlink\" title=\"flex\"></a>flex</h2><p>Flexbox&#x4F7F;&#x7528;&#x7684;&#x662F;&#x5F39;&#x6027;&#x5E03;&#x5C40;&#xFF0C;&#x5B83;&#x6709;&#x4E2A;&#x5C5E;&#x6027;flex&#x7528;&#x6765;&#x63A7;&#x5236;&#x5B83;&#x7684;&#x5F39;&#x6027;&#x3002;&#x6709;&#x70B9;&#x7C7B;&#x4F3C;&#x4E0E;Android&#x5E03;&#x5C40;&#x4E2D;&#x7684;weight&#x5C5E;&#x6027;&#x3002;&#x5F53;&#x7136;&#x4E0E;&#x524D;&#x7AEF;&#x7684;css&#x4E2D;&#x7684;flex&#x4E5F;&#x6709;&#x6240;&#x4E0D;&#x540C;&#xFF0C;&#x5B83;&#x652F;&#x6301;&#x7684;&#x7C7B;&#x578B;&#x662F;number&#x4E0D;&#x662F;string&#x3002;&#x5B83;&#x6709;&#x4E09;&#x79CD;&#x72B6;&#x6001;&#xFF1A;&#x6B63;&#x6570;&#x3001;&#x96F6;&#x4E0E;&#x8D1F;&#x6570;&#x3002;&#x76F4;&#x63A5;&#x770B;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import React, {Component} from &apos;react&apos;;</span><br><span class=\"line\">import {StyleSheet, Text, View} from &apos;react-native&apos;;</span><br><span class=\"line\"> </span><br><span class=\"line\">export default class App extends Component&lt;Props&gt; {</span><br><span class=\"line\">  render() {</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;View style={styles.container}&gt;</span><br><span class=\"line\">          &lt;View style={styles.red}/&gt;</span><br><span class=\"line\">          &lt;View style={styles.blue}/&gt;</span><br><span class=\"line\">          &lt;View style={styles.orange}/&gt;</span><br><span class=\"line\">      &lt;/View&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\">   </span><br><span class=\"line\">const styles = StyleSheet.create({</span><br><span class=\"line\">  container: {</span><br><span class=\"line\">    flex: 1,</span><br><span class=\"line\">    justifyContent: &apos;center&apos;,</span><br><span class=\"line\">    alignItems: &apos;center&apos;,</span><br><span class=\"line\">    backgroundColor: &apos;#F5FCFF&apos;,</span><br><span class=\"line\">  },</span><br><span class=\"line\">  red: {</span><br><span class=\"line\">      flex: 1,</span><br><span class=\"line\">      width: 100,</span><br><span class=\"line\">      backgroundColor: &apos;red&apos;</span><br><span class=\"line\">  },</span><br><span class=\"line\">  blue: {</span><br><span class=\"line\">      flex: 2,</span><br><span class=\"line\">      width: 100,</span><br><span class=\"line\">      backgroundColor: &apos;blue&apos;</span><br><span class=\"line\">  },</span><br><span class=\"line\">  orange: {</span><br><span class=\"line\">      width: 100,</span><br><span class=\"line\">      height: 100,</span><br><span class=\"line\">      backgroundColor: &apos;orange&apos;</span><br><span class=\"line\">  }</span><br><span class=\"line\">});</span><br></pre></td></tr></table></figure>\n<p>&#x7236;&#x5BB9;&#x5668;&#x4F7F;&#x7528;flex:1&#x6765;&#x6491;&#x6EE1;&#x6574;&#x4E2A;&#x5C4F;&#x5E55;&#xFF0C;orange&#x662F;&#x56FA;&#x5B9A;&#x7684;&#x4E00;&#x4E2A;view&#xFF0C;&#x800C;red&#x4E0E;blue&#x4F7F;&#x7528;flex&#xFF0C;&#x901A;&#x8FC7;flex&#x7684;&#x503C;&#x8FDB;&#x884C;&#x7B49;&#x6BD4;(1:2)&#x5206;&#x644A;&#x5269;&#x4F59;&#x7684;&#x7A7A;&#x95F4;&#x3002;&#x6765;&#x770B;&#x4E0B;&#x8FD0;&#x884C;&#x6548;&#x679C;&#x3002;</p>\n<p><img src=\"/2018/08/23/5&#x5206;&#x949F;&#x5403;&#x900F;React-Native-Flexbox/flexbox_flex_positive.jpg\" alt></p>\n<p>&#x8FD9;&#x662F;&#x4E3A;&#x6B63;&#x6570;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5982;&#x679C;flex:0&#xFF0C;&#x63A7;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#x5C31;&#x4F1A;&#x6839;&#x636E;&#x8BBE;&#x7F6E;&#x7684;width&#x4E0E;height&#x6765;&#x56FA;&#x5B9A;&#x663E;&#x793A;&#x3002;</p>\n<p>&#x5982;&#x679C;flex:-1&#xFF0C;&#x5982;&#x679C;&#x7A7A;&#x95F4;&#x8DB3;&#x591F;&#xFF0C;&#x63A7;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#x4E5F;&#x4F1A;&#x6839;&#x636E;width&#x4E0E;height&#x6765;&#x5C55;&#x793A;&#xFF1B;&#x5982;&#x679C;&#x7A7A;&#x95F4;&#x4E0D;&#x8DB3;&#xFF0C;&#x4F1A;&#x6839;&#x636E;minWidth&#x4E0E;minHeight&#x6765;&#x5C55;&#x793A;&#x3002;</p>\n<blockquote>\n<p>&#x4E00;&#x822C;&#x90FD;&#x4E0D;&#x4F1A;&#x4F7F;&#x7528;flex:-1&#xFF0C;&#x800C;&#x4E14;&#x7ECF;&#x8FC7;&#x6D4B;&#x8BD5;&#xFF0C;&#x7A7A;&#x95F4;&#x4E0D;&#x8DB3;&#x65F6;minWidth&#x4E0E;minHeight&#x5E76;&#x4E0D;&#x4F1A;&#x751F;&#x6548;&#x3002;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x751F;&#x6548;&#x7684;&#x65B9;&#x5F0F;&#x8BF7;&#x52A1;&#x5FC5;&#x544A;&#x77E5;&#x3002;</p>\n</blockquote>\n<h2 id=\"flexDirection\"><a href=\"#flexDirection\" class=\"headerlink\" title=\"flexDirection\"></a>flexDirection</h2><p>&#x5728;Flexbox&#x4E2D;&#x6709;&#x4E3B;&#x8F74;&#x4E0E;&#x526F;&#x8F74;&#x4E4B;&#x5206;&#xFF0C;&#x4E3B;&#x8F74;&#x63A7;&#x5236;child&#x7684;&#x6392;&#x5217;&#x65B9;&#x5411;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;column&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;flexDirection&#x5C5E;&#x6027;&#x6539;&#x53D8;&#x4E3B;&#x8F74;&#x65B9;&#x5411;&#x3002;&#x5B83;&#x6709;&#x56DB;&#x4E2A;&#x53EF;&#x9009;&#x503C;&#x5206;&#x522B;&#x4E3A;</p>\n<ul>\n<li>row: child&#x6C34;&#x5E73;&#x65B9;&#x5411;&#x6392;&#x5217;</li>\n<li>column: child&#x7AD6;&#x76F4;&#x65B9;&#x5411;&#x6392;&#x5217;(&#x9ED8;&#x8BA4;)</li>\n<li>row-reverse: child&#x6C34;&#x5E73;&#x65B9;&#x5411;&#x53CD;&#x5411;&#x6392;&#x5217;</li>\n<li>column-reverse: child&#x7AD6;&#x76F4;&#x65B9;&#x5411;&#x53CD;&#x5411;&#x6392;&#x5217;</li>\n</ul>\n<p>&#x5728;&#x4E0A;&#x9762;&#x7684;demo&#x57FA;&#x7840;&#x4E0A;&#x6539;&#x53D8;style&#x6837;&#x5F0F;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const styles = StyleSheet.create({</span><br><span class=\"line\">  container: {</span><br><span class=\"line\">    flex: 1,</span><br><span class=\"line\">    flexDirection: &apos;row&apos;,</span><br><span class=\"line\">    justifyContent: &apos;center&apos;,</span><br><span class=\"line\">    alignItems: &apos;center&apos;,</span><br><span class=\"line\">    backgroundColor: &apos;#F5FCFF&apos;,</span><br><span class=\"line\">  },</span><br><span class=\"line\">  red: {</span><br><span class=\"line\">      height: 100,</span><br><span class=\"line\">      width: 100,</span><br><span class=\"line\">      backgroundColor: &apos;red&apos;</span><br><span class=\"line\">  },</span><br><span class=\"line\">  blue: {</span><br><span class=\"line\">      width: 100,</span><br><span class=\"line\">      height: 100,</span><br><span class=\"line\">      backgroundColor: &apos;blue&apos;</span><br><span class=\"line\">  },</span><br><span class=\"line\">  orange: {</span><br><span class=\"line\">      width: 100,</span><br><span class=\"line\">      height: 100,</span><br><span class=\"line\">      backgroundColor: &apos;orange&apos;</span><br><span class=\"line\">  }</span><br><span class=\"line\">});</span><br></pre></td></tr></table></figure>\n<p>&#x5206;&#x522B;&#x6539;&#x53D8;container&#x4E2D;flexDirection&#x7684;&#x503C;&#xFF1A;row&#x3001;row-reverse&#x3001;column&#x3001;column-reverse</p>\n<p><img src=\"/2018/08/23/5&#x5206;&#x949F;&#x5403;&#x900F;React-Native-Flexbox/flexbox_flex_direction.jpg\" alt></p>\n<h2 id=\"justifyContent\"><a href=\"#justifyContent\" class=\"headerlink\" title=\"justifyContent\"></a>justifyContent</h2><p>&#x56FA;&#x5B9A;&#x597D;&#x4E3B;&#x8F74;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;justifyContent&#x6765;&#x6307;&#x5B9A;&#x4E3B;&#x8F74;&#x65B9;&#x5411;child&#x7684;&#x6392;&#x5217;&#x65B9;&#x5F0F;&#xFF0C;&#x5B83;&#x6709;&#x516D;&#x4E2A;&#x53EF;&#x9009;&#x503C;</p>\n<ul>\n<li>flex-start: child&#x5BF9;&#x9F50;&#x4E3B;&#x8F74;&#x7684;&#x8D77;&#x70B9;(&#x9ED8;&#x8BA4;)</li>\n<li>flex-end: child&#x5BF9;&#x9F50;&#x4E3B;&#x8F74;&#x7684;&#x7EC8;&#x70B9;</li>\n<li>center: child&#x5C45;&#x4E2D;&#x5BF9;&#x9F50;&#x4E3B;&#x8F74;</li>\n<li>space-between: child&#x5728;&#x4E3B;&#x8F74;&#x65B9;&#x5411;&#x76F8;&#x90BB;child&#x7B49;&#x95F4;&#x8DDD;&#x5BF9;&#x9F50;&#xFF0C;&#x9996;&#x5C3E;child&#x4E0E;&#x7236;&#x5BB9;&#x5668;&#x5BF9;&#x9F50;</li>\n<li>space-around: child&#x5728;&#x4E3B;&#x8F74;&#x65B9;&#x5411;&#x76F8;&#x90BB;child&#x7B49;&#x95F4;&#x8DDD;&#x5BF9;&#x9F50;&#xFF0C;&#x9996;&#x5C3E;child&#x4E0E;&#x7236;&#x5BB9;&#x5668;&#x7684;&#x95F4;&#x8DDD;&#x76F8;&#x7B49;&#x4E14;&#x4E3A;&#x76F8;&#x90BB;child&#x95F4;&#x8DDD;&#x7684;&#x4E00;&#x534A;</li>\n<li>space-evenly: child&#x5728;&#x4E3B;&#x8F74;&#x65B9;&#x5411;&#x5747;&#x5300;&#x5206;&#x5E03;&#x3002;&#x76F8;&#x90BB;&#x95F4;&#x8DDD;&#x4E0E;&#x9996;&#x5C3E;&#x95F4;&#x8DDD;&#x76F8;&#x7B49;</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">container: {</span><br><span class=\"line\">  flex: 1,</span><br><span class=\"line\">  flexDirection: &apos;row&apos;,</span><br><span class=\"line\">  justifyContent: &apos;flex-start&apos;,</span><br><span class=\"line\">  backgroundColor: &apos;#F5FCFF&apos;,</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4F9D;&#x6B21;&#x6539;&#x53D8;container&#x4E2D;&#x7684;justifyContent&#xFF1A;flex-start&#x3001;flex-end&#x3001;center&#x3001;space-between&#x3001;space-around&#x4E0E;space-evenly</p>\n<p><img src=\"/2018/08/23/5&#x5206;&#x949F;&#x5403;&#x900F;React-Native-Flexbox/flexbox_justify_content_flex_start_end.jpg\" alt><br><img src=\"/2018/08/23/5&#x5206;&#x949F;&#x5403;&#x900F;React-Native-Flexbox/flexbox_justify_content_center_space_between.jpg\" alt><br><img src=\"/2018/08/23/5&#x5206;&#x949F;&#x5403;&#x900F;React-Native-Flexbox/flexbox_justify_content_space_around_evenly.jpg\" alt></p>\n<h2 id=\"alignItems\"><a href=\"#alignItems\" class=\"headerlink\" title=\"alignItems\"></a>alignItems</h2><p>&#x4E3B;&#x8F74;&#x56FA;&#x5B9A;&#x4E4B;&#x540E;&#xFF0C;&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F;&#x526F;&#x8F74;&#xFF0C;alignItems&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x63A7;&#x5236;&#x526F;&#x8F74;&#x4E0A;&#x7684;child&#x6392;&#x5217;&#x65B9;&#x5F0F;&#x3002;&#x5B83;&#x6709;&#x4E94;&#x4E2A;&#x53EF;&#x9009;&#x9879;&#x5206;&#x522B;&#x4E3A;</p>\n<ul>\n<li>flex-start: child&#x5BF9;&#x9F50;&#x526F;&#x8F74;&#x8D77;&#x70B9;(&#x9ED8;&#x8BA4;)</li>\n<li>flex-end: child&#x5BF9;&#x9F50;&#x526F;&#x8F74;&#x7EC8;&#x70B9;</li>\n<li>center: child&#x5C45;&#x4E2D;&#x5BF9;&#x9F50;&#x526F;&#x8F74;</li>\n<li>stretch: child&#x4E3A;&#x5F39;&#x6027;&#x5E03;&#x5C40;&#x65F6;(&#x672A;&#x8BBE;&#x7F6E;&#x526F;&#x8F74;&#x65B9;&#x5411;&#x7684;&#x5927;&#x5C0F;&#x6216;&#x8005;&#x4E3A;auto)&#xFF0C;&#x62C9;&#x4F38;&#x5BF9;&#x9F50;&#x526F;&#x8F74;</li>\n<li>baseline: &#x6709;&#x6587;&#x672C;&#x5B58;&#x5728;&#x65F6;&#xFF0C;child&#x5728;&#x526F;&#x8F74;&#x65B9;&#x5411;&#x57FA;&#x4E8E;&#x7B2C;&#x4E00;&#x4E2A;&#x6587;&#x672C;&#x57FA;&#x7EBF;&#x5BF9;&#x9F50;</li>\n</ul>\n<p>&#x6539;&#x53D8;container&#x7684;style&#xFF0C;&#x4E3B;&#x8F74;&#x8BBE;&#x7F6E;&#x4E3A;row&#xFF0C;&#x4F9D;&#x6B21;&#x6539;&#x53D8;alignItems&#xFF1A;flex-start&#x3001;flex-end&#x3001;center</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">container: {</span><br><span class=\"line\">  flex: 1,</span><br><span class=\"line\">  flexDirection: &apos;row&apos;,</span><br><span class=\"line\">  alignItems: &apos;flex-start&apos;,</span><br><span class=\"line\">  backgroundColor: &apos;#F5FCFF&apos;,</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x5C06;alignItems&#x8BBE;&#x7F6E;&#x4E3A;stretch&#xFF0C;&#x5E76;&#x4E14;&#x6539;&#x53D8;red&#x7684;height&#xFF0C;red&#x4F1A;&#x88AB;&#x62C9;&#x4F38;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">container: {</span><br><span class=\"line\">  flex: 1,</span><br><span class=\"line\">  flexDirection: &apos;row&apos;,</span><br><span class=\"line\">  alignItems: &apos;stretch&apos;,</span><br><span class=\"line\">  backgroundColor: &apos;#F5FCFF&apos;,</span><br><span class=\"line\">},</span><br><span class=\"line\">red: {</span><br><span class=\"line\">    width: 100,</span><br><span class=\"line\">    height: &apos;auto&apos;,</span><br><span class=\"line\">    backgroundColor: &apos;red&apos;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2018/08/23/5&#x5206;&#x949F;&#x5403;&#x900F;React-Native-Flexbox/flexbox_align_items_flex_start_end.jpg\" alt><br><img src=\"/2018/08/23/5&#x5206;&#x949F;&#x5403;&#x900F;React-Native-Flexbox/flexbox_align_items_center_stretch.jpg\" alt></p>\n<p>alignItems: baseline&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x6587;&#x672C;&#x7684;&#x6B63;&#x4E2D;&#x5FC3;&#xFF0C;&#x800C;&#x662F;&#x6587;&#x672C;View&#x7684;&#x5BB9;&#x5668;&#x5E95;&#x90E8;&#x3002;&#x5728;&#x4E0A;&#x9762;&#x57FA;&#x7840;&#x4E0A;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;Text&#xFF0C;&#x8BA9;&#x6587;&#x672C;&#x81EA;&#x8EAB;&#x5C45;&#x4E2D;&#x5C55;&#x793A;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">container: {</span><br><span class=\"line\">  flex: 1,</span><br><span class=\"line\">  flexDirection: &apos;row&apos;,</span><br><span class=\"line\">  alignItems: &apos;baseline&apos;,</span><br><span class=\"line\">  backgroundColor: &apos;#F5FCFF&apos;,</span><br><span class=\"line\">},</span><br><span class=\"line\">text: {</span><br><span class=\"line\">    width: 80,</span><br><span class=\"line\">    height: 80,</span><br><span class=\"line\">    fontSize: 20,</span><br><span class=\"line\">    color: &apos;white&apos;,</span><br><span class=\"line\">    marginTop: 110,</span><br><span class=\"line\">    backgroundColor: &apos;black&apos;,</span><br><span class=\"line\">    textAlign: &apos;center&apos;,</span><br><span class=\"line\">    textAlignVertical: &apos;center&apos;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2018/08/23/5&#x5206;&#x949F;&#x5403;&#x900F;React-Native-Flexbox/flexbox_align_items_baseline.jpg\" alt></p>\n<h2 id=\"flexWrap\"><a href=\"#flexWrap\" class=\"headerlink\" title=\"flexWrap\"></a>flexWrap</h2><p>&#x5982;&#x679C;&#x518D;&#x589E;&#x52A0;&#x4E00;&#x4E2A;View&#xFF0C;&#x7531;&#x4E8E;&#x7A7A;&#x95F4;&#x4E0D;&#x8DB3;&#x5B83;&#x4F1A;&#x5C55;&#x793A;&#x4E0D;&#x5168;&#x3002;&#x8FD9;&#x65F6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;flexWrap&#x5C5E;&#x6027;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x81EA;&#x52A8;&#x6362;&#x884C;&#x5C55;&#x793A;&#x3002;</p>\n<ul>\n<li>nowrap: &#x4E0D;&#x6362;&#x884C;(&#x9ED8;&#x8BA4;)</li>\n<li>wrap: &#x81EA;&#x52A8;&#x6362;&#x884C;</li>\n</ul>\n<p>&#x5728;container&#x4E2D;&#x6DFB;&#x52A0;flexWrap&#x5C5E;&#x6027;&#xFF0C;&#x5E76;&#x4E14;&#x518D;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;green view</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">container: {</span><br><span class=\"line\">  flex: 1,</span><br><span class=\"line\">  flexDirection: &apos;row&apos;,</span><br><span class=\"line\">  flexWrap: &apos;wrap&apos;,</span><br><span class=\"line\">  justifyContent: &apos;flex-start&apos;,</span><br><span class=\"line\">  backgroundColor: &apos;#F5FCFF&apos;,</span><br><span class=\"line\">},</span><br><span class=\"line\">green: {</span><br><span class=\"line\">    width: 100,</span><br><span class=\"line\">    height: 100,</span><br><span class=\"line\">    backgroundColor: &apos;green&apos;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2018/08/23/5&#x5206;&#x949F;&#x5403;&#x900F;React-Native-Flexbox/flexbox_flex_wrap.jpg\" alt></p>\n<h2 id=\"alignSelf\"><a href=\"#alignSelf\" class=\"headerlink\" title=\"alignSelf\"></a>alignSelf</h2><p>alignSelf&#x5C5E;&#x6027;&#x7C7B;&#x4F3C;&#x4E8E;alignItems&#xFF0C;&#x5B83;&#x4E5F;&#x662F;&#x63A7;&#x5236;&#x526F;&#x8F74;&#x4E0A;&#x7684;&#x6392;&#x5217;&#x89C4;&#x5219;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x5B83;&#x4F7F;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x662F;child&#x81EA;&#x5DF1;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x7236;&#x5BB9;&#x5668;alignItems&#x7684;&#x5C5E;&#x6027;&#x63A7;&#x5236;&#x7684;child&#x6392;&#x5217;&#x89C4;&#x5219;&#xFF0C;&#x5728;&#x526F;&#x8F74;&#x4E0A;&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;&#x6392;&#x5217;&#x89C4;&#x5219;&#x3002;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;auto&#xFF0C;&#x7EE7;&#x627F;&#x7236;&#x5BB9;&#x5668;&#x7684;alignItems&#x5C5E;&#x6027;&#x3002;&#x56E0;&#x6B64;&#x5B83;&#x4E5F;&#x6709;&#x4E94;&#x4E2A;&#x53EF;&#x9009;&#x503C;&#xFF1A;flex-start&#x3001;flex-end&#x3001;center&#x3001;stretch&#x4E0E;baseline&#x3002;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x4E3A;range&#x6DFB;&#x52A0;alignSelf&#xFF0C;&#x5176;&#x5B83;&#x7684;child&#x4E0D;&#x53D8;&#xFF0C;&#x90FD;&#x7EE7;&#x627F;&#x7236;&#x5BB9;&#x5668;&#x7684;alignItems: flex-start</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">orange: {</span><br><span class=\"line\">    width: 100,</span><br><span class=\"line\">    height: 100,</span><br><span class=\"line\">    backgroundColor: &apos;orange&apos;,</span><br><span class=\"line\">    alignSelf: &apos;flex-end&apos;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2018/08/23/5&#x5206;&#x949F;&#x5403;&#x900F;React-Native-Flexbox/flexbox_align_self.jpg\" alt></p>\n<blockquote>\n<p>&#x5176;&#x5B83;&#x7684;&#x53EF;&#x9009;&#x503C;&#x5C31;&#x4E0D;&#x4E00;&#x4E00;&#x8BF4;&#x660E;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;alignItems</p>\n</blockquote>\n<h2 id=\"other\"><a href=\"#other\" class=\"headerlink\" title=\"other\"></a>other</h2><p>&#x6700;&#x540E;&#x8FD8;&#x6709;&#x4E09;&#x4E2A;&#x6BD4;&#x8F83;&#x51B7;&#x95E8;&#x5C5E;&#x6027;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x8BE6;&#x7EC6;&#x4E00;&#x4E00;&#x4EE3;&#x7801;&#x4E0E;&#x8D34;&#x56FE;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x8BF4;&#x4E0B;&#x5B83;&#x4EEC;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x76F8;&#x540C;&#x70B9;&#x662F;&#x5B83;&#x4EEC;&#x90FD;&#x662F;&#x5728;child&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x4E0E;alignSelf&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x4E00;&#x6837;&#x3002;</p>\n<ul>\n<li>flexBasis: &#x8BBE;&#x7F6E;&#x4E3B;&#x8F74;&#x65B9;&#x5411;&#x4E0A;&#x7684;&#x521D;&#x59CB;&#x503C;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;auto&#x3002;&#x5982;&#x679C;&#x4E0E;width&#x6216;&#x8005;height&#x540C;&#x65F6;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x4F1A;&#x8986;&#x76D6;&#x5B83;&#x4EEC;&#x7684;&#x503C;</li>\n<li>flexGrow: &#x8BBE;&#x7F6E;chid&#x7684;&#x653E;&#x5927;&#x6BD4;&#x4F8B;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;flex&#xFF0C;&#x7A7A;&#x95F4;&#x5145;&#x8DB3;&#x65F6;&#x81EA;&#x52A8;&#x6309;&#x6BD4;&#x4F8B;&#x653E;&#x5927;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;0</li>\n<li>flexShrink: &#x8BBE;&#x7F6E;chid&#x7684;&#x7F29;&#x5C0F;&#x6BD4;&#x4F8B;&#x3002;&#x7A7A;&#x95F4;&#x4E0D;&#x8DB3;&#x65F6;&#x81EA;&#x52A8;&#x6309;&#x6BD4;&#x4F8B;&#x7F29;&#x5C0F;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;0</li>\n</ul>\n<p>&#x6709;&#x5173;Flexbox&#xFF0C;&#x7EB5;&#x89C2;&#x5168;&#x6587;&#x53EA;&#x9700;&#x638C;&#x63E1;&#x5F00;&#x5934;&#x6240;&#x5217;&#x7684;&#x516D;&#x79CD;&#x5C5E;&#x6027;&#xFF0C;React Native&#x4E2D;&#x7684;&#x7EDD;&#x5927;&#x591A;&#x6570;&#x5E03;&#x5C40;&#x4E5F;&#x5C31;&#x4E0D;&#x6210;&#x95EE;&#x9898;&#x3002;&#x73B0;&#x5728;&#x5BF9;&#x4E8E;Flexbox&#x662F;&#x5426;&#x6E05;&#x6670;&#x4E86;&#x8BB8;&#x591A;&#x5462;&#xFF1F;&#x8D76;&#x7D27;&#x4EB2;&#x81EA;&#x53BB;&#x8BD5;&#x8BD5;&#x5427;~</p>\n<p>&#x611F;&#x89C9;&#x4E0D;&#x9519;&#x7684;&#x53EF;&#x4EE5;&#x6765;&#x4E00;&#x6CE2;&#x5173;&#x6CE8;&#xFF0C;&#x626B;&#x63CF;&#x4E0B;&#x65B9;&#x4E8C;&#x7EF4;&#x7801;&#xFF0C;&#x5173;&#x6CE8;&#x516C;&#x4F17;&#x53F7;&#xFF0C;&#x53CA;&#x65F6;&#x83B7;&#x53D6;&#x6700;&#x65B0;&#x77E5;&#x8BC6;&#x6280;&#x5DE7;&#x3002;</p>\n<p><img src=\"/2018/08/23/5&#x5206;&#x949F;&#x5403;&#x900F;React-Native-Flexbox/wx_qr_code.png\" alt></p>\n","categories":[],"tags":["flexbox"]},{"title":"ViewDragHelper之手势操作神器","url":"https://www.rousetime.com/2018/08/19/ViewDragHelper之手势操作神器/","content":"<p><img src=\"/2018/08/19/ViewDragHelper&#x4E4B;&#x624B;&#x52BF;&#x64CD;&#x4F5C;&#x795E;&#x5668;/cover.jpg\" alt=\"cover\"></p>\n<p>&#x5728;Android&#x4E2D;&#x907F;&#x514D;&#x4E0D;&#x4E86;&#x81EA;&#x5B9A;&#x4E49;ViewGroup&#xFF0C;&#x6765;&#x5B9E;&#x73B0;&#x6211;&#x4EEC;&#x539F;&#x751F;&#x63A7;&#x4EF6;&#x6240;&#x4E0D;&#x80FD;&#x6EE1;&#x8DB3;&#x7684;&#x9700;&#x6C42;&#x3002;&#x5C24;&#x5176;&#x662F;&#x590D;&#x6742;&#x7684;ViewGroup&#x5B9E;&#x73B0;&#xFF0C;&#x624B;&#x52BF;&#x7684;&#x5904;&#x7406;&#x662F;&#x907F;&#x514D;&#x4E0D;&#x4E86;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x8981;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x7684;ViewGroup&#x6765;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x7684;<code>onInterceptTouchEvent</code>&#x4E0E;<code>onTouchEvent</code>&#x4E8B;&#x4EF6;&#x7B49;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x6709;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x7B80;&#x4FBF;&#x7684;&#x65B9;&#x6CD5;&#x5462;&#xFF1F;&#x7B54;&#x6848;&#x662F;&#x80AF;&#x5B9A;&#x7684;&#xFF0C;ViewDragHelper&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x89E3;&#x51B3;&#x8D1F;&#x8D23;&#x7684;&#x624B;&#x52BF;&#x64CD;&#x4F5C;&#x3002;&#x5B83;&#x662F;&#x5B98;&#x65B9;&#x6240;&#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x4E2A;&#x4E13;&#x95E8;&#x4E3A;&#x81EA;&#x5B9A;&#x4E49;ViewGroup&#x5904;&#x7406;&#x62D6;&#x62FD;&#x7684;&#x624B;&#x52BF;&#x7C7B;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x5B98;&#x65B9;&#x7684;&#x539F;&#x6587;&#x5F15;&#x7528;&#x8BF4;&#x660E;</p>\n<blockquote>\n<p>ViewDragHelper is a utility class for writing custom ViewGroups. It offers a number of useful operations and state tracking for allowing a user to drag and reposition views within their parent ViewGroup.</p>\n</blockquote>\n<h2 id=\"Purpose\"><a href=\"#Purpose\" class=\"headerlink\" title=\"Purpose\"></a>Purpose</h2><p>&#x901A;&#x8FC7;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4F60;&#x5C06;&#x4F1A;&#x638C;&#x63E1;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x77E5;&#x8BC6;&#x70B9;&#xFF1A;</p>\n<ol>\n<li>ViewDragHelper&#x7684;&#x7B80;&#x5355;&#x5165;&#x95E8;</li>\n<li>ViewDragHelper&#x7684;&#x5173;&#x952E;API&#x7528;&#x9014;</li>\n<li>&#x4F7F;&#x7528;ViewDragHelper&#x5B9E;&#x73B0;view&#x7684;&#x62D6;&#x62FD;</li>\n</ol>\n<h2 id=\"use\"><a href=\"#use\" class=\"headerlink\" title=\"use\"></a>use</h2><p>&#x9996;&#x5148;&#x9700;&#x8981;&#x6784;&#x5EFA;ViewDragHelper&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x901A;&#x8FC7;&#x5B83;&#x7684;&#x9759;&#x6001;<code>create</code>&#x65B9;&#x6CD5;&#x751F;&#x6210;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mViewDragHelper = ViewDragHelper.create(this, object : ViewDragHelper.Callback() {</span><br><span class=\"line\">    override fun tryCaptureView(child: View?, pointerId: Int): Boolean {</span><br><span class=\"line\">        TODO(&quot;not implemented&quot;) //To change body of created functions use File | Settings | File Templates.</span><br><span class=\"line\">    }</span><br><span class=\"line\">})</span><br></pre></td></tr></table></figure>\n<p>&#x4E3B;&#x8981;&#x53C2;&#x6570;&#x4E3A;<code>ViewGroup</code>&#x4E0E;<code>ViewDragHelper.Callback</code>&#x3002;Callback&#x662F;&#x5BF9;view&#x64CD;&#x4F5C;&#x7684;&#x56DE;&#x8C03;&#xFF0C;&#x7EDD;&#x5BF9;&#x591A;&#x6570;&#x624B;&#x52BF;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x5728;&#x8FD9;&#x4E2A;&#x56DE;&#x8C03;&#x4E2D;&#x5B8C;&#x6210;&#x3002;<code>tryCaptureView</code>&#x65B9;&#x6CD5;&#x662F;&#x5B83;&#x552F;&#x4E00;&#x7684;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#xFF0C;&#x9ED8;&#x8BA4;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x3002;&#x6839;&#x636E;&#x53C2;&#x6570;child&#x5224;&#x65AD;&#x7528;&#x6237;&#x89E6;&#x6478;&#x7684;view&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x540E;&#x7EED;&#x64CD;&#x4F5C;&#x3002;</p>\n<p>&#x4E3A;&#x4E86;&#x8BA9;ViewDragHelper&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x7B80;&#x5316;&#x624B;&#x52BF;&#x64CD;&#x4F5C;&#xFF0C;&#x6240;&#x4EE5;&#x8FD8;&#x9700;&#x4E3A;&#x5B83;&#x4F20;&#x5165;&#x76F8;&#x5173;&#x7684;<code>MotionEvent</code>&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun onInterceptTouchEvent(ev: MotionEvent?): Boolean {</span><br><span class=\"line\">    return mViewDragHelper.shouldInterceptTouchEvent(ev)</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">override fun onTouchEvent(event: MotionEvent?): Boolean {</span><br><span class=\"line\">    mViewDragHelper.processTouchEvent(event)</span><br><span class=\"line\">    return true</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5206;&#x522B;&#x8C03;&#x7528;ViewDragHelper&#x7684;<code>shouldInterceptTouchEvent</code>&#x4E0E;<code>processTouchEvent</code>&#x6765;&#x7B80;&#x5316;&#x624B;&#x52BF;&#x7684;&#x64CD;&#x4F5C;&#x5224;&#x65AD;&#x3002;&#x5C06;&#x624B;&#x52BF;&#x64CD;&#x4F5C;&#x5168;&#x90E8;&#x4EA4;&#x7531;ViewDragHelper&#x6765;&#x5B9E;&#x73B0;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x8981;&#x5904;&#x7406;&#x60EF;&#x6027;&#x6ED1;&#x52A8;&#xFF0C;&#x518D;&#x91CD;&#x5199;<code>computeScroll</code>&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun computeScroll() {</span><br><span class=\"line\">    if (mViewDragHelper.continueSettling(true)) {</span><br><span class=\"line\">        invalidate()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>ViewDragHelper&#x7684;&#x57FA;&#x672C;&#x4F7F;&#x7528;&#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x7B97;&#x4E86;&#x4E00;&#x4E0B;&#x4E5F;&#x5C31;&#x5341;&#x51E0;&#x884C;&#x4EE3;&#x7801;&#x3002;&#x76F8;&#x5BF9;&#x4E8E;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x5176;&#x4E2D;&#x7684;&#x7EC6;&#x8282;&#xFF0C;&#x51CF;&#x5C11;&#x4E86;&#x8BB8;&#x591A;&#x4EE3;&#x7801;&#x3002;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x5FEB;&#x901F;&#x7B80;&#x4FBF;&#x7684;&#x5B9E;&#x73B0;&#x624B;&#x52BF;&#x64CD;&#x4F5C;&#xFF0C;ViewDragHelper&#x662F;&#x4E0D;&#x4E8C;&#x4E4B;&#x9009;&#x3002;</p>\n<h2 id=\"Demo\"><a href=\"#Demo\" class=\"headerlink\" title=\"Demo\"></a>Demo</h2><p>&#x4E0B;&#x9762;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x6765;&#x5BF9;ViewDragHelper&#x7684;&#x4E3B;&#x8981;Api&#x7684;&#x4F7F;&#x7528;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x3002;&#x9996;&#x5148;&#x6765;&#x770B;&#x4E0B;&#x8981;&#x5B9E;&#x73B0;&#x7684;&#x521D;&#x6B65;&#x6548;&#x679C;&#x3002;</p>\n<p><img src=\"/2018/08/19/ViewDragHelper&#x4E4B;&#x624B;&#x52BF;&#x64CD;&#x4F5C;&#x795E;&#x5668;/view_drag_helper.gif\" alt></p>\n<p>&#x6709;&#x4E09;&#x4E2A;view&#xFF0C;&#x5206;&#x522B;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x6C34;&#x5E73;&#x3001;&#x7AD6;&#x76F4;&#x4E0E;&#x4EFB;&#x610F;&#x4F4D;&#x7F6E;&#x6ED1;&#x52A8;&#x3002;&#x800C;&#x8981;&#x5B9E;&#x73B0;&#x8FD9;&#x79CD;&#x6548;&#x679C;&#xFF0C;&#x9700;&#x8981;&#x7528;&#x5230;&#x7684;&#x5C31;&#x662F;ViewDragHelper.Callback&#x4E2D;&#x7684;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x3002;</p>\n<h3 id=\"tryCaptureView\"><a href=\"#tryCaptureView\" class=\"headerlink\" title=\"tryCaptureView\"></a>tryCaptureView</h3><p>&#x8BE5;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x5E03;&#x5C14;&#x503C;&#x6765;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x64CD;&#x4F5C;&#x7684;view&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x6355;&#x83B7;&#x3002;demo&#x4E2D;&#x9700;&#x8981;&#x8FD9;&#x4E09;&#x4E2A;view&#x90FD;&#x80FD;&#x88AB;&#x6355;&#x83B7;&#x5230;&#xFF0C;&#x6240;&#x4EE5;&#x5F88;&#x7B80;&#x5355;&#x53EA;&#x9700;&#x4E0E;&#x53C2;&#x6570;&#x7684;child&#x505A;&#x5BF9;&#x6BD4;&#x5373;&#x53EF;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun tryCaptureView(child: View?, pointerId: Int): Boolean {</span><br><span class=\"line\">    if (mLeft == 0 || mTop == 0){</span><br><span class=\"line\">        mLeft = mFlexibleView.left</span><br><span class=\"line\">        mTop = mFlexibleView.top</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return child == mHorizontalView || child == mVerticalView || child == mFlexibleView</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x521D;&#x59CB;&#x5316;&#x4E86;&#x4EFB;&#x610F;&#x6ED1;&#x52A8;view&#x7684;&#x521D;&#x59CB;left&#x4E0E;top&#xFF0C;&#x4EE5;&#x4FBF;&#x540E;&#x7EED;&#x4F7F;&#x7528;&#x3002;</p>\n</blockquote>\n<h3 id=\"clampViewPositionHorizontal\"><a href=\"#clampViewPositionHorizontal\" class=\"headerlink\" title=\"clampViewPositionHorizontal\"></a>clampViewPositionHorizontal</h3><p>&#x6709;&#x4E86;view&#x7684;&#x6355;&#x83B7;&#x5224;&#x65AD;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x5BF9;&#x6C34;&#x5E73;&#x65B9;&#x5411;&#x7684;&#x64CD;&#x4F5C;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun clampViewPositionHorizontal(child: View?, left: Int, dx: Int): Int {</span><br><span class=\"line\">    if (child != mVerticalView) {</span><br><span class=\"line\">        return left</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return child.left</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x7684;&#x5404;&#x4E2A;&#x53C2;&#x6570;&#x4E0E;&#x8FD4;&#x56DE;&#x503C;</p>\n<ul>\n<li>child&#xFF1A;&#x5F53;&#x524D;&#x64CD;&#x4F5C;&#x7684;view</li>\n<li>left: &#x5C06;&#x8981;&#x5230;&#x8FBE;&#x7684;&#x6C34;&#x5E73;&#x65B9;&#x5411;&#x7684;&#x8DDD;&#x79BB;</li>\n<li>dx: &#x76F8;&#x5BF9;&#x4E8E;&#x5F53;&#x524D;&#x4F4D;&#x7F6E;&#x7684;&#x504F;&#x79FB;&#x91CF;</li>\n<li>return&#xFF1A;&#x6240;&#x5904;&#x7684;&#x6C34;&#x5E73;&#x8DDD;&#x79BB;</li>\n</ul>\n<p>&#x7531;&#x4E8E;&#x53EA;&#x6709;&#x7AD6;&#x76F4;&#x65B9;&#x5411;&#x7684;view&#x4E0D;&#x80FD;&#x968F;&#x610F;&#x79FB;&#x52A8;&#xFF0C;&#x6240;&#x4EE5;&#x5F53;&#x6355;&#x83B7;&#x7684;view&#x4E3A;&#x7AD6;&#x76F4;&#x65B9;&#x5411;&#x65F6;&#x5C31;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;child.left&#x539F;&#x6765;&#x7684;&#x4F4D;&#x7F6E;&#xFF1B;&#x53CD;&#x4E4B;&#x8FD4;&#x56DE;left&#x3002;</p>\n<h3 id=\"clampViewPositionVertical\"><a href=\"#clampViewPositionVertical\" class=\"headerlink\" title=\"clampViewPositionVertical\"></a>clampViewPositionVertical</h3><p>&#x5BF9;&#x4E8E;&#x7AD6;&#x76F4;&#x65B9;&#x5411;&#x7684;&#x64CD;&#x4F5C;&#x5224;&#x65AD;&#x4E0E;&#x6C34;&#x5E73;&#x65B9;&#x5411;&#x540C;&#x7406;&#xFF0C;&#x770B;&#x4E0B;&#x4EE3;&#x7801;&#x5373;&#x53EF;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun clampViewPositionVertical(child: View?, top: Int, dy: Int): Int {</span><br><span class=\"line\">    if (child != mHorizontalView) {</span><br><span class=\"line\">        return top</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return child.top</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;&#x8FD0;&#x884C;&#x9879;&#x76EE;&#xFF0C;&#x8BE5;demo&#x7684;&#x529F;&#x80FD;&#x57FA;&#x672C;&#x5B8C;&#x6210;&#xFF0C;&#x4E09;&#x4E2A;view&#x90FD;&#x80FD;&#x9884;&#x671F;&#x62D6;&#x52A8;&#x3002;&#x53EA;&#x662F;&#x8981;&#x5230;&#x8FBE;&#x4EFB;&#x610F;view&#x62D6;&#x52A8;&#x4E4B;&#x540E;&#x56DE;&#x5230;&#x521D;&#x59CB;&#x4F4D;&#x7F6E;&#x8FD8;&#x9700;&#x91CD;&#x5199;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<h3 id=\"onViewReleased\"><a href=\"#onViewReleased\" class=\"headerlink\" title=\"onViewReleased\"></a>onViewReleased</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun onViewReleased(releasedChild: View?, xvel: Float, yvel: Float) {</span><br><span class=\"line\">    if (releasedChild == mFlexibleView) {</span><br><span class=\"line\">        mViewDragHelper.settleCapturedViewAt(mLeft, mTop)</span><br><span class=\"line\">        invalidate()</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        super.onViewReleased(releasedChild, xvel, yvel)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x662F;&#x5BF9;view&#x91CA;&#x653E;&#x540E;&#x7684;&#x56DE;&#x8C03;&#x3002;&#x5982;&#x679C;&#x8981;&#x5BF9;view&#x91CA;&#x653E;&#x540E;&#x7684;&#x8F68;&#x8FF9;&#x505A;&#x6539;&#x53D8;&#x53EF;&#x4EE5;&#x5728;&#x8FD9;&#x65B9;&#x6CD5;&#x4E2D;&#x5B9E;&#x73B0;&#x3002;</p>\n<ul>\n<li>releaseChild: &#x5F53;&#x524D;&#x91CA;&#x653E;&#x7684;view</li>\n<li>xvel: &#x6C34;&#x5E73;&#x65B9;&#x5411;&#x7684;&#x901F;&#x5EA6;</li>\n<li>yvel: &#x7AD6;&#x76F4;&#x65B9;&#x5411;&#x7684;&#x901F;&#x5EA6;</li>\n</ul>\n<p>&#x8FD9;&#x91CC;&#x8FD8;&#x4F7F;&#x7528;&#x5230;&#x4E86;<code>settleCapturedViewAt</code>&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x5C06;&#x5F53;&#x524D;view&#x5B9A;&#x4F4D;&#x5230;&#x6240;&#x7ED9;&#x7684;&#x5750;&#x6807;&#x4F4D;&#x7F6E;&#x3002;&#x5185;&#x90E8;&#x4F1A;&#x56DE;&#x5230;<code>continueSettling</code>&#x65B9;&#x6CD5;&#xFF0C;&#x6765;&#x5B9E;&#x73B0;&#x6ED1;&#x52A8;&#x52A8;&#x753B;&#x3002;</p>\n<blockquote>\n<p>xvel&#x4E0E;yvel&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x5B9E;&#x73B0;&#x91CA;&#x653E;view&#x540E;&#x7684;&#x60EF;&#x6027;&#x79FB;&#x52A8;&#x64CD;&#x4F5C;&#x3002;</p>\n</blockquote>\n<p>&#x4ECE;&#x5934;&#x5230;&#x5C3E;&#x53EA;&#x4F7F;&#x7528;&#x4E86;ViewDragHelper.Callback&#x4E2D;&#x7684;&#x56DB;&#x4E2A;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x5B9E;&#x73B0;&#x4E86;demo&#x4E2D;&#x7684;&#x62D6;&#x62FD;&#x6548;&#x679C;&#x3002;&#x76F8;&#x5BF9;&#x4E8E;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#xFF0C;&#x7B80;&#x5355;&#x7A0B;&#x5EA6;&#x4E0D;&#x8A00;&#x800C;&#x55BB;&#x3002;&#x6240;&#x4EE5;&#x719F;&#x7EC3;&#x4F7F;&#x7528;ViewDragHelper&#x4E0D;&#x4EC5;&#x80FD;&#x63D0;&#x9AD8;&#x6211;&#x4EEC;&#x7684;&#x5B9E;&#x73B0;&#x6548;&#x7387;&#x4E0E;&#x4EE3;&#x7801;&#x8D28;&#x91CF;&#x8FD8;&#x80FD;&#x51CF;&#x5C11;&#x51FA;&#x9519;&#x7387;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x5176;&#x5B83;&#x7684;Api&#x90FD;&#x662F;&#x4E9B;&#x72B6;&#x6001;&#x6539;&#x53D8;&#x7684;&#x56DE;&#x8C03;&#xFF0C;&#x5728;&#x5B9E;&#x9645;&#x4E2D;&#x4E5F;&#x7528;&#x7684;&#x5C11;&#xFF0C;&#x624B;&#x52BF;&#x7684;&#x64CD;&#x4F5C;&#x903B;&#x8F91;&#x90FD;&#x4E0D;&#x4F1A;&#x5728;&#x8FD9;&#x4E9B;Api&#x4E2D;&#x5B9E;&#x73B0;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x591A;&#x4ECB;&#x7ECD;&#x3002;&#x4E0A;&#x9762;&#x7684;demo view&#x62D6;&#x62FD;&#x8D85;&#x51FA;&#x8FB9;&#x754C;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x56FA;&#x5B9A;&#x8FB9;&#x754C;&#xFF0C;&#x53EA;&#x9700;&#x5728;clampViewPositionHorizontal&#x4E0E;clampViewPositionVertical&#x4E2D;&#x8FB9;&#x754C;&#x5224;&#x65AD;&#x5373;&#x53EF;&#xFF0C;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x7559;&#x7ED9;&#x8BFB;&#x8005;&#x601D;&#x8003;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6709;&#x4E00;&#x4E2A;&#x6CE8;&#x610F;&#x7684;&#x70B9;&#xFF1A;&#x5982;&#x679C;&#x4F7F;&#x7528;Button&#x6216;&#x8005;TextView&#x8BBE;&#x7F6E;&#x4E86;clickable=true&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x4E0A;&#x9762;&#x7684;Demo&#x4E2D;&#x7684;view&#x4E0D;&#x80FD;&#x64CD;&#x4F5C;&#x4E86;&#x3002;&#x4E3B;&#x8981;&#x539F;&#x56E0;&#x662F;&#xFF0C;&#x5982;&#x679C;view&#x4E0D;&#x6D88;&#x8D39;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;&#xFF0C;&#x5219;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;&#x5C06;&#x76F4;&#x63A5;&#x8FDB;&#x5165;<code>onTouchEvent</code>&#xFF0C;&#x5728;Down&#x4E8B;&#x4EF6;&#x4E2D;&#x5C31;&#x5DF2;&#x7ECF;&#x786E;&#x5B9A;&#x4E86;&#x6355;&#x83B7;&#x7684;view&#xFF1B;&#x5982;&#x679C;&#x6D88;&#x8D39;&#x4E8B;&#x4EF6;&#xFF0C;&#x4F1A;&#x8FDB;&#x5165;<code>onInterceptTouchEvent</code>&#x5224;&#x65AD;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x6355;&#x83B7;&#xFF0C;&#x800C;&#x5224;&#x65AD;&#x7684;&#x8FC7;&#x7A0B;&#x4F1A;&#x53BB;&#x8C03;&#x7528;<code>getViewHorizontalDragRange</code>&#x4E0E;<code>getViewVerticalDragRange</code>&#xFF0C;&#x53EA;&#x6709;&#x8FD9;&#x4E24;&#x4E2A;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x5927;&#x4E8E;0&#x7684;&#x503C;&#x624D;&#x80FD;&#x88AB;&#x6355;&#x83B7;&#x3002;&#x6240;&#x4EE5;&#x8981;&#x89E3;&#x51B3;&#x62D6;&#x62FD;&#x4E0D;&#x52A8;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x53EA;&#x9700;&#x91CD;&#x5199;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun getViewHorizontalDragRange(child: View?): Int {</span><br><span class=\"line\">    return measuredWidth - (child?.measuredWidth?:0)</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">override fun getViewVerticalDragRange(child: View?): Int {</span><br><span class=\"line\">    return measuredHeight - (child?.measuredHeight?:0)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"finally\"><a href=\"#finally\" class=\"headerlink\" title=\"finally\"></a>finally</h2><p>ok&#xFF0C;&#x5230;&#x8FD9;&#x91CC;ViewDragHelper&#x5DF2;&#x7ECF;&#x5B8C;&#x5168;&#x5165;&#x95E8;&#x4E86;&#xFF0C;&#x5E76;&#x4E14;&#x5173;&#x952E;&#x7684;Api&#x4E5F;&#x5DF2;&#x7ECF;&#x4E86;&#x7136;&#x4E8E;&#x80F8;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x5B9E;&#x9645;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;ViewDragHelper&#x7684;&#x6548;&#x679C;&#x56FE;&#xFF0C;&#x4E0E;&#x997F;&#x4E86;&#x4E48;&#x7684;&#x5546;&#x54C1;&#x8BE6;&#x60C5;&#x754C;&#x9762;&#x6548;&#x679C;&#x7C7B;&#x4F3C;&#x3002;</p>\n<p><img src=\"/2018/08/19/ViewDragHelper&#x4E4B;&#x624B;&#x52BF;&#x64CD;&#x4F5C;&#x795E;&#x5668;/view_drag_helper_real.gif\" alt></p>\n<p>&#x4E0A;&#x9762;&#x7684;&#x624B;&#x52BF;&#x52A8;&#x753B;&#x4F7F;&#x7528;&#x7684;&#x5C31;&#x662F;ViewDragHelper&#xFF0C;&#x800C;&#x7528;&#x5230;&#x7684;Api&#x4E5F;&#x662F;&#x5168;&#x90E8;&#x662F;&#x6587;&#x7AE0;&#x4E2D;&#x63D0;&#x5230;&#x7684;&#x3002;&#x5E0C;&#x671B;&#x901A;&#x8FC7;&#x6587;&#x7AE0;&#x4E2D;&#x7684;demo&#x6548;&#x679C;&#x80FD;&#x591F;&#x52A0;&#x6DF1;ViewDragHelper&#x5BF9;&#x5927;&#x5BB6;&#x7684;&#x5F71;&#x54CD;&#x4E0E;&#x5BF9;&#x5B83;&#x7684;&#x671F;&#x671B;&#x5EA6;&#xFF0C;&#x4E5F;&#x5E0C;&#x671B;&#x5728;&#x65E5;&#x5E38;&#x5F00;&#x53D1;&#x4E2D;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x5927;&#x5BB6;&#x8F7B;&#x677E;&#x89E3;&#x51B3;&#x624B;&#x52BF;&#x95EE;&#x9898;&#x3002;</p>\n<p>&#x6587;&#x7AE0;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x53EF;&#x4EE5;&#x5728;<a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">Github&#x4E2D;</a>&#x83B7;&#x53D6;&#x5230;&#x3002;&#x4F7F;&#x7528;&#x65F6;&#x8BF7;&#x5C06;&#x5206;&#x652F;&#x5207;&#x6362;&#x5230;<code>feat_viewdraghelper_dev</code></p>\n<h2 id=\"&#x5173;&#x6CE8;\"><a href=\"#&#x5173;&#x6CE8;\" class=\"headerlink\" title=\"&#x5173;&#x6CE8;\"></a>&#x5173;&#x6CE8;</h2><p>&#x516C;&#x4F17;&#x53F7;&#xFF1A;&#x602A;&#x8C08;&#x65F6;&#x95F4;&#x5230;&#x4E86;</p>\n<p><img src=\"/2018/08/19/ViewDragHelper&#x4E4B;&#x624B;&#x52BF;&#x64CD;&#x4F5C;&#x795E;&#x5668;/wx.jpg\" alt></p>\n","categories":["android"],"tags":["ViewDragHelper"]},{"title":"自定义Android注解Part3:绑定","url":"https://www.rousetime.com/2018/07/11/自定义Android注解Part3-绑定/","content":"<p><img src=\"/2018/07/11/&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;Part3-&#x7ED1;&#x5B9A;/2018-07-11-2.jpeg\" alt></p>\n<p>&#x4E0A;&#x4E00;&#x8282;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5C06;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x6CE8;&#x89E3;&#x4EE3;&#x7801;&#x90E8;&#x5206;&#x4ECB;&#x7ECD;&#x5B8C;&#x6BD5;&#xFF0C;&#x4ECA;&#x5929;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x662F;&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;&#x7CFB;&#x5217;&#x7684;&#x6700;&#x540E;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x3002;&#x5E0C;&#x671B;&#x5927;&#x5BB6;&#x8FD9;&#x4E00;&#x8DEF;&#x8D70;&#x6765;&#x6709;&#x6240;&#x6536;&#x83B7;&#x3002;</p>\n<p>&#x7ECF;&#x8FC7;&#x524D;&#x9762;&#x7684;&#x4E86;&#x89E3;&#xFF0C;&#x6211;&#x4EEC;&#x4E09;&#x5927;&#x90E8;&#x5206;&#xFF1A;butterknife-annotations&#x3001;butterknife-compiler&#x4E0E;butterknife-bind&#x3002;&#x73B0;&#x5728;&#x5C31;&#x5269;&#x4E0B;&#x6700;&#x540E;&#x4E00;&#x90E8;&#x5206;butterknife-bind&#x3002;&#x8BE5;&#x90E8;&#x5206;&#x662F;&#x5BF9;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x5B9A;&#x4E49;&#x7684;&#x6CE8;&#x89E3;&#x53D8;&#x91CF;&#x4E0E;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#xFF0C;&#x5373;&#x8C03;&#x7528;&#x6211;&#x4EEC;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x6765;&#x770B;&#x4E0B;butterknife-bind&#x6A21;&#x677F;&#x5E93;&#x7684;&#x7ED3;&#x6784;&#xFF1A;</p>\n<p><img src=\"/2018/07/11/&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;Part3-&#x7ED1;&#x5B9A;/2018-07-11-1.png\" alt></p>\n<p>&#x53EA;&#x6709;Butterknife&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x5728;&#x8FD9;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x5C06;&#x524D;&#x9762;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5B9A;&#x4E49;&#x597D;&#x7684;module&#x5F15;&#x5165;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    compile project(path: &apos;:butterknife-annotations&apos;)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6709;&#x4E86;&#x4E4B;&#x524D;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x6211;&#x4EEC;<strong>Make Project</strong>&#x9879;&#x76EE;&#x5DE5;&#x7A0B;&#xFF0C;&#x4E4B;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x627E;&#x5230;MainActivity$Binding&#x7C7B;&#xFF0C;&#x6216;&#x8005;&#x76F4;&#x63A5;&#x5728;<strong>/app/build/generated/source/kapt/debug/</strong>&#x76EE;&#x5F55;&#x4E0B;&#x67E5;&#x627E;&#x3002;</p>\n<h2 id=\"Bind\"><a href=\"#Bind\" class=\"headerlink\" title=\"Bind\"></a>Bind</h2><p>MainActivity$Binding&#x5728;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#x5C31;&#x5DF2;&#x7ECF;&#x8C03;&#x7528;&#x4E86;&#x6211;&#x4EEC;&#x7684;&#x9700;&#x8981;&#x7684;bindView&#x4E0E;setOnClickListener&#x65B9;&#x6CD5;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x7684;&#x8BDD;&#x53EA;&#x9700;&#x5B9E;&#x4F8B;&#x5316;&#x5373;&#x53EF;&#x3002;&#x4F46;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x662F;&#x8BE5;&#x7C7B;&#x662F;&#x901A;&#x8FC7;&#x6CE8;&#x89E3;&#x5904;&#x7406;&#x5668;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x77E5;&#x9053;&#x5B83;&#x7684;&#x7C7B;&#x540D;&#x5168;&#x79F0;(&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x76F8;&#x5F53;&#x4E8E;&#x67E5;&#x770B;&#x4E86;&#x6E90;&#x7801;&#xFF0C;&#x624D;&#x77E5;&#x9053;&#x662F;&#x4EE5;$Binding&#x7ED3;&#x5C3E;)&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x662F;&#x4E0D;&#x80FD;&#x901A;&#x8FC7;<strong>new</strong>&#x5173;&#x952E;&#x5B57;&#x6765;&#x5B9E;&#x4F8B;&#x5316;&#x3002;&#x5982;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x53C8;&#x8BE5;&#x5982;&#x4F55;&#x5B9E;&#x4F8B;&#x5316;&#x5B83;&#x5462;&#xFF1F;&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;butterknife-bind&#x4E2D;&#x7684;&#x552F;&#x4E00;&#x7684;&#x7C7B;Butterknife</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Butterknife {</span><br><span class=\"line\"> </span><br><span class=\"line\">    private Butterknife() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    private static &lt;T extends Activity&gt; void initialization(T target, String suffix) {</span><br><span class=\"line\">        Class&lt;?&gt; tClass = target.getClass();</span><br><span class=\"line\">        String className = tClass.getName();</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            Class&lt;?&gt; bindingClass = tClass.getClassLoader().loadClass(className + suffix);</span><br><span class=\"line\">            Constructor&lt;?&gt; constructor = bindingClass.getConstructor(tClass);</span><br><span class=\"line\">            constructor.newInstance(target);</span><br><span class=\"line\">        } catch (ClassNotFoundException e) {</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        } catch (NoSuchMethodException e) {</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        } catch (InstantiationException e) {</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        } catch (IllegalAccessException e) {</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        } catch (InvocationTargetException e) {</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    public static void bind(Activity activity) {</span><br><span class=\"line\">        initialization(activity, ConstantUtils.BINDING_BUTTERKNIFE_SUFFIX);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;initialization&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;<strong>java&#x53CD;&#x5C04;</strong>&#x6765;&#x5B9E;&#x4F8B;&#x5316;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;MainActivity$Binding&#x3002;&#x65E2;&#x7136;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x7C7B;&#x662F;&#x7531;&#x539F;&#x59CB;&#x7C7B;(MainActivity)+&#x540E;&#x7F00;($Binding)&#x7EC4;&#x6210;&#x3002;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x7684;&#x4F7F;&#x7528;java&#x53CD;&#x5C04;&#x6765;&#x5B9E;&#x4F8B;&#x5316;&#x6240;&#x9700;&#x7684;&#x7C7B;&#x3002;&#x5BF9;&#x4E8E;&#x5916;&#x754C;&#x7684;&#x8C03;&#x7528;&#x53EA;&#x9700;&#x4F7F;&#x7528;bind&#x65B9;&#x6CD5;&#xFF0C;&#x4F20;&#x5165;&#x9700;&#x8981;&#x7ED1;&#x5B9A;&#x7684;&#x7C7B;&#x5373;&#x53EF;&#x3002;</p>\n<h2 id=\"Use\"><a href=\"#Use\" class=\"headerlink\" title=\"Use\"></a>Use</h2><p>&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x6240;&#x4EE5;&#x7684;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x5728;MainActivity&#x4E2D;&#x4F7F;&#x7528;&#x3002;&#x9996;&#x5148;&#x5C06;&#x5B9A;&#x4E49;&#x7684;&#x5E93;&#x8FDB;&#x884C;&#x4F9D;&#x8D56;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    implementation project(&apos;:butterknife-bind&apos;)</span><br><span class=\"line\">    kapt project(&apos;:butterknife-compiler&apos;)</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x5728;MainActivity&#x4E2D;&#x4F7F;&#x7528;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class MainActivity : AppCompatActivity() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    @BindView(R.id.public_service, R.string.public_service)</span><br><span class=\"line\">    lateinit var sName: TextView</span><br><span class=\"line\"> </span><br><span class=\"line\">    @BindView(R.id.personal_wx, R.string.personal_wx)</span><br><span class=\"line\">    lateinit var sPhone: TextView</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) {</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\">        Butterknife.bind(this)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @OnClick(R.id.public_service)</span><br><span class=\"line\">    fun nameClick(view: View) {</span><br><span class=\"line\">        Toast.makeText(this, getString(R.string.public_service_click_toast), Toast.LENGTH_LONG).show()</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @OnClick(R.id.personal_wx)</span><br><span class=\"line\">    fun phoneClick(view: View) {</span><br><span class=\"line\">        Toast.makeText(this, getString(R.string.personal_wx_click_toast), Toast.LENGTH_LONG).show()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x4F7F;&#x7528;@BindView&#x7ED1;&#x5B9A;View&#x7684;Id&#x4E0E;&#x9ED8;&#x8BA4;&#x503C;&#xFF1B;&#x4F7F;&#x7528;@OnClick&#x7ED1;&#x5B9A;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#xFF1B;&#x4F7F;&#x7528;Butterknife.bind(this)&#x7ED1;&#x5B9A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6CE8;&#x89E3;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x4E86;&#x4E0E;&#x5F00;&#x6E90;&#x5E93;Butterknife&#x76F8;&#x4F3C;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<h2 id=\"progurad\"><a href=\"#progurad\" class=\"headerlink\" title=\"progurad\"></a>progurad</h2><p>&#x73B0;&#x5728;&#x4F60;&#x5728;&#x6A21;&#x62DF;&#x5668;&#x6216;&#x8005;&#x771F;&#x673A;&#x4E0A;&#x8DD1;&#x7740;&#x975E;&#x5E38;&#x5B8C;&#x7F8E;&#xFF0C;&#x7136;&#x540E;&#x4F60;&#x4E0D;&#x5C0F;&#x5FC3;&#x5207;&#x6362;&#x5230;<strong>release</strong>&#x7248;&#x672C;&#x5E76;&#x4E14;&#x5F00;&#x542F;&#x4E86;<strong>&#x6DF7;&#x6DC6;</strong>&#x529F;&#x80FD;&#x3002;&#x8FD9;&#x65F6;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;mmp&#x5C45;&#x7136;&#x6CA1;&#x6709;&#x6548;&#x679C;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;debug&#x4E0E;release&#x7684;&#x533A;&#x522B;&#xFF0C;&#x7EDD;&#x5927;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x662F;&#x6DF7;&#x6DC6;&#x60F9;&#x7684;&#x7978;&#x3002;&#x6211;&#x4EEC;&#x5728;&#x5B9E;&#x4F8B;&#x5316;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x7C7B;&#x65F6;&#x4F7F;&#x7528;&#x7684;&#x662F;java&#x53CD;&#x5C04;&#x673A;&#x5236;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x65E6;&#x6DF7;&#x6DC6;&#x4E86;&#x6211;&#x4EEC;&#x7684;java&#x53CD;&#x5C04;&#x5C31;&#x627E;&#x4E0D;&#x5230;&#x6211;&#x4EEC;&#x6307;&#x5B9A;&#x7684;&#x7C7B;&#x540D;&#xFF0C;&#x8FD9;&#x6837;&#x81EA;&#x7136;&#x4E5F;&#x5C31;&#x6CA1;&#x6709;&#x6548;&#x679C;&#x4E86;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x53C8;&#x8BE5;&#x5982;&#x4F55;&#x89E3;&#x51B3;&#x5462;&#xFF1F;&#x522B;&#x6025;&#xFF0C;&#x662F;&#x5426;&#x8FD8;&#x8BB0;&#x5F97;&#x5728;&#x7CFB;&#x5217;&#x7684;<strong>Part1</strong>&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x6CE8;&#x89E3;&#x53D8;&#x91CF;&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;<strong>@Keep</strong>&#x3002;</p>\n<p>&#x5728;MainActivity$Binding&#x7C7B;&#x4E0A;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86;@Keep&#x6765;&#x6807;&#x8BC6;&#x8BE5;&#x7C7B;&#xFF0C;&#x901A;&#x8FC7;&#x8BE5;&#x6807;&#x8BC6;&#x544A;&#x8BC9;proguard&#x4E0D;&#x53BB;&#x6DF7;&#x6DC6;&#x4F7F;&#x7528;@Keep&#x6807;&#x8BB0;&#x7684;&#x7C7B;&#x3002;&#x8981;&#x8FBE;&#x5230;&#x8FD9;&#x79CD;&#x6548;&#x679C;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x7ECF;&#x8FC7;&#x4EE5;&#x4E0B;&#x4E24;&#x4E2A;&#x6B65;&#x9AA4;&#xFF1A;</p>\n<p>1.&#x5728;butterknife-bind&#x7684;proguard-rules.pro&#x6587;&#x4EF6;&#x4E2D;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-keep class com.idisfkj.butterknife.annotations.Keep**</span><br><span class=\"line\">-keep @com.idisfkj.butterknife.annotations.Keep public class *</span><br><span class=\"line\">-keepclassmembers @com.idisfkj.butterknife.annotations.Keep class ** {*;}</span><br></pre></td></tr></table></figure>\n<p>2.&#x4E3A;&#x4E86;&#x662F;&#x4F9D;&#x8D56;&#x5E93;&#x7684;&#x6DF7;&#x6DC6;&#x751F;&#x6548;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x4F7F;&#x7528;consumerProguardFiles&#x58F0;&#x660E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defaultConfig {</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    consumerProguardFiles &apos;proguard-rules.pro&apos; //&#x4F9D;&#x8D56;&#x5E93;&#x6DF7;&#x6DC6;&#x751F;&#x6548;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5B8C;&#x6210;&#x8FD9;&#x4E24;&#x6B65;&#x540E;&#x6211;&#x4EEC;&#x5728;&#x91CD;&#x65B0;&#x6784;&#x5EFA;release&#x7248;&#x672C;&#xFF0C;&#x8FD9;&#x65F6;&#x7A0B;&#x5E8F;&#x5B8C;&#x7F8E;&#x8FD0;&#x884C;&#x3002;&#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x7684;&#x4F11;&#x606F;&#x4F1A;&#x4E86;&#xFF01;</p>\n<h2 id=\"End\"><a href=\"#End\" class=\"headerlink\" title=\"End\"></a>End</h2><p>&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;&#x7CFB;&#x5217;&#x5B8C;&#x7F8E;&#x6536;&#x5DE5;&#xFF0C;&#x5E0C;&#x671B;&#x901A;&#x8FC7;&#x8FD9;&#x4E09;&#x90E8;&#x66F2;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x5927;&#x5BB6;&#x5B66;&#x4F1A;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x6CE8;&#x89E3;&#x5E93;&#x3002;&#x6700;&#x540E;&#x5E0C;&#x671B;&#x5927;&#x5BB6;&#x70B9;&#x8D5E;&#x652F;&#x6301;&#x4E00;&#x4E0B;&#xFF0C;&#x8C22;&#x8C22;&#xFF01;</p>\n<p>&#x6587;&#x7AE0;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x53EF;&#x4EE5;&#x5728;<a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">Github</a>&#x4E2D;&#x83B7;&#x53D6;&#x5230;&#x3002;&#x4F7F;&#x7528;&#x65F6;&#x8BF7;&#x5C06;&#x5206;&#x652F;&#x5207;&#x6362;&#x5230;<strong>feat_annotation_processing</strong></p>\n<h2 id=\"&#x76F8;&#x5173;&#x6587;&#x7AE0;\"><a href=\"#&#x76F8;&#x5173;&#x6587;&#x7AE0;\" class=\"headerlink\" title=\"&#x76F8;&#x5173;&#x6587;&#x7AE0;\"></a>&#x76F8;&#x5173;&#x6587;&#x7AE0;</h2><p><a href=\"https://idisfkj.github.io/2018/07/01/%E8%87%AA%E5%AE%9A%E4%B9%89Android%E6%B3%A8%E8%A7%A3Part1-%E6%B3%A8%E8%A7%A3%E5%8F%98%E9%87%8F/\" target=\"_blank\" rel=\"noopener\">&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;Part1:&#x6CE8;&#x89E3;&#x53D8;&#x91CF;</a></p>\n<p><a href=\"https://idisfkj.github.io/2018/07/04/%E8%87%AA%E5%AE%9A%E4%B9%89Android%E6%B3%A8%E8%A7%A3Part2-%E4%BB%A3%E7%A0%81%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90/\" target=\"_blank\" rel=\"noopener\">&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;Part2:&#x4EE3;&#x7801;&#x81EA;&#x52A8;&#x751F;&#x6210;</a></p>\n<h2 id=\"&#x5173;&#x6CE8;\"><a href=\"#&#x5173;&#x6CE8;\" class=\"headerlink\" title=\"&#x5173;&#x6CE8;\"></a>&#x5173;&#x6CE8;</h2><p>&#x516C;&#x4F17;&#x53F7;&#xFF1A;&#x602A;&#x8C08;&#x65F6;&#x95F4;&#x5230;&#x4E86;</p>\n<p><img src=\"/2018/07/11/&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;Part3-&#x7ED1;&#x5B9A;/wx.jpg\" alt=\"&#x602A;&#x8C08;&#x65F6;&#x95F4;&#x5230;&#x4E86;\"></p>\n","categories":["android"],"tags":["Android Annotation Processing"]},{"title":"自定义Android注解Part2:代码自动生成","url":"https://www.rousetime.com/2018/07/04/自定义Android注解Part2-代码自动生成/","content":"<p><img src=\"/2018/07/04/&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;Part2-&#x4EE3;&#x7801;&#x81EA;&#x52A8;&#x751F;&#x6210;/2018-07-10.jpg\" alt></p>\n<p>&#x4E0A;&#x4E00;&#x671F;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x628A;butterknife-annotations&#x4E2D;&#x7684;&#x6CE8;&#x89E3;&#x53D8;&#x91CF;&#x90FD;&#x5DF2;&#x7ECF;&#x5B9A;&#x4E49;&#x597D;&#x4E86;&#xFF0C;&#x5206;&#x522B;&#x4E3A;BindView&#x3001;OnClick&#x4E0E;Keep&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x662F;&#x7B2C;&#x4E00;&#x6B21;&#x8FDB;&#x5165;&#x672C;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#xFF0C;&#x5F3A;&#x70C8;&#x63A8;&#x8350;&#x8DF3;&#x5230;&#x6587;&#x7AE0;&#x672B;&#x5C3E;&#x67E5;&#x770B;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x8981;&#x4E0D;&#x7136;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x70B9;&#x4E91;&#x91CC;&#x96FE;&#x91CC;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x5F15;&#x7528;&#x7684;&#x8BDD;&#xFF0C;&#x5B83;&#x5C06;&#x4E0E;&#x5F00;&#x6E90;&#x5E93;ButterKnife&#x7684;&#x64CD;&#x4F5C;&#x7C7B;&#x4F3C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class MainActivity : AppCompatActivity() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    @BindView(R.id.public_service, R.string.public_service)</span><br><span class=\"line\">    lateinit var sName: TextView</span><br><span class=\"line\"> </span><br><span class=\"line\">    @BindView(R.id.personal_wx, R.string.personal_wx)</span><br><span class=\"line\">    lateinit var sPhone: TextView</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) {</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\">        Butterknife.bind(this)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @OnClick(R.id.public_service)</span><br><span class=\"line\">    fun nameClick(view: View) {</span><br><span class=\"line\">        Toast.makeText(this, getString(R.string.public_service_click_toast), Toast.LENGTH_LONG).show()</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @OnClick(R.id.personal_wx)</span><br><span class=\"line\">    fun phoneClick(view: View) {</span><br><span class=\"line\">        Toast.makeText(this, getString(R.string.personal_wx_click_toast), Toast.LENGTH_LONG).show()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;@BindView&#x6765;&#x7ED1;&#x5B9A;&#x6211;&#x7684;View&#xFF0C;&#x4F7F;&#x7528;@OnClick&#x6765;&#x7ED1;&#x5B9A;View&#x7684;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x3002;&#x4F7F;&#x7528;Butterknife.bind&#x6765;&#x7ED1;&#x5B9A;&#x8BE5;Class&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x7528;&#x6765;&#x5B9E;&#x4F8B;&#x5316;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x7C7B;&#x3002;(&#x8BE5;&#x90E8;&#x5206;&#x4E0B;&#x7BC7;&#x6587;&#x7AE0;&#x5C06;&#x63D0;&#x53CA;)</p>\n<p>&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49;&#x7684;&#x7ED1;&#x5B9A;&#x6CE8;&#x89E3;&#x5E93;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x4E86;1/3&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5C06;&#x5B9E;&#x73B0;&#x5B83;&#x7684;&#x4EE3;&#x7801;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x90E8;&#x5206;&#x3002;&#x8FD9;&#x65F6;&#x5C31;&#x5230;&#x4E86;&#x4E0A;&#x671F;&#x63D0;&#x5230;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;Module&#xFF1A;butterknife-compiler&#x3002;</p>\n<p><img src=\"/2018/07/04/&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;Part2-&#x4EE3;&#x7801;&#x81EA;&#x52A8;&#x751F;&#x6210;/1.png\" alt></p>\n<p><strong>NameUtils</strong>&#x662F;&#x4E00;&#x4E9B;&#x5E38;&#x91CF;&#x7684;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x7C7B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">final class NameUtils {</span><br><span class=\"line\"> </span><br><span class=\"line\">    static String getAutoGeneratorTypeName(String typeName) {</span><br><span class=\"line\">        return typeName + ConstantUtils.BINDING_BUTTERKNIFE_SUFFIX;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    static class Package{</span><br><span class=\"line\">        static final String ANDROID_VIEW = &quot;android.view&quot;;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    static class Class {</span><br><span class=\"line\">        static final String CLASS_VIEW = &quot;View&quot;;</span><br><span class=\"line\">        static final String CLASS_ON_CLICK_LISTENER = &quot;OnClickListener&quot;;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    static class Method{</span><br><span class=\"line\">        static final String BIND_VIEW = &quot;bindView&quot;;</span><br><span class=\"line\">        static final String SET_ON_CLICK_LISTENER = &quot;setOnClickListener&quot;;</span><br><span class=\"line\">        static final String ON_CLICK = &quot;onClick&quot;;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    static class Variable{</span><br><span class=\"line\">        static final String ANDROID_ACTIVITY = &quot;activity&quot;;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>NameUitls&#x5305;&#x542B;&#x4E86;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x7C7B;&#x540D;&#x79F0;&#xFF0C;&#x5305;&#x540D;&#xFF0C;&#x65B9;&#x6CD5;&#x540D;&#xFF0C;&#x53D8;&#x91CF;&#x540D;&#x3002;&#x603B;&#x4E4B;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x4EE3;&#x7801;&#x66F4;&#x5065;&#x5168;&#xFF0C;&#x65B9;&#x4FBF;&#x7BA1;&#x7406;&#x3002;</p>\n<p>&#x7B2C;&#x4E8C;&#x4E2A;&#x7C7B;Processor&#x662F;&#x4ECA;&#x5929;&#x7684;&#x91CD;&#x4E2D;&#x4E4B;&#x91CD;&#x3002;&#x4E5F;&#x662F;&#x6CE8;&#x89E3;&#x5E93;&#x4EE3;&#x7801;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x6838;&#x5FC3;&#x90E8;&#x5206;&#x3002;&#x7531;&#x4E8E;&#x6CE8;&#x89E3;&#x7684;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x4EE3;&#x7801;&#x90FD;&#x662F;&#x5728;&#x6CE8;&#x89E3;&#x8FDB;&#x7A0B;&#x4E2D;&#x8FDB;&#x884C;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5B83;&#x7EE7;&#x627F;&#x4E8E;<strong>AbstractProcessor</strong>&#xFF0C;&#x5176;&#x4E2D;&#x4E3B;&#x8981;&#x6709;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x3002;</p>\n<ol>\n<li>init&#xFF1A;&#x521D;&#x59CB;&#x5316;&#x5FC5;&#x8981;&#x7684;&#x6570;&#x636E;</li>\n<li>getSupportedAnnotationTypes&#xFF1A;&#x6240;&#x652F;&#x6301;&#x7684;&#x6CE8;&#x89E3;</li>\n<li>process&#xFF1A;&#x89E3;&#x6790;&#x6CE8;&#x89E3;&#xFF0C;&#x7F16;&#x5199;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x4EE3;&#x7801;</li>\n</ol>\n<h2 id=\"init\"><a href=\"#init\" class=\"headerlink\" title=\"init\"></a>init</h2><p>&#x4ECE;&#x7B80;&#x5355;&#x5230;&#x5BB9;&#x6613;&#xFF0C;&#x5148;&#x662F;init&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x770B;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">public synchronized void init(ProcessingEnvironment processingEnv) {</span><br><span class=\"line\">    super.init(processingEnv);</span><br><span class=\"line\">    mFiler = processingEnv.getFiler();</span><br><span class=\"line\">    mMessager = processingEnv.getMessager();</span><br><span class=\"line\">    mElementUtils = processingEnv.getElementUtils();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x65B9;&#x6CD5;&#x53C2;&#x6570;processingEnv&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x6CE8;&#x89E3;&#x5904;&#x7406;&#x6240;&#x9700;&#x7684;&#x73AF;&#x5883;&#x72B6;&#x6001;&#x3002;&#x6211;&#x4EEC;&#x901A;&#x8FC7;getFiler()&#x3001;getMessager()&#x4E0E;getElementUthis()&#x65B9;&#x6CD5;&#xFF0C;&#x5206;&#x522B;&#x83B7;&#x53D6;&#x521B;&#x5EFA;&#x6E90;&#x4EE3;&#x7801;&#x7684;Filer&#x3001;&#x6D88;&#x606F;&#x53D1;&#x9001;&#x5668;Messager(&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x5411;&#x5916;&#x754C;&#x53D1;&#x9001;&#x9519;&#x8BEF;&#x4FE1;&#x606F;)&#x4E0E;&#x89E3;&#x6790;&#x6CE8;&#x89E3;&#x5143;&#x7D20;&#x6240;&#x9700;&#x7684;&#x901A;&#x7528;&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#xFF1A;&#x5F53;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x6784;&#x5EFA;&#x597D;&#x4E86;&#x9700;&#x8981;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x7C7B;&#xFF0C;&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Filter&#x6765;&#x5C06;&#x4EE3;&#x7801;&#x5199;&#x5165;&#x5230;java&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x5982;&#x9047;&#x9519;&#x8BEF;&#x4F7F;&#x7528;Messager&#x5C06;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x53D1;&#x9001;&#x51FA;&#x53BB;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//&#x5199;&#x5165;java&#x6587;</span><br><span class=\"line\">try {</span><br><span class=\"line\">    JavaFile.builder(packageName, typeBuilder.build()).build().writeTo(mFiler)</span><br><span class=\"line\">} catch (IOException e) {</span><br><span class=\"line\">    mMessager.printMessage(Diagnostic.Kind.ERROR, e.getMessage(), typeElement);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4EE3;&#x7801;&#x4E2D;&#x7684;JavaFile&#x4E0E;typeBuilder&#x90FD;&#x662F;JavaPoet&#x4E2D;&#x7684;&#x7C7B;&#x3002;JavaPote&#x4E3B;&#x8981;&#x63D0;&#x4F9B;Java API&#x6765;&#x5E2E;&#x52A9;&#x751F;&#x6210;<code>.java</code>&#x8D44;&#x6E90;&#x6587;&#x4EF6;&#x3002;</p>\n<h2 id=\"getSupportedAnnotationTypes\"><a href=\"#getSupportedAnnotationTypes\" class=\"headerlink\" title=\"getSupportedAnnotationTypes\"></a>getSupportedAnnotationTypes</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">public Set&lt;String&gt; getSupportedAnnotationTypes() {</span><br><span class=\"line\">    return new TreeSet&lt;&gt;(Arrays.asList(</span><br><span class=\"line\">            BindView.class.getCanonicalName(),</span><br><span class=\"line\">            OnClick.class.getCanonicalName(),</span><br><span class=\"line\">            Keep.class.getCanonicalName())</span><br><span class=\"line\">    );</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x770B;&#x65B9;&#x6CD5;&#x540D;&#x5C31;&#x77E5;&#x9053;&#x4E86;&#xFF0C;&#x5305;&#x542B;&#x6240;&#x652F;&#x6301;&#x7684;&#x6CE8;&#x89E3;&#xFF0C;&#x5C06;&#x5176;&#x901A;&#x8FC7;set&#x96C6;&#x5408;&#x6765;&#x8FD4;&#x56DE;&#x3002;&#x8FD9;&#x91CC;&#x5C06;&#x6211;&#x4EEC;&#x4E0A;&#x4E00;&#x671F;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6CE8;&#x89E3;&#x6DFB;&#x52A0;&#x5230;set&#x96C6;&#x5408;&#x4E2D;&#x5373;&#x53EF;&#x3002;</p>\n<h2 id=\"process\"><a href=\"#process\" class=\"headerlink\" title=\"process\"></a>process</h2><p>&#x5230;&#x4E86;&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x6838;&#x5FC3;&#xFF0C;process&#x7528;&#x6765;&#x751F;&#x6210;&#x4E0E;&#x6CE8;&#x89E3;&#x76F8;&#x5339;&#x914D;&#x7684;&#x65B9;&#x6CD5;&#x4EE3;&#x7801;&#x3002;&#x901A;&#x8FC7;&#x89E3;&#x6790;Class&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x6CE8;&#x89E3;&#xFF0C;&#x751F;&#x6210;&#x4E0E;&#x6CE8;&#x89E3;&#x76F8;&#x5173;&#x8054;&#x7684;&#x7C7B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">public boolean process(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv) {</span><br><span class=\"line\">    ....</span><br><span class=\"line\">    ....</span><br><span class=\"line\">    return true;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF1A;annotations&#x4E0E;roundEnv&#xFF0C;&#x5206;&#x522B;&#x4EE3;&#x8868;&#x9700;&#x8981;&#x5904;&#x7406;&#x7684;&#x6CE8;&#x89E3;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4EE3;&#x8868;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6CE8;&#x89E3;&#xFF1B;&#x6CE8;&#x89E3;&#x5904;&#x7406;&#x5668;&#x6240;&#x9700;&#x7684;&#x73AF;&#x5883;&#xFF0C;&#x5E2E;&#x52A9;&#x8FDB;&#x884C;&#x89E3;&#x6790;&#x6CE8;&#x89E3;&#x3002;</p>\n<p>&#x5728;&#x5F00;&#x59CB;&#x89E3;&#x6790;&#x6CE8;&#x89E3;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x5148;&#x8FC7;&#x6EE4;&#x6211;&#x4EEC;&#x6240;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x6CE8;&#x89E3;&#x3002;&#x56DE;&#x5934;&#x770B;getSupportedAnnotationTypes&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x652F;&#x6301;BindView&#x3001;OnClick&#x4E0E;Keep&#x8FD9;&#x4E09;&#x4E2A;&#x6CE8;&#x89E3;&#x3002;&#x4E3A;&#x4E86;&#x89E3;&#x6790;&#x51FA;&#x76F8;&#x5339;&#x914D;&#x7684;&#x6CE8;&#x89E3;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x8FD9;&#x4E2A;&#x903B;&#x8F91;&#x5355;&#x72EC;&#x62BD;&#x79BB;&#x51FA;&#x6765;&#xFF0C;&#x4EA4;&#x7531;getTypeElementsByAnnotationType&#x6765;&#x7BA1;&#x7406;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private Set&lt;TypeElement&gt; getTypeElementsByAnnotationType(Set&lt;? extends TypeElement&gt; annotations, Set&lt;? extends Element&gt; elements) {</span><br><span class=\"line\">    Set&lt;TypeElement&gt; result = new HashSet&lt;&gt;();</span><br><span class=\"line\">    //&#x904D;&#x5386;&#x5305;&#x542B;&#x7684; package class method</span><br><span class=\"line\">    for (Element element : elements) {</span><br><span class=\"line\">        //&#x5339;&#x914D; class or interface</span><br><span class=\"line\">        if (element instanceof TypeElement) {</span><br><span class=\"line\">            boolean found = false;</span><br><span class=\"line\">            //&#x904D;&#x5386;class&#x4E2D;&#x5305;&#x542B;&#x7684; filed method constructors</span><br><span class=\"line\">            for (Element subElement : element.getEnclosedElements()) {</span><br><span class=\"line\">                //&#x904D;&#x5386;element&#x4E2D;&#x5305;&#x542B;&#x7684;&#x6CE8;&#x91CA;</span><br><span class=\"line\">                for (AnnotationMirror annotationMirror : subElement.getAnnotationMirrors()) {</span><br><span class=\"line\">                    for (TypeElement annotation : annotations) {</span><br><span class=\"line\">                        //&#x5339;&#x914D;&#x6CE8;&#x91CA;</span><br><span class=\"line\">                        if (annotationMirror.getAnnotationType().asElement().equals(annotation)) {</span><br><span class=\"line\">                            result.add((TypeElement) element);</span><br><span class=\"line\">                            found = true;</span><br><span class=\"line\">                            break;</span><br><span class=\"line\">                        }</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                    if (found) break;</span><br><span class=\"line\">                }</span><br><span class=\"line\">                if (found) break;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return result;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x9996;&#x5148;&#x7406;&#x89E3;Element&#x662F;&#x4EC0;&#x4E48;&#xFF1F;Element&#x4EE3;&#x8868;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x5305;&#x540D;&#x3001;&#x7C7B;&#x3001;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x6CE8;&#x89E3;&#x6240;&#x652F;&#x6301;&#x7684;&#x4F5C;&#x7528;&#x7C7B;&#x578B;&#x3002;&#x7136;&#x540E;&#x518D;&#x56DE;&#x5230;&#x4EE3;&#x7801;&#x90E8;&#x5206;&#xFF0C;&#x5DF2;&#x7ECF;&#x7ED9;&#x51FA;&#x8BE6;&#x7EC6;&#x4EE3;&#x7801;&#x6CE8;&#x91CA;&#x3002;<br>&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x83B7;&#x53D6;&#x5230;&#x6709;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x6CE8;&#x89E3;&#x7684;class&#x3002;&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#x4E24;&#x4E2A;&#x4E3B;&#x8981;&#x7684;&#x65B9;&#x6CD5;</p>\n<ol>\n<li>getEnclosedElements()&#xFF1A;&#x83B7;&#x5143;&#x7D20;&#x4E2D;&#x7684;&#x95ED;&#x5305;&#x7684;&#x6CE8;&#x89E3;&#x5143;&#x7D20;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x5B9E;&#x4F8B;&#x4E2D;&#x5143;&#x7D20;&#x4E3A;MainActivity(TypeElement&#xFF0C;Type&#x4EE3;&#x8868;Class)&#xFF0C;&#x800C;&#x95ED;&#x5305;&#x7684;&#x6CE8;&#x89E3;&#x5143;&#x7D20;&#x5219;&#x4E3A;sName&#x3001;sPhone&#x3001;nameClick&#x3001;phoneClick&#x4E0E;onCreate&#x3002;&#x5728;&#x8FD9;&#x91CC;&#x7B80;&#x5355;&#x7684;&#x7406;&#x89E3;&#x5C31;&#x662F;&#x83B7;&#x53D6;&#x6709;&#x6CE8;&#x89E3;&#x7684;&#x5B57;&#x6BB5;&#x540D;&#x3001;&#x65B9;&#x6CD5;&#x540D;</li>\n<li>getAnnotationMirrors()&#xFF1A;&#x83B7;&#x53D6;&#x4E0A;&#x8FF0;&#x95ED;&#x5305;&#x5143;&#x7D20;&#x7684;&#x6240;&#x6709;&#x6CE8;&#x89E3;&#x3002;&#x8FD9;&#x91CC;&#x5206;&#x522B;&#x4E3A;sName&#x4E0E;sPhone&#x4E0A;&#x7684;@BindeView&#x3001;nameClick&#x4E0E;phoneClick&#x4E0A;&#x7684;@OnClick&#x3001;onCreate&#x4E0A;&#x7684;@Override&#x3002;</li>\n</ol>\n<p>&#x6240;&#x4EE5;&#x901A;&#x8FC7;&#x8BE5;&#x65B9;&#x6CD5;&#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x7684;&#x5C31;&#x662F;MainActivity&#xFF0C;&#x5B83;&#x5C06;&#x88AB;&#x8F6C;&#x5316;&#x4E3A;TypeElement&#x7C7B;&#x578B;&#x8FD4;&#x56DE;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x7531;processing&#x6765;&#x5904;&#x7406;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x518D;&#x56DE;&#x5230;process&#x65B9;&#x6CD5;&#x4E2D;&#x3002;&#x901A;&#x8FC7;getTypeElementsByAnnotationType()&#x65B9;&#x6CD5;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x83B7;&#x53D6;&#x5230;&#x4E86;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86;&#x81EA;&#x5B9A;&#x4E49;&#x6CE8;&#x89E3;&#x7684;TypeElement(MainActivity)&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//&#x83B7;&#x53D6;&#x4E0E;annotation&#x76F8;&#x5339;&#x914D;&#x7684;TypeElement,&#x5373;&#x6709;&#x6CE8;&#x91CA;&#x58F0;&#x660E;&#x7684;class</span><br><span class=\"line\">Set&lt;TypeElement&gt; elements = getTypeElementsByAnnotationType(annotations, roundEnv.getRootElements());</span><br></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x518D;&#x83B7;&#x53D6;&#x6784;&#x5EFA;&#x7C7B;&#x6240;&#x9700;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//&#x5305;&#x540D;</span><br><span class=\"line\">String packageName = mElementUtils.getPackageOf(typeElement).getQualifiedName().toString();</span><br><span class=\"line\">//&#x7C7B;&#x540D;</span><br><span class=\"line\">String typeName = typeElement.getSimpleName().toString();</span><br><span class=\"line\">//&#x5168;&#x79F0;&#x7C7B;&#x540D;</span><br><span class=\"line\">ClassName className = ClassName.get(packageName, typeName);</span><br><span class=\"line\">//&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7C7B;&#x5168;&#x79F0;&#x540D;</span><br><span class=\"line\">ClassName autoGenerationClassName = ClassName.get(packageName,</span><br><span class=\"line\">        NameUtils.getAutoGeneratorTypeName(typeName));</span><br><span class=\"line\"> </span><br><span class=\"line\">//&#x6784;&#x5EFA;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x7C7B;</span><br><span class=\"line\">TypeSpec.Builder typeBuilder = TypeSpec.classBuilder(autoGenerationClassName)</span><br><span class=\"line\">        .addModifiers(Modifier.PUBLIC)</span><br><span class=\"line\">        .addAnnotation(Keep.class);</span><br></pre></td></tr></table></figure>\n<p>&#x6CE8;&#x91CA;&#x5DF2;&#x7ECF;&#x5212;&#x5206;&#x6E05;&#x695A;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x56DB;&#x4E2A;&#x6B65;&#x9AA4;</p>\n<ol>\n<li>&#x83B7;&#x53D6;&#x5BF9;&#x5E94;typeElement&#x7684;&#x5305;&#x540D;&#xFF08;&#x8FD9;&#x91CC;&#x83B7;&#x53D6;&#x7684;&#x662F;com.idisfkj.androidapianalysis&#xFF09;</li>\n<li>&#x83B7;&#x53D6;typeElement&#x7684;SimpleName&#xFF08;&#x8FD9;&#x91CC;&#x4E3A;MainActivity&#x5B57;&#x7B26;&#x4E32;&#xFF09;</li>\n<li>&#x6839;&#x636E;&#x4E0A;&#x8FF0;&#x83B7;&#x53D6;&#x7684;&#x5305;&#x540D;&#x4E0E;SimpleName&#x6765;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;ClassName&#xFF0C;&#x4E3A;&#x4E86;&#x540E;&#x7EED;&#x58F0;&#x660E;&#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#xFF08;&#x8FD9;&#x91CC;&#x4E3A;MainActivity&#x7C7B;&#xFF0C;&#x6CE8;&#x610F;&#x662F;MainActivity&#x7C7B;&#x578B;&#xFF09;</li>\n<li>&#x6784;&#x5EFA;&#x9700;&#x8981;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;ClassName&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;NameUtils.getAutoGeneratorTypeName&#x8FDB;&#x884C;&#x4E86;&#x7EDF;&#x4E00;&#x547D;&#x540D;&#xFF08;&#x8FD9;&#x91CC;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x7C7B;&#x540D;&#x4E3A;MainActivity$Binding&#xFF0C;&#x90FD;&#x4EE5;&#x539F;&#x59CB;&#x7C7B;&#x540D;&#x540E;&#x9762;&#x52A0;$Binding&#xFF09;</li>\n</ol>\n<p>&#x6240;&#x6709;&#x4FE1;&#x606F;&#x51C6;&#x5907;&#x5B8C;&#x6BD5;&#x540E;&#xFF0C;&#x7136;&#x540E;&#x5F00;&#x59CB;&#x5B9A;&#x4E49;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x7C7B;&#x3002;&#x8FD9;&#x91CC;&#x901A;&#x8FC7;&#x4F7F;&#x7528;<strong>TypeSpec.Builder</strong>&#x6765;&#x6784;&#x5EFA;&#x3002;&#x5B83;&#x662F;JavaPoet&#x4E2D;&#x7684;&#x7C7B;&#x3002;</p>\n<h2 id=\"JavaPoet\"><a href=\"#JavaPoet\" class=\"headerlink\" title=\"JavaPoet\"></a>JavaPoet</h2><p>&#x7531;&#x4E8E;&#x76F4;&#x63A5;&#x4F7F;&#x7528;JavaFileObject&#x751F;&#x6210;.java&#x8D44;&#x6E90;&#x6587;&#x4EF6;&#x662F;&#x975E;&#x5E38;&#x9EBB;&#x70E6;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x63A8;&#x8350;&#x4F7F;&#x7528;JavaPoet&#x3002;JavaPoet&#x662F;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x5E93;&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x6765;&#x5E2E;&#x52A9;&#x65B9;&#x4FBF;&#x5FEB;&#x6377;&#x7684;&#x751F;&#x6210;.java&#x7684;&#x8D44;&#x6E90;&#x6587;&#x4EF6;&#x3002;&#x60F3;&#x8981;&#x5168;&#x9762;&#x4E86;&#x89E3;&#x7684;&#x53EF;&#x4EE5;&#x67E5;&#x770B;<a href=\"https://github.com/square/javapoet\" target=\"_blank\" rel=\"noopener\">Github</a>&#x94FE;&#x63A5;&#x3002;&#x4E3A;&#x4E86;&#x5E2E;&#x52A9;&#x5FEB;&#x901F;&#x8BFB;&#x61C2;&#x8BE5;&#x6587;&#x7AE0;&#xFF0C;&#x8FD9;&#x91CC;&#x5BF9;&#x5176;&#x4E2D;&#x51E0;&#x4E2A;&#x4E3B;&#x8981;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x4ECB;&#x7ECD;&#x3002;&#x5F53;&#x7136;&#x5728;&#x4F7F;&#x7528;&#x524D;&#x8FD8;&#x9700;&#x5728;butterknife-compiler&#x4E2D;&#x7684;builder.gradle&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    implementation fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])</span><br><span class=\"line\">    implementation project(&apos;:butterknife-annotations&apos;)</span><br><span class=\"line\">    implementation &apos;com.squareup:javapoet:1.11.1&apos;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x540C;&#x65F6;&#x4E5F;&#x5C06;&#x4E0A;&#x4E00;&#x671F;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6CE8;&#x89E3;Module&#x5F15;&#x5165;&#x3002;</p>\n<ol>\n<li>TypeSpec.Builder: &#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x7C7B;</li>\n<li>addModifiers: &#x5B9A;&#x4E49;private&#x3001;public&#x4E0E;protected&#x7C7B;&#x578B;</li>\n<li>addAnnotation: &#x5BF9;Element&#x5143;&#x7D20;&#x6DFB;&#x52A0;&#x6CE8;&#x89E3;&#x3002;&#x4F8B;&#x5982;&#xFF1A;@Keep</li>\n<li>TypeSpec.Builder -&gt; addMethod: &#x6DFB;&#x52A0;&#x65B9;&#x6CD5;</li>\n<li>MethodSpec -&gt; addParameter: &#x4E3A;&#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x4E0E;&#x53C2;&#x6570;&#x540D;</li>\n<li>MethodSpec -&gt; addStatement: &#x5728;&#x65B9;&#x6CD5;&#x4E2D;&#x6DFB;&#x52A0;&#x4EE3;&#x7801;&#x5757;&#x3002;&#x800C;&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x52A8;&#x6001;&#x7C7B;&#x578B;&#x4F1A;&#x4F7F;&#x7528;&#x5360;&#x4F4D;&#x7B26;&#x66FF;&#x4EE3;&#x3002;&#x4F8B;&#x5982;&#xFF1A;addStatement(&#x201C;$N($N)&#x201D;, &#x201C;bindView&#x201D;, &#x201C;activity&#x201D;)&#xFF0C;&#x5B83;&#x5C06;&#x4F1A;&#x751F;&#x6210;bindView(activity)&#x3002;&#x5360;&#x4F4D;&#x7B26;&#xFF1A;$N -&gt; name, $T -&gt; type(ClassName), $L -&gt; literals</li>\n</ol>\n<p>&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x7406;&#x89E3;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x751F;&#x6210;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//&#x6784;&#x5EFA;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x7C7B;</span><br><span class=\"line\">TypeSpec.Builder typeBuilder = TypeSpec.classBuilder(autoGenerationClassName)</span><br><span class=\"line\">        .addModifiers(Modifier.PUBLIC)</span><br><span class=\"line\">        .addAnnotation(Keep.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">//&#x6DFB;&#x52A0;&#x6784;&#x9020;&#x65B9;&#x6CD5;</span><br><span class=\"line\">typeBuilder.addMethod(MethodSpec.constructorBuilder()</span><br><span class=\"line\">        .addModifiers(Modifier.PUBLIC)</span><br><span class=\"line\">        .addParameter(className, NameUtils.Variable.ANDROID_ACTIVITY)</span><br><span class=\"line\">        .addStatement(&quot;$N($N)&quot;,</span><br><span class=\"line\">                NameUtils.Method.BIND_VIEW,</span><br><span class=\"line\">                NameUtils.Variable.ANDROID_ACTIVITY)</span><br><span class=\"line\">        .addStatement(&quot;$N($N)&quot;,</span><br><span class=\"line\">                NameUtils.Method.SET_ON_CLICK_LISTENER,</span><br><span class=\"line\">                NameUtils.Variable.ANDROID_ACTIVITY)</span><br><span class=\"line\">        .build());</span><br></pre></td></tr></table></figure>\n<p>&#x9996;&#x5148;&#x901A;&#x8FC7;TypeSpec.Builder&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x7C7B;&#x540D;&#x4E3A;autoGenerationClassName(MainActivity$Binding)&#xFF0C;&#x7C7B;&#x7684;&#x8BBF;&#x95EE;&#x7EA7;&#x522B;&#x4E3A;public&#xFF0C;&#x7531;&#x4E8E;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x6DF7;&#x6DC6;&#x4F7F;&#x7528;&#x4E86;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;@Keep&#x6CE8;&#x89E3;&#x3002;</p>\n<p>&#x7136;&#x540E;&#x518D;&#x6765;&#x6DFB;&#x52A0;&#x7C7B;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#xFF0C;&#x4F7F;&#x7528;addMethod&#x3001;addModifiers&#x3001;addParameter&#x4E0E;addStatement&#x5206;&#x522B;&#x6784;&#x5EFA;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x540D;&#x3001;&#x65B9;&#x6CD5;&#x8BBF;&#x95EE;&#x7EA7;&#x522B;&#x3001;&#x65B9;&#x6CD5;&#x53C2;&#x6570;&#x4E0E;&#x65B9;&#x6CD5;&#x4E2D;&#x6267;&#x884C;&#x7684;&#x4EE3;&#x7801;&#x5757;&#x3002;&#x6240;&#x4EE5;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x6700;&#x7EC8;&#x5C06;&#x4F1A;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Keep</span><br><span class=\"line\">public class MainActivity$Binding {</span><br><span class=\"line\">  public MainActivity$Binding(MainActivity activity) {</span><br><span class=\"line\">    bindView(activity);</span><br><span class=\"line\">    setOnClickListener(activity);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7C7B;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#x8C03;&#x7528;&#x4E86;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;bindView&#x4E0E;setOnClickListener&#x65B9;&#x6CD5;&#x3002;&#x6240;&#x4EE5;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x8981;&#x5B9E;&#x73B0;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x6784;&#x5EFA;&#x3002;</p>\n<h2 id=\"bindView\"><a href=\"#bindView\" class=\"headerlink\" title=\"bindView\"></a>bindView</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//&#x6DFB;&#x52A0;bindView&#x6210;&#x5458;&#x65B9;&#x6CD5;</span><br><span class=\"line\">MethodSpec.Builder bindViewBuilder = MethodSpec.methodBuilder(NameUtils.Method.BIND_VIEW)</span><br><span class=\"line\">        .addModifiers(Modifier.PRIVATE)</span><br><span class=\"line\">        .returns(TypeName.VOID)</span><br><span class=\"line\">        .addParameter(className, NameUtils.Variable.ANDROID_ACTIVITY);</span><br><span class=\"line\"> </span><br><span class=\"line\">//&#x6DFB;&#x52A0;&#x65B9;&#x6CD5;&#x5185;&#x5BB9;</span><br><span class=\"line\">for (VariableElement variableElement : ElementFilter.fieldsIn(typeElement.getEnclosedElements())) {</span><br><span class=\"line\">    BindView bindView = variableElement.getAnnotation(BindView.class);</span><br><span class=\"line\">    if (bindView != null) {</span><br><span class=\"line\">        bindViewBuilder.addStatement(&quot;$N.$N=($T)$N.findViewById($L)&quot;,</span><br><span class=\"line\">                NameUtils.Variable.ANDROID_ACTIVITY,</span><br><span class=\"line\">                variableElement.getSimpleName(),</span><br><span class=\"line\">                variableElement,</span><br><span class=\"line\">                NameUtils.Variable.ANDROID_ACTIVITY,</span><br><span class=\"line\">                bindView.value()[0]</span><br><span class=\"line\">        ).addStatement(&quot;$N.$N.setText($N.getString($L))&quot;,</span><br><span class=\"line\">                NameUtils.Variable.ANDROID_ACTIVITY,</span><br><span class=\"line\">                variableElement.getSimpleName(),</span><br><span class=\"line\">                NameUtils.Variable.ANDROID_ACTIVITY,</span><br><span class=\"line\">                bindView.value()[1]);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">typeBuilder.addMethod(bindViewBuilder.build());</span><br></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;MethodSpec.Builder&#x6765;&#x521B;&#x5EFA;bindView&#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x5B83;&#x7684;&#x90FD;&#x4E0E;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x7C7B;&#x4F3C;&#x3002;&#x4F7F;&#x7528;returns&#x4E3A;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;void&#x7C7B;&#x578B;&#x3002;&#x7136;&#x540E;&#x518D;&#x904D;&#x5386;MainActivity&#x4E2D;&#x7684;&#x6CE8;&#x89E3;&#xFF0C;&#x627E;&#x5230;&#x4E0E;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x7684;BindView&#x76F8;&#x5339;&#x914D;&#x7684;&#x5B57;&#x6BB5;&#x3002;&#x6700;&#x540E;&#x5206;&#x522B;&#x5411;bindView&#x65B9;&#x6CD5;&#x4E2D;&#x6DFB;&#x52A0;findViewById&#x4E0E;setText&#x4EE3;&#x7801;&#x5757;&#xFF0C;&#x540C;&#x65F6;&#x5C06;&#x5B9A;&#x4E49;&#x7684;&#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x5230;typeBuilder&#x4E2D;&#x3002;&#x6240;&#x4EE5;&#x6267;&#x884C;&#x5B8C;&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x540E;&#x5728;MainActivity$Binding&#x4E2D;&#x5C55;&#x793A;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void bindView(MainActivity activity) {</span><br><span class=\"line\">  activity.sName=(TextView)activity.findViewById(2131165265);</span><br><span class=\"line\">  activity.sName.setText(activity.getString(2131427362));</span><br><span class=\"line\">  activity.sPhone=(TextView)activity.findViewById(2131165262);</span><br><span class=\"line\">  activity.sPhone.setText(activity.getString(2131427360));</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5B9E;&#x73B0;&#x4E86;&#x6211;&#x4EEC;&#x6700;&#x521D;&#x7684;View&#x7684;&#x7ED1;&#x5B9A;&#x4E0E;TextView&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x8BBE;&#x7F6E;&#x3002;</p>\n<h2 id=\"setOnClickListener\"><a href=\"#setOnClickListener\" class=\"headerlink\" title=\"setOnClickListener\"></a>setOnClickListener</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//&#x6DFB;&#x52A0;setOnClickListener&#x6210;&#x5458;&#x65B9;&#x6CD5;</span><br><span class=\"line\">MethodSpec.Builder setOnClickListenerBuilder = MethodSpec.methodBuilder(NameUtils.Method.SET_ON_CLICK_LISTENER)</span><br><span class=\"line\">        .addModifiers(Modifier.PRIVATE)</span><br><span class=\"line\">        .returns(TypeName.VOID)</span><br><span class=\"line\">        .addParameter(className, NameUtils.Variable.ANDROID_ACTIVITY, Modifier.FINAL);</span><br><span class=\"line\"> </span><br><span class=\"line\">//&#x6DFB;&#x52A0;&#x65B9;&#x6CD5;&#x5185;&#x5BB9;</span><br><span class=\"line\">ClassName viewClassName = ClassName.get(NameUtils.Package.ANDROID_VIEW, NameUtils.Class.CLASS_VIEW);</span><br><span class=\"line\">ClassName onClickListenerClassName = ClassName.get(NameUtils.Package.ANDROID_VIEW, NameUtils.Class.CLASS_VIEW, NameUtils.Class.CLASS_ON_CLICK_LISTENER);</span><br><span class=\"line\"> </span><br><span class=\"line\">for (ExecutableElement executableElement : ElementFilter.methodsIn(typeElement.getEnclosedElements())) {</span><br><span class=\"line\">    OnClick onClick = executableElement.getAnnotation(OnClick.class);</span><br><span class=\"line\">    if (onClick != null) {</span><br><span class=\"line\">        //&#x6784;&#x5EFA;&#x533F;&#x540D;class</span><br><span class=\"line\">        TypeSpec typeSpec = TypeSpec.anonymousClassBuilder(&quot;&quot;)</span><br><span class=\"line\">                .addSuperinterface(onClickListenerClassName)</span><br><span class=\"line\">                .addMethod(MethodSpec.methodBuilder(NameUtils.Method.ON_CLICK)</span><br><span class=\"line\">                        .addModifiers(Modifier.PUBLIC)</span><br><span class=\"line\">                        .addParameter(viewClassName, NameUtils.Class.CLASS_VIEW)</span><br><span class=\"line\">                        .returns(TypeName.VOID)</span><br><span class=\"line\">                        .addStatement(&quot;$N.$N($N)&quot;,</span><br><span class=\"line\">                                NameUtils.Variable.ANDROID_ACTIVITY,</span><br><span class=\"line\">                                executableElement.getSimpleName(),</span><br><span class=\"line\">                                NameUtils.Class.CLASS_VIEW)</span><br><span class=\"line\">                        .build())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"></span><br><span class=\"line\">        setOnClickListenerBuilder.addStatement(&quot;$N.findViewById($L).setOnClickListener($L)&quot;,</span><br><span class=\"line\">                NameUtils.Variable.ANDROID_ACTIVITY,</span><br><span class=\"line\">                onClick.value(),</span><br><span class=\"line\">                typeSpec);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">typeBuilder.addMethod(setOnClickListenerBuilder.build());</span><br></pre></td></tr></table></figure>\n<p>&#x4E0E;bindView&#x65B9;&#x6CD5;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x7531;&#x4E8E;&#x4F7F;&#x7528;&#x5230;&#x4E86;&#x533F;&#x540D;&#x7C7B;OnClickListener&#x4E0E;&#x7C7B;View&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x4E5F;&#x8981;&#x5B9A;&#x4E49;&#x4ED6;&#x4EEC;&#x7684;ClassName&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;TypeSpec&#x6765;&#x751F;&#x6210;&#x533F;&#x540D;&#x7C7B;&#x3002;&#x751F;&#x6210;&#x4E4B;&#x540E;&#x518D;&#x6DFB;&#x52A0;&#x5230;setOnClickListener&#x65B9;&#x6CD5;&#x4E2D;&#x3002;&#x6700;&#x540E;&#x518D;&#x5C06;setOnClickListener&#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x5230;MainActivity$Binding&#x4E2D;&#x3002;&#x6240;&#x4EE5;&#x6700;&#x7EC8;&#x5C55;&#x793A;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void setOnClickListener(final MainActivity activity) {</span><br><span class=\"line\">  activity.findViewById(2131165265).setOnClickListener(new View.OnClickListener() {</span><br><span class=\"line\">    public void onClick(View View) {</span><br><span class=\"line\">      activity.nameClick(View);</span><br><span class=\"line\">    }</span><br><span class=\"line\">  });</span><br><span class=\"line\">  activity.findViewById(2131165262).setOnClickListener(new View.OnClickListener() {</span><br><span class=\"line\">    public void onClick(View View) {</span><br><span class=\"line\">      activity.phoneClick(View);</span><br><span class=\"line\">    }</span><br><span class=\"line\">  });</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x7684;MainActivity$Binding&#x7C7B;&#x5C31;&#x5DF2;&#x7ECF;&#x5B9A;&#x4E49;&#x5B8C;&#x6210;&#xFF0C;&#x6700;&#x540E;&#x518D;&#x5199;&#x5165;&#x5230;java&#x6587;&#x4EF6;&#x4E2D;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//&#x5199;&#x5165;java&#x6587;&#x4EF6;</span><br><span class=\"line\">try {</span><br><span class=\"line\">    JavaFile.builder(packageName, typeBuilder.build()).build().writeTo(mFiler);</span><br><span class=\"line\">} catch (IOException e) {</span><br><span class=\"line\">    mMessager.printMessage(Diagnostic.Kind.ERROR, e.getMessage(), typeElement);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"services\"><a href=\"#services\" class=\"headerlink\" title=\"services\"></a>services</h2><p>&#x5728;butterknife-compiler&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x76EE;&#x5F55;&#xFF1A;<br><code>butterknife-compiler/src/main/resources/META-INF/services</code></p>\n<p>&#x5728;services&#x76EE;&#x5F55;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF1A;<code>javax.annotation.processing.Processor</code>&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x662F;&#x7528;&#x6765;&#x544A;&#x8BC9;&#x7F16;&#x8BD1;&#x5668;&#xFF0C;&#x5F53;&#x5B83;&#x5728;&#x7F16;&#x8BD1;&#x4EE3;&#x7801;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x6B63;&#x5904;&#x4E8E;&#x6CE8;&#x89E3;&#x5904;&#x7406;&#x4E2D;&#x65F6;&#xFF0C;&#x4F1A;&#x544A;&#x8BC9;&#x6CE8;&#x89E3;&#x5904;&#x7406;&#x5668;&#x6765;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x54EA;&#x4E9B;&#x7C7B;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5728;&#x6587;&#x4EF6;&#x4E2D;&#x5C06;&#x6DFB;&#x52A0;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;Processor&#x8DEF;&#x5F84;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">com.idisfkj.butterknife.compiler.Processor</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x6CE8;&#x89E3;&#x5668;&#x5C31;&#x4F1A;&#x8C03;&#x7528;&#x8BE5;&#x6307;&#x5B9A;&#x7684;Processor&#x3002;&#x5230;&#x8FD9;&#x91CC;&#x6574;&#x4E2A;butterknife-compiler&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;<code>Make Project</code>&#x4E00;&#x4E0B;&#x5DE5;&#x7A0B;&#xFF0C;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x5168;&#x5C40;&#x641C;&#x7D22;&#x5230;MainActivity$Binding&#x6587;&#x4EF6;&#x4E86;&#x3002;&#x6216;&#x8005;&#x5728;&#x5982;&#x4E0B;&#x8DEF;&#x5F84;&#x4E2D;&#x67E5;&#x770B;&#xFF1A;</p>\n<p><code>/app/build/generated/source/kapt/debug/com/idisfkj/androidapianalysis/MainActivity$Binding.java</code></p>\n<p>&#x6587;&#x7AE0;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x53EF;&#x4EE5;&#x5728;<a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">Github</a>&#x4E2D;&#x83B7;&#x53D6;&#x5230;&#x3002;&#x4F7F;&#x7528;&#x65F6;&#x8BF7;&#x5C06;&#x5206;&#x652F;&#x5207;&#x6362;&#x5230;<strong>feat_annotation_processing</strong></p>\n<h2 id=\"&#x76F8;&#x5173;&#x6587;&#x7AE0;\"><a href=\"#&#x76F8;&#x5173;&#x6587;&#x7AE0;\" class=\"headerlink\" title=\"&#x76F8;&#x5173;&#x6587;&#x7AE0;\"></a>&#x76F8;&#x5173;&#x6587;&#x7AE0;</h2><p><a href=\"https://idisfkj.github.io/2018/07/01/%E8%87%AA%E5%AE%9A%E4%B9%89Android%E6%B3%A8%E8%A7%A3Part1-%E6%B3%A8%E8%A7%A3%E5%8F%98%E9%87%8F/\" target=\"_blank\" rel=\"noopener\">&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;Part1:&#x6CE8;&#x89E3;&#x53D8;&#x91CF;</a></p>\n<p><a href=\"https://idisfkj.github.io/2018/07/11/%E8%87%AA%E5%AE%9A%E4%B9%89Android%E6%B3%A8%E8%A7%A3Part3-%E7%BB%91%E5%AE%9A/\" target=\"_blank\" rel=\"noopener\">&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;Part3:&#x7ED1;&#x5B9A;</a></p>\n<h2 id=\"&#x5173;&#x6CE8;\"><a href=\"#&#x5173;&#x6CE8;\" class=\"headerlink\" title=\"&#x5173;&#x6CE8;\"></a>&#x5173;&#x6CE8;</h2><p><img src=\"/2018/07/04/&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;Part2-&#x4EE3;&#x7801;&#x81EA;&#x52A8;&#x751F;&#x6210;/wx.jpg\" alt=\"&#x602A;&#x8C08;&#x65F6;&#x95F4;&#x5230;&#x4E86;\"></p>\n","categories":["android"],"tags":["Android Annotation Processing"]},{"title":"自定义Android注解Part1:注解变量","url":"https://www.rousetime.com/2018/07/01/自定义Android注解Part1-注解变量/","content":"<p><img src=\"/2018/07/01/&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;Part1-&#x6CE8;&#x89E3;&#x53D8;&#x91CF;/cover.png\" alt></p>\n<p>&#x5BF9;&#x4E8E;Android&#x6CE8;&#x89E3;&#xFF0C;&#x6216;&#x591A;&#x6216;&#x5C11;&#x90FD;&#x6709;&#x4E00;&#x70B9;&#x63A5;&#x89E6;&#xFF0C;&#x4F46;&#x76F8;&#x4FE1;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x90FD;&#x662F;&#x5728;&#x4F7F;&#x7528;&#x5176;&#x5B83;&#x4F9D;&#x8D56;&#x5E93;&#x7684;&#x65F6;&#x5019;&#x63A5;&#x89E6;&#x7684;&#x3002;&#x56E0;&#x4E3A;&#x6709;&#x4E9B;&#x5E93;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x4F7F;&#x7528;&#x5B83;&#x5C31;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x5B83;&#x6240;&#x63D0;&#x4F9B;&#x7684;&#x6CE8;&#x89E3;&#x3002;&#x4F8B;&#x5982;&#xFF1A;ButterKnife&#x3001;Dagger2&#x3001;Room&#x7B49;&#x7B49;&#x3002;</p>\n<p>&#x81F3;&#x4E8E;&#x4E3A;&#x4F55;&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#xFF1F;&#x4F7F;&#x7528;&#x8FC7;&#x7684;&#x5E94;&#x8BE5;&#x90FD;&#x77E5;&#x9053;&#xFF0C;&#x6700;&#x660E;&#x663E;&#x7684;&#x5C31;&#x662F;&#x65B9;&#x4FBF;&#x3001;&#x7B80;&#x6D01;&#x3002;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x53EF;&#x4EE5;&#x5728;&#x9879;&#x76EE;&#x7F16;&#x8BD1;&#x9636;&#x6BB5;&#xFF0C;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x4E00;&#x4E9B;&#x91CD;&#x590D;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x51CF;&#x8F7B;&#x6211;&#x4EEC;&#x7684;&#x8D1F;&#x62C5;&#x3002;&#x5178;&#x578B;&#x7684;ButterKnife&#x672C;&#x8D28;&#x5C31;&#x662F;&#x4F7F;&#x7528;Android&#x6CE8;&#x89E3;&#xFF0C;&#x901A;&#x8FC7;&#x6CE8;&#x89E3;&#x6765;&#x51CF;&#x5C11;&#x6211;&#x4EEC;&#x5BF9;view.findViewById&#x7684;&#x7F16;&#x5199;&#xFF0C;&#x63D0;&#x9AD8;&#x6211;&#x4EEC;&#x7684;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x3002;&#x4E0A;&#x4E00;&#x4E2A;&#x7CFB;&#x5217;(AAC)&#x7684;Room&#x4E5F;&#x662F;&#x4E00;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x7684;&#x56DE;&#x987E;&#x4E00;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Entity(tableName = &quot;contacts&quot;)</span><br><span class=\"line\">data class ContactsModel(</span><br><span class=\"line\">        @PrimaryKey</span><br><span class=\"line\">        @ColumnInfo(name = &quot;contacts_id&quot;)</span><br><span class=\"line\">        val id: Int,</span><br><span class=\"line\">        @ColumnInfo(name = &quot;name&quot;)</span><br><span class=\"line\">        val name: String,</span><br><span class=\"line\">        @ColumnInfo(name = &quot;phone&quot;)</span><br><span class=\"line\">        val phone: String</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x6765;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x5B9E;&#x4F53;&#x8868;&#xFF0C;&#x4E5F;&#x5C31;10&#x884C;&#x5DE6;&#x53F3;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x5982;&#x679C;&#x8981;&#x6211;&#x4EEC;&#x5168;&#x90E8;&#x81EA;&#x5DF1;&#x5199;&#x90A3;&#x7EDD;&#x5BF9;&#x8981;&#x4E24;&#x4E09;&#x767E;&#x884C;&#x4EE3;&#x7801;&#x4E86;&#xFF0C;&#x800C;&#x4E14;&#x5176;&#x4E2D;&#x8FD8;&#x53EF;&#x80FD;&#x51FA;&#x9519;&#xFF0C;&#x53C8;&#x8981;&#x6539;bug&#x7B49;&#x7B49;&#x3002;&#x6548;&#x7387;&#x5C31;&#x4E25;&#x91CD;&#x964D;&#x4F4E;&#x3002;&#x5BF9;&#x4E8E;&#x4F9D;&#x8D56;&#x5E93;&#x5982;&#x679C;&#x90FD;&#x8FD9;&#x4E48;&#x9EBB;&#x70E6;&#x4E5F;&#x5C31;&#x4E0D;&#x4F1A;&#x6709;&#x4EBA;&#x7528;&#x4E86;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x5224;&#x65AD;&#x4E00;&#x4E2A;&#x4F9D;&#x8D56;&#x5E93;&#x662F;&#x5426;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5462;&#xFF1F;&#x5176;&#x5B9E;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x8981;&#x8BB0;&#x4F4F;&#x4EE5;&#x4E0B;&#x4E24;&#x70B9;&#x5373;&#x53EF;&#xFF1A;</p>\n<ol>\n<li>&#x9700;&#x8981;&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;&#x4E0D;&#x80FD;&#x4E0E;&#x9879;&#x76EE;&#x903B;&#x8F91;&#x6709;&#x5173;</li>\n<li>Android&#x6CE8;&#x89E3;&#x53EA;&#x80FD;&#x751F;&#x6210;&#x4EE3;&#x7801;&#xFF0C;&#x5E76;&#x4E0D;&#x80FD;&#x4FEE;&#x6539;&#x4EE3;&#x7801;</li>\n</ol>\n<blockquote>\n<p>&#x8FD9;&#x91CC;&#x900F;&#x9732;&#x4E00;&#x4E0B;&#xFF0C;Android&#x6CE8;&#x89E3;&#x7684;&#x672C;&#x8D28;&#x662F;&#x4F7F;&#x7528;Java&#x7684;&#x53CD;&#x5C04;&#x673A;&#x5236;&#xFF0C;&#x540E;&#x7EED;&#x4F1A;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;</p>\n</blockquote>\n<h2 id=\"&#x9879;&#x76EE;&#x67B6;&#x6784;\"><a href=\"#&#x9879;&#x76EE;&#x67B6;&#x6784;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;&#x67B6;&#x6784;\"></a>&#x9879;&#x76EE;&#x67B6;&#x6784;</h2><p>&#x76F8;&#x4FE1;ButterKnife&#x5E94;&#x8BE5;&#x6709;&#x63A5;&#x89E6;&#x8FC7;&#x5427;&#xFF0C;&#x6CA1;&#x6709;&#x7684;&#x4E5F;&#x6CA1;&#x5173;&#x7CFB;&#xFF0C;&#x73B0;&#x5728;&#x6B63;&#x662F;&#x65F6;&#x5019;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x4F1A;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;BindView&#x4E0E;OnClick&#x6CE8;&#x89E3;&#xFF0C;&#x5B9E;&#x73B0;ButterKnife&#x4E2D;&#x7684;&#x5BF9;&#x5E94;&#x6CE8;&#x89E3;&#x529F;&#x80FD;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x5148;&#x6765;&#x770B;&#x4E0B;&#x6574;&#x4F53;&#x7684;&#x9879;&#x76EE;&#x67B6;&#x6784;</p>\n<p><img src=\"/2018/07/01/&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;Part1-&#x6CE8;&#x89E3;&#x53D8;&#x91CF;/1.png\" alt></p>\n<p>&#x901A;&#x8FC7;&#x9879;&#x76EE;&#x56FE;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6E05;&#x6670;&#x7684;&#x770B;&#x5230;&#xFF0C;&#x4E3B;&#x8981;&#x5206;&#x4E3A;&#x4E09;&#x4E2A;&#x90E8;&#x5206;</p>\n<ol>\n<li>butterknife-annotations&#xFF1A;&#x6CE8;&#x89E3;&#x5E93;&#xFF0C;&#x5305;&#x542B;BindView&#x4E0E;OnClick&#x7B49;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6CE8;&#x89E3;</li>\n<li>butterknife-bind&#xFF1A;&#x7ED1;&#x5B9A;&#x5E93;&#xFF0C;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6CE8;&#x89E3;&#x4E0E;&#x58F0;&#x660E;&#x7684;&#x7C7B;&#x7ED1;&#x5B9A;</li>\n<li>butterknife-compiler: &#x89E3;&#x6790;&#x7F16;&#x8BD1;&#x751F;&#x6210;&#x5E93;&#xFF0C;&#x89E3;&#x6790;&#x58F0;&#x660E;&#x7C7B;&#x4E2D;&#x7684;&#x6CE8;&#x89E3;&#xFF0C;&#x5728;&#x7F16;&#x8BD1;&#x65F6;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x76F8;&#x5E94;&#x7684;&#x4EE3;&#x7801;&#x3002;</li>\n</ol>\n<p>&#x4E3A;&#x4E86;&#x5E2E;&#x52A9;&#x5927;&#x5BB6;&#x80FD;&#x591F;&#x66F4;&#x8F7B;&#x677E;&#x7684;&#x7406;&#x89E3;Android&#x6CE8;&#x89E3;&#xFF0C;&#x4ECA;&#x5929;&#x4E3B;&#x8981;&#x5206;&#x6790;&#x7684;&#x5C31;&#x662F;butterknife-annotations&#x8FD9;&#x4E2A;&#x6CE8;&#x89E3;&#x5E93;&#x3002;&#x5E26;&#x5927;&#x5BB6;&#x4E00;&#x8D77;&#x6765;&#x58F0;&#x660E;&#x6CE8;&#x89E3;&#x53D8;&#x91CF;&#x3002;</p>\n<h2 id=\"BindView\"><a href=\"#BindView\" class=\"headerlink\" title=\"BindView\"></a>BindView</h2><p>&#x4E3A;&#x4E86;&#x8981;&#x5B9E;&#x73B0;&#x5F00;&#x6E90;&#x5E93;butterknife&#x7C7B;&#x4F3C;&#x7684;&#x7ED1;&#x5B9A;id&#x6548;&#x679C;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5148;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;BindView&#x6CE8;&#x89E3;&#xFF0C;&#x5177;&#x4F53;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Retention(RetentionPolicy.SOURCE)</span><br><span class=\"line\">@Target(ElementType.FIELD)</span><br><span class=\"line\">public @interface BindView {</span><br><span class=\"line\">    @IdRes int[] value();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x55EF;&#xFF0C;&#x8FD8;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x5BF9;&#x5427;&#x3002;&#x4E5F;&#x5C31;5&#x884C;&#x4EE3;&#x7801;&#x89E3;&#x51B3;BindView&#x6CE8;&#x89E3;&#x7684;&#x5B9A;&#x4E49;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x518D;&#x6765;&#x8BE6;&#x7EC6;&#x5256;&#x6790;&#x8FD9;5&#x884C;&#x4EE3;&#x7801;&#x3002;</p>\n<h3 id=\"Retention\"><a href=\"#Retention\" class=\"headerlink\" title=\"Retention\"></a>Retention</h3><p>&#x9996;&#x5148;&#x662F;&#x7B2C;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x7684;Retention&#xFF0C;&#x770B;&#x5B83;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x5C31;&#x80FD;&#x77E5;&#x9053;&#xFF0C;&#x5B83;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x58F0;&#x660E;&#x4E86;&#x7684;&#x6CE8;&#x89E3;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Documented</span><br><span class=\"line\">@Retention(RetentionPolicy.RUNTIME)</span><br><span class=\"line\">@Target(ElementType.ANNOTATION_TYPE)</span><br><span class=\"line\">public @interface Retention {</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Returns the retention policy.</span><br><span class=\"line\">     * @return the retention policy</span><br><span class=\"line\">     */</span><br><span class=\"line\">    RetentionPolicy value();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x6E90;&#x7801;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x8BE5;&#x6CE8;&#x89E3;&#x53EA;&#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x8BE5;&#x53C2;&#x6570;&#x4E3A;RetentionPolicy&#x7C7B;&#x578B;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5728;&#x8FDB;&#x4E00;&#x6B65;&#x6DF1;&#x5165;RetentionPolicy&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public enum RetentionPolicy {</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Annotations are to be discarded by the compiler.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    SOURCE,</span><br><span class=\"line\"> </span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Annotations are to be recorded in the class file by the compiler</span><br><span class=\"line\">     * but need not be retained by the VM at run time.  This is the default</span><br><span class=\"line\">     * behavior.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    CLASS,</span><br><span class=\"line\"> </span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Annotations are to be recorded in the class file by the compiler and</span><br><span class=\"line\">     * retained by the VM at run time, so they may be read reflectively.</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * @see java.lang.reflect.AnnotatedElement</span><br><span class=\"line\">     */</span><br><span class=\"line\">    RUNTIME</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x5B83;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x4E2A;&#x679A;&#x4E3E;&#xFF0C;&#x5728;&#x679A;&#x4E3E;&#x4E2D;&#x652F;&#x6301;&#x4E09;&#x4E2A;&#x5E38;&#x91CF;&#xFF0C;&#x5206;&#x522B;&#x4E3A;SOURCE&#x3001;CLASS&#x4E0E;RUNTIME&#x3002;&#x5B83;&#x4EEC;&#x7684;&#x533A;&#x522B;&#x4E3B;&#x8981;&#x662F;&#x4F5C;&#x7528;&#x7684;&#x5468;&#x671F;&#x8303;&#x56F4;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x518D;&#x5BF9;&#x8FD9;&#x4E09;&#x4E2A;&#x7684;&#x4F5C;&#x7528;&#x8FDB;&#x884C;&#x7FFB;&#x8BD1;&#x4E00;&#x904D;&#xFF1A;</p>\n<ol>\n<li>SOURCE&#xFF1A; &#x4F7F;&#x7528;&#x8BE5;&#x6807;&#x660E;&#x7684;&#x6CE8;&#x89E3;&#x5C06;&#x5728;&#x7F16;&#x8BD1;&#x9636;&#x6BB5;&#x5C31;&#x88AB;&#x629B;&#x5F03;&#x6389;&#x3002;</li>\n<li>CLASS&#xFF1A;&#x4F7F;&#x7528;&#x8BE5;&#x6807;&#x660E;&#x7684;&#x6CE8;&#x89E3;&#x5C06;&#x5728;&#x7F16;&#x8BD1;&#x9636;&#x6BB5;&#x8BB0;&#x5F55;&#x5230;&#x751F;&#x6210;&#x7684;class&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x4F46;&#x5728;&#x8FD0;&#x884C;&#x9636;&#x6BB5;&#x65F6;&#x53C8;&#x4F1A;&#x88AB;VM&#x629B;&#x5F03;&#x3002;&#x9ED8;&#x8BA4;&#x662F;&#x8BE5;&#x6A21;&#x5F0F;&#x3002;</li>\n<li>RUNTIME&#xFF1A;&#x4F7F;&#x7528;&#x8BE5;&#x6807;&#x660E;&#x7684;&#x6CE8;&#x89E3;&#x5C06;&#x5728;&#x7F16;&#x8BD1;&#x9636;&#x6BB5;&#x88AB;&#x4FDD;&#x5B58;&#x5728;&#x751F;&#x6210;&#x7684;class&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x540C;&#x65F6;&#x5728;&#x8FD0;&#x884C;&#x9636;&#x6BB5;&#x65F6;&#x4F1A;&#x4FDD;&#x5B58;&#x5230;VM&#x4E2D;&#x3002;&#x6240;&#x4EE5;&#x5B83;&#x8BE5;&#x6CE8;&#x89E3;&#x5C06;&#x4E00;&#x76F4;&#x5B58;&#x5728;&#xFF0C;&#x81EA;&#x7136;&#x80FD;&#x591F;&#x901A;&#x8FC7;java&#x7684;&#x53CD;&#x5C04;&#x673A;&#x5236;&#x8FDB;&#x884C;&#x8BFB;&#x53D6;&#x3002;</li>\n</ol>\n<p>&#x6240;&#x4EE5;&#x5B83;&#x4EEC;&#x7684;&#x5B58;&#x5728;&#x7684;&#x751F;&#x547D;&#x65F6;&#x957F;&#x4E3A;SOURCE &lt; CLASS &lt; RUNTIME&#x3002;&#x77E5;&#x9053;&#x4E86;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x8303;&#x56F4;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x81EA;&#x5B9A;&#x4E49;&#x6CE8;&#x89E3;&#x65F6;&#x5C31;&#x8981;&#x5C3D;&#x91CF;&#x8F83;&#x5C0F;&#x6CE8;&#x89E3;&#x7684;&#x4F5C;&#x7528;&#x8303;&#x56F4;&#xFF0C;&#x63D0;&#x9AD8;&#x9879;&#x76EE;&#x7684;&#x7F16;&#x8BD1;&#x4E0E;&#x8FD0;&#x884C;&#x901F;&#x5EA6;&#x3002;</p>\n<p>&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7684;BindView&#x6CE8;&#x89E3;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x8FDB;&#x884C;Viwe&#x7684;&#x7ED1;&#x5B9A;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x7F16;&#x8BD1;&#x4E4B;&#x540E;&#x5C31;&#x65E0;&#x9700;&#x5B58;&#x5728;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5C31;&#x4F7F;&#x7528;&#x4E86;CLASS&#x6765;&#x8FDB;&#x884C;&#x6807;&#x660E;&#x3002;</p>\n<h3 id=\"Target\"><a href=\"#Target\" class=\"headerlink\" title=\"Target\"></a>Target</h3><p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5728;&#x6765;&#x770B;&#x7B2C;&#x4E8C;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x5230;&#x4E86;&#x53E6;&#x4E00;&#x4E2A;&#x6CE8;&#x89E3;Target&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x6765;&#x770B;&#x4E0B;&#x5B83;&#x7684;&#x6E90;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Documented</span><br><span class=\"line\">@Retention(RetentionPolicy.RUNTIME)</span><br><span class=\"line\">@Target(ElementType.ANNOTATION_TYPE)</span><br><span class=\"line\">public @interface Target {</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Returns an array of the kinds of elements an annotation type</span><br><span class=\"line\">     * can be applied to.</span><br><span class=\"line\">     * @return an array of the kinds of elements an annotation type</span><br><span class=\"line\">     * can be applied to</span><br><span class=\"line\">     */</span><br><span class=\"line\">    ElementType[] value();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6CE8;&#x89E3;&#x7684;&#x6E90;&#x7801;&#x90FD;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x8FD9;&#x91CC;&#x63A5;&#x6536;&#x4E86;&#x4E00;&#x4E2A;ElementType&#x6570;&#x7EC4;&#x53C2;&#x6570;&#xFF0C;ElementType&#x4E0D;&#x96BE;&#x731C;&#x51FA;&#x5B83;&#x7684;&#x7C7B;&#x578B;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x679A;&#x4E3E;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public enum ElementType {</span><br><span class=\"line\">    /** Class, interface (including annotation type), or enum declaration */</span><br><span class=\"line\">    TYPE,</span><br><span class=\"line\"> </span><br><span class=\"line\">    /** Field declaration (includes enum constants) */</span><br><span class=\"line\">    FIELD,</span><br><span class=\"line\"> </span><br><span class=\"line\">    /** Method declaration */</span><br><span class=\"line\">    METHOD,</span><br><span class=\"line\"> </span><br><span class=\"line\">    /** Formal parameter declaration */</span><br><span class=\"line\">    PARAMETER,</span><br><span class=\"line\"> </span><br><span class=\"line\">    /** Constructor declaration */</span><br><span class=\"line\">    CONSTRUCTOR,</span><br><span class=\"line\"> </span><br><span class=\"line\">    /** Local variable declaration */</span><br><span class=\"line\">    LOCAL_VARIABLE,</span><br><span class=\"line\"> </span><br><span class=\"line\">    /** Annotation type declaration */</span><br><span class=\"line\">    ANNOTATION_TYPE,</span><br><span class=\"line\"> </span><br><span class=\"line\">    /** Package declaration */</span><br><span class=\"line\">    PACKAGE,</span><br><span class=\"line\"> </span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Type parameter declaration</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * @since 1.8</span><br><span class=\"line\">     */</span><br><span class=\"line\">    TYPE_PARAMETER,</span><br><span class=\"line\"> </span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Use of a type</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * @since 1.8</span><br><span class=\"line\">     */</span><br><span class=\"line\">    TYPE_USE</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>ElementType&#x4E2D;&#x867D;&#x7136;&#x6709;10&#x5E38;&#x91CF;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x5B9E;&#x9645;&#x771F;&#x6B63;&#x5E38;&#x7528;&#x7684;&#x4E5F;&#x5C31;&#x662F;&#x524D;&#x9762;8&#x79CD;&#x3002;&#x5B83;&#x4EEC;&#x4EE3;&#x8868;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6CE8;&#x89E3;&#x80FD;&#x591F;&#x4F5C;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x5206;&#x522B;&#x4E3A;&#xFF1A;</p>\n<ol>\n<li>TYPE: &#x4F5C;&#x7528;&#x4E8E;&#x7C7B;&#x3001;&#x63A5;&#x53E3;&#x6216;&#x8005;&#x679A;&#x4E3E;</li>\n<li>FIELD&#xFF1A;&#x4F5C;&#x7528;&#x4E8E;&#x7C7B;&#x4E2D;&#x58F0;&#x660E;&#x7684;&#x5B57;&#x6BB5;&#x6216;&#x8005;&#x679A;&#x4E3E;&#x4E2D;&#x7684;&#x5E38;&#x91CF;</li>\n<li>METHOD&#xFF1A;&#x4F5C;&#x7528;&#x4E8E;&#x65B9;&#x6CD5;&#x7684;&#x58F0;&#x660E;&#x8BED;&#x53E5;&#x4E2D;</li>\n<li>PARAMETER&#xFF1A;&#x4F5C;&#x7528;&#x4E8E;&#x53C2;&#x6570;&#x58F0;&#x660E;&#x8BED;&#x53E5;&#x4E2D;</li>\n<li>CONSTRUCTOR&#xFF1A;&#x4F5C;&#x7528;&#x4E8E;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x58F0;&#x660E;&#x8BED;&#x53E5;&#x4E2D;</li>\n<li>LOCAL_VARIABLE&#xFF1A;&#x4F5C;&#x7528;&#x4E8E;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x7684;&#x58F0;&#x660E;&#x8BED;&#x53E5;&#x4E2D;</li>\n<li>ANNOTATION_TYPE&#xFF1A;&#x4F5C;&#x7528;&#x4E8E;&#x6CE8;&#x89E3;&#x7684;&#x58F0;&#x660E;&#x8BED;&#x53E5;&#x4E2D;</li>\n<li>PACKAGE&#xFF1A;&#x4F5C;&#x7528;&#x4E8E;&#x5305;&#x7684;&#x58F0;&#x660E;&#x8BED;&#x53E5;&#x4E2D;</li>\n<li>TYPE_PARAMETER&#xFF1A;java 1.8&#x4E4B;&#x540E;&#xFF0C;&#x4F5C;&#x7528;&#x4E8E;&#x7C7B;&#x578B;&#x58F0;&#x660E;&#x7684;&#x8BED;&#x53E5;&#x4E2D;</li>\n<li>TYPE_USE&#xFF1A;java 1.8&#x4E4B;&#x540E;&#xFF0C;&#x4F5C;&#x7528;&#x4E8E;&#x4F7F;&#x7528;&#x7C7B;&#x578B;&#x7684;&#x4EFB;&#x610F;&#x8BED;&#x53E5;&#x4E2D;</li>\n</ol>\n<p>&#x7ED3;&#x5408;&#x6211;&#x4EEC;&#x7684;BindView&#x7684;&#x4F5C;&#x7528;&#x662F;&#x5BF9;View&#x8FDB;&#x884C;id&#x7ED1;&#x5B9A;&#xFF0C;&#x81EA;&#x7136;&#x662F;&#x4F5C;&#x7528;&#x4E0E;&#x58F0;&#x660E;&#x7684;&#x5B57;&#x6BB5;&#x4E0A;&#x3002;&#x6240;&#x4EE5;&#x5728;BindView&#x4E2D;&#x4F7F;&#x7528;&#x4E86;FIELD&#x3002;</p>\n<p>&#x518D;&#x6765;&#x770B;&#x7B2C;&#x56DB;&#x884C;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@IdRes int[] value()</span><br></pre></td></tr></table></figure>\n<p>&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x6CE8;&#x89E3;&#x63A5;&#x89E6;&#xFF0C;&#x4E0D;&#x96BE;&#x7406;&#x89E3;&#x8FD9;&#x662F;&#x6807;&#x660E;BindView&#x5C06;&#x63A5;&#x6536;&#x4E00;&#x4E2A;int&#x7C7B;&#x578B;&#x7684;&#x6570;&#x7EC4;&#x53C2;&#x6570;&#x3002;&#x5BF9;&#x4E8E;&#x5F00;&#x6E90;&#x5E93;butterknife&#x4E2D;&#x7684;BindView&#x662F;&#x63A5;&#x6536;&#x9700;&#x8981;&#x7ED1;&#x5B9A;&#x7684;View&#x7684;id&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x505A;&#x4E00;&#x4E2A;&#x6539;&#x7248;&#xFF0C;&#x518D;&#x63A5;&#x6536;&#x4E00;&#x4E2A;String&#x7684;id&#xFF0C;&#x7528;&#x6765;&#x4E3A;&#x7ED1;&#x5B9A;&#x7684;View&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x503C;&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x4E86;&#x7684;BindView&#x6CE8;&#x91CA;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x3002;</p>\n<h2 id=\"OnClick\"><a href=\"#OnClick\" class=\"headerlink\" title=\"OnClick\"></a>OnClick</h2><p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x518D;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;OnClick&#x70B9;&#x51FB;&#x7684;&#x6CE8;&#x89E3;&#xFF0C;&#x7ECF;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x8111;&#x6D77;&#x4E2D;&#x60F3;&#x60F3;Retention&#x4E0E;Target&#x5206;&#x522B;&#x4EC0;&#x4E48;&#x503C;&#xFF1F;</p>\n<p>&#x60F3;&#x597D;&#x4E86;&#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x5728;&#x6765;&#x8FC7;&#x4E00;&#x904D;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Retention(RetentionPolicy.SOURCE)</span><br><span class=\"line\">@Target(ElementType.METHOD)</span><br><span class=\"line\">public @interface OnClick {</span><br><span class=\"line\">    @IdRes int value();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>Retention&#x7684;&#x4F5C;&#x7528;&#x8303;&#x56F4;&#x4E0E;BindView&#x4E00;&#x6837;&#x9996;&#x9875;SOURCE&#xFF0C;&#x5728;&#x7F16;&#x8BD1;&#x4E4B;&#x540E;&#x5C31;&#x65E0;&#x9700;&#x5B58;&#x5728;&#xFF1B;Target&#x7684;&#x4F5C;&#x7528;&#x5BF9;&#x8C61;&#x4E0E;BindView&#x4E0D;&#x540C;&#xFF0C;&#x65E2;&#x7136;&#x662F;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x7684;&#x70B9;&#x51FB;&#x64CD;&#x4F5C;&#xFF0C;&#x81EA;&#x7136;&#x662F;&#x4F5C;&#x7528;&#x5728;&#x64CD;&#x4F5C;&#x903B;&#x8F91;&#x7684;&#x65B9;&#x6CD5;&#x4E0A;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;METHOD&#x3002;</p>\n<h2 id=\"keep\"><a href=\"#keep\" class=\"headerlink\" title=\"keep\"></a>keep</h2><p>&#x6587;&#x7AE0;&#x5F00;&#x5934;&#x6709;&#x63D0;&#x53CA;&#x5230;&#x672C;&#x8D28;&#x662F;&#x901A;&#x8FC7;&#x6CE8;&#x89E3;&#x6765;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x4EE3;&#x7801;&#xFF0C;&#x4E3A;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x6240;&#x9700;&#x7684;&#x7C7B;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x4E2D;&#x4E00;&#x65E6;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x6DF7;&#x6DC6;&#x4E86;&#xFF0C;&#x8FD9;&#x5C06;&#x4F1A;&#x5BFC;&#x81F4;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x7684;&#x7C7B;&#x5931;&#x6548;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6CE8;&#x89E3;&#x5931;&#x6548;&#x3002;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x5176;&#x5931;&#x6548;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x8FD9;&#x91CC;&#x518D;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x6CE8;&#x89E3;keep&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Retention(RetentionPolicy.CLASS)</span><br><span class=\"line\">@Target(ElementType.TYPE)</span><br><span class=\"line\">public @interface Keep {</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>Retention&#x7684;&#x4F5C;&#x7528;&#x8303;&#x56F4;&#x662F;&#x5728;class&#x6587;&#x4EF6;&#x4E2D;&#x8FD8;&#x8981;&#x80FD;&#x591F;&#x88AB;&#x5176;&#x5B83;class&#x8C03;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;CLASS&#xFF1B;Target&#x4F5C;&#x7528;&#x5BF9;&#x8C61;&#x662F;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x4F7F;&#x7528;TYPE&#x3002;&#x81F3;&#x4E8E;&#x53C2;&#x6570;&#x5219;&#x4E0D;&#x5FC5;&#x8981;&#xFF0C;&#x5B83;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x6807;&#x660E;&#x7C7B;&#xFF0C;&#x9632;&#x6B62;&#x5176;&#x88AB;&#x6DF7;&#x6DC6;&#x3002;</p>\n<h2 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h2><p>butterknife-annotations&#x5E93;&#x4E2D;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x6CE8;&#x89E3;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x3002;&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x6211;&#x4EEC;&#x6CE8;&#x610F;&#x70B9;&#x4E3B;&#x8981;&#x5F52;&#x7ED3;&#x4E8E;&#x4EE5;&#x4E0B;&#x4E09;&#x70B9;&#xFF1A;</p>\n<ol>\n<li>Retention: &#x660E;&#x786E;&#x6CE8;&#x89E3;&#x4F5C;&#x7528;&#x7684;&#x751F;&#x547D;&#x65F6;&#x957F;&#xFF0C;&#x5C3D;&#x65E9;&#x7684;&#x6D88;&#x9664;</li>\n<li>Target: &#x660E;&#x786E;&#x6CE8;&#x89E3;&#x4F5C;&#x7528;&#x7684;&#x5BF9;&#x8C61;</li>\n<li>Keep: &#x9632;&#x6B62;&#x540E;&#x7EED;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x7C7B;&#x88AB;&#x6DF7;&#x6DC6;</li>\n</ol>\n<p>&#x6CE8;&#x89E3;&#x53D8;&#x91CF;&#x7684;&#x5B9A;&#x4E49;&#x5C31;&#x5230;&#x8FD9;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x540C;&#x65F6;&#x6587;&#x7AE0;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x53EF;&#x4EE5;&#x5728;<a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">Github</a>&#x4E2D;&#x83B7;&#x53D6;&#x5230;&#x3002;&#x4F7F;&#x7528;&#x65F6;&#x8BF7;&#x5C06;&#x5206;&#x652F;&#x5207;&#x6362;&#x5230;feat_annotation_processing</p>\n<p>&#x6700;&#x540E;&#x656C;&#x8BF7;&#x5173;&#x6CE8;&#x4E0B;&#x4E00;&#x90E8;&#x5206;<strong>&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;Part2:&#x4EE3;&#x7801;&#x81EA;&#x52A8;&#x751F;&#x6210;</strong></p>\n<h2 id=\"&#x76F8;&#x5173;&#x6587;&#x7AE0;\"><a href=\"#&#x76F8;&#x5173;&#x6587;&#x7AE0;\" class=\"headerlink\" title=\"&#x76F8;&#x5173;&#x6587;&#x7AE0;\"></a>&#x76F8;&#x5173;&#x6587;&#x7AE0;</h2><p><a href=\"https://idisfkj.github.io/2018/07/04/%E8%87%AA%E5%AE%9A%E4%B9%89Android%E6%B3%A8%E8%A7%A3Part2-%E4%BB%A3%E7%A0%81%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90/\" target=\"_blank\" rel=\"noopener\">&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;Part2:&#x4EE3;&#x7801;&#x81EA;&#x52A8;&#x751F;&#x6210;</a></p>\n<p><a href=\"https://idisfkj.github.io/2018/07/11/%E8%87%AA%E5%AE%9A%E4%B9%89Android%E6%B3%A8%E8%A7%A3Part3-%E7%BB%91%E5%AE%9A/\" target=\"_blank\" rel=\"noopener\">&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;Part3:&#x7ED1;&#x5B9A;</a></p>\n<h2 id=\"&#x5173;&#x6CE8;\"><a href=\"#&#x5173;&#x6CE8;\" class=\"headerlink\" title=\"&#x5173;&#x6CE8;\"></a>&#x5173;&#x6CE8;</h2><p><img src=\"/2018/07/01/&#x81EA;&#x5B9A;&#x4E49;Android&#x6CE8;&#x89E3;Part1-&#x6CE8;&#x89E3;&#x53D8;&#x91CF;/wx.jpg\" alt></p>\n","categories":["android"],"tags":["Android Annotation Processing"]},{"title":"Android Architecture Components Part4:ViewModel","url":"https://www.rousetime.com/2018/06/22/Android-Architecture-Components-Part4-ViewModel/","content":"<p><img src=\"/2018/06/22/Android-Architecture-Components-Part4-ViewModel/cover.png\" alt></p>\n<p>&#x5728;Android Architecture Components(AAC)&#x4E2D;ViewMode&#x662F;&#x4E3A;&#x754C;&#x9762;&#x7EC4;&#x4EF6;&#x63D0;&#x4F9B;&#x6570;&#x636E;&#x5E76;&#x53EF;&#x5728;&#x754C;&#x9762;&#x914D;&#x7F6E;&#x66F4;&#x6539;&#x540E;&#x7EE7;&#x7EED;&#x5B58;&#x5728;&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x4F8B;&#x5982;&#x754C;&#x9762;&#x7684;&#x65CB;&#x8F6C;&#x5BFC;&#x81F4;&#x754C;&#x9762;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x6539;&#x53D8;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x4E3A;&#x754C;&#x9762;&#x63D0;&#x4F9B;&#x6570;&#x636E;&#xFF0C;&#x6211;&#x4EEC;&#x6240;&#x77E5;&#x9053;&#x7684;&#x4E5F;&#x6709;&#x5176;&#x4ED6;&#x7684;&#x4E00;&#x4E9B;&#x6A21;&#x5F0F;&#xFF0C;&#x4F8B;&#x5982;MVP&#x7684;Presenter&#x4E0E;MVVM&#x4E2D;&#x7684;ViewModel&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x8FDB;&#x884C;&#x4E00;&#x4E2A;&#x5047;&#x8BBE;&#xFF0C;&#x5982;&#x679C;Activity&#x53D1;&#x751F;&#x754C;&#x9762;&#x65CB;&#x8F6C;&#xFF0C;&#x6B64;&#x65F6;&#x4E0A;&#x8FF0;&#x7684;&#x63D0;&#x4F9B;&#x6570;&#x636E;&#x7684;&#x6A21;&#x5F0F;&#x4F1A;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p>\n<ol>\n<li>&#x5BF9;&#x4E8E;Activity&#x7684;&#x91CD;&#x5EFA;&#xFF0C;&#x4E3A;&#x4E86;&#x63D0;&#x4F9B;ui&#x6240;&#x9700;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x91CD;&#x65B0;&#x83B7;&#x53D6;&#x6570;&#x636E;(&#x7F51;&#x7EDC;&#x6216;&#x8005;&#x672C;&#x5730;&#x6570;&#x636E;&#x5E93;)&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x8981;&#x91CD;&#x65B0;&#x8FDB;&#x884C;&#x4FDD;&#x5B58;&#x64CD;&#x4F5C;&#x3002;</li>\n<li>&#x5728;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x4F60;&#x5FC5;&#x987B;&#x8981;&#x5904;&#x7406;&#x4E00;&#x4E9B;&#x53EF;&#x80FD;&#x9020;&#x6210;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x9732;&#x95EE;&#x9898;&#x3002;</li>\n</ol>\n<p>&#x5BF9;&#x4E8E;&#x4EE5;&#x4E0A;&#x95EE;&#x9898;&#xFF0C;ViewModel&#x90FD;&#x80FD;&#x591F;&#x5E2E;&#x6211;&#x4EEC;&#x89E3;&#x51B3;&#x3002;&#x53EA;&#x8981;Activity&#x6CA1;&#x6709;&#x5F7B;&#x5E95;&#x88AB;&#x9500;&#x6BC1;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x90FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;ViewModel&#xFF0C;&#x540C;&#x65F6;&#x5BF9;&#x4E8E;&#x5B83;&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x9500;&#x6BC1;&#x6211;&#x4EEC;&#x65E0;&#x9700;&#x8FDB;&#x884C;&#x7EF4;&#x62A4;&#x7BA1;&#x7406;&#xFF0C;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x4FDD;&#x8BC1;&#x8D44;&#x6E90;&#x7684;&#x91CA;&#x653E;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x7684;&#x8FD9;&#x5F20;&#x56FE;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x66F4;&#x597D;&#x7684;&#x89C2;&#x5BDF;&#x5B83;&#x5728;Activity&#x4E2D;&#x7684;&#x751F;&#x547D;&#x72B6;&#x6001;</p>\n<p><img src=\"/2018/06/22/Android-Architecture-Components-Part4-ViewModel/viewmodel.png\" alt></p>\n<p>ViewModel&#x8D2F;&#x7A7F;Activity&#x7684;&#x6574;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x53EA;&#x6709;&#x5F53;Activity&#x5F7B;&#x5E95;&#x91CA;&#x653E;&#x65F6;&#x624D;&#x4F1A;&#x5C06;&#x5176;&#x9500;&#x6BC1;&#x3002;&#x6240;&#x4EE5;&#x5B83;&#x80FD;&#x591F;&#x66F4;&#x597D;&#x7684;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x6301;&#x4E45;&#x5316;&#x6570;&#x636E;&#xFF0C;&#x9632;&#x6B62;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x6570;&#x636E;&#x8BF7;&#x6C42;&#xFF0C;&#x63D0;&#x9AD8;App&#x7684;&#x6027;&#x80FD;&#x3002;</p>\n<blockquote>\n<p>&#x662F;&#x4E0D;&#x662F;&#x6709;&#x70B9;&#x597D;&#x5947;&#x4E86;&#x5462;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x5B83;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;&#x7B80;&#x5355;&#x5462;&#xFF1F;&#x56E0;&#x4E3A;&#x771F;&#x7684;&#x5F88;&#x7B80;&#x5355;&#x2026;</p>\n</blockquote>\n<h2 id=\"&#x4F9D;&#x8D56;\"><a href=\"#&#x4F9D;&#x8D56;\" class=\"headerlink\" title=\"&#x4F9D;&#x8D56;\"></a>&#x4F9D;&#x8D56;</h2><p>&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x89E3;&#x8FC7;&#x4E0A;&#x7BC7;&#x5173;&#x4E8E;Lifecycle&#x7684;&#x6587;&#x7AE0;<a href=\"https://idisfkj.github.io/2018/06/14/Android-Architecture-Components-Part3-Lifecycle/\" target=\"_blank\" rel=\"noopener\">(Android Architecture Components Part3:Lifecycle)</a>&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8DF3;&#x8FC7;&#x4F9D;&#x8D56;&#x90E8;&#x5206;&#xFF0C;&#x6CA1;&#x6709;&#x7684;&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x3002;</p>\n<p>&#x5728;&#x4F7F;&#x7528;ViewModel&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;App&#x6216;&#x8005;Module&#x7684;build.gradle&#x4E2D;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    def lifecycle_version = &quot;1.1.1&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">    // ViewModel and LiveData</span><br><span class=\"line\">    implementation &quot;android.arch.lifecycle:extensions:$lifecycle_version&quot;   </span><br><span class=\"line\">    annotationProcessor &quot;android.arch.lifecycle:compiler:$lifecycle_version&quot;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x4F7F;&#x7528;\"><a href=\"#&#x4F7F;&#x7528;\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;\"></a>&#x4F7F;&#x7528;</h2><p>&#x4F9D;&#x8D56;&#x5DF2;&#x7ECF;&#x51C6;&#x5907;&#x5B8C;&#x6BD5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#x4F7F;&#x7528;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ContactsViewModel(application: Application, private val defTitle: String = &quot;Contacts&quot;) : AndroidViewModel(application) {</span><br><span class=\"line\">    val message: MutableLiveData&lt;String&gt; by lazy { MutableLiveData&lt;String&gt;() }</span><br><span class=\"line\">    val contactsList: MutableLiveData&lt;List&lt;ContactsModel&gt;&gt; = MutableLiveData()</span><br><span class=\"line\">    ....</span><br><span class=\"line\">    ....</span><br><span class=\"line\">    </span><br><span class=\"line\">    fun getContacts(refresh: Boolean): LiveData&lt;List&lt;ContactsModel&gt;&gt; {</span><br><span class=\"line\">        message.value = &quot;&quot;</span><br><span class=\"line\">        if (refresh) {</span><br><span class=\"line\">            getDataFromRemote()</span><br><span class=\"line\">        } else if (contactsList.value == null || contactsList.value?.size ?: 0 &lt;= 0) {</span><br><span class=\"line\">            message.value = &quot;&#x6570;&#x636E;&#x8BF7;&#x6C42;&#x4E2D;&#xFF0C;&#x8BF7;&#x7A0D;&#x540E;&#xFF01;&quot;</span><br><span class=\"line\">            if (mLocalData.isEmpty()) {</span><br><span class=\"line\">                getDataFromLocal()</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        return contactsList</span><br><span class=\"line\">    }</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x521B;&#x5EFA;ContactsViewModel&#xFF0C;&#x8BA9;&#x5B83;&#x7EE7;&#x627F;&#x4E8E;AndroidViewModel&#xFF0C;&#x5B83;&#x662F;&#x5BF9;&#x62BD;&#x8C61;ViewModel&#x7684;&#x6269;&#x5C55;&#xFF0C;&#x4F7F;&#x7528;&#x5B83;&#x65F6;&#x9700;&#x8981;&#x4F20;&#x5165;Application&#x5BF9;&#x8C61;&#xFF0C;&#x65B9;&#x4FBF;&#x4E00;&#x4E9B;&#x8D44;&#x6E90;&#x7684;&#x83B7;&#x53D6;&#x3002;&#x7531;&#x4E8E;ViewModel&#x7684;&#x7279;&#x6027;&#x662F;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x6301;&#x4E45;&#x5316;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4E0D;&#x80FD;&#x6301;&#x6709;&#x4E0E;Activity&#x76F8;&#x5173;&#x7684;&#x5F15;&#x7528;(Context)&#xFF0C;&#x9632;&#x6B62;&#x5185;&#x5B58;&#x6CC4;&#x9732;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E0E;&#x5E94;&#x7528;&#x751F;&#x547D;&#x5468;&#x671F;&#x7ED1;&#x5B9A;&#x7684;Application&#x3002;</p>\n<p>&#x5728;ContactsViewModel&#x4E2D;&#x6211;&#x4EEC;&#x7ED3;&#x5408;MutableLiveData&#x6765;&#x66F4;&#x597D;&#x7684;&#x7BA1;&#x7406;&#x6570;&#x636E;&#x7684;&#x53D8;&#x5316;&#x66F4;&#x65B0;&#x3002;</p>\n<p>ViewModel&#x521B;&#x5EFA;&#x597D;&#x4E86;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x53EA;&#x5269;&#x4E0B;&#x5728;Activity&#x4E2D;&#x8FDB;&#x884C;&#x4F7F;&#x7528;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ContactsActivity : AppCompatActivity() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    private lateinit var mViewModel: ContactsViewModel</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) {</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_contacts_layout)</span><br><span class=\"line\">        setupViewModel()</span><br><span class=\"line\">    }</span><br><span class=\"line\">    </span><br><span class=\"line\">    private fun setupViewModel() {</span><br><span class=\"line\">        mViewModel = ViewModelProviders.of(this)[ContactsViewModel::class.java]</span><br><span class=\"line\">        //active STARTED&#x3001;RESUMED</span><br><span class=\"line\">        mViewModel.getContacts(true).observe(this,</span><br><span class=\"line\">                Observer {</span><br><span class=\"line\">                    //todo ...</span><br><span class=\"line\">                })</span><br><span class=\"line\">        mViewModel.message.observe(this,</span><br><span class=\"line\">                Observer {</span><br><span class=\"line\">                    //todo ...</span><br><span class=\"line\">                })</span><br><span class=\"line\">    }   </span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5B9E;&#x9645;&#x4E0A;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x5C31;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5230;ViewModel&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x901A;&#x8FC7;<strong>ViewModelProviders.of()</strong>&#x65B9;&#x6CD5;&#x4F20;&#x5165;Activity&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;ViewModelProvider&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x518D;&#x4F7F;&#x7528;&#x5B83;&#x7684;<strong>get()</strong>&#x6765;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;ViewModel&#x7684;Class&#x5BF9;&#x8C61;&#x6765;&#x83B7;&#x53D6;&#x5230;&#x76F8;&#x5E94;&#x7684;ViewModel&#x5B9E;&#x4F8B;&#x3002;</p>\n<p>&#x53EA;&#x8981;Activity&#x5BF9;&#x8C61;&#x6CA1;&#x6709;&#x6539;&#x53D8;&#xFF0C;&#x540C;&#x65F6;&#x90FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;ViewModel&#x7684;Class&#x5BF9;&#x8C61;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x65E0;&#x8BBA;&#x4F55;&#x65F6;&#x83B7;&#x53D6;&#x7684;&#x90FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;ViewModel&#x5B9E;&#x4F8B;&#x3002;&#x8FD9;&#x5C31;&#x5B9E;&#x73B0;&#x4E86;&#x5728;Activity&#x4E2D;&#x7684;ViewModel&#x6301;&#x4E45;&#x5316;&#x7279;&#x6027;&#x3002;&#x7531;&#x4E8E;ViewModel&#x662F;&#x540C;&#x4E00;&#x4E2A;&#xFF0C;&#x81EA;&#x7136;&#x5B83;&#x91CC;&#x9762;&#x7684;&#x6570;&#x636E;&#x4E5F;&#x662F;&#x540C;&#x4E00;&#x4EFD;&#x3002;</p>\n<p>&#x5F97;&#x5230;ViewModel&#x540E;&#xFF0C;&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x64CD;&#x4F5C;&#x4E0E;&#x54CD;&#x5E94;&#x3002;&#x8FD9;&#x91CC;&#x7ED3;&#x5408;&#x4E86;LiveData&#x6240;&#x4EE5;&#x65B9;&#x4FBF;&#x4E86;&#x8BB8;&#x591A;&#x3002;</p>\n<blockquote>\n<p>LiveData&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x6709;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#xFF0C;&#x5982;&#x9700;&#x4E86;&#x89E3;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x6587;&#x7AE0;&#x672B;&#x7684;&#x94FE;&#x63A5;&#x3002;</p>\n</blockquote>\n<h2 id=\"ViewModelProvider\"><a href=\"#ViewModelProvider\" class=\"headerlink\" title=\"ViewModelProvider\"></a>ViewModelProvider</h2><p>&#x5230;&#x8FD9;&#x91CC;&#x6211;&#x60F3;&#x4F60;&#x5FC3;&#x4E2D;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x5982;&#x4E0B;&#x51E0;&#x4E2A;&#x7591;&#x95EE;</p>\n<ol>\n<li>ViewModel&#x5B83;&#x662F;&#x5982;&#x4F55;&#x521D;&#x59CB;&#x5316;&#x7684;&#xFF0C;&#x5BF9;&#x8C61;&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x4F8B;&#x5316;&#x7684;</li>\n<li>&#x5982;&#x4F55;&#x5411;ViewModel&#x4E2D;&#x4F20;&#x9012;&#x521D;&#x59CB;&#x5316;&#x7684;&#x53C2;&#x6570;</li>\n</ol>\n<p>&#x8FD9;&#x4E24;&#x4E2A;&#x7591;&#x95EE;&#x90FD;&#x5C06;&#x7531;ViewModelProvider&#x6765;&#x89E3;&#x51B3;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x56DE;&#x5230;&#x83B7;&#x53D6;ViewModelProvider&#x7684;<strong>ViewModelProviders.of()</strong>&#x65B9;&#x6CD5;&#xFF0C;&#x8FDB;&#x5165;&#x6E90;&#x7801;&#x67E5;&#x770B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@NonNull</span><br><span class=\"line\">@MainThread</span><br><span class=\"line\">public static ViewModelProvider of(@NonNull FragmentActivity activity,</span><br><span class=\"line\">        @Nullable Factory factory) {</span><br><span class=\"line\">    Application application = checkApplication(activity);</span><br><span class=\"line\">    if (factory == null) {</span><br><span class=\"line\">        factory = ViewModelProvider.AndroidViewModelFactory.getInstance(application);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return new ViewModelProvider(ViewModelStores.of(activity), factory);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x4E5F;&#x6CA1;&#x6709;&#x53D1;&#x73B0;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x53D1;&#x73B0;factory&#x3002;&#x6211;&#x4EEC;&#x5728;&#x83B7;&#x53D6;ViewModel&#x65F6;&#x5E76;&#x6CA1;&#x6709;&#x4F20;&#x5165;factory&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4F1A;&#x8D70;&#x7A7A;&#x5224;&#x65AD;&#x91CC;&#x9762;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x7684;factory&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x518D;&#x8FDB;&#x5165;ViewModelProvider&#x4E2D;&#x67E5;&#x770B;&#x9759;&#x6001;&#x5185;&#x90E8;&#x7C7B;AndroidViewModelFactory</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static class AndroidViewModelFactory extends ViewModelProvider.NewInstanceFactory {</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\">    ...</span><br><span class=\"line\"> </span><br><span class=\"line\">    @NonNull</span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public &lt;T extends ViewModel&gt; T create(@NonNull Class&lt;T&gt; modelClass) {</span><br><span class=\"line\">        if (AndroidViewModel.class.isAssignableFrom(modelClass)) {</span><br><span class=\"line\">            //noinspection TryWithIdenticalCatches</span><br><span class=\"line\">            try {</span><br><span class=\"line\">                return modelClass.getConstructor(Application.class).newInstance(mApplication);</span><br><span class=\"line\">            } catch (NoSuchMethodException e) {</span><br><span class=\"line\">                throw new RuntimeException(&quot;Cannot create an instance of &quot; + modelClass, e);</span><br><span class=\"line\">            } catch (IllegalAccessException e) {</span><br><span class=\"line\">                throw new RuntimeException(&quot;Cannot create an instance of &quot; + modelClass, e);</span><br><span class=\"line\">            } catch (InstantiationException e) {</span><br><span class=\"line\">                throw new RuntimeException(&quot;Cannot create an instance of &quot; + modelClass, e);</span><br><span class=\"line\">            } catch (InvocationTargetException e) {</span><br><span class=\"line\">                throw new RuntimeException(&quot;Cannot create an instance of &quot; + modelClass, e);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        return super.create(modelClass);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x53EA;&#x770B;&#x5173;&#x952E;&#x4EE3;&#x7801;&#xFF0C;&#x5B83;&#x7EE7;&#x627F;&#x4E8E;NewInstanceFactory&#xFF0C;&#x5176;&#x4E2D;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;<strong>create()</strong>&#x3002;AndroidViewModelFactory&#x91CD;&#x65B0;&#x5B9E;&#x73B0;&#x4E86;<strong>create()</strong>&#xFF0C;&#x5728;&#x91CD;&#x5199;&#x7684;&#x65B9;&#x6CD5;&#x4E2D;&#x6211;&#x4EEC;&#x627E;&#x5230;&#x4E86;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#x5B83;&#x901A;&#x8FC7;Class&#x7684;<strong>getConstructor()</strong>&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x5339;&#x914D;&#x7684;Constructor&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x901A;&#x8FC7;<strong>newInstance()</strong>&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x5339;&#x914D;&#x7684;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x6240;&#x9700;&#x8981;&#x7684;ViewModel&#x5B9E;&#x4F8B;&#x5C31;&#x521B;&#x5EFA;&#x4E86;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x7591;&#x95EE;&#x5C31;&#x6B64;&#x89E3;&#x51B3;&#x3002;</p>\n<p>&#x81F3;&#x4E8E;&#x7B2C;&#x4E8C;&#x4E2A;&#x7591;&#x95EE;&#xFF0C;&#x7EC6;&#x5FC3;&#x7684;&#x8BDD;&#x4E0D;&#x96BE;&#x53D1;&#x73B0;&#xFF0C;&#x4E0A;&#x9762;&#x5728;&#x8C03;&#x7528;<strong>newInstance()</strong>&#x65B9;&#x6CD5;&#x65F6;&#x5DF2;&#x7ECF;&#x4F20;&#x4E86;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x7684;&#x53C2;&#x6570;mApplication&#x3002;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8981;&#x518D;&#x4F20;&#x5165;&#x5176;&#x5B83;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x521D;&#x59CB;&#x5316;&#x53C2;&#x6570;&#xFF0C;&#x53EA;&#x9700;&#x5B9E;&#x73B0;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;<strong>create()</strong>&#x65B9;&#x6CD5;&#x3002;&#x8981;&#x81EA;&#x5B9A;&#x4E49;<strong>create()</strong>&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x8981;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;factory&#xFF0C;&#x7EE7;&#x627F;NewInstanceFactory&#x7C7B;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x662F;&#x5B9E;&#x73B0;ContactsViewModel&#x5728;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x4F20;&#x5165;&#x7279;&#x5B9A;&#x7684;title&#x503C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ContactsFactory(private val application: Application) : ViewModelProvider.NewInstanceFactory() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    companion object {</span><br><span class=\"line\">        @SuppressLint(&quot;StaticFieldLeak&quot;)</span><br><span class=\"line\">        private var instance: ContactsFactory? = null</span><br><span class=\"line\"> </span><br><span class=\"line\">        fun getInstance(application: Application): ContactsFactory {</span><br><span class=\"line\">            if (instance == null) {</span><br><span class=\"line\">                instance = ContactsFactory(application)</span><br><span class=\"line\">            }</span><br><span class=\"line\">            return instance as ContactsFactory</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun &lt;T : ViewModel?&gt; create(modelClass: Class&lt;T&gt;): T {</span><br><span class=\"line\">        if (modelClass.isAssignableFrom(ContactsViewModel::class.java)) {</span><br><span class=\"line\">            return ContactsViewModel(application, &quot;Factory Contacts&quot;) as T</span><br><span class=\"line\">        }</span><br><span class=\"line\">        return super.create(modelClass)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x91CD;&#x70B9;&#x81EA;&#x7136;&#x662F;<strong>create()</strong>&#x65B9;&#x6CD5;&#xFF0C;&#x901A;&#x8FC7;<strong>isAssignableFrom()</strong>&#x65B9;&#x6CD5;&#x5224;&#x65AD;&#x9700;&#x8981;&#x5B9E;&#x4F8B;&#x5316;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x660E;&#x786E;&#x5230;&#x5177;&#x4F53;&#x7684;&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x6B63;&#x5E38;&#x7684;&#x7C7B;&#x5B9E;&#x4F8B;&#x5316;&#x64CD;&#x4F5C;&#x3002;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;factory&#xFF0C;&#x6700;&#x540E;&#x5728;&#x83B7;&#x53D6;ViewModel&#x65F6;&#x4F20;&#x5165;&#x5373;&#x53EF;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mViewModel = ViewModelProviders.of(this, ContactsFactory.getInstance(application))[ContactsViewModel::class.java]</span><br></pre></td></tr></table></figure>\n<p>ViewModel&#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x5B83;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x6301;&#x4E45;&#x5316;&#x5374;&#x5F02;&#x5E38;&#x7A81;&#x51FA;&#x3002;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x8FEB;&#x4E0D;&#x53CA;&#x5F85;&#x4E86;&#x5462;&#xFF1F;&#x8D76;&#x7D27;&#x6765;&#x8BD5;&#x8BD5;&#x5B83;&#x7684;&#x7279;&#x6027;&#x5427;&#x3002;</p>\n<h2 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h2><p>&#x6700;&#x540E;Android Architecture Components(AAC)&#x7CFB;&#x5217;&#x5230;&#x6B64;&#x5C31;&#x544A;&#x4E00;&#x6BB5;&#x843D;&#x4E86;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x6765;&#x56DE;&#x987E;&#x4E00;&#x4E0B;AAC&#x3002;&#x6211;&#x4EEC;&#x901A;&#x8FC7;Room&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x65B9;&#x4FBF;&#x7684;&#x5B9E;&#x73B0;&#x672C;&#x5730;&#x6570;&#x636E;&#x5B58;&#x50A8;&#xFF1B;&#x7ED3;&#x5408;LiveData&#x6765;&#x89C2;&#x6D4B;&#x6570;&#x636E;&#x7684;&#x66F4;&#x65B0;&#x53D8;&#x5316;&#x4E0E;&#x53CA;&#x65F6;&#x53CD;&#x6620;&#x5230;UI&#x5C42;&#xFF1B;&#x540C;&#x65F6;&#x4F7F;&#x7528;Lifecycle&#x6765;&#x8BA9;&#x6211;&#x4EEC;&#x7684;&#x7EC4;&#x4EF6;&#x6216;&#x6570;&#x636E;&#x5BB9;&#x5668;&#x7684;&#x5177;&#x5907;&#x751F;&#x547D;&#x611F;&#x77E5;&#x80FD;&#x529B;&#xFF0C;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x7684;&#x51CF;&#x5C11;&#x751F;&#x547D;&#x72B6;&#x6001;&#x7684;&#x5904;&#x7406;&#x4E0E;&#x5F02;&#x5E38;&#x9519;&#x8BEF;&#x7684;&#x53D1;&#x751F;&#xFF1B;&#x6700;&#x540E;&#x5C06;&#x754C;&#x9762;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5230;ViewModel&#x4E2D;&#xFF0C;&#x4F7F;&#x5F97;&#x6570;&#x636E;&#x8FBE;&#x5230;&#x6301;&#x4E45;&#x5316;&#xFF0C;&#x51CF;&#x5C11;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x6570;&#x636E;&#x8BF7;&#x6C42;&#x4E0E;&#x8D44;&#x6E90;&#x6D88;&#x8017;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x7684;&#x80FD;&#x591F;&#x521D;&#x6B65;&#x4F53;&#x73B0;&#x4F7F;&#x7528;AAC&#x540E;&#x7684;App&#x9879;&#x76EE;&#x67B6;&#x6784;&#x5F62;&#x6001;</p>\n<p><img src=\"/2018/06/22/Android-Architecture-Components-Part4-ViewModel/architectureComponents.png\" alt></p>\n<p>&#x6700;&#x540E;&#x611F;&#x8C22;&#x5927;&#x5BB6;&#x5BF9;AAC&#x67B6;&#x6784;&#x7CFB;&#x5217;&#x7684;&#x652F;&#x6301;&#xFF01;&#x540C;&#x65F6;&#x6587;&#x7AE0;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x53EF;&#x4EE5;&#x5728;<a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">Github</a>&#x4E2D;&#x83B7;&#x53D6;&#x5230;&#x3002;&#x4F7F;&#x7528;&#x65F6;&#x8BF7;&#x5C06;&#x5206;&#x652F;&#x5207;&#x6362;&#x5230;feat_architecture_components</p>\n<h2 id=\"&#x76F8;&#x5173;&#x6587;&#x7AE0;\"><a href=\"#&#x76F8;&#x5173;&#x6587;&#x7AE0;\" class=\"headerlink\" title=\"&#x76F8;&#x5173;&#x6587;&#x7AE0;\"></a>&#x76F8;&#x5173;&#x6587;&#x7AE0;</h2><p><a href=\"https://idisfkj.github.io/2018/06/07/Android-Architecture-Components-Part1-Room/\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part1:Room</a><br><a href=\"https://idisfkj.github.io/2018/06/10/Android-Architecture-Components-Part2-LiveData/\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part2:LiveData</a><br><a href=\"https://idisfkj.github.io/2018/06/14/Android-Architecture-Components-Part3-Lifecycle/\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part3:Lifecycle</a></p>\n<h2 id=\"&#x5173;&#x6CE8;\"><a href=\"#&#x5173;&#x6CE8;\" class=\"headerlink\" title=\"&#x5173;&#x6CE8;\"></a>&#x5173;&#x6CE8;</h2><p><img src=\"/2018/06/22/Android-Architecture-Components-Part4-ViewModel/wx.jpg\" alt></p>\n","categories":["android"],"tags":["Android Architecture Components"]},{"title":"Android Architecture Components Part3:Lifecycle","url":"https://www.rousetime.com/2018/06/14/Android-Architecture-Components-Part3-Lifecycle/","content":"<p><img src=\"/2018/06/14/Android-Architecture-Components-Part3-Lifecycle/cover.png\" alt></p>\n<p>&#x4E0A;&#x671F;&#x6587;&#x7AE0;&#x6211;&#x4EEC;&#x8BB2;&#x89E3;&#x4E86;LiveData&#xFF0C;&#x77E5;&#x9053;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x89C2;&#x5BDF;&#x5BB9;&#x5668;&#x540C;&#x65F6;&#x5177;&#x5907;&#x751F;&#x547D;&#x611F;&#x77E5;&#x80FD;&#x529B;&#x3002;&#x90A3;&#x4E48;&#x5B83;&#x7684;&#x751F;&#x547D;&#x611F;&#x77E5;&#x80FD;&#x529B;&#x53C8;&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x5462;&#xFF1F;&#x5728;&#x4F7F;&#x7528;LiveData&#x8FDB;&#x884C;&#x6CE8;&#x518C;observer&#x65F6;&#xFF0C;&#x662F;&#x5426;&#x8BB0;&#x5F97;&#x5176;&#x4E2D;&#x7684;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x3002;&#x5176;&#x4E00;&#x662F;Observer&#x7684;&#x56DE;&#x8C03;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x5C31;&#x662F;LifecycleOwner&#x3002;&#x5B83;&#x5C31;&#x5C5E;&#x4E8E;Lifecycle&#x4E2D;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</p>\n<p>Activity/Fragment&#x5C31;&#x662F;&#x5177;&#x6709;&#x751F;&#x547D;&#x72B6;&#x6001;&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x800C;&#x4E14;&#x4ED6;&#x4EEC;&#x7684;&#x751F;&#x547D;&#x72B6;&#x6001;&#x90FD;&#x662F;&#x7531;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x6216;&#x8005;framework&#x6765;&#x63A7;&#x5236;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5728;App&#x4E2D;&#x662F;&#x5F88;&#x96BE;&#x6765;&#x901A;&#x8FC7;&#x4EE3;&#x7801;&#x6765;&#x7BA1;&#x7406;&#x4ED6;&#x4EEC;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x9075;&#x5FAA;&#x4ED6;&#x4EEC;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x5C06;&#x4F1A;&#x5F88;&#x5BB9;&#x6613;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x6CC4;&#x9732;&#x95EE;&#x9898;&#x3002;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x5B9E;&#x73B0;&#x751F;&#x547D;&#x611F;&#x77E5;&#x80FD;&#x529B;&#x7684;&#x8BDD;&#xFF0C;&#x5C06;&#x4F1A;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x66F4;&#x597D;&#x7684;&#x7BA1;&#x7406;&#x4E0E;&#x751F;&#x547D;&#x5468;&#x671F;&#x6709;&#x5173;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x800C;Lifecycle&#x5C31;&#x662F;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x7EC4;&#x4EF6;&#x3002;</p>\n<h2 id=\"Lifecycle\"><a href=\"#Lifecycle\" class=\"headerlink\" title=\"Lifecycle\"></a>Lifecycle</h2><p>Lifecycle&#x53EF;&#x4EE5;&#x4E3A;&#x754C;&#x9762;/&#x975E;&#x754C;&#x9762;&#x7EC4;&#x4EF6;&#x6DFB;&#x52A0;&#x751F;&#x547D;&#x5468;&#x671F;&#x72B6;&#x6001;&#x611F;&#x77E5;&#xFF0C;&#x5141;&#x8BB8;&#x89C2;&#x5BDF;&#x8005;&#x53BB;&#x76D1;&#x542C;&#x8FD9;&#x4E9B;&#x751F;&#x547D;&#x72B6;&#x6001;&#x3002;Lifecycle&#x4E3B;&#x8981;&#x901A;&#x8FC7;&#x4E24;&#x4E2A;&#x679A;&#x4E3E;&#x6765;&#x8FFD;&#x8E2A;&#x751F;&#x547D;&#x72B6;&#x6001;&#x3002;</p>\n<ol>\n<li>Event&#xFF1A;&#x4EE3;&#x8868;&#x751F;&#x547D;&#x4E8B;&#x4EF6;&#xFF0C;&#x662F;&#x7531;framework&#x5C42;&#x5206;&#x53D1;&#x8FC7;&#x6765;&#x7684;&#xFF0C;&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x4E0E;Activity/Fragment&#x4E2D;&#x7684;&#x751F;&#x547D;&#x56DE;&#x8C03;&#x76F8;&#x5339;&#x914D;&#x3002;</li>\n<li>State&#xFF1A;&#x4EE3;&#x8868;&#x5F53;&#x524D;&#x8FFD;&#x8E2A;&#x7684;&#x7EC4;&#x4EF6;&#x6240;&#x5904;&#x7684;&#x751F;&#x547D;&#x72B6;&#x6001;&#x3002;</li>\n</ol>\n<p>Event&#x4E0E;State&#x7684;&#x8054;&#x7CFB;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x7684;&#x56FE;&#x6765;&#x8FDB;&#x4E00;&#x6B65;&#x4E86;&#x89E3;&#x3002;</p>\n<p><img src=\"/2018/06/14/Android-Architecture-Components-Part3-Lifecycle/lifecycle.png\" alt></p>\n<h2 id=\"&#x4F9D;&#x8D56;\"><a href=\"#&#x4F9D;&#x8D56;\" class=\"headerlink\" title=\"&#x4F9D;&#x8D56;\"></a>&#x4F9D;&#x8D56;</h2><p>&#x5728;&#x4F7F;&#x7528;Lifecycle&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;App&#x6216;&#x8005;Module&#x7684;build.gradle&#x4E2D;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    def lifecycle_version = &quot;1.1.1&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">    // ViewModel and LiveData</span><br><span class=\"line\">    implementation &quot;android.arch.lifecycle:extensions:$lifecycle_version&quot;   </span><br><span class=\"line\">    annotationProcessor &quot;android.arch.lifecycle:compiler:$lifecycle_version&quot;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"LifecycleObserver\"><a href=\"#LifecycleObserver\" class=\"headerlink\" title=\"LifecycleObserver\"></a>LifecycleObserver</h2><p>LifecycleObserver&#x662F;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x65B9;&#x6CD5;&#xFF0C;&#x4F5C;&#x4E3A;&#x6807;&#x5FD7;&#x4F5C;&#x7528;&#xFF0C;&#x540C;&#x65F6;&#x901A;&#x8FC7;&#x6CE8;&#x91CA;&#x6765;&#x751F;&#x6210;&#x65B9;&#x6CD5;&#x3002;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x5B83;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#xFF0C;&#x9996;&#x5148;&#x6765;&#x81EA;&#x5B9A;&#x4E49;MyLifeCycleObserver</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class MyLifeCycleObserver(private val lifecycle: Lifecycle) : LifecycleObserver {</span><br><span class=\"line\">    @OnLifecycleEvent(Lifecycle.Event.ON_CREATE)</span><br><span class=\"line\">    fun create() {</span><br><span class=\"line\">        if (lifecycle.currentState.isAtLeast(Lifecycle.State.CREATED)) {</span><br><span class=\"line\">           //todo ...</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    @OnLifecycleEvent(Lifecycle.Event.ON_START)</span><br><span class=\"line\">    fun start() {</span><br><span class=\"line\">        //todo ...</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x5728;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x65B9;&#x6CD5;&#x4E0A;&#x4F7F;&#x7528;<strong>@OnLifecycleEvent</strong>&#x6CE8;&#x91CA;&#x6765;&#x6807;&#x660E;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x4E0E;&#x751F;&#x547D;&#x5468;&#x671F;&#x72B6;&#x6001;&#x76F8;&#x5173;&#x7684;&#x65B9;&#x6CD5;&#x56DE;&#x8C03;&#xFF1B;&#x540C;&#x65F6;&#x901A;&#x8FC7;<strong>Lifecycle.Event</strong>&#xFF0C;&#x5373;Event&#x679A;&#x4E3E;&#xFF0C;&#x6765;&#x7CBE;&#x786E;&#x5B9A;&#x4F4D;&#x5230;&#x67D0;&#x4E00;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x5206;&#x522B;&#x5B9A;&#x4F4D;&#x5230;&#x4E86;ON_CREATE&#x4E0E;ON_START&#xFF0C;&#x5373;Activity/Fragment&#x7684;<strong>onCreate()</strong>&#x4E0E;<strong>onStart()</strong>&#x65B9;&#x6CD5;&#x3002;&#x540C;&#x65F6;Lifecycle&#x63D0;&#x4F9B;<strong>getCurrentState()</strong>&#x65B9;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x65F6;&#x523B;&#x67E5;&#x8BE2;&#x5F53;&#x524D;&#x7684;&#x751F;&#x547D;&#x72B6;&#x6001;&#xFF1B;&#x800C;<strong>isAtLeast()</strong>&#x65B9;&#x6CD5;&#x5219;&#x53EF;&#x4EE5;&#x6BD4;&#x8F83;&#x5F53;&#x524D;&#x7684;&#x751F;&#x547D;&#x72B6;&#x6001;&#x662F;&#x5426;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;&#x67D0;&#x4E00;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#x3002;&#x901A;&#x8FC7;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x80FD;&#x591F;&#x66F4;&#x597D;&#x7684;&#x8F85;&#x52A9;&#x6211;&#x4EEC;&#x6765;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x7684;&#x751F;&#x547D;&#x72B6;&#x6001;&#x3002;</p>\n<h2 id=\"LifecycleOwner\"><a href=\"#LifecycleOwner\" class=\"headerlink\" title=\"LifecycleOwner\"></a>LifecycleOwner</h2><p>&#x73B0;&#x5728;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x89C2;&#x5BDF;&#x8005;MyLifeCycleObserver&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5BF9;&#x89C2;&#x5BDF;&#x8005;&#x8FDB;&#x884C;&#x6CE8;&#x518C;&#x76D1;&#x542C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ContactsActivity : AppCompatActivity() {</span><br><span class=\"line\"> </span><br><span class=\"line\">   override fun onCreate(savedInstanceState: Bundle?) {</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_contacts_layout)</span><br><span class=\"line\">        lifecycle.addObserver(MyLifeCycleObserver(lifecycle))</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x83B7;&#x53D6;Lifecycle&#x5BF9;&#x8C61;&#x6765;&#x6DFB;&#x52A0;&#x89C2;&#x5BDF;&#x8005;&#xFF0C;&#x5C06;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x81EA;&#x5B9A;&#x4E49;&#x7684;MyLifeCycleObserver&#x52A0;&#x5165;&#x89C2;&#x5BDF;&#x961F;&#x5217;&#x3002;&#x800C;<strong>getLifecycle()</strong>&#x662F;LifecycleOwner&#x63A5;&#x53E3;&#x4E2D;&#x552F;&#x4E00;&#x7684;&#x65B9;&#x6CD5;&#x3002;AppCompatActivity/Fragment&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x4E86;LifecycleOwner&#x63A5;&#x53E3;&#x3002;&#x5185;&#x90E8;&#x901A;&#x8FC7;LifecycleRegistry&#x6765;&#x6CE8;&#x518C;&#x4E86;&#x751F;&#x547D;&#x5468;&#x671F;&#x72B6;&#x6001;&#x3002;</p>\n<p>&#x8FD9;&#x6837;&#x4E00;&#x65E6;&#x754C;&#x9762;&#x7684;&#x751F;&#x547D;&#x72B6;&#x6001;&#x53D1;&#x751F;&#x4E86;&#x6539;&#x53D8;&#xFF0C;&#x5C31;&#x4F1A;&#x901A;&#x77E5;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x89C2;&#x5BDF;&#x8005;MyLifeCycleObserver&#xFF0C;&#x5373;&#x56DE;&#x8C03;MyLifeCycleObserver&#x4E2D;&#x6240;&#x5339;&#x914D;&#x7684;&#x6CE8;&#x91CA;&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x4E0D;&#x77E5;&#x4E0D;&#x89C9;&#x4E2D;&#x901A;&#x8FC7;Lifecycle&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5C06;&#x4E0E;&#x751F;&#x547D;&#x72B6;&#x6001;&#x76F8;&#x5173;&#x7684;&#x4EE3;&#x7801;&#x62BD;&#x79BB;&#x5230;&#x4E86;MyLifeCycleObserver&#x4E2D;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x5BF9;Activity/Fragemnt&#x751F;&#x547D;&#x72B6;&#x6001;&#x76F8;&#x5173;&#x7684;&#x89E3;&#x8026;&#x3002;</p>\n<h2 id=\"&#x81EA;&#x5B9A;&#x4E49;LifecycleOwner\"><a href=\"#&#x81EA;&#x5B9A;&#x4E49;LifecycleOwner\" class=\"headerlink\" title=\"&#x81EA;&#x5B9A;&#x4E49;LifecycleOwner\"></a>&#x81EA;&#x5B9A;&#x4E49;LifecycleOwner</h2><p>Activity/Fragment&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x4E86;LifecycleOwner&#x63A5;&#x53E3;&#xFF0C;&#x4F46;&#x5FC5;&#x987B;&#x662F;&#x5728;<strong>Support Library 26.1.0</strong>&#x4E4B;&#x540E;&#x624D;&#x652F;&#x6301;&#x3002;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x5728;&#x5B83;&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#x4F7F;&#x7528;&#xFF0C;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;LifecycleOwner&#x63A5;&#x53E3;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class LifecycleActivity : Activity(), LifecycleOwner {</span><br><span class=\"line\">    private lateinit var mMyLifecycle: LifecycleRegistry</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) {</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_contacts_layout)</span><br><span class=\"line\">        mMyLifecycle = LifecycleRegistry(this)</span><br><span class=\"line\">        mMyLifecycle.markState(Lifecycle.State.CREATED)</span><br><span class=\"line\">        lifecycle.addObserver(MyLifeCycleObserver(lifecycle))</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun onStart() {</span><br><span class=\"line\">        super.onStart()</span><br><span class=\"line\">        mMyLifecycle.markState(Lifecycle.State.STARTED)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun getLifecycle(): Lifecycle = mMyLifecycle</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x9996;&#x5148;&#x8BA9;&#x6211;&#x4EEC;&#x7684;class&#x5B9E;&#x73B0;LifecycleOwner&#x63A5;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x501F;&#x52A9;LifecycleRegistry&#x6765;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;Lifecycle&#x63A5;&#x53E3;&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x5982;&#x679C;&#x8981;&#x8BA9;&#x6211;&#x4EEC;&#x6DFB;&#x52A0;&#x7684;Observer&#x80FD;&#x591F;&#x4E0E;&#x4E4B;&#x524D;&#x4E00;&#x6837;&#x5339;&#x914D;&#x751F;&#x547D;&#x5468;&#x671F;&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x4E3A;&#x751F;&#x6210;&#x7684;Lifecycle&#x5728;&#x751F;&#x547D;&#x5468;&#x671F;&#x65B9;&#x6CD5;&#x4E2D;&#x6DFB;&#x52A0;&#x6807;&#x8BB0;&#x72B6;&#x6001;&#x3002;</p>\n<p>&#x5982;&#x4E0A;&#x4EE3;&#x7801;&#xFF0C;&#x5728;<strong>onCreate()</strong>&#x65B9;&#x6CD5;&#x4E2D;&#x4F7F;&#x7528;<strong>makeState()</strong>&#x6765;&#x7ED1;&#x5B9A;Lifecycle.State.CREATED&#x72B6;&#x6001;&#x3002;&#x5982;&#x6B64;&#xFF0C;&#x5728;Activity&#x7684;onCreate&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x7684;MyLifeCycleObserver&#x4E2D;&#x7684;&#x6CE8;&#x91CA;onCreate&#x65B9;&#x6CD5;&#x4E5F;&#x4F1A;&#x76F8;&#x5E94;&#x7684;&#x56DE;&#x8C03;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x7ED3;&#x5408;LifecycleObserver&#x3001;LifecycleOwner&#x4E0E;LifecycleRegistry&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4E3A;&#x4EFB;&#x610F;&#x975E;&#x751F;&#x547D;&#x611F;&#x77E5;&#x7684;&#x7EC4;&#x4EF6;&#x5B9E;&#x73B0;&#x751F;&#x547D;&#x611F;&#x77E5;&#x80FD;&#x529B;&#xFF0C;&#x8FD9;&#x6837;&#x4E00;&#x6765;&#x5C31;&#x80FD;&#x66F4;&#x597D;&#x7684;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5BF9;&#x7EC4;&#x4EF6;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#x3002;&#x51CF;&#x5C11;&#x903B;&#x8F91;&#x5904;&#x7406;&#x4E0E;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x5F02;&#x5E38;&#x53D1;&#x751F;&#x3002;</p>\n<h2 id=\"Lifecycle-amp-LiveData\"><a href=\"#Lifecycle-amp-LiveData\" class=\"headerlink\" title=\"Lifecycle &amp; LiveData\"></a>Lifecycle &amp; LiveData</h2><p>&#x90A3;&#x4E48;&#x518D;&#x56DE;&#x5230;&#x6587;&#x7AE0;&#x6700;&#x521D;&#x6240;&#x8BF4;&#x7684;LiveData&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x5206;&#x6790;LiveData&#x662F;&#x5982;&#x4F55;&#x501F;&#x52A9;Lifecycle&#x6765;&#x5B9E;&#x73B0;&#x751F;&#x547D;&#x611F;&#x77E5;&#x80FD;&#x529B;&#x3002;</p>\n<blockquote>\n<p>&#x5728;&#x8FD9;&#x4E4B;&#x524D;&#xFF0C;&#x5047;&#x8BBE;&#x4F60;&#x5DF2;&#x7ECF;&#x5BF9;LiveData&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x4E86;&#x89E3;&#xFF0C;&#x6216;&#x8005;&#x4F60;&#x53EF;&#x4EE5;&#x67E5;&#x770B;<a href=\"https://idisfkj.github.io/2018/06/10/Android-Architecture-Components-Part2-LiveData/\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part2:LiveData</a>&#x8FDB;&#x4E00;&#x6B65;&#x4E86;&#x89E3;LiveData</p>\n</blockquote>\n<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;LiveData&#x7684;observer&#x65B9;&#x6CD5;&#x6E90;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@MainThread</span><br><span class=\"line\">public void observe(@NonNull LifecycleOwner owner, @NonNull Observer&lt;T&gt; observer) {</span><br><span class=\"line\">    if (owner.getLifecycle().getCurrentState() == DESTROYED) {</span><br><span class=\"line\">        // ignore</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    LifecycleBoundObserver wrapper = new LifecycleBoundObserver(owner, observer);</span><br><span class=\"line\">    ObserverWrapper existing = mObservers.putIfAbsent(observer, wrapper);</span><br><span class=\"line\">    if (existing != null &amp;&amp; !existing.isAttachedTo(owner)) {</span><br><span class=\"line\">        throw new IllegalArgumentException(&quot;Cannot add the same observer&quot;</span><br><span class=\"line\">                + &quot; with different lifecycles&quot;);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    if (existing != null) {</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    owner.getLifecycle().addObserver(wrapper);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x4E2D;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x4E86;&#x8BB8;&#x591A;&#x719F;&#x6089;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x663E;&#x800C;&#x6613;&#x89C1;&#x5B83;&#x4E5F;&#x662F;&#x901A;&#x8FC7;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;LifecycleBoundObserver&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5176;&#x6DFB;&#x52A0;&#x5230;Lifecycle&#x7684;&#x76D1;&#x542C;&#x961F;&#x5217;&#x4E2D;&#x3002;&#x4E00;&#x65E6;&#x751F;&#x547D;&#x5468;&#x671F;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x5C31;&#x4F1A;&#x56DE;&#x8C03;LifecycleBoundObserver&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x800C;LifecycleBoundObserver&#x5B9E;&#x73B0;&#x4E86;GenericLifecycleObserver&#x63A5;&#x53E3;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface GenericLifecycleObserver extends LifecycleObserver {</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Called when a state transition event happens.</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * @param source The source of the event</span><br><span class=\"line\">     * @param event The event</span><br><span class=\"line\">     */</span><br><span class=\"line\">    void onStateChanged(LifecycleOwner source, Lifecycle.Event event);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;GenericLifecycleObserver&#x6211;&#x4EEC;&#x770B;&#x5230;&#x4E86;&#x719F;&#x6089;&#x7684;LifecycleObserver&#x3002;&#x672C;&#x8D28;&#x4E0E;&#x6587;&#x7AE0;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x81EA;&#x5B9A;&#x4E49;&#x7684;MyLifeCycleObserver&#x76F8;&#x540C;&#x3002;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;<strong>onStateChanged()</strong>&#x65B9;&#x6CD5;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x5C31;&#x662F;Lifecycle&#x89C2;&#x5BDF;&#x5230;&#x751F;&#x547D;&#x5468;&#x671F;&#x6539;&#x53D8;&#x65F6;&#x901A;&#x77E5;Observer&#x7684;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x3002;</p>\n<p>Observer&#x660E;&#x767D;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x518D;&#x6765;&#x770B;&#x4E0B;&#x6700;&#x521D;&#x7684;Lifecycle&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x7684;&#x662F;&#x5B83;&#x6765;&#x81EA;&#x4E8E;Activity/Fragment&#xFF0C;&#x6211;&#x4EEC;&#x5230;Activity&#x4E2D;&#x5BFB;&#x627E;(Fragment&#x4E5F;&#x662F;&#x4E00;&#x6837;)&#x3002;&#x6700;&#x540E;&#x5728;&#x7EE7;&#x627F;&#x7684;SupportActivity&#x4E2D;&#x627E;&#x5230;&#x4E86;&#x6211;&#x4EEC;&#x6240;&#x9700;&#x8981;&#x7684;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class SupportActivity extends Activity implements LifecycleOwner {</span><br><span class=\"line\"></span><br><span class=\"line\">    private LifecycleRegistry mLifecycleRegistry = new LifecycleRegistry(this);</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    ...</span><br><span class=\"line\">     </span><br><span class=\"line\">    @CallSuper</span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    protected void onSaveInstanceState(Bundle outState) {</span><br><span class=\"line\">        mLifecycleRegistry.markState(Lifecycle.State.CREATED);</span><br><span class=\"line\">        super.onSaveInstanceState(outState);</span><br><span class=\"line\">    }</span><br><span class=\"line\">     </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public Lifecycle getLifecycle() {</span><br><span class=\"line\">        return mLifecycleRegistry;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">   ...</span><br><span class=\"line\">   ...</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x518D;&#x4E00;&#x6B21;&#x770B;&#x5230;&#x4E86;LifecycleRegistry&#x4E0E;LifecycleOwner&#xFF0C;&#x5B83;&#x7684;&#x7528;&#x6CD5;&#x4E5F;&#x4E0E;&#x4E0A;&#x9762;&#x63D0;&#x53CA;&#x7684;&#x81EA;&#x5B9A;&#x4E49;LifecycleOwner&#x5982;&#x51FA;&#x4E00;&#x8F99;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x591A;&#x505A;&#x8BF4;&#x660E;&#x3002;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x4E0B;&#x5B83;&#x4E0E;Observer&#x7684;&#x8FDE;&#x63A5;&#x3002;</p>\n<p>&#x5982;&#x4E0A;&#x6240;&#x793A;&#x5F53;Activity&#x7684;onSaveInstanceState&#x56DE;&#x8C03;&#x65F6;&#x4F1A;&#x8C03;&#x7528;<strong>markState()</strong>&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x5728;&#x5176;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x5185;&#x90E8;&#xFF0C;&#x6700;&#x7EC8;&#x4F1A;&#x6765;&#x5230;ObserverWithState&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static class ObserverWithState {</span><br><span class=\"line\">    State mState;</span><br><span class=\"line\">    GenericLifecycleObserver mLifecycleObserver;</span><br><span class=\"line\"> </span><br><span class=\"line\">    ObserverWithState(LifecycleObserver observer, State initialState) {</span><br><span class=\"line\">        mLifecycleObserver = Lifecycling.getCallback(observer);</span><br><span class=\"line\">        mState = initialState;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    void dispatchEvent(LifecycleOwner owner, Event event) {</span><br><span class=\"line\">        State newState = getStateAfter(event);</span><br><span class=\"line\">        mState = min(mState, newState);</span><br><span class=\"line\">        mLifecycleObserver.onStateChanged(owner, event);</span><br><span class=\"line\">        mState = newState;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;<strong>dispatchEvent()</strong>&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x8C03;&#x7528;mLifecycleObserver&#xFF0C;&#x4ED4;&#x7EC6;&#x770B;&#x8FD9;&#x4E2A;Observer&#x5C31;&#x662F;GenericLifecycleObserver&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4F1A;&#x8C03;&#x7528;<strong>onStateChanged()</strong>&#x65B9;&#x6CD5;&#x3002;</p>\n<p>&#x5230;&#x8FD9;&#x91CC;LifecycleObserver&#x4E0E;LifecycleOwner&#x5C31;&#x5B8C;&#x7F8E;&#x7ED3;&#x5408;&#x5728;&#x4E00;&#x8D77;&#x4E86;&#xFF0C;&#x4E3A;LiveData&#x5B9E;&#x73B0;&#x4E86;&#x751F;&#x547D;&#x72B6;&#x6001;&#x7684;&#x611F;&#x77E5;&#x80FD;&#x529B;&#x3002;&#x901A;&#x8FC7;LiveData&#x4E0E;Lifecycle&#x7684;&#x8FD0;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x4E86;Lifecycle&#x7684;&#x7075;&#x6D3B;&#x6027;&#x4E0E;&#x5B83;&#x7684;&#x5F3A;&#x5927;&#x751F;&#x547D;&#x611F;&#x77E5;&#x80FD;&#x529B;&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x4E3A;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7EC4;&#x4EF6;&#x6216;&#x8005;&#x5176;&#x4ED6;&#x7684;&#x6570;&#x636E;&#x5BB9;&#x5668;&#x6765;&#x5B9E;&#x73B0;&#x751F;&#x547D;&#x611F;&#x77E5;&#x80FD;&#x529B;&#x3002;Lifecycle&#x7684;&#x5F3A;&#x5927;&#x6BCB;&#x5EB8;&#x7F6E;&#x7591;&#x3002;</p>\n<p>&#x5176;&#x6B21;&#x8981;&#x8BF4;&#x660E;&#x7684;&#x662F;LiveData&#x4E0E;Lifecycle&#x7684;&#x8FD0;&#x7528;&#x4E0D;&#x4EC5;&#x5982;&#x6B64;&#xFF0C;&#x8FD9;&#x53EA;&#x662F;&#x5B83;&#x7684;&#x6CE8;&#x518C;&#x76D1;&#x542C;&#xFF0C;&#x800C;&#x6211;&#x4EEC;&#x771F;&#x6B63;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x5B83;&#x7684;<strong>postValue()</strong>&#x4E0E;<strong>setValue()</strong>&#x3002;&#x7531;&#x4E8E;&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x662F;&#x5206;&#x6790;Lifecycle&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x591A;&#x505A;&#x5206;&#x6790;&#x3002;</p>\n<blockquote>\n<p>&#x6587;&#x7AE0;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x53EF;&#x4EE5;&#x5728;<a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">Github</a>&#x4E2D;&#x83B7;&#x53D6;&#x5230;&#x3002;&#x4F7F;&#x7528;&#x65F6;&#x8BF7;&#x5C06;&#x5206;&#x652F;&#x5207;&#x6362;&#x5230;feat_architecture_components</p>\n</blockquote>\n<p>&#x6700;&#x540E;&#x505A;&#x4E2A;&#x9884;&#x544A;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x8981;&#x4E86;&#x89E3;&#x7684;&#x662F;AAC&#x4E2D;&#x7684;ViewModel&#xFF0C;&#x76F8;&#x4FE1;&#x4F60;&#x4E5F;&#x4F1A;&#x9A6C;&#x4E0A;&#x559C;&#x6B22;&#x4E0A;&#x5B83;&#x3002;</p>\n<h2 id=\"&#x76F8;&#x5173;&#x6587;&#x7AE0;\"><a href=\"#&#x76F8;&#x5173;&#x6587;&#x7AE0;\" class=\"headerlink\" title=\"&#x76F8;&#x5173;&#x6587;&#x7AE0;\"></a>&#x76F8;&#x5173;&#x6587;&#x7AE0;</h2><p><a href=\"https://idisfkj.github.io/2018/06/07/Android-Architecture-Components-Part1-Room/\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part1:Room</a><br><a href=\"https://idisfkj.github.io/2018/06/10/Android-Architecture-Components-Part2-LiveData/\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part2:LiveData</a><br><a href=\"https://idisfkj.github.io/2018/06/22/Android-Architecture-Components-Part4-ViewModel/\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part4:ViewModel</a></p>\n<h2 id=\"&#x5173;&#x6CE8;\"><a href=\"#&#x5173;&#x6CE8;\" class=\"headerlink\" title=\"&#x5173;&#x6CE8;\"></a>&#x5173;&#x6CE8;</h2><p><img src=\"/2018/06/14/Android-Architecture-Components-Part3-Lifecycle/wx.jpg\" alt></p>\n","categories":["android"],"tags":["Android Architecture Components"]},{"title":"Android Architecture Components Part2:LiveData","url":"https://www.rousetime.com/2018/06/10/Android-Architecture-Components-Part2-LiveData/","content":"<p><img src=\"/2018/06/10/Android-Architecture-Components-Part2-LiveData/cover.png\" alt></p>\n<p>&#x611F;&#x8C22;&#x4F60;&#x7684;&#x518D;&#x6B21;&#x5149;&#x4E34;&#xFF0C;&#x6B22;&#x8FCE;&#x6765;&#x5230;Android Architecture Components&#xFF08;ACC&#xFF09;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#x3002;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x6211;&#x4EEC;&#x4E00;&#x8D77;&#x8BA8;&#x8BBA;&#x4E86;Room&#xFF0C;&#x901A;&#x8FC7;Room&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x65B9;&#x4FBF;&#x7684;&#x64CD;&#x4F5C;App&#x7684;&#x6570;&#x636E;&#x5E93;&#x3002;&#x5982;&#x679C;&#x4F60;&#x7684;App&#x5BF9;&#x672C;&#x5730;&#x6570;&#x636E;&#x5E93;&#x6709;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x8BDD;&#xFF0C;Room&#x4F60;&#x503C;&#x5F97;&#x62E5;&#x6709;&#x3002;</p>\n<p>&#x4ECA;&#x5929;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x7EE7;&#x7EED;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x6B65;&#x4F10;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x4E00;&#x8D77;&#x6765;&#x5168;&#x9762;&#x4E86;&#x89E3;ACC&#x53E6;&#x4E00;&#x5F3A;&#x5927;&#x7684;&#x7EC4;&#x4EF6;LiveData&#x3002;&#x76F8;&#x4FE1;&#x4F60;&#x9A6C;&#x4E0A;&#x4F1A;&#x559C;&#x6B22;&#x4E0A;&#x5979;&#xFF01;&#x1F60D;&#x1F60D;&#x1F60D;</p>\n<h2 id=\"&#x7B80;&#x8FF0;\"><a href=\"#&#x7B80;&#x8FF0;\" class=\"headerlink\" title=\"&#x7B80;&#x8FF0;\"></a>&#x7B80;&#x8FF0;</h2><p>LiveData&#x662F;&#x4E00;&#x79CD;&#x53EF;&#x89C2;&#x6D4B;&#x6570;&#x636E;&#x5BB9;&#x5668;&#xFF0C;&#x5B83;&#x4F1A;&#x5728;&#x6570;&#x636E;&#x53D8;&#x5316;&#x65F6;&#x901A;&#x77E5;&#x89C2;&#x6D4B;&#x5668;&#xFF0C;&#x4EE5;&#x4FBF;&#x66F4;&#x65B0;&#x9875;&#x9762;&#xFF1B;&#x540C;&#x65F6;&#x5B83;&#x5177;&#x5907;&#x751F;&#x547D;&#x611F;&#x77E5;&#x80FD;&#x529B;&#xFF0C;&#x53EF;&#x4EE5;&#x5B9E;&#x65F6;&#x89C2;&#x5BDF;Activity/Fragment&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x72B6;&#x6001;&#x3002;</p>\n<p>&#x65E2;&#x7136;&#x5B83;&#x662F;&#x53EF;&#x89C2;&#x5BDF;&#x6570;&#x636E;&#x5BB9;&#x5668;&#x4E0E;&#x5177;&#x5907;&#x751F;&#x547D;&#x611F;&#x77E5;&#x80FD;&#x529B;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x7684;&#x4F18;&#x70B9;&#x4E5F;&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x53EF;&#x4EE5;&#x5F52;&#x7EB3;&#x4E0E;&#x4EE5;&#x4E0B;&#x51E0;&#x70B9;</p>\n<ol>\n<li>&#x786E;&#x4FDD;ui&#x8DDF;&#x968F;&#x6570;&#x636E;&#x66F4;&#x65B0;</li>\n<li>&#x5177;&#x5907;&#x751F;&#x547D;&#x611F;&#x77E5;&#x80FD;&#x529B;&#x4ECE;&#x800C;&#x51CF;&#x5C11;&#x5185;&#x5B58;&#x6CC4;&#x9732;</li>\n<li>&#x9632;&#x6B62;&#x5F02;&#x5E38;crashs</li>\n<li>&#x65E0;&#x9700;&#x7BA1;&#x7406;&#x7ED1;&#x5B9A;&#x8005;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;</li>\n<li>ui&#x83B7;&#x53D6;&#x7684;&#x6570;&#x636E;&#x90FD;&#x662F;&#x6700;&#x8FD1;&#x6700;&#x7EC8;&#x7684;&#x66F4;&#x65B0;&#x6570;&#x636E;</li>\n</ol>\n<h2 id=\"&#x4F7F;&#x7528;&#x573A;&#x666F;\"><a href=\"#&#x4F7F;&#x7528;&#x573A;&#x666F;\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;&#x573A;&#x666F;\"></a>&#x4F7F;&#x7528;&#x573A;&#x666F;</h2><p>&#x5F53;&#x6211;&#x4EEC;&#x8981;&#x76D1;&#x542C;&#x67D0;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x7684;&#x53D8;&#x5316;&#x65F6;&#xFF0C;LiveData&#x5C06;&#x5927;&#x663E;&#x8EAB;&#x624B;&#x3002;&#x4F8B;&#x5982;&#x754C;&#x9762;&#x6570;&#x636E;&#x7684;&#x66F4;&#x65B0;&#xFF0C;&#x5F53;&#x6570;&#x636E;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x901A;&#x77E5;&#x754C;&#x9762;&#x8FDB;&#x884C;&#x66F4;&#x65B0;ui&#xFF0C;&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;LiveData&#x5728;&#x5F53;&#x524D;Activity/Fragment&#x4E2D;&#x5BF9;&#x8BE5;&#x6570;&#x636E;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x89C2;&#x5BDF;&#x8005;&#xFF0C;&#x5B9E;&#x65F6;&#x76D1;&#x542C;&#x6570;&#x636E;&#x7684;&#x4EFB;&#x4F55;&#x6539;&#x52A8;&#x3002;&#x6BCF;&#x4E00;&#x6B21;&#x6539;&#x52A8;LiveData&#x90FD;&#x4F1A;&#x53D1;&#x9001;&#x901A;&#x77E5;&#x7ED9;&#x89C2;&#x5BDF;&#x8005;&#x3002;</p>\n<p>&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;LiveData&#x611F;&#x77E5;&#x754C;&#x9762;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x6709;&#x5728;&#x754C;&#x9762;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;<strong>STARTED</strong>&#x6216;&#x8005;<strong>RESUMED</strong>&#x72B6;&#x6001;&#x624D;&#x4F1A;&#x901A;&#x77E5;&#x89C2;&#x5BDF;&#x8005;&#x3002;&#x5982;&#x679C;&#x4F60;&#x4E00;&#x76F4;&#x5904;&#x4E8E;&#x540E;&#x53F0;&#x4E14;&#x6570;&#x636E;&#x4E00;&#x76F4;&#x5728;&#x53D8;&#x5316;&#xFF0C;LiveData&#x662F;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x901A;&#x77E5;&#xFF0C;&#x53EA;&#x6709;&#x5728;&#x754C;&#x9762;&#x518D;&#x4E00;&#x6B21;&#x56DE;&#x5230;&#x524D;&#x53F0;&#xFF0C;&#x8FD9;&#x65F6;LiveData&#x624D;&#x4F1A;&#x53D1;&#x751F;&#x901A;&#x77E5;&#x4E14;&#x53EA;&#x4F1A;&#x53D1;&#x9001;&#x4E00;&#x6B21;&#xFF0C;&#x6570;&#x636E;&#x7684;&#x66F4;&#x65B0;&#x53D6;&#x7684;&#x662F;&#x6700;&#x540E;&#x4E00;&#x6B21;&#x7684;&#x53D8;&#x5316;&#x6570;&#x636E;&#x3002;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x7684;&#x907F;&#x514D;&#x5185;&#x5B58;&#x6CC4;&#x9732;&#x4E0E;ui&#x4E0D;&#x5B58;&#x5728;&#x65F6;&#x5BFC;&#x81F4;&#x7684;<strong>NullPointerException</strong></p>\n<h2 id=\"&#x4F7F;&#x7528;\"><a href=\"#&#x4F7F;&#x7528;\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;\"></a>&#x4F7F;&#x7528;</h2><p>&#x9996;&#x9875;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;&#x6211;&#x4EEC;&#x7684;app&#x4E0B;&#x7684;build.gradle&#x4E2D;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x4F9D;&#x8D56;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    def lifecycle_version = &quot;1.1.1&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">    // ViewModel and LiveData</span><br><span class=\"line\">    implementation &quot;android.arch.lifecycle:extensions:$lifecycle_version&quot;</span><br><span class=\"line\">    // alternatively - just LiveData</span><br><span class=\"line\">    implementation &quot;android.arch.lifecycle:livedata:$lifecycle_version&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">    annotationProcessor &quot;android.arch.lifecycle:compiler:$lifecycle_version&quot;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5C31;&#x80FD;&#x6B63;&#x5F0F;&#x4F7F;&#x7528;LiveData&#xFF0C;&#x770B;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ContactsViewModel(application: Application, private val defTitle: String = &quot;Contacts&quot;) : AndroidViewModel(application) {</span><br><span class=\"line\">    val message: MutableLiveData&lt;String&gt; by lazy { MutableLiveData&lt;String&gt;() }</span><br><span class=\"line\">    val contactsList: MutableLiveData&lt;List&lt;ContactsModel&gt;&gt; = MutableLiveData()</span><br><span class=\"line\">     </span><br><span class=\"line\">   fun getContacts(refresh: Boolean): LiveData&lt;List&lt;ContactsModel&gt;&gt; {</span><br><span class=\"line\">        message.value = &quot;&quot;</span><br><span class=\"line\">        if (refresh) {</span><br><span class=\"line\">            getDataFromRemote()</span><br><span class=\"line\">        } else if (contactsList.value == null || contactsList.value?.size ?: 0 &lt;= 0) {</span><br><span class=\"line\">            message.value = &quot;&#x6570;&#x636E;&#x8BF7;&#x6C42;&#x4E2D;&#xFF0C;&#x8BF7;&#x7A0D;&#x540E;&#xFF01;&quot;</span><br><span class=\"line\">            if (mLocalData.isEmpty()) {</span><br><span class=\"line\">                getDataFromLocal()</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        return contactsList</span><br><span class=\"line\">    }</span><br><span class=\"line\">     </span><br><span class=\"line\">    private fun getDataFromLocal() {</span><br><span class=\"line\">        val runnable = Runnable {</span><br><span class=\"line\">            val dao = mContactsDao.getAllContacts()</span><br><span class=\"line\">            if (dao.isNotEmpty()) {</span><br><span class=\"line\">                contactsList.postValue(dao)</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                getDataFromRemote()</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        mExecutors.disIoExecutor.execute(runnable)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    private fun getDataFromRemote() {</span><br><span class=\"line\">        Handler().postDelayed({</span><br><span class=\"line\">            contactsList.value = mRemoteData</span><br><span class=\"line\">            mLocalData = mRemoteData</span><br><span class=\"line\">            saveContacts(mRemoteData)</span><br><span class=\"line\">            Thread(Runnable {</span><br><span class=\"line\">                title.postValue(&quot;Remote Contacts&quot;)</span><br><span class=\"line\">            }).start()</span><br><span class=\"line\">            message.value = &quot;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x5B8C;&#x6210;~&quot;</span><br><span class=\"line\">        }, MDELAY_MILLIS)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x4F7F;&#x7528;MutableLiveDat&#x5BF9;&#x6211;&#x4EEC;&#x6240;&#x9700;&#x8981;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x4E86;&#x5305;&#x88F9;&#xFF0C;MutableLiveData&#x5B83;&#x7EE7;&#x627F;&#x4E0E;LiveData&#xFF0C;&#x66B4;&#x9732;&#x4E86;<strong>postValue()</strong>&#x4E0E;<strong>setValue()</strong>&#x65B9;&#x6CD5;&#x3002;&#x4E00;&#x65E6;MutableLiveData&#x6240;&#x5305;&#x88F9;&#x7684;&#x6570;&#x636E;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>postValue()</strong>(asynchronously)&#x4E0E;<strong>setValue()</strong>(synchronously)&#x6765;&#x8BBE;&#x7F6E;&#x503C;&#x4E0E;&#x53D1;&#x9001;&#x901A;&#x77E5;&#xFF0C;&#x544A;&#x8BC9;&#x89C2;&#x5BDF;&#x8005;&#x6570;&#x636E;&#x5DF2;&#x7ECF;&#x6539;&#x53D8;&#x3002;</p>\n<blockquote>\n<p>&#x5728;<strong>getDataFromLocal()</strong>&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86;Room&#x6765;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x540C;&#x65F6;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x8FD4;&#x56DE;LiveData&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F7F;&#x5F97;Room&#x4E0E;LiveData&#x5B8C;&#x7F8E;&#x7ED3;&#x5408;&#x3002;</p>\n</blockquote>\n<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;&#x89C2;&#x5BDF;&#x8005;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ContactsActivity : AppCompatActivity() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    private lateinit var mViewModel: ContactsViewModel</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) {</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_contacts_layout)</span><br><span class=\"line\">        setupViewModel()</span><br><span class=\"line\">    }</span><br><span class=\"line\">    </span><br><span class=\"line\">    private fun setupViewModel() {</span><br><span class=\"line\">        mViewModel = ViewModelProviders.of(this, ContactsFactory.getInstance(application))[ContactsViewModel::class.java]</span><br><span class=\"line\">        //active STARTED&#x3001;RESUMED</span><br><span class=\"line\">        mViewModel.getContacts(true).observe(this,</span><br><span class=\"line\">                Observer {</span><br><span class=\"line\">                    //todo ...</span><br><span class=\"line\">                })</span><br><span class=\"line\">        mViewModel.message.observe(this,</span><br><span class=\"line\">                Observer {</span><br><span class=\"line\">                    //todo ...</span><br><span class=\"line\">                })</span><br><span class=\"line\">    }   </span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x4E3A;&#x6240;&#x9700;&#x8981;&#x89C2;&#x5BDF;&#x7684;&#x6570;&#x636E;&#x6DFB;&#x52A0;&#x4E86;observer&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F;LifecyleOwner&#xFF0C;&#x4EE5;&#x4FBF;&#x8BA9;LiveData&#x5177;&#x6709;&#x751F;&#x547D;&#x611F;&#x77E5;&#x80FD;&#x529B;&#xFF0C;&#x8FD9;&#x91CC;&#x8981;&#x611F;&#x77E5;&#x7684;&#x662F;ContactsActivity&#xFF0C;&#x6240;&#x4EE5;&#x4F20;&#x5165;this&#x5373;&#x53EF;&#x3002;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x4E00;&#x4E2A;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#xFF0C;&#x4E00;&#x65E6;&#x6570;&#x636E;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x5B83;&#x7684;<strong>onChanged()</strong>&#x5C31;&#x4F1A;&#x56DE;&#x8C03;&#xFF0C;&#x5E76;&#x5C06;&#x6570;&#x636E;&#x5E26;&#x56DE;&#xFF0C;&#x8FD9;&#x6837;&#x754C;&#x9762;&#x5C31;&#x80FD;&#x5B9E;&#x65F6;&#x66F4;&#x65B0;&#x6570;&#x636E;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x7531;&#x4E8E;LiveData&#x662F;&#x751F;&#x547D;&#x611F;&#x77E5;&#x7684;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4E5F;&#x65E0;&#x9700;&#x62C5;&#x5FC3;&#x4ED6;&#x7684;register/unregister</p>\n<h2 id=\"Extend\"><a href=\"#Extend\" class=\"headerlink\" title=\"Extend\"></a>Extend</h2><p>&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;LiveData&#x4F1A;&#x5BF9;&#x5904;&#x4E8E;STATERD&#x6216;&#x8005;RESUMED&#x72B6;&#x6001;&#x8FDB;&#x884C;&#x53D1;&#x9001;&#x901A;&#x77E5;&#xFF0C;<strong>&#x5982;&#x679C;&#x8BE5;&#x72B6;&#x6001;&#x4E0B;&#x5B58;&#x5728;observer&#xFF0C;&#x7531;&#x65E0;&#x5230;&#x6709;&#xFF0C;&#x6211;&#x4EEC;&#x79F0;&#x4E4B;&#x4E3A;active&#xFF0C;&#x53CD;&#x6B63;&#x79F0;&#x4E4B;&#x4E3A;inactive</strong>&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x77E5;&#x9053;&#x4F55;&#x65F6;&#x4E3A;active&#x4E0E;&#x4F55;&#x65F6;&#x4E3A;inactive&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;LiveData&#x3002;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;LiveData&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x5206;&#x522B;&#x4E3A;<strong>onActive()</strong>&#x4E0E;<strong>onInactive()</strong>&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x60F3;&#x4E3A;&#x4E00;&#x4E2A;&#x76D1;&#x542C;&#x5668;&#x5B9E;&#x73B0;&#x751F;&#x547D;&#x611F;&#x77E5;&#x80FD;&#x529B;&#xFF0C;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x5982;&#x4E0B;&#x64CD;&#x4F5C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class StockLiveData extends LiveData&lt;BigDecimal&gt; {</span><br><span class=\"line\">    private static StockLiveData sInstance;</span><br><span class=\"line\">    private StockManager mStockManager;</span><br><span class=\"line\"> </span><br><span class=\"line\">    private SimplePriceListener mListener = new SimplePriceListener() {</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void onPriceChanged(BigDecimal price) {</span><br><span class=\"line\">            setValue(price);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    };</span><br><span class=\"line\"> </span><br><span class=\"line\">    @MainThread</span><br><span class=\"line\">    public static StockLiveData get(String symbol) {</span><br><span class=\"line\">        if (sInstance == null) {</span><br><span class=\"line\">            sInstance = new StockLiveData(symbol);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        return sInstance;</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    private StockLiveData(String symbol) {</span><br><span class=\"line\">        mStockManager = new StockManager(symbol);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    protected void onActive() {</span><br><span class=\"line\">        mStockManager.requestPriceUpdates(mListener);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    protected void onInactive() {</span><br><span class=\"line\">        mStockManager.removeUpdates(mListener);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E00;&#x65E6;observer&#x7531;&#x65E0;&#x5230;&#x6709;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x5728;<strong>onActive()</strong>&#x65B9;&#x6CD5;&#x4E2D;&#x8FDB;&#x884C;&#x76D1;&#x542C;&#x5668;&#x7684;&#x6CE8;&#x518C;&#x3002;observer&#x7531;&#x6709;&#x5230;&#x65E0;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;<strong>onInactive()</strong>&#x4E2D;&#x8FDB;&#x884C;&#x6CE8;&#x9500;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x76D1;&#x542C;&#x5668;&#x5177;&#x5907;&#x751F;&#x547D;&#x611F;&#x77E5;&#x80FD;&#x529B;&#x3002;&#x907F;&#x514D;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x9732;&#x6216;&#x8005;&#x4E00;&#x6B21;crash&#x3002;&#x540C;&#x65F6;&#x4E00;&#x65E6;&#x76D1;&#x542C;&#x5668;&#x7684;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x751F;&#x6548;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53C8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;LiveData&#x7684;<strong>setValue()</strong>&#x6765;&#x5BF9;&#x89C2;&#x5BDF;&#x8005;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x7684;&#x66F4;&#x65B0;&#x3002;&#x6240;&#x4EE5;&#x89C2;&#x5BDF;&#x8005;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class MyFragment extends Fragment {</span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void onActivityCreated(Bundle savedInstanceState) {</span><br><span class=\"line\">        StockLiveData.get(getActivity()).observe(this, price -&gt; {</span><br><span class=\"line\">            // Update the UI.</span><br><span class=\"line\">        });</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x7EC6;&#x5FC3;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x4E0A;&#x9762;&#x7684;StockLiveData&#x5DF2;&#x7ECF;&#x5B9E;&#x73B0;&#x4E86;&#x76D1;&#x542C;&#x5668;&#x5171;&#x4EAB;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x591A;&#x4E2A;&#x754C;&#x9762;&#x4E2D;&#x4F7F;&#x7528;StockLiveData&#x8FDB;&#x884C;&#x6DFB;&#x52A0;observer&#x3002;&#x4F8B;&#x5982;&#x5728;Activity&#x4E2D;&#xFF0C;&#x53EA;&#x8981;&#x6709;&#x4E00;&#x4E2A;observer&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C06;&#x4E00;&#x76F4;&#x76D1;&#x542C;&#x6570;&#x636E;&#x7684;&#x53D8;&#x5316;&#x3002;</p>\n<blockquote>\n<p>&#x6848;&#x4F8B;&#xFF1A;&#x5BF9;&#x4E8E;App&#x7EDF;&#x8BA1;&#x9700;&#x6C42;&#xFF0C;&#x4E00;&#x65E6;&#x6D89;&#x53CA;&#x5230;&#x591A;&#x4E2A;&#x9875;&#x9762;&#x95F4;&#x7684;&#x7EDF;&#x8BA1;&#x53C2;&#x6570;&#x4F20;&#x9012;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x6269;&#x5C55;LiveData&#x6765;&#x5168;&#x5C40;&#x76D1;&#x542C;&#x53C2;&#x6570;&#x7684;&#x4F20;&#x9012;&#x4E0E;&#x53D8;&#x5316;&#x3002;</p>\n</blockquote>\n<h2 id=\"Transform\"><a href=\"#Transform\" class=\"headerlink\" title=\"Transform\"></a>Transform</h2><p>&#x5728;&#x901A;&#x77E5;&#x89C2;&#x5BDF;&#x8005;&#x6570;&#x636E;&#x6539;&#x53D8;&#x4E4B;&#x524D;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x6539;&#x53D8;LiveData&#x4E2D;&#x7684;&#x503C;&#x7C7B;&#x578B;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Transformations</p>\n<h3 id=\"Transformations-map\"><a href=\"#Transformations-map\" class=\"headerlink\" title=\"Transformations.map()\"></a>Transformations.map()</h3><p>&#x83B7;&#x53D6;&#x539F;&#x6709;&#x7C7B;&#x578B;&#x4E2D;&#x7684;&#x67D0;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x7C7B;&#x578B;&#x503C;&#xFF0C;&#x53EF;&#x4EE5;&#x6BD4;&#x55BB;&#x4E3A;&#x89E3;&#x5305;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<strong>map()</strong>&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LiveData&lt;User&gt; userLiveData = ...;</span><br><span class=\"line\">LiveData&lt;String&gt; userName = Transformations.map(userLiveData, user -&gt; {</span><br><span class=\"line\">    user.name + &quot; &quot; + user.lastName</span><br><span class=\"line\">});</span><br></pre></td></tr></table></figure>\n<h3 id=\"Transformations-switchMap\"><a href=\"#Transformations-switchMap\" class=\"headerlink\" title=\"Transformations.switchMap()\"></a>Transformations.switchMap()</h3><p>&#x4E0E;map&#x5BF9;&#x5E94;&#x7684;&#x662F;<strong>switchMap()</strong>&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x6253;&#x5305;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private LiveData&lt;User&gt; getUser(String id) {</span><br><span class=\"line\">  ...;</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">LiveData&lt;String&gt; userId = ...;</span><br><span class=\"line\">LiveData&lt;User&gt; user = Transformations.switchMap(userId, id -&gt; getUser(id) );</span><br></pre></td></tr></table></figure>\n<h2 id=\"MediatorLiveData\"><a href=\"#MediatorLiveData\" class=\"headerlink\" title=\"MediatorLiveData\"></a>MediatorLiveData</h2><p>&#x4E0E;LiveData&#x76F8;&#x5173;&#x7684;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;MediatorLiveData&#xFF0C;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x662F;&#xFF1A;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x76D1;&#x542C;&#x591A;&#x4E2A;LiveData&#x3002;&#x4F8B;&#x5982;&#x540C;&#x65F6;&#x76D1;&#x542C;&#x672C;&#x5730;&#x6570;&#x636E;&#x4E0E;&#x8FDC;&#x7A0B;&#x6570;&#x636E;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LiveData&lt;List&lt;User&gt;&gt; usersFromDatabase;</span><br><span class=\"line\">LiveData&lt;List&lt;User&gt;&gt; usersFromNetwork;</span><br><span class=\"line\"> </span><br><span class=\"line\">MediatorLiveData&lt;List&lt;User&gt;&gt; usersLiveData = </span><br><span class=\"line\">    new MediatorLiveData&lt;&gt;();</span><br><span class=\"line\">     </span><br><span class=\"line\">usersLiveData.addSource(usersFromDatabase, newUserList -&gt;</span><br><span class=\"line\">    usersLiveData.setValue(value));</span><br><span class=\"line\">     </span><br><span class=\"line\">usersLiveData.addSource(usersFromNetwork, newUserList -&gt;</span><br><span class=\"line\">    usersLiveData.setValue(value));</span><br></pre></td></tr></table></figure>\n<p>&#x4E00;&#x65E6;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x53D1;&#x9001;&#x53D8;&#x5316;&#xFF0C;MediatorLiveData&#x90FD;&#x4F1A;&#x53D1;&#x9001;&#x901A;&#x77E5;&#x7ED9;observer&#x3002;</p>\n<p>&#x662F;&#x5426;&#x611F;&#x89C9;LiveData&#x5F88;&#x5F3A;&#x5927;&#x5462;&#xFF1F;&#x90A3;&#x4E48;&#x8D76;&#x7D27;&#x884C;&#x52A8;&#x8D77;&#x6765;&#x5427;&#xFF0C;&#x8BA9;&#x4F60;&#x7684;App&#x4E2D;&#x6570;&#x636E;&#x4E5F;&#x5177;&#x6709;&#x53EF;&#x89C2;&#x5BDF;&#x4E0E;&#x751F;&#x547D;&#x611F;&#x77E5;&#x80FD;&#x529B;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x6587;&#x7AE0;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x53EF;&#x4EE5;&#x5728;<a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">Github</a>&#x4E2D;&#x83B7;&#x53D6;&#x5230;&#x3002;&#x4F7F;&#x7528;&#x65F6;&#x8BF7;&#x5C06;&#x5206;&#x652F;&#x5207;&#x6362;&#x5230;<strong>feat_architecture_components</strong></p>\n<h2 id=\"&#x76F8;&#x5173;&#x6587;&#x7AE0;\"><a href=\"#&#x76F8;&#x5173;&#x6587;&#x7AE0;\" class=\"headerlink\" title=\"&#x76F8;&#x5173;&#x6587;&#x7AE0;\"></a>&#x76F8;&#x5173;&#x6587;&#x7AE0;</h2><p><a href=\"https://idisfkj.github.io/2018/06/07/Android-Architecture-Components-Part1-Room/\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part1:Room</a><br><a href=\"https://idisfkj.github.io/2018/06/14/Android-Architecture-Components-Part3-Lifecycle/\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part3:Lifecycle</a><br><a href=\"https://idisfkj.github.io/2018/06/22/Android-Architecture-Components-Part4-ViewModel/\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part4:ViewModel</a></p>\n<h2 id=\"&#x5173;&#x6CE8;\"><a href=\"#&#x5173;&#x6CE8;\" class=\"headerlink\" title=\"&#x5173;&#x6CE8;\"></a>&#x5173;&#x6CE8;</h2><p><img src=\"/2018/06/10/Android-Architecture-Components-Part2-LiveData/wx.jpg\" alt=\"&#x602A;&#x8C08;&#x65F6;&#x95F4;&#x5230;&#x4E86;\"></p>\n","categories":["android"],"tags":["Android Architecture Components"]},{"title":"Android Architecture Components Part1:Room","url":"https://www.rousetime.com/2018/06/07/Android-Architecture-Components-Part1-Room/","content":"<p><img src=\"/2018/06/07/Android-Architecture-Components-Part1-Room/cover.png\" alt=\"cover\"></p>\n<h2 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h2><p>Android Architecture Components&#xFF08;AAC&#xFF09;&#x9996;&#x6B21;&#x53D1;&#x5E03;&#x4E0E;2017 GoogleI/O&#x5927;&#x4F1A;&#xFF0C;&#x7ECF;&#x8FC7;&#x8FD1;&#x4E00;&#x5E74;&#x7684;&#x7EF4;&#x62A4;&#xFF0C;&#x73B0;&#x5728;Google&#x56E2;&#x961F;&#x5DF2;&#x7ECF;&#x53D1;&#x5E03;&#x4E86;&#x7A33;&#x5B9A;&#x7248;&#xFF08;v1.1.1&#xFF09;&#x3002;&#x80FD;&#x591F;&#x66F4;&#x597D;&#x7684;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x6765;&#x6784;&#x5EFA;&#x81EA;&#x5DF1;&#x7684;App&#x5E94;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x6CA1;&#x6709;&#x4E86;&#x89E3;ACC&#x73B0;&#x5728;&#x65F6;&#x95F4;&#x521A;&#x521A;&#x597D;&#xFF0C;&#x6765;&#x4E0D;&#x53CA;&#x89E3;&#x91CA;&#xFF0C;&#x8D76;&#x7D27;&#x4E0A;&#x8F66;&#x5427;&#x3002;</p>\n<p>ACC&#x662F;&#x4E00;&#x4E2A;&#x67B6;&#x6784;&#x7EC4;&#x4EF6;&#xFF0C;&#x5B83;&#x80FD;&#x5E2E;&#x5FD9;&#x6211;&#x4EEC;&#x66F4;&#x597D;&#x7684;&#x6765;&#x7BA1;&#x7406;&#x6211;&#x4EEC;&#x7684;App&#xFF0C;&#x65B9;&#x4FBF;&#x6211;&#x4EEC;&#x7684;&#x5F00;&#x53D1;&#x3002;&#x5B83;&#x80FD;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x7684;App&#x66F4;&#x597D;&#x7684;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x3001;&#x7BA1;&#x7406;&#x751F;&#x547D;&#x5468;&#x671F;&#x3001;&#x8FDB;&#x884C;&#x6A21;&#x5757;&#x5316;&#x3001;&#x907F;&#x514D;&#x5E38;&#x89C1;&#x7684;&#x9519;&#x8BEF;&#x3001;&#x51CF;&#x5C11;&#x6837;&#x677F;&#x6587;&#x4EF6;&#x7684;&#x7F16;&#x5199;&#x3002;</p>\n<p>ACC&#x4E3B;&#x8981;&#x7531;4&#x4E2A;&#x5355;&#x4E00;&#x7EC4;&#x4EF6;&#x7EC4;&#x6210;&#xFF0C;&#x5206;&#x522B;&#x4E3A;&#xFF1A;Room&#x3001;LiveData&#x3001;Lifecycle&#x4E0E;ViewModel&#x3002;&#x5B83;&#x4EEC;&#x6BCF;&#x4E00;&#x4E2A;&#x90FD;&#x662F;&#x72EC;&#x7ACB;&#x5B58;&#x5728;&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x4F7F;&#x7528;&#x5176;&#x4E2D;&#x51E0;&#x4E2A;&#xFF0C;&#x53C8;&#x6216;&#x8005;&#x53EF;&#x4EE5;&#x5C06;&#x5B83;&#x4EEC;&#x5168;&#x90E8;&#x6574;&#x5408;&#x5230;&#x4E00;&#x8D77;&#x3002;&#x6240;&#x4EE5;&#x5BF9;&#x4E8E;ACC&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x4F7F;&#x7528;&#x7075;&#x6D3B;&#x6027;&#xFF0C;&#x65B9;&#x4FBF;&#x6211;&#x4EEC;&#x96C6;&#x6210;&#x5230;&#x6211;&#x4EEC;&#x7684;App&#x4E2D;&#x3002;</p>\n<p>&#x4ECA;&#x5929;&#x4E3B;&#x8981;&#x662F;&#x5BF9;ACC&#x5176;&#x4E2D;&#x7684;Room&#x7EC4;&#x4EF6;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x3002;Room&#x662F;&#x4E00;&#x4E2A;&#x7A33;&#x5065;&#x7684;SQL&#x5BF9;&#x8C61;&#x6620;&#x5C04;&#x5E93;&#xFF0C;&#x7528;&#x6765;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5FEB;&#x901F;&#x7684;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x672C;&#x5730;&#x5B58;&#x50A8;&#x3002;&#x81F3;&#x4E8E;&#x4E3A;&#x4F55;&#x8981;&#x4F7F;&#x7528;&#x672C;&#x5730;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x81EA;&#x7136;&#x662F;&#x5F53;&#x7528;&#x6237;&#x65E0;&#x7F51;&#x7EDC;&#x6216;&#x8005;&#x7F51;&#x7EDC;&#x5DEE;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x80FD;&#x591F;&#x66F4;&#x597D;&#x7684;&#x63D0;&#x9AD8;&#x7528;&#x6237;&#x5BF9;&#x6211;&#x4EEC;App&#x7684;&#x4F53;&#x9A8C;&#x3002;</p>\n<h2 id=\"&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\"><a href=\"#&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\" class=\"headerlink\" title=\"&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\"></a>&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;</h2><p>&#x5728;&#x4F7F;&#x7528;Room&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x8981;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x4F9D;&#x8D56;&#x6DFB;&#x52A0;&#x3002;<br>&#x9996;&#x5148;&#x5728;&#x4F60;&#x7684;&#x9879;&#x76EE;&#x7684;&#x6839;&#x76EE;&#x5F55;&#x4E0B;&#x7684;build.gradle&#x4E2D;&#x6DFB;&#x52A0;google()&#x5E93;&#xFF0C;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">allprojects {</span><br><span class=\"line\">    repositories {</span><br><span class=\"line\">        jcenter()</span><br><span class=\"line\">        google()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E4B;&#x540E;&#x6253;&#x5F00;&#x4F60;&#x7684;App&#x6216;&#x8005;module&#x4E2D;&#x7684;build.gradle&#x6587;&#x4EF6;&#xFF0C;&#x5728;dependencies&#x4E2D;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    def room_version = &quot;1.1.0&quot; // or, for latest rc, use &quot;1.1.1-rc1&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">    implementation &quot;android.arch.persistence.room:runtime:$room_version&quot;</span><br><span class=\"line\">    annotationProcessor &quot;android.arch.persistence.room:compiler:$room_version&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">    // optional - RxJava support for Room</span><br><span class=\"line\">    implementation &quot;android.arch.persistence.room:rxjava2:$room_version&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">    // optional - Guava support for Room, including Optional and ListenableFuture</span><br><span class=\"line\">    implementation &quot;android.arch.persistence.room:guava:$room_version&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">    // Test helpers</span><br><span class=\"line\">    testImplementation &quot;android.arch.persistence.room:testing:$room_version&quot;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"Room\"><a href=\"#Room\" class=\"headerlink\" title=\"Room\"></a>Room</h2><p>&#x4E0A;&#x9762;&#x7684;&#x4F9D;&#x8D56;&#x6DFB;&#x52A0;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6B63;&#x5F0F;&#x4F7F;&#x7528;Room&#x3002;&#x5728;Android App&#x4E2D;&#x8FDB;&#x884C;&#x672C;&#x5730;&#x6570;&#x636E;&#x7684;&#x5B58;&#x50A8;&#x90FD;&#x662F;&#x4F7F;&#x7528;SQLite&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x539F;&#x751F;&#x7684;SQLite&#x8FDB;&#x884C;&#x672C;&#x5730;&#x6570;&#x636E;&#x5E93;&#x7684;&#x7F16;&#x5199;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x4EC5;&#x8981;&#x5B9A;&#x4E49;&#x6570;&#x636E;&#x5E93;&#x7ED3;&#x6784;&#xFF0C;&#x8FD8;&#x8981;&#x521B;&#x5EFA;SQLiteHelper&#xFF0C;&#x7F16;&#x5199;&#x4E00;&#x8FDE;&#x4E32;&#x7684;SQL&#x8BED;&#x53E5;&#x3002;&#x8FD9;&#x6837;&#x4EE3;&#x7801;&#x91CF;&#x4E0E;&#x590D;&#x6742;&#x5EA6;&#x4E0D;&#x65AD;&#x4E0A;&#x5347;&#xFF0C;&#x8FD9;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x3002;&#x800C;Room&#x6B63;&#x597D;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x51CF;&#x5C11;&#x4EE3;&#x7801;&#x3001;&#x7B80;&#x5316;&#x590D;&#x6742;&#x5EA6;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;Room&#x7684;&#x4F7F;&#x7528;&#x4E3B;&#x8981;&#x7531;&#x4E09;&#x90E8;&#x5206;&#x6784;&#x6210;&#xFF1A;</p>\n<ol>\n<li>Entity&#xFF1A;&#x6807;&#x8BC6;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x8868;&#x7ED3;&#x6784;</li>\n<li>DAO&#xFF1A; &#x6807;&#x8BC6;&#x63D0;&#x4F9B;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x5E93;&#x8868;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x65B9;&#x6CD5;</li>\n<li>Database&#xFF1A;&#x6807;&#x8BC6;&#x6240;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x7684;&#x6570;&#x636E;&#x5E93;</li>\n</ol>\n<p>&#x4EE5;&#x4E0A;&#x4E09;&#x90E8;&#x5206;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x6CE8;&#x91CA;&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x4ECE;&#x800C;&#x8FBE;&#x5230;&#x4EE3;&#x7801;&#x7684;&#x7CBE;&#x7B80;&#x3002;</p>\n<h3 id=\"Entity\"><a href=\"#Entity\" class=\"headerlink\" title=\"Entity\"></a>Entity</h3><p>Entity&#x4F5C;&#x7528;&#x5728;model&#x4E0A;&#xFF0C;&#x5373;&#x6211;&#x4EEC;&#x4E0E;&#x6570;&#x636E;&#x8868;&#x4E2D;&#x7684;&#x5B57;&#x6BB5;&#x6240;&#x5339;&#x914D;&#x7684;model&#x7C7B;&#x3002;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6765;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x8054;&#x7CFB;&#x4EBA;&#x76F8;&#x5173;&#x7684;model&#xFF0C;&#x5BF9;&#x4E8E;&#x6B63;&#x5E38;&#x7684;model&#x5EFA;&#x7ACB;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">data class ContactsModel(val id: Int, val name: String, val phone: String)</span><br></pre></td></tr></table></figure>\n<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x8981;&#x628A;ContactsModel&#x6620;&#x5C04;&#x5230;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x4E00;&#x79CD;&#x8868;&#xFF0C;&#x53EA;&#x9700;&#x8FDB;&#x884C;&#x5982;&#x4E0B;&#x64CD;&#x4F5C;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Entity(tableName = &quot;contacts&quot;)</span><br><span class=\"line\">data class ContactsModel(</span><br><span class=\"line\">        @PrimaryKey</span><br><span class=\"line\">        @ColumnInfo(name = &quot;contacts_id&quot;)</span><br><span class=\"line\">        val id: Int,</span><br><span class=\"line\">        @ColumnInfo(name = &quot;name&quot;)</span><br><span class=\"line\">        val name: String,</span><br><span class=\"line\">        @ColumnInfo(name = &quot;phone&quot;)</span><br><span class=\"line\">        val phone: String</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5728;ContactsModel&#x4E2D;&#x6DFB;&#x52A0;@Entity&#x6CE8;&#x91CA;&#xFF0C;&#x8868;&#x660E;&#x5B83;&#x5C06;&#x6620;&#x5C04;&#x6210;&#x4E00;&#x79CD;&#x8868;&#x3002;&#x5728;Entity&#x4E2D;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F7F;&#x7528;tableName&#x6765;&#x4E3A;&#x8BE5;&#x8868;&#x547D;&#x540D;&#xFF0C;&#x8FD9;&#x91CC;&#x5C06;&#x5176;&#x547D;&#x540D;&#x672A;contacts&#x3002;</p>\n<p>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x4F7F;&#x7528;@ColumnInfo&#x6765;&#x6807;&#x660E;&#x8868;&#x4E2D;&#x7684;&#x5B57;&#x6BB5;&#xFF0C;@PrimaryKey&#x6765;&#x6807;&#x660E;&#x8868;&#x7684;&#x4E3B;&#x952E;&#x3002;&#x5176;&#x4E2D;@ColumnInfo&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;(name = &#x201C;name&#x201D;)&#x6765;&#x547D;&#x540D;&#x5B57;&#x6BB5;&#x540D;&#x3002;&#x5F53;&#x7136;&#x8FD8;&#x6709;&#x522B;&#x7684;&#x6CE8;&#x91CA;&#x4F8B;&#x5982;&#x5916;&#x952E;&#x7684;&#x6807;&#x660E;&#xFF1A;@ForeignKey</p>\n<h3 id=\"DAO\"><a href=\"#DAO\" class=\"headerlink\" title=\"DAO\"></a>DAO</h3><p>&#x6570;&#x636E;&#x5E93;&#x8868;&#x5EFA;&#x597D;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x662F;&#x63D0;&#x4F9B;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x8868;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Dao</span><br><span class=\"line\">interface ContactsDao {</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Query(&quot;SELECT * FROM contacts&quot;)</span><br><span class=\"line\">    fun getAllContacts(): List&lt;ContactsModel&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Query(&quot;SELECT * FROM contacts WHERE contacts_id = :id&quot;)</span><br><span class=\"line\">    fun getContactsById(id: Int): LiveData&lt;ContactsModel&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Insert(onConflict = OnConflictStrategy.REPLACE)</span><br><span class=\"line\">    fun insertContacts(contactsModel: ContactsModel)</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Query(&quot;UPDATE contacts SET name = :name AND phone = :phone WHERE contacts_id = :id&quot;)</span><br><span class=\"line\">    fun updateContacts(id: Int, name: String, phone: String)</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Query(&quot;DELETE FROM contacts WHERE contacts_id = :id&quot;)</span><br><span class=\"line\">    fun deleteContacts(id: Int)</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x901A;&#x8FC7;@Dao&#x6765;&#x6807;&#x660E;&#x5B83;&#x662F;&#x63D0;&#x4F9B;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x8868;&#x7684;&#x65B9;&#x6CD5;&#x96C6;&#x3002;&#x8981;&#x6CE8;&#x610F;&#x5B83;&#x5FC5;&#x987B;&#x4E3A;interface&#xFF0C;&#x5728;&#x63A5;&#x53E3;&#x4E2D;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x5B9A;&#x4E49;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x5373;&#x53EF;&#x3002;&#x4E0E;&#x5E73;&#x5E38;&#x7684;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x5728;&#x6BCF;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x4E0A;&#x901A;&#x8FC7;&#x6CE8;&#x91CA;&#x6765;&#x6807;&#x660E;&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x4F5C;&#x7528;&#x3002;</p>\n<p>&#x4F8B;&#x5982;getAllContacts()&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x4E3A;&#x4E86;&#x8BA9;&#x5B83;&#x5B9E;&#x73B0;&#x83B7;&#x53D6;contacts&#x8868;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x6570;&#x636E;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;&#x5176;&#x65B9;&#x6CD5;&#x4E2D;&#x6DFB;&#x52A0;@Query&#x6CE8;&#x91CA;&#xFF0C;&#x7531;&#x4E8E;&#x662F;&#x67E5;&#x8BE2;&#x65B9;&#x6CD5;&#xFF0C;&#x81EA;&#x7136;&#x662F;&#x4F7F;&#x7528;Query&#xFF0C;&#x5982;&#x679C;&#x662F;&#x63D2;&#x5165;&#x65B9;&#x6CD5;&#x5C31;&#x662F;Insert(&#x7B2C;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;)&#x3002;&#x5176;&#x6B21;()&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x5C31;&#x662F;&#x6B63;&#x5E38;&#x7684;&#x67E5;&#x8BE2;&#x8BED;&#x53E5;&#x3002;&#x8FD9;&#x91CC;&#x662F;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x7684;Contacts&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4F7F;&#x7528;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Query(&quot;SELECT * FROM contacts&quot;)</span><br></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x4E8E;&#x6709;&#x53C2;&#x6570;&#x7684;sql&#x8BED;&#x53E5;&#x7F16;&#x5199;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x7B2C;&#x4E8C;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x53C2;&#x6570;&#x503C;&#x53EA;&#x9700;&#x5728;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#x53C2;&#x6570;&#x540D;&#x524D;&#x52A0;&#x5165;:&#x524D;&#x7F00;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x4F20;&#x53C2;&#x7684;&#x683C;&#x5F0F;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Query(&quot;SELECT * FROM contacts WHERE contacts_id = :id&quot;)</span><br><span class=\"line\">fun getContactsById(id: Int): LiveData&lt;ContactsModel&gt;</span><br></pre></td></tr></table></figure>\n<p>Room&#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#xFF0C;&#x901A;&#x8FC7;&#x5B9A;&#x4E49;&#x63A5;&#x53E3;&#x4E0E;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x518D;&#x7ED3;&#x5408;&#x6CE8;&#x91CA;&#x6765;&#x7B80;&#x5316;&#x4EE3;&#x7801;&#x91CF;&#x4E0E;&#x590D;&#x6742;&#x5EA6;&#x3002;&#x5F53;&#x7136;&#x6700;&#x7EC8;Room&#x4F1A;&#x6839;&#x636E;&#x6CE8;&#x91CA;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x4F1A;&#x5E2E;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x8FD9;&#x4E9B;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;build&#x9879;&#x76EE;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x641C;&#x7D22;&#x5230;ContactsDao_Impl&#x7C7B;&#xFF0C;&#x8FD9;&#x4E2A;&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x5C1D;&#x8BD5;&#x3002;&#x672C;&#x8D28;&#x662F;ContactsDao_Impl&#x5B9E;&#x73B0;&#x4E86;ContactsDao&#x63A5;&#x53E3;&#x3002;</p>\n<blockquote>\n<p>Room&#x7684;&#x5F3A;&#x5927;&#x4E4B;&#x4E00;&#x662F;&#xFF1A;&#x5B83;&#x53EF;&#x4EE5;&#x5728;&#x7F16;&#x8BD1;&#x65F6;&#x68C0;&#x6D4B;&#x4F60;&#x7684;SQL&#x8BED;&#x53E5;&#x662F;&#x5426;&#x7F16;&#x5199;&#x6B63;&#x786E;&#xFF0C;&#x5982;&#x679C;&#x7F16;&#x5199;&#x9519;&#x8BEF;&#x5C06;&#x5BFC;&#x81F4;&#x7F16;&#x8BD1;&#x5931;&#x8D25;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x907F;&#x514D;App&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x5BFC;&#x81F4;&#x5D29;&#x6E83;&#x3002;&#x8FD9;&#x4E2A;&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x6D4B;&#x8BD5;&#x4E00;&#x4E0B;&#x3002;</p>\n</blockquote>\n<h3 id=\"Database\"><a href=\"#Database\" class=\"headerlink\" title=\"Database\"></a>Database</h3><p>&#x73B0;&#x5728;&#x6570;&#x636E;&#x8868;&#x6709;&#x4E86;&#xFF0C;&#x5BF9;&#x8868;&#x7684;&#x64CD;&#x4F5C;&#x65B9;&#x6CD5;&#x4E5F;&#x6709;&#x4E86;&#xFF0C;&#x6700;&#x540E;&#x5C31;&#x5DEE;&#x6570;&#x636E;&#x5E93;&#x6765;&#x4FDD;&#x5B58;&#x5404;&#x4E2A;&#x6570;&#x636E;&#x8868;&#x4E86;&#x3002;Talk is cheap. Show me the code&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Database(entities = arrayOf(ContactsModel::class), version = 1)</span><br><span class=\"line\">abstract class ContactsDataBase : RoomDatabase() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    abstract fun contactsDao(): ContactsDao</span><br><span class=\"line\"> </span><br><span class=\"line\">    companion object {</span><br><span class=\"line\">        private var instance: ContactsDataBase? = null</span><br><span class=\"line\">        fun getInstance(context: Context): ContactsDataBase {</span><br><span class=\"line\">            if (instance == null) {</span><br><span class=\"line\">                instance = Room.databaseBuilder(context.applicationContext,</span><br><span class=\"line\">                        ContactsDataBase::class.java,</span><br><span class=\"line\">                        &quot;contacts.db&quot;).build()</span><br><span class=\"line\">            }</span><br><span class=\"line\">            return instance as ContactsDataBase</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6CA1;&#x9519;&#xFF0C;&#x8FD8;&#x662F;&#x4F7F;&#x7528;&#x6CE8;&#x91CA;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;ContactsDataBase&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x8BA9;&#x5B83;&#x7EE7;&#x627F;RoomDatabase&#x62BD;&#x8C61;&#x7C7B;&#x3002;&#x5F53;&#x7136;&#x4E5F;&#x662F;&#x540C;@Database&#x6765;&#x6807;&#x660E;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x3002;&#x5B83;&#x63A5;&#x6536;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5206;&#x522B;&#x4E3A;entities&#x4E0E;version&#xFF0C;&#x524D;&#x8005;&#x63A5;&#x6536;&#x7684;&#x7C7B;&#x578B;&#x662F;Class[]&#x6570;&#x7EC4;&#xFF0C;&#x5185;&#x5BB9;&#x4E3A;&#x5BF9;&#x4E8E;&#x8868;&#x7684;Class&#xFF1B;&#x540E;&#x8005;&#x662F;int&#x7684;&#x6570;&#x636E;&#x5E93;&#x7248;&#x672C;&#x53F7;&#x3002;</p>\n<p>&#x5728;ContactsDataBase&#x4E2D;&#x8FD8;&#x9700;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#xFF0C;&#x8BA9;&#x5B83;&#x8FD4;&#x56DE;&#x7531;@Dao&#x6CE8;&#x91CA;&#x7684;ContactsDao&#xFF0C;&#x5373;&#x63D0;&#x4F9B;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x8868;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x672C;&#x8D28;&#x7684;&#x4E3A;&#x6570;&#x636E;&#x5E93;&#x66B4;&#x9732;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x8868;&#x7684;&#x5165;&#x53E3;&#x3002;&#x81F3;&#x4E8E;&#x5B83;&#x7684;&#x5177;&#x4F53;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;build&#x6765;&#x67E5;&#x770B;&#x5BF9;&#x5E94;&#x7684;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x6587;&#x4EF6;ContactsDataBase_Impl&#x7C7B;&#x3002;</p>\n<p>&#x56E0;&#x4E3A;contactsDao&#x662F;&#x6570;&#x636E;&#x5E93;&#x7684;&#x552F;&#x4E00;&#x5165;&#x53E3;&#xFF0C;&#x907F;&#x514D;&#x6BCF;&#x6B21;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x65F6;&#x90FD;&#x521B;&#x5EFA;ContactsDataBase&#x5B9E;&#x4F8B;&#xFF0C;&#x5982;&#x4E0A;&#x4EE3;&#x7801;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x6765;&#x51CF;&#x5C11;&#x5B9E;&#x4F8B;&#x9891;&#x7E41;&#x521B;&#x5EFA;&#x7684;&#x5F00;&#x9500;&#x3002;</p>\n<h3 id=\"&#x4F7F;&#x7528;\"><a href=\"#&#x4F7F;&#x7528;\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;\"></a>&#x4F7F;&#x7528;</h3><p>&#x7ECF;&#x8FC7;&#x4E0A;&#x9762;&#x7684;Entity&#x3001;DAO&#x4E0E;Database&#x7684;&#x521B;&#x5EFA;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x5B8C;&#x6574;&#x7684;&#x672C;&#x5730;&#x6570;&#x636E;&#x5E93;&#x7ED3;&#x6784;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x53F2;&#x4E0A;&#x6700;&#x7B80;&#x6570;&#x636E;&#x5E93;&#x4F7F;&#x7528;&#x7684;&#x8C03;&#x7528;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private val mContactsDao by lazy { ContactsDataBase.getInstance(application).contactsDao() }</span><br><span class=\"line\"> </span><br><span class=\"line\">fun getContactsById(id: Int): LiveData&lt;ContactsModel&gt; = mContactsDao.getContactsById(id)</span><br></pre></td></tr></table></figure>\n<p>&#x4F60;&#x6CA1;&#x770B;&#x9519;&#x53EA;&#x9700;&#x4E24;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x80FD;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x5E93;&#x4E2D;Contacts&#x8868;&#x4E2D;&#x7684;&#x6240;&#x7528;&#x6570;&#x636E;&#x3002;</p>\n<p>&#x7B2C;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x6211;&#x4EEC;&#x83B7;&#x53D6;&#x4E86;ContactsDao&#x5B9E;&#x4F8B;&#xFF0C;&#x8BE5;&#x5B9E;&#x4F8B;&#x5305;&#x542B;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x8868;&#x7684;&#x6240;&#x4EE5;&#x65B9;&#x6CD5;&#x3002;&#x800C;&#x7B2C;&#x4E8C;&#x884C;&#x4EE3;&#x7801;&#x5C31;&#x662F;&#x8C03;&#x7528;ContactsDao&#x4E2D;&#x7684;&#x64CD;&#x4F5C;&#x65B9;&#x6CD5;&#x3002;&#x8FD4;&#x56DE;&#x6211;&#x4EEC;&#x6240;&#x9700;&#x7684;&#x6570;&#x636E;&#x3002;</p>\n<p>&#x5728;&#x7B2C;&#x4E8C;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x7EC6;&#x5FC3;&#x7684;&#x4F60;&#x4EEC;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x8FD4;&#x56DE;&#x4E86;LiveData<contactsmodel>&#x7C7B;&#x578B;&#x6570;&#x636E;&#x3002;&#x5B83;&#x662F;ACC&#x7684;&#x53E6;&#x4E00;&#x5F3A;&#x5927;&#x7EC4;&#x4EF6;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;Room&#x7684;&#x53E6;&#x4E00;&#x5F3A;&#x5927;&#x4E4B;&#x5904;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;LiveData&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x5B8C;&#x7F8E;&#x4E0E;LiveData&#x7ED3;&#x5408;&#x3002;&#x81F3;&#x4E8E;LiveData&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x656C;&#x8BF7;&#x5173;&#x6CE8;&#x4E0B;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;Android Architecture Components Part2:LiveData&#x3002;</contactsmodel></p>\n<h2 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h2><p>&#x5982;&#x679C;&#x4F60;&#x7684;App&#x4F7F;&#x7528;&#x4E86;Room&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x7684;App&#x672C;&#x5730;&#x6570;&#x636E;&#x83B7;&#x53D6;&#x67B6;&#x6784;&#x5C06;&#x4F1A;&#x662F;&#x8FD9;&#x6837;&#x7684;</p>\n<p><img src=\"/2018/06/07/Android-Architecture-Components-Part1-Room/room.png\" alt=\"Room\"></p>\n<p>&#x6700;&#x540E;&#x6587;&#x7AE0;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x53EF;&#x4EE5;&#x5728;<a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">Github</a>&#x4E2D;&#x83B7;&#x53D6;&#x5230;&#x3002;&#x4F7F;&#x7528;&#x65F6;&#x8BF7;&#x5C06;&#x5206;&#x652F;&#x5207;&#x6362;&#x5230;<strong>feat_architecture_components</strong></p>\n<h2 id=\"&#x76F8;&#x5173;&#x6587;&#x7AE0;\"><a href=\"#&#x76F8;&#x5173;&#x6587;&#x7AE0;\" class=\"headerlink\" title=\"&#x76F8;&#x5173;&#x6587;&#x7AE0;\"></a>&#x76F8;&#x5173;&#x6587;&#x7AE0;</h2><p><a href=\"https://idisfkj.github.io/2018/06/10/Android-Architecture-Components-Part2-LiveData/\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part2:LiveData</a><br><a href=\"https://idisfkj.github.io/2018/06/14/Android-Architecture-Components-Part3-Lifecycle/\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part3:Lifecycle</a><br><a href=\"https://idisfkj.github.io/2018/06/22/Android-Architecture-Components-Part4-ViewModel/\" target=\"_blank\" rel=\"noopener\">Android Architecture Components Part4:ViewModel</a></p>\n<h2 id=\"&#x5173;&#x6CE8;\"><a href=\"#&#x5173;&#x6CE8;\" class=\"headerlink\" title=\"&#x5173;&#x6CE8;\"></a>&#x5173;&#x6CE8;</h2><p><img src=\"/2018/06/07/Android-Architecture-Components-Part1-Room/wx.jpg\" alt=\"&#x602A;&#x8C08;&#x65F6;&#x95F4;&#x5230;&#x4E86;\"></p>\n","categories":["android"],"tags":["Android Architecture Components"]},{"title":"ConstraintLayout使用汇总","url":"https://www.rousetime.com/2018/05/03/ConstraintLayout使用汇总/","content":"<h2 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h2><p>&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x8981;&#x5411;&#x5927;&#x5BB6;&#x4ECB;&#x7ECD;ConstraintLayout&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x79CD;&#x5E03;&#x5C40;&#x65B9;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5728;&#x5BF9;Android&#x8FDB;&#x884C;&#x5E03;&#x5C40;&#x65F6;&#x51CF;&#x5C11;&#x5BF9;&#x5E03;&#x5C40;&#x5C42;&#x6B21;&#x7684;&#x5D4C;&#x5957;&#xFF0C;&#x8FDB;&#x800C;&#x63D0;&#x9AD8;app&#x7684;&#x6027;&#x80FD;&#x3002;</p>\n<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4F1A;&#x901A;&#x8FC7;&#x4E00;&#x4E9B;&#x793A;&#x4F8B;&#x6765;&#x5168;&#x9762;&#x4ECB;&#x7ECD;ConstraintLayout&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x4E0E;&#x5B83;&#x7684;&#x4E00;&#x4E9B;&#x7279;&#x6027;&#x3002;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x6B63;&#x5728;&#x5B66;&#x4E60;ConstraintLayout&#x4F7F;&#x7528;&#x7684;&#x540C;&#x5B66;&#x4EEC;&#x3002;</p>\n<h2 id=\"ConstraintLayout-VS-RelativeLayout\"><a href=\"#ConstraintLayout-VS-RelativeLayout\" class=\"headerlink\" title=\"ConstraintLayout VS RelativeLayout\"></a>ConstraintLayout VS RelativeLayout</h2><p>&#x76F8;&#x4FE1;&#x5F53;&#x6211;&#x4EEC;&#x8FDB;&#x884C;&#x5E03;&#x5C40;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F7F;&#x7528;&#x6700;&#x591A;&#x7684;&#x5E94;&#x8BE5;&#x662F;LinearLayout&#x4E0E;RelativeLayout&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x590D;&#x6742;&#x4E00;&#x70B9;&#x7684;&#x5E03;&#x5C40;&#x6765;&#x8BF4;&#xFF0C;&#x4ED6;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x5D4C;&#x5957;&#x4F7F;&#x7528;&#x5C31;&#x6700;&#x6B63;&#x5E38;&#x4E0D;&#x8FC7;&#x4E86;&#x3002;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x5D4C;&#x5957;&#x5E03;&#x5C40;&#xFF0C;Google&#x7279;&#x610F;&#x5F00;&#x53D1;&#x7684;ConstraintLayout&#x3002;&#x5B83;&#x540C;&#x65F6;&#x652F;&#x6301;LinearLayout&#x4E0E;RelativeLayout&#x7684;&#x6240;&#x7528;&#x7279;&#x6027;&#x3002;&#x540C;&#x65F6;&#x5B83;&#x5B8C;&#x5168;&#x901A;&#x8FC7;&#x7EA6;&#x675F;&#x6765;&#x51CF;&#x5C11;&#x5E03;&#x5C40;&#x7684;&#x5D4C;&#x5957;&#x3002;&#x610F;&#x601D;&#x5C31;&#x662F;&#x57FA;&#x672C;&#x4E0A;&#x6700;&#x5916;&#x5C42;&#x53EA;&#x9700;&#x8981;&#x4E00;&#x4E2A;ConstraintLayout&#x8282;&#x70B9;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;&#x4E0B;&#x9762;&#x5148;&#x4ECE;RelativeLayout&#x5F00;&#x59CB;&#xFF0C;&#x770B;&#x5B83;&#x662F;&#x5982;&#x4F55;&#x6765;&#x5B9E;&#x73B0;RelativeLayout&#x7684;&#x7279;&#x6027;&#x3002;</p>\n<p>&#x8FD9;&#x91CC;&#x6211;&#x5217;&#x4E3E;&#x4E00;&#x4E9B;RelativeLayout&#x7684;&#x7279;&#x6027;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android:layout_alignStart=&quot;@id/view&quot;</span><br><span class=\"line\">android:layout_alignLeft=&quot;@id/view&quot;</span><br><span class=\"line\">android:layout_alignEnd=&quot;@id/view&quot;</span><br><span class=\"line\">android:layout_alignRight=&quot;@id/view&quot;</span><br><span class=\"line\">android:layout_alignTop=&quot;@id/view&quot;</span><br><span class=\"line\">android:layout_alignBaseline=&quot;@id/view&quot;</span><br><span class=\"line\">android:layout_alignBottom=&quot;@id/view&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">android:layout_toStartOf=&quot;@id/view&quot;</span><br><span class=\"line\">android:layout_toLeftOf=&quot;@id/view&quot;</span><br><span class=\"line\">android:layout_toEndOf=&quot;@id/view&quot;</span><br><span class=\"line\">android:layout_toRightOf=&quot;@id/view&quot;</span><br><span class=\"line\">android:layout_above=&quot;@id/view&quot;</span><br><span class=\"line\">android:layout_below=&quot;@id/view&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">android:layout_alignParentStart=&quot;true&quot;</span><br><span class=\"line\">android:layout_alignParentLeft=&quot;true&quot;</span><br><span class=\"line\">android:layout_alignParentEnd=&quot;true&quot;</span><br><span class=\"line\">android:layout_alignParentRight=&quot;true&quot;</span><br><span class=\"line\">android:layout_alignParentTop=&quot;true&quot;</span><br><span class=\"line\">android:layout_alignParentBottom=&quot;true&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">android:layout_centerInParent=&quot;true&quot;</span><br><span class=\"line\">android:layout_centerHorizontal=&quot;true&quot;</span><br><span class=\"line\">android:layout_centerVertical=&quot;true&quot;</span><br></pre></td></tr></table></figure>\n<p>&#x76F8;&#x4FE1;&#x4E0A;&#x9762;&#x7684;&#x7279;&#x6027;&#x5927;&#x5BB6;&#x518D;&#x719F;&#x6089;&#x4E0D;&#x8FC7;&#x4E86;&#x3002;&#x5BF9;&#x4E8E;layout_align*&#x7684;&#x5C5E;&#x6027;&#x5728;ConstraintLayout&#x4E2D;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x65B9;&#x5F0F;&#x66FF;&#x4EE3;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app:layout_constraintStart_toStartOf=&quot;@id/view&quot;</span><br><span class=\"line\">app:layout_constraintLeft_toLeftOf=&quot;@id/view&quot;</span><br><span class=\"line\">app:layout_constraintEnd_toEndOf=&quot;@id/view&quot;</span><br><span class=\"line\">app:layout_constraintRight_toRightOf=&quot;@id/view&quot;</span><br><span class=\"line\">app:layout_constraintTop_toTopOf=&quot;@id/view&quot;</span><br><span class=\"line\">app:layout_constraintBaseline_toBaselineOf=&quot;@id/view&quot;</span><br><span class=\"line\">app:layout_constraintBottom_toBottomOf=&quot;@id/view&quot;</span><br></pre></td></tr></table></figure>\n<p>&#x800C;&#x5BF9;&#x4E8E;layout_to*&#x7684;&#x5C5E;&#x6027;ConstraintLayout&#x4E5F;&#x6709;&#x4E0E;&#x4E4B;&#x5B8C;&#x7F8E;&#x66FF;&#x4EE3;&#x7684;&#x7279;&#x6027;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app:layout_constraintStart_toEndOf=&quot;@id/view&quot;</span><br><span class=\"line\">app:layout_constraintLeft_toRightOf=&quot;@id/view&quot;</span><br><span class=\"line\">app:layout_constraintEnd_toStartOf=&quot;@id/view&quot;</span><br><span class=\"line\">app:layout_constraintRight_toLeftOf=&quot;@id/view&quot;</span><br><span class=\"line\">app:layout_constraintTop_toBottomOf=&quot;@id/view&quot;</span><br><span class=\"line\">app:layout_constraintBottom_toTopOf=&quot;@id/view&quot;</span><br></pre></td></tr></table></figure>\n<p>&#x63A5;&#x4E0B;&#x6765;&#x662F;layout_alignParent*&#x7684;&#x66FF;&#x4EE3;&#x5B9E;&#x73B0;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app:layout_constraintStart_toStartOf=&quot;parent&quot;</span><br><span class=\"line\">app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class=\"line\">app:layout_constraintEnd_toEndOf=&quot;parent&quot;</span><br><span class=\"line\">app:layout_constraintRight_toRightOf=&quot;parent&quot;</span><br><span class=\"line\">app:layout_constraintTop_toTopOf=&quot;parent&quot;</span><br><span class=\"line\">app:layout_constraintBottom_toBottomOf=&quot;parent&quot;</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x4E0E;&#x4E4B;&#x524D;&#x7684;layout_align*&#x57FA;&#x672C;&#x7C7B;&#x4F3C;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x5B83;&#x7684;&#x6240;&#x4EE5;&#x7EA6;&#x675F;&#x7684;&#x5BF9;&#x8C61;&#x4E0D;&#x540C;&#x800C;&#x5DF2;&#xFF0C;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x5BF9;&#x7236;&#x5E03;&#x5C40;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x8FD9;&#x91CC;&#x7EDF;&#x4E00;&#x90FD;&#x662F;parent&#x3002;</p>\n<p>&#x6700;&#x540E;&#x662F;layout_center*&#x5C5E;&#x6027;&#xFF0C;&#x672C;&#x8D28;&#x4E0E;&#x4E0A;&#x9762;&#x7684;&#x57FA;&#x672C;&#x7C7B;&#x4F3C;&#x3002;&#x4E0B;&#x9762;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x5B9E;&#x4F8B;&#x6765;&#x5C55;&#x793A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Button</span><br><span class=\"line\">       android:id=&quot;@+id/center&quot;</span><br><span class=\"line\">       android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">       android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">       android:text=&quot;center&quot;</span><br><span class=\"line\">       app:layout_constraintBottom_toBottomOf=&quot;parent&quot;</span><br><span class=\"line\">       app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class=\"line\">       app:layout_constraintRight_toRightOf=&quot;parent&quot;</span><br><span class=\"line\">       app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x76F8;&#x4FE1;&#x4E0D;&#x96BE;&#x7406;&#x89E3;&#xFF0C;&#x8981;&#x60F3;&#x5B9E;&#x73B0;&#x6C34;&#x5E73;&#x5C45;&#x4E2D;&#x53EA;&#x9700;&#x8BBE;&#x7F6E;left&#x4E0E;right&#x5206;&#x522B;&#x7EA6;&#x675F;parent&#xFF0C;&#x800C;&#x8981;&#x60F3;&#x5B9E;&#x73B0;&#x7AD6;&#x76F4;&#x5C45;&#x4E2D;&#x5219;&#x53EA;&#x9700;&#x8BBE;&#x7F6E;top&#x4E0E;bottom&#x5206;&#x522B;&#x7EA6;&#x675F;parent&#x3002;</p>\n<p>&#x4E3A;&#x4E86;&#x5DE9;&#x56FA;&#x4E0A;&#x9762;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#x4E0E;&#x6548;&#x679C;&#x56FE;&#xFF0C;&#x65B9;&#x4FBF;&#x5927;&#x5BB6;&#x7406;&#x89E3;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;android.support.constraint.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class=\"line\">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class=\"line\">    android:layout_width=&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;left&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;right&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf=&quot;parent&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;bottom&quot;</span><br><span class=\"line\">        app:layout_constraintBottom_toBottomOf=&quot;parent&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/center&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;center&quot;</span><br><span class=\"line\">        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;center top&quot;</span><br><span class=\"line\">        app:layout_constraintBottom_toTopOf=&quot;@+id/center&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf=&quot;parent&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;center bottom&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toBottomOf=&quot;@+id/center&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;center left&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toLeftOf=&quot;@+id/center&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;@+id/center&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;center right&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toRightOf=&quot;@+id/center&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;@+id/center&quot; /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/android.support.constraint.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2018/05/03/ConstraintLayout&#x4F7F;&#x7528;&#x6C47;&#x603B;/1.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis/blob/master/app/src/main/res/layout/activity_constraint_layout_normal.xml\" target=\"_blank\" rel=\"noopener\">&#x70B9;&#x51FB;&#x67E5;&#x770B;&#x6E90;&#x7801;</a></p>\n<blockquote>\n<p>&#x5728;ConstraintLayout&#x4E2D;&#x6CA1;&#x6709;match_parent,&#x800C;&#x4E0E;&#x4E4B;&#x66FF;&#x4EE3;&#x7684;&#x662F;match_constraint&#xFF0C;&#x5728;&#x4F7F;&#x7528;&#x4E2D;&#x901A;&#x8FC7;0dp&#x6765;&#x4EE3;&#x8868;&#x3002;&#x4E00;&#x65E6;&#x4F60;&#x4F7F;&#x7528;&#x4E86;match_parent&#x90A3;&#x4E48;&#x5B83;&#x7684;&#x7EA6;&#x675F;&#x5C06;&#x4F1A;&#x5931;&#x6548;&#x3002;</p>\n</blockquote>\n<h2 id=\"ConstraintLayout-VS-LinearLayout\"><a href=\"#ConstraintLayout-VS-LinearLayout\" class=\"headerlink\" title=\"ConstraintLayout VS LinearLayout\"></a>ConstraintLayout VS LinearLayout</h2><p>&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x8FBE;&#x5230;LinearLayout&#x7684;&#x6548;&#x679C;&#xFF0C;ConstraintLayout&#x5F15;&#x5165;&#x4E86;Chain Style.&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x6765;&#x8BBE;&#x7F6E;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app:layout_constraintHorizontal_chainStyle=&quot;&quot;</span><br><span class=\"line\">app:layout_constraintVertical_chainStyle=&quot;&quot;</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x4E3B;&#x8981;&#x6709;&#x4E09;&#x4E2A;&#x5C5E;&#x6027;&#x5206;&#x522B;&#x4E3A;&#xFF1A;</p>\n<ol>\n<li>spread_inside:&#x4E24;&#x8FB9;&#x4E0D;&#x7559;&#x7A7A;&#x95F4;&#xFF0C;&#x4E2D;&#x95F4;&#x95F4;&#x8DDD;&#x5E73;&#x5206;</li>\n<li>spread:&#x5B8C;&#x5168;&#x5747;&#x5206;</li>\n<li>packed:&#x5B8C;&#x5168;&#x4E0D;&#x7559;&#x95F4;&#x8DDD;</li>\n</ol>\n<p>&#x89E3;&#x91CA;&#x7684;&#x6709;&#x70B9;&#x751F;&#x786C;&#xFF0C;&#x4E0B;&#x9762;&#x901A;&#x8FC7;&#x4E00;&#x5F20;&#x5B98;&#x65B9;&#x56FE;&#x6765;&#x66F4;&#x76F4;&#x89C2;&#x7684;&#x4E86;&#x89E3;</p>\n<p><img src=\"/2018/05/03/ConstraintLayout&#x4F7F;&#x7528;&#x6C47;&#x603B;/2.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<blockquote>\n<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF1A;&#x8981;&#x8FBE;&#x5230;&#x4E0A;&#x7684;&#x7684;chain&#x6548;&#x679C;&#xFF0C;&#x4ED6;&#x4EEC;&#x4E4B;&#x95F4;&#x5FC5;&#x987B;&#x5B8C;&#x5168;&#x76F8;&#x4E92;&#x7EA6;&#x675F;&#xFF0C;&#x540C;&#x65F6;chain style&#x7684;&#x8BBE;&#x7F6E;&#x90FD;&#x662F;&#x4EE5;&#x7B2C;&#x4E00;&#x4E2A;view&#x4E3A;&#x57FA;&#x70B9;&#x3002;&#x540C;&#x65F6;&#x9ED8;&#x8BA4;chain style&#x4E3A;spread&#x3002;</p>\n</blockquote>\n<p>&#x540C;&#x6837;&#x7684;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#x4E0E;&#x6548;&#x679C;&#x56FE;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;android.support.constraint.ConstraintLayout</span><br><span class=\"line\">xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class=\"line\">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class=\"line\">    android:layout_width=&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/first&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;first&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toLeftOf=&quot;@+id/second&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/second&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;second&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toRightOf=&quot;@+id/first&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toLeftOf=&quot;@+id/third&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;@+id/first&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/third&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;third&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toRightOf=&quot;@+id/second&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;@+id/first&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/match_first&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;first&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toLeftOf=&quot;@+id/match_second&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toBottomOf=&quot;@+id/first&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/match_second&quot;</span><br><span class=\"line\">        android:layout_width=&quot;0dp&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;second&quot;</span><br><span class=\"line\">        app:layout_constraintHorizontal_weight=&quot;3&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toRightOf=&quot;@+id/match_first&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toLeftOf=&quot;@+id/match_third&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;@+id/match_first&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/match_third&quot;</span><br><span class=\"line\">        android:layout_width=&quot;0dp&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;third&quot;</span><br><span class=\"line\">        app:layout_constraintHorizontal_weight=&quot;4&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toRightOf=&quot;@+id/match_second&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;@+id/match_first&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/spread_first&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;first&quot;</span><br><span class=\"line\">        app:layout_constraintHorizontal_chainStyle=&quot;spread_inside&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toLeftOf=&quot;@+id/spread_second&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toBottomOf=&quot;@+id/match_first&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/spread_second&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;second&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toRightOf=&quot;@+id/spread_first&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toLeftOf=&quot;@+id/spread_third&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;@+id/spread_first&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/spread_third&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;third&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toRightOf=&quot;@+id/spread_second&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;@+id/spread_first&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/packed_first&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;first&quot;</span><br><span class=\"line\">        app:layout_constraintHorizontal_chainStyle=&quot;packed&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toLeftOf=&quot;@+id/packed_second&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toBottomOf=&quot;@+id/spread_first&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/packed_second&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;second&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toRightOf=&quot;@+id/packed_first&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toLeftOf=&quot;@+id/packed_third&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;@+id/packed_first&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/packed_third&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;third&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toRightOf=&quot;@+id/packed_second&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;@+id/packed_first&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/bias_first&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;first&quot;</span><br><span class=\"line\">        app:layout_constraintHorizontal_bias=&quot;0.2&quot;</span><br><span class=\"line\">        app:layout_constraintHorizontal_chainStyle=&quot;packed&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toLeftOf=&quot;@+id/bias_second&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toBottomOf=&quot;@+id/packed_first&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/bias_second&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;second&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toRightOf=&quot;@+id/bias_first&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toLeftOf=&quot;@+id/bias_third&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;@+id/bias_first&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/bias_third&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;third&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toRightOf=&quot;@+id/bias_second&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;@+id/bias_first&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;/android.support.constraint.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2018/05/03/ConstraintLayout&#x4F7F;&#x7528;&#x6C47;&#x603B;/3.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis/blob/master/app/src/main/res/layout/activity_constraint_layout_chain.xml\" target=\"_blank\" rel=\"noopener\">&#x70B9;&#x51FB;&#x67E5;&#x770B;&#x6E90;&#x7801;</a></p>\n<p>&#x901A;&#x8FC7;&#x6548;&#x679C;&#x56FE;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0;&#x7B2C;&#x4E8C;&#x884C;&#x4ED6;&#x4EEC;&#x5360;&#x7684;&#x6BD4;&#x4F8B;&#x4E0D;&#x540C;&#xFF0C;&#x8FD4;&#x56DE;&#x770B;&#x4EE3;&#x7801;&#x53D1;&#x73B0;&#x5176;&#x5B9E;&#x4E0E;LinearLayout&#x7C7B;&#x4F3C;,&#x4F7F;&#x7528;&#x4E86;<code>app:layout_constraintHorizontal_weight=&quot;&quot;</code>&#x6743;&#x91CD;&#x5C5E;&#x6027;&#x3002;&#x5F53;&#x7136;&#x8981;&#x4F7F;&#x5F97;&#x5176;&#x751F;&#x6548;&#x5FC5;&#x987B;layout_width&#x4E0E;layout_height&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x4E3A;0dp&#x3002;<br>&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x7B2C;4&#x3001;5&#x884C;&#xFF0C;&#x5982;&#x679C;chain style&#x7684;&#x503C;&#x4E3A;packed&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x9ED8;&#x8BA4;&#x662F;&#x5C45;&#x4E2D;&#x6392;&#x5217;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x6539;&#x53D8;&#x7684;&#x8BDD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;<code>app:layout_constraintHorizontal_bias=&quot;0.2&quot;</code>&#x4E0E;<code>app:layout_constraintVertical_bias=&quot;0.2&quot;</code>&#x3002;</p>\n<h2 id=\"margin-amp-goneMargin\"><a href=\"#margin-amp-goneMargin\" class=\"headerlink\" title=\"margin &amp; goneMargin\"></a>margin &amp; goneMargin</h2><h3 id=\"margin\"><a href=\"#margin\" class=\"headerlink\" title=\"margin\"></a>margin</h3><p>ConstraintLayout&#x7684;margin&#x4E0E;&#x539F;&#x6765;&#x7684;&#x4F7F;&#x7528;&#x533A;&#x522B;&#x4E3B;&#x8981;&#x4E3A;&#x4E24;&#x70B9;&#xFF1A;&#x5176;&#x4E00;android:layout_margin*&#x6548;&#x679C;&#x4E0D;&#x53D8;&#xFF0C;&#x4F46;&#x5B83;&#x7684;&#x503C;&#x4E0D;&#x80FD;&#x4E3A;&#x8D1F;&#x503C;&#xFF1B;&#x5176;&#x4E8C;&#x76F8;&#x5E94;&#x65B9;&#x5411;&#x7684;margin&#x8BBE;&#x7F6E;&#x5FC5;&#x987B;&#x8981;&#x6709;&#x7EA6;&#x675F;&#xFF0C;&#x5426;&#x5219;&#x4E0D;&#x751F;&#x6548;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;TextView</span><br><span class=\"line\">    android:id=&quot;@+id/tv1&quot;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    android:layout_marginRight=&quot;100dp&quot;        </span><br><span class=\"line\">    app:layout_constraintLeft_toLeftOf=&quot;parent&quot;/&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;TextView</span><br><span class=\"line\">    android:layout_marginLeft=&quot;10dp&quot;</span><br><span class=\"line\">    ...       </span><br><span class=\"line\">    app:layout_constraintBaseline_toBaselineOf=&quot;@+id/tv1&quot;</span><br><span class=\"line\">    app:layout_constraintLeft_toRightOf=&quot;@+id/tv1&quot; /&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x7B2C;&#x4E8C;&#x4E2A;TextView&#xFF0C;&#x5B83;&#x7684;marginLeft&#x4F1A;&#x751F;&#x6548;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x6709;left&#x65B9;&#x5411;&#x7684;&#x7EA6;&#x675F;&#xFF1A;app:layout_constraintLeft_toRightOf=&#x201D;@+id/tv1&#x201D;&#xFF1B;&#x800C;&#x5BF9;&#x4E8E;&#x7B2C;&#x4E00;&#x4E2A;TextView&#xFF0C;&#x5B83;&#x7684;marginRight&#x4E0D;&#x4F1A;&#x751F;&#x6548;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x7684;right&#x65B9;&#x5411;&#x4E0A;&#x6CA1;&#x6709;&#x7EA6;&#x675F;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x8981;&#x751F;&#x6548;&#x53EF;&#x4EE5;&#x52A0;&#x5165;:app:layout_constraintRight_toRightOf=&#x201D;parent&#x7EA6;&#x675F;&#x3002;</p>\n<p>&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x76F8;&#x5BF9;&#x4E8E;&#x539F;&#x6765;&#x5E03;&#x5C40;margin&#x4F7F;&#x7528;&#x7684;&#x533A;&#x522B;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x89C9;&#x5F97;&#x4E0D;&#x4E60;&#x60EF;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;padding&#x4EE3;&#x66FF;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;ConstraintLayout&#x6240;&#x63A8;&#x8350;&#x7684;&#x65B9;&#x5F0F;&#x3002;</p>\n<h3 id=\"goneMargin\"><a href=\"#goneMargin\" class=\"headerlink\" title=\"goneMargin\"></a>goneMargin</h3><p>&#x5728;ConstraintLayout&#x4E2D;&#x8FD8;&#x589E;&#x52A0;&#x4E86;&#x53E6;&#x5916;&#x4E00;&#x79CD;goneMargin&#xFF0C;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x4E3B;&#x8981;&#x662F;&#xFF1A;&#x4E00;&#x65E6;&#x67D0;&#x4E2A;&#x65B9;&#x5411;&#x4E0A;&#x7684;&#x7EA6;&#x675F;view&#x4E0D;&#x53EF;&#x4EE5;&#x89C1;&#xFF0C;&#x8FD9;&#x65F6;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;&#x8BE5;&#x5C5E;&#x6027;&#xFF0C;&#x8BE5;&#x65B9;&#x5411;&#x5C06;&#x81EA;&#x52A8;&#x589E;&#x52A0;margin&#x503C;&#x3002;&#x5373;&#x76EE;&#x6807;&#x5FC5;&#x987B;&#x4E0D;&#x53EF;&#x89C1;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;android.support.constraint.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class=\"line\">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class=\"line\">    android:layout_width=&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:id=&quot;@+id/tv1&quot;</span><br><span class=\"line\">        android:layout_marginTop=&quot;100dp&quot;</span><br><span class=\"line\">        android:text=&quot;tv1&quot;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf=&quot;parent&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:layout_marginLeft=&quot;10dp&quot;</span><br><span class=\"line\">        android:text=&quot;tv2&quot;</span><br><span class=\"line\">        ....</span><br><span class=\"line\">        app:layout_constraintBaseline_toBaselineOf=&quot;@+id/tv1&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toRightOf=&quot;@+id/tv1&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:id=&quot;@+id/tv3&quot;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        android:text=&quot;tv3&quot;</span><br><span class=\"line\">        android:visibility=&quot;gone&quot;</span><br><span class=\"line\">        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:id=&quot;@+id/tv4&quot;</span><br><span class=\"line\">        android:layout_marginLeft=&quot;10dp&quot;</span><br><span class=\"line\">        android:text=&quot;tv4&quot;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toRightOf=&quot;@+id/tv3&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_goneMarginLeft=&quot;100dp&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:id=&quot;@+id/tv5&quot;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        android:layout_marginBottom=&quot;10dp&quot;</span><br><span class=\"line\">        android:text=&quot;tv5&quot;</span><br><span class=\"line\">        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintVertical_bias=&quot;0.33&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;/android.support.constraint.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2018/05/03/ConstraintLayout&#x4F7F;&#x7528;&#x6C47;&#x603B;/4.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis/blob/master/app/src/main/res/layout/activity_constraint_layout_margin.xml\" target=\"_blank\" rel=\"noopener\">&#x70B9;&#x51FB;&#x67E5;&#x770B;&#x6E90;&#x7801;</a></p>\n<h2 id=\"Circle\"><a href=\"#Circle\" class=\"headerlink\" title=\"Circle\"></a>Circle</h2><p>&#x5728;ConstraintLayout&#x4E2D;&#x4F60;&#x4E0D;&#x4EC5;&#x53EF;&#x4EE5;&#x5BF9;&#x4EFB;&#x610F;view&#x8FDB;&#x884C;&#x6C34;&#x5E73;&#x4E0E;&#x7AD6;&#x76F4;&#x65B9;&#x5411;&#x7684;&#x7EA6;&#x675F;&#xFF0C;&#x540C;&#x65F6;&#x4F60;&#x8FD8;&#x53EF;&#x4EE5;&#x5C45;&#x4E8E;&#x7EA6;&#x675F;view&#x7684;&#x4E2D;&#x5FC3;&#x70B9;&#x8FDB;&#x884C;&#x4E0D;&#x540C;&#x89D2;&#x5EA6;&#x65B9;&#x5411;&#x7684;&#x7EA6;&#x675F;&#x3002;&#x4E3B;&#x8981;&#x5C5E;&#x6027;&#x6709;&#x5982;&#x4E0B;&#x4E09;&#x79CD;&#xFF1A;</p>\n<ol>\n<li>layout_constraintCircle: &#x4EE3;&#x8868;&#x7EA6;&#x675F;&#x7684;view&#x7684;id</li>\n<li>layout_constraintCircleAngle: &#x4EE3;&#x8868;&#x7EA6;&#x675F;&#x7684;&#x89D2;&#x5EA6;</li>\n<li>layout_constraintCircleRadius: &#x4EE3;&#x8868;&#x7EA6;&#x675F;&#x7684;&#x534A;&#x5F84;&#x5927;&#x5C0F;</li>\n</ol>\n<p><img src=\"/2018/05/03/ConstraintLayout&#x4F7F;&#x7528;&#x6C47;&#x603B;/5.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;android.support.constraint.ConstraintLayout</span><br><span class=\"line\">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class=\"line\"> ...</span><br><span class=\"line\"> &gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:id=&quot;@+id/tv1&quot;</span><br><span class=\"line\">        android:text=&quot;tv1&quot;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf=&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:text=&quot;tv2&quot;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        app:layout_constraintCircle=&quot;@id/tv1&quot;</span><br><span class=\"line\">        app:layout_constraintCircleAngle=&quot;45&quot;</span><br><span class=\"line\">        app:layout_constraintCircleRadius=&quot;100dp&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;/android.support.constraint.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2018/05/03/ConstraintLayout&#x4F7F;&#x7528;&#x6C47;&#x603B;/6.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis/blob/master/app/src/main/res/layout/activity_constraint_layout_circle.xml\" target=\"_blank\" rel=\"noopener\">&#x70B9;&#x51FB;&#x67E5;&#x770B;&#x6E90;&#x7801;</a></p>\n<h2 id=\"GuideLine\"><a href=\"#GuideLine\" class=\"headerlink\" title=\"GuideLine\"></a>GuideLine</h2><p>GuideLine&#x4E5F;&#x662F;ConstraintLayout&#x7279;&#x6709;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x5B83;&#x76F8;&#x5F53;&#x4E8E;&#x4E00;&#x4E2A;&#x53C2;&#x8003;&#x7EBF;&#xFF0C;&#x4E14;&#x5B83;&#x7684;&#x5E03;&#x5C40;&#x4E2D;&#x4E0D;&#x4F1A;&#x5C55;&#x793A;&#x3002;</p>\n<p>GuidLine&#x6709;&#x6C34;&#x5E73;&#x4E0E;&#x7AD6;&#x76F4;&#x65B9;&#x6CD5;&#x7684;&#x8BBE;&#x7F6E;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android:orientation=&quot;horizontal|vertical&quot;</span><br></pre></td></tr></table></figure>\n<p>&#x4E3B;&#x8981;&#x8BBE;&#x7F6E;&#x5C5E;&#x6027;&#x4E3A;&#xFF1A;</p>\n<ol>\n<li>layout_constraintGuide_begin: &#x4EE3;&#x8868;&#x8DDD;&#x79BB;GuideLine&#x5DE6;&#x8FB9;&#x6216;&#x8005;&#x5E95;&#x90E8;&#x7684;&#x8DDD;&#x79BB;</li>\n<li>layout_constraintGuide_end: &#x4EE3;&#x8868;&#x8DDD;&#x79BB;GuideLine&#x53F3;&#x8FB9;&#x6216;&#x8005;&#x5E95;&#x90E8;&#x7684;&#x8DDD;&#x79BB;</li>\n<li>layout_constraintGuide_percent&#xFF1A;&#x4EE3;&#x8868;GuideLine&#x76F8;&#x5BF9;&#x4E8E;parent&#x7684;&#x4F4D;&#x7F6E;&#x767E;&#x5206;&#x6BD4;</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;android.support.constraint.ConstraintLayout </span><br><span class=\"line\">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class=\"line\">   ...</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;android.support.constraint.Guideline</span><br><span class=\"line\">        android:id=&quot;@+id/vertical_guide_line&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:orientation=&quot;vertical&quot;</span><br><span class=\"line\">        app:layout_constraintGuide_begin=&quot;150dp&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/button&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_marginTop=&quot;16dp&quot;</span><br><span class=\"line\">        android:text=&quot;Button&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf=&quot;@+id/vertical_guide_line&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;android.support.constraint.Guideline</span><br><span class=\"line\">        android:id=&quot;@+id/horizontal_guide_line&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:orientation=&quot;horizontal&quot;</span><br><span class=\"line\">        app:layout_constraintGuide_end=&quot;150dp&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/button1&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;Button1&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toLeftOf=&quot;@+id/vertical_guide_line&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf=&quot;@+id/horizontal_guide_line&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:id=&quot;@+id/button2&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;Button2&quot;</span><br><span class=\"line\">        app:layout_constraintBottom_toBottomOf=&quot;@+id/horizontal_guide_line&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toRightOf=&quot;@+id/vertical_guide_line&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;android.support.constraint.Guideline</span><br><span class=\"line\">        android:id=&quot;@+id/percent_guide_Line&quot;</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:orientation=&quot;horizontal&quot;</span><br><span class=\"line\">        app:layout_constraintGuide_percent=&quot;0.3&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &lt;Button</span><br><span class=\"line\">        android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text=&quot;margin top of parent 30%&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toBottomOf=&quot;@+id/percent_guide_Line&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;/android.support.constraint.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2018/05/03/ConstraintLayout&#x4F7F;&#x7528;&#x6C47;&#x603B;/7.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis/blob/master/app/src/main/res/layout/activity_constraint_layout_guide_line.xml\" target=\"_blank\" rel=\"noopener\">&#x70B9;&#x51FB;&#x67E5;&#x770B;&#x6E90;&#x7801;</a></p>\n<h2 id=\"Barrier-amp-Group\"><a href=\"#Barrier-amp-Group\" class=\"headerlink\" title=\"Barrier &amp; Group\"></a>Barrier &amp; Group</h2><h3 id=\"Barrier\"><a href=\"#Barrier\" class=\"headerlink\" title=\"Barrier\"></a>Barrier</h3><p>Barrier&#x4E0E;GuideLine&#x6709;&#x70B9;&#x7C7B;&#x4F3C;&#xFF0C;&#x4E5F;&#x662F;&#x5E03;&#x5C40;&#x4E0D;&#x53EF;&#x89C1;&#x7684;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x5B83;&#x5C31;&#x7EA6;&#x675F;&#x5BF9;&#x8C61;&#x7684;&#xFF0C;&#x770B;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>\n<p><img src=\"/2018/05/03/ConstraintLayout&#x4F7F;&#x7528;&#x6C47;&#x603B;/8.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p>&#x5982;&#x679C;&#x6709;&#x8FD9;&#x4E48;&#x4E00;&#x79CD;&#x9700;&#x6C42;&#xFF1A;tv3&#x59CB;&#x7EC8;&#x5728;tv1&#x4E0E;tv2&#x7684;&#x6700;&#x8FD1;&#x53F3;&#x8FB9;&#xFF0C;&#x4F46;tv1&#x4E0E;tv2&#x7684;&#x5BBD;&#x5EA6;&#x7684;&#x4E0D;&#x770B;&#x9884;&#x671F;&#x7684;&#xFF0C;&#x5373;&#x53EF;&#x80FD;tv1&#x66F4;&#x957F;&#x6216;&#x8005;tv2&#x66F4;&#x957F;&#x3002;&#x8FD9;&#x65F6;Barrier&#x5C31;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x89E3;&#x51B3;&#x8FD9;&#x95EE;&#x9898;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!--barrier--&gt;</span><br><span class=\"line\">&lt;TextView</span><br><span class=\"line\">    android:id=&quot;@+id/tv1&quot;</span><br><span class=\"line\">    android:layout_width=&quot;150dp&quot;</span><br><span class=\"line\">    android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">    android:background=&quot;@color/colorPrimary&quot;</span><br><span class=\"line\">    android:padding=&quot;5dp&quot;</span><br><span class=\"line\">    android:text=&quot;tv1&#xFF0C;&#x56FA;&#x5B9A;&#x5BBD;&#x5EA6;&quot;</span><br><span class=\"line\">    android:textColor=&quot;@android:color/white&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;TextView</span><br><span class=\"line\">    android:id=&quot;@+id/tv2&quot;</span><br><span class=\"line\">    android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">    android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">    android:layout_marginTop=&quot;20dp&quot;</span><br><span class=\"line\">    android:background=&quot;@color/colorPrimary&quot;</span><br><span class=\"line\">    android:padding=&quot;5dp&quot;</span><br><span class=\"line\">    android:text=&quot;tv2&#xFF0C;&#x5BBD;&#x5EA6;&#x4E0D;&#x56FA;&#x5B9A;&quot;</span><br><span class=\"line\">    android:textColor=&quot;@android:color/white&quot;</span><br><span class=\"line\">    app:layout_constraintTop_toBottomOf=&quot;@+id/tv1&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;android.support.constraint.Barrier</span><br><span class=\"line\">    android:id=&quot;@+id/barrier&quot;</span><br><span class=\"line\">    android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">    android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">    app:barrierDirection=&quot;end&quot;</span><br><span class=\"line\">    app:constraint_referenced_ids=&quot;tv1,tv2&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;TextView</span><br><span class=\"line\">    android:id=&quot;@+id/tv3&quot;</span><br><span class=\"line\">    android:layout_width=&quot;0dp&quot;</span><br><span class=\"line\">    android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">    android:layout_marginLeft=&quot;5dp&quot;</span><br><span class=\"line\">    android:background=&quot;@color/colorPrimary&quot;</span><br><span class=\"line\">    android:padding=&quot;5dp&quot;</span><br><span class=\"line\">    android:text=&quot;@string/barrier_tv3&quot;</span><br><span class=\"line\">    android:textColor=&quot;@android:color/white&quot;</span><br><span class=\"line\">    app:layout_constraintLeft_toRightOf=&quot;@+id/barrier&quot;</span><br><span class=\"line\">    app:layout_constraintRight_toRightOf=&quot;parent&quot; /&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x5728;Barrier&#x4E2D;&#x6709;&#x4E24;&#x4E2A;&#x5C5E;&#x6027;&#xFF0C;&#x5206;&#x522B;&#x4E3A;:</p>\n<ol>\n<li>barrierDirection&#xFF1A;&#x63A7;&#x5236;&#x5176;&#x65B9;&#x5411;</li>\n<li>constraint_referenced_ids&#xFF1A;&#x7EA6;&#x675F;&#x7684;view&#x7684;&#x53C2;&#x8003;id</li>\n</ol>\n<h3 id=\"Group\"><a href=\"#Group\" class=\"headerlink\" title=\"Group\"></a>Group</h3><p>&#x7EC6;&#x5FC3;&#x7684;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x65E2;&#x7136;ConstraintLayout&#x4E2D;&#x80FD;&#x51CF;&#x5C11;&#x5E03;&#x5C40;&#x7684;&#x5D4C;&#x5957;&#xFF0C;&#x90A3;&#x4E48;&#x5BF9;&#x4E8E;&#x540C;&#x4E00;&#x6A21;&#x5757;&#x7684;UI&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x6574;&#x4F53;&#x64CD;&#x4F5C;&#xFF0C;&#x662F;&#x5426;&#x53EA;&#x80FD;&#x9010;&#x4E00;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF08;&#x663E;&#x9690;&#x64CD;&#x4F5C;&#xFF09;&#xFF1F;ConstraintLayout&#x7ED9;&#x51FA;&#x4E86;&#x5B83;&#x7684;&#x7B54;&#x6848;&#xFF0C;&#x5C31;&#x662F;Group&#x3002;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x5BF9;&#x591A;&#x4E2A;view&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#x64CD;&#x4F5C;&#xFF0C;&#x5F53;&#x7136;&#x5728;&#x5E03;&#x5C40;&#x4E2D;&#x4E5F;&#x662F;&#x4E0D;&#x53EF;&#x89C1;&#x7684;&#x3002;&#x4E3B;&#x8981;&#x5C5E;&#x6027;&#x662F;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">constraint_referenced_ids: &#x7EA6;&#x675F;&#x7684;view&#x7684;&#x53C2;&#x8003;id</span><br></pre></td></tr></table></figure>\n<p>&#x5C31;&#x62FF;&#x4E0A;&#x9762;Barrier&#x7684;&#x793A;&#x4F8B;&#x6765;&#x8BF4;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!--group &#x901A;&#x8FC7;&#x8BBE;&#x7F6E;&#x5173;&#x8054;id&#x6765;&#x63A7;&#x5236;&#x5B83;&#x4EEC;&#x7684;&#x663E;&#x9690;--&gt;</span><br><span class=\"line\">&lt;android.support.constraint.Group</span><br><span class=\"line\">    android:id=&quot;@+id/group&quot;</span><br><span class=\"line\">    android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">    android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">    android:visibility=&quot;visible&quot;</span><br><span class=\"line\">    app:constraint_referenced_ids=&quot;tv1,tv2&quot; /&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x52A0;&#x4E86;&#x5982;&#x4E0A;&#x4EE3;&#x7801;&#xFF0C;&#x90A3;&#x4E48;&#x5BF9;group&#x8FDB;&#x884C;VISIBLE&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x5BF9;&#x540C;&#x65F6;&#x4F5C;&#x7528;&#x4E8E;tv1&#x4E0E;tv2&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis/blob/master/app/src/main/res/layout/activity_constraint_layout_barrier_group.xml\" target=\"_blank\" rel=\"noopener\">&#x70B9;&#x51FB;&#x67E5;&#x770B;&#x6E90;&#x7801;</a></p>\n<h2 id=\"other\"><a href=\"#other\" class=\"headerlink\" title=\"other\"></a>other</h2><p>&#x4E0B;&#x9762;&#x6765;&#x8BF4;&#x4E00;&#x4E0B;&#x4F7F;&#x7528;ConstraintLayout&#x65F6;&#xFF0C;&#x4E00;&#x4E9B;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x70B9;&#x3002;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x4F60;&#x5728;&#x4F7F;&#x7528;&#x505A;&#x5C11;&#x8D70;&#x5F2F;&#x8DEF;&#x3002;</p>\n<h3 id=\"wrap-content\"><a href=\"#wrap-content\" class=\"headerlink\" title=\"wrap_content\"></a>wrap_content</h3><p>&#x5982;&#x679C;&#x4F60;&#x7684;View&#x4E2D;&#x5BF9;&#x5BBD;&#x9AD8;&#x4F7F;&#x7528;&#x4E86;wrap_content&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x8981;&#x65F6;&#x523B;&#x6CE8;&#x610F;&#xFF0C;&#x5B83;&#x7684;&#x7EA6;&#x675F;&#x53EF;&#x80FD;&#x5E76;&#x4E0D;&#x4F1A;&#x5F88;&#x597D;&#x7684;&#x751F;&#x6548;&#x3002;&#x4F8B;&#x5982;&#x5982;&#x4E0B;&#x5B9E;&#x4F8B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!--&#x5F53;&#x4E3A;wrap_content&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x5F3A;&#x5236;&#x7EA6;&#x675F;--&gt;</span><br><span class=\"line\">&lt;!--app:layout_constrainedWidth=&#x201D;true|false&#x201D;--&gt;</span><br><span class=\"line\">&lt;!--app:layout_constrainedHeight=&#x201D;true|false&#x201D;--&gt;</span><br><span class=\"line\">&lt;!--android:minWidth--&gt;</span><br><span class=\"line\">&lt;!--android:minHeight--&gt;</span><br><span class=\"line\">&lt;!--android:maxWidth--&gt;</span><br><span class=\"line\">&lt;!--android:maxHeight--&gt;</span><br><span class=\"line\">&lt;TextView</span><br><span class=\"line\">    android:id=&quot;@+id/tv1&quot;</span><br><span class=\"line\">    android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">    android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">    android:background=&quot;@color/colorPrimary&quot;</span><br><span class=\"line\">    android:padding=&quot;10dp&quot;</span><br><span class=\"line\">    android:text=&quot;tv1&quot;</span><br><span class=\"line\">    android:textColor=&quot;@android:color/white&quot; /&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;TextView</span><br><span class=\"line\">    android:id=&quot;@+id/tv2&quot;</span><br><span class=\"line\">    android:layout_width=&quot;wrap_content&quot;</span><br><span class=\"line\">    android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">    android:layout_marginLeft=&quot;10dp&quot;</span><br><span class=\"line\">    android:background=&quot;@color/colorPrimary&quot;</span><br><span class=\"line\">    android:padding=&quot;10dp&quot;</span><br><span class=\"line\">    android:text=&quot;@string/other_tv2&quot;</span><br><span class=\"line\">    android:textColor=&quot;@android:color/white&quot;</span><br><span class=\"line\">    app:layout_constrainedWidth=&quot;true&quot;</span><br><span class=\"line\">    app:layout_constraintLeft_toRightOf=&quot;@+id/tv1&quot;</span><br><span class=\"line\">    app:layout_constraintRight_toRightOf=&quot;parent&quot; /&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2018/05/03/ConstraintLayout&#x4F7F;&#x7528;&#x6C47;&#x603B;/10.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p>&#x5982;&#x679C;&#x5C06;app:layout_constrainedWidth=&#x201D;true&#x201D;&#x8FD9;&#x884C;&#x4EE3;&#x7801;&#x5220;&#x9664;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x5C06;&#x4F1A;&#x770B;&#x5230;&#x5982;&#x4E0B;&#x6548;&#x679C;</p>\n<p><img src=\"/2018/05/03/ConstraintLayout&#x4F7F;&#x7528;&#x6C47;&#x603B;/9.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<blockquote>\n<p>&#x5728;&#x4EE3;&#x7801;&#x6CE8;&#x91CA;&#x4E2D;&#x5DF2;&#x7ECF;&#x8BF4;&#x660E;&#xFF0C;&#x5728;&#x4F7F;&#x7528;wrap_content&#x65F6;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;minWith&#x7B49;&#x5C5E;&#x6027;&#x3002;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x4E3A; min/max &gt; constraintWith/Height</p>\n</blockquote>\n<h3 id=\"MATCH-CONSTRAIN\"><a href=\"#MATCH-CONSTRAIN\" class=\"headerlink\" title=\"MATCH_CONSTRAIN\"></a>MATCH_CONSTRAIN</h3><p>&#x5F53;&#x4F7F;&#x7528;&#x4E86;MATCH_CONSTRAIN&#xFF0C;&#x5373;0dp&#x6765;&#x5C55;&#x793A;&#x5BBD;&#x9AD8;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x65B9;&#x5F0F;&#x6765;&#x8FDB;&#x884C;&#x7EA6;&#x675F;&#x76F8;&#x5E94;&#x5BBD;&#x9AD8;&#x503C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!--&#x5F53;&#x4E3A;MATCH_CONSTRAINT &#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x8BBE;&#x7F6E;&#x6765;&#x7EA6;&#x675F;&#x5BBD;&#x9AD8;--&gt;</span><br><span class=\"line\">&lt;!--layout_constraintWidth_min and layout_constraintHeight_min--&gt;</span><br><span class=\"line\">&lt;!--layout_constraintWidth_max and layout_constraintHeight_max--&gt;</span><br><span class=\"line\">&lt;!--layout_constraintWidth_percent and layout_constraintHeight_percent--&gt;</span><br><span class=\"line\">&lt;!--android:minWidth--&gt;</span><br><span class=\"line\">&lt;!--android:minHeight--&gt;</span><br><span class=\"line\">&lt;!--android:maxWidth--&gt;</span><br><span class=\"line\">&lt;!--android:maxHeight--&gt;</span><br><span class=\"line\">&lt;TextView</span><br><span class=\"line\">    android:id=&quot;@+id/tv3&quot;</span><br><span class=\"line\">    android:layout_width=&quot;0dp&quot;</span><br><span class=\"line\">    android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">    android:layout_marginTop=&quot;50dp&quot;</span><br><span class=\"line\">    android:background=&quot;@color/colorPrimary&quot;</span><br><span class=\"line\">    android:padding=&quot;10dp&quot;</span><br><span class=\"line\">    android:text=&quot;tv3&quot;</span><br><span class=\"line\">    android:textColor=&quot;@android:color/white&quot;</span><br><span class=\"line\">    app:layout_constraintTop_toBottomOf=&quot;@+id/tv1&quot;</span><br><span class=\"line\">    app:layout_constraintWidth_percent=&quot;0.5&quot; /&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2018/05/03/ConstraintLayout&#x4F7F;&#x7528;&#x6C47;&#x603B;/11.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p>&#x5982;&#x679C;&#x5C06;app:layout_constraintWidth_percent=&#x201D;0.5&#x201D;&#x53BB;&#x6389;&#x7684;&#x8BDD;&#xFF0C;&#x4F60;&#x5C06;&#x770B;&#x5230;&#x5982;&#x4E0B;&#x6548;&#x679C;&#xFF1A;</p>\n<p><img src=\"/2018/05/03/ConstraintLayout&#x4F7F;&#x7528;&#x6C47;&#x603B;/12.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<blockquote>\n<p>&#x6CE8;&#x610F;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x4E3A;parent &gt; min/max &gt; constraint_min/max</p>\n</blockquote>\n<h3 id=\"Ratio\"><a href=\"#Ratio\" class=\"headerlink\" title=\"Ratio\"></a>Ratio</h3><p>&#x5982;&#x679C;&#x4F60;&#x7684;&#x9700;&#x8981;&#x662F;&#x5BF9;View&#x8FDB;&#x884C;&#x56FA;&#x5B9A;&#x5BBD;&#x9AD8;&#x6BD4;&#x5C55;&#x793A;&#x65F6;&#xFF0C;&#x90A3;&#x4E48;Ratio&#x7684;&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#x5C06;&#x975E;&#x5E38;&#x9002;&#x5408;&#x4F60;&#x3002;&#x4F60;&#x53EA;&#x9700;&#x8BBE;&#x7F6E;&#x5B83;&#x7684;layout_constraintDimensionRatio&#x5C5E;&#x6027;&#x5373;&#x53EF;&#x3002;</p>\n<p>&#x5982;&#x679C;layout_width&#x4E0E;layout_height&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x4E3A;MATCH_CONSTRAIN&#xFF08;0dp&#xFF09;, MATCH_CONSTRAIN&#xFF08;0dp&#xFF09;&#x7684;&#x503C;&#x5C06;&#x6839;&#x636E;layout_constraintDimensionRatio&#x6240;&#x8BBE;&#x7684;&#x503C;&#x6765;&#x8BA1;&#x7B97;&#xFF08;w:h&#xFF09;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;TextView</span><br><span class=\"line\">    android:id=&quot;@+id/tv4&quot;</span><br><span class=\"line\">    android:layout_width=&quot;0dp&quot;</span><br><span class=\"line\">    android:layout_height=&quot;wrap_content&quot;</span><br><span class=\"line\">    android:layout_marginTop=&quot;50dp&quot;</span><br><span class=\"line\">    android:background=&quot;@color/colorPrimary&quot;</span><br><span class=\"line\">    android:padding=&quot;10dp&quot;</span><br><span class=\"line\">    android:text=&quot;tv4&quot;</span><br><span class=\"line\">    android:textColor=&quot;@android:color/white&quot;</span><br><span class=\"line\">    app:layout_constraintDimensionRatio=&quot;2:1&quot;</span><br><span class=\"line\">    app:layout_constraintTop_toBottomOf=&quot;@+id/tv3&quot; /&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2018/05/03/ConstraintLayout&#x4F7F;&#x7528;&#x6C47;&#x603B;/13.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p>&#x5982;&#x679C;layout_width&#x4E0E;layout_height&#x90FD;&#x4E3A;MATCH_CONSTRAIN&#xFF08;0dp&#xFF09;, &#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x5BF9;layout_constraintDimensionRatio&#x6DFB;&#x52A0;&#x524D;&#x7F00;W/H&#xFF08;H&#xFF0C;w:h&#xFF0C;&#x6765;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x5BBD;&#x9AD8;&#x65B9;&#x5411;&#x7684;&#x7EA6;&#x675F;&#xFF0C;&#x4ECE;&#x800C;&#x5F62;&#x6210;&#x6BD4;&#x4F8B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;TextView</span><br><span class=\"line\">    android:id=&quot;@+id/tv5&quot;</span><br><span class=\"line\">    android:layout_width=&quot;0dp&quot;</span><br><span class=\"line\">    android:layout_height=&quot;0dp&quot;</span><br><span class=\"line\">    android:layout_marginTop=&quot;50dp&quot;</span><br><span class=\"line\">    android:background=&quot;@color/colorPrimary&quot;</span><br><span class=\"line\">    android:padding=&quot;10dp&quot;</span><br><span class=\"line\">    android:text=&quot;tv5&quot;</span><br><span class=\"line\">    android:textColor=&quot;@android:color/white&quot;</span><br><span class=\"line\">    app:layout_constraintBottom_toBottomOf=&quot;parent&quot;</span><br><span class=\"line\">    app:layout_constraintDimensionRatio=&quot;H,3:1&quot;</span><br><span class=\"line\">    app:layout_constraintTop_toBottomOf=&quot;@+id/tv4&quot; /&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2018/05/03/ConstraintLayout&#x4F7F;&#x7528;&#x6C47;&#x603B;/14.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p>&#x6839;&#x636E;&#x6548;&#x679C;&#x56FE;&#x5C55;&#x793A;&#x7684;&#x5BBD;&#x9AD8;&#x6BD4;&#x4E3A;1:3&#x3002;&#x5373;&#x5BF9;&#x5E94;&#x4E86;H,3:1&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis/blob/master/app/src/main/res/layout/activity_constraint_layout_other.xml\" target=\"_blank\" rel=\"noopener\">&#x70B9;&#x51FB;&#x67E5;&#x770B;&#x6E90;&#x7801;</a></p>\n<h2 id=\"End\"><a href=\"#End\" class=\"headerlink\" title=\"End\"></a>End</h2><p>&#x5230;&#x8FD9;&#x91CC;ConstraintLayout&#x7684;&#x4F7F;&#x7528;&#x5168;&#x90E8;&#x4ECB;&#x7ECD;&#x5B8C;&#x6BD5;&#xFF0C;&#x5E0C;&#x671B;&#x80FD;&#x6709;&#x6240;&#x4F5C;&#x7528;&#x4E0E;&#x5E2E;&#x52A9;&#x3002;&#x5982;&#x6709;&#x4E0D;&#x8DB3;&#x4E4B;&#x5904;&#x6B22;&#x8FCE;&#x6307;&#x51FA;&#xFF0C;&#x8C22;&#x8C22;&#xFF01;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">&#x70B9;&#x51FB;&#x8DF3;&#x8F6C;&#x5230;&#x9879;&#x76EE;&#x5730;&#x5740;</a></p>\n<h2 id=\"&#x5173;&#x6CE8;\"><a href=\"#&#x5173;&#x6CE8;\" class=\"headerlink\" title=\"&#x5173;&#x6CE8;\"></a>&#x5173;&#x6CE8;</h2><p><img src=\"/2018/05/03/ConstraintLayout&#x4F7F;&#x7528;&#x6C47;&#x603B;/wx.jpg\" alt=\"&#x602A;&#x8C08;&#x65F6;&#x95F4;&#x5230;&#x4E86;\"></p>\n","categories":["android"],"tags":["ConstraintLayout"]},{"title":"Bitmap的图片压缩汇总","url":"https://www.rousetime.com/2018/03/21/Bitmap的图片压缩汇总/","content":"<h2 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h2><p>Bitmap&#x662F;Android&#x4E2D;&#x4E00;&#x79CD;&#x91CD;&#x8981;&#x7684;&#x56FE;&#x7247;&#x5904;&#x7406;&#x673A;&#x5236;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x83B7;&#x53D6;&#x56FE;&#x7247;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#xFF0C;&#x540C;&#x65F6;&#x53EF;&#x4EE5;&#x5BF9;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x88C1;&#x526A;&#x3001;&#x7F29;&#x653E;&#x7B49;&#x64CD;&#x4F5C;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x56FE;&#x7247;&#x683C;&#x5F0F;&#x8FDB;&#x884C;&#x4FDD;&#x5B58;&#x3002;&#x76F8;&#x4FE1;&#x5BF9;&#x4E8E;OOM&#x518D;&#x719F;&#x6089;&#x4E0D;&#x8FC7;&#x4E86;&#xFF0C;OOM&#x7684;&#x4EA7;&#x751F;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x5934;&#x75BC;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x52A0;&#x8F7D;&#x56FE;&#x7247;&#x7684;&#x65F6;&#x5019;&#x672A;&#x5BF9;&#x5927;&#x56FE;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x5B83;&#x5C06;&#x4F1A;&#x5360;&#x7528;&#x975E;&#x5E38;&#x5927;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x4EA7;&#x751F;OOM&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x8981;&#x6709;&#x610F;&#x8BC6;&#x7684;&#x5BF9;&#x5927;&#x56FE;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#x52A0;&#x8F7D;&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x80FD;&#x66F4;&#x597D;&#x7684;&#x4FDD;&#x8BC1;App&#x7684;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#x4E0E;&#x6027;&#x80FD;&#x7684;&#x7A33;&#x5B9A;&#x3002;</p>\n<h2 id=\"Bitmap&#x5927;&#x5C0F;&#x8BA1;&#x7B97;\"><a href=\"#Bitmap&#x5927;&#x5C0F;&#x8BA1;&#x7B97;\" class=\"headerlink\" title=\"Bitmap&#x5927;&#x5C0F;&#x8BA1;&#x7B97;\"></a>Bitmap&#x5927;&#x5C0F;&#x8BA1;&#x7B97;</h2><p>&#x90A3;&#x4E48;&#x5982;&#x679C;&#x8BA1;&#x7B97;&#x4E00;&#x5F20;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x8FC7;&#x7A0B;&#x4E2D;&#x6240;&#x5360;&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x5462;&#xFF1F;&#x5728;&#x8FD9;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x5173;&#x4E8E;Bitmap&#x4E24;&#x4E2A;&#x4E3B;&#x8981;&#x914D;&#x7F6E;&#x3002;</p>\n<h3 id=\"CompressFormat\"><a href=\"#CompressFormat\" class=\"headerlink\" title=\"CompressFormat\"></a>CompressFormat</h3><p>&#x8FD9;&#x662F;&#x7528;&#x6765;&#x6307;&#x5B9A;Bitmap&#x7684;&#x56FE;&#x7247;&#x7684;&#x538B;&#x7F29;&#x683C;&#x5F0F;&#xFF0C;&#x5728;Bitmap&#x4E2D;&#x662F;&#x4E00;&#x4E2A;Enum&#x7ED3;&#x6784;&#xFF0C;&#x4E3B;&#x8981;&#x8868;&#x73B0;&#x4E3A;&#x4EE5;&#x4E0B;&#x4E09;&#x79CD;&#x683C;&#x5F0F;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public enum CompressFormat {</span><br><span class=\"line\">    JPEG    (0),</span><br><span class=\"line\">    PNG     (1),</span><br><span class=\"line\">    WEBP    (2);</span><br><span class=\"line\"></span><br><span class=\"line\">    CompressFormat(int nativeInt) {</span><br><span class=\"line\">        this.nativeInt = nativeInt;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    final int nativeInt;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<ul>\n<li>JPEG: &#x4EE5;JPEG&#x7B97;&#x6CD5;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#xFF0C;&#x538B;&#x7F29;&#x540E;&#x7684;&#x56FE;&#x7247;&#x683C;&#x5F0F;&#x53EF;&#x4EE5;&#x4E3A;.jpeg&#x6216;&#x8005;.jpg&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x6709;&#x635F;&#x538B;&#x7F29;&#xFF0C;&#x6CA1;&#x6709;&#x900F;&#x660E;&#x5EA6;&#x3002;</li>\n<li>PNG&#xFF1A;&#x4EE5;PNG&#x7B97;&#x6CD5;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#xFF0C;&#x538B;&#x7F29;&#x540E;&#x7684;&#x56FE;&#x7247;&#x683C;&#x5F0F;&#x662F;.png&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x65E0;&#x635F;&#x538B;&#x7F29;&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x900F;&#x660E;&#x5EA6;&#x3002;</li>\n<li>WEBP&#xFF1A;&#x4EE5;WEBP&#x7B97;&#x6CD5;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#xFF0C;&#x538B;&#x7F29;&#x540E;&#x7684;&#x56FE;&#x7247;&#x683C;&#x5F0F;&#x662F;.webp&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x6709;&#x635F;&#x538B;&#x7F29;&#x3002;&#x76F8;&#x540C;&#x8D28;&#x91CF;&#x4E0B;&#xFF0C;webp&#x6BD4;jpeg&#x56FE;&#x50CF;&#x5C0F;40%&#xFF0C;&#x4F46;webp&#x56FE;&#x7247;&#x7684;&#x7F16;&#x7801;&#x65F6;&#x95F4;&#x6BD4;jpeg&#x957F;8&#x500D;&#x3002;</li>\n</ul>\n<h3 id=\"Config\"><a href=\"#Config\" class=\"headerlink\" title=\"Config\"></a>Config</h3><p>&#x8FD9;&#x662F;&#x5173;&#x4E8E;Bitmap&#x50CF;&#x7D20;&#x5B58;&#x50A8;&#x7684;&#x65B9;&#x5F0F;&#x914D;&#x7F6E;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x50CF;&#x7D20;&#x5B58;&#x50A8;&#xFF0C;&#x5BF9;&#x56FE;&#x7247;&#x7684;&#x8D28;&#x91CF;&#x4E5F;&#x4F1A;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x5F71;&#x54CD;&#x3002;&#x5728;Bitmap&#x4E2D;&#x662F;&#x4E00;&#x4E2A;Enum&#x7ED3;&#x6784;&#xFF0C;&#x4E3B;&#x8981;&#x8868;&#x73B0;&#x4E8E;&#x4EE5;&#x4E0B;&#x56DB;&#x79CD;&#x683C;&#x5F0F;&#x3002;</p>\n<ul>\n<li>ALPHA_8&#xFF1A;&#x6BCF;&#x4E00;&#x4E2A;&#x50CF;&#x7D20;&#x90FD;&#x53EA;&#x50A8;&#x5B58;&#x5355;&#x4E00;&#x7684;&#x900F;&#x660E;&#x5EA6;&#xFF0C;&#x5373;&#x53EA;&#x6709;&#x900F;&#x660E;&#x5EA6;&#xFF0C;&#x603B;&#x5171;&#x5360;8&#x4F4D;&#xFF0C;1&#x5B57;&#x8282;&#x3002;</li>\n<li>ARGB_4444&#xFF1A;&#x6BCF;&#x4E00;&#x4E2A;&#x50CF;&#x7D20;&#x90FD;&#x4EE5;A&#xFF08;&#x900F;&#x660E;&#x5EA6;&#xFF09;R&#xFF08;Red&#xFF09;G&#xFF08;Green&#xFF09;B&#xFF08;Blue&#xFF09;&#x56DB;&#x90E8;&#x5206;&#x7EC4;&#x6210;&#xFF0C;&#x6BCF;&#x90E8;&#x5206;&#x5360;4&#x4F4D;&#xFF0C;&#x603B;&#x5171;&#x5360;16&#x4F4D;&#xFF0C;2&#x5B57;&#x8282;&#x3002;&#x7531;&#x4E8E;&#x8FD9;&#x79CD;&#x683C;&#x5F0F;&#x7684;&#x56FE;&#x7247;&#x8D28;&#x91CF;&#x592A;&#x5DEE;&#xFF0C;&#x6240;&#x4EE5;&#x4E2D;API 13&#x5C31;&#x5DF2;&#x7ECF;&#x5E9F;&#x5F03;&#x4E86;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;ARGB_8888&#x3002;</li>\n<li>ARGB_8888&#xFF1A;&#x6BCF;&#x4E00;&#x4E2A;&#x50CF;&#x7D20;&#x90FD;&#x4EE5;A&#xFF08;&#x900F;&#x660E;&#x5EA6;&#xFF09;R&#xFF08;Red&#xFF09;G&#xFF08;Green&#xFF09;B&#xFF08;Blue&#xFF09;&#x56DB;&#x90E8;&#x5206;&#x7EC4;&#x6210;&#xFF0C;&#x6BCF;&#x90E8;&#x5206;&#x5360;8&#x4F4D;&#xFF0C;&#x603B;&#x5171;32&#x4F4D;&#xFF0C;4&#x5B57;&#x8282;&#x3002;</li>\n<li>RGB_565&#xFF1A;&#x6BCF;&#x4E00;&#x4E2A;&#x50CF;&#x7D20;&#x90FD;&#x4EE5;R&#xFF08;Red&#xFF09;G&#xFF08;Green&#xFF09;B&#xFF08;Blue&#xFF09;&#x4E09;&#x90E8;&#x5206;&#x7EC4;&#x6210;&#xFF0C;&#x5404;&#x4E2A;&#x90E8;&#x5206;&#x5206;&#x522B;&#x5360;5&#x4F4D;&#xFF0C;6&#x4F4D;&#xFF0C;5&#x4F4D;&#xFF0C;&#x603B;&#x5171;16&#x4F4D;&#xFF0C;2&#x5B57;&#x8282;&#x3002;</li>\n</ul>\n<p>&#x6240;&#x4EE5;&#x5982;&#x679C;&#x4E3A;&#x4E86;&#x9632;&#x6B62;OOM&#x5BF9;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x4F7F;&#x7528;RGB_565&#x683C;&#x5F0F;&#xFF0C;&#x56E0;&#x4E3A;ALPHA_8&#x53EA;&#x6709;&#x900F;&#x660E;&#x5EA6;&#xFF0C;&#x5BF9;&#x4E8E;&#x6B63;&#x5E38;&#x56FE;&#x7247;&#x672A;&#x610F;&#x4E49;&#xFF1B;ARGB_4444&#x663E;&#x793A;&#x7684;&#x56FE;&#x7247;&#x8D28;&#x91CF;&#x592A;&#x5DEE;&#xFF1B;ARGB_8888&#x5360;&#x7528;&#x7684;&#x5185;&#x5B58;&#x6700;&#x591A;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x52A0;&#x8F7D;&#x7684;&#x56FE;&#x7247;&#x7684;&#x5BBD;&#x5EA6;&#x4E3A;1080&#x3001;&#x9AD8;&#x5EA6;&#x4E3A;675&#x3001;Config&#x4E3A;ARGB_8888&#x3002;&#x90A3;&#x4E48;&#x5B83;&#x5360;&#x7684;&#x5185;&#x5B58;&#x4E3A;&#xFF1A;1080 x 675 x 4 = 2916000.&#x6298;&#x7B97;&#x6210;M&#x4E3A;2916000 / 1024 / 1024 = 2.78M&#x3002;&#x4E00;&#x79CD;&#x56FE;&#x7247;&#x5C31;&#x8FD1;3M&#xFF0C;&#x5982;&#x679C;&#x52A0;&#x8F7D;10&#x5F20;&#x6216;&#x8005;100&#x5F20;&#xFF0C;&#x6240;&#x5360;&#x7684;&#x5185;&#x5B58;&#x53EF;&#x60F3;&#x800C;&#x77E5;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#x4F1A;&#x5F88;&#x5BB9;&#x6613;&#x5C06;&#x5185;&#x5B58;&#x6D88;&#x8017;&#x6B86;&#x5C3D;&#xFF0C;&#x540C;&#x65F6;&#x5BF9;&#x4E8E;Android App&#x6765;&#x8BF4;&#x6839;&#x672C;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x8FD9;&#x4E48;&#x9AD8;&#x6E05;&#x7684;&#x56FE;&#x7247;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5728;&#x52A0;&#x8F7D;&#x56FE;&#x7247;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;&#x5BF9;&#x5BBD;&#x9AD8;&#x8FDB;&#x884C;&#x7F29;&#x653E;&#xFF0C;&#x4EA6;&#x6216;&#x8005;&#x5C06;Config&#x6539;&#x6211;RGB_565&#x3002;&#x8FD9;&#x6837;&#x4E0D;&#x4EC5;&#x6709;&#x6548;&#x7684;&#x51CF;&#x5C0F;&#x4E86;&#x5185;&#x5B58;&#x7684;&#x5360;&#x7528;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x4E0D;&#x5F71;&#x54CD;&#x56FE;&#x7247;&#x7684;&#x6E05;&#x6670;&#x5EA6;&#x7684;&#x5C55;&#x793A;&#x3002;</p>\n<blockquote>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x5982;&#x4F55;&#x901A;&#x8FC7;Bitmap&#x4E0E;BitmapFactory&#x6765;&#x5BF9;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x5904;&#x7406;</p>\n</blockquote>\n<h2 id=\"Bitmap&#x76F8;&#x5173;\"><a href=\"#Bitmap&#x76F8;&#x5173;\" class=\"headerlink\" title=\"Bitmap&#x76F8;&#x5173;\"></a>Bitmap&#x76F8;&#x5173;</h2><p>&#x5BF9;&#x4E8E;&#x4F7F;&#x7528;Bitmap&#x8FDB;&#x884C;&#x56FE;&#x7247;&#x7684;&#x538B;&#x7F29;&#x5904;&#x7406;&#xFF0C;&#x5B83;&#x4E3B;&#x8981;&#x63D0;&#x4F9B;&#x4E86;&#x4EE5;&#x4E0B;&#x6709;&#x6548;&#x65B9;&#x6CD5;&#x3002;</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">status return</th>\n<th style=\"text-align:center\">method name</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">boolean</td>\n<td style=\"text-align:center\">compress(Bitmap.CompressFormat format, int quality, OutputStream stream)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">createBitmap(DisplayMetrics display, int[] colors, int width, int height, Bitmap.Config config)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">createBitmap(DisplayMetrics display, int[] colors, int offset, int stride, int width, int height, Bitmap.Config config)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">createBitmap(Bitmap source, int x, int y, int width, int height)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">createBitmap(Bitmap src)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">createBitmap(DisplayMetrics display, int width, int height, Bitmap.Config config)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">createBitmap(Bitmap source, int x, int y, int width, int height, Matrix m, boolean filter)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">createBitmap(int width, int height, Bitmap.Config config)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">createBitmap(int[] colors, int offset, int stride, int width, int height, Bitmap.Config config)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitamp</td>\n<td style=\"text-align:center\">createBitmap(int[] colors, int width, int height, Bitmap.Config config)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">createScaledBitmap(Bitmap src, int dstWidth, int dstHeight, boolean filter)</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"compress\"><a href=\"#compress\" class=\"headerlink\" title=\"compress\"></a>compress</h3><p>compress&#x65B9;&#x6CD5;&#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x56FE;&#x7247;&#x7684;CompressFormat&#x683C;&#x5F0F;&#x4E0E;&#x538B;&#x7F29;&#x767E;&#x5206;&#x6BD4;&#x6765;&#x5BF9;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#x5904;&#x7406;&#xFF0C;&#x540C;&#x65F6;&#x5C06;&#x538B;&#x7F29;&#x7684;&#x56FE;&#x7247;&#x4FDD;&#x5B58;&#x5230;&#x6307;&#x5B9A;&#x7684;outputStream&#x4E2D;&#x3002;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x5177;&#x4F53;&#x7528;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val fs = FileOutputStream(path)</span><br><span class=\"line\">val out = ByteArrayOutputStream()</span><br><span class=\"line\">scaleBitmap.compress(Bitmap.CompressFormat.JPEG, 30, out)</span><br><span class=\"line\">LogUtils.d(&quot;compressBitmap jpeg of byteCount %d.&quot;, out.toByteArray().size)</span><br><span class=\"line\">fs.write(out.toByteArray())</span><br><span class=\"line\">fs.close()</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x8981;&#x6CE8;&#x610F;quality&#x4EE3;&#x8868;&#x767E;&#x5206;&#x6BD4;&#xFF0C;&#x503C;&#x4E3A;0~100&#xFF0C;&#x503C;&#x8D8A;&#x5C0F;&#x538B;&#x7F29;&#x7684;&#x540E;&#x7684;&#x5927;&#x5C0F;&#x5C31;&#x8D8A;&#x5C0F;&#x3002;&#x4F8B;&#x5982;&#x4E0A;&#x9762;&#x7684;&#x793A;&#x4F8B;&#xFF0C;quality&#x4E3A;30&#xFF0C;&#x5219;&#x4EE3;&#x8868;&#x5BF9;&#x539F;&#x56FE;&#x8FDB;&#x884C;&#x538B;&#x7F29;70%&#xFF0C;&#x4FDD;&#x7559;30%&#x3002;&#x540C;&#x65F6;Bitmap.CompressFormat&#x5728;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E86;&#xFF0C;&#x8981;&#x6CE8;&#x610F;&#x4E0D;&#x540C;&#x7684;&#x683C;&#x5F0F;&#x56FE;&#x7247;&#x7684;&#x5C55;&#x793A;&#x6548;&#x679C;&#x4E5F;&#x4E0D;&#x540C;&#xFF0C;&#x4F8B;&#x5982;JPEG&#x7684;&#x683C;&#x5F0F;&#x56FE;&#x7247;&#x662F;&#x6CA1;&#x6709;&#x900F;&#x660E;&#x5EA6;&#x7684;&#x3002;</p>\n<blockquote>\n<p>&#x7279;&#x522B;&#x6CE8;&#x610F;&#x7684;&#xFF1A;&#x5BF9;&#x4E8E;Bitmap.CompressFormat.PNG&#x7C7B;&#x578B;&#x7684;&#x683C;&#x5F0F;&#xFF0C;quality&#x5C06;&#x5931;&#x53BB;&#x6548;&#x679C;&#xFF0C;&#x56E0;&#x4E3A;&#x5176;&#x683C;&#x5F0F;&#x662F;&#x65E0;&#x635F;&#x7684;&#x538B;&#x7F29;&#xFF1B;&#x518D;&#x8005;&#xFF0C;&#x4F7F;&#x7528;compress&#x65B9;&#x6CD5;&#x5E76;&#x4E0D;&#x662F;&#x5BF9;&#x663E;&#x793A;&#x5904;&#x7406;&#x7684;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x4E86;&#x538B;&#x7F29;&#xFF0C;&#x5B83;&#x53EA;&#x662F;&#x5BF9;&#x539F;&#x56FE;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#x540E;&#x4FDD;&#x5B58;&#x5230;&#x672C;&#x5730;&#x78C1;&#x76D8;&#x4E2D;&#xFF0C;&#x5E76;&#x4E0D;&#x6539;&#x53D8;&#x663E;&#x793A;&#x7684;&#x56FE;&#x7247;&#x3002;&#x4E3B;&#x8981;&#x7528;&#x9014;&#x4F5C;&#x7528;&#x4E8E;&#x4FDD;&#x5B58;&#x56FE;&#x7247;&#x5230;&#x672C;&#x5730;&#xFF0C;&#x4EE5;&#x4FBF;&#x4E0B;&#x6B21;&#x52A0;&#x8F7D;&#xFF0C;&#x51CF;&#x5C0F;&#x56FE;&#x7247;&#x5728;&#x672C;&#x5730;&#x78C1;&#x76D8;&#x6240;&#x5360;&#x7684;&#x78C1;&#x76D8;&#x5927;&#x5C0F;&#x3002;</p>\n</blockquote>\n<h3 id=\"createBitmap\"><a href=\"#createBitmap\" class=\"headerlink\" title=\"createBitmap\"></a>createBitmap</h3><p>&#x5BF9;&#x4E8E;createBitmap&#x65B9;&#x6CD5;&#xFF0C;Bitmap&#x4E2D;&#x63D0;&#x4F9B;&#x4E86;9&#x79CD;&#x4E0D;&#x540C;&#x6570;&#x636E;&#x6E90;&#x7684;&#x538B;&#x7F29;&#x5904;&#x7406;&#x65B9;&#x6CD5;&#x3002;&#x5206;&#x522B;&#x6709;&#x901A;&#x8FC7;colors&#x6570;&#x7EC4;&#x3001;Bitmap&#x4E0E;DisplayMetrics&#x7B49;&#x6765;&#x51B3;&#x5B9A;&#x3002;</p>\n<p>&#x4F8B;&#x5982;&#x4F7F;&#x7528;colors&#x6570;&#x7EC4;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val colors = intArrayOf(Color.RED, Color.GREEN, Color.BLUE,</span><br><span class=\"line\">                        Color.GREEN, Color.BLUE, Color.RED,</span><br><span class=\"line\">                        Color.BLUE, Color.RED, Color.GREEN)</span><br><span class=\"line\">val displayMetricsBitmap = Bitmap.createBitmap(DisplayMetrics(),colors,3, 3,Bitmap.Config.ARGB_8888)</span><br><span class=\"line\">LogUtils.d(&quot;displayMetricsBitmap of byteCount %d and rowBytes %d&quot;, displayMetricsBitmap.byteCount, displayMetricsBitmap.rowBytes)</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;3 x 3&#x7684;&#x56FE;&#x7247;&#xFF0C;Config&#x4E3A;ARGB_8888&#xFF0C;&#x6240;&#x4EE5;&#x6700;&#x7EC8;&#x56FE;&#x7247;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x5927;&#x5C0F;&#x4E3A;3 x 3 x 4 = 36&#x5B57;&#x8282;&#x3002;&#x800C;&#x56FE;&#x7247;&#x7684;&#x5C55;&#x793A;&#x6548;&#x679C;&#x662F;&#x901A;&#x8FC7;colors&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x989C;&#x8272;&#x4E5F;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;3 x 3 = 9 &#x5206;&#x522B;&#x5BF9;&#x5E94;colors&#x4E2D;&#x7684;9&#x4E2A;&#x50CF;&#x7D20;&#x70B9;&#x7684;&#x8272;&#x503C;&#x3002;&#x6240;&#x4EE5;colors&#x7684;&#x5927;&#x5C0F;&#x6700;&#x5C0F;&#x5FC5;&#x987B;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;9&#xFF0C;&#x5373;&#x5BBD;*&#x9AD8;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x4E3A;&#x4F55;&#x8BF4;&#x6700;&#x5C0F;&#xFF0C;&#x56E0;&#x4E3A;Bitmap&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;offset&#x4E0E;stride&#x53C2;&#x6570;&#x7684;&#x91CD;&#x8F7D;&#x65B9;&#x6CD5;&#x3002;&#x8FD9;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x5206;&#x522B;&#x4EE3;&#x8868;&#x5728;colors&#x4E2D;&#x7684;&#x5F00;&#x59CB;&#x70B9;&#x7684;&#x504F;&#x79FB;&#x91CF;&#x4E0E;&#x53D6;&#x503C;&#x7684;&#x6B65;&#x4F10;&#xFF0C;&#x5373;&#x6BCF;&#x4E2A;&#x53D6;&#x503C;&#x70B9;&#x95F4;&#x7684;&#x8DE8;&#x5EA6;&#x3002;</p>\n<p>&#x5728;&#x5B9E;&#x9645;&#x662F;&#x4F7F;&#x7528;createBitmap&#x6700;&#x591A;&#x7684;&#x8FD8;&#x662F;&#x7528;&#x5B83;&#x7684;Bitmap&#x91CD;&#x8F7D;&#x65B9;&#x6CD5;&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x6765;&#x5BF9;&#x539F;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x88C1;&#x526A;&#x3002;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x770B;&#x5B83;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//bitmap</span><br><span class=\"line\">val bitmapBitmap = Bitmap.createBitmap(scaleBitmap, 150, 0, 100, 100)</span><br><span class=\"line\">image_view?.setImageBitmap(scaleBitmap)</span><br><span class=\"line\">image_view_text.text = &quot;width: &quot; + scaleBitmap.width + &quot; height: &quot; + scaleBitmap.height</span><br><span class=\"line\">sub_image_view.setImageBitmap(bitmapBitmap)</span><br><span class=\"line\">sub_image_view_text.text = &quot;startX: 150 startY: 0\\n&quot; + &quot;width: &quot; + bitmapBitmap.width + &quot; height: &quot; + bitmapBitmap.height</span><br></pre></td></tr></table></figure>\n<p>&#x4E3B;&#x8981;&#x53C2;&#x6570;&#x662F;&#x539F;Bitmap&#xFF0C;&#x6211;&#x4EEC;&#x6240;&#x6709;&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x5728;&#x539F;Bitmap&#x4E2D;&#x8FDB;&#x884C;&#x7684;&#x3002;&#x5176;&#x4E2D;x = 150&#x3001;y = 0&#x4EE3;&#x8868;&#x4ECE;&#x539F;Bitmap&#x4E2D;&#x7684;&#x5750;&#x6807;&#xFF08;150&#xFF0C;0&#xFF09;&#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x88C1;&#x526A;;width = 100&#x3001;height = 100&#xFF0C;&#x88C1;&#x526A;&#x540E;&#x8FD4;&#x56DE;&#x65B0;&#x7684;&#x7684;Bitmap&#xFF0C;&#x4E14;&#x5927;&#x5C0F;&#x4E3A;100 x 100&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (!source.isMutable() &amp;&amp; x == 0 &amp;&amp; y == 0 &amp;&amp; width == source.getWidth() &amp;&amp;</span><br><span class=\"line\">        height == source.getHeight() &amp;&amp; (m == null || m.isIdentity())) {</span><br><span class=\"line\">    return source;</span><br><span class=\"line\"> }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x6CE8;&#x610F;&#xFF0C;&#x5982;&#x679C;&#x539F;Bitmap&#x662F;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#xFF0C;&#x540C;&#x65F6;&#x9700;&#x8981;&#x7684;&#x56FE;&#x53C2;&#x6570;&#x4E0E;&#x539F;&#x56FE;&#x7247;&#x76F8;&#x540C;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x4F1A;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x539F;Bitmap&#x3002;&#x662F;&#x5426;&#x53EF;&#x53D8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Bitmap.isMutable&#x5224;&#x65AD;&#x3002;</p>\n</blockquote>\n<p>&#x770B;&#x4E0B;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x6240;&#x5C55;&#x793A;&#x7684;&#x6548;&#x679C;&#x56FE;&#xFF1A;<br><img src=\"/2018/03/21/Bitmap&#x7684;&#x56FE;&#x7247;&#x538B;&#x7F29;&#x6C47;&#x603B;/1.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p>&#x6700;&#x540E;&#x901A;&#x8FC7;&#x4F20;&#x9012;Bitmap&#x53C2;&#x6570;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x53C2;&#x6570;Matrix&#xFF0C;&#x5B83;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x5BF9;Bitmap&#x8FDB;&#x884C;&#x77E9;&#x9635;&#x53D8;&#x6362;&#x3002;</p>\n<h3 id=\"createScaledBitmap\"><a href=\"#createScaledBitmap\" class=\"headerlink\" title=\"createScaledBitmap\"></a>createScaledBitmap</h3><p>&#x8BE5;&#x65B9;&#x6CD5;&#x76F8;&#x5BF9;&#x4E0A;&#x9762;&#x4E24;&#x79CD;&#x5C31;&#x7B80;&#x5355;&#x591A;&#x4E86;&#xFF0C;&#x5B83;&#x76EE;&#x7684;&#x662F;&#x5BF9;&#x539F;Bitmap&#x8FDB;&#x884C;&#x6307;&#x5B9A;&#x7684;&#x5BBD;&#x9AD8;&#x8FDB;&#x884C;&#x7F29;&#x653E;&#xFF0C;&#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x65B0;&#x7684;Bitmap&#x3002;</p>\n<blockquote>\n<p>&#x6CE8;&#x610F;&#xFF1A;&#x5982;&#x679C;&#x4F20;&#x5165;&#x7684;&#x5BBD;&#x9AD8;&#x4E0E;&#x539F;Bitmap&#x76F8;&#x540C;&#xFF0C;&#x5B83;&#x5C06;&#x8FD4;&#x56DE;&#x539F;Bitmap&#x5BF9;&#x8C61;&#x3002;</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//createScaledBitmap</span><br><span class=\"line\">val createScaledBitmap = Bitmap.createScaledBitmap(scaleBitmap, 500, 300, false)</span><br><span class=\"line\">image_view?.setImageBitmap(scaleBitmap)</span><br><span class=\"line\">image_view_text.text = &quot;width: &quot; + scaleBitmap.width + &quot; height: &quot; + scaleBitmap.height</span><br><span class=\"line\">sub_image_view.setImageBitmap(createScaledBitmap)</span><br><span class=\"line\">sub_image_view_text.text = &quot;width: &quot; + createScaledBitmap.width + &quot; height: &quot; + createScaledBitmap.height</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2018/03/21/Bitmap&#x7684;&#x56FE;&#x7247;&#x538B;&#x7F29;&#x6C47;&#x603B;/2.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p>&#x518D;&#x6765;&#x770B;&#x4E0B;&#x5176;&#x5B9E;&#x73B0;&#x6E90;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static Bitmap createScaledBitmap(@NonNull Bitmap src, int dstWidth, int dstHeight,</span><br><span class=\"line\">        boolean filter) {</span><br><span class=\"line\">    Matrix m = new Matrix();</span><br><span class=\"line\"> </span><br><span class=\"line\">    final int width = src.getWidth();</span><br><span class=\"line\">    final int height = src.getHeight();</span><br><span class=\"line\">    if (width != dstWidth || height != dstHeight) {</span><br><span class=\"line\">        final float sx = dstWidth / (float) width;</span><br><span class=\"line\">        final float sy = dstHeight / (float) height;</span><br><span class=\"line\">        m.setScale(sx, sy);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return Bitmap.createBitmap(src, 0, 0, width, height, m, filter);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E00;&#x76EE;&#x4E86;&#x7136;&#xFF0C;&#x5185;&#x90E8;&#x5C31;&#x662F;&#x4F7F;&#x7528;&#x5230;&#x4E86;Matrix&#xFF0C;&#x8FD0;&#x7528;Matrix&#x7684;&#x77E5;&#x8BC6;&#x8FDB;&#x884C;&#x5BBD;&#x9AD8;&#x7F29;&#x653E;&#xFF1B;&#x6700;&#x540E;&#x518D;&#x8C03;&#x7528;&#x524D;&#x9762;&#x6240;&#x5206;&#x6790;&#x7684;createBitmap&#x65B9;&#x6CD5;&#x3002;&#x53EA;&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC;&#x6307;&#x5B9A;&#x4E86;&#x521D;&#x59CB;&#x70B9;&#xFF08;0&#xFF0C;0&#xFF09;&#x800C;&#x5DF2;&#xFF0C;&#x518D;&#x4F20;&#x5165;&#x539F;Bitmap&#x7684;&#x5BBD;&#x9AD8;&#x4E0E;&#x751F;&#x6210;&#x7684;Matrix&#x3002;&#x56E0;&#x6B64;createBitmap&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x6CE8;&#x610F;&#x70B9;&#x4E5F;&#x662F;&#x5E94;&#x7528;&#x5230;createScaledBitmap&#x4E2D;&#x3002;</p>\n<h2 id=\"BitmapFactory&#x76F8;&#x5173;\"><a href=\"#BitmapFactory&#x76F8;&#x5173;\" class=\"headerlink\" title=\"BitmapFactory&#x76F8;&#x5173;\"></a>BitmapFactory&#x76F8;&#x5173;</h2><p>BitmapFactory&#x4E3B;&#x8981;&#x7528;&#x6765;&#x89E3;&#x7801;Bitmap&#xFF0C;&#x901A;&#x8FC7;&#x4E0D;&#x540C;&#x7684;&#x8D44;&#x6E90;&#x7C7B;&#x578B;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;files&#x3001;streams&#x4E0E;byte-arrays&#x3002;&#x65E2;&#x7136;&#x662F;&#x7EE7;&#x7EED;&#x8D44;&#x6E90;&#x7684;&#x89E3;&#x7801;&#xFF0C;&#x81EA;&#x7136;&#x53EF;&#x4EE5;&#x5728;&#x89E3;&#x7801;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x56FE;&#x7247;&#x538B;&#x7F29;&#x5904;&#x7406;&#x3002;&#x6765;&#x770B;&#x4E0B;&#x5B83;&#x63D0;&#x4F9B;&#x7684;&#x4E3B;&#x8981;&#x89E3;&#x7801;&#x65B9;&#x6CD5;&#x3002;</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">status return</th>\n<th style=\"text-align:center\">method name </th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">decodeByteArray(byte[] data, int offset, int length, BitmapFactory.Options opts)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">decodeByteArray(byte[] data, int offset, int length)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">decodeFile(String pathName)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">decodeFile(String pathName, BitmapFactory.Options opts)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">decodeFileDescriptor(FileDescriptor fd)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">decodeFileDescriptor(FileDescriptor fd, Rect outPadding, BitmapFactory.Options opts)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">decodeResource(Resources res, int id, BitmapFactory.Options opts)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">decodeResource(Resources res, int id)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">decodeResourceStream(Resources res, TypedValue value, InputStream is, Rect pad, BitmapFactory.Options opts)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">decodeStream(InputStream is)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static Bitmap</td>\n<td style=\"text-align:center\">decodeStream(InputStream is, Rect outPadding, BitmapFactory.Options opts)</td>\n</tr>\n</tbody>\n</table>\n<p>&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x65B9;&#x6CD5;&#x540D;&#x5C31;&#x80FD;&#x5F88;&#x65B9;&#x4FBF;&#x7684;&#x5206;&#x8FA8;&#x51FA;&#x4F7F;&#x7528;&#x54EA;&#x79CD;&#x8D44;&#x6E90;&#x7C7B;&#x578B;&#x8FDB;&#x884C;&#x56FE;&#x7247;&#x89E3;&#x7801;&#x64CD;&#x4F5C;&#x3002;&#x4F8B;&#x5982;&#xFF1A;decodeByteArray&#x65B9;&#x6CD5;&#x662F;&#x901A;&#x8FC7;byte&#x6570;&#x7EC4;&#x4F5C;&#x4E3A;&#x89E3;&#x6790;&#x6E90;&#xFF0C;&#x540C;&#x65F6;&#x5728;&#x89E3;&#x7801;&#x8FC7;&#x7A0B;&#x4E2D;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;offset&#x4E0E;length&#x6765;&#x63A7;&#x5236;&#x89E3;&#x7801;&#x7684;&#x8D77;&#x59CB;&#x70B9;&#x4E0E;&#x89E3;&#x7801;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x56E0;&#x6B64;&#x5982;&#x679C;&#x80FD;&#x591F;&#x7CBE;&#x786E;&#x63A7;&#x5236;offset&#x4E0E;length&#x4E5F;&#x5C31;&#x80FD;&#x591F;&#x505A;&#x5230;&#x56FE;&#x7247;&#x7684;&#x88C1;&#x526A;&#x6548;&#x679C;&#x3002;decodeFileDescriptor&#x65B9;&#x6CD5;&#x662F;&#x901A;&#x8FC7;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x8FDB;&#x884C;&#x89E3;&#x7801;Bitmap&#x3002;&#x4E00;&#x822C;&#x7528;&#x4E0D;&#x5230;&#xFF0C;&#x4E0B;&#x9762;&#x8BE6;&#x7EC6;&#x5206;&#x6790;&#x51E0;&#x79CD;&#x5E38;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<h3 id=\"decodeFile\"><a href=\"#decodeFile\" class=\"headerlink\" title=\"decodeFile\"></a>decodeFile</h3><p>&#x8BE5;&#x65B9;&#x6CD5;&#x662F;&#x901A;&#x8FC7;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x6765;&#x89E3;&#x7801;&#x51FA;Bitmap</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//decodeFile</span><br><span class=\"line\">val decodeFileOptions = BitmapFactory.Options()</span><br><span class=\"line\">val decodeFileBitmap = BitmapFactory.decodeFile(mRootPath +&quot;bitmap&quot;, decodeFileOptions)</span><br><span class=\"line\">decodeFileOptions.inSampleSize = 2</span><br><span class=\"line\">val decodeFileScaleBitmap = BitmapFactory.decodeFile(mRootPath + &quot;bitmap&quot;, decodeFileOptions)</span><br><span class=\"line\">image_view?.setImageBitmap(decodeFileBitmap)</span><br><span class=\"line\">image_view_text.text = &quot;width: &quot; + decodeFileBitmap.width + &quot; height: &quot; + decodeFileBitmap.height</span><br><span class=\"line\">sub_image_view.setImageBitmap(decodeFileScaleBitmap)</span><br><span class=\"line\">sub_image_view_text.text = &quot;width: &quot; + decodeFileScaleBitmap.width + &quot; height: &quot; + decodeFileScaleBitmap.height</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2018/03/21/Bitmap&#x7684;&#x56FE;&#x7247;&#x538B;&#x7F29;&#x6C47;&#x603B;/3.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p>&#x4E0B;&#x9762;&#x7684;&#x56FE;&#x7247;&#x6BD4;&#x4E0A;&#x9762;&#x7684;&#x56FE;&#x7247;&#x5BBD;&#x9AD8;&#x90FD;&#x7F29;&#x5C0F;&#x4E86;&#x4E00;&#x534A;&#xFF0C;&#x5BF9;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x4E86;&#x538B;&#x7F29;&#x64CD;&#x4F5C;&#x3002;&#x901A;&#x8FC7;&#x4EE3;&#x7801;&#x53D1;&#x73B0;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x56FE;&#x7247;&#x89E3;&#x7801;&#x65F6;&#x8BBE;&#x7F6E;&#x4E86;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">decodeFileOptions.inSampleSize = 2</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x5C31;&#x6D89;&#x53CA;&#x5230;&#x4E86;&#x9759;&#x6001;&#x5185;&#x90E8;&#x7C7B;BitmapFactory.Options&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x4E0A;&#x9762;&#x7684;&#x8868;&#x53D1;&#x73B0;&#x5927;&#x591A;&#x6570;&#x65B9;&#x6CD5;&#x90FD;&#x6709;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x9879;&#x3002;&#x4E3B;&#x8981;&#x7528;&#x9014;&#x662F;&#x5728;&#x56FE;&#x7247;&#x89E3;&#x7801;&#x8FC7;&#x7A0B;&#x4E2D;&#x5BF9;&#x56FE;&#x7247;&#x7684;&#x539F;&#x6709;&#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x3002;&#x5B83;&#x7684;&#x53C2;&#x6570;&#x914D;&#x7F6E;&#x5927;&#x591A;&#x6570;&#x4EE5;in&#x524D;&#x7F00;&#x5F00;&#x5934;&#xFF0C;&#x4E0B;&#x9762;&#x5217;&#x4E3E;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x7684;&#x914D;&#x7F6E;&#x8BBE;&#x7F6E;&#x5C5E;&#x6027;&#x3002;</p>\n<table>\n<thead>\n<tr>\n<th>type</th>\n<th>name</th>\n<th>description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>boolean</td>\n<td>inJustDecodeBounds</td>\n<td>&#x5982;&#x679C;&#x4E3A;true&#xFF0C;&#x89E3;&#x7801;&#x540E;&#x4E0D;&#x4F1A;&#x8FD4;&#x56DE;Bitmap&#x5BF9;&#x8C61;&#xFF0C;&#x4F46;Bitmap&#x5BBD;&#x9AD8;&#x5C06;&#x8FD4;&#x56DE;&#x5230;options.outWidth&#x4E0E;options.outHeight&#x4E2D;&#xFF1B;&#x53CD;&#x4E4B;&#x8FD4;&#x56DE;&#x3002;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x53EA;&#x9700;&#x83B7;&#x53D6;&#x89E3;&#x7801;&#x540E;&#x7684;Bitmap&#x7684;&#x5927;&#x5C0F;&#x3002;</td>\n</tr>\n<tr>\n<td>boolean</td>\n<td>inMutable</td>\n<td>&#x4E3A;true&#xFF0C;&#x4EE3;&#x8868;&#x8FD4;&#x56DE;&#x53EF;&#x53D8;&#x5C5E;&#x6027;&#x7684;Bitmap&#xFF0C;&#x53CD;&#x4E4B;&#x4E0D;&#x53EF;&#x53D8;</td>\n</tr>\n<tr>\n<td>boolean</td>\n<td>inPreferQualityOverSpeed</td>\n<td>&#x4E3A;true&#xFF0C;&#x5C06;&#x5728;&#x89E3;&#x7801;&#x8FC7;&#x7A0B;&#x4E2D;&#x727A;&#x7272;&#x89E3;&#x7801;&#x7684;&#x901F;&#x5EA6;&#x6765;&#x83B7;&#x53D6;&#x66F4;&#x9AD8;&#x8D28;&#x91CF;&#x7684;Bitmap</td>\n</tr>\n<tr>\n<td>Bitmap.Config</td>\n<td>inPreferredConfig</td>\n<td>&#x6839;&#x636E;&#x6307;&#x5B9A;&#x7684;Config&#x6765;&#x8FDB;&#x884C;&#x89E3;&#x7801;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;Bitmap.Config.RGB_565&#x7B49;</td>\n</tr>\n<tr>\n<td>int</td>\n<td>inSampleSize</td>\n<td>&#x5982;&#x679C;&#x503C;&#x5927;&#x4E8E;1&#xFF0C;&#x5728;&#x89E3;&#x7801;&#x8FC7;&#x7A0B;&#x4E2D;&#x5C06;&#x6309;&#x6BD4;&#x4F8B;&#x8FD4;&#x56DE;&#x5360;&#x66F4;&#x5C0F;&#x5185;&#x5B58;&#x7684;Bitmap&#x3002;&#x4F8B;&#x5982;&#x503C;&#x4E3A;2&#xFF0C;&#x5219;&#x5BF9;&#x5BBD;&#x9AD8;&#x8FDB;&#x884C;&#x7F29;&#x653E;&#x4E00;&#x534A;&#x3002;</td>\n</tr>\n<tr>\n<td>boolean</td>\n<td>inScaled</td>\n<td>&#x5982;&#x679C;&#x4E3A;true&#xFF0C;&#x4E14;inDesity&#x4E0E;inTargetDensity&#x90FD;&#x4E0D;&#x4E3A;0&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x52A0;&#x8F7D;&#x8FC7;&#x7A0B;&#x4E2D;&#x5C06;&#x4F1A;&#x6839;&#x636E;inTargetDensityl&#x6765;&#x7F29;&#x653E;&#xFF0C;&#x5728;drawn&#x4E2D;&#x4E0D;&#x4F9D;&#x9760;&#x4E8E;&#x56FE;&#x7247;&#x81EA;&#x8EAB;&#x7684;&#x7F29;&#x653E;&#x5C5E;&#x6027;&#x3002;</td>\n</tr>\n<tr>\n<td>int</td>\n<td>inDensity</td>\n<td>Bitmap&#x81EA;&#x8EAB;&#x7684;&#x5BC6;&#x5EA6;</td>\n</tr>\n<tr>\n<td>int</td>\n<td>inTargetDensity</td>\n<td>Bitmap drawn&#x8FC7;&#x7A0B;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x5BC6;&#x5EA6;</td>\n</tr>\n</tbody>\n</table>\n<p>&#x6211;&#x4EEC;&#x5728;&#x6765;&#x770B;&#x4E0B;decodeFile&#x7684;&#x6E90;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static Bitmap decodeFile(String pathName, Options opts) {</span><br><span class=\"line\">    validate(opts);</span><br><span class=\"line\">    Bitmap bm = null;</span><br><span class=\"line\">    InputStream stream = null;</span><br><span class=\"line\">    try {</span><br><span class=\"line\">        stream = new FileInputStream(pathName);</span><br><span class=\"line\">        bm = decodeStream(stream, null, opts);</span><br><span class=\"line\">    } catch (Exception e) {</span><br><span class=\"line\">        /*  do nothing.</span><br><span class=\"line\">            If the exception happened on open, bm will be null.</span><br><span class=\"line\">        */</span><br><span class=\"line\">        Log.e(&quot;BitmapFactory&quot;, &quot;Unable to decode stream: &quot; + e);</span><br><span class=\"line\">    } finally {</span><br><span class=\"line\">        if (stream != null) {</span><br><span class=\"line\">            try {</span><br><span class=\"line\">                stream.close();</span><br><span class=\"line\">            } catch (IOException e) {</span><br><span class=\"line\">                // do nothing here</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return bm;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5185;&#x90E8;&#x6839;&#x636E;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x521B;&#x5EFA;FileInputStream&#xFF0C;&#x6700;&#x7EC8;&#x8C03;&#x7528;decodeStream&#x65B9;&#x6CD5;&#x8FDB;&#x89E3;&#x7801;&#x56FE;&#x7247;&#x3002;</p>\n<h3 id=\"decodeStream-amp-decodeResourceStream\"><a href=\"#decodeStream-amp-decodeResourceStream\" class=\"headerlink\" title=\"decodeStream &amp; decodeResourceStream\"></a>decodeStream &amp; decodeResourceStream</h3><p>&#x81F3;&#x4E8E;decodeStream&#x5185;&#x90E8;&#x5219;&#x662F;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;InputStream&#x7C7B;&#x578B;&#x8C03;&#x7528;&#x4E0D;&#x540C;&#x7684;native&#x65B9;&#x6CD5;&#x3002;&#x5982;&#x679C;&#x4E3A;AssetManager.AssetInputStrea&#x7C7B;&#x578B;&#x5219;&#x8C03;&#x7528;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nativeDecodeAsset(asset, outPadding, opts);</span><br></pre></td></tr></table></figure>\n<p>&#x5426;&#x5219;&#x8C03;&#x7528;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nativeDecodeStream(is, tempStorage, outPadding, opts);</span><br></pre></td></tr></table></figure>\n<p>&#x8FD8;&#x6709;&#x5BF9;&#x5E94;&#x7684;decodeResourceStream&#x65B9;&#x6CD5;&#x5185;&#x90E8;&#x4E5F;&#x662F;&#x8C03;&#x7528;&#x4E86;decodeStream.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static Bitmap decodeResourceStream(Resources res, TypedValue value,</span><br><span class=\"line\">        InputStream is, Rect pad, Options opts) {</span><br><span class=\"line\">    validate(opts);</span><br><span class=\"line\">    if (opts == null) {</span><br><span class=\"line\">        opts = new Options();</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (opts.inDensity == 0 &amp;&amp; value != null) {</span><br><span class=\"line\">        final int density = value.density;</span><br><span class=\"line\">        if (density == TypedValue.DENSITY_DEFAULT) {</span><br><span class=\"line\">            opts.inDensity = DisplayMetrics.DENSITY_DEFAULT;</span><br><span class=\"line\">        } else if (density != TypedValue.DENSITY_NONE) {</span><br><span class=\"line\">            opts.inDensity = density;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">     </span><br><span class=\"line\">    if (opts.inTargetDensity == 0 &amp;&amp; res != null) {</span><br><span class=\"line\">        opts.inTargetDensity = res.getDisplayMetrics().densityDpi;</span><br><span class=\"line\">    }</span><br><span class=\"line\">     </span><br><span class=\"line\">    return decodeStream(is, pad, opts);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>decodeResourceStream&#x5185;&#x90E8;&#x505A;&#x4E86;&#x5BF9;Bitmap&#x7684;&#x5BC6;&#x5EA6;&#x9002;&#x914D;&#xFF0C;&#x6700;&#x540E;&#x518D;&#x8C03;&#x7528;decodeStream&#xFF0C;&#x8FD9;&#x6837;decodeStream&#x4E5F;&#x5206;&#x6790;&#x5B8C;&#x6BD5;&#x3002;</p>\n<h3 id=\"decodeResource\"><a href=\"#decodeResource\" class=\"headerlink\" title=\"decodeResource\"></a>decodeResource</h3><p>decodeResource&#x7528;&#x6CD5;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4F20;&#x5165;&#x76F8;&#x5E94;&#x672C;&#x5730;&#x7684;&#x8D44;&#x6E90;&#x6587;&#x4EF6;&#x5373;&#x53EF;&#xFF0C;&#x9700;&#x8981;&#x7F29;&#x653E;&#x7684;&#x8BDD;&#x914D;&#x7F6E;options&#x53C2;&#x6570;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val options = BitmapFactory.Options()</span><br><span class=\"line\">val bitmap = BitmapFactory.decodeResource(resources, R.drawable.yaodaoji, options)</span><br></pre></td></tr></table></figure>\n<p>&#x968F;&#x4FBF;&#x770B;&#x4E0B;&#x5B83;&#x7684;&#x6E90;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static Bitmap decodeResource(Resources res, int id, Options opts) {</span><br><span class=\"line\">    validate(opts);</span><br><span class=\"line\">    Bitmap bm = null;</span><br><span class=\"line\">    InputStream is = null; </span><br><span class=\"line\">     </span><br><span class=\"line\">    try {</span><br><span class=\"line\">        final TypedValue value = new TypedValue();</span><br><span class=\"line\">        is = res.openRawResource(id, value);</span><br><span class=\"line\"></span><br><span class=\"line\">        bm = decodeResourceStream(res, value, is, null, opts);</span><br><span class=\"line\">    } catch (Exception e) {</span><br><span class=\"line\">        /*  do nothing.</span><br><span class=\"line\">            If the exception happened on open, bm will be null.</span><br><span class=\"line\">            If it happened on close, bm is still valid.</span><br><span class=\"line\">        */</span><br><span class=\"line\">    } finally {</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            if (is != null) is.close();</span><br><span class=\"line\">        } catch (IOException e) {</span><br><span class=\"line\">            // Ignore</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (bm == null &amp;&amp; opts != null &amp;&amp; opts.inBitmap != null) {</span><br><span class=\"line\">        throw new IllegalArgumentException(&quot;Problem decoding into existing bitmap&quot;);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    return bm;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;res.openRawResource(id, value)&#x6765;&#x83B7;&#x53D6;InputStream&#xFF0C;&#x6700;&#x540E;&#x518D;&#x8C03;&#x7528;decodeResourceStream(res, value, is, null, opts)&#x65B9;&#x6CD5;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x53C8;&#x56DE;&#x5230;&#x4E86;&#x4E0A;&#x9762;&#x5206;&#x6790;&#x7684;&#x65B9;&#x6CD5;&#x4E2D;&#x53BB;&#x4E86;&#x3002;</p>\n<h2 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h2><p>&#x4E0B;&#x9762;&#x6765;&#x505A;&#x4E2A;&#x603B;&#x7ED3;&#xFF0C;&#x5BF9;&#x4E8E;&#x56FE;&#x7247;&#x538B;&#x7F29;&#x4E3B;&#x8981;&#x4F7F;&#x7528;&#x5230;Bitmap&#x4E0E;BitmapFactory&#x8FD9;&#x4E24;&#x4E2A;&#x7C7B;&#xFF0C;&#x540C;&#x65F6;&#x5728;&#x4F7F;&#x7528;&#x8FD9;&#x4E24;&#x4E2A;&#x7C7B;&#x4E4B;&#x524D;&#x4E5F;&#x8981;&#x5BF9;Bitmap&#x4E2D;&#x7684;CompressFormat&#x4E0E;Config&#xFF1B;BitmapFactory&#x4E2D;&#x7684;BitmapFactory.Options&#x6709;&#x6240;&#x4E86;&#x89E3;&#x3002;&#x7136;&#x540E;&#x518D;&#x7ED3;&#x5408;&#x4ED6;&#x4EEC;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x538B;&#x7F29;&#x3001;&#x88C1;&#x526A;&#x64CD;&#x4F5C;&#x3002;&#x5176;&#x5B9E;&#x53EA;&#x8981;&#x638C;&#x63E1;&#x51E0;&#x4E2A;&#x5E38;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x5728;&#x65E5;&#x5E38;&#x7684;&#x4F7F;&#x7528;&#x4E2D;&#x5C31;&#x8DB3;&#x591F;&#x4E86;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x5982;&#x6709;&#x6709;&#x4E0D;&#x8DB3;&#x4E4B;&#x5904;&#xFF0C;&#x5E0C;&#x671B;&#x6307;&#x51FA;&#xFF01;</p>\n<p><a href=\"https://github.com/idisfkj/android-api-analysis\" target=\"_blank\" rel=\"noopener\">&#x70B9;&#x51FB;&#x8DF3;&#x8F6C;&#x5230;&#x9879;&#x76EE;&#x5730;&#x5740;</a></p>\n<h2 id=\"&#x5173;&#x6CE8;\"><a href=\"#&#x5173;&#x6CE8;\" class=\"headerlink\" title=\"&#x5173;&#x6CE8;\"></a>&#x5173;&#x6CE8;</h2><p><img src=\"/2018/03/21/Bitmap&#x7684;&#x56FE;&#x7247;&#x538B;&#x7F29;&#x6C47;&#x603B;/wx.jpg\" alt=\"&#x602A;&#x8C08;&#x65F6;&#x95F4;&#x5230;&#x4E86;\"></p>\n","categories":["android"],"tags":["bitmap"]},{"title":"EventBus的工作原理总结","url":"https://www.rousetime.com/2018/02/27/EventBus的工作原理总结/","content":"<h2 id=\"&#x6982;&#x5FF5;\"><a href=\"#&#x6982;&#x5FF5;\" class=\"headerlink\" title=\"&#x6982;&#x5FF5;\"></a>&#x6982;&#x5FF5;</h2><p>EventBus&#x662F;&#x4E00;&#x4E2A;&#x9762;&#x5411;&#x4E8E;Android&#x4E0E;Java&#x7684;&#x5BF9;&#x4E8B;&#x4EF6;&#x8BA2;&#x9605;&#x4E0E;&#x53D1;&#x5E03;&#x7684;&#x5904;&#x7406;&#x7684;&#x4E00;&#x79CD;&#x673A;&#x5236;&#x3002;&#x7B80;&#x5355;&#x7684;&#x8BF4;&#x5B83;&#x5C31;&#x662F;&#x4E00;&#x79CD;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x673A;&#x5236;&#xFF0C;&#x8BE5;&#x9879;&#x76EE;&#x5DF2;&#x7ECF;&#x5F00;&#x6E90;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x5F20;&#x56FE;&#x80FD;&#x591F;&#x5F88;&#x5168;&#x9762;&#x7684;&#x4F53;&#x73B0;&#x5B83;&#x7684;&#x8FD0;&#x884C;&#x3002;</p>\n<p><img src=\"https://raw.githubusercontent.com/greenrobot/EventBus/master/EventBus-Publish-Subscribe.png\" alt></p>\n<p>&#x8FD9;&#x91CC;&#x5C06;EventBus&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x5206;&#x4E3A;&#x4E09;&#x6B65;&#x6765;&#x8BF4;&#x660E;</p>\n<ol>\n<li>EventBus&#x7684;&#x6CE8;&#x518C;&#x4E0E;&#x8BA2;&#x9605;</li>\n<li>EventBus&#x7684;&#x4E8B;&#x4EF6;&#x53D1;&#x5E03;</li>\n<li>EventBus&#x7684;&#x6CE8;&#x9500;</li>\n</ol>\n<h2 id=\"EventBus&#x7684;&#x6CE8;&#x518C;\"><a href=\"#EventBus&#x7684;&#x6CE8;&#x518C;\" class=\"headerlink\" title=\"EventBus&#x7684;&#x6CE8;&#x518C;\"></a>EventBus&#x7684;&#x6CE8;&#x518C;</h2><p>&#x65E2;&#x7136;&#x662F;&#x5BF9;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x8FDB;&#x884C;&#x603B;&#x7ED3;&#xFF0C;&#x90A3;&#x4E48;&#x5E9F;&#x8BDD;&#x4E0D;&#x591A;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x8FDB;&#x5165;EventBus&#x7684;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x5206;&#x6790;</p>\n<blockquote>\n<p>&#x8BE5;&#x6587;&#x7AE0;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x662F;&#x57FA;&#x4E8E;EventBus<code>3.0.0</code>&#x6765;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x8BF4;&#x660E;</p>\n</blockquote>\n<p>&#x5728;&#x4F7F;&#x7528;EventBus&#x5F00;&#x59CB;&#x4E4B;&#x524D;&#x90FD;&#x4F1A;&#x8C03;&#x7528;&#x5B83;&#x7684;&#x6CE8;&#x518C;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EventBus.getDefault().register(this)</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;getDefault()&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;EventBus&#x7684;&#x5B9E;&#x4F8B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static EventBus getDefault() {</span><br><span class=\"line\">    if (defaultInstance == null) {</span><br><span class=\"line\">        synchronized (EventBus.class) {</span><br><span class=\"line\">            if (defaultInstance == null) {</span><br><span class=\"line\">                defaultInstance = new EventBus();</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return defaultInstance;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x6E90;&#x7801;&#x53D1;&#x73B0;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;singleton pattern(&#x5355;&#x4F8B;&#x6A21;&#x5F0F;)&#xFF0C;&#x4FDD;&#x8BC1;&#x5B9E;&#x4F8B;&#x7684;&#x5168;&#x5C40;&#x5316;&#xFF0C;&#x51CF;&#x5C11;&#x8D44;&#x6E90;&#x7684;&#x5F00;&#x9500;&#x3002;</p>\n<p>&#x8FDB;&#x5165;EventBus&#x7684;&#x6CE8;&#x518C;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void register(Object subscriber) {</span><br><span class=\"line\">    Class&lt;?&gt; subscriberClass = subscriber.getClass();</span><br><span class=\"line\">    //&#x83B7;&#x53D6;&#x8BE5;&#x8BA2;&#x9605;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x8BA2;&#x9605;&#x4E86;&#x7684;&#x65B9;&#x6CD5;</span><br><span class=\"line\">    List&lt;SubscriberMethod&gt; subscriberMethods = subscriberMethodFinder.findSubscriberMethods(subscriberClass);</span><br><span class=\"line\">    synchronized (this) {</span><br><span class=\"line\">        for (SubscriberMethod subscriberMethod : subscriberMethods) {</span><br><span class=\"line\">            subscribe(subscriber, subscriberMethod);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;<code>subscriberMethodFinder</code>&#x6210;&#x5458;&#x5B57;&#x6BB5;&#xFF0C;&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x5B83;&#x7684;findSubscriberMethods&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x8BA2;&#x9605;&#x7684;&#x65B9;&#x6CD5;&#x6570;&#x7EC4;&#x3002;&#x8F6C;&#x5230;findSubscriberMethods&#x65B9;&#x6CD5;&#x4E2D;&#x770B;&#x4E0B;&#x5B83;&#x7684;&#x5B9E;&#x73B0;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;SubscriberMethod&gt; findSubscriberMethods(Class&lt;?&gt; subscriberClass) {</span><br><span class=\"line\">//&#x901A;&#x8FC7;&#x672C;&#x5730;&#x7F13;&#x5B58;&#x67E5;&#x627E;&#x662F;&#x5426;&#x5B58;&#x5728;&#x8BE5;&#x5BF9;&#x8C61;&#x7684;&#x8BA2;&#x9605;&#x65B9;&#x6CD5;</span><br><span class=\"line\">    List&lt;SubscriberMethod&gt; subscriberMethods = METHOD_CACHE.get(subscriberClass);</span><br><span class=\"line\">    if (subscriberMethods != null) {</span><br><span class=\"line\">        return subscriberMethods;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    if (ignoreGeneratedIndex) {</span><br><span class=\"line\">    //&#x4F7F;&#x7528;&#x53CD;&#x5C04;&#x673A;&#x5236;&#x6765;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x7684;&#x8BA2;&#x9605;&#x65B9;&#x6CD5;</span><br><span class=\"line\">        subscriberMethods = findUsingReflection(subscriberClass);</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">    //&#x4F7F;&#x7528;&#x6570;&#x7EC4;&#x7D22;&#x5F15;&#x65B9;&#x5F0F;&#x6765;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x7684;&#x8BA2;&#x9605;&#x65B9;&#x6CD5;</span><br><span class=\"line\">        subscriberMethods = findUsingInfo(subscriberClass);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    if (subscriberMethods.isEmpty()) {</span><br><span class=\"line\">        throw new EventBusException(&quot;Subscriber &quot; + subscriberClass</span><br><span class=\"line\">                + &quot; and its super classes have no public methods with the @Subscribe annotation&quot;);</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">    //&#x5C06;&#x7ED3;&#x679C;&#x52A0;&#x5165;&#x5230;&#x672C;&#x5730;&#x7F13;&#x5B58;&#x4E2D;</span><br><span class=\"line\">        METHOD_CACHE.put(subscriberClass, subscriberMethods);</span><br><span class=\"line\">        return subscriberMethods;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x5173;&#x952E;&#x90E8;&#x5206;&#x7684;&#x6CE8;&#x91CA;&#x5DF2;&#x7ECF;&#x5199;&#x51FA;&#x6765;&#x4E86;&#x3002;&#x5982;&#x679C;&#x672C;&#x5730;&#x7F13;&#x5B58;&#x4E2D;&#x6CA1;&#x6709;&#xFF0C;&#x5219;&#x83B7;&#x53D6;&#x65B9;&#x5F0F;&#x6839;&#x636E;<code>ignoreGeneratedIndex</code>&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#x3002;&#x5176;&#x4E2D;<code>ignoreGeneratedIndex</code>&#x9ED8;&#x8BA4;&#x4E3A;false&#x3002;&#x8BE5;&#x5B57;&#x6BB5;&#x7684;&#x503C;&#x5728;EventBus&#x5B9E;&#x4F8B;&#x5316;&#x7684;&#x9002;&#x5408;&#x9ED8;&#x8BA4;&#x8FDB;&#x884C;&#x4E86;&#x8BBE;&#x7F6E;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EventBus(EventBusBuilder builder) {</span><br><span class=\"line\">    subscriptionsByEventType = new HashMap&lt;&gt;();</span><br><span class=\"line\">    typesBySubscriber = new HashMap&lt;&gt;();</span><br><span class=\"line\">    stickyEvents = new ConcurrentHashMap&lt;&gt;();</span><br><span class=\"line\">    mainThreadPoster = new HandlerPoster(this, Looper.getMainLooper(), 10);</span><br><span class=\"line\">    backgroundPoster = new BackgroundPoster(this);</span><br><span class=\"line\">    asyncPoster = new AsyncPoster(this);</span><br><span class=\"line\">    indexCount = builder.subscriberInfoIndexes != null ? builder.subscriberInfoIndexes.size() : 0;</span><br><span class=\"line\">    //&#x83B7;&#x53D6;&#x8BA2;&#x9605;&#x65B9;&#x6CD5;&#x7684;&#x6210;&#x5458;&#x5B57;&#x6BB5;&#x7684;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;</span><br><span class=\"line\">    subscriberMethodFinder = new SubscriberMethodFinder(builder.subscriberInfoIndexes,</span><br><span class=\"line\">            builder.strictMethodVerification, builder.ignoreGeneratedIndex);</span><br><span class=\"line\">    logSubscriberExceptions = builder.logSubscriberExceptions;</span><br><span class=\"line\">    logNoSubscriberMessages = builder.logNoSubscriberMessages;</span><br><span class=\"line\">    sendSubscriberExceptionEvent = builder.sendSubscriberExceptionEvent;</span><br><span class=\"line\">    sendNoSubscriberEvent = builder.sendNoSubscriberEvent;</span><br><span class=\"line\">    throwSubscriberException = builder.throwSubscriberException;</span><br><span class=\"line\">    eventInheritance = builder.eventInheritance;</span><br><span class=\"line\">    executorService = builder.executorService;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x663E;&#x800C;&#x6613;&#x89C1;&#x662F;&#x901A;&#x8FC7;builder&#x6A21;&#x5F0F;&#x6765;&#x914D;&#x7F6E;&#x9ED8;&#x8BA4;&#x7684;&#x53C2;&#x6570;&#x503C;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x9700;&#x8981;&#x6539;&#x53D8;&#x8FD9;&#x5176;&#x4E2D;&#x7684;&#x53C2;&#x6570;&#x503C;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;builder&#x6765;&#x8BBE;&#x7F6E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EventBus eventBus = EventBus.builder().ignoreGeneratedIndex(true).build();</span><br><span class=\"line\">eventBus.register(this);</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x7D22;&#x5F15;&#x673A;&#x5236;\"><a href=\"#&#x7D22;&#x5F15;&#x673A;&#x5236;\" class=\"headerlink\" title=\"&#x7D22;&#x5F15;&#x673A;&#x5236;\"></a>&#x7D22;&#x5F15;&#x673A;&#x5236;</h3><p>&#x65E2;&#x7136;&#x9ED8;&#x8BA4;&#x662F;false&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x8C03;&#x7528;findUsingInfo&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private List&lt;SubscriberMethod&gt; findUsingInfo(Class&lt;?&gt; subscriberClass) {</span><br><span class=\"line\">\t//&#x5B9E;&#x4F8B;&#x5316;findState</span><br><span class=\"line\">    FindState findState = prepareFindState();</span><br><span class=\"line\">    //&#x521D;&#x59CB;&#x5316;findState</span><br><span class=\"line\">    findState.initForSubscriber(subscriberClass);</span><br><span class=\"line\">    while (findState.clazz != null) {</span><br><span class=\"line\">    \t//&#x83B7;&#x53D6;&#x8BA2;&#x9605;&#x8005;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x5E76;&#x4FDD;&#x5B58;&#x5728;findState&#x4E2D;</span><br><span class=\"line\">        findState.subscriberInfo = getSubscriberInfo(findState);</span><br><span class=\"line\">        if (findState.subscriberInfo != null) {</span><br><span class=\"line\">            SubscriberMethod[] array = findState.subscriberInfo.getSubscriberMethods();</span><br><span class=\"line\">            for (SubscriberMethod subscriberMethod : array) {</span><br><span class=\"line\">                if (findState.checkAdd(subscriberMethod.method, subscriberMethod.eventType)) {</span><br><span class=\"line\">                \t//&#x4FDD;&#x5B58;&#x8BA2;&#x9605;&#x8005;&#x76F8;&#x5173;&#x7684;&#x6240;&#x6709;&#x7684;&#x8BA2;&#x9605;&#x65B9;&#x6CD5;</span><br><span class=\"line\">                    findState.subscriberMethods.add(subscriberMethod);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">        \t//&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x673A;&#x5236;&#x83B7;&#x53D6;&#x8BA2;&#x9605;&#x8005;&#x76F8;&#x5173;&#x7684;&#x6240;&#x7528;&#x8BA2;&#x9605;&#x65B9;&#x6CD5;</span><br><span class=\"line\">            findUsingReflectionInSingleClass(findState);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        //&#x8F6C;&#x79FB;&#x5230;&#x7236;&#x7C7B;&#x67E5;&#x627E;&#x6240;&#x6709;&#x7684;&#x8BA2;&#x9605;&#x65B9;&#x6CD5;</span><br><span class=\"line\">        findState.moveToSuperclass();</span><br><span class=\"line\">    }</span><br><span class=\"line\">    //&#x5C06;&#x83B7;&#x53D6;&#x7684;&#x8BA2;&#x9605;&#x65B9;&#x6CD5;&#x91CD;&#x65B0;&#x6DFB;&#x52A0;&#x5230;&#x4E00;&#x4E2A;&#x65B0;&#x7684;List&#x96C6;&#x5408;&#x4E2D;&#xFF0C;&#x5E76;&#x91CA;&#x653E;findState&#x4E2D;&#x7684;&#x8D44;&#x6E90;</span><br><span class=\"line\">    return getMethodsAndRelease(findState);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x7684;&#x5173;&#x952E;&#x5730;&#x65B9;&#x662F;getSubscriberInfo&#x65B9;&#x6CD5;&#xFF0C;&#x7528;&#x6765;&#x83B7;&#x53D6;&#x8BA2;&#x9605;&#x8005;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x5185;&#x90E8;&#x67E5;&#x627E;&#x662F;&#x4F7F;&#x7528;index&#x7D22;&#x5F15;&#x3002;&#x5982;&#x679C;&#x8BE5;&#x65B9;&#x6CD5;&#x8FD8;&#x662F;&#x6CA1;&#x6709;&#x627E;&#x5230;&#xFF0C;&#x5219;&#x8F6C;&#x5411;&#x4F7F;&#x7528;&#x53CD;&#x5C04;&#x673A;&#x5236;&#x8FDB;&#x884C;&#x83B7;&#x53D6;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private SubscriberInfo getSubscriberInfo(FindState findState) {</span><br><span class=\"line\">    if (findState.subscriberInfo != null &amp;&amp; findState.subscriberInfo.getSuperSubscriberInfo() != null) {</span><br><span class=\"line\">        SubscriberInfo superclassInfo = findState.subscriberInfo.getSuperSubscriberInfo();</span><br><span class=\"line\">        if (findState.clazz == superclassInfo.getSubscriberClass()) {</span><br><span class=\"line\">            return superclassInfo;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    if (subscriberInfoIndexes != null) {</span><br><span class=\"line\">    \t//&#x904D;&#x5386;&#x67E5;&#x627E;&#x8BA2;&#x9605;&#x8005;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;</span><br><span class=\"line\">        for (SubscriberInfoIndex index : subscriberInfoIndexes) {</span><br><span class=\"line\">            SubscriberInfo info = index.getSubscriberInfo(findState.clazz);</span><br><span class=\"line\">            if (info != null) {</span><br><span class=\"line\">                return info;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return null;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x7684;<code>subscriberInfoIndexes</code>&#x5C31;&#x662F;&#x4E4B;&#x524D;builder&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x76F8;&#x540C;&#x5B57;&#x6BB5;&#x5C5E;&#x6027;&#x7684;&#x503C;&#x3002;&#x8BE5;&#x96C6;&#x5408;&#x7684;&#x503C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;builder&#x6765;&#x52A8;&#x6001;&#x6DFB;&#x52A0;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EventBus eventBus = EventBus.builder()</span><br><span class=\"line\">    .addIndex(new MyEventBusAppIndex())</span><br><span class=\"line\">    .addIndex(new MyEventBusLibIndex()).build();</span><br></pre></td></tr></table></figure>\n<p>&#x5230;&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x5168;&#x90E8;&#x901A;&#x8FC7;index&#x83B7;&#x53D6;&#x8BA2;&#x9605;&#x65B9;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x53EA;&#x6709;&#x5728;EventBus <code>3.x</code>&#x4EE5;&#x4E0A;&#x7248;&#x672C;&#x624D;&#x6709;&#xFF0C;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x53CD;&#x5C04;&#x673A;&#x5236;&#xFF0C;&#x6240;&#x4EE5;&#x76F8;&#x5BF9;&#x6765;&#x8BF4;&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x901F;&#x5EA6;&#x81EA;&#x7136;&#x4F1A;&#x6BD4;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x673A;&#x5236;&#x6765;&#x83B7;&#x53D6;&#x66F4;&#x5FEB;&#x3002;</p>\n<h3 id=\"&#x53CD;&#x5C04;&#x673A;&#x5236;\"><a href=\"#&#x53CD;&#x5C04;&#x673A;&#x5236;\" class=\"headerlink\" title=\"&#x53CD;&#x5C04;&#x673A;&#x5236;\"></a>&#x53CD;&#x5C04;&#x673A;&#x5236;</h3><p>&#x53CD;&#x5C04;&#x673A;&#x5236;&#x83B7;&#x53D6;&#x7684;&#x4E3B;&#x8981;&#x5B9E;&#x73B0;&#x662F;&#x5728;findUsingReflectionInSingleClass&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8FDB;&#x5165;&#x77A7;&#x77A7;&#x5B83;&#x7684;&#x5B9E;&#x73B0;&#x6B65;&#x9AA4;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void findUsingReflectionInSingleClass(FindState findState) {</span><br><span class=\"line\">    Method[] methods;</span><br><span class=\"line\">    try {</span><br><span class=\"line\">        // This is faster than getMethods, especially when subscribers are fat classes like Activities</span><br><span class=\"line\">        //&#x83B7;&#x53D6;&#x6CE8;&#x518C;&#x5BF9;&#x8C61;&#x4E2D;&#x58F0;&#x660E;&#x7684;&#x6240;&#x4EE5;&#x65B9;&#x6CD5;</span><br><span class=\"line\">        methods = findState.clazz.getDeclaredMethods();</span><br><span class=\"line\">    } catch (Throwable th) {</span><br><span class=\"line\">        // Workaround for java.lang.NoClassDefFoundError, see https://github.com/greenrobot/EventBus/issues/149</span><br><span class=\"line\">        methods = findState.clazz.getMethods();</span><br><span class=\"line\">        findState.skipSuperClasses = true;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    for (Method method : methods) {</span><br><span class=\"line\">        int modifiers = method.getModifiers();</span><br><span class=\"line\">        //&#x83B7;&#x53D6;&#x516C;&#x6709;&#x4E14;&#x975E;&#x62BD;&#x8C61;&#x6216;&#x8005;&#x9759;&#x6001;&#x7684;&#x65B9;&#x6CD5;</span><br><span class=\"line\">        if ((modifiers &amp; Modifier.PUBLIC) != 0 &amp;&amp; (modifiers &amp; MODIFIERS_IGNORE) == 0) {</span><br><span class=\"line\">            Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span><br><span class=\"line\">            //&#x83B7;&#x53D6;&#x53EA;&#x8981;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x65B9;&#x6CD5;</span><br><span class=\"line\">            if (parameterTypes.length == 1) {</span><br><span class=\"line\">            \t//&#x83B7;&#x53D6;&#x8BA2;&#x9605;&#x65B9;&#x6CD5;&#x7684;&#x6CE8;&#x91CA;&#x7C7B;&#x578B;</span><br><span class=\"line\">                Subscribe subscribeAnnotation = method.getAnnotation(Subscribe.class);</span><br><span class=\"line\">                if (subscribeAnnotation != null) {</span><br><span class=\"line\">                    Class&lt;?&gt; eventType = parameterTypes[0];</span><br><span class=\"line\">                    if (findState.checkAdd(method, eventType)) {</span><br><span class=\"line\">                    \t//&#x83B7;&#x53D6;&#x6CE8;&#x91CA;&#x4E2D;&#x7684;ThreadMode&#x7684;&#x503C;</span><br><span class=\"line\">                        ThreadMode threadMode = subscribeAnnotation.threadMode();</span><br><span class=\"line\">                        //&#x5C06;&#x8BA2;&#x9605;&#x65B9;&#x6CD5;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x4FDD;&#x5B58;</span><br><span class=\"line\">                        findState.subscriberMethods.add(new SubscriberMethod(method, eventType, threadMode,</span><br><span class=\"line\">                                subscribeAnnotation.priority(), subscribeAnnotation.sticky()));</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }</span><br><span class=\"line\">            } else if (strictMethodVerification &amp;&amp; method.isAnnotationPresent(Subscribe.class)) {</span><br><span class=\"line\">                String methodName = method.getDeclaringClass().getName() + &quot;.&quot; + method.getName();</span><br><span class=\"line\">                throw new EventBusException(&quot;@Subscribe method &quot; + methodName +</span><br><span class=\"line\">                        &quot;must have exactly 1 parameter but has &quot; + parameterTypes.length);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        } else if (strictMethodVerification &amp;&amp; method.isAnnotationPresent(Subscribe.class)) {</span><br><span class=\"line\">            String methodName = method.getDeclaringClass().getName() + &quot;.&quot; + method.getName();</span><br><span class=\"line\">            throw new EventBusException(methodName +</span><br><span class=\"line\">                    &quot; is a illegal @Subscribe method: must be public, non-static, and non-abstract&quot;);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5173;&#x952E;&#x6CE8;&#x91CA;&#x5DF2;&#x7ED9;&#x51FA;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x539F;&#x7406;&#x6765;&#x83B7;&#x53D6;&#x8BA2;&#x9605;&#x65B9;&#x6CD5;&#x7684;&#x6240;&#x9700;&#x4FE1;&#x606F;&#x3002;&#x540C;&#x65F6;&#x4FDD;&#x5B58;&#x4E0B;&#x6765;&#x4EE5;&#x4FBF;&#x540E;&#x7EED;&#x7684;&#x4E8B;&#x4EF6;&#x53D1;&#x5E03;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4E4B;&#x524D;&#x53CD;&#x5C04;&#x673A;&#x5236;&#x6B65;&#x9AA4;&#x5F00;&#x59CB;&#x7684;&#x5916;&#x90E8;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x6E90;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private List&lt;SubscriberMethod&gt; findUsingReflection(Class&lt;?&gt; subscriberClass) {</span><br><span class=\"line\">    FindState findState = prepareFindState();</span><br><span class=\"line\">    findState.initForSubscriber(subscriberClass);</span><br><span class=\"line\">    while (findState.clazz != null) {</span><br><span class=\"line\">        findUsingReflectionInSingleClass(findState);</span><br><span class=\"line\">        findState.moveToSuperclass();</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return getMethodsAndRelease(findState);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E3B;&#x8981;&#x903B;&#x8F91;&#x8DDF;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x65B9;&#x5F0F;&#x7C7B;&#x4F3C;&#xFF0C;&#x53EA;&#x662F;&#x5C11;&#x4E86;&#x5BF9;&#x7D22;&#x5F15;&#x65B9;&#x5F0F;&#x7684;&#x67E5;&#x627E;&#x3002;</p>\n<h3 id=\"&#x8BA2;&#x9605;\"><a href=\"#&#x8BA2;&#x9605;\" class=\"headerlink\" title=\"&#x8BA2;&#x9605;\"></a>&#x8BA2;&#x9605;</h3><p>&#x56DE;&#x5230;register&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x8BA2;&#x9605;&#x8005;&#x7684;&#x6240;&#x4EE5;&#x8BA2;&#x9605;&#x65B9;&#x6CD5;&#x5DF2;&#x7ECF;&#x83B7;&#x53D6;&#x5B8C;&#x6BD5;&#xFF0C;&#x4E0B;&#x4E00;&#x6B65;&#x5C31;&#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x8BA2;&#x9605;&#x64CD;&#x4F5C;&#xFF0C;&#x672C;&#x8D28;&#x662F;&#x5BF9;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#x4FDD;&#x5B58;&#x3002;&#x90A3;&#x4E48;&#x76F4;&#x63A5;&#x770B;subscribe&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  private void subscribe(Object subscriber, SubscriberMethod subscriberMethod) {</span><br><span class=\"line\">  \t//&#x8BA2;&#x9605;&#x65B9;&#x6CD5;&#x4E2D;&#x6240;&#x7533;&#x660E;&#x7684;&#x53C2;&#x6570;class&#x7C7B;&#x578B;</span><br><span class=\"line\">      Class&lt;?&gt; eventType = subscriberMethod.eventType;</span><br><span class=\"line\">      //&#x5BF9;&#x8BA2;&#x9605;&#x8005;&#x4E0E;&#x8BA2;&#x9605;&#x8005;&#x7684;&#x65B9;&#x6CD5;&#x5EFA;&#x7ACB;&#x8054;&#x7CFB;&#xFF0C;&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#x7BA1;&#x7406;</span><br><span class=\"line\">      Subscription newSubscription = new Subscription(subscriber, subscriberMethod);</span><br><span class=\"line\">      //&#x901A;&#x8FC7;EventType&#x6765;&#x67E5;&#x627E;&#x5173;&#x8054;&#x7684;subscribetions&#x96C6;&#x5408;</span><br><span class=\"line\">      CopyOnWriteArrayList&lt;Subscription&gt; subscriptions = subscriptionsByEventType.get(eventType);</span><br><span class=\"line\">      if (subscriptions == null) {</span><br><span class=\"line\">          subscriptions = new CopyOnWriteArrayList&lt;&gt;();</span><br><span class=\"line\">          //&#x4FDD;&#x5B58;&#x65B0;&#x7684;eventType&#x7684;subscriptions</span><br><span class=\"line\">          subscriptionsByEventType.put(eventType, subscriptions);</span><br><span class=\"line\">      } else {</span><br><span class=\"line\">          if (subscriptions.contains(newSubscription)) {</span><br><span class=\"line\">              throw new EventBusException(&quot;Subscriber &quot; + subscriber.getClass() + &quot; already registered to event &quot;</span><br><span class=\"line\">                      + eventType);</span><br><span class=\"line\">          }</span><br><span class=\"line\">      }</span><br><span class=\"line\"></span><br><span class=\"line\">      int size = subscriptions.size();</span><br><span class=\"line\">      for (int i = 0; i &lt;= size; i++) {</span><br><span class=\"line\">      \t//&#x6839;&#x636E;&#x8BA2;&#x9605;&#x65B9;&#x6CD5;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x63D2;&#x5165;&#x5230;subscriptions&#x4E2D;</span><br><span class=\"line\">          if (i == size || subscriberMethod.priority &gt; subscriptions.get(i).subscriberMethod.priority) {</span><br><span class=\"line\">              subscriptions.add(i, newSubscription);</span><br><span class=\"line\">              break;</span><br><span class=\"line\">          }</span><br><span class=\"line\">      }</span><br><span class=\"line\"></span><br><span class=\"line\">//&#x6839;&#x636E;&#x8BA2;&#x9605;&#x8005;&#x6765;&#x67E5;&#x627E;&#x6240;&#x6709;&#x7684;EventType</span><br><span class=\"line\">      List&lt;Class&lt;?&gt;&gt; subscribedEvents = typesBySubscriber.get(subscriber);</span><br><span class=\"line\">      if (subscribedEvents == null) {</span><br><span class=\"line\">          subscribedEvents = new ArrayList&lt;&gt;();</span><br><span class=\"line\">          typesBySubscriber.put(subscriber, subscribedEvents);</span><br><span class=\"line\">      }</span><br><span class=\"line\">      //&#x6839;&#x636E;&#x8BA2;&#x9605;&#x8005;&#x4FDD;&#x5B58;&#x6240;&#x6709;&#x7684;EventType</span><br><span class=\"line\">      subscribedEvents.add(eventType);</span><br><span class=\"line\"></span><br><span class=\"line\">//&#x5BF9;&#x5177;&#x6709;sticky&#x7C7B;&#x578B;&#x7684;&#x8BA2;&#x9605;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x76F4;&#x63A5;&#x53D1;&#x5E03;&#x5904;&#x7406;</span><br><span class=\"line\">      if (subscriberMethod.sticky) {</span><br><span class=\"line\">      \t//&#x9A8C;&#x8BC1;eventType&#x4E0E;stickyEvent&#x95F4;&#x7684;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;true</span><br><span class=\"line\">          if (eventInheritance) {</span><br><span class=\"line\">              // Existing sticky events of all subclasses of eventType have to be considered.</span><br><span class=\"line\">              // Note: Iterating over all events may be inefficient with lots of sticky events,</span><br><span class=\"line\">              // thus data structure should be changed to allow a more efficient lookup</span><br><span class=\"line\">              // (e.g. an additional map storing sub classes of super classes: Class -&gt; List&lt;Class&gt;).</span><br><span class=\"line\">              Set&lt;Map.Entry&lt;Class&lt;?&gt;, Object&gt;&gt; entries = stickyEvents.entrySet();</span><br><span class=\"line\">              for (Map.Entry&lt;Class&lt;?&gt;, Object&gt; entry : entries) {</span><br><span class=\"line\">                  Class&lt;?&gt; candidateEventType = entry.getKey();</span><br><span class=\"line\">                  //&#x5224;&#x65AD;eventType&#x662F;&#x5426;&#x662F;candidateEventType&#x7684;&#x7236;&#x7C7B;&#x6216;&#x8005;&#x540C;&#x4E00;&#x79CD;&#x7C7B;&#x578B;</span><br><span class=\"line\">                  if (eventType.isAssignableFrom(candidateEventType)) {</span><br><span class=\"line\">                      Object stickyEvent = entry.getValue();</span><br><span class=\"line\">                      //&#x53D1;&#x5E03;&#x4E8B;&#x4EF6;</span><br><span class=\"line\">                      checkPostStickyEventToSubscription(newSubscription, stickyEvent);</span><br><span class=\"line\">                  }</span><br><span class=\"line\">              }</span><br><span class=\"line\">          } else {</span><br><span class=\"line\">              Object stickyEvent = stickyEvents.get(eventType);</span><br><span class=\"line\">              //&#x53D1;&#x5E03;&#x4E8B;&#x4EF6;</span><br><span class=\"line\">              checkPostStickyEventToSubscription(newSubscription, stickyEvent);</span><br><span class=\"line\">          }</span><br><span class=\"line\">      }</span><br><span class=\"line\">  }</span><br></pre></td></tr></table></figure>\n<p>&#x8BA2;&#x9605;&#x7684;&#x5904;&#x7406;&#x4E3B;&#x8981;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x79CD;&#x662F;&#x975E;sticky&#x7C7B;&#x578B;&#xFF0C;&#x6839;&#x636E;eventType&#x6765;&#x4FDD;&#x5B58;subscriptions&#x4E0E;&#x6839;&#x636E;subscribe&#x6765;&#x4FDD;&#x5B58;eventType&#xFF1B;&#x53E6;&#x4E00;&#x79CD;&#x662F;sticky&#x7C7B;&#x578B;&#xFF0C;&#x90A3;&#x4E48;&#x6700;&#x7EC8;&#x90FD;&#x662F;&#x5BF9;&#x4E8B;&#x4EF6;&#x8FDB;&#x884C;&#x76F4;&#x63A5;&#x53D1;&#x5E03;&#x3002;</p>\n<h2 id=\"EventBus&#x7684;&#x53D1;&#x5E03;\"><a href=\"#EventBus&#x7684;&#x53D1;&#x5E03;\" class=\"headerlink\" title=\"EventBus&#x7684;&#x53D1;&#x5E03;\"></a>EventBus&#x7684;&#x53D1;&#x5E03;</h2><p>EventBus&#x7684;&#x53D1;&#x5E03;&#x662F;&#x8C03;&#x7528;post&#x65B9;&#x6CD5;&#xFF0C;&#x6307;&#x5B9A;&#x53D1;&#x5E03;&#x7684;Event&#x7C7B;&#x578B;&#xFF0C;&#x53EA;&#x8981;&#x8BA2;&#x9605;&#x8005;&#x6301;&#x6709;&#x8BE5;&#x76F8;&#x5173;Event&#x7C7B;&#x578B;&#x7684;&#x65B9;&#x6CD5;&#x5C31;&#x90FD;&#x80FD;&#x6536;&#x5230;&#x53D1;&#x5E03;&#x7684;&#x4E8B;&#x4EF6;&#x3002;&#x5177;&#x4F53;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EventBus.getDefault().post(new MyEvent());</span><br><span class=\"line\">//&#x6216;&#x8005;&#x53D1;&#x5E03;sticky&#x7C7B;&#x578B;&#x7684;event</span><br><span class=\"line\">EventBus.getDefault().postSticky(new MyEvent());</span><br></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x4E8E;sticky&#x7C7B;&#x578B;&#x7684;&#x4E8B;&#x4EF6;&#x53D1;&#x5E03;&#xFF0C;&#x672C;&#x8D28;&#x4E0A;&#x8FD8;&#x662F;&#x8C03;&#x7528;&#x4E86;post&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x53EA;&#x662F;&#x589E;&#x52A0;&#x4E86;&#x5BF9;sticky event&#x7684;&#x540C;&#x6B65;&#x4FDD;&#x5B58;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void postSticky(Object event) {</span><br><span class=\"line\">    synchronized (stickyEvents) {</span><br><span class=\"line\">        stickyEvents.put(event.getClass(), event);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    // Should be posted after it is putted, in case the subscriber wants to remove immediately</span><br><span class=\"line\">    post(event);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x76F4;&#x63A5;&#x770B;post&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  public void post(Object event) {</span><br><span class=\"line\">      PostingThreadState postingState = currentPostingThreadState.get();</span><br><span class=\"line\">      List&lt;Object&gt; eventQueue = postingState.eventQueue;</span><br><span class=\"line\">      eventQueue.add(event);</span><br><span class=\"line\"></span><br><span class=\"line\">//&#x672C;&#x5730;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x6B63;&#x5728;&#x53D1;&#x5E03;event</span><br><span class=\"line\">      if (!postingState.isPosting) {</span><br><span class=\"line\">          postingState.isMainThread = isMainThread();</span><br><span class=\"line\">          postingState.isPosting = true;</span><br><span class=\"line\">          if (postingState.canceled) {</span><br><span class=\"line\">              throw new EventBusException(&quot;Internal error. Abort state was not reset&quot;);</span><br><span class=\"line\">          }</span><br><span class=\"line\">          try {</span><br><span class=\"line\">              while (!eventQueue.isEmpty()) {</span><br><span class=\"line\">              \t//&#x9010;&#x4E00;&#x53D1;&#x5E03;&#x5355;&#x4E2A;event</span><br><span class=\"line\">                  postSingleEvent(eventQueue.remove(0), postingState);</span><br><span class=\"line\">              }</span><br><span class=\"line\">          } finally {</span><br><span class=\"line\">              postingState.isPosting = false;</span><br><span class=\"line\">              postingState.isMainThread = false;</span><br><span class=\"line\">          }</span><br><span class=\"line\">      }</span><br><span class=\"line\">  }</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x53D1;&#x5E03;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;currentPostingThreadState&#x5B57;&#x6BB5;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;ThreadLocal&#xFF0C;&#x4FDD;&#x8BC1;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E2D;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x53D1;&#x5E03;&#x961F;&#x5217;&#x5728;&#x8FDB;&#x884C;&#x4E2D;&#x3002;&#x628A;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x53D1;&#x5E03;&#x7684;event&#x52A0;&#x5165;&#x5230;&#x6B63;&#x5728;&#x8FDB;&#x884C;&#x4E2D;&#x7684;&#x961F;&#x5F62;&#x4E2D;&#x3002;&#x5BF9;&#x8BE5;&#x961F;&#x5217;&#x4E2D;&#x7684;event&#x8FDB;&#x884C;&#x9010;&#x4E2A;&#x53D6;&#x51FA;&#x53D1;&#x5E03;&#x3002;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x4E3A;postSingleEvent</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void postSingleEvent(Object event, PostingThreadState postingState) throws Error {</span><br><span class=\"line\">    Class&lt;?&gt; eventClass = event.getClass();</span><br><span class=\"line\">    boolean subscriptionFound = false;</span><br><span class=\"line\">    //&#x5982;&#x679C;&#x5F00;&#x542F;&#x4E86;event&#x7684;&#x7EE7;&#x627F;&#x673A;&#x5236;</span><br><span class=\"line\">    if (eventInheritance) {</span><br><span class=\"line\">    \t//&#x67E5;&#x627E;&#x6240;&#x6709;&#x7684;eventType&#xFF0C;&#x5373;&#x5305;&#x62EC;&#x5B83;&#x7684;&#x7236;&#x7C7B;&#x4E0E;&#x5B9E;&#x73B0;&#x7684;&#x63A5;&#x53E3;</span><br><span class=\"line\">        List&lt;Class&lt;?&gt;&gt; eventTypes = lookupAllEventTypes(eventClass);</span><br><span class=\"line\">        int countTypes = eventTypes.size();</span><br><span class=\"line\">        for (int h = 0; h &lt; countTypes; h++) {</span><br><span class=\"line\">            Class&lt;?&gt; clazz = eventTypes.get(h);</span><br><span class=\"line\">            //&#x53EA;&#x8981;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;eventType&#x88AB;&#x627E;&#x5230;&#x76F8;&#x5E94;&#x7684;subscription&#xFF0C;&#x5C31;&#x4E3A;true</span><br><span class=\"line\">            subscriptionFound |= postSingleEventForEventType(event, postingState, clazz);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">    \t//&#x6807;&#x8BC6;&#x8BE5;eventType&#x662F;&#x5426;&#x6709;&#x76F8;&#x5E94;&#x7684;subscription</span><br><span class=\"line\">        subscriptionFound = postSingleEventForEventType(event, postingState, eventClass);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    //&#x5982;&#x679C;&#x6CA1;&#x6709;&#x627E;&#x5230;&#xFF0C;&#x5219;&#x53D1;&#x5E03;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x7684;event</span><br><span class=\"line\">    if (!subscriptionFound) {</span><br><span class=\"line\">        if (logNoSubscriberMessages) {</span><br><span class=\"line\">            logger.log(Level.FINE, &quot;No subscribers registered for event &quot; + eventClass);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        if (sendNoSubscriberEvent &amp;&amp; eventClass != NoSubscriberEvent.class &amp;&amp;</span><br><span class=\"line\">                eventClass != SubscriberExceptionEvent.class) {</span><br><span class=\"line\">            post(new NoSubscriberEvent(this, event));</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x6E90;&#x7801;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x5173;&#x952E;&#x4EE3;&#x7801;&#x662F;postSingleEventForEventType&#x65B9;&#x6CD5;&#xFF0C;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;subscriptions&#xFF0C;&#x5373;&#x6240;&#x4EE5;&#x4E0E;&#x8BE5;eventType&#x76F8;&#x5173;&#x7684;&#x8BA2;&#x9605;&#x8005;&#x4E2D;&#x7684;&#x8BA2;&#x9605;&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private boolean postSingleEventForEventType(Object event, PostingThreadState postingState, Class&lt;?&gt; eventClass) {</span><br><span class=\"line\">    CopyOnWriteArrayList&lt;Subscription&gt; subscriptions;</span><br><span class=\"line\">    synchronized (this) {</span><br><span class=\"line\">    \t//&#x901A;&#x8FC7;eventType&#x6765;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;subscriptions</span><br><span class=\"line\">        subscriptions = subscriptionsByEventType.get(eventClass);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    if (subscriptions != null &amp;&amp; !subscriptions.isEmpty()) {</span><br><span class=\"line\">        for (Subscription subscription : subscriptions) {</span><br><span class=\"line\">            postingState.event = event;</span><br><span class=\"line\">            postingState.subscription = subscription;</span><br><span class=\"line\">            boolean aborted = false;</span><br><span class=\"line\">            try {</span><br><span class=\"line\">            \t//&#x53D1;&#x5E03;</span><br><span class=\"line\">                postToSubscription(subscription, event, postingState.isMainThread);</span><br><span class=\"line\">                aborted = postingState.canceled;</span><br><span class=\"line\">            } finally {</span><br><span class=\"line\">                postingState.event = null;</span><br><span class=\"line\">                postingState.subscription = null;</span><br><span class=\"line\">                postingState.canceled = false;</span><br><span class=\"line\">            }</span><br><span class=\"line\">            if (aborted) {</span><br><span class=\"line\">                break;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        return true;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return false;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8BE5;&#x65B9;&#x6CD5;&#x505A;&#x7684;&#x5C31;&#x662F;&#x4ECE;subscriptionsByEventType&#x4E2D;&#x627E;&#x5230;&#x5BF9;&#x5E94;eventType&#x7684;subscriptions&#xFF0C;&#x7136;&#x540E;&#x8F6C;&#x5165;&#x5230;postToSubscription&#x65B9;&#x6CD5;&#x4E2D;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void postToSubscription(Subscription subscription, Object event, boolean isMainThread) {</span><br><span class=\"line\">    switch (subscription.subscriberMethod.threadMode) {</span><br><span class=\"line\">        case POSTING:</span><br><span class=\"line\">        \t//&#x8C03;&#x7528;&#x8BA2;&#x9605;&#x8005;&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;</span><br><span class=\"line\">            invokeSubscriber(subscription, event);</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        case MAIN:</span><br><span class=\"line\">        \t//&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;</span><br><span class=\"line\">            if (isMainThread) {</span><br><span class=\"line\">            \t//&#x8C03;&#x7528;&#x8BA2;&#x9605;&#x8005;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;</span><br><span class=\"line\">                invokeSubscriber(subscription, event);</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">            \t//&#x52A0;&#x5165;&#x5230;&#x4E3B;&#x7EBF;&#x7A0B;&#x6392;&#x961F;&#x8FDB;&#x884C;&#x5206;&#x53D1;</span><br><span class=\"line\">                mainThreadPoster.enqueue(subscription, event);</span><br><span class=\"line\">            }</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        case MAIN_ORDERED:</span><br><span class=\"line\">            if (mainThreadPoster != null) {</span><br><span class=\"line\">            //&#x52A0;&#x5165;&#x5230;&#x4E3B;&#x7EBF;&#x7A0B;&#x6392;&#x961F;&#x8FDB;&#x884C;&#x5206;&#x53D1;</span><br><span class=\"line\">                mainThreadPoster.enqueue(subscription, event);</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                // temporary: technically not correct as poster not decoupled from subscriber</span><br><span class=\"line\">                //&#x8C03;&#x7528;&#x8BA2;&#x9605;&#x8005;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;</span><br><span class=\"line\">                invokeSubscriber(subscription, event);</span><br><span class=\"line\">            }</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        case BACKGROUND:</span><br><span class=\"line\">            if (isMainThread) {</span><br><span class=\"line\">            \t//&#x52A0;&#x5165;&#x5230;&#x540E;&#x53F0;&#x7EBF;&#x7A0B;&#x6392;&#x961F;&#x8FDB;&#x884C;&#x5206;&#x53D1;</span><br><span class=\"line\">                backgroundPoster.enqueue(subscription, event);</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">            \t//&#x8C03;&#x7528;&#x8BA2;&#x9605;&#x8005;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;</span><br><span class=\"line\">                invokeSubscriber(subscription, event);</span><br><span class=\"line\">            }</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        case ASYNC:</span><br><span class=\"line\">        \t//&#x52A0;&#x5165;&#x5230;&#x5F02;&#x6B65;&#x7EBF;&#x7A0B;&#x6392;&#x961F;&#x8FDB;&#x884C;&#x5206;&#x53D1;</span><br><span class=\"line\">            asyncPoster.enqueue(subscription, event);</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        default:</span><br><span class=\"line\">            throw new IllegalStateException(&quot;Unknown thread mode: &quot; + subscription.subscriberMethod.threadMode);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;threadMode&#x8FDB;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x5206;&#x522B;&#x4E3A;</p>\n<ul>\n<li>POSTING&#xFF1A;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;</li>\n<li>MAIN&#xFF1A;&#x4E3B;&#x7EBF;&#x7A0B;</li>\n<li>MAIN_ORDERED&#xFF1A;&#x4E3B;&#x7EBF;&#x7A0B;&#x6392;&#x961F;&#x5206;&#x53D1;</li>\n<li>BACKGROUND&#xFF1A;&#x540E;&#x53F0;&#x7EBF;&#x7A0B;</li>\n<li>ASYNC&#xFF1A;&#x5F02;&#x6B65;&#x7EBF;&#x7A0B;&#x6C60;</li>\n</ul>\n<p>&#x4E0D;&#x7BA1;&#x662F;&#x6392;&#x961F;&#x5206;&#x53D1;&#x8FD8;&#x662F;&#x76F4;&#x63A5;&#x5206;&#x53D1;&#xFF0C;&#x6700;&#x7EC8;&#x90FD;&#x4F1A;&#x8C03;&#x7528;invokeSubscriber&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void invokeSubscriber(Subscription subscription, Object event) {</span><br><span class=\"line\">    try {</span><br><span class=\"line\">    \t//&#x5229;&#x7528;&#x57FA;&#x672C;&#x7684;&#x53CD;&#x5C04;&#x673A;&#x5236;&#x6765;&#x8C03;&#x7528;&#x8BA2;&#x9605;&#x8005;&#x4E2D;&#x7684;&#x5BF9;&#x4E8E;&#x65B9;&#x6CD5;</span><br><span class=\"line\">        subscription.subscriberMethod.method.invoke(subscription.subscriber, event);</span><br><span class=\"line\">    } catch (InvocationTargetException e) {</span><br><span class=\"line\">        handleSubscriberException(subscription, event, e.getCause());</span><br><span class=\"line\">    } catch (IllegalAccessException e) {</span><br><span class=\"line\">        throw new IllegalStateException(&quot;Unexpected exception&quot;, e);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x7EC8;&#x7684;&#x53D1;&#x5E03;&#x5B9E;&#x73B0;&#x8FD8;&#x662F;&#x4F7F;&#x7528;&#x4E86;&#x53CD;&#x5C04;&#x7684;&#x539F;&#x7406;&#xFF0C;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x6765;&#x5B9A;&#x4E49;&#x8BA2;&#x9605;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5230;&#x8FD9;&#x91CC;EventBus&#x7684;&#x53D1;&#x5E03;&#x8FC7;&#x7A0B;&#x5C31;&#x7ED3;&#x675F;&#x4E86;&#x3002;&#x4E0B;&#x9762;&#x8FDB;&#x5165;&#x6700;&#x540E;&#x7684;EventBus&#x7684;&#x6CE8;&#x9500;&#x3002;</p>\n<h2 id=\"EventBus&#x7684;&#x6CE8;&#x9500;\"><a href=\"#EventBus&#x7684;&#x6CE8;&#x9500;\" class=\"headerlink\" title=\"EventBus&#x7684;&#x6CE8;&#x9500;\"></a>EventBus&#x7684;&#x6CE8;&#x9500;</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public synchronized void unregister(Object subscriber) {</span><br><span class=\"line\">\t//&#x901A;&#x8FC7;&#x8BA2;&#x9605;&#x8005;&#x67E5;&#x627E;&#x5230;&#x6240;&#x6709;&#x7684;eventType</span><br><span class=\"line\">    List&lt;Class&lt;?&gt;&gt; subscribedTypes = typesBySubscriber.get(subscriber);</span><br><span class=\"line\">    if (subscribedTypes != null) {</span><br><span class=\"line\">        for (Class&lt;?&gt; eventType : subscribedTypes) {</span><br><span class=\"line\">        \t//&#x6CE8;&#x9500;&#x6240;&#x6709;&#x7684;subscriptions</span><br><span class=\"line\">            unsubscribeByEventType(subscriber, eventType);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        //&#x5220;&#x9664;&#x6CE8;&#x9500;&#x7684;&#x8BA2;&#x9605;&#x8005;</span><br><span class=\"line\">        typesBySubscriber.remove(subscriber);</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        logger.log(Level.WARNING, &quot;Subscriber to unregister was not registered before: &quot; + subscriber.getClass());</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x590D;&#x6742;&#x7684;&#x90FD;&#x5DF2;&#x7ECF;&#x5206;&#x6790;&#x5B8C;&#x4E86;&#xFF0C;&#x76F8;&#x5BF9;&#x6765;&#x8BF4;EventBus&#x7684;&#x6CE8;&#x9500;&#x5C31;&#x7B80;&#x5355;&#x591A;&#x4E86;&#xFF0C;&#x65E0;&#x975E;&#x5220;&#x9664;&#x5BF9;&#x4E8E;&#x7684;&#x8D44;&#x6E90;&#x4FE1;&#x606F;&#x3002;&#x5728;unregister&#x4E2D;&#x9996;&#x5148;&#x901A;&#x8FC7;typesBySubscriber&#x627E;&#x5230;&#x8BA2;&#x9605;&#x8005;&#x7684;&#x6240;&#x4EE5;eventType&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;unsubscribeByEventType&#x65B9;&#x6CD5;&#x6765;&#x5220;&#x9664;&#x6240;&#x6709;&#x7684;subscriptions&#xFF0C;&#x6700;&#x540E;&#x5C06;&#x8BA2;&#x9605;&#x8005;&#x4ECE;typesBySubscriber&#x4E2D;&#x79FB;&#x9664;&#x3002;&#x90A3;&#x4E48;&#x6700;&#x540E;&#x518D;&#x6765;&#x770B;&#x4E0B;unsubscribeByEventType&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void unsubscribeByEventType(Object subscriber, Class&lt;?&gt; eventType) {</span><br><span class=\"line\">\t//&#x901A;&#x8FC7;eventType&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;subscriptions</span><br><span class=\"line\">    List&lt;Subscription&gt; subscriptions = subscriptionsByEventType.get(eventType);</span><br><span class=\"line\">    if (subscriptions != null) {</span><br><span class=\"line\">        int size = subscriptions.size();</span><br><span class=\"line\">        //&#x904D;&#x5386;&#x6240;&#x6709;&#x7684;subscription</span><br><span class=\"line\">        for (int i = 0; i &lt; size; i++) {</span><br><span class=\"line\">            Subscription subscription = subscriptions.get(i);</span><br><span class=\"line\">            if (subscription.subscriber == subscriber) {</span><br><span class=\"line\">            \t//&#x8BBE;&#x7F6E;subscription&#x7684;&#x72B6;&#x6001;&#x4E3A;&#x975E;&#x6D3B;&#x8DC3;&#x72B6;&#x6001;&#xFF0C;&#x4FDD;&#x8BC1;&#x6B63;&#x5728;&#x4E8B;&#x4EF6;&#x5206;&#x53D1;&#x65F6;&#xFF0C;&#x8BE5;subscription&#x4E0D;&#x88AB;&#x5206;&#x53D1;</span><br><span class=\"line\">                subscription.active = false;</span><br><span class=\"line\">                //&#x5220;&#x9664;</span><br><span class=\"line\">                subscriptions.remove(i);</span><br><span class=\"line\">                i--;</span><br><span class=\"line\">                size--;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x903B;&#x8F91;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x66F4;&#x65B0;subscriptionsByEventType&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5C06;&#x6CE8;&#x9500;&#x7684;&#x8BA2;&#x9605;&#x8005;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x79FB;&#x9664;&#x3002;&#x5230;&#x8FD9;&#x91CC;EventBus&#x7684;&#x6CE8;&#x9500;&#x4E5F;&#x5206;&#x6790;&#x5B8C;&#x6BD5;&#x3002;</p>\n<h2 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h2><p>EventBus&#x7684;&#x4E3B;&#x8981;&#x6D41;&#x7A0B;&#x662F;&#xFF1A;&#x5BF9;&#x9700;&#x8981;&#x8BA2;&#x9605;&#x7684;&#x7C7B;&#x8FDB;&#x884C;register&#xFF0C;&#x5728;register&#x8FC7;&#x7A0B;&#x4E2D;&#x6839;&#x636E;ignoreGeneratedIndex&#x5B57;&#x6BB5;&#x6765;&#x5206;&#x522B;&#x8FDB;&#x884C;index&#x7D22;&#x5F15;&#x6216;&#x8005;&#x53CD;&#x5C04;&#x673A;&#x5236;&#x83B7;&#x53D6;&#x8BA2;&#x9605;&#x8005;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x65B9;&#x6CD5;&#x4FE1;&#x606F;&#xFF0C;&#x53E6;&#x5916;&#x5982;&#x679C;index&#x7D22;&#x5F15;&#x65B9;&#x6CD5;&#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x5230;&#x5BF9;&#x4E8E;&#x7684;&#x65B9;&#x6CD5;&#x4FE1;&#x606F;&#xFF0C;&#x6700;&#x540E;&#x8FD8;&#x662F;&#x4F1A;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x673A;&#x5236;&#x4FDD;&#x5E95;&#x83B7;&#x53D6;&#xFF1B;&#x7136;&#x540E;&#x5C31;&#x662F;subscribe&#xFF0C;&#x5C06;&#x83B7;&#x53D6;&#x5230;&#x7684;&#x65B9;&#x6CD5;&#x4FE1;&#x606F;&#x4FE1;&#x606F;&#x8FDB;&#x884C;&#x4FDD;&#x5B58;&#xFF1B;&#x8FDB;&#x4E00;&#x6B65;&#x5C31;&#x662F;post&#xFF0C;&#x4ECE;&#x4FDD;&#x5B58;&#x7684;&#x65B9;&#x6CD5;&#x4FE1;&#x606F;&#x4E2D;&#x8FDB;&#x884C;&#x5339;&#x914D;&#x5230;&#x5BF9;&#x4E8E;&#x7684;event&#x65B9;&#x6CD5;&#xFF0C;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x673A;&#x5236;&#x7684;invoke&#x8C03;&#x7528;&#x5339;&#x914D;&#x7684;&#x65B9;&#x6CD5;&#xFF1B;&#x6700;&#x540E;&#x5BF9;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x8BA2;&#x9605;&#x8005;&#x8FDB;&#x884C;&#x6CE8;&#x9500;&#xFF0C;&#x91CA;&#x653E;&#x8D44;&#x6E90;&#x3002;</p>\n<h2 id=\"&#x5173;&#x6CE8;\"><a href=\"#&#x5173;&#x6CE8;\" class=\"headerlink\" title=\"&#x5173;&#x6CE8;\"></a>&#x5173;&#x6CE8;</h2><p><img src=\"/2018/02/27/EventBus&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x603B;&#x7ED3;/wx.jpg\" alt=\"&#x602A;&#x8C08;&#x65F6;&#x95F4;&#x5230;&#x4E86;\"></p>\n","categories":["android"],"tags":["源码分析"]},{"title":"Fresco源码分析之Producer","url":"https://www.rousetime.com/2017/12/28/Fresco源码分析之Producer/","content":"<p>Fresco&#x6709;&#x4E09;&#x7EA7;&#x7F13;&#x5B58;&#xFF0C;&#x5206;&#x522B;&#x4E3A;Bitmap&#x7F13;&#x5B58;&#x3001;&#x672A;&#x89E3;&#x7801;&#x56FE;&#x7247;&#x7684;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x4E0E;&#x78C1;&#x76D8;&#x7F13;&#x5B58;&#x3002;&#x5982;&#x679C;&#x8FD9;&#x4E09;&#x7EA7;&#x7F13;&#x5B58;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x8BF7;&#x6C42;&#x7684;&#x56FE;&#x7247;&#x65F6;&#xFF0C;&#x624D;&#x4F1A;&#x8D70;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x8FD9;&#x6761;&#x8DEF;&#x3002;&#x90A3;&#x4E48;Fresco&#x53C8;&#x662F;&#x600E;&#x4E48;&#x7BA1;&#x7406;&#x8FD9;&#x4E9B;&#x7F13;&#x5B58;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x5982;&#x4F55;&#x4ECE;&#x8FD9;&#x4E9B;&#x6B65;&#x9AA4;&#x4E2D;&#x83B7;&#x53D6;&#x5230;&#x6700;&#x7EC8;&#x7684;Result&#x5E76;&#x4E14;&#x8FD4;&#x56DE;&#x7ED9;UI&#x5C42;&#x7684;&#x5462;&#xFF1F;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5C31;&#x8BE5;Producer&#x51FA;&#x573A;&#x4E86;&#x3002;</p>\n<h2 id=\"Producer\"><a href=\"#Producer\" class=\"headerlink\" title=\"Producer\"></a>Producer</h2><p>&#x9996;&#x5148;Producer&#x662F;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x5185;&#x90E8;&#x5C31;&#x4E00;&#x4E2A;&#x5F85;&#x5B9E;&#x73B0;&#x7684;&#x65B9;&#x6CD5;produceResults</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface Producer&lt;T&gt; {</span><br><span class=\"line\"> </span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * Start producing results for given context. Provided consumer is notified whenever progress is</span><br><span class=\"line\">   * made (new value is ready or error occurs).</span><br><span class=\"line\">   * @param consumer</span><br><span class=\"line\">   * @param context</span><br><span class=\"line\">   */</span><br><span class=\"line\">  void produceResults(Consumer&lt;T&gt; consumer, ProducerContext context);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>Producer&#x4E3B;&#x8981;&#x7528;&#x6765;&#x6267;&#x884C;&#x5BF9;&#x56FE;&#x7247;&#x8D44;&#x6E90;&#x83B7;&#x53D6;&#x7684;&#x591A;&#x6837;&#x65B9;&#x5F0F;&#x5904;&#x7406;&#x3002;&#x4F8B;&#x5982;&#xFF1A;&#x7F51;&#x7EDC;&#x65B9;&#x5F0F;&#x3001;&#x78C1;&#x76D8;&#x7F13;&#x5B58;&#x65B9;&#x5F0F;&#x3001;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x65B9;&#x5F0F;&#x3001;&#x89E3;&#x7801;&#x65B9;&#x5F0F;&#x4E0E;&#x4E00;&#x4E9B;&#x65CB;&#x8F6C;&#x53D8;&#x6362;&#x7B49;&#x64CD;&#x4F5C;&#x3002;&#x8FD9;&#x91CC;&#x7684;Consumer&#x4E3B;&#x8981;&#x4F5C;&#x4E3A;&#x56DE;&#x8C03;&#xFF0C;&#x7531;&#x4E8E;Producer&#x591A;&#x6837;&#x65B9;&#x5F0F;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;&#x662F;&#x901A;&#x8FC7;&#x5185;&#x90E8;&#x9012;&#x5F52;&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x9012;&#x5F52;&#x56DE;&#x8C03;&#x5904;&#x7406;&#x662F;&#x5FC5;&#x4E0D;&#x53EF;&#x5C11;&#x7684;&#xFF1B;&#x540C;&#x65F6;&#x5BF9;&#x4E8E;&#x5185;&#x90E8;&#x9012;&#x5F52;&#x65F6;&#x4E00;&#x4E9B;&#x6570;&#x636E;&#x7684;&#x4F20;&#x9012;&#xFF0C;&#x5219;&#x662F;&#x901A;&#x8FC7;ProducerContext&#x6765;&#x8FDB;&#x884C;&#x3002;ProducerContext&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x63D0;&#x4F9B;&#x83B7;&#x53D6;&#x9700;&#x8981;&#x4F20;&#x9012;&#x7684;&#x6570;&#x636E;&#x7684;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#x3002;</p>\n<h2 id=\"Result&#x5904;&#x7406;\"><a href=\"#Result&#x5904;&#x7406;\" class=\"headerlink\" title=\"Result&#x5904;&#x7406;\"></a>Result&#x5904;&#x7406;</h2><p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x4E0B;&#x6700;&#x7EC8;&#x7684;Producer&#x8FD4;&#x56DE;&#x7684;Result&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x3002;&#x770B;&#x4E0B;&#x5B83;&#x662F;&#x5982;&#x679C;&#x5C06;&#x6570;&#x636E;&#x4F20;&#x9012;&#x7ED9;UI&#x5C42;&#xFF0C;&#x4F7F;&#x5F97;UI&#x66F4;&#x65B0;&#x52A0;&#x8F7D;&#x7684;&#x56FE;&#x7247;&#x89C6;&#x56FE;&#x3002;</p>\n<p>&#x5728;&#x4E0A;&#x4E00;&#x7BC7;&#x5173;&#x4E8E;Controller&#x7684;&#x6587;&#x7AE0;&#x4E2D;&#xFF0C;&#x63D0;&#x5230;&#x5BF9;&#x4E8E;DataSource&#x662F;&#x901A;&#x8FC7;ImagePipeline&#x4E2D;&#x7684;fetchDecodeImage&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x6765;&#x91CD;&#x6E29;&#x5B83;&#x7684;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public DataSource&lt;CloseableReference&lt;CloseableImage&gt;&gt; fetchDecodedImage(</span><br><span class=\"line\">    ImageRequest imageRequest,</span><br><span class=\"line\">    Object callerContext,</span><br><span class=\"line\">    ImageRequest.RequestLevel lowestPermittedRequestLevelOnSubmit) {</span><br><span class=\"line\">  try {</span><br><span class=\"line\">    Producer&lt;CloseableReference&lt;CloseableImage&gt;&gt; producerSequence =</span><br><span class=\"line\">        mProducerSequenceFactory.getDecodedImageProducerSequence(imageRequest);</span><br><span class=\"line\">    return submitFetchRequest(</span><br><span class=\"line\">        producerSequence,</span><br><span class=\"line\">        imageRequest,</span><br><span class=\"line\">        lowestPermittedRequestLevelOnSubmit,</span><br><span class=\"line\">        callerContext);</span><br><span class=\"line\">  } catch (Exception exception) {</span><br><span class=\"line\">    return DataSources.immediateFailedDataSource(exception);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5982;&#x613F;&#x770B;&#x5230;&#x4E86;Producer&#xFF0C;&#x5B83;&#x7684;&#x5185;&#x90E8;&#x9012;&#x5F52;&#x5148;&#x4E0D;&#x770B;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x770B;&#x4E0B;&#x4E00;&#x6B65;submitFetchRequest&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private &lt;T&gt; DataSource&lt;CloseableReference&lt;T&gt;&gt; submitFetchRequest(</span><br><span class=\"line\">    Producer&lt;CloseableReference&lt;T&gt;&gt; producerSequence,</span><br><span class=\"line\">    ImageRequest imageRequest,</span><br><span class=\"line\">    ImageRequest.RequestLevel lowestPermittedRequestLevelOnSubmit,</span><br><span class=\"line\">    Object callerContext) {</span><br><span class=\"line\">  final RequestListener requestListener = getRequestListenerForRequest(imageRequest);</span><br><span class=\"line\"> </span><br><span class=\"line\">  try {</span><br><span class=\"line\">    ImageRequest.RequestLevel lowestPermittedRequestLevel =</span><br><span class=\"line\">        ImageRequest.RequestLevel.getMax(</span><br><span class=\"line\">            imageRequest.getLowestPermittedRequestLevel(),</span><br><span class=\"line\">            lowestPermittedRequestLevelOnSubmit);</span><br><span class=\"line\">    SettableProducerContext settableProducerContext = new SettableProducerContext(</span><br><span class=\"line\">        imageRequest,</span><br><span class=\"line\">        generateUniqueFutureId(),</span><br><span class=\"line\">        requestListener,</span><br><span class=\"line\">        callerContext,</span><br><span class=\"line\">        lowestPermittedRequestLevel,</span><br><span class=\"line\">      /* isPrefetch */ false,</span><br><span class=\"line\">        imageRequest.getProgressiveRenderingEnabled() ||</span><br><span class=\"line\">            imageRequest.getMediaVariations() != null ||</span><br><span class=\"line\">            !UriUtil.isNetworkUri(imageRequest.getSourceUri()),</span><br><span class=\"line\">        imageRequest.getPriority());</span><br><span class=\"line\">    return CloseableProducerToDataSourceAdapter.create(</span><br><span class=\"line\">        producerSequence,</span><br><span class=\"line\">        settableProducerContext,</span><br><span class=\"line\">        requestListener);</span><br><span class=\"line\">  } catch (Exception exception) {</span><br><span class=\"line\">    return DataSources.immediateFailedDataSource(exception);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x8BA9;&#x6211;&#x4EEC;&#x5B9A;&#x4F4D;&#x5230;SettableProducerContext&#xFF0C;&#x5B83;&#x5B9E;&#x73B0;&#x4E86;ProducerContext&#x63A5;&#x53E3;&#xFF0C;&#x7528;&#x6765;&#x5BF9;producerSequence&#x7684;&#x5185;&#x90E8;&#x9012;&#x5F52;&#x7684;&#x6570;&#x636E;&#x4F20;&#x9012;&#x3002;&#x4F8B;&#x5982;&#xFF1A;ImageRequest&#x3001;Id&#x3001;ProducerListener&#x4E0E;RequestLevel&#x7B49;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x4E0B;&#x4E00;&#x6B65;&#x5C31;&#x662F;&#x771F;&#x6B63;&#x7684;DataSource&#x7684;&#x521B;&#x5EFA;CloseableProducerToDataSourceAdapter.creat()&#x3002;&#x5B83;&#x7EE7;&#x627F;&#x4E8E;AbstractProducerToDataSourceAdapter&#xFF0C;&#x5B83;&#x7684;&#x7236;&#x7C7B;AbstractDataSource&#x5B9E;&#x73B0;&#x4E86;DataSource&#x63A5;&#x53E3;&#x3002;&#x5728;AbstractProducerToDataSourceAdapter&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#x80FD;&#x591F;&#x627E;&#x5230;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x4E1C;&#x897F;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected AbstractProducerToDataSourceAdapter(</span><br><span class=\"line\">    Producer&lt;T&gt; producer,</span><br><span class=\"line\">    SettableProducerContext settableProducerContext,</span><br><span class=\"line\">    RequestListener requestListener) {</span><br><span class=\"line\">  mSettableProducerContext = settableProducerContext;</span><br><span class=\"line\">  mRequestListener = requestListener;</span><br><span class=\"line\">  mRequestListener.onRequestStart(</span><br><span class=\"line\">      settableProducerContext.getImageRequest(),</span><br><span class=\"line\">      mSettableProducerContext.getCallerContext(),</span><br><span class=\"line\">      mSettableProducerContext.getId(),</span><br><span class=\"line\">      mSettableProducerContext.isPrefetch());</span><br><span class=\"line\">  //PostprocessedBitmapMemoryCacheProducer</span><br><span class=\"line\">  producer.produceResults(createConsumer(), settableProducerContext);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>settableProducerContext&#x6570;&#x636E;&#x4F20;&#x9012;&#x4F7F;&#x7528;&#x7684;&#x51FA;&#x795E;&#x5165;&#x5316;&#x3002;&#x8C03;&#x7528;&#x4E86;Producer&#x7684;produceResults&#x65B9;&#x6CD5;&#xFF0C;&#x5F00;&#x542F;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x5404;&#x4E2A;Producer&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;Producer&#x7684;produceResults&#x65B9;&#x6CD5;&#x4E2D;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x5230;&#x6700;&#x7EC8;&#x7684;&#x56FE;&#x7247;&#x8D44;&#x6E90;&#xFF0C;&#x90FD;&#x4F1A;&#x8C03;&#x7528;&#x4E0B;&#x4E00;&#x4E2A;Producer&#x7684;produceResults&#x65B9;&#x6CD5;&#xFF0C;&#x6700;&#x7EC8;&#x901A;&#x8FC7;Consumer&#x56DE;&#x8C03;&#x5230;&#x6700;&#x521D;&#x7684;Producer&#x4E2D;&#xFF0C;&#x5373;createConsumer()&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private Consumer&lt;T&gt; createConsumer() {</span><br><span class=\"line\">  return new BaseConsumer&lt;T&gt;() {</span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    protected void onNewResultImpl(@Nullable T newResult, @Status int status) {</span><br><span class=\"line\">      AbstractProducerToDataSourceAdapter.this.onNewResultImpl(newResult, status);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    protected void onFailureImpl(Throwable throwable) {</span><br><span class=\"line\">      AbstractProducerToDataSourceAdapter.this.onFailureImpl(throwable);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    protected void onCancellationImpl() {</span><br><span class=\"line\">      AbstractProducerToDataSourceAdapter.this.onCancellationImpl();</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    protected void onProgressUpdateImpl(float progress) {</span><br><span class=\"line\">      AbstractProducerToDataSourceAdapter.this.setProgress(progress);</span><br><span class=\"line\">    }</span><br><span class=\"line\">  };</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;createConsumer()&#x4E2D;&#x5206;&#x522B;&#x8C03;&#x7528;&#x4E86;onNewResultImpl&#x3001;onFailureImpl&#x3001;setProgress&#x4E0E;onCancellationImpl&#x65B9;&#x6CD5;&#x3002;&#x5206;&#x522B;&#x4EE3;&#x8868;&#x6210;&#x529F;&#x7684;&#x56DE;&#x8C03;&#x3001;&#x5931;&#x8D25;&#x7684;&#x56DE;&#x8C03;&#x3001;&#x8BF7;&#x6C42;&#x8FDB;&#x5EA6;&#x56DE;&#x8C03;&#x4E0E;&#x8BF7;&#x6C42;&#x53D6;&#x6D88;&#x56DE;&#x8C03;&#x3002;&#x5BF9;&#x4E8E;&#x524D;&#x4E09;&#x56DE;&#x8C03;&#x90FD;&#x4F1A;&#x89E6;&#x53D1;AbstractDataSource&#x4E2D;&#x7684;notifyDataSubscribers()&#x65B9;&#x6CD5;&#x3002;&#x4F8B;&#x5982;onNewResultImpl&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected void onNewResultImpl(@Nullable T result, int status) {</span><br><span class=\"line\">  boolean isLast = BaseConsumer.isLast(status);</span><br><span class=\"line\">  //setResult&#x5C06;&#x7ED3;&#x679C;&#x4F20;&#x5165;AbstractDataSource&#x4E2D;</span><br><span class=\"line\">  if (super.setResult(result, isLast)) {</span><br><span class=\"line\">    if (isLast) {</span><br><span class=\"line\">      mRequestListener.onRequestSuccess(</span><br><span class=\"line\">          mSettableProducerContext.getImageRequest(),</span><br><span class=\"line\">          mSettableProducerContext.getId(),</span><br><span class=\"line\">          mSettableProducerContext.isPrefetch());</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8C03;&#x7528;&#x4E86;&#x7236;&#x7C7B;&#x7684;super.setResult()&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected boolean setResult(@Nullable T value, boolean isLast) {</span><br><span class=\"line\">  //&#x5C06;&#x4ECE;Producer&#x4E2D;&#x83B7;&#x53D6;&#x90FD;&#x7684;&#x6570;&#x636E;&#x6E90;&#x4FDD;&#x5B58;&#x5230;mResult&#x4E2D;,&#x5916;&#x90E8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;getResult&#x83B7;&#x53D6;&#x3002;</span><br><span class=\"line\">  boolean result = setResultInternal(value, isLast);</span><br><span class=\"line\">  if (result) {</span><br><span class=\"line\">    notifyDataSubscribers();</span><br><span class=\"line\">  }</span><br><span class=\"line\">  return result;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>Result&#x4FDD;&#x5B58;&#x5230;DataSource&#x4E2D;&#x7684;mResult&#x4E2D;&#xFF0C;&#x5728;&#x4E4B;&#x524D;&#x7684;Controller&#x4E2D;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8C03;&#x7528;DataSource&#x7684;getResult&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x8BF7;&#x6C42;&#x7684;Result&#x3002;Controller&#x5BF9;DataSource&#x7684;&#x8BA2;&#x9605;&#x4E5F;&#x5C06;&#x901A;&#x8FC7;notifyDataSubscribers()&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x901A;&#x77E5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void notifyDataSubscribers() {</span><br><span class=\"line\">  final boolean isFailure = hasFailed();</span><br><span class=\"line\">  final boolean isCancellation = wasCancelled();</span><br><span class=\"line\">  //&#x901A;&#x77E5;&#x6240;&#x6709;&#x7684;&#x8BA2;&#x9605;&#x8005;</span><br><span class=\"line\">  for (Pair&lt;DataSubscriber&lt;T&gt;, Executor&gt; pair : mSubscribers) {</span><br><span class=\"line\">    notifyDataSubscriber(pair.first, pair.second, isFailure, isCancellation);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">private void notifyDataSubscriber(</span><br><span class=\"line\">    final DataSubscriber&lt;T&gt; dataSubscriber,</span><br><span class=\"line\">    final Executor executor,</span><br><span class=\"line\">    final boolean isFailure,</span><br><span class=\"line\">    final boolean isCancellation) {</span><br><span class=\"line\">  executor.execute(</span><br><span class=\"line\">      new Runnable() {</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void run() {</span><br><span class=\"line\">          if (isFailure) {</span><br><span class=\"line\">            dataSubscriber.onFailure(AbstractDataSource.this);</span><br><span class=\"line\">          } else if (isCancellation) {</span><br><span class=\"line\">            dataSubscriber.onCancellation(AbstractDataSource.this);</span><br><span class=\"line\">          } else {</span><br><span class=\"line\">            dataSubscriber.onNewResult(AbstractDataSource.this);</span><br><span class=\"line\">          }</span><br><span class=\"line\">        }</span><br><span class=\"line\">      });</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>executor.execute()&#x65B9;&#x6CD5;&#x89E3;&#x91CA;&#x4E86;&#x4E00;&#x5207;&#x3002;&#x8C03;&#x7528;&#x4E86;Controller&#x4E2D;&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;dataSubscriber&#x7684;&#x5404;&#x4E2A;&#x56DE;&#x8C03;&#x3002;&#x90A3;&#x4E48;Result&#x7684;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x5C31;&#x8D70;&#x901A;&#x4E86;&#x3002;</p>\n<blockquote>\n<p>&#x5982;&#x9700;&#x4E86;&#x89E3;Controller&#xFF0C;&#x63A8;&#x8350;&#x9605;&#x8BFB;<a href=\"https://idisfkj.github.io/2017/12/14/Fresco%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8BController/\" target=\"_blank\" rel=\"noopener\">Fresco&#x6E90;&#x7801;&#x5206;&#x6790;&#x4E4B;Controller\n</a></p>\n</blockquote>\n<h2 id=\"Producer&#x7684;&#x5144;&#x5F1F;&#x59D0;&#x59B9;\"><a href=\"#Producer&#x7684;&#x5144;&#x5F1F;&#x59D0;&#x59B9;\" class=\"headerlink\" title=\"Producer&#x7684;&#x5144;&#x5F1F;&#x59D0;&#x59B9;\"></a>Producer&#x7684;&#x5144;&#x5F1F;&#x59D0;&#x59B9;</h2><p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x6765;&#x8BA4;&#x8BC6;&#x4E0B;Producer&#x7684;&#x5BB6;&#x5EAD;&#x6210;&#x5458;&#x3002;&#x56DE;&#x5230;&#x6700;&#x521D;&#x7684;fetchDecodedImage()&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x627E;&#x5230;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Producer&lt;CloseableReference&lt;CloseableImage&gt;&gt; producerSequence =</span><br><span class=\"line\">    mProducerSequenceFactory.getDecodedImageProducerSequence(imageRequest);</span><br></pre></td></tr></table></figure>\n<p>Producer&#x7684;&#x5BB6;&#x5EAD;&#x6210;&#x5458;&#x7684;&#x51FA;&#x751F;&#x5730;&#x90FD;&#x662F;ProducerSequenceFactory&#x5DE5;&#x5382;&#x3002;&#x6700;&#x5148;&#x51FA;&#x751F;&#x7684;&#x662F;&#x89E3;&#x7801;&#x4E86;&#x7684;ImageProducer&#x6210;&#x5458;&#x3002;&#x901A;&#x8FC7;getDecodeImageProducerSquence()&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public Producer&lt;CloseableReference&lt;CloseableImage&gt;&gt; getDecodedImageProducerSequence(</span><br><span class=\"line\">    ImageRequest imageRequest) {</span><br><span class=\"line\">  //&#x901A;&#x8FC7;Uri&#x7C7B;&#x578B;&#x6765;&#x83B7;&#x53D6;&#x4E0D;&#x540C;&#x7684;&#x8BF7;&#x6C42;&#x961F;&#x5217;</span><br><span class=\"line\">  Producer&lt;CloseableReference&lt;CloseableImage&gt;&gt; pipelineSequence =</span><br><span class=\"line\">      getBasicDecodedImageSequence(imageRequest);</span><br><span class=\"line\"> </span><br><span class=\"line\">  // &#x901A;&#x8FC7;ImageRequestBuilder.setPostprocessor()&#x8BBE;&#x7F6E;, &#x4E00;&#x822C;&#x4E3A;null&#x3002;</span><br><span class=\"line\">  // &#x4F5C;&#x7528;&#x662F;&#x7528;&#x6765;&#x5BF9;&#x83B7;&#x53D6;&#x5230;&#x7684;Bitmap&#x8FDB;&#x884C;&#x52A0;&#x5DE5;&#x5904;&#x7406;&#x3002;&#x4F8B;&#x5982;&#xFF1A;&#x6DFB;&#x52A0;&#x6C34;&#x5370;&#x7B49;&#x3002;</span><br><span class=\"line\">  if (imageRequest.getPostprocessor() != null) {</span><br><span class=\"line\">    pipelineSequence = getPostprocessorSequence(pipelineSequence);</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  //&#x4E00;&#x822C;&#x7528;&#x6765;&#x5B9E;&#x9A8C;&#xFF0C;ImagePipelineConfig.Builder-&gt;ImagePipelineExperiments-&gt;setBitmapPrepareToDraw</span><br><span class=\"line\">  //&#x6240;&#x4EE5;&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x90FD;&#x4E3A;false</span><br><span class=\"line\">  if (mUseBitmapPrepareToDraw) {</span><br><span class=\"line\">    pipelineSequence = getBitmapPrepareSequence(pipelineSequence);</span><br><span class=\"line\">  }</span><br><span class=\"line\">  return pipelineSequence;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x7684;&#x6CE8;&#x91CA;&#x5DF2;&#x7ECF;&#x5F88;&#x6E05;&#x695A;&#x4E86;&#xFF0C;&#x6B63;&#x5E38;&#x7684;&#x6D41;&#x7A0B;&#x53EA;&#x9700;&#x5173;&#x6CE8;getBasicDecodedImageSequence()&#x65B9;&#x6CD5;&#x3002;&#x5176;&#x5B83;&#x7684;&#x90FD;&#x662F;&#x5BF9;&#x83B7;&#x53D6;&#x5230;&#x7684;Result&#x8FDB;&#x884C;&#x52A0;&#x5DE5;&#x5904;&#x7406;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x771F;&#x6B63;&#x7684;Result&#x83B7;&#x53D6;&#x6B65;&#x9AA4;&#x3002;&#x90A3;&#x4E48;&#x7EE7;&#x7EED;&#x770B;getBasicDecodedImageSequence&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private Producer&lt;CloseableReference&lt;CloseableImage&gt;&gt; getBasicDecodedImageSequence(</span><br><span class=\"line\">    ImageRequest imageRequest) {</span><br><span class=\"line\">  Preconditions.checkNotNull(imageRequest);</span><br><span class=\"line\"> </span><br><span class=\"line\">  Uri uri = imageRequest.getSourceUri();</span><br><span class=\"line\">  Preconditions.checkNotNull(uri, &quot;Uri is null.&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">  switch (imageRequest.getSourceUriType()) {</span><br><span class=\"line\">    case SOURCE_TYPE_NETWORK:</span><br><span class=\"line\">      return getNetworkFetchSequence();</span><br><span class=\"line\">    case SOURCE_TYPE_LOCAL_VIDEO_FILE:</span><br><span class=\"line\">      return getLocalVideoFileFetchSequence();</span><br><span class=\"line\">    case SOURCE_TYPE_LOCAL_IMAGE_FILE:</span><br><span class=\"line\">      return getLocalImageFileFetchSequence();</span><br><span class=\"line\">    case SOURCE_TYPE_LOCAL_CONTENT:</span><br><span class=\"line\">      if (MediaUtils.isVideo(mContentResolver.getType(uri))) {</span><br><span class=\"line\">        return getLocalVideoFileFetchSequence();</span><br><span class=\"line\">      }</span><br><span class=\"line\">      return getLocalContentUriFetchSequence();</span><br><span class=\"line\">    case SOURCE_TYPE_LOCAL_ASSET:</span><br><span class=\"line\">      return getLocalAssetFetchSequence();</span><br><span class=\"line\">    case SOURCE_TYPE_LOCAL_RESOURCE:</span><br><span class=\"line\">      return getLocalResourceFetchSequence();</span><br><span class=\"line\">    case SOURCE_TYPE_QUALIFIED_RESOURCE:</span><br><span class=\"line\">      return getQualifiedResourceFetchSequence();</span><br><span class=\"line\">    case SOURCE_TYPE_DATA:</span><br><span class=\"line\">      return getDataFetchSequence();</span><br><span class=\"line\">    default:</span><br><span class=\"line\">      throw new IllegalArgumentException(</span><br><span class=\"line\">          &quot;Unsupported uri scheme! Uri is: &quot; + getShortenedUriString(uri));</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5230;&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5206;&#x6C34;&#x5CAD;&#xFF0C;&#x6839;&#x636E;ImageRequest&#x7684;SourceUriType&#xFF0C;&#x6765;&#x51B3;&#x5B9A;&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x8D44;&#x6E90;&#x7684;&#x83B7;&#x53D6;&#x65B9;&#x5F0F;&#x3002;&#x8FD9;&#x91CC;&#x4EE5;SOURCE_TYPE_NETWORK&#x8FDB;&#x884C;&#x8BE6;&#x7EC6;&#x5206;&#x6790;&#xFF0C;getNetworkFetchSequence&#x662F;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x7684;&#x83B7;&#x53D6;&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private synchronized Producer&lt;CloseableReference&lt;CloseableImage&gt;&gt; getNetworkFetchSequence() {</span><br><span class=\"line\">  if (mNetworkFetchSequence == null) {</span><br><span class=\"line\">    mNetworkFetchSequence =</span><br><span class=\"line\">        newBitmapCacheGetToDecodeSequence(getCommonNetworkFetchToEncodedMemorySequence());</span><br><span class=\"line\">  }</span><br><span class=\"line\">  return mNetworkFetchSequence;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6587;&#x7AE0;&#x5F00;&#x5934;&#x5DF2;&#x7ECF;&#x63D0;&#x53CA;&#x5230;Fresco&#x6709;&#x4E09;&#x7EA7;&#x7F13;&#x5B58;&#xFF1A;Bitmap&#x7F13;&#x5B58;&#x3001;&#x672A;&#x89E3;&#x7801;&#x56FE;&#x7247;&#x7684;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x4E0E;&#x78C1;&#x76D8;&#x7F13;&#x5B58;&#x3002;&#x6839;&#x636E;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x9996;&#x5148;&#x7684;&#x4ECE;Bitmap&#x7F13;&#x5B58;&#x5230;&#x56FE;&#x7247;&#x89E3;&#x7801;&#xFF0C;Bitmap&#x7F13;&#x5B58;&#x5728;newBitmapCacheGetToDecodeSequence&#x4E2D;&#x3002;&#x81F3;&#x4E8E;&#x56FE;&#x7247;&#x89E3;&#x7801;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x4E86;DecodeProducer&#x8FDB;&#x884C;&#x5B9E;&#x73B0;&#x3002;</p>\n<h3 id=\"Bitmap&#x7F13;&#x5B58;&#x7CFB;&#x5217;Producer\"><a href=\"#Bitmap&#x7F13;&#x5B58;&#x7CFB;&#x5217;Producer\" class=\"headerlink\" title=\"Bitmap&#x7F13;&#x5B58;&#x7CFB;&#x5217;Producer\"></a>Bitmap&#x7F13;&#x5B58;&#x7CFB;&#x5217;Producer</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private Producer&lt;CloseableReference&lt;CloseableImage&gt;&gt; newBitmapCacheGetToDecodeSequence(</span><br><span class=\"line\">    Producer&lt;EncodedImage&gt; inputProducer) {</span><br><span class=\"line\">  //&#x89E3;&#x7801;Producer,&#x5BF9;&#x4E8E;&#x56FE;&#x7247;&#x7684;&#x89E3;&#x7801;&#x64CD;&#x4F5C;&#x90FD;&#x5728;DecodeProducer&#x4E2D;&#x8FDB;&#x884C;</span><br><span class=\"line\">  DecodeProducer decodeProducer = mProducerFactory.newDecodeProducer(inputProducer);</span><br><span class=\"line\">  //&#x83B7;&#x53D6;Bitmap&#x7F13;&#x5B58;&#x8D44;&#x6E90;</span><br><span class=\"line\">  return newBitmapCacheGetToBitmapCacheSequence(decodeProducer);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\">  private Producer&lt;CloseableReference&lt;CloseableImage&gt;&gt; newBitmapCacheGetToBitmapCacheSequence(</span><br><span class=\"line\">    Producer&lt;CloseableReference&lt;CloseableImage&gt;&gt; inputProducer) {</span><br><span class=\"line\">  BitmapMemoryCacheProducer bitmapMemoryCacheProducer =</span><br><span class=\"line\">      mProducerFactory.newBitmapMemoryCacheProducer(inputProducer);</span><br><span class=\"line\">  BitmapMemoryCacheKeyMultiplexProducer bitmapKeyMultiplexProducer =</span><br><span class=\"line\">      mProducerFactory.newBitmapMemoryCacheKeyMultiplexProducer(bitmapMemoryCacheProducer);</span><br><span class=\"line\">  ThreadHandoffProducer&lt;CloseableReference&lt;CloseableImage&gt;&gt; threadHandoffProducer =</span><br><span class=\"line\">      mProducerFactory.newBackgroundThreadHandoffProducer(</span><br><span class=\"line\">          bitmapKeyMultiplexProducer,</span><br><span class=\"line\">          mThreadHandoffProducerQueue);</span><br><span class=\"line\">  return mProducerFactory.newBitmapMemoryCacheGetProducer(threadHandoffProducer);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x83B7;&#x53D6;Bitmap&#x7F13;&#x5B58;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F9D;&#x6B21;&#x4F7F;&#x7528;&#x4E86;BitmapMemoryCacheGetProducer&#x3001;ThreadHandoffProducer&#x3001;BitmapMemoryCacheKeyMultiplexProducer&#x4E0E;BitmapMemoryCacheProducer&#x3002;</p>\n<blockquote>\n<p>&#x5982;&#x679C;&#x60F3;&#x4E86;&#x89E3;&#x5982;&#x679C;&#x83B7;&#x53D6;Bitmap&#x7F13;&#x5B58;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x67E5;&#x770B;BitmapMemoryCacheProducer&#x3002;&#x7531;&#x4E8E;&#x7BC7;&#x5E45;&#x53D7;&#x9650;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x5BF9;&#x5404;&#x4E2A;Producer&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x8FDB;&#x884C;&#x89E3;&#x6790;&#xFF0C;&#x540E;&#x7EED;&#x4F1A;&#x5355;&#x72EC;&#x5F00;&#x7BC7;&#x5E45;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x3002;</p>\n</blockquote>\n<h3 id=\"&#x672A;&#x89E3;&#x7801;&#x56FE;&#x7247;&#x7684;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x4E0E;&#x78C1;&#x76D8;&#x7F13;&#x5B58;&#x7CFB;&#x5217;Producer\"><a href=\"#&#x672A;&#x89E3;&#x7801;&#x56FE;&#x7247;&#x7684;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x4E0E;&#x78C1;&#x76D8;&#x7F13;&#x5B58;&#x7CFB;&#x5217;Producer\" class=\"headerlink\" title=\"&#x672A;&#x89E3;&#x7801;&#x56FE;&#x7247;&#x7684;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x4E0E;&#x78C1;&#x76D8;&#x7F13;&#x5B58;&#x7CFB;&#x5217;Producer\"></a>&#x672A;&#x89E3;&#x7801;&#x56FE;&#x7247;&#x7684;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x4E0E;&#x78C1;&#x76D8;&#x7F13;&#x5B58;&#x7CFB;&#x5217;Producer</h3><p>&#x56DE;&#x5230;&#x4E4B;&#x524D;&#x7684;getNetworkFetchSequence&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x679C;Bitmap&#x7F13;&#x5B58;&#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x5230;&#x6700;&#x7EC8;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x90A3;&#x4E48;&#x4F1A;&#x8FDB;&#x5165;getCommonNetworkFetchToEncodedMemorySequence&#xFF0C;&#x8FDB;&#x4E00;&#x6B65;&#x901A;&#x8FC7;&#x672A;&#x89E3;&#x7801;&#x7684;&#x56FE;&#x7247;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x4E0E;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private synchronized Producer&lt;EncodedImage&gt; getCommonNetworkFetchToEncodedMemorySequence() {</span><br><span class=\"line\">  if (mCommonNetworkFetchToEncodedMemorySequence == null) {</span><br><span class=\"line\">    //&#x672A;&#x89E3;&#x7801;&#x7684;&#x56FE;&#x7247;&#x7F13;&#x5B58;&#x4E0E;&#x78C1;&#x76D8;&#x7F13;&#x5B58;-&gt;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;</span><br><span class=\"line\">    Producer&lt;EncodedImage&gt; inputProducer =</span><br><span class=\"line\">        newEncodedCacheMultiplexToTranscodeSequence(</span><br><span class=\"line\">            mProducerFactory.newNetworkFetchProducer(mNetworkFetcher));</span><br><span class=\"line\">    //&#x5BF9;&#x56FE;&#x7247;&#x7684;Meta Data&#x8FDB;&#x884C;&#x8F6C;&#x6362;</span><br><span class=\"line\">    mCommonNetworkFetchToEncodedMemorySequence =</span><br><span class=\"line\">        ProducerFactory.newAddImageTransformMetaDataProducer(inputProducer);</span><br><span class=\"line\">    //&#x5BF9;JPEG&#x683C;&#x5F0F;&#x7684;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x7F29;&#x653E;&#x4E0E;&#x65CB;&#x8F6C;&#x64CD;&#x4F5C;</span><br><span class=\"line\">    mCommonNetworkFetchToEncodedMemorySequence =</span><br><span class=\"line\">        mProducerFactory.newResizeAndRotateProducer(</span><br><span class=\"line\">            mCommonNetworkFetchToEncodedMemorySequence,</span><br><span class=\"line\">            mResizeAndRotateEnabledForNetwork,</span><br><span class=\"line\">            mUseDownsamplingRatio);</span><br><span class=\"line\">  }</span><br><span class=\"line\">  return mCommonNetworkFetchToEncodedMemorySequence;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x9996;&#x5148;&#x4F1A;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x8F6C;&#x6362;&#x64CD;&#x4F5C;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;ResizeAndRotateProducer&#x4F5C;&#x7528;&#x662F;&#x5BF9;JPEG&#x683C;&#x5F0F;&#x7684;&#x56FE;&#x7247;&#x6839;&#x636E;EXIF&#x7684;orientation&#x4E0E;&#x6307;&#x5B9A;&#x7684;rotation&#x8FDB;&#x884C;&#x7F29;&#x653E;&#x4E0E;&#x65CB;&#x8F6C;&#x64CD;&#x4F5C;&#x3002;&#x4E4B;&#x540E;&#x5C31;&#x662F;AddImageTransformMetaDataProducer&#x5BF9;&#x56FE;&#x7247;&#x7684;Meta Data&#x8FDB;&#x884C;&#x8F6C;&#x6362;&#x3002;&#x6700;&#x540E;&#x8C03;&#x7528;newEncodedCacheMultiplexToTranscodeSequence&#x8FDB;&#x884C;&#x672A;&#x89E3;&#x7801;&#x7684;&#x56FE;&#x7247;&#x7F13;&#x5B58;&#x4E0E;&#x78C1;&#x76D8;&#x7F13;&#x5B58;&#x64CD;&#x4F5C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private Producer&lt;EncodedImage&gt; newEncodedCacheMultiplexToTranscodeSequence(</span><br><span class=\"line\">    Producer&lt;EncodedImage&gt; inputProducer) {</span><br><span class=\"line\">  //&#x5BF9;webp&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x8F6C;&#x7801;</span><br><span class=\"line\">  if (WebpSupportStatus.sIsWebpSupportRequired &amp;&amp;</span><br><span class=\"line\">      (!mWebpSupportEnabled || WebpSupportStatus.sWebpBitmapFactory == null)) {</span><br><span class=\"line\">    inputProducer = mProducerFactory.newWebpTranscodeProducer(inputProducer);</span><br><span class=\"line\">  }</span><br><span class=\"line\">  //&#x78C1;&#x76D8;&#x7F13;&#x5B58;</span><br><span class=\"line\">  inputProducer = newDiskCacheSequence(inputProducer);</span><br><span class=\"line\">  //&#x672A;&#x89E3;&#x7801;&#x7684;&#x56FE;&#x7247;&#x7F13;&#x5B58;</span><br><span class=\"line\">  EncodedMemoryCacheProducer encodedMemoryCacheProducer =</span><br><span class=\"line\">      mProducerFactory.newEncodedMemoryCacheProducer(inputProducer);</span><br><span class=\"line\">  //&#x8FDB;&#x884C;&#x591A;&#x8DEF;&#x590D;&#x7528;&#x64CD;&#x4F5C;&#xFF0C;&#x901A;&#x8FC7;&#x672A;&#x89E3;&#x7801;&#x7684;&#x7F13;&#x5B58;&#x4F5C;&#x4E3A;key,&#x6765;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;request</span><br><span class=\"line\">  return mProducerFactory.newEncodedCacheKeyMultiplexProducer(encodedMemoryCacheProducer);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x5B83;&#x7684;&#x8C03;&#x7528;&#x94FE;&#x662F;&#xFF1A;EncodedCacheKeyMultiplexProducer -&gt; EncodedMemoryCacheProducer -&gt; newDiskCacheSequence -&gt; WebpTranscodeProducer&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4EE5;&#x4E0A;&#x6B65;&#x9AA4;&#x90FD;&#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x5230;&#x6700;&#x7EC8;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x6B63;&#x5F0F;&#x8FDB;&#x5165;&#x7F51;&#x7EDC;&#x83B7;&#x53D6;&#x3002;&#x5165;&#x53E3;&#x5728;mProducerFactory.newNetworkFetchProducer(mNetworkFetcher))&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;Producer&#x4E3A;NetworkFetchProducer&#x3002;</p>\n<h3 id=\"&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;Producer\"><a href=\"#&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;Producer\" class=\"headerlink\" title=\"&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;Producer\"></a>&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;Producer</h3><p>&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x662F;&#x6700;&#x7EC8;&#x7684;&#x83B7;&#x53D6;&#x65B9;&#x5F0F;&#xFF0C;&#x4E0B;&#x9762;&#x5BF9;NetworkFetchProducer&#x8FDB;&#x884C;&#x7B80;&#x8981;&#x5206;&#x6790;&#xFF0C;&#x76F4;&#x63A5;&#x770B;&#x5B83;&#x7684;&#x6700;&#x7EC8;&#x65B9;&#x6CD5;produceResults&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">public void produceResults(Consumer&lt;EncodedImage&gt; consumer, ProducerContext context) {</span><br><span class=\"line\">  context.getListener()</span><br><span class=\"line\">      .onProducerStart(context.getId(), PRODUCER_NAME);</span><br><span class=\"line\">  //&#x4FDD;&#x5B58;fetch&#x7684;&#x8BF7;&#x6C42;&#x72B6;&#x6001;&#x4FE1;&#x606F;(Consumer,ProducerContext)</span><br><span class=\"line\">  final FetchState fetchState = mNetworkFetcher.createFetchState(consumer, context);</span><br><span class=\"line\">  mNetworkFetcher.fetch(</span><br><span class=\"line\">      fetchState, new NetworkFetcher.Callback() {</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void onResponse(InputStream response, int responseLength) throws IOException {</span><br><span class=\"line\">          //&#x8BE5;response&#x5373;&#x4E3A;&#x6700;&#x7EC8;&#x8BF7;&#x6C42;&#x56FE;&#x7247;&#x7684;uri&#x54CD;&#x5E94;&#x8D44;&#x6E90;</span><br><span class=\"line\">          NetworkFetchProducer.this.onResponse(fetchState, response, responseLength);</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void onFailure(Throwable throwable) {</span><br><span class=\"line\">          NetworkFetchProducer.this.onFailure(fetchState, throwable);</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void onCancellation() {</span><br><span class=\"line\">          NetworkFetchProducer.this.onCancellation(fetchState);</span><br><span class=\"line\">        }</span><br><span class=\"line\">      });</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x9996;&#x5148;&#x901A;&#x8FC7;mNetworkFetcher&#x521B;&#x5EFA;&#x4E86;FetchState&#xFF0C;mNetworkFetcher&#x662F;&#x7F51;&#x7EDC;&#x5C42;&#x8BF7;&#x6C42;&#x65B9;&#x5F0F;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7279;&#x522B;&#x6307;&#x5B9A;&#xFF0C;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;HttpUrlConnection&#xFF0C;&#x5BF9;&#x5E94;&#x4E3A;HttpUrlConnectionNetworkFetcher&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x8C03;&#x4E86;fetch&#x65B9;&#x6CD5;&#xFF0C;&#x6B63;&#x5F0F;&#x53D1;&#x8D77;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x7EC6;&#x8282;&#x5B9E;&#x73B0;&#x5728;mNetworkFetcher&#x4E2D;&#x3002;&#x5BF9;&#x5E94;&#x7684;&#x56DE;&#x8C03;&#x54CD;&#x5E94;&#x4E3A;onResponse&#x3001;onFailure&#x4E0E;onCancellation&#xFF0C;&#x8FD9;&#x91CC;&#x62FF;onResponse&#x6B65;&#x9AA4;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void onResponse(</span><br><span class=\"line\">    FetchState fetchState,</span><br><span class=\"line\">    InputStream responseData,</span><br><span class=\"line\">    int responseContentLength)</span><br><span class=\"line\">    throws IOException {</span><br><span class=\"line\">  final PooledByteBufferOutputStream pooledOutputStream;</span><br><span class=\"line\">  //&#x83B7;&#x53D6;pooledOutputStream</span><br><span class=\"line\">  if (responseContentLength &gt; 0) {</span><br><span class=\"line\">    pooledOutputStream = mPooledByteBufferFactory.newOutputStream(responseContentLength);</span><br><span class=\"line\">  } else {</span><br><span class=\"line\">    pooledOutputStream = mPooledByteBufferFactory.newOutputStream();</span><br><span class=\"line\">  }</span><br><span class=\"line\">  final byte[] ioArray = mByteArrayPool.get(READ_SIZE);</span><br><span class=\"line\">  try {</span><br><span class=\"line\">    int length;</span><br><span class=\"line\">    while ((length = responseData.read(ioArray)) &gt;= 0) {</span><br><span class=\"line\">      if (length &gt; 0) {</span><br><span class=\"line\">        //&#x5C06;&#x6570;&#x636E;&#x5199;&#x5165;pooledOutputStream&#x4E2D;</span><br><span class=\"line\">        pooledOutputStream.write(ioArray, 0, length);</span><br><span class=\"line\">        //&#x5B9A;&#x65F6;&#x89E6;&#x53D1;consumer&#x56DE;&#x8C03;</span><br><span class=\"line\">        maybeHandleIntermediateResult(pooledOutputStream, fetchState);</span><br><span class=\"line\">        float progress = calculateProgress(pooledOutputStream.size(), responseContentLength);</span><br><span class=\"line\">        //&#x8FDB;&#x5EA6;&#x66F4;&#x65B0;</span><br><span class=\"line\">        fetchState.getConsumer().onProgressUpdate(progress);</span><br><span class=\"line\">      }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    mNetworkFetcher.onFetchCompletion(fetchState, pooledOutputStream.size());</span><br><span class=\"line\">    //&#x5168;&#x90E8;&#x6570;&#x636E;&#x83B7;&#x53D6;&#x5B8C;&#x6BD5;&#xFF0C;&#x56DE;&#x8C03;Consumer</span><br><span class=\"line\">    handleFinalResult(pooledOutputStream, fetchState);</span><br><span class=\"line\">  } finally {</span><br><span class=\"line\">    mByteArrayPool.release(ioArray);</span><br><span class=\"line\">    pooledOutputStream.close();</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x6CE8;&#x91CA;&#x89E3;&#x6790;&#xFF0C;&#x4E3B;&#x8981;&#x7684;&#x65B9;&#x6CD5;&#x5C31;&#x4E24;&#x4E2A;&#xFF1A;maybeHandleIntermediateResult&#x4E0E;handleFinalResult&#xFF0C;&#x4ED6;&#x4EEC;&#x90FD;&#x662F;&#x5BF9;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x7684;&#x7ED3;&#x679C;&#x8FDB;&#x884C;&#x53D1;&#x9001;&#x4F20;&#x9012;&#xFF0C;&#x4ED6;&#x4EEC;&#x7684;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x90FD;&#x662F;&#x8C03;&#x7528;notifyConsumer&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x56DE;&#x8C03;&#x901A;&#x77E5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void maybeHandleIntermediateResult(</span><br><span class=\"line\">    PooledByteBufferOutputStream pooledOutputStream,</span><br><span class=\"line\">    FetchState fetchState) {</span><br><span class=\"line\">  final long nowMs = SystemClock.uptimeMillis();</span><br><span class=\"line\">  //&#x65F6;&#x95F4;&#x95F4;&#x9694;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;100&#x6BEB;&#x79D2;&#x8FDB;&#x884C;&#x901A;&#x77E5;</span><br><span class=\"line\">  if (shouldPropagateIntermediateResults(fetchState) &amp;&amp;</span><br><span class=\"line\">      nowMs - fetchState.getLastIntermediateResultTimeMs() &gt;= TIME_BETWEEN_PARTIAL_RESULTS_MS) {</span><br><span class=\"line\">    fetchState.setLastIntermediateResultTimeMs(nowMs);</span><br><span class=\"line\">    fetchState.getListener()</span><br><span class=\"line\">        .onProducerEvent(fetchState.getId(), PRODUCER_NAME, INTERMEDIATE_RESULT_PRODUCER_EVENT);</span><br><span class=\"line\">    notifyConsumer(</span><br><span class=\"line\">        pooledOutputStream,</span><br><span class=\"line\">        fetchState.getOnNewResultStatusFlags(),</span><br><span class=\"line\">        fetchState.getResponseBytesRange(),</span><br><span class=\"line\">        fetchState.getConsumer());</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"> </span><br><span class=\"line\">private void handleFinalResult(</span><br><span class=\"line\">    PooledByteBufferOutputStream pooledOutputStream,</span><br><span class=\"line\">    FetchState fetchState) {</span><br><span class=\"line\">  Map&lt;String, String&gt; extraMap = getExtraMap(fetchState, pooledOutputStream.size());</span><br><span class=\"line\">  ProducerListener listener = fetchState.getListener();</span><br><span class=\"line\">  listener.onProducerFinishWithSuccess(fetchState.getId(), PRODUCER_NAME, extraMap);</span><br><span class=\"line\">  listener.onUltimateProducerReached(fetchState.getId(), PRODUCER_NAME, true);</span><br><span class=\"line\">  notifyConsumer(</span><br><span class=\"line\">      pooledOutputStream,</span><br><span class=\"line\">      Consumer.IS_LAST | fetchState.getOnNewResultStatusFlags(),</span><br><span class=\"line\">      fetchState.getResponseBytesRange(),</span><br><span class=\"line\">      fetchState.getConsumer());</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x4EEC;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x533A;&#x522B;&#x662F;maybeHandleIntermediateResult&#x662F;&#x95F4;&#x9694;&#x6027;&#x7684;&#x8C03;&#x7528;notifyConsumer&#x901A;&#x77E5;&#x56DE;&#x8C03;&#x8005;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x6700;&#x7EC8;&#x7684;&#x56DE;&#x8C03;&#x901A;&#x77E5;&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void notifyConsumer(</span><br><span class=\"line\">    PooledByteBufferOutputStream pooledOutputStream,</span><br><span class=\"line\">    @Consumer.Status int status,</span><br><span class=\"line\">    @Nullable BytesRange responseBytesRange,</span><br><span class=\"line\">    Consumer&lt;EncodedImage&gt; consumer) {</span><br><span class=\"line\">  //&#x5BF9;&#x4E8E;PooledByteBuffer&#x6784;&#x5EFA;&#x53EF;&#x5173;&#x95ED;&#x5F15;&#x7528;CloseableReference</span><br><span class=\"line\">  CloseableReference&lt;PooledByteBuffer&gt; result =</span><br><span class=\"line\">      CloseableReference.of(pooledOutputStream.toByteBuffer());</span><br><span class=\"line\">  EncodedImage encodedImage = null;</span><br><span class=\"line\">  try {</span><br><span class=\"line\">    //&#x4FDD;&#x5B58;&#x5230;EncodedImage&#x4E2D;</span><br><span class=\"line\">    encodedImage = new EncodedImage(result);</span><br><span class=\"line\">    encodedImage.setBytesRange(responseBytesRange);</span><br><span class=\"line\">    //&#x89E3;&#x6790;MetaData</span><br><span class=\"line\">    encodedImage.parseMetaData();</span><br><span class=\"line\">    //&#x56DE;&#x8C03;&#x901A;&#x77E5;</span><br><span class=\"line\">    consumer.onNewResult(encodedImage, status);</span><br><span class=\"line\">  } finally {</span><br><span class=\"line\">    EncodedImage.closeSafely(encodedImage);</span><br><span class=\"line\">    CloseableReference.closeSafely(result);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x9996;&#x5148;&#x5BF9;&#x7ED3;&#x679C;&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#xFF0C;&#x4FDD;&#x5B58;&#x5230;EncodedImage&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;Consumer&#x56DE;&#x8C03;onNewResult&#x65B9;&#x6CD5;&#x5C06;encodedImage&#x4F20;&#x9012;&#x5230;&#x4E0A;&#x4E00;&#x5C42;&#x7684;Producer&#x7CFB;&#x5217;&#xFF0C;&#x5373;&#x4E4B;&#x524D;&#x6240;&#x8FDB;&#x8FC7;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x672A;&#x89E3;&#x7801;&#x7684;&#x56FE;&#x7247;&#x7F13;&#x5B58;&#x4E0E;&#x78C1;&#x76D8;&#x7F13;&#x5B58;&#x64CD;&#x4F5C;&#x3002;&#x7B80;&#x5355;&#x7684;&#x8BF4;&#x5C31;&#x662F;&#x901A;&#x8FC7;Consumer&#x5BF9;&#x7ED3;&#x679C;&#x8FDB;&#x884C;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x89E3;&#x7801;&#x3001;&#x8F6C;&#x6362;&#x3001;&#x7F13;&#x5B58;&#x7B49;&#x64CD;&#x4F5C;&#xFF0C;&#x6700;&#x7EC8;&#x83B7;&#x53D6;&#x5230;Bitmap&#xFF0C;&#x4F20;&#x9012;&#x7ED9;UI&#x5C42;&#x8FDB;&#x884C;&#x56FE;&#x7247;&#x66F4;&#x65B0;&#x8BBE;&#x7F6E;&#x3002;</p>\n<blockquote>\n<p>HttpUrlConnectionNetworkFetcher&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#xFF0C;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x67E5;&#x770B;&#x6E90;&#x7801;&#xFF0C;&#x5185;&#x90E8;&#x5C31;&#x662F;&#x4F7F;&#x7528;HttpUrlConnection&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x8D44;&#x6E90;&#x8BF7;&#x6C42;&#x4E0E;&#x89E3;&#x6790;&#x3002;</p>\n</blockquote>\n<p>&#x5230;&#x8FD9;&#x91CC;&#x6574;&#x4E2A;&#x7684;Producer&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x5C31;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x90FD;&#x4F1A;&#x56DE;&#x5230;&#x5F00;&#x7BC7;&#x5206;&#x6790;&#x7684;Result&#x5904;&#x7406;&#xFF0C;AbstractProducerToDataSourceAdapter&#x4E2D;&#x7684;onNewResultImpl&#x65B9;&#x6CD5;&#xFF0C;&#x901A;&#x8FC7;super.setResult(result, isLast)&#x4F20;&#x9012;&#x7ED3;&#x679C;&#x4E0E;&#x901A;&#x77E5;UI&#x5C42;&#x66F4;&#x65B0;UI&#x3002;</p>\n<h2 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h2><p>&#x6700;&#x540E;&#x5BF9;Producer&#x7684;&#x6574;&#x4E2A;&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x505A;&#x4E2A;&#x603B;&#x7ED3;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x6E90;&#x7801;&#x4E2D;&#x7684;&#x6CE8;&#x91CA;&#x8C03;&#x7528;&#x94FE;&#xFF0C;&#x4E3B;&#x8981;&#x53EF;&#x5212;&#x5206;&#x4E3A;&#x4E09;&#x5927;&#x90E8;&#x5206;&#xFF0C;&#x5206;&#x522B;&#x4E3A;&#xFF1A;<br>swallow result if prefetch -&gt; bitmap cache get -&gt;<br>background thread hand-off -&gt; multiplex -&gt; bitmap cache -&gt; decode -&gt; multiplex -&gt;<br>encoded cache -&gt; disk cache -&gt; (webp transcode) -&gt; network fetch<br>&#x5206;&#x522B;&#x5BF9;&#x5E94;Bitmap&#x7F13;&#x5B58;&#x83B7;&#x53D6;&#x3001;&#x56FE;&#x7247;&#x89E3;&#x7801;&#x3001;&#x672A;&#x89E3;&#x7801;&#x56FE;&#x7247;&#x7F13;&#x5B58;&#x83B7;&#x53D6;&#x3001;&#x78C1;&#x76D8;&#x7F13;&#x5B58;&#x83B7;&#x53D6;&#x4E0E;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x3002;</p>\n","categories":["android"],"tags":["源码分析"]},{"title":"Fresco源码分析之Controller","url":"https://www.rousetime.com/2017/12/14/Fresco源码分析之Controller/","content":"<p>&#x5982;&#x679C;&#x4F60;&#x662F;&#x7B2C;&#x4E00;&#x6B21;&#x770B;&#x6211;&#x7684;<strong>Fresco</strong>&#x7684;&#x6E90;&#x7801;&#x5206;&#x6790;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#xFF0C;&#x8FD9;&#x91CC;&#x5F3A;&#x70C8;&#x63A8;&#x8350;&#x4F60;&#x5148;&#x9605;&#x8BFB;&#x6211;&#x7684;&#x524D;&#x9762;&#x4E24;&#x7BC7;&#x6587;&#x7AE0;<a href=\"https://idisfkj.github.io/2017/11/28/Fresco%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8BDraweeView/\" target=\"_blank\" rel=\"noopener\">Fresco&#x6E90;&#x7801;&#x5206;&#x6790;&#x4E4B;DraweeView</a>&#x4E0E;<a href=\"https://idisfkj.github.io/2017/12/07/Fresco%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8BHierarchy/\" target=\"_blank\" rel=\"noopener\">Fresco&#x6E90;&#x7801;&#x5206;&#x6790;&#x4E4B;Hierarchy</a>&#x3002;&#x597D;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x8FDB;&#x5165;&#x6B63;&#x9898;&#x3002;&#x5728;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x6211;&#x4EEC;&#x63D0;&#x5230;&#xFF0C;&#x5728;<strong>Fresco</strong>&#x4E2D;&#x5173;&#x4E8E;&#x56FE;&#x7247;&#x7684;&#x7F13;&#x5B58;&#x3001;&#x8BF7;&#x6C42;&#x4E0E;&#x663E;&#x793A;&#x903B;&#x8F91;&#x5904;&#x7406;&#x90FD;&#x5728;<strong>Controller</strong>&#x4E2D;&#x3002;&#x90A3;&#x4E48;<strong>Controller</strong>&#x5230;&#x5E95;&#x662F;&#x5982;&#x4F55;&#x8D2F;&#x7A7F;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x7684;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x5148;&#x4ECE;&#x5B83;&#x7684;&#x51FA;&#x751F;&#x5F00;&#x59CB;&#x3002;</p>\n<h1 id=\"Suppiler\"><a href=\"#Suppiler\" class=\"headerlink\" title=\"Suppiler\"></a>Suppiler</h1><p><strong>PipelineDraweeControllerBuilderSupplier</strong>&#x662F;&#x4E00;&#x4E2A;&#x4F9B;&#x5E94;&#x5546;&#xFF0C;&#x4E3B;&#x8981;&#x5B9E;&#x73B0;&#x4E86;<code>Supplier&lt;T&gt;</code>&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;<em>T get()</em>&#xFF0C;&#x7528;&#x6765;&#x83B7;&#x53D6;&#x76F8;&#x5173;&#x7684;&#x63D0;&#x4F9B;&#x5B9E;&#x73B0;&#x3002;&#x56E0;&#x6B64;&#x8BE5;&#x4F9B;&#x5E94;&#x7C7B;&#x63D0;&#x4F9B;&#x7684;&#x5C31;&#x662F;<strong>PipelineDraweeControllerBuilder</strong>&#x5B9E;&#x4F8B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">public PipelineDraweeControllerBuilder get() {</span><br><span class=\"line\">  return new PipelineDraweeControllerBuilder(</span><br><span class=\"line\">      mContext,</span><br><span class=\"line\">      mPipelineDraweeControllerFactory,</span><br><span class=\"line\">      mImagePipeline,</span><br><span class=\"line\">      mBoundControllerListeners);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x751F;&#x6210;&#x7684;<strong>builder</strong>&#x4E2D;&#x6709;4&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x662F;<strong>Context</strong>&#x518D;&#x719F;&#x6089;&#x4E0D;&#x8FC7;&#x4E86;&#xFF1B;&#x7B2C;&#x4E8C;&#x4E2A;&#x662F;<strong>Controller</strong>&#x7684;&#x5DE5;&#x5382;&#xFF1B;&#x7B2C;&#x4E09;&#x4E2A;&#x662F;&#x6570;&#x636E;&#x7BA1;&#x9053;<strong>ImagePipeline</strong>&#xFF1B;&#x7B2C;&#x56DB;&#x4E2A;&#x662F;<strong>listener</strong>&#x7684;<strong>set</strong>&#x96C6;&#x5408;&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x5728;&#x56FE;&#x7247;&#x8BF7;&#x6C42;&#x4E4B;&#x540E;&#x7684;&#x76D1;&#x542C;&#x56DE;&#x8C03;&#x3002;&#x4E0B;&#x9762;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#x540E;&#x9762;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x5185;&#x5BB9;&#x4E0E;&#x4F5C;&#x7528;&#x3002;</p>\n<h2 id=\"PipelineDraweeControllerFactory\"><a href=\"#PipelineDraweeControllerFactory\" class=\"headerlink\" title=\"PipelineDraweeControllerFactory\"></a>PipelineDraweeControllerFactory</h2><p>&#x5728;&#x8FD9;&#x4E2A;&#x7C7B;&#x4E2D;&#x4E3B;&#x8981;&#x5C31;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x5206;&#x522B;&#x4E3A;<strong>internalCreateController</strong>&#x4E0E;<strong>newController</strong>&#xFF0C;&#x5BF9;&#x5916;&#x7684;&#x65B9;&#x6CD5;&#x5C31;&#x4E00;&#x4E2A;<strong>newController</strong>&#x3002;&#x8FD9;&#x4E2A;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x90FD;&#x662F;&#x7528;&#x6765;&#x521B;&#x5EFA;<strong>PipelineDraweeController</strong>&#x5BF9;&#x8C61;&#x3002;&#x5176;&#x4E2D;<strong>newController</strong>&#x5185;&#x90E8;&#x5C31;&#x662F;&#x8C03;&#x7528;&#x4E86;<strong>internalCreateController</strong>&#x6765;&#x8FDB;&#x884C;&#x521B;&#x5EFA;<strong>PipelineDraweeController</strong>&#x5B9E;&#x4F8B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected PipelineDraweeController internalCreateController(</span><br><span class=\"line\">    Resources resources,</span><br><span class=\"line\">    DeferredReleaser deferredReleaser,</span><br><span class=\"line\">    DrawableFactory animatedDrawableFactory,</span><br><span class=\"line\">    Executor uiThreadExecutor,</span><br><span class=\"line\">    MemoryCache&lt;CacheKey, CloseableImage&gt; memoryCache,</span><br><span class=\"line\">    @Nullable ImmutableList&lt;DrawableFactory&gt; globalDrawableFactories,</span><br><span class=\"line\">    @Nullable ImmutableList&lt;DrawableFactory&gt; customDrawableFactories,</span><br><span class=\"line\">     Supplier&lt;DataSource&lt;CloseableReference&lt;CloseableImage&gt;&gt;&gt; dataSourceSupplier,</span><br><span class=\"line\">    String id,</span><br><span class=\"line\">    CacheKey cacheKey,</span><br><span class=\"line\">    Object callerContext) {</span><br><span class=\"line\">  PipelineDraweeController controller = new PipelineDraweeController(</span><br><span class=\"line\">      resources,</span><br><span class=\"line\">      deferredReleaser,</span><br><span class=\"line\">      animatedDrawableFactory,</span><br><span class=\"line\">      uiThreadExecutor,</span><br><span class=\"line\">      memoryCache,</span><br><span class=\"line\">      dataSourceSupplier,</span><br><span class=\"line\">      id,</span><br><span class=\"line\">      cacheKey,</span><br><span class=\"line\">      callerContext,</span><br><span class=\"line\">      globalDrawableFactories);</span><br><span class=\"line\">   controller.setCustomDrawableFactories(customDrawableFactories);</span><br><span class=\"line\">  return controller;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;<strong>DeferredReleaser</strong>&#x662F;&#x7528;&#x6765;&#x7BA1;&#x7406;&#x63A8;&#x8FDF;&#x8D44;&#x6E90;&#x91CA;&#x653E;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#x5DF2;&#x7ECF;&#x63D0;&#x5230;&#xFF0C;&#x5728;<strong>onAttach</strong>&#x4E2D;&#x4F1A;&#x8FDB;&#x884C;&#x52A0;&#x8F7D;&#x8D44;&#x6E90;&#xFF0C;&#x800C;<strong>onDetach</strong>&#x4E2D;&#x53C8;&#x4F1A;&#x91CA;&#x653E;&#x8D44;&#x6E90;&#x3002;&#x56E0;&#x4E3A;&#x5728;<strong>Fresco</strong>&#x4E2D;&#x5F80;&#x5F80;&#x4F1A;&#x5728;<strong>onDetach</strong>&#x4E0E;<strong>onAttach</strong>&#x4E4B;&#x95F4;&#x9891;&#x7E41;&#x5207;&#x6362;(view&#x7684;&#x663E;&#x9690;&#x3001;&#x7ED8;&#x5236;&#x4E0E;Controller&#x7684;&#x8BBE;&#x7F6E;&#x90FD;&#x4F1A;&#x8C03;&#x7528;)&#xFF0C;&#x5E76;&#x4E14;&#x5B83;&#x4EEC;&#x90FD;&#x5904;&#x4E8E;&#x5728;&#x540C;&#x4E00;&#x4E2A;<strong>looper</strong>(&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E3B;&#x8FDB;&#x7A0B;&#x7684;looper)&#x4E2D;&#x3002;&#x5982;&#x679C;&#x5728;<strong>onDetach</strong>&#x65F6;&#x9A6C;&#x4E0A;&#x91CA;&#x653E;&#x8D44;&#x6E90;&#x7684;&#x8BDD;&#xFF0C;&#x8FD9;&#x6837;&#x4F1A;&#x9020;&#x6210;&#x8D44;&#x6E90;&#x7684;&#x6EE5;&#x7528;&#xFF0C;&#x5BFC;&#x81F4;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#x4E0E;&#x91CA;&#x653E;&#x56DE;&#x6536;&#x3002;&#x6240;&#x4EE5;&#x5C31;&#x7528;&#x4E86;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x63A8;&#x8FDF;&#x91CA;&#x653E;&#x7684;&#x673A;&#x5236;(&#x5185;&#x90E8;&#x539F;&#x7406;&#x662F;&#x4F7F;&#x7528;&#x4E86;set&#x96C6;&#x5408;&#x7684;&#x552F;&#x4E00;&#x6027;&#x7684;&#x7279;&#x6027;)&#x3002;</p>\n<p><strong>dataSourceSupplier</strong>&#x662F;<strong>DataSource</strong>&#x7684;&#x4F9B;&#x5E94;&#x5546;&#xFF0C;&#x7528;&#x6765;&#x63D0;&#x4F9B;<strong>DataSource</strong>&#x5B9E;&#x4F8B;&#x3002;&#x800C;<strong>DataSource</strong>&#x662F;&#x7528;&#x6765;&#x83B7;&#x53D6;&#x4E0E;&#x5B58;&#x50A8;&#x8BF7;&#x6C42;&#x7ED3;&#x679C;&#x7684;&#xFF0C;&#x76F8;&#x5F53;&#x4E0E;&#x56FE;&#x7247;&#x6570;&#x636E;&#x6E90;&#x3002;&#x8FD9;&#x4E9B;&#x90FD;&#x4F1A;&#x5728;&#x540E;&#x7EED;&#x7684;<strong>Controller</strong>&#x4E2D;&#x4F7F;&#x7528;&#x5230;&#x3002;</p>\n<h2 id=\"ImagePipeline\"><a href=\"#ImagePipeline\" class=\"headerlink\" title=\"ImagePipeline\"></a>ImagePipeline</h2><p>&#x65E2;&#x7136;&#x5B83;&#x662F;&#x6570;&#x636E;&#x7BA1;&#x9053;&#xFF0C;&#x81EA;&#x7136;&#x662F;&#x4E0E;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x4E0E;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x6709;&#x5173;&#x3002;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x628A;&#x5B83;&#x7406;&#x89E3;&#x4E3A;&#x591A;&#x4E2A;&#x7BA1;&#x9053;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x6700;&#x7EC8;&#x663E;&#x793A;&#x7684;&#x56FE;&#x7247;&#x8D44;&#x6E90;&#x5C31;&#x662F;&#x6765;&#x81EA;&#x4E8E;&#x5B83;&#x4EEC;&#x4E2D;&#x7684;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x3002;&#x4E0B;&#x9762;&#x4ECB;&#x7ECD;&#x5176;&#x4E2D;&#x7684;&#x4E3B;&#x8981;&#x65B9;&#x6CD5;&#xFF1A;</p>\n<ul>\n<li><em>fetchDecodedImage()</em> &#x53D1;&#x9001;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD4;&#x56DE;<strong>decode image</strong>&#x7684;&#x6570;&#x636E;&#x6E90;&#x3002;</li>\n<li><em>fetchEncodedImage()</em> &#x53D1;&#x9001;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD4;&#x56DE;<strong>encoded image</strong>&#x7684;&#x6570;&#x636E;&#x6E90;&#x3002;</li>\n<li><em>prefetchToBitmapCache()</em> &#x53D1;&#x9001;&#x9884;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#xFF0C;&#x83B7;&#x53D6;&#x9884;&#x5904;&#x7406;&#x7684;<strong>bitmap</strong>&#x7F13;&#x5B58;&#x6570;&#x636E;&#x3002;</li>\n<li><em>prefetchToDiskCache()</em> &#x53D1;&#x9001;&#x9884;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#xFF0C;&#x83B7;&#x53D6;&#x9884;&#x5904;&#x7406;&#x7684;&#x78C1;&#x76D8;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x3002;</li>\n<li><em>submitFetchRequest()</em> &#x53D1;&#x9001;&#x8BF7;&#x6C42;&#xFF0C;&#x83B7;&#x53D6;&#x76F8;&#x5E94;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x6E90;&#x3002;</li>\n<li><em>submitPrefetchRequest()</em> &#x53D1;&#x9001;&#x9884;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#xFF0C;&#x83B7;&#x53D6;&#x76F8;&#x5E94;&#x7C7B;&#x578B;&#x7684;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x3002;</li>\n</ul>\n<p>&#x8FD9;&#x91CC;&#x7528;&#x7684;&#x6700;&#x591A;&#x7684;&#x8FD8;&#x662F;<em>fetchDecodedImage()</em></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public DataSource&lt;CloseableReference&lt;CloseableImage&gt;&gt; fetchDecodedImage(</span><br><span class=\"line\">    ImageRequest imageRequest,</span><br><span class=\"line\">    Object callerContext,</span><br><span class=\"line\">    ImageRequest.RequestLevel lowestPermittedRequestLevelOnSubmit) {</span><br><span class=\"line\">  try {</span><br><span class=\"line\">    Producer&lt;CloseableReference&lt;CloseableImage&gt;&gt; producerSequence =</span><br><span class=\"line\">         mProducerSequenceFactory.getDecodedImageProducerSequence(imageRequest);</span><br><span class=\"line\">    return submitFetchRequest(</span><br><span class=\"line\">        producerSequence,</span><br><span class=\"line\">        imageRequest,</span><br><span class=\"line\">        lowestPermittedRequestLevelOnSubmit,</span><br><span class=\"line\">        callerContext);</span><br><span class=\"line\">  } catch (Exception exception) {</span><br><span class=\"line\">    return DataSources.immediateFailedDataSource(exception);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x6D89;&#x53CA;&#x5230;<strong>Producer</strong>&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x751F;&#x4EA7;&#x8005;&#xFF0C;&#x5185;&#x90E8;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x516C;&#x5171;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;<em>void produceResults(Consumer<t> consumer, ProducerContext context)</t></em>&#xFF0C;&#x7528;&#x6765;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x6E90;&#x3002;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0;<strong>submitFetchRequest</strong>&#x65B9;&#x6CD5;&#x4E2D;&#x7684;<strong>producer</strong>&#x4F20;&#x5165;&#x7684;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x4E2A;&#x961F;&#x5217;&#xFF0C;&#x56E0;&#x4E3A;&#x5185;&#x90E8;&#x4F1A;&#x9012;&#x5F52;&#x8C03;&#x7528;<em>produceResults()</em>&#x6765;&#x83B7;&#x53D6;&#x6700;&#x7EC8;&#x7684;&#x6570;&#x636E;&#x6E90;&#x3002;</p>\n<blockquote>\n<p>&#x5173;&#x4E8E;<strong>Producer</strong>&#x540E;&#x7EED;&#x6709;&#x65F6;&#x95F4;&#x7684;&#x8BDD;&#x4F1A;&#x5355;&#x72EC;&#x5F00;&#x7BC7;&#x6587;&#x7AE0;&#x8BE6;&#x7EC6;&#x5206;&#x6790;&#x3002;</p>\n</blockquote>\n<h2 id=\"ControllerListener\"><a href=\"#ControllerListener\" class=\"headerlink\" title=\"ControllerListener\"></a>ControllerListener</h2><p>&#x5982;&#x679C;&#x4F60;&#x5BF9;<strong>ControllerListener</strong>&#x4E0D;&#x719F;&#x6089;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;<strong>BaseControllerListener</strong>&#x5E94;&#x8BE5;&#x6216;&#x591A;&#x6216;&#x5C11;&#x4F7F;&#x7528;&#x8FC7;&#x5427;&#x3002;&#x5B83;&#x5176;&#x5B9E;&#x5C31;&#x662F;<strong>ControllerListener</strong>&#x7684;&#x7A7A;&#x5B9E;&#x73B0;&#x3002;&#x65E2;&#x7136;&#x662F;&#x76D1;&#x542C;&#x56DE;&#x8C03;&#xFF0C;&#x90A3;&#x4E48;&#x6765;&#x770B;&#x4E0B;&#x5B83;&#x63D0;&#x4F9B;&#x7684;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x4E0E;&#x8C03;&#x7528;&#x65F6;&#x673A;&#x3002;</p>\n<ul>\n<li><em>void onSubmit(String id, Object callerContext)</em> &#x5728;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x7684;&#x65F6;&#x5019;&#x56DE;&#x8C03;</li>\n<li><em>void onFinalImageSet(String id, @Nullable INFO imageInfo, @Nullable Animatable animatable)</em> &#x5728;&#x6700;&#x7EC8;&#x8BBE;&#x7F6E;<strong>image</strong>&#x56FE;&#x7247;&#x65F6;&#x56DE;&#x8C03;&#xFF0C;&#x5176;&#x4E2D;<strong>imageInfo</strong>&#x5305;&#x542B;&#x56FE;&#x7247;&#x7684;&#x76F8;&#x5173;&#x57FA;&#x672C;&#x4FE1;&#x606F;&#xFF08;width&#x3001;height&#x4E0E;quality&#xFF09;</li>\n<li><em>void onIntermediateImageSet(String id, @Nullable INFO imageInfo)</em> &#x5728;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x4E0E;&#x6700;&#x7EC8;&#x56FE;&#x7247;&#x8BBE;&#x7F6E;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x56DE;&#x8C03;</li>\n<li><em>void onIntermediateImageFailed(String id, Throwable throwable)</em> &#x5728;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x4E0E;&#x6700;&#x7EC8;&#x5931;&#x8D25;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x56DE;&#x8C03;</li>\n<li><em>void onFailure(String id, Throwable throwable)</em> &#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x5931;&#x8D25;&#x65F6;&#x56DE;&#x8C03;</li>\n<li><em>void onRelease(String id)</em> &#x8D44;&#x6E90;&#x91CA;&#x653E;&#x65F6;&#x56DE;&#x8C03;</li>\n</ul>\n<h1 id=\"ControllerBuilder\"><a href=\"#ControllerBuilder\" class=\"headerlink\" title=\"ControllerBuilder\"></a>ControllerBuilder</h1><p>&#x65E2;&#x7136;&#x662F;<strong>builder</strong>&#x6A21;&#x5F0F;&#xFF0C;&#x6700;&#x7EC8;&#x7684;&#x76EE;&#x7684;&#x81EA;&#x7136;&#x5C31;&#x662F;&#x7528;&#x6765;&#x521B;&#x5EFA;<strong>Controller</strong>&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5954;&#x7740;&#x5B83;&#x7684;&#x76EE;&#x7684;&#x6765;&#x5206;&#x6790;&#x3002;&#x5728;&#x8FD9;&#x91CC;<strong>Controller</strong>&#x7684;<strong>builder</strong>&#x7C7B;&#x662F;<strong>PipelineDraweeControllerBuilder</strong>&#x3002;&#x6211;&#x4EEC;&#x627E;&#x5230;&#x5B83;&#x7684;<em>build()</em>&#x53D1;&#x73B0;&#x5728;&#x5B83;&#x7684;&#x7236;&#x7C7B;<strong>AbstractDraweeControllerBuilder</strong>&#x4E2D;&#x3002;&#x4F46;&#x6700;&#x7EC8;&#x7684;&#x521B;&#x5EFA;&#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;&#x8FD8;&#x662F;&#x8C03;&#x7528;&#x4E86;<em>obtainController()</em>&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#x3002;&#x6240;&#x4EE5;&#x7ECF;&#x8FC7;&#x53CD;&#x8F6C;&#x8FD8;&#x662F;&#x56DE;&#x5230;&#x4E86;<strong>PipelineDraweeControllerBuilder</strong>&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x6765;&#x770B;&#x4E0B;&#x5B83;&#x521B;&#x5EFA;&#x65B9;&#x5F0F;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">protected PipelineDraweeController obtainController() {</span><br><span class=\"line\">  DraweeController oldController = getOldController();</span><br><span class=\"line\">  PipelineDraweeController controller;</span><br><span class=\"line\">  if (oldController instanceof PipelineDraweeController) {</span><br><span class=\"line\">    controller = (PipelineDraweeController) oldController;</span><br><span class=\"line\">    controller.initialize(</span><br><span class=\"line\">        obtainDataSourceSupplier(),</span><br><span class=\"line\">        generateUniqueControllerId(),</span><br><span class=\"line\">        getCacheKey(),</span><br><span class=\"line\">        getCallerContext(),</span><br><span class=\"line\">        mCustomDrawableFactories);</span><br><span class=\"line\">  } else {</span><br><span class=\"line\">    controller = mPipelineDraweeControllerFactory.newController(</span><br><span class=\"line\">        obtainDataSourceSupplier(),</span><br><span class=\"line\">        generateUniqueControllerId(),</span><br><span class=\"line\">        getCacheKey(),</span><br><span class=\"line\">        getCallerContext(),</span><br><span class=\"line\">        mCustomDrawableFactories);</span><br><span class=\"line\">  }</span><br><span class=\"line\">  return controller;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x903B;&#x8F91;&#x5DF2;&#x7ECF;&#x5F88;&#x660E;&#x663E;&#x4E86;&#x3002;&#x9996;&#x5148;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;<strong>Controller</strong>&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x5728;&#x7684;&#x8BDD;&#x5C31;&#x65E0;&#x9700;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x53EA;&#x9700;&#x8C03;&#x7528;<em>initialize()</em>&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x91CD;&#x5199;&#x521D;&#x59CB;&#x5316;&#xFF1B;&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x8C03;&#x7528;&#x6211;&#x4EEC;&#x6587;&#x7AE0;&#x4E4B;&#x524D;&#x5206;&#x6790;&#x7684;<strong>PipelineDraweeControllerFactory</strong>&#x4E2D;&#x7684;<em>newController()</em>&#x6765;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x5B9E;&#x4F8B;&#x3002;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x7684;&#x53C2;&#x6570;&#x8FD8;&#x662F;<em>obtainDataSourceSupplier()</em>&#xFF0C;&#x4E4B;&#x524D;&#x4E5F;&#x7B80;&#x5355;&#x63D0;&#x5230;&#x4E86;&#xFF0C;&#x5B83;&#x662F;<strong>DataSource</strong>&#x7684;&#x4F9B;&#x5E94;&#x8005;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;<strong>Supplier</strong>&#x7684;&#x521B;&#x5EFA;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected Supplier&lt;DataSource&lt;IMAGE&gt;&gt; getDataSourceSupplierForRequest(</span><br><span class=\"line\">    final REQUEST imageRequest,</span><br><span class=\"line\">    final CacheLevel cacheLevel) {</span><br><span class=\"line\">  final Object callerContext = getCallerContext();</span><br><span class=\"line\">  return new Supplier&lt;DataSource&lt;IMAGE&gt;&gt;() {</span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public DataSource&lt;IMAGE&gt; get() {</span><br><span class=\"line\">      return getDataSourceForRequest(imageRequest, callerContext, cacheLevel);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public String toString() {</span><br><span class=\"line\">      return Objects.toStringHelper(this)</span><br><span class=\"line\">          .add(&quot;request&quot;, imageRequest.toString())</span><br><span class=\"line\">          .toString();</span><br><span class=\"line\">    }</span><br><span class=\"line\">  };</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x773C;&#x5C31;&#x770B;&#x5230;&#x4E86;<strong>Supplier</strong>&#x7684;&#x521B;&#x5EFA;&#xFF0C;&#x4E4B;&#x524D;&#x4E5F;&#x63D0;&#x5230;&#x5B83;&#x53EA;&#x6709;&#x4E00;&#x4E2A;<em>get()</em>&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x662F;&#x7528;&#x6765;&#x63D0;&#x4F9B;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x7684;<strong>DataSource</strong>&#x3002;&#x5728;&#x8FD9;&#x91CC;&#x4E5F;&#x662F;&#x5982;&#x6B64;&#xFF0C;&#x8FD9;&#x91CC;&#x5B83;&#x8C03;&#x7528;&#x4E86;<em>getDataSourceForRequest()</em>&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x662F;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#xFF0C;&#x7EC6;&#x8282;&#x5B9E;&#x73B0;&#x7531;&#x5B83;&#x7684;&#x5B50;&#x7C7B;&#x5B9E;&#x73B0;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x518D;&#x6B21;&#x56DE;&#x5230;<strong>getDataSourceForRequest</strong>&#xFF0C;&#x5728;&#x5176;&#x4E2D;&#x5C31;&#x80FD;&#x591F;&#x641C;&#x7D22;&#x5230;<em>getDataSourceForRequest()</em>&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">protected DataSource&lt;CloseableReference&lt;CloseableImage&gt;&gt; getDataSourceForRequest(</span><br><span class=\"line\">    ImageRequest imageRequest,</span><br><span class=\"line\">    Object callerContext,</span><br><span class=\"line\">    CacheLevel cacheLevel) {</span><br><span class=\"line\">  return mImagePipeline.fetchDecodedImage(</span><br><span class=\"line\">      imageRequest,</span><br><span class=\"line\">      callerContext,</span><br><span class=\"line\">      convertCacheLevelToRequestLevel(cacheLevel));</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x770B;&#x5230;&#x4E0A;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x662F;&#x5426;&#x773C;&#x719F;&#x5462;&#xFF1F;&#x8FD9;&#x4E5F;&#x662F;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x6240;&#x63D0;&#x5230;&#x7684;<strong>ImagePipleline</strong>&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x5728;&#x591A;&#x505A;&#x5206;&#x6790;&#x4E86;&#x3002;&#x8FD9;&#x6837;<strong>Controller</strong>&#x5C31;&#x4E0E;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x7684;&#x901A;&#x9053;&#x5EFA;&#x7ACB;&#x4E86;&#x8054;&#x7CFB;&#x3002;&#x90A3;&#x4E48;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5C31;&#x8F6C;&#x6218;&#x5230;<strong>Controller</strong>&#x4E2D;&#xFF0C;&#x770B;&#x770B;&#x5B83;&#x5230;&#x5E95;&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#x3002;</p>\n<h1 id=\"Controller\"><a href=\"#Controller\" class=\"headerlink\" title=\"Controller\"></a>Controller</h1><p><strong>PipelineDraweeController</strong>&#x7EE7;&#x627F;&#x4E8E;<strong>AbstractDraweeController</strong>&#xFF0C;&#x5728;<strong>PipelineDraweeController</strong>&#x4E2D;&#x4E3B;&#x8981;&#x7684;&#x65B9;&#x6CD5;&#x6709;&#x4E09;&#x4E2A;</p>\n<ul>\n<li><em>Drawable createDrawable(CloseableImage closeableImage)</em> &#x8FD9;&#x662F;&#x5185;&#x90E8;&#x7C7B;<strong>DrawableFactory</strong>&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x5DE5;&#x5382;&#xFF0C;&#x4E0D;&#x8A00;&#x800C;&#x55BB;&#x5B83;&#x662F;&#x7528;&#x6765;&#x521B;&#x5EFA;<strong>Drawable</strong>&#x7684;&#xFF0C;&#x5728;&#x6570;&#x636E;&#x6E90;&#x8FD4;&#x56DE;&#x7684;&#x65F6;&#x5019;&#x56DE;&#x8C03;&#xFF0C;&#x8FDB;&#x800C;&#x663E;&#x793A;&#x5230;<strong>Hierarchy</strong>&#x5C42;&#x3002;</li>\n<li><em>getDataSource()</em> &#x83B7;&#x53D6;&#x6570;&#x636E;&#x6E90;&#x901A;&#x9053;&#xFF0C;&#x4E0E;&#x5176;&#x5EFA;&#x7ACB;&#x8054;&#x7CFB;&#x3002;</li>\n<li><em>void setHierarchy(@Nullable DraweeHierarchy hierarchy)</em> &#x8BBE;&#x7F6E;<strong>Hierarchy</strong>&#x56FE;&#x5C42;&#xFF0C;&#x5185;&#x90E8;&#x6301;&#x6709;&#x7684;&#x5176;&#x5B9E;&#x662F;<strong>SettableDraweeHierarchy</strong>&#x63A5;&#x53E3;&#x5BF9;&#x8C61;&#x3002;&#x6240;&#x4EE5;&#x5185;&#x90E8;&#x8C03;&#x7528;&#x7684;&#x4E5F;&#x5C31;&#x662F;&#x5B83;&#x7684;6&#x4E2A;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x3002;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#x4E5F;&#x6709;&#x63D0;&#x53CA;&#xFF0C;&#x7528;&#x6765;&#x63A7;&#x5236;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x663E;&#x793A;&#x903B;&#x8F91;&#x3002;</li>\n</ul>\n<p>&#x5176;&#x4F59;&#x7684;&#x903B;&#x8F91;&#x5904;&#x7406;&#x90FD;&#x5728;&#x5B83;&#x7684;&#x7236;&#x7C7B;<strong>AbstractDraweeController</strong>&#x4E2D;&#x3002;&#x5728;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x591A;&#x6B21;&#x63D0;&#x53CA;&#x5230;<strong>onAttach</strong>&#x4E0E;<strong>onDetach</strong>&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x4EEC;&#x5206;&#x522B;&#x662F;&#x5904;&#x7406;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x4E0E;&#x91CA;&#x653E;&#x3002;</p>\n<h2 id=\"onAttach\"><a href=\"#onAttach\" class=\"headerlink\" title=\"onAttach\"></a>onAttach</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> @Override</span><br><span class=\"line\"> public void onAttach() {</span><br><span class=\"line\">   if (FLog.isLoggable(FLog.VERBOSE)) {</span><br><span class=\"line\">     FLog.v(</span><br><span class=\"line\">         TAG,</span><br><span class=\"line\">         &quot;controller %x %s: onAttach: %s&quot;,</span><br><span class=\"line\">         System.identityHashCode(this),</span><br><span class=\"line\">         mId,</span><br><span class=\"line\">         mIsRequestSubmitted ? &quot;request already submitted&quot; : &quot;request needs submit&quot;);</span><br><span class=\"line\">   }</span><br><span class=\"line\">   //&#x4E8B;&#x4EF6;&#x8BB0;&#x5F55;&#x5668;</span><br><span class=\"line\">mEventTracker.recordEvent(Event.ON_ATTACH_CONTROLLER);</span><br><span class=\"line\"> Preconditions.checkNotNull(mSettableDraweeHierarchy);</span><br><span class=\"line\">   //&#x53D6;&#x6D88;&#x8D44;&#x6E90;&#x63A8;&#x8FDF;&#x91CA;&#x653E;&#x673A;&#x5236;&#xFF0C;&#x9632;&#x6B62;&#x8D44;&#x6E90;&#x88AB;&#x91CA;&#x653E;</span><br><span class=\"line\">   mDeferredReleaser.cancelDeferredRelease(this);</span><br><span class=\"line\">   mIsAttached = true;</span><br><span class=\"line\">   if (!mIsRequestSubmitted) {</span><br><span class=\"line\">     submitRequest();</span><br><span class=\"line\">   }</span><br><span class=\"line\"> }</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;<strong>mEventTracker</strong>&#x662F;&#x4E8B;&#x4EF6;&#x8BB0;&#x5F55;&#x5668;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x5F00;&#x542F;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x5173;&#x95ED;&#x5219;&#x9700;&#x8981;&#x5728;<em>Fresco.initialize()</em>&#x4E4B;&#x524D;&#x8C03;&#x7528;<em>DraweeEventTracker.disable()</em>&#x5173;&#x95ED;&#xFF1B;&#x7136;&#x540E;&#x5C31;&#x662F;&#x5C06;&#x5176;&#x4ECE;&#x8D44;&#x6E90;&#x63A8;&#x8FDF;&#x91CA;&#x653E;&#x673A;&#x5236;&#x4E2D;&#x53D6;&#x6D88;&#xFF1B;&#x6700;&#x540E;&#x5C31;&#x662F;&#x8C03;&#x7528;<em>submitRequest()</em>&#x53D1;&#x9001;&#x6570;&#x636E;&#x6E90;&#x8BF7;&#x6C42;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected void submitRequest() {</span><br><span class=\"line\">  final T closeableImage = getCachedImage();</span><br><span class=\"line\">  //1.&#x5224;&#x65AD;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x4E2D;&#x662F;&#x5426;&#x5B58;&#x5728;</span><br><span class=\"line\">  if (closeableImage != null) {</span><br><span class=\"line\">    mDataSource = null;</span><br><span class=\"line\">    mIsRequestSubmitted = true;</span><br><span class=\"line\">    mHasFetchFailed = false;</span><br><span class=\"line\">     mEventTracker.recordEvent(Event.ON_SUBMIT_CACHE_HIT);</span><br><span class=\"line\">    //1.1&#x6570;&#x636E;&#x83B7;&#x53D6;&#x4E2D;&#x901A;&#x77E5;&#x56DE;&#x8C03;</span><br><span class=\"line\">    getControllerListener().onSubmit(mId, mCallerContext);</span><br><span class=\"line\">    //1.2&#x6570;&#x636E;&#x5904;&#x7406;</span><br><span class=\"line\">    onNewResultInternal(mId, mDataSource, closeableImage, 1.0f, true, true);</span><br><span class=\"line\">    return;</span><br><span class=\"line\">  }</span><br><span class=\"line\">   mEventTracker.recordEvent(Event.ON_DATASOURCE_SUBMIT);</span><br><span class=\"line\">  //2.&#x901A;&#x8FC7;DataSource&#x83B7;&#x53D6;&#x6570;&#x636E;&#x6E90;</span><br><span class=\"line\">  //2.1&#x6570;&#x636E;&#x83B7;&#x53D6;&#x4E2D;&#x901A;&#x77E5;&#x56DE;&#x8C03;</span><br><span class=\"line\">  getControllerListener().onSubmit(mId, mCallerContext);</span><br><span class=\"line\">  mSettableDraweeHierarchy.setProgress(0, true);</span><br><span class=\"line\">  mIsRequestSubmitted = true;</span><br><span class=\"line\">  mHasFetchFailed = false;</span><br><span class=\"line\">  mDataSource = getDataSource();</span><br><span class=\"line\">  if (FLog.isLoggable(FLog.VERBOSE)) {</span><br><span class=\"line\">    FLog.v(</span><br><span class=\"line\">        TAG,</span><br><span class=\"line\">        &quot;controller %x %s: submitRequest: dataSource: %x&quot;,</span><br><span class=\"line\">        System.identityHashCode(this),</span><br><span class=\"line\">        mId,</span><br><span class=\"line\">        System.identityHashCode(mDataSource));</span><br><span class=\"line\">  }</span><br><span class=\"line\">  final String id = mId;</span><br><span class=\"line\">  final boolean wasImmediate = mDataSource.hasResult();</span><br><span class=\"line\">  //&#x5185;&#x90E8;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x56DE;&#x8C03;&#xFF0C;&#x5F53;&#x6570;&#x636E;&#x6E90;&#x8FD4;&#x56DE;&#x65F6;&#x56DE;&#x8C03;</span><br><span class=\"line\">  final DataSubscriber&lt;T&gt; dataSubscriber =</span><br><span class=\"line\">      new BaseDataSubscriber&lt;T&gt;() {</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void onNewResultImpl(DataSource&lt;T&gt; dataSource) {</span><br><span class=\"line\">          // isFinished must be obtained before image, otherwise we might set intermediate result</span><br><span class=\"line\">          // as final image.</span><br><span class=\"line\">          boolean isFinished = dataSource.isFinished();</span><br><span class=\"line\">          float progress = dataSource.getProgress();</span><br><span class=\"line\">          T image = dataSource.getResult();</span><br><span class=\"line\">          //2.2&#x6570;&#x636E;&#x5904;&#x7406;</span><br><span class=\"line\">          if (image != null) {</span><br><span class=\"line\">            //&#x6210;&#x529F;&#x5904;&#x7406;</span><br><span class=\"line\">            onNewResultInternal(id, dataSource, image, progress, isFinished, wasImmediate);</span><br><span class=\"line\">          } else if (isFinished) {</span><br><span class=\"line\">            //&#x5931;&#x8D25;&#x5904;&#x7406;</span><br><span class=\"line\">            onFailureInternal(id, dataSource, new NullPointerException(), /* isFinished */ true);</span><br><span class=\"line\">          }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void onFailureImpl(DataSource&lt;T&gt; dataSource) {</span><br><span class=\"line\">          //&#x5931;&#x8D25;&#x5904;&#x7406;</span><br><span class=\"line\">          onFailureInternal(id, dataSource, dataSource.getFailureCause(), /* isFinished */ true);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void onProgressUpdate(DataSource&lt;T&gt; dataSource) {</span><br><span class=\"line\">          boolean isFinished = dataSource.isFinished();</span><br><span class=\"line\">          float progress = dataSource.getProgress();</span><br><span class=\"line\">          //&#x6570;&#x636E;&#x8FDB;&#x5EA6;&#x5904;&#x7406;</span><br><span class=\"line\">          onProgressUpdateInternal(id, dataSource, progress, isFinished);</span><br><span class=\"line\">        }</span><br><span class=\"line\">      };</span><br><span class=\"line\">  //&#x6570;&#x636E;&#x6E90;&#x8BA2;&#x9605;&#x56DE;&#x8C03;&#x6CE8;&#x518C;</span><br><span class=\"line\">  mDataSource.subscribe(dataSubscriber, mUiThreadImmediateExecutor);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x903B;&#x8F91;&#x65B9;&#x9762;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x4E2D;&#x5DF2;&#x7ECF;&#x8BE6;&#x7EC6;&#x6CE8;&#x91CA;&#x4E86;&#xFF0C;&#x603B;&#x7684;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#x5148;&#x4ECE;&#x5185;&#x5B58;&#x4E2D;&#x83B7;&#x53D6;&#x5982;&#x679C;&#x5B58;&#x5728;&#x5C31;&#x76F4;&#x63A5;&#x62FF;&#x6765;&#x7528;&#xFF0C;&#x5426;&#x5219;&#x5C31;&#x901A;&#x8FC7;<strong>DataSource</strong>&#x4ECE;&#x7F51;&#x7EDC;&#x6216;&#x8005;&#x662F;&#x672C;&#x5730;&#x8D44;&#x6E90;&#x4E2D;&#x83B7;&#x53D6;&#x3002;&#x4F7F;&#x7528;<strong>DataSource</strong>&#x65B9;&#x5F0F;&#x4F1A;&#x4F7F;&#x7528;&#x5230;<strong>DataSubscriber</strong>&#xFF0C;&#x5373;&#x8BA2;&#x9605;&#x65B9;&#x5F0F;&#x3002;&#x5F53;&#x6570;&#x636E;&#x6E90;&#x5DF2;&#x7ECF;&#x83B7;&#x53D6;&#x5230;&#x65F6;&#xFF0C;&#x53D1;&#x9001;&#x901A;&#x77E5;&#x7ED9;&#x8BA2;&#x9605;&#x8005;&#xFF0C;&#x56E0;&#x6B64;&#x5206;&#x522B;&#x56DE;&#x8C03;&#x8BA2;&#x9605;&#x8005;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x4E0A;&#x8FF0;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x53EA;&#x8981;&#x6210;&#x529F;&#x4E86;&#x90FD;&#x4F1A;&#x4EA4;&#x7531;<em>onNewResultInternal()</em>&#x5904;&#x7406;&#xFF0C;&#x800C;&#x5931;&#x8D25;&#x5219;&#x7531;<em>onFailureInternal()</em>&#x5904;&#x7406;&#xFF0C;&#x540C;&#x65F6;&#x8BF7;&#x6C42;&#x8FDB;&#x5EA6;&#x5904;&#x7406;&#x7531;<em>onProgressUpdateInternal()</em>&#x5904;&#x7406;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void onNewResultInternal(</span><br><span class=\"line\">    String id,</span><br><span class=\"line\">    DataSource&lt;T&gt; dataSource,</span><br><span class=\"line\">    @Nullable T image,</span><br><span class=\"line\">    float progress,</span><br><span class=\"line\">    boolean isFinished,</span><br><span class=\"line\">    boolean wasImmediate) {</span><br><span class=\"line\">  // ignore late callbacks (data source that returned the new result is not the one we expected)</span><br><span class=\"line\">  if (!isExpectedDataSource(id, dataSource)) {</span><br><span class=\"line\">    logMessageAndImage(&quot;ignore_old_datasource @ onNewResult&quot;, image);</span><br><span class=\"line\">    releaseImage(image);</span><br><span class=\"line\">    dataSource.close();</span><br><span class=\"line\">    return;</span><br><span class=\"line\">  }</span><br><span class=\"line\">  mEventTracker.recordEvent(</span><br><span class=\"line\">      isFinished ? Event.ON_DATASOURCE_RESULT : Event.ON_DATASOURCE_RESULT_INT);</span><br><span class=\"line\">  // create drawable</span><br><span class=\"line\">  Drawable drawable;</span><br><span class=\"line\">  try {</span><br><span class=\"line\">    drawable = createDrawable(image);</span><br><span class=\"line\">  } catch (Exception exception) {</span><br><span class=\"line\">    logMessageAndImage(&quot;drawable_failed @ onNewResult&quot;, image);</span><br><span class=\"line\">    releaseImage(image);</span><br><span class=\"line\">    onFailureInternal(id, dataSource, exception, isFinished);</span><br><span class=\"line\">    return;</span><br><span class=\"line\">  }</span><br><span class=\"line\">  T previousImage = mFetchedImage;</span><br><span class=\"line\">  Drawable previousDrawable = mDrawable;</span><br><span class=\"line\">  mFetchedImage = image;</span><br><span class=\"line\">  mDrawable = drawable;</span><br><span class=\"line\">  try {</span><br><span class=\"line\">    // set the new image</span><br><span class=\"line\">    if (isFinished) {</span><br><span class=\"line\">      logMessageAndImage(&quot;set_final_result @ onNewResult&quot;, image);</span><br><span class=\"line\">      mDataSource = null;</span><br><span class=\"line\">      //&#x901A;&#x8FC7;hierarchy&#xFF08;GenericDraweeHierarchy&#xFF09;&#x6765;&#x8BBE;&#x7F6E;image</span><br><span class=\"line\">      mSettableDraweeHierarchy.setImage(drawable, 1f, wasImmediate);</span><br><span class=\"line\">      getControllerListener().onFinalImageSet(id, getImageInfo(image), getAnimatable());</span><br><span class=\"line\">      // IMPORTANT: do not execute any instance-specific code after this point</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">      logMessageAndImage(&quot;set_intermediate_result @ onNewResult&quot;, image);</span><br><span class=\"line\">      mSettableDraweeHierarchy.setImage(drawable, progress, wasImmediate);</span><br><span class=\"line\">       getControllerListener().onIntermediateImageSet(id, getImageInfo(image));</span><br><span class=\"line\">      // IMPORTANT: do not execute any instance-specific code after this point</span><br><span class=\"line\">    }</span><br><span class=\"line\">  } finally {</span><br><span class=\"line\">    if (previousDrawable != null &amp;&amp; previousDrawable != drawable) {</span><br><span class=\"line\">      releaseDrawable(previousDrawable);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    if (previousImage != null &amp;&amp; previousImage != image) {</span><br><span class=\"line\">      logMessageAndImage(&quot;release_previous_result @ onNewResult&quot;, previousImage);</span><br><span class=\"line\">      releaseImage(previousImage);</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x5C31;&#x770B;&#x91CC;&#x9762;&#x7684;&#x4E24;&#x4E2A;<strong>try</strong>&#x3002;<br>&#x7B2C;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;<em>createDrawable(image)</em>&#x5C06;&#x62FF;&#x5230;&#x7684;&#x6570;&#x636E;&#x6E90;&#x8F6C;&#x53D8;&#x6210;<strong>Drawable</strong>&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x662F;&#x5728;&#x5B50;&#x7C7B;&#x4E2D;&#x5B9E;&#x73B0;(&#x4E0A;&#x9762;&#x4E5F;&#x6709;&#x63D0;&#x53CA;)&#x3002;<br>&#x7B2C;&#x4E8C;&#x4E2A;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x4E00;&#x65B9;&#x9762;&#x5982;&#x679C;&#x6570;&#x636E;&#x6E90;&#x5DF2;&#x7ECF;&#x5168;&#x90E8;&#x83B7;&#x53D6;&#x5B8C;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x8C03;&#x7528;<strong>SettableDraweeHierarchy</strong>&#x63A5;&#x53E3;&#x7684;<em>setImage()</em>&#x65B9;&#x6CD5;&#x5C06;&#x56FE;&#x7247;&#x8BBE;&#x7F6E;&#x5230;<strong>Hierarchy</strong>&#x56FE;&#x5C42;&#x4E0A;&#xFF0C;&#x540C;&#x65F6;&#x8C03;&#x7528;<strong>Listener</strong>&#x7684;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;<em>onFinalImageSet()</em>;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#x5982;&#x679C;&#x6570;&#x636E;&#x6E90;&#x8FD8;&#x5728;&#x83B7;&#x53D6;&#x4E2D;&#xFF0C;&#x4E5F;&#x662F;&#x8C03;&#x7528;<strong>SettableDraweeHierarchy</strong>&#x63A5;&#x53E3;&#x7684;<em>setImage()</em>&#x65B9;&#x6CD5;&#xFF0C;&#x53EA;&#x662F;&#x5176;&#x4E2D;&#x7684;&#x53C2;&#x6570;<strong>progress</strong>&#x6839;&#x636E;&#x8FDB;&#x5EA6;&#x6765;&#x8BBE;&#x7F6E;&#x800C;&#x5DF2;&#xFF0C;&#x7531;&#x4E8E;&#x8FD8;&#x5904;&#x4E8E;&#x8D44;&#x6E90;&#x83B7;&#x53D6;&#x4E2D;&#x6240;&#x4EE5;&#x8C03;&#x7528;<em>onIntermediateImageSet()</em>&#x56DE;&#x8C03;&#x3002;<br>&#x8FD9;&#x6837;<strong>Controller</strong>&#x5C31;&#x4E0E;<strong>Hierarchy</strong>&#x8054;&#x7CFB;&#x8D77;&#x6765;&#x4E86;&#xFF0C;&#x5C06;&#x9700;&#x8981;&#x7684;&#x56FE;&#x7247;&#x8BBE;&#x7F6E;&#x5230;&#x663E;&#x793A;&#x7684;&#x56FE;&#x7247;&#x4E2D;&#x3002;</p>\n<blockquote>\n<p>&#x5BF9;&#x4E8E;<strong>SettableDraweeHierarchy</strong>&#x4E2D;&#x7684;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x5982;&#x679C;&#x4E0D;&#x7406;&#x89E3;&#x7684;&#x53EF;&#x4EE5;&#x56DE;&#x8FC7;&#x5934;&#x53BB;&#x770B;&#x6211;&#x4E4B;&#x524D;&#x7684;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;<a href=\"https://idisfkj.github.io/2017/12/07/Fresco%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8BHierarchy/\" target=\"_blank\" rel=\"noopener\">Fresco&#x6E90;&#x7801;&#x5206;&#x6790;&#x4E4B;Hierarchy</a></p>\n</blockquote>\n<p>&#x7531;&#x4E8E;&#x6E90;&#x7801;&#x592A;&#x591A;&#xFF0C;&#x5BF9;&#x4E8E;<em>onFailureInternal()</em>&#x4E0E;<em>onProgressUpdateInternal()</em>&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x8D34;&#x51FA;&#x6E90;&#x7801;&#x6765;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x4E86;&#x3002;&#x539F;&#x7406;&#x4E0E;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x57FA;&#x672C;&#x7C7B;&#x4F3C;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x770B;&#x6E90;&#x7801;&#x7684;&#x53EF;&#x4EE5;&#x70B9;<a href=\"https://github.com/facebook/fresco/blob/master/drawee/src/main/java/com/facebook/drawee/controller/AbstractDraweeController.java\" target=\"_blank\" rel=\"noopener\">&#x8FD9;&#x91CC;</a></p>\n<h2 id=\"onDetach\"><a href=\"#onDetach\" class=\"headerlink\" title=\"onDetach\"></a>onDetach</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">public void onDetach() {</span><br><span class=\"line\">  if (FLog.isLoggable(FLog.VERBOSE)) {</span><br><span class=\"line\">    FLog.v(TAG, &quot;controller %x %s: onDetach&quot;, System.identityHashCode(this), mId);</span><br><span class=\"line\">  }</span><br><span class=\"line\">  mEventTracker.recordEvent(Event.ON_DETACH_CONTROLLER);</span><br><span class=\"line\">  mIsAttached = false;</span><br><span class=\"line\">  mDeferredReleaser.scheduleDeferredRelease(this);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x76F8;&#x5BF9;&#x4E8E;&#x4E4B;&#x524D;&#x7684;&#x5206;&#x6790;<em>onDetach()</em>&#x5C31;&#x7B80;&#x5355;&#x591A;&#x4E86;&#xFF0C;&#x8FD9;&#x91CC;&#x5B83;&#x53EA;&#x662F;&#x5BF9;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x91CA;&#x653E;&#xFF0C;&#x91CA;&#x653E;&#x7684;&#x7B56;&#x7565;&#x4E5F;&#x662F;&#x63A8;&#x8FDF;&#x91CA;&#x653E;&#x7B56;&#x7565;<a href=\"https://github.com/facebook/fresco/blob/master/drawee/src/main/java/com/facebook/drawee/components/DeferredReleaser.java\" target=\"_blank\" rel=\"noopener\">DeferredReleaser</a>&#x3002;</p>\n<h1 id=\"End\"><a href=\"#End\" class=\"headerlink\" title=\"End\"></a>End</h1><p>&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x5206;&#x6790;&#x4E86;<strong>Fresco</strong>&#x4E2D;&#x7684;<strong>Controller</strong>&#x76F8;&#x5173;&#x5904;&#x7406;&#x903B;&#x8F91;&#xFF0C;&#x5B83;&#x63A7;&#x5236;&#x7740;<strong>Hierarchy</strong>&#x663E;&#x793A;&#x903B;&#x8F91;&#xFF0C;&#x540C;&#x65F6;&#x5B83;&#x662F;&#x6570;&#x636E;&#x6E90;&#x7684;&#x83B7;&#x53D6;&#x6865;&#x6881;&#x901A;&#x8FC7;<strong>DataSource</strong>&#x6765;&#x94FE;&#x63A5;&#x6570;&#x636E;&#x6E90;&#x7684;&#x83B7;&#x53D6;&#x3002;&#x90A3;&#x4E48;&#x95EE;&#x9898;&#x53C8;&#x6765;&#x4E86;&#xFF0C;<strong>DataSource</strong>&#x53C8;&#x662F;&#x5982;&#x4F55;&#x4EA7;&#x751F;&#x7684;&#x5462;&#xFF1F;&#x540C;&#x65F6;&#x5B83;&#x7684;&#x5185;&#x90E8;&#x903B;&#x8F91;&#x53C8;&#x662F;&#x5982;&#x4F55;&#x7684;&#x5462;&#xFF1F;&#x8FD9;&#x5C31;&#x6D89;&#x53CA;&#x5230;<strong>Producer</strong>&#x4E86;&#xFF0C;&#x656C;&#x8BF7;&#x5173;&#x6CE8;&#x4E0B;&#x7BC7;&#x6587;&#x7AE0;<code>Fresco&#x6E90;&#x7801;&#x5206;&#x6790;&#x4E4B;Producer</code></p>\n<p><a href=\"https://github.com/idisfkj/Fresco-Source-Analysis\" target=\"_blank\" rel=\"noopener\">Fresco&#x6E90;&#x7801;&#x5206;&#x6790;&#x7CFB;&#x5217;Github&#x5730;&#x5740;</a></p>\n","categories":["android"],"tags":["源码分析"]},{"title":"Fresco源码分析之Hierarchy","url":"https://www.rousetime.com/2017/12/07/Fresco源码分析之Hierarchy/","content":"<p>&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x6211;&#x4EEC;&#x5206;&#x6790;&#x4E86;<strong>Fresco</strong>&#x4E2D;&#x7684;<strong>DraweeView</strong>&#xFF0C;&#x5BF9;&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x539F;&#x7406;&#x4EE5;&#x53CA;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x4E86;&#x89E3;&#x6790;&#x3002;&#x5728;&#x8FD9;&#x8FC7;&#x7A0B;&#x4E2D;&#x6211;&#x4EEC;&#x4E86;&#x89E3;&#x5230;&#xFF0C;<strong>DraweeView</strong>&#x4E2D;&#x662F;&#x901A;&#x8FC7;<strong>DraweeHolder</strong>&#x6765;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;&#x7684;&#x3002;&#x800C;<strong>DraweeHolder</strong>&#x53C8;&#x662F;&#x7528;&#x6765;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;&#x76F8;&#x5173;&#x7684;<strong>Hierarchy</strong>&#x4E0E;<strong>Controller</strong>&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x4E86;&#x89E3;<strong>DraweeView</strong>&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x53EF;&#x4EE5;&#x5148;&#x770B;&#x4E0B;&#x6211;&#x7684;&#x524D;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;<a href=\"https://idisfkj.github.io/2017/11/28/Fresco%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8BDraweeView/\" target=\"_blank\" rel=\"noopener\">Fresco&#x6E90;&#x7801;&#x5206;&#x6790;&#x4E4B;DraweeView</a>&#x3002;&#x4ECA;&#x5929;&#x8FD9;&#x91CC;&#x8FDB;&#x4E00;&#x6B65;&#x6765;&#x5206;&#x6790;<strong>Fresco</strong>&#x4E2D;&#x7684;<strong>Hierarchy</strong>&#x3002;</p>\n<h1 id=\"GenericDraweeHierarchyBuilder\"><a href=\"#GenericDraweeHierarchyBuilder\" class=\"headerlink\" title=\"GenericDraweeHierarchyBuilder\"></a>GenericDraweeHierarchyBuilder</h1><p>&#x5728;<strong>GenericDraweeView</strong>&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#x4F1A;&#x8C03;&#x7528;<em>inflateHierarchy(context, atts)</em>&#x65B9;&#x6CD5;&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<strong>GenericDraweeHierarchyBuilder</strong>&#x5BF9;&#x8C61;&#xFF0C;&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x8BE5;&#x5BF9;&#x8C61;&#x7684;<strong>build</strong>&#x65B9;&#x6CD5;&#x6765;&#x751F;&#x6210;&#x4E00;&#x4E2A;<strong>Hierarchy</strong>&#x3002;</p>\n<blockquote>\n<p>&#x5982;&#x679C;&#x4F60;&#x770B;&#x4E86;&#x6211;&#x4E0A;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x76F8;&#x4FE1;&#x5BF9;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4F60;&#x4F1A;&#x611F;&#x5230;&#x5F88;&#x4EB2;&#x5207;&#x3002;</p>\n</blockquote>\n<p>&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x662F;&#x7528;&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<strong>Hierarchy</strong>&#xFF0C;&#x901A;&#x8FC7;<strong>builder</strong>&#x6A21;&#x5F0F;&#x6765;&#x5B9E;&#x4F8B;&#x5316;&#x5305;&#x542B;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x7684;<strong>Hierarchy</strong>&#x3002;&#x5982;&#x679C;&#x4F60;&#x4E00;&#x6B65;&#x6B65;&#x6DF1;&#x5165;&#x4E86;&#x89E3;<strong>Fresco</strong>&#x7684;&#x8BDD;&#xFF0C;&#x76F8;&#x4FE1;&#x4F60;&#x5BF9;<strong>builder</strong>&#x6A21;&#x5F0F;&#x4E5F;&#x5C06;&#x4E60;&#x4EE5;&#x4E3A;&#x5E38;&#xFF0C;&#x56E0;&#x4E3A;&#x540E;&#x9762;&#x4F60;&#x5C06;&#x7ECF;&#x5E38;&#x4E0E;&#x5B83;&#x78B0;&#x9762;&#x3002;&#x8FD9;&#x4E5F;&#x662F;<strong>Fresco</strong>&#x5F00;&#x6E90;&#x9879;&#x76EE;&#x7684;&#x4E3B;&#x8981;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x3002;&#x5728;&#x8BE5;<strong>builder</strong>&#x7C7B;&#x4E2D;&#x4E3B;&#x8981;&#x6784;&#x5EFA;&#x7684;&#x4FE1;&#x606F;&#x6709;:</p>\n<ul>\n<li><strong>Drawable</strong>&#x76F8;&#x5173;&#xFF1A;<strong>placeholderImage</strong>&#x3001;<strong>retryImage</strong>&#x3001;<strong>failureImage</strong>&#x3001;<strong>progressBarImage</strong>&#x3001;<strong>background</strong>&#x3001;<strong>overlays</strong>&#x4E0E;<strong>pressedStateOverlay</strong></li>\n<li><strong>ScaleType</strong>&#x76F8;&#x5173;&#xFF1A;&#x4E0E;<strong>Drawable</strong>&#x76F8;&#x5BF9;&#x5E94;&#x7684;<strong>placeholderImageScaleType</strong>&#x3001;<strong>retryImageScaleType</strong>&#x7B49;&#x7B49;&#x3002;</li>\n<li>&#x5176;&#x5B83;&#xFF1A;<strong>fadeDuration</strong>&#x6E10;&#x53D8;&#x8FC7;&#x6E21;&#x65F6;&#x95F4;&#x4E0E;<strong>RoundingParams</strong>&#x5706;&#x89D2;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x7B49;&#x7B49;</li>\n</ul>\n<h1 id=\"GenericDraweeHierarchy\"><a href=\"#GenericDraweeHierarchy\" class=\"headerlink\" title=\"GenericDraweeHierarchy\"></a>GenericDraweeHierarchy</h1><p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;<strong>GenericDraweeHierarchyBuilder</strong>&#x7684;<strong>build</strong>&#x65B9;&#x6CD5;&#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<strong>GenericDraweeHierarchy</strong>&#x5BF9;&#x8C61;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4ECA;&#x5929;&#x9700;&#x8981;&#x4E3B;&#x8981;&#x5206;&#x6790;&#x7684;&#x7C7B;&#xFF0C;&#x4E5F;&#x662F;<strong>Fresco</strong>&#x7684;&#x4E00;&#x4E2A;&#x6838;&#x5FC3;&#x7C7B;&#x3002;</p>\n<h2 id=\"SettableDraweeHierarchy\"><a href=\"#SettableDraweeHierarchy\" class=\"headerlink\" title=\"SettableDraweeHierarchy\"></a>SettableDraweeHierarchy</h2><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x6765;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x5B83;&#x7684;&#x7C7B;&#x7ED3;&#x6784;&#xFF0C;&#x5B83;&#x4F1A;&#x5B9E;&#x73B0;<strong>SettableDraweeHierarchy</strong>&#x63A5;&#x53E3;&#xFF0C;&#x6211;&#x4EEC;&#x8FDB;&#x5165;&#x8BE5;&#x63A5;&#x53E3;&#x53D1;&#x73B0;&#x4E00;&#x5171;&#x6709;6&#x4E2A;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x4EEC;&#x5206;&#x522B;&#x4E3A;&#xFF1A;</p>\n<ol>\n<li><em>void reset();</em> &#x91CD;&#x65B0;&#x521D;&#x59CB;&#x5316;<strong>Hierarchy</strong></li>\n<li><em>void setImage(Drawable drawable, float progress, boolean immediate);</em> &#x8BBE;&#x7F6E;&#x5B9E;&#x9645;&#x9700;&#x8981;&#x5C55;&#x793A;&#x7684;&#x56FE;&#x7247;&#xFF0C;&#x5176;&#x4E2D;<strong>progress</strong>&#x8868;&#x793A;&#x56FE;&#x7247;&#x7684;&#x52A0;&#x8F7D;&#x8D28;&#x91CF;&#x8FDB;&#x5EA6;(&#x5728;&#x6E10;&#x8FDB;&#x5F0F;&#x4E2D;&#x4F1A;&#x4F7F;&#x7528;&#x5230;)</li>\n<li><em>void setProgress(float progress, boolean immediate);</em> &#x66F4;&#x65B0;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x8FDB;&#x5EA6;</li>\n<li><em>void setFailure(Throwable throwable);</em> &#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x5931;&#x8D25;&#x65F6;&#x8C03;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;<strong>failureImage</strong></li>\n<li><em>void setRetry(Throwable throwable);</em> &#x5F53;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x5931;&#x8D25;&#x65F6;&#x91CD;&#x65B0;&#x8FDB;&#x884C;&#x52A0;&#x8F7D;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;<strong>retryImage</strong></li>\n<li><em>void setControllerOverlay(Drawable drawable);</em> &#x7528;&#x6765;&#x8BBE;&#x7F6E;&#x56FE;&#x5C42;&#x8986;&#x76D6;</li>\n</ol>\n<p>&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x5728;<strong>GenericDraweeHierarchy</strong>&#x4E2D;&#x90FD;&#x4F1A;&#x505A;&#x51FA;&#x76F8;&#x5E94;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x540C;&#x65F6;&#x6700;&#x7EC8;&#x90FD;&#x4F1A;&#x5728;&#x5BF9;&#x5E94;&#x7684;<strong>DraweeView</strong>&#x4E2D;&#x7684;<strong>Controller</strong>&#x6765;&#x8C03;&#x7528;&#x3002;</p>\n<blockquote>\n<p>&#x81F3;&#x4E8E;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#xFF0C;&#x7531;&#x4E8E;&#x4EE3;&#x7801;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x4E00;&#x4E00;&#x5217;&#x4E3E;&#x51FA;&#x6765;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x67E5;&#x770B;<strong>GenericDraweeHierarchy</strong>&#x7684;&#x6E90;&#x7801;&#x3002;</p>\n</blockquote>\n<h2 id=\"DraweeHierarchy\"><a href=\"#DraweeHierarchy\" class=\"headerlink\" title=\"DraweeHierarchy\"></a>DraweeHierarchy</h2><p>&#x4E0A;&#x9762;&#x7684;<strong>SettableDraweeHierarchy</strong>&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x7236;&#x7C7B;&#x63A5;&#x53E3;&#x4E3A;<strong>DraweeHierarchy</strong>&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x4E2D;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x4E3A;<em>Drawable getTopLevelDrawable();</em>&#x3002;&#x662F;&#x4E0D;&#x662F;&#x5BF9;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E5F;&#x6709;&#x70B9;&#x719F;&#x6089;&#x5462;&#xFF1F;&#xFF08;&#x8DEF;&#x4EBA;&#x7532;&#xFF1A;&#x55EF;&#xFF0C;&#x597D;&#x50CF;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x63D0;&#x53CA;&#x8FC7;&#xFF01;&#xFF09;&#x5B83;&#x662F;&#x7528;&#x6765;&#x83B7;&#x53D6;&#x89C6;&#x56FE;&#x6811;&#x7684;&#x6700;&#x9876;&#x5C42;&#x89C6;&#x56FE;&#xFF0C;&#x5176;&#x5B9E;&#x8BF4;&#x767D;&#x4E86;&#x5C31;&#x662F;&#x663E;&#x793A;&#x51FA;&#x6765;&#x7684;<strong>Drawable</strong>&#x3002;&#x5B83;&#x4E3B;&#x8981;&#x5728;<strong>DraweeHolder</strong>&#x4E2D;&#x8C03;&#x7528;&#xFF0C;&#x6700;&#x7EC8;&#x4E5F;&#x4F1A;&#x7531;<em>void setHierarchy(DH hierarchy)</em> &#x4E0E; <em>void setController(@Nullable DraweeController draweeController)</em> &#x6765;&#x8C03;&#x7528;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">super.setImageDrawable(mDraweeHolder.getTopLevelDrawable());</span><br></pre></td></tr></table></figure>\n<p>&#x4ECE;&#x800C;&#x663E;&#x793A;&#x9700;&#x8981;&#x5C55;&#x793A;&#x7684;&#x56FE;&#x7247;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x56DE;&#x5230;&#x4E4B;&#x524D;&#x7684;<strong>GenericDraweeHierarchy</strong>&#x7C7B;&#x3002;&#x5728;&#x5F00;&#x59CB;&#x5206;&#x6790;&#x5B83;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x5B83;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x611F;&#x5FF5;-<code>&#x5C42;&#x7EA7;&#x6811;&#x6216;&#x8005;&#x8BF4;&#x56FE;&#x5C42;&#x6811;</code>&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x5C31;&#x628A;&#x5B83;&#x8BF4;&#x6210;&#x56FE;&#x5C42;&#x6811;&#x5427;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;<strong>Fresco</strong>&#x7684;&#x56FE;&#x5C42;&#x6811;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*  o RootDrawable (top level drawable)</span><br><span class=\"line\">*  |</span><br><span class=\"line\">*  +--o FadeDrawable</span><br><span class=\"line\">*     |</span><br><span class=\"line\">*     +--o ScaleTypeDrawable (placeholder branch, optional)</span><br><span class=\"line\">*     |  |</span><br><span class=\"line\">*     |  +--o Drawable (placeholder image)</span><br><span class=\"line\">*     |</span><br><span class=\"line\">*     +--o ScaleTypeDrawable (actual image branch)</span><br><span class=\"line\">*     |  |</span><br><span class=\"line\">*     |  +--o ForwardingDrawable (actual image wrapper)</span><br><span class=\"line\">*     |     |</span><br><span class=\"line\">*     |     +--o Drawable (actual image)</span><br><span class=\"line\">*     |</span><br><span class=\"line\">*     +--o null (progress bar branch, optional)</span><br><span class=\"line\">*     |</span><br><span class=\"line\">*     +--o Drawable (retry image branch, optional)</span><br><span class=\"line\">*     |</span><br><span class=\"line\">*     +--o ScaleTypeDrawable (failure image branch, optional)</span><br><span class=\"line\">*        |</span><br><span class=\"line\">*        +--o Drawable (failure image</span><br></pre></td></tr></table></figure>\n<p>&#x6839;&#x636E;&#x4E0A;&#x9762;&#x6240;&#x5C55;&#x793A;&#x7684;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x6700;&#x5E95;&#x5C42;&#x662F;&#x7531;<strong>RootDrawable</strong>&#x6765;&#x6784;&#x6210;&#xFF0C;&#x5B83;&#x6709;&#x4E00;&#x4E2A;&#x76F4;&#x63A5;&#x5B50;&#x5206;&#x652F;&#x4E3A;<strong>FadeDrawable</strong>&#x3002;&#x800C;&#x5728;<strong>FadeDrawable</strong>&#x4E2D;&#x53C8;&#x6709;5&#x4E2A;&#x76F4;&#x63A5;&#x5B50;&#x5206;&#x652F;&#xFF0C;&#x5206;&#x522B;&#x4E3A;<strong>placeholder branch</strong>&#x3001;<strong>actual image branch</strong>&#x3001;<strong>progressBar image branch</strong>&#x3001;<strong>retry image branch</strong>&#x4E0E;<strong>failure image branch</strong>&#x3002;&#x81F3;&#x4E8E;&#x8FD9;&#x4E9B;<strong>image</strong>&#x7684;&#x4F5C;&#x7528;&#x76F8;&#x4FE1;&#x4E0D;&#x7528;&#x6211;&#x518D;&#x591A;&#x505A;&#x8BF4;&#x660E;&#x4E86;&#xFF0C;&#x8FD9;&#x4E9B;<strong>image</strong>&#x9664;&#x4E86;<strong>actual image</strong>&#x662F;&#x5FC5;&#x987B;&#x8981;&#x660E;&#x786E;&#x6307;&#x5B9A;&#x7684;&#xFF0C;&#x5176;&#x5B83;&#x7684;&#x90FD;&#x662F;&#x53EF;&#x9009;&#x62E9;&#x7684;&#x914D;&#x7F6E;&#x3002;&#x56E0;&#x6B64;<strong>RootDrawable</strong>&#x4E0E;<strong>FadeDrawable</strong>&#x662F;&#x4E00;&#x5B9A;&#x5B58;&#x5728;&#x7684;&#x3002;&#x867D;&#x7136;&#x5176;&#x5B83;&#x7684;&#x90FD;&#x662F;&#x53EF;&#x9009;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x4F46;&#x65E0;&#x8BBA;&#x4F60;&#x662F;&#x5426;&#x9009;&#x62E9;&#x4E86;&#xFF0C;&#x5B83;&#x4EEC;&#x7684;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x90FD;&#x4F1A;&#x4FDD;&#x7559;&#x5728;&#x56FE;&#x5C42;&#x6811;&#x4E2D;&#x3002;&#x8FD8;&#x6709;&#x6BCF;&#x4E00;&#x4E2A;&#x5C42;&#x7EA7;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x72EC;&#x7ACB;&#x7684;<strong>scale type</strong>&#xFF0C;&#x5F53;&#x7136;<strong>rounding</strong>(&#x5706;&#x89D2;)&#x4E5F;&#x662F;&#x652F;&#x6301;&#x7684;&#x3002;</p>\n<blockquote>\n<p>&#x5176;&#x5B9E;&#x9664;&#x4E86;&#x8FD9;5&#x4E2A;&#x5206;&#x652F;&#xFF0C;&#x4E0E;&#x5B83;&#x4EEC;&#x540C;&#x4E00;&#x5C42;&#x6B21;&#x7684;&#x8FD8;&#x6709;<strong>background image</strong>&#x4E0E;<strong>overlay image</strong>&#xFF0C;&#x5B83;&#x4EEC;&#x5206;&#x522B;&#x4F4D;&#x4E8E;<strong>placeholder image</strong>&#x4E4B;&#x524D;&#x4E0E;<strong>failure image</strong>&#x4E4B;&#x540E;&#x3002;<strong>background</strong>&#x76F8;&#x4FE1;&#x90FD;&#x77E5;&#x9053;&#xFF0C;&#x56E0;&#x4E3A;&#x56FE;&#x7247;&#x90FD;&#x652F;&#x6301;<strong>background</strong>&#x4E0E;<strong>src</strong>&#xFF0C;<strong>overlay</strong>&#x4E3A;&#x56FE;&#x5C42;&#x8986;&#x76D6;&#x3002;&#x81F3;&#x4E8E;&#x4E3A;&#x4EC0;&#x4E48;&#x6CA1;&#x6709;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x7ED3;&#x6784;&#x4E2D;&#x663E;&#x793A;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x4E5F;&#x4E0D;&#x5F97;&#x800C;&#x77E5;&#xFF0C;&#x731C;&#x6D4B;&#x53EF;&#x80FD;&#x662F;&#x8FD9;&#x4E24;&#x4E2A;&#x5E76;&#x4E0D;&#x662F;<strong>Fresco</strong>&#x4E3B;&#x8981;&#x5E38;&#x7528;&#x7684;&#x7279;&#x6027;&#x3002;</p>\n</blockquote>\n<p>&#x90A3;&#x4E48;&#x8FD9;&#x4E9B;&#x56FE;&#x5C42;&#x7ED3;&#x6784;&#x662F;&#x901A;&#x8FC7;<strong>layers</strong>&#x6570;&#x7EC4;&#x6765;&#x4F53;&#x73B0;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x6765;&#x770B;&#x4E0B;<strong>GenericDraweeHierarchy</strong>&#x7684;&#x6E90;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GenericDraweeHierarchy(GenericDraweeHierarchyBuilder builder) {</span><br><span class=\"line\">  mResources = builder.getResources();</span><br><span class=\"line\">  mRoundingParams = builder.getRoundingParams();</span><br><span class=\"line\"> </span><br><span class=\"line\">  mActualImageWrapper = new ForwardingDrawable(mEmptyActualImageDrawable);</span><br><span class=\"line\"> </span><br><span class=\"line\">  int numOverlays = (builder.getOverlays() != null) ? builder.getOverlays().size() : 1;</span><br><span class=\"line\">  numOverlays += (builder.getPressedStateOverlay() != null) ? 1 : 0;</span><br><span class=\"line\"> </span><br><span class=\"line\">  // layer indices and count</span><br><span class=\"line\">  int numLayers = OVERLAY_IMAGES_INDEX + numOverlays;</span><br><span class=\"line\"> </span><br><span class=\"line\">  // array of layers</span><br><span class=\"line\">  Drawable[] layers = new Drawable[numLayers];</span><br><span class=\"line\">  layers[BACKGROUND_IMAGE_INDEX] = buildBranch(builder.getBackground(), null);</span><br><span class=\"line\">  layers[PLACEHOLDER_IMAGE_INDEX] = buildBranch(</span><br><span class=\"line\">      builder.getPlaceholderImage(),</span><br><span class=\"line\">      builder.getPlaceholderImageScaleType());</span><br><span class=\"line\">  layers[ACTUAL_IMAGE_INDEX] = buildActualImageBranch(</span><br><span class=\"line\">      mActualImageWrapper,</span><br><span class=\"line\">      builder.getActualImageScaleType(),</span><br><span class=\"line\">      builder.getActualImageFocusPoint(),</span><br><span class=\"line\">      builder.getActualImageColorFilter());</span><br><span class=\"line\">  layers[PROGRESS_BAR_IMAGE_INDEX] = buildBranch(</span><br><span class=\"line\">      builder.getProgressBarImage(),</span><br><span class=\"line\">      builder.getProgressBarImageScaleType());</span><br><span class=\"line\">  layers[RETRY_IMAGE_INDEX] = buildBranch(</span><br><span class=\"line\">      builder.getRetryImage(),</span><br><span class=\"line\">      builder.getRetryImageScaleType());</span><br><span class=\"line\">  layers[FAILURE_IMAGE_INDEX] = buildBranch(</span><br><span class=\"line\">      builder.getFailureImage(),</span><br><span class=\"line\">      builder.getFailureImageScaleType());</span><br><span class=\"line\">  if (numOverlays &gt; 0) {</span><br><span class=\"line\">    int index = 0;</span><br><span class=\"line\">    if (builder.getOverlays() != null) {</span><br><span class=\"line\">      for (Drawable overlay : builder.getOverlays()) {</span><br><span class=\"line\">        layers[OVERLAY_IMAGES_INDEX + index++] = buildBranch(overlay, null);</span><br><span class=\"line\">      }</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">      index = 1; // reserve space for one overlay</span><br><span class=\"line\">    }</span><br><span class=\"line\">    if (builder.getPressedStateOverlay() != null) {</span><br><span class=\"line\">      layers[OVERLAY_IMAGES_INDEX + index] = buildBranch(builder.getPressedStateOverlay(), null);</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\"> </span><br><span class=\"line\">  // fade drawable composed of layers</span><br><span class=\"line\">  mFadeDrawable = new FadeDrawable(layers);</span><br><span class=\"line\">   mFadeDrawable.setTransitionDuration(builder.getFadeDuration());</span><br><span class=\"line\"> </span><br><span class=\"line\">  // rounded corners drawable (optional)</span><br><span class=\"line\">  Drawable maybeRoundedDrawable =</span><br><span class=\"line\">      WrappingUtils.maybeWrapWithRoundedOverlayColor(mFadeDrawable, mRoundingParams);</span><br><span class=\"line\"> </span><br><span class=\"line\">  // top-level drawable</span><br><span class=\"line\">  mTopLevelDrawable = new RootDrawable(maybeRoundedDrawable);</span><br><span class=\"line\">  mTopLevelDrawable.mutate();</span><br><span class=\"line\"> </span><br><span class=\"line\">  resetFade();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6839;&#x636E;&#x6E90;&#x7801;&#x53EF;&#x4EE5;&#x660E;&#x663E;&#x7684;&#x770B;&#x51FA;&#x4E0D;&#x7BA1;<strong>overlay</strong>&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x5B83;&#x90FD;&#x4F1A;&#x4FDD;&#x7559;&#x56FE;&#x5C42;&#x5C42;&#x6B21;&#xFF0C;&#x5F53;&#x7136;&#x5982;&#x679C;&#x5B58;&#x5728;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x5728;<strong>OVERLAY_IMAGES_INDEX</strong>&#x4E4B;&#x540E;&#x589E;&#x52A0;&#x56FE;&#x5C42;&#x5C42;&#x6B21;&#x3002;<strong>layers</strong>&#x662F;&#x4E00;&#x4E2A;<strong>Drawable</strong>&#x6570;&#x7EC4;&#xFF0C;&#x8FD9;&#x91CC;&#x901A;&#x8FC7;<em>Drawable buildBranch(@Nullable Drawable drawable, @Nullable ScaleType scaleType)</em> &#x65B9;&#x6CD5;&#x6765;&#x521B;&#x5EFA;&#x5BF9;&#x5E94;&#x7684;<strong>Drawable</strong>&#x3002;&#x5728;&#x6700;&#x540E;&#xFF0C;&#x521B;&#x5EFA;&#x4E86;<strong>FadeDrawable</strong>&#x5E76;&#x5C06;<strong>layers</strong>&#x4F20;&#x9012;&#x7ED9;&#x5B83;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;<strong>FadeDrawable</strong>&#x7684;&#x7279;&#x6027;&#x5E94;&#x8BE5;&#x6709;&#x70B9;&#x7709;&#x76EE;&#x4E86;&#x5427;&#xFF0C;&#x5176;&#x5B9E;&#x5B83;&#x5185;&#x90E8;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5BF9;<strong>Drawable</strong>&#x6570;&#x7EC4;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002;&#x4E4B;&#x540E;<strong>RootDrawable</strong>&#x4E5F;&#x51FA;&#x73B0;&#x4E86;(&#x5173;&#x4E8E;<strong>Drawable</strong>&#x6587;&#x7AE0;&#x540E;&#x9762;&#x4F1A;&#x7EDF;&#x4E00;&#x5206;&#x6790;)&#xFF0C;&#x8FD9;&#x6837;&#x4E4B;&#x524D;&#x6240;&#x63D0;&#x5230;&#x7684;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x5C31;&#x5F62;&#x6210;&#x4E86;&#x3002;</p>\n<p>&#x65E2;&#x7136;<strong>actual image</strong>&#x662F;&#x4E00;&#x5B9A;&#x5B58;&#x5728;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x5B83;&#x771F;&#x6B63;&#x5C55;&#x793A;&#x4E4B;&#x524D;<strong>image</strong>&#x4E2D;&#x7684;&#x663E;&#x793A;&#x7528;&#x4EC0;&#x4E48;&#x6765;&#x63A7;&#x5236;&#x7684;&#x5462;&#xFF1F;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x6240;&#x63D0;&#x5230;&#x7684;<strong>SettableDraweeHierarchy</strong>&#x6765;&#x63A7;&#x5236;&#x3002;&#x5728;&#x771F;&#x5B9E;&#x7684;&#x56FE;&#x7247;&#x5C55;&#x793A;&#x51FA;&#x6765;&#x4E4B;&#x524D;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x5C55;&#x793A;<strong>placeholder image</strong>&#x7B49;&#x76F8;&#x5173;&#x56FE;&#x5C42;&#x3002;&#x5177;&#x4F53;&#x7684;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6765;&#x770B;&#x4E00;&#x4E0B;&#x5B83;&#x91CC;&#x9762;&#x5B9E;&#x73B0;&#x7684;&#x4E00;&#x4E9B;&#x65B9;&#x6CD5;&#x3002;</p>\n<h2 id=\"setImage\"><a href=\"#setImage\" class=\"headerlink\" title=\"setImage\"></a>setImage</h2><p>&#x8FD9;&#x91CC;&#x5C31;&#x62FF;<em>void setImage(Drawable drawable, float progress, boolean immediate)</em> &#x6765;&#x8FDB;&#x884C;&#x6DF1;&#x5165;&#x5206;&#x6790;&#xFF0C;&#x90A3;&#x4E48;&#x4E0B;&#x9762;&#x6765;&#x770B;&#x4E0B;&#x5B83;&#x7684;&#x6E90;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">public void setImage(Drawable drawable, float progress, boolean immediate) {</span><br><span class=\"line\">  drawable = WrappingUtils.maybeApplyLeafRounding(drawable, mRoundingParams, mResources);</span><br><span class=\"line\">  drawable.mutate();</span><br><span class=\"line\">  mActualImageWrapper.setDrawable(drawable);</span><br><span class=\"line\">  mFadeDrawable.beginBatchMode();</span><br><span class=\"line\">  fadeOutBranches();</span><br><span class=\"line\">  fadeInLayer(ACTUAL_IMAGE_INDEX);</span><br><span class=\"line\">  setProgress(progress);</span><br><span class=\"line\">  if (immediate) {</span><br><span class=\"line\">    mFadeDrawable.finishTransitionImmediately();</span><br><span class=\"line\">  }</span><br><span class=\"line\">  mFadeDrawable.endBatchMode();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x9996;&#x5148;&#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x4F7F;&#x7528;<strong>WrappingUtils</strong>&#x5DE5;&#x5177;&#x7C7B;&#x5E76;&#x4E14;&#x7ED3;&#x5408;<strong>RoundingParams</strong>&#x53C2;&#x6570;&#x6765;&#x91CD;&#x65B0;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x9644;&#x5E26;&#x5706;&#x89D2;&#x7684;<strong>Drawable</strong>&#x3002;&#x7136;&#x540E;&#x5C06;&#x65B0;&#x7684;<strong>Drawable</strong>&#x4EA4;&#x7531;<strong>mActualImageWrapper</strong>&#xFF0C;&#x7ED3;&#x5408;&#x4E0A;&#x9762;&#x7684;&#x5C42;&#x6B21;&#x7ED3;&#x679C;&#x5206;&#x6790;&#xFF0C;&#x4F1A;&#x5F88;&#x5BB9;&#x6613;&#x77E5;&#x9053;&#x8FD9;&#x5C31;&#x662F;&#x9700;&#x8981;&#x771F;&#x5B9E;&#x663E;&#x793A;&#x7684;&#x56FE;&#x5C42;&#x3002;&#x5B83;&#x662F;&#x4E00;&#x4E2A;<strong>ForwardingDrawable</strong>&#x7C7B;&#x578B;&#xFF0C;&#x8BE5;&#x7C7B;&#x4E3B;&#x8981;&#x662F;&#x5BF9;&#x4F20;&#x5165;&#x7684;&#x76EE;&#x6807;<strong>Drawable</strong>&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x539F;&#x751F;&#x65B9;&#x6CD5;&#x64CD;&#x4F5C;&#x3002;&#x4E0B;&#x4E00;&#x6B65;&#x8C03;&#x7528;<strong>FadeDrawable</strong>&#x7684;<em>beginBatchMode()</em>&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x4F5C;&#x7528;&#x4E3B;&#x8981;&#x4E3A;&#x4E86;&#x56FE;&#x5C42;&#x6279;&#x5904;&#x7406;&#x505A;&#x6807;&#x8BB0;&#xFF0C;&#x9632;&#x6B62;&#x5728;&#x6279;&#x5904;&#x7406;&#x65F6;&#x8FDB;&#x884C;<strong>invalidate</strong>&#x64CD;&#x4F5C;&#x3002;&#x76F4;&#x5230;&#x6700;&#x540E;&#x7684;<em>endBatchMode()</em>&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x4E4B;&#x540E;&#x624D;&#x6807;&#x8BC6;&#x7740;&#x56FE;&#x5C42;&#x6279;&#x5904;&#x7406;&#x64CD;&#x4F5C;&#x7ED3;&#x675F;&#x3002;&#x8BE5;&#x6279;&#x5904;&#x7406;&#x64CD;&#x4F5C;&#x7684;&#x76EE;&#x7684;&#x662F;&#x5C06;<strong>actual image</strong>&#x56FE;&#x5C42;&#x663E;&#x793A;&#x51FA;&#x6765;&#xFF0C;&#x6240;&#x4EE5;&#x9996;&#x5148;&#x8C03;&#x7528;<em>fadeOutBranches()</em>&#x65B9;&#x6CD5;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void fadeOutBranches() {</span><br><span class=\"line\">  fadeOutLayer(PLACEHOLDER_IMAGE_INDEX);</span><br><span class=\"line\">  fadeOutLayer(ACTUAL_IMAGE_INDEX);</span><br><span class=\"line\">  fadeOutLayer(PROGRESS_BAR_IMAGE_INDEX);</span><br><span class=\"line\">  fadeOutLayer(RETRY_IMAGE_INDEX);</span><br><span class=\"line\">  fadeOutLayer(FAILURE_IMAGE_INDEX);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x5BF9;&#x4E0A;&#x8FF0;&#x63D0;&#x5230;&#x7684;&#x6240;&#x6709;&#x56FE;&#x5C42;&#x8FDB;&#x884C;<em>fadeOutLayer()</em>&#x64CD;&#x4F5C;&#xFF0C;&#x7EE7;&#x7EED;&#x8FDB;&#x5165;<em>fadeOutLayer()</em>&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void fadeOutLayer(int index) {</span><br><span class=\"line\">  if (index &gt;= 0) {</span><br><span class=\"line\">    mFadeDrawable.fadeOutLayer(index);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x53D1;&#x73B0;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x65E0;&#x975E;&#x5C31;&#x662F;&#x8C03;&#x7528;&#x4E86;<strong>FadeDrawable</strong>&#x7684;<em>fadeOutLayer()</em>&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void fadeOutLayer(int index) {</span><br><span class=\"line\">  mTransitionState = TRANSITION_STARTING;</span><br><span class=\"line\">  mIsLayerOn[index] = false;</span><br><span class=\"line\">  invalidateSelf();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x63D0;&#x5230;&#x8FC7;<strong>FadeDrawable</strong>&#x672C;&#x8D28;&#x4E0A;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x65F6;&#x4E00;&#x4E2A;<strong>Drawable</strong>&#x6570;&#x7EC4;&#xFF0C;&#x5185;&#x90E8;&#x90FD;&#x662F;&#x56F4;&#x7ED5;&#x7740;&#x6570;&#x7EC4;&#x6574;&#x4F53;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002;&#x5BF9;&#x5E94;&#x7684;&#x8FD8;&#x6709;<em>fadeInLayer()</em></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void fadeInLayer(int index) {</span><br><span class=\"line\">  if (index &gt;= 0) {</span><br><span class=\"line\">    mFadeDrawable.fadeInLayer(index);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5728;<strong>FadeDrawable</strong>&#x4E2D;&#x9664;&#x4E86;&#x7528;&#x6765;&#x4FDD;&#x5B58;&#x76F8;&#x5E94;&#x7684;<strong>Drawable</strong>&#x6570;&#x7EC4;<strong>mLayers</strong>&#xFF0C;&#x8FD8;&#x6709;&#x4E0E;&#x5176;&#x76F8;&#x5BF9;&#x5E94;&#x7684;<strong>mIsLayerOn</strong>&#x5E03;&#x5C14;&#x6570;&#x7EC4;&#xFF0C;&#x8BE5;&#x6570;&#x7EC4;&#x7528;&#x6765;&#x6807;&#x8BC6;&#x5404;&#x4E2A;<strong>Hierarchy</strong>&#x4E2D;&#x7684;&#x56FE;&#x5C42;&#x662F;&#x5426;&#x9700;&#x8981;&#x5C55;&#x793A;&#x3002;&#x6240;&#x4EE5;<em>fadeOutLayer()</em>&#x662F;&#x5BF9;<strong>index</strong>&#x5904;&#x7684;&#x56FE;&#x5C42;&#x8FDB;&#x884C;&#x9690;&#x85CF;&#x6807;&#x8BC6;&#x3002;&#x6700;&#x7EC8;&#x7684;&#x663E;&#x9690;&#x64CD;&#x4F5C;&#x90FD;&#x4F1A;&#x8F6C;&#x5316;&#x4E3A;&#x5728;<em>void draw(Canvas canvas)</em>&#x65B9;&#x6CD5;&#x4E2D;&#x8FDB;&#x884C;<strong>alpha</strong>&#x64CD;&#x4F5C;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x518D;&#x56DE;&#x5230;&#x4E4B;&#x524D;&#x7684;<em>setImage()</em>&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;<em>fadeOutBranches()</em>&#x662F;&#x5BF9;&#x76F8;&#x5173;&#x7684;&#x56FE;&#x5C42;&#x8FDB;&#x884C;&#x9690;&#x85CF;&#x6807;&#x8BC6;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x901A;&#x8FC7;<em>fadeInLayer(ACTUAL_IMAGE_INDEX)</em>&#x65B9;&#x6CD5;&#x6539;&#x53D8;<strong>actual image</strong>&#x56FE;&#x5C42;&#x7684;&#x6807;&#x8BC6;&#xFF0C;&#x5C06;&#x5B83;&#x6539;&#x53D8;&#x6210;&#x663E;&#x793A;&#x72B6;&#x6001;&#x3002;&#x6700;&#x540E;&#x5982;&#x679C;&#x6709;<strong>progressBar image</strong>&#x56FE;&#x5C42;&#x7684;&#x8BDD;&#xFF0C;&#x4E5F;&#x5C06;&#x4F1A;&#x7531;<em>setProgress(progress)</em>&#x65B9;&#x6CD5;&#x6765;&#x4F53;&#x73B0;&#x3002;<strong>immediate</strong>&#x662F;&#x7528;&#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E4B;&#x540E;&#x7684;&#x663E;&#x9690;&#x64CD;&#x4F5C;&#x7ACB;&#x9A6C;&#x5B9E;&#x73B0;&#x6216;&#x8005;&#x6E10;&#x53D8;&#x8FC7;&#x6E21;&#x5B9E;&#x73B0;(&#x5185;&#x90E8;&#x5C31;&#x662F;&#x5BF9;alpha&#x8FDB;&#x884C;&#x767E;&#x5206;&#x6BD4;&#x64CD;&#x4F5C;&#xFF0C;&#x5185;&#x90E8;&#x6709;&#x4E2A;mDurationMs&#xFF0C;&#x8BE5;&#x65F6;&#x95F4;&#x503C;&#x4E5F;&#x662F;&#x6587;&#x7AE0;&#x5F00;&#x5934;&#x63D0;&#x5230;&#x7684;builder&#x4E2D;&#x7684;fadeDuration)&#x3002;&#x8FD9;&#x6837;&#x6574;&#x4E2A;&#x7684;&#x5B9E;&#x9645;&#x56FE;&#x7247;&#x5C55;&#x793A;&#x6D41;&#x7A0B;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5206;&#x6790;&#x5B8C;&#x6BD5;&#xFF0C;&#x6240;&#x4EE5;<strong>Hierarchy</strong>&#x4E2D;&#x6700;&#x91CD;&#x8981;&#x7684;&#x8FD8;&#x662F;&#x5BF9;&#x56FE;&#x5C42;&#x6982;&#x5FF5;&#x7684;&#x7406;&#x89E3;&#x3002;&#x4E0B;&#x9762;&#x518D;&#x5BF9;<strong>GenericDraweeHierarchy</strong>&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x5176;&#x5B83;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x7B80;&#x8981;&#x7684;&#x8BF4;&#x660E;&#xFF1A;</p>\n<ul>\n<li><em>Drawable buildActualImageBranch(Drawable drawable, @Nullable ScaleType scaleType, @Nullable PointF focusPoint, @Nullable ColorFilter colorFilter)</em> &#x6784;&#x5EFA;&#x5B9E;&#x9645;&#x5C55;&#x793A;&#x56FE;&#x7247;&#x7684;&#x56FE;&#x5C42;&#x5206;&#x652F;&#xFF0C;&#x5185;&#x90E8;&#x5BF9;&#x4E8E;<strong>Drawable</strong>&#x7684;&#x521B;&#x5EFA;&#x8FD8;&#x662F;&#x501F;&#x52A9;<strong>WrappingUtils</strong>&#x5DE5;&#x5177;&#x7C7B;</li>\n<li><em>Drawable buildBranch(@Nullable Drawable drawable, @Nullable ScaleType scaleType)</em> &#x6784;&#x5EFA;&#x9664;&#x5B9E;&#x9645;&#x5C55;&#x793A;&#x56FE;&#x7247;&#x4E4B;&#x5916;&#x7684;&#x5176;&#x5B83;&#x56FE;&#x5C42;&#x5206;&#x652F;&#xFF0C;<strong>Drawable</strong>&#x7684;&#x521B;&#x5EFA;&#x4E5F;&#x662F;&#x501F;&#x52A9;<strong>WrappingUtils</strong>&#x5DE5;&#x5177;&#x7C7B;</li>\n<li><em>void resetFade()</em> &#x521D;&#x59CB;&#x5316;&#x56FE;&#x5C42;&#x7ED3;&#x6784;</li>\n</ul>\n<blockquote>\n<p>&#x4E3B;&#x8981;&#x7684;&#x5C31;&#x8FD9;&#x51E0;&#x4E2A;&#x5427;&#xFF0C;&#x5176;&#x5B83;&#x7684;&#x90FD;&#x5DF2;&#x7ECF;&#x5728;&#x4E0A;&#x9762;&#x5206;&#x6790;&#x6D41;&#x7A0B;&#x4E2D;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#x4E86;&#x3002;</p>\n</blockquote>\n<h1 id=\"Drawable\"><a href=\"#Drawable\" class=\"headerlink\" title=\"Drawable\"></a>Drawable</h1><p>&#x6700;&#x540E;&#x518D;&#x6574;&#x7406;&#x4E00;&#x4E0B;<strong>Fresco</strong>&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x76F8;&#x5173;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<strong>Drawable</strong>&#x5B50;&#x7C7B;</p>\n<ol>\n<li><strong>ArrayDrawable</strong>&#xFF1A;<strong>Drawable</strong>&#x6570;&#x7EC4;&#x7684;&#x96C6;&#x5408;&#x4F53;&#xFF0C;&#x901A;&#x8FC7;<strong>layers</strong>&#x6570;&#x7EC4;&#x6765;&#x7BA1;&#x7406;<strong>Drawable</strong>&#xFF0C;&#x5185;&#x90E8;&#x7684;&#x90FD;&#x662F;&#x5BF9;&#x6570;&#x7EC4;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;<strong>Drawable</strong>&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E0E;<strong>Android</strong>&#x539F;&#x751F;&#x7684;<strong>LayerDrawable</strong>&#xFF0C;&#x53EA;&#x662F;&#x5B83;&#x5E76;&#x4E0D;&#x652F;&#x6301;<strong>add</strong>&#x4E0E;<strong>remove</strong>&#x64CD;&#x4F5C;</li>\n<li><strong>ForwardingDrawable</strong>&#xFF1A;&#x5BF9;&#x4F20;&#x5165;&#x7684;&#x76EE;&#x6807;<strong>Drawable</strong>&#x5373;&#x64CD;&#x4F5C;&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#x5904;&#x7406;&#xFF0C;&#x8BE5;&#x65B0;&#x7C7B;&#x7684;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x540C;&#x65F6;&#x4FDD;&#x7559;&#x76EE;&#x6807;<strong>Drawable</strong>&#x7684;&#x5404;&#x4E2A;&#x72B6;&#x6001;&#xFF0C;&#x4E0D;&#x4F9D;&#x8D56;&#x4E0E;&#x76EE;&#x6807;&#x7C7B;&#x7684;&#x7EC6;&#x8282;&#x5B9E;&#x73B0;&#xFF0C;&#x63D0;&#x9AD8;&#x65B0;&#x7C7B;&#x7684;&#x7A33;&#x5B9A;&#x6027;&#xFF0C;&#x8BE5;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x79F0;&#x4E4B;&#x4E3A;&#x590D;&#x5408;&#x3002;<strong>Fresco</strong>&#x4E2D;&#x7EDD;&#x5927;&#x591A;&#x6570;&#x81EA;&#x5B9A;&#x4E49;<strong>Drawable</strong>&#x90FD;&#x662F;&#x5B83;&#x7684;&#x5B50;&#x7C7B;&#x3002;</li>\n<li><strong>AutoRotateDrawable</strong>&#xFF1A;&#x5B83;&#x7EE7;&#x627F;&#x4E8E;<strong>ForwardingDrawable</strong>&#xFF0C;&#x5B9E;&#x73B0;&#x7684;&#x662F;&#x5BF9;<strong>Drawable</strong>&#x7684;&#x65CB;&#x8F6C;&#x64CD;&#x4F5C;</li>\n<li><strong>FadeDrawable</strong>&#xFF1A;&#x5B83;&#x7EE7;&#x627F;&#x4E8E;<strong>ArrayDrawable</strong>&#xFF0C;&#x4E4B;&#x524D;&#x4E5F;&#x8BE6;&#x7EC6;&#x63D0;&#x5230;&#x8FC7;&#xFF0C;<strong>Hierarchy</strong>&#x4E2D;&#x7684;&#x4E3B;&#x8981;&#x56FE;&#x5C42;&#x96C6;&#x5408;&#x4F53;&#x3002;&#x4E3B;&#x8981;&#x662F;&#x901A;&#x8FC7;<strong>mLayers</strong>&#x4E0E;<strong>mIsLayerOn</strong>&#x6570;&#x7EC4;&#x6765;&#x63A7;&#x5236;&#x6570;&#x7EC4;&#x4E2D;&#x5404;&#x4E2A;<strong>Drawable</strong>&#x7684;<strong>alpha</strong>&#x503C;&#xFF0C;&#x5373;&#x663E;&#x9690;</li>\n<li><strong>MatrixDrawable</strong>&#xFF1A;&#x5B83;&#x7EE7;&#x627F;&#x4E8E;<strong>ForwardingDrawable</strong>&#xFF0C;&#x987E;&#x540D;&#x601D;&#x4E49;&#x901A;&#x8FC7;&#x77E9;&#x9635;&#x6765;&#x6539;&#x53D8;<strong>Drawable</strong>&#x72B6;&#x6001;&#x3002;</li>\n<li><strong>OrientedDrawable</strong>&#xFF1A;&#x5B83;&#x4E5F;&#x7EE7;&#x627F;&#x4E8E;<strong>ForwardingDrawable</strong>&#xFF0C;&#x5B83;&#x4E0D;&#x540C;&#x4E8E;<strong>AutoRotateDrawable</strong>&#x7684;&#x662F;&#xFF0C;&#x5B83;&#x53EA;&#x652F;&#x6301;90&#x5EA6;&#x7684;&#x500D;&#x6570;&#x89D2;&#x5EA6;&#x65CB;&#x8F6C;&#x3002;</li>\n<li><strong>ProgressBarDrawable</strong>&#xFF1A;&#x8FDB;&#x5EA6;&#x6761;<strong>Drawable</strong>&#xFF0C;&#x652F;&#x6301;&#x6A2A;&#x7AD6;&#x65B9;&#x5411;&#x3002;</li>\n<li><strong>RoundedBitmapDrawable</strong>&#xFF1A;&#x7EE7;&#x627F;&#x4E8E;<strong>BitmapDrawable</strong>&#xFF0C;&#x6839;&#x636E;<strong>Bitmap</strong>&#x6765;&#x521B;&#x5EFA;&#x6709;&#x5173;&#x5706;&#x89D2;&#x7684;<strong>Drawable</strong>&#xFF0C;&#x4E3B;&#x8981;&#x5728;<strong>WrappingUtils</strong>&#x7C7B;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x7528;&#x4F8B;&#x6784;&#x5EFA;&#x5168;&#x65B0;&#x7684;&#x5706;&#x89D2;<strong>Drawable</strong></li>\n<li><strong>RoundedColorDrawable</strong>&#xFF1A;&#x7EE7;&#x627F;&#x4E8E;<strong>Drawable</strong>&#xFF0C;&#x6839;&#x636E;<strong>Color</strong>&#x6765;&#x521B;&#x5EFA;&#x5706;&#x89D2;<strong>Drawable</strong>&#xFF0C;&#x4E3B;&#x8981;&#x5728;<strong>WrappingUtils</strong>&#x7C7B;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x7528;&#x4F8B;&#x6784;&#x5EFA;&#x5168;&#x65B0;&#x7684;&#x5706;&#x89D2;<strong>Drawable</strong></li>\n<li><strong>RoundedCornersDrawable</strong>&#xFF1A;&#x7EE7;&#x627F;&#x4E8E;<strong>ForwardingDrawable</strong>&#xFF0C;&#x7528;&#x4E8E;&#x8BBE;&#x8BA1;<strong>overLay</strong>&#x8986;&#x76D6;&#x56FE;&#x7247;&#x5706;&#x89D2;&#xFF0C;&#x4E3B;&#x8981;&#x5728;<strong>WrappingUtils</strong>&#x7C7B;&#x4E2D;&#x4F7F;&#x7528;</li>\n<li><strong>ScaleTypeDrawable</strong>&#xFF1A;&#x7EE7;&#x627F;&#x4E8E;<strong>ForwardingDrawable</strong>&#xFF0C;&#x7528;&#x4E8E;&#x7F29;&#x653E;&#x7C7B;&#x578B;&#x7684;<strong>Drawable</strong></li>\n</ol>\n<h1 id=\"End\"><a href=\"#End\" class=\"headerlink\" title=\"End\"></a>End</h1><p>&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x662F;&#x5206;&#x6790;<strong>Fresco</strong>&#x4E2D;&#x6709;&#x5173;<strong>Hierarchy</strong>&#x76F8;&#x5173;&#x7684;&#x5B9E;&#x73B0;&#x4E0E;&#x539F;&#x7406;&#xFF0C;&#x901A;&#x8FC7;&#x5206;&#x6790;&#x53D1;&#x73B0;<strong>Hierarchy</strong>&#x4E2D;&#x90FD;&#x662F;&#x5BF9;<strong>Drawable</strong>&#x56FE;&#x5C42;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x5176;&#x5B83;&#x7684;&#x7F13;&#x5B58;&#x3001;&#x8BF7;&#x6C42;&#x4E4B;&#x7C7B;&#x7684;&#x903B;&#x8F91;&#x3002;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x4F60;&#x4F7F;&#x7528;<strong>Fresco</strong>&#x7684;&#x65F6;&#x5019;&#x53EA;&#x4F7F;&#x7528;<strong>Hierarchy</strong>&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x4E0E;&#x522B;&#x7684;<strong>ImageView</strong>&#x6CA1;&#x6709;&#x591A;&#x5927;&#x7684;&#x533A;&#x522B;&#xFF0C;&#x771F;&#x6B63;&#x7684;&#x56FE;&#x5C42;&#x64CD;&#x4F5C;&#x4E0E;&#x7F13;&#x5B58;&#x63A7;&#x5236;&#x90FD;&#x5728;<strong>Controller</strong>&#x4E2D;&#xFF0C;&#x6240;&#x4EE5;&#x4E0B;&#x7BC7;&#x6587;&#x7AE0;&#x5C06;&#x8FDB;&#x5165;<strong>Controller</strong>&#x89E3;&#x6790;&#xFF0C;&#x6765;&#x8BE6;&#x7EC6;&#x4E86;&#x89E3;&#x5B83;&#x7684;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x3002;</p>\n<p><a href=\"https://github.com/idisfkj/Fresco-Source-Analysis\" target=\"_blank\" rel=\"noopener\">Fresco&#x6E90;&#x7801;&#x5206;&#x6790;&#x7CFB;&#x5217;Github&#x5730;&#x5740;</a></p>\n","categories":["android"],"tags":["源码分析"]},{"title":"Fresco源码分析之DraweeView","url":"https://www.rousetime.com/2017/11/28/Fresco源码分析之DraweeView/","content":"<p>&#x5728;<code>Android</code>&#x4E2D;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x7684;&#x6846;&#x67B6;&#x5F88;&#x591A;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;<code>Fresco</code>&#x3001;<code>Picasso</code>&#x3001;<code>Glide</code>&#x4E0E;<code>Imageloader</code>&#x3002;&#x5B83;&#x4EEC;&#x90FD;&#x6709;&#x5404;&#x81EA;&#x7684;&#x4F18;&#x70B9;&#xFF0C;&#x4F46;&#x603B;&#x7684;&#x6765;&#x8BF4;&#xFF0C;&#x4F7F;&#x7528;&#x8D77;&#x6765;&#x65B9;&#x4FBF;&#x7B80;&#x5355;&#x3001;&#x53EF;&#x914D;&#x7F6E;&#x6027;&#x9AD8;&#x4E0E;&#x63D0;&#x4F9B;&#x826F;&#x597D;&#x7684;&#x7F13;&#x5B58;&#x673A;&#x5236;&#x3002;&#x7531;&#x4E8E;&#x5E73;&#x5E38;&#x4E3B;&#x8981;&#x7528;&#x7684;&#x8FD8;&#x662F;<code>Fresco</code>&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x6709;&#x5FC5;&#x8981;&#x5BF9;<code>Fresco</code>&#x7684;&#x539F;&#x7406;&#x8FDB;&#x884C;&#x6DF1;&#x5165;&#x7814;&#x7A76;&#x3002;&#x8FD9;&#x6837;&#x5BF9;&#x4E8E;&#x4EE5;&#x540E;&#x7684;&#x4F7F;&#x7528;&#x4E0E;&#x7406;&#x89E3;&#x5C06;&#x4F1A;&#x5F97;&#x5230;&#x5DE8;&#x5927;&#x7684;&#x5E2E;&#x52A9;&#x3002;</p>\n<p><code>Fresco</code>&#x662F;&#x4E13;&#x6CE8;&#x4E8E;&#x5BF9;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x800C;&#x8BBE;&#x8BA1;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x6240;&#x4EE5;&#x5BF9;&#x4E8E;&#x4EE5;&#x56FE;&#x7247;&#x4E3A;&#x4E3B;&#x7684;<code>App</code>&#x5F3A;&#x70C8;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x3002;<code>Fresco</code>&#x5BF9;&#x4E8E;&#x56FE;&#x7247;&#x7684;&#x5C55;&#x793A;&#x652F;&#x6301;&#x591A;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;<code>backgroud image</code>(&#x80CC;&#x666F;&#x56FE;)&#x3001;<code>placeholder image</code>(&#x5360;&#x4F4D;&#x56FE;)&#x3001;<code>actual image</code>(&#x52A0;&#x8F7D;&#x7684;&#x56FE;&#x7247;)&#x3001;<code>progress bar image</code>(&#x8FDB;&#x5EA6;&#x6761;)&#x3001;<code>retry image</code>(&#x91CD;&#x65B0;&#x52A0;&#x8F7D;&#x7684;&#x56FE;&#x7247;)&#x3001;<code>failure image</code>(&#x5931;&#x8D25;&#x56FE;&#x7247;)&#x4E0E;<code>overlay image</code>(&#x53E0;&#x52A0;&#x56FE;)&#x3002;<code>Fresco</code>&#x65E2;&#x7136;&#x652F;&#x6301;&#x8FD9;&#x4E48;&#x591A;&#x56FE;&#x7247;&#x5C55;&#x793A;&#x60C5;&#x51B5;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5BF9;&#x8FD9;&#x6B21;&#x56FE;&#x5C42;&#x7684;&#x7BA1;&#x7406;&#x6A21;&#x5F0F;&#x53C8;&#x662F;&#x600E;&#x4E48;&#x6837;&#x7684;&#x5462;&#xFF1F;<code>Fresco</code>&#x5BF9;&#x4E8E;&#x8FD9;&#x4E9B;&#x56FE;&#x5C42;&#x7684;&#x7BA1;&#x7406;&#x90FD;&#x4EA4;&#x7ED9;&#x4E86;<code>Hierarchy</code>&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x56FE;&#x5C42;&#x7684;&#x6570;&#x636E;&#x90FD;&#x901A;&#x8FC7;<code>Controller</code>&#x6765;&#x8BBE;&#x7F6E;&#x3002;&#x5148;&#x4E0D;&#x5206;&#x6790;&#x8FD9;&#x4E9B;&#xFF0C;&#x8FD9;&#x4E9B;&#x540E;&#x7EED;&#x6587;&#x7AE0;&#x4F1A;&#x8BE6;&#x7EC6;&#x5206;&#x6790;&#xFF0C;&#x4ECA;&#x5929;&#x5148;&#x4ECE;<code>Fresco</code>&#x7684;&#x57FA;&#x672C;&#x7EC4;&#x4EF6;&#x5F00;&#x59CB;&#x3002;</p>\n<h2 id=\"SimpleDraweeView\"><a href=\"#SimpleDraweeView\" class=\"headerlink\" title=\"SimpleDraweeView\"></a>SimpleDraweeView</h2><blockquote>\n<p>&#x9996;&#x5148;&#x8FD9;&#x662F;&#x5BF9;<code>Fresco</code>&#x7684;&#x6E90;&#x7801;&#x5206;&#x6790;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x770B;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E4B;&#x524D;&#x4F60;&#x5E94;&#x8BE5;&#x8981;&#x6709;&#x4F7F;&#x7528;<code>Fresco</code>&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7684;&#x5F3A;&#x70C8;&#x63A8;&#x8350;&#x770B;&#x4E0B;<a href=\"https://www.fresco-cn.org/docs/getting-started.html\" target=\"_blank\" rel=\"noopener\">Fresco&#x5B98;&#x65B9;&#x6587;&#x6863;</a>&#x3002;</p>\n</blockquote>\n<p>&#x6211;&#x4EEC;&#x4F7F;&#x7528;<code>Fresco</code>&#x8FDB;&#x884C;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#xFF0C;&#x4F7F;&#x7528;&#x6700;&#x591A;&#x7684;&#x8FD8;&#x662F;&#x5DF2;&#x7ECF;&#x5C01;&#x88C5;&#x597D;&#x7684;<code>SimpleDraweeView</code>&#xFF0C;&#x800C;&#x5728;<code>SimpleDraweeView</code>&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#x4F1A;&#x8C03;&#x7528;<code>init()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x7684;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void init(Context context, @Nullable AttributeSet attrs) {</span><br><span class=\"line\">    if (isInEditMode()) {</span><br><span class=\"line\">      return;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    Preconditions.checkNotNull(</span><br><span class=\"line\">        sDraweeControllerBuilderSupplier,</span><br><span class=\"line\">        &quot;SimpleDraweeView was not initialized!&quot;);</span><br><span class=\"line\">    mSimpleDraweeControllerBuilder = sDraweeControllerBuilderSupplier.get();</span><br><span class=\"line\"> </span><br><span class=\"line\">    if (attrs != null) {</span><br><span class=\"line\">      TypedArray gdhAttrs = context.obtainStyledAttributes(</span><br><span class=\"line\">          attrs,</span><br><span class=\"line\">          R.styleable.SimpleDraweeView);</span><br><span class=\"line\">      try {</span><br><span class=\"line\">        if (gdhAttrs.hasValue(R.styleable.SimpleDraweeView_actualImageUri)) {</span><br><span class=\"line\">          setImageURI(</span><br><span class=\"line\">              Uri.parse(gdhAttrs.getString(R.styleable.SimpleDraweeView_actualImageUri)),</span><br><span class=\"line\">              null);</span><br><span class=\"line\">        } else if (gdhAttrs.hasValue((R.styleable.SimpleDraweeView_actualImageResource))) {</span><br><span class=\"line\">          int resId = gdhAttrs.getResourceId(</span><br><span class=\"line\">              R.styleable.SimpleDraweeView_actualImageResource,</span><br><span class=\"line\">              NO_ID);</span><br><span class=\"line\">          if (resId != NO_ID) {</span><br><span class=\"line\">            setActualImageResource(resId);</span><br><span class=\"line\">          }</span><br><span class=\"line\">        }</span><br><span class=\"line\">      } finally {</span><br><span class=\"line\">        gdhAttrs.recycle();</span><br><span class=\"line\">      }</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x5B83;&#x4F1A;&#x5BF9;<code>sDraweeControllerBuilderSupplier</code>&#x8FDB;&#x884C;<code>null</code>&#x5224;&#x65AD;&#xFF0C;&#x5982;&#x679C;&#x4E3A;<code>null</code>&#x5C06;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;<code>sDraweeControllerBuilderSupplier</code>&#x662F;&#x4F9B;&#x5E94;&#x7C7B;&#xFF0C;&#x901A;&#x8FC7;&#x5B83;&#x7684;<code>get</code>&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;<code>DraweeControllerBuilder</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;<code>controller</code>&#x6784;&#x9020;&#x5668;&#xFF0C;&#x8FD9;&#x4E2A;&#x4EE5;&#x540E;&#x7684;&#x7AE0;&#x8282;&#x4F1A;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#x3002;&#x7A7A;&#x5224;&#x65AD;&#x7684;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x5728;&#x4F7F;&#x7528;<code>SimpleDraweeView</code>&#x4E4B;&#x524D;&#x5FC5;&#x987B;&#x521D;&#x59CB;&#x5316;<code>sDraweeControllerBuilderSupplier</code>&#x3002;&#x5728;<code>SimpleDraweeView</code>&#x4E2D;&#x6211;&#x4EEC;&#x80FD;&#x627E;&#x5230;&#x5B83;&#x7684;&#x521D;&#x59CB;&#x5316;&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void initialize(</span><br><span class=\"line\">      Supplier&lt;? extends SimpleDraweeControllerBuilder&gt; draweeControllerBuilderSupplier) {</span><br><span class=\"line\">    sDraweeControllerBuilderSupplier = draweeControllerBuilderSupplier;</span><br><span class=\"line\">  }</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x662F;&#x4E00;&#x4E2A;<code>static</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5728;<code>SimpleDraweeView</code>&#x521D;&#x59CB;&#x5316;&#x4E4B;&#x524D;&#x52A0;&#x8F7D;&#x4E00;&#x6B21;&#x5373;&#x53EF;&#x3002;&#x8FD9;&#x662F;<code>SimpleDraweeView</code>&#x7684;&#x5173;&#x952E;&#x3002;&#x5B83;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void setImageURI(Uri uri, @Nullable Object callerContext) {</span><br><span class=\"line\">    //&#x901A;&#x8FC7;controller &#x6765;&#x4FDD;&#x5B58;Uri &#x7B49;&#x76F8;&#x5173;&#x4FE1;&#x606F;</span><br><span class=\"line\">    DraweeController controller = mSimpleDraweeControllerBuilder</span><br><span class=\"line\">        .setCallerContext(callerContext)</span><br><span class=\"line\">        .setUri(uri)</span><br><span class=\"line\">        .setOldController(getController())</span><br><span class=\"line\">        .build();</span><br><span class=\"line\">    setController(controller);</span><br><span class=\"line\">  }</span><br></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;<code>mSimpleDraweeControllerBuilder</code>&#x6765;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;<code>Controller</code>&#xFF0C;&#x800C;<code>Controller</code>&#x662F;&#x7531;<code>build</code>&#x6A21;&#x5F0F;&#x6240;&#x521B;&#x5EFA;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x80FD;&#x770B;&#x5230;<code>uri</code>&#x4E5F;&#x4EA4;&#x7531;<code>Controller</code>&#x7BA1;&#x7406;&#x3002;&#x5176;&#x5B9E;&#x6700;&#x7EC8;<code>uri</code>&#x4F1A;&#x5C01;&#x88C5;&#x6210;&#x4E00;&#x4E2A;<code>ImageRequest</code>&#xFF0C;<code>Controller</code>&#x771F;&#x6B63;&#x6301;&#x6709;&#x7684;&#x662F;<code>uri</code>&#x7684;&#x5C01;&#x88C5;&#x4F53;<code>ImageRequest</code>&#x3002;&#x5728;<code>SimpleDraweeView</code>&#x4E2D;&#x5B83;&#x4F1A;&#x91CD;&#x5199;<code>setImageURI</code>&#x65B9;&#x6CD5;&#xFF0C;&#x6700;&#x7EC8;&#x4E5F;&#x5C31;&#x662F;&#x5C06;<code>ImageView</code>&#x4E2D;&#x7684;&#x539F;&#x751F;&#x65B9;&#x6CD5;&#x7ED9;&#x8986;&#x76D6;&#x6389;&#x3002;&#x8FD8;&#x6709;&#x5176;&#x5B83;&#x7684;&#x7C7B;&#x4F3C;&#x7684;<code>setImageResource</code>&#x4E0E;<code>setImageBitmap</code>&#x7B49;&#xFF0C;<code>Fresco</code>&#x90FD;&#x5728;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x4E0A;&#x52A0;&#x4E86;<code>@Deprecated</code>&#xFF0C;&#x610F;&#x601D;&#x5C31;&#x662F;&#x8BF4;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x7684;&#x8BDD;&#x5C31;&#x8DDF;&#x76F4;&#x63A5;&#x4F7F;&#x7528;<code>ImageView</code>&#x6CA1;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF0C;&#x8FD9;&#x5C31;&#x65E0;&#x6CD5;&#x4F53;&#x9A8C;&#x5230;<code>Fresco</code>&#x7684;&#x5F3A;&#x5927;&#x7684;&#x7279;&#x6027;&#x3002;&#x5728;<code>Fresco</code>&#x4E2D;&#x7EDF;&#x4E00;&#x7531;<code>setController</code>&#x6765;&#x66FF;&#x4EE3;&#x3002;</p>\n<blockquote>\n<p>&#x5173;&#x4E8E;<code>Controller</code>&#x540E;&#x7EED;&#x6587;&#x7AE0;&#x4F1A;&#x8BE6;&#x7EC6;&#x5206;&#x6790;&#x3002;</p>\n</blockquote>\n<h2 id=\"Fresco\"><a href=\"#Fresco\" class=\"headerlink\" title=\"Fresco\"></a>Fresco</h2><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6839;&#x636E;<a href=\"https://www.fresco-cn.org/docs/getting-started.html\" target=\"_blank\" rel=\"noopener\">Fresco&#x5B98;&#x65B9;&#x6587;&#x6863;</a>&#x7684;&#x6B63;&#x5E38;&#x6B65;&#x9AA4;&#x6765;&#x4F7F;&#x7528;&#x7684;&#x8BDD;&#x5C31;&#x65E0;&#x9700;&#x62C5;&#x5FC3;&#x8FD9;&#x4E00;&#x6B65;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x6211;&#x4EEC;&#x5728;&#x4F7F;&#x7528;<code>Fresco</code>&#x4E4B;&#x524D;&#x90FD;&#x8981;&#x5148;&#x8C03;&#x7528;<code>Fresco.initialize(context)</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void initialize(</span><br><span class=\"line\">      Context context,</span><br><span class=\"line\">      @Nullable ImagePipelineConfig imagePipelineConfig,</span><br><span class=\"line\">      @Nullable DraweeConfig draweeConfig) {</span><br><span class=\"line\">    if (sIsInitialized) {</span><br><span class=\"line\">      FLog.w(</span><br><span class=\"line\">          TAG,</span><br><span class=\"line\">          &quot;Fresco has already been initialized! `Fresco.initialize(...)` should only be called &quot; +</span><br><span class=\"line\">            &quot;1 single time to avoid memory leaks!&quot;);</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">      sIsInitialized = true;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    // we should always use the application context to avoid memory leaks</span><br><span class=\"line\">    context = context.getApplicationContext();</span><br><span class=\"line\">    if (imagePipelineConfig == null) {</span><br><span class=\"line\">      //&#x521D;&#x59CB;&#x5316;ImagePipeline&#x5DE5;&#x5382;&#xFF0C;&#x5305;&#x542B;ImagePipelineConfig &#x76F8;&#x5173;&#x521D;&#x59CB;&#x5316;&#x914D;&#x7F6E;&#x4FE1;&#x606F;</span><br><span class=\"line\">      // (&#x4E09;&#x7EA7;&#x7F13;&#x5B58;&#x3001;&#x56FE;&#x7247;&#x89E3;&#x7801;/&#x7F16;&#x7801;&#x3001;&#x8F6C;&#x5316;&#x3001;&#x6E10;&#x53D8;&#x3001;bitmap&#x914D;&#x7F6E;&#x3001;&#x56DB;&#x79CD;executor &#x5206;&#x522B;&#x4E3A; io&#x3001;decode&#x3001;background&#x3001;lightweight background)&#x7B49;</span><br><span class=\"line\">      ImagePipelineFactory.initialize(context);</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">       ImagePipelineFactory.initialize(imagePipelineConfig);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    //&#x521D;&#x59CB;&#x5316;Drawee&#x76F8;&#x5173;&#x914D;&#x7F6E;&#x4FE1;&#x606F;</span><br><span class=\"line\">    initializeDrawee(context, draweeConfig);</span><br><span class=\"line\">  }</span><br></pre></td></tr></table></figure>\n<p>&#x9664;&#x4E86;&#x521D;&#x59CB;&#x5316;<code>ImagePipeline</code>&#x4E4B;&#x5916;&#xFF0C;&#x6700;&#x540E;&#x8FD8;&#x4F1A;&#x8C03;&#x7528;<code>initializeDrawee (context, draweeConfig)</code>&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;<code>initializeDrawee</code>&#x505A;&#x4E86;&#x4EC0;&#x4E48;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private static void initializeDrawee(</span><br><span class=\"line\">      Context context,</span><br><span class=\"line\">      @Nullable DraweeConfig draweeConfig) {</span><br><span class=\"line\">    //&#x6784;&#x5EFA;PipelineDraweeControllerBuilderSupplier,</span><br><span class=\"line\">    //&#x5176;&#x4E2D;ImagePipeline&#x3001;PipelineDraweeControllerFactory&#x3001;ControllerListener set&#x96C6;&#x5408;</span><br><span class=\"line\">    sDraweeControllerBuilderSupplier =</span><br><span class=\"line\">        new PipelineDraweeControllerBuilderSupplier(context, draweeConfig);</span><br><span class=\"line\">    //&#x521D;&#x59CB;&#x5316;SimpleDrawee</span><br><span class=\"line\">    //&#x521D;&#x59CB;&#x5316;&#x65F6;&#x901A;&#x8FC7;&#x8C03;&#x7528;PipelineDraweeControllerBuilderSupplier&#x5B9E;&#x73B0;&#x7684;Supplier&#x7684;get()&#x65B9;&#x6CD5;</span><br><span class=\"line\">    // &#x8FD4;&#x56DE;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x7684;&#x5C01;&#x88C5;&#x4F53;PipelineDraweeControllerBuilder implements SimpleDraweeControllerBuilder</span><br><span class=\"line\">     SimpleDraweeView.initialize(sDraweeControllerBuilderSupplier);</span><br><span class=\"line\">  }</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4F1A;&#x770B;&#x5230;&#x4E4B;&#x524D;&#x6240;&#x63D0;&#x5230;&#x7684;<code>sDraweeControllerBuilderSupplier</code>&#x4E0E;<code>SimpleDraweeView</code>&#x4E2D;&#x5FC5;&#x987B;&#x4F18;&#x5148;&#x8C03;&#x7528;&#x7684;<code>initialize</code>&#x65B9;&#x6CD5;&#x3002;&#x76F8;&#x4FE1;&#x73B0;&#x5728;&#x5E94;&#x8BE5;&#x660E;&#x767D;&#x7684;&#x4E3A;&#x4EC0;&#x4E48;&#x5728;&#x4F7F;&#x7528;<code>Fresco</code>&#x4E4B;&#x524D;&#x5FC5;&#x987B;&#x8C03;&#x7528;&#x5B83;&#x7684;<code>initialize</code>&#x65B9;&#x6CD5;&#x4E86;&#x3002;&#x56E0;&#x4E3A;&#x5B83;&#x5FC5;&#x987B;&#x8981;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E9B;&#x5FC5;&#x8981;&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x5176;&#x4E2D;&#x5C31;&#x5305;&#x62EC;&#x4F7F;&#x7528;&#x7684;&#x63A7;&#x4EF6;<code>SimpleDraweeView</code>&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x3002;</p>\n<h2 id=\"GenericDraweeView\"><a href=\"#GenericDraweeView\" class=\"headerlink\" title=\"GenericDraweeView\"></a>GenericDraweeView</h2><p>&#x4E0A;&#x9762;&#x6240;&#x8BF4;&#x7684;<code>SimpleDraweeView</code>&#x7684;&#x7236;&#x7C7B;&#x662F;<code>GenericDraweeView</code>&#xFF0C;&#x5B83;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5904;&#x7406;<code>xml</code>&#x76F8;&#x5173;&#x7684;&#x5C5E;&#x6027;&#x3002;&#x5B83;&#x4F1A;&#x901A;&#x8FC7;<code>inflateHierarchy</code>&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected void inflateHierarchy(Context context, @Nullable AttributeSet attrs) {</span><br><span class=\"line\">    GenericDraweeHierarchyBuilder builder =</span><br><span class=\"line\">        GenericDraweeHierarchyInflater.inflateBuilder(context, attrs);</span><br><span class=\"line\">    setAspectRatio(builder.getDesiredAspectRatio());</span><br><span class=\"line\">    setHierarchy(builder.build());</span><br><span class=\"line\">  }</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x662F;&#x7531;<code>GenericDraweeHierarchyBuilder</code>&#x6765;&#x7EDF;&#x4E00;&#x5C01;&#x88C5;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#x3002;&#x6700;&#x7EC8;&#x901A;&#x8FC7;<code>build</code>&#x65B9;&#x6CD5;&#x6765;&#x6784;&#x5EFA;<code>GenericDraweeHierarchy</code>&#xFF0C;&#x8FD9;&#x5C31;&#x662F;<code>Fresco</code>&#x7684;&#x56FE;&#x5C42;&#x3002;&#x7136;&#x540E;&#x901A;&#x8FC7;<code>setHierarchy</code>&#x5C06;&#x56FE;&#x5C42;&#x4F20;&#x9012;&#x7ED9;<code>DraweeHolder</code>&#x3002;<code>DraweeHolder</code>&#x662F;&#x7528;&#x6765;&#x7BA1;&#x7406;<code>Hierarchy</code>&#x4E0E;<code>Controller</code>&#x7684;&#x3002;&#x800C;<code>DraweeHolder</code>&#x662F;&#x5728;&#x6700;&#x5E95;&#x5C42;&#x7684;<code>DraweeView</code>&#x4E2D;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;<code>GenericDraweeView</code>&#x7684;&#x7236;&#x7C7B;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x8FDB;&#x5165;<code>DraweeView</code>&#xFF0C;&#x6765;&#x770B;&#x770B;&#x5B83;&#x5230;&#x5E95;&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#x3002;</p>\n<h2 id=\"DraweeView\"><a href=\"#DraweeView\" class=\"headerlink\" title=\"DraweeView\"></a>DraweeView</h2><p><code>DraweeView</code>&#x662F;<code>Fresco</code>&#x6700;&#x5E95;&#x5C42;&#x7684;&#x63A7;&#x4EF6;&#xFF0C;&#x4E5F;&#x662F;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x5B83;&#x5C55;&#x793A;&#x56FE;&#x7247;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x5B83;&#x7EE7;&#x627F;&#x4E8E;<code>ImageView</code>&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x80FD;&#x505A;&#x7684;&#x4E8B;&#x4E5F;&#x65E0;&#x975E;&#x4E8E;&#x5728;&#x539F;&#x751F;<code>ImageView</code>&#x4E0A;&#x505A;&#x6269;&#x5C55;&#x6216;&#x8005;&#x65B9;&#x6CD5;&#x91CD;&#x5199;&#xFF0C;&#x4ECE;&#x800C;&#x6765;&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;&#x4E00;&#x5957;&#x903B;&#x8F91;&#x3002;&#x5148;&#x770B;&#x4E0B;&#x5B83;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public DraweeView(Context context) {</span><br><span class=\"line\">    super(context);</span><br><span class=\"line\">    init(context);</span><br><span class=\"line\">  }</span><br></pre></td></tr></table></figure>\n<p>&#x6CA1;&#x4EC0;&#x4E48;&#x7279;&#x522B;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x5C31;&#x4E00;&#x4E2A;<code>init</code>&#x65B9;&#x6CD5;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x8FDB;&#x5165;<code>init</code>&#x770B;&#x770B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/** This method is idempotent so it only has effect the first time it&apos;s called */</span><br><span class=\"line\">  private void init(Context context) {</span><br><span class=\"line\">    if (mInitialised) {</span><br><span class=\"line\">      return;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    mInitialised = true;</span><br><span class=\"line\">    mDraweeHolder = DraweeHolder.create(null, context);</span><br><span class=\"line\">    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {</span><br><span class=\"line\">      ColorStateList imageTintList = getImageTintList();</span><br><span class=\"line\">      if (imageTintList == null) {</span><br><span class=\"line\">        return;</span><br><span class=\"line\">      }</span><br><span class=\"line\">      setColorFilter(imageTintList.getDefaultColor());</span><br><span class=\"line\">    }</span><br><span class=\"line\">    // In Android N and above, visibility handling for Drawables has been changed, which breaks</span><br><span class=\"line\">    // activity transitions with DraweeViews.</span><br><span class=\"line\">    mLegacyVisibilityHandlingEnabled = sGlobalLegacyVisibilityHandlingEnabled &amp;&amp;</span><br><span class=\"line\">        context.getApplicationInfo().targetSdkVersion &gt;= 24; //Build.VERSION_CODES.N</span><br><span class=\"line\">  }</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5B83;&#x4F1A;&#x901A;&#x8FC7;<code>mInitialised</code>&#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x9700;&#x8981;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x6E90;&#x7801;&#x6CE8;&#x91CA;&#x4E5F;&#x8BF4;&#x660E;&#x7684;&#x8BE5;&#x65B9;&#x6CD5;&#x53EA;&#x4F1A;&#x8C03;&#x7528;&#x4E00;&#x6B21;&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x521B;&#x5EFA;<code>Hierarchy</code>&#x7684;&#x4EE3;&#x4EF7;&#x592A;&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x6B21;&#xFF0C;&#x4EE5;&#x540E;&#x90FD;&#x4F1A;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x4E2A;<code>mDraweeHolder</code>&#x4E2D;&#x7684;<code>Hierarchy</code>&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x5C31;&#x5FC5;&#x987B;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E2A;<code>mDraweeHolder</code>&#x3002;&#x5728;<code>DraweeView</code>&#x4E2D;&#x8FD8;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x4E3B;&#x8981;&#x65B9;&#x6CD5;&#xFF1A;</p>\n<ul>\n<li><code>void setHierarchy(DH hierarchy)</code>&#x8BBE;&#x7F6E;<code>Hierarchy</code>,&#x540C;&#x65F6;&#x4F1A;&#x5C06;<code>Hierarchy</code>&#x4EA4;&#x7531;<code>mDraweeHolder</code>&#x7BA1;&#x7406;&#xFF0C;&#x6700;&#x540E;&#x8FD8;&#x4F1A;&#x8C03;&#x7528;<code>super.setImageDrawable(mDraweeHolder.getTopLevelDrawable());</code>&#x6765;&#x5C06;<code>Hierarchy</code>&#x4E2D;&#x7684;&#x56FE;&#x5C42;&#x6811;&#x663E;&#x793A;&#x51FA;&#x6765;&#x3002;</li>\n<li><code>Drawable getTopLevelDrawable()</code>&#x4F1A;&#x901A;&#x8FC7;<code>mDraweeHolder</code>&#x4E2D;&#x7684;<code>Hierarchy</code>&#x6765;&#x83B7;&#x53D6;&#x56FE;&#x5C42;&#x6811;&#x3002;</li>\n<li><code>void setController(@Nullable DraweeController draweeController)</code>&#x8BBE;&#x7F6E;<code>Controller</code>&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x4F1A;&#x5C06;<code>Hierarchy</code>&#x4E2D;&#x7684;&#x56FE;&#x5C42;&#x6811;&#x663E;&#x793A;&#x51FA;&#x6765;&#x3002;</li>\n<li><code>void onAttachedToWindow()</code>&#x3001;<code>void onDetachedFromWindow()</code>&#x3001;<code>void onStartTemporaryDetach()</code>&#x4E0E;<code>void onFinishTemporaryDetach()</code>&#x662F;&#x6765;&#x63A7;&#x5236;&#x56FE;&#x5C42;&#x7684;&#x663E;&#x793A;&#x4E0E;&#x9690;&#x85CF;&#x3001;&#x7ED1;&#x5B9A;&#x4E0E;&#x89E3;&#x7ED1;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x4EEC;&#x90FD;&#x5206;&#x522B;&#x4F1A;&#x8C03;&#x7528;<code>mDraweeHolder</code>&#x7684;<code>onAttach()</code>&#x4E0E;<code>onDetach()</code>&#x3002;&#x5176;&#x5B9E;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x7684;&#x8FD8;&#x662F;<code>Controller</code>&#x4E2D;&#x7684;<code>onAttach()</code>&#x4E0E;<code>onDetach()</code>&#x3002;</li>\n<li><code>boolean onTouchEvent(MotionEvent event)</code>&#x63A7;&#x5236;&#x63A7;&#x4EF6;&#x7684;&#x89E6;&#x6478;&#xFF0C;&#x5982;&#x679C;<code>Controller</code>&#x6709;&#x6548;&#x7684;&#x8BDD;&#x4F1A;&#x8C03;&#x7528;<code>Controller</code>&#x4E2D;&#x7684;<code>onTouchEvent</code>&#x3002;</li>\n<li><code>void setAspectRatio(float aspectRatio)</code>&#x7528;&#x6765;&#x8BBE;&#x7F6E;<code>DraweeView</code>&#x663E;&#x793A;&#x7684;&#x5BBD;&#x9AD8;&#x6BD4;&#x4F8B;&#x3002;</li>\n<li><code>setImageDrawable</code>&#x3001;<code>setImageBitmap</code>&#x3001;<code>setImageResource</code>&#x4E0E;<code>setImageURI</code>&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x90FD;&#x662F;&#x539F;&#x751F;<code>ImageView</code>&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;&#x5728;<code>DraweeView</code>&#x4E2D;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x90FD;&#x88AB;&#x52A0;&#x4E0A;&#x4E86;<code>@Deprecated</code>&#x6807;&#x8BB0;&#x3002;&#x6807;&#x660E;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x5B9A;&#x4F7F;&#x7528;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;<code>DraweeView</code>&#x5C06;&#x4F1A;&#x9000;&#x5316;&#x6210;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x7684;<code>ImageView</code>&#x3002;&#x56E0;&#x4E3A;&#x5728;<code>DraweeView</code>&#x4E2D;&#x90FD;&#x662F;&#x901A;&#x8FC7;<code>Controller</code>&#x6765;&#x4F53;&#x73B0;&#x5B83;&#x7684;&#x7F13;&#x5B58;&#x3001;&#x52A0;&#x8F7D;&#x673A;&#x5236;&#x7B49;&#x7279;&#x6027;&#x3002;</li>\n</ul>\n<p>&#x4E0A;&#x9762;&#x8FD9;&#x4E9B;&#x5C31;&#x662F;<code>DraweeView</code>&#x7684;&#x4E3B;&#x8981;&#x6D89;&#x53CA;&#x5230;&#x7684;&#x65B9;&#x6CD5;&#x4E0E;&#x7279;&#x6027;&#xFF0C;&#x4E0D;&#x8FC7;&#x5728;<code>DraweeView</code>&#x4E2D;&#x57FA;&#x672C;&#x4E0A;&#x6BCF;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x90FD;&#x6D89;&#x53CA;&#x5230;&#x4E86;<code>DraweeHolder</code>&#xFF0C;&#x90A3;&#x5B83;&#x5230;&#x5E95;&#x662F;&#x5E72;&#x4EC0;&#x4E48;&#x7684;&#x5462;&#xFF1F;&#x522B;&#x6025;&#x4E0B;&#x9762;&#x5C31;&#x8F6E;&#x5230;&#x5B83;&#x4E86;&#x3002;</p>\n<h2 id=\"DraweeHolder\"><a href=\"#DraweeHolder\" class=\"headerlink\" title=\"DraweeHolder\"></a>DraweeHolder</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">A holder class for Drawee controller and hierarchy.</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x7684;&#x662F;&#x5B98;&#x65B9;&#x6CE8;&#x91CA;&#xFF0C;&#x8BF4;&#x660E;<code>DraweeHolder</code>&#x662F;&#x7528;&#x6765;&#x7BA1;&#x7406;<code>Hierarchy</code>&#x4E0E;<code>Controller</code>&#x7684;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x662F;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x8054;&#x7CFB;&#x7684;&#x6865;&#x6881;&#x3002;<code>DraweeView</code>&#x4EE5;&#x53CA;&#x5B83;&#x7684;&#x5B50;&#x7C7B;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x5B83;&#x6765;&#x95F4;&#x63A5;&#x64CD;&#x4F5C;<code>Controller</code>&#x4E0E;<code>Hierarchy</code>&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static &lt;DH extends DraweeHierarchy&gt; DraweeHolder&lt;DH&gt; create(</span><br><span class=\"line\">      @Nullable DH hierarchy,</span><br><span class=\"line\">      Context context) {</span><br><span class=\"line\">    DraweeHolder&lt;DH&gt; holder = new DraweeHolder&lt;DH&gt;(hierarchy);</span><br><span class=\"line\">    holder.registerWithContext(context);</span><br><span class=\"line\">    return holder;</span><br><span class=\"line\">  }</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x662F;&#x901A;&#x8FC7;&#x516C;&#x6709;&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x6765;&#x521B;&#x5EFA;&#x81EA;&#x8EAB;&#x5B9E;&#x4F8B;&#x7684;&#x3002;&#x5728;&#x4E0A;&#x9762;&#x7684;<code>DraweeView</code>&#x7684;<code>init</code>&#x65B9;&#x6CD5;&#x4E2D;&#x4F1A;&#x8C03;&#x7528;&#x3002;&#x5728;&#x5176;&#x5185;&#x90E8;&#x7684;<code>DraweeEventTracker</code>&#xFF0C;&#x662F;&#x7528;&#x6765;&#x8BB0;&#x5F55;&#x4E8B;&#x4EF6;&#x7684;&#x4F20;&#x9012;&#xFF0C;&#x65B9;&#x4FBF;<code>dubug</code>&#x7684;&#x8C03;&#x8BD5;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;<code>Fresco.initialize()</code>&#x4E4B;&#x524D;&#x8C03;&#x7528;<code>DraweeEventTracker.disable()</code>&#x3002;&#x90A3;&#x4E48;&#x5269;&#x4E0B;&#x7684;&#x65B9;&#x6CD5;&#x5176;&#x5B9E;&#x57FA;&#x672C;&#x4E0A;&#x5728;<code>DraweeView</code>&#x4E2D;&#x90FD;&#x8BF4;&#x8FC7;&#x3002;</p>\n<ul>\n<li><code>onAttach()</code>&#x4E0E;<code>onDetach()</code>&#xFF0C;&#x90FD;&#x4F1A;&#x8C03;&#x7528;<code>attachOrDetachController()</code>&#xFF0C;&#x6839;&#x636E;&#x60C5;&#x51B5;&#x5206;&#x522B;&#x8C03;&#x7528;<code>attachController()</code>&#x4E0E;<code>detachController()</code>,&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x7684;&#x5C31;&#x662F;<code>Controller</code>&#x7684;<code>onAttach()</code>&#x4E0E;<code>onDetach()</code></li>\n<li><code>Drawable getTopLevelDrawable()</code>&#x8C03;&#x7528;<code>mHierarchy.getTopLevelDrawable()</code>&#x83B7;&#x53D6;&#x56FE;&#x5C42;&#x6811;&#x3002;</li>\n<li><code>void setController(@Nullable DraweeController draweeController)</code>&#x8BBE;&#x7F6E;<code>Controller</code>&#xFF0C;&#x5728;&#x8BBE;&#x7F6E;&#x4E4B;&#x524D;&#x4F1A;&#x5148;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5DF2;&#x7ECF;<code>wasAttached</code>&#xFF0C;&#x5982;&#x679C;&#x662F;&#x7684;&#x8BDD;&#x5C31;&#x5148;&#x8C03;&#x7528;<code>detachController()</code>&#xFF0C;&#x7136;&#x540E;&#x6E05;&#x9664;&#x8001;&#x7684;<code>Controller</code>&#xFF0C;&#x518D;&#x5C06;<code>Hierarchy</code>&#x8BBE;&#x7F6E;&#x5230;&#x65B0;&#x7684;<code>Controller</code>&#x4E2D;&#x3002;&#x6700;&#x540E;&#x518D;<code>attachController()</code>&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#x663E;&#x793A;&#x56FE;&#x5C42;&#x3002;</li>\n<li><code>void setHierarchy(DH hierarchy)</code>&#x8BBE;&#x7F6E;<code>Hierarchy</code>&#xFF0C;&#x5982;&#x679C;<code>Controller</code>&#x6709;&#x6548;&#x7684;&#x8BDD;&#x5C31;&#x4E0E;<code>Hierarchy</code>&#x5EFA;&#x7ACB;&#x94FE;&#x63A5;&#xFF0C;&#x5C06;<code>Hierarchy</code>&#x8BBE;&#x7F6E;&#x5230;<code>Controller</code>&#x4E2D;&#x3002;</li>\n</ul>\n<p>&#x4EE5;&#x4E0A;&#x5C31;&#x662F;<code>DraweeHolder</code>&#x7684;&#x4E3B;&#x8981;&#x65B9;&#x6CD5;&#xFF0C;&#x90FD;&#x8DDF;<code>Controller</code>&#x4E0E;<code>Hierarchy</code>&#x76F8;&#x5173;&#x3002;&#x800C;<code>DraweeHolder</code>&#x53C8;&#x4E0E;<code>DraweeView</code>&#x76F8;&#x8FDE;&#xFF0C;&#x6240;&#x4EE5;&#x6700;&#x7EC8;&#x8FD8;&#x662F;&#x8981;&#x56DE;&#x5230;<code>Controller</code>&#x4E0E;<code>Hierarchy</code>&#x4E2D;&#x3002;</p>\n<h2 id=\"End\"><a href=\"#End\" class=\"headerlink\" title=\"End\"></a>End</h2><p>&#x8FD9;&#x6B21;&#x4E3B;&#x8981;&#x662F;&#x5206;&#x6790;&#x4E86;<code>Fresco</code>&#x4E2D;&#x7684;&#x57FA;&#x672C;&#x7EC4;&#x4EF6;<code>DraweeView</code>&#x4E0E;&#x5B83;&#x7684;&#x5B50;&#x7C7B;&#x3002;&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x60F3;&#x8FDB;&#x4E00;&#x6B65;&#x4E86;&#x89E3;<code>Hierarchy</code>&#x4E0E;<code>Controller</code>&#x7684;&#x539F;&#x7406;&#xFF0C;&#x4E0B;&#x7BC7;&#x6587;&#x7AE0;&#x5C06;&#x4F1A;&#x8BE6;&#x7EC6;&#x5206;&#x6790;&#x76F8;&#x5173;&#x7684;&#x539F;&#x7406;&#xFF0C;&#x656C;&#x8BF7;&#x671F;&#x5F85;&#xFF01;</p>\n<p><a href=\"https://github.com/idisfkj/Fresco-Source-Analysis\" target=\"_blank\" rel=\"noopener\">Fresco&#x6E90;&#x7801;&#x5206;&#x6790;&#x7CFB;&#x5217;Github&#x5730;&#x5740;</a></p>\n","categories":["android"],"tags":["源码分析"]},{"title":"tensorflow-梯度下降,有这一篇就足够了","url":"https://www.rousetime.com/2017/11/06/tensorflow-梯度下降-有这一篇就足够了/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p>&#x6700;&#x8FD1;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x8D8A;&#x6765;&#x8D8A;&#x706B;&#x4E86;&#xFF0C;&#x524D;&#x6BB5;&#x65F6;&#x95F4;&#x65AF;&#x4E39;&#x798F;&#x5927;&#x5B66;&#x526F;&#x6559;&#x6388;&#x5434;&#x6069;&#x8FBE;&#x90FD;&#x4EB2;&#x81EA;&#x5F55;&#x5236;&#x4E86;&#x5173;&#x4E8E;<code>Deep Learning Specialization</code>&#x7684;&#x6559;&#x7A0B;&#xFF0C;&#x5728;&#x56FD;&#x5185;&#x6380;&#x8D77;&#x4E86;&#x5DE8;&#x5927;&#x7684;&#x5B66;&#x4E60;&#x70ED;&#x6F6E;&#x3002;&#x672C;&#x7740;&#x4E0D;&#x88AB;&#x65F6;&#x4EE3;&#x629B;&#x5F03;&#x7684;&#x5FF5;&#x5934;&#xFF0C;&#x81EA;&#x5DF1;&#x4E5F;&#x5F00;&#x59CB;&#x7814;&#x7A76;&#x6709;&#x5173;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x7684;&#x77E5;&#x8BC6;&#x3002;&#x90FD;&#x8BF4;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x7684;&#x5B66;&#x4E60;&#x96BE;&#x5EA6;&#x975E;&#x5E38;&#x5927;&#xFF0C;&#x4F46;&#x4E0D;&#x4EB2;&#x81EA;&#x5C1D;&#x8BD5;&#x4E00;&#x4E0B;&#x53C8;&#x600E;&#x4E48;&#x4F1A;&#x77E5;&#x9053;&#x5176;&#x4E2D;&#x7684;&#x5965;&#x5999;&#x4E0E;&#x4E50;&#x8DA3;&#x5462;&#xFF1F;&#x53EA;&#x6709;&#x4E0D;&#x65AD;&#x7684;&#x5C1D;&#x8BD5;&#x624D;&#x80FD;&#x627E;&#x5230;&#x6700;&#x9002;&#x5408;&#x81EA;&#x5DF1;&#x7684;&#x9053;&#x8DEF;&#x3002;</p>\n<p>&#x8BF7;&#x5BB9;&#x5FCD;&#x6211;&#x4E0A;&#x8FF0;&#x7684;&#x81EA;&#x6211;&#x717D;&#x60C5;&#xFF0C;&#x4E0B;&#x9762;&#x8FDB;&#x5165;&#x4E3B;&#x9898;&#x3002;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x5BF9;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x4E2D;&#x6240;&#x9047;&#x5230;&#x7684;<code>GradientDescent</code>(&#x68AF;&#x5EA6;&#x4E0B;&#x964D;)&#x8FDB;&#x884C;&#x5168;&#x9762;&#x5206;&#x6790;&#xFF0C;&#x76F8;&#x4FE1;&#x4F60;&#x770B;&#x4E86;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E4B;&#x540E;&#xFF0C;&#x5BF9;<code>GradientDescent</code>&#x5C06;&#x5F7B;&#x5E95;&#x5F04;&#x660E;&#x767D;&#x5176;&#x4E2D;&#x7684;&#x539F;&#x7406;&#x3002;</p>\n<h1 id=\"&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x7684;&#x6982;&#x5FF5;\"><a href=\"#&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x7684;&#x6982;&#x5FF5;\" class=\"headerlink\" title=\"&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x7684;&#x6982;&#x5FF5;\"></a>&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x7684;&#x6982;&#x5FF5;</h1><p><code>&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6CD5;</code>&#x662F;&#x4E00;&#x4E2A;&#x4E00;&#x9636;&#x6700;&#x4F18;&#x5316;&#x7B97;&#x6CD5;&#xFF0C;&#x901A;&#x5E38;&#x4E5F;&#x79F0;&#x4E3A;&#x6700;&#x901F;&#x4E0B;&#x964D;&#x6CD5;&#x3002;&#x8981;&#x4F7F;&#x7528;&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6CD5;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x5C40;&#x90E8;&#x6781;&#x5C0F;&#x503C;&#xFF0C;&#x5FC5;&#x987B;&#x5411;&#x51FD;&#x6570;&#x4E0A;&#x5F53;&#x524D;&#x70B9;&#x5BF9;&#x4E8E;&#x68AF;&#x5EA6;&#xFF08;&#x6216;&#x8005;&#x662F;&#x8FD1;&#x4F3C;&#x68AF;&#x5EA6;&#xFF09;&#x7684;&#x53CD;&#x65B9;&#x5411;&#x7684;&#x89C4;&#x5B9A;&#x6B65;&#x957F;&#x8DDD;&#x79BB;&#x70B9;&#x8FDB;&#x884C;&#x8FED;&#x4EE3;&#x641C;&#x7D22;&#x3002;&#x6240;&#x4EE5;&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6CD5;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x6C42;&#x89E3;&#x67D0;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x6781;&#x5C0F;&#x503C;&#x6216;&#x8005;&#x6700;&#x5C0F;&#x503C;&#x3002;&#x5BF9;&#x4E8E;n&#x7EF4;&#x95EE;&#x9898;&#x5C31;&#x6700;&#x4F18;&#x89E3;&#xFF0C;&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6CD5;&#x662F;&#x6700;&#x5E38;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x4E4B;&#x4E00;&#x3002;&#x4E0B;&#x9762;&#x901A;&#x8FC7;&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6CD5;&#x7684;<code>&#x524D;&#x751F;&#x4ECA;&#x4E16;</code>&#x6765;&#x8FDB;&#x884C;&#x8BE6;&#x7EC6;&#x63A8;&#x5BFC;&#x8BF4;&#x660E;&#x3002;</p>\n<h1 id=\"&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6CD5;&#x7684;&#x524D;&#x4E16;\"><a href=\"#&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6CD5;&#x7684;&#x524D;&#x4E16;\" class=\"headerlink\" title=\"&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6CD5;&#x7684;&#x524D;&#x4E16;\"></a>&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6CD5;&#x7684;&#x524D;&#x4E16;</h1><p>&#x9996;&#x5148;&#x4ECE;&#x7B80;&#x5355;&#x7684;&#x5F00;&#x59CB;&#xFF0C;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x4E00;&#x7EF4;&#x51FD;&#x6570;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f(x) = x^3 + 2 * x - 3</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2017/11/06/tensorflow-&#x68AF;&#x5EA6;&#x4E0B;&#x964D;-&#x6709;&#x8FD9;&#x4E00;&#x7BC7;&#x5C31;&#x8DB3;&#x591F;&#x4E86;/tensorflow_gradient_descent_1.png\" width=\"400\" height=\"200\" alt=\"&#x4E00;&#x7EF4;&#x51FD;&#x6570;&#x56FE;\" align=\"center\"></p>\n<p>&#x5728;&#x6570;&#x5B66;&#x4E2D;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8981;&#x6C42;<code>f(x) = 0</code>&#x5904;&#x7684;&#x89E3;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x8BEF;&#x5DEE;&#x7B49;&#x5F0F;&#x6765;&#x6C42;&#x5F97;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">error = (f(x) - 0)^2</span><br></pre></td></tr></table></figure>\n<p>&#x5F53;<code>error</code>&#x8D8B;&#x8FD1;&#x4E8E;&#x6700;&#x5C0F;&#x503C;&#x65F6;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;<code>f(x) = 0</code>&#x5904;<code>x</code>&#x7684;&#x89E3;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x56FE;&#x6765;&#x89C2;&#x5BDF;&#xFF1A;</p>\n<p><img src=\"/2017/11/06/tensorflow-&#x68AF;&#x5EA6;&#x4E0B;&#x964D;-&#x6709;&#x8FD9;&#x4E00;&#x7BC7;&#x5C31;&#x8DB3;&#x591F;&#x4E86;/tensorflow_gradient_descent_2.png\" width=\"400\" height=\"200\" alt=\"&#x4E00;&#x7EF4;&#x51FD;&#x6570;&#x56FE;\" align=\"center\"></p>\n<p>&#x901A;&#x8FC7;&#x8FD9;&#x51FD;&#x6570;&#x56FE;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x76F4;&#x89C2;&#x7684;&#x53D1;&#x73B0;&#xFF0C;&#x8981;&#x60F3;&#x6C42;&#x5F97;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x6700;&#x5C0F;&#x503C;&#xFF0C;&#x53EA;&#x8981;&#x5C06;<code>x</code>&#x6307;&#x5B9A;&#x4E3A;&#x51FD;&#x6570;&#x56FE;&#x7684;&#x6700;&#x4F4E;&#x8C37;&#x3002;&#x8FD9;&#x5728;&#x9AD8;&#x4E2D;&#x6211;&#x4EEC;&#x5C31;&#x5DF2;&#x7ECF;&#x638C;&#x63E1;&#x4E86;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x6700;&#x5C0F;&#x503C;&#x89E3;&#x6CD5;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5BF9;&#x8BE5;&#x51FD;&#x6570;&#x8FDB;&#x884C;&#x6C42;&#x5BFC;&#xFF08;&#x5373;&#x659C;&#x7387;&#xFF09;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">derivative(x) = 6 * x^5 + 16 * x^3 - 18 * x^2 + 8 * x - 12</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x8981;&#x5F97;&#x5230;&#x6700;&#x5C0F;&#x503C;&#xFF0C;&#x53EA;&#x9700;&#x4EE4;<code>derivative(x) = 0</code>&#xFF0C;&#x5373;<code>x = 1</code>&#x3002;&#x540C;&#x65F6;&#x6211;&#x4EEC;&#x7ED3;&#x5408;&#x56FE;&#x4E0E;&#x5BFC;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#xFF1A;</p>\n<ul>\n<li>&#x5F53;<code>x &lt; 1</code>&#x65F6;&#xFF0C;<code>derivative &lt; 0</code>&#xFF0C;&#x659C;&#x7387;&#x4E3A;&#x8D1F;&#x7684;&#xFF1B;</li>\n<li>&#x5F53;<code>x &gt; 1</code>&#x65F6;&#xFF0C;<code>derivative &gt; 0</code>&#xFF0C;&#x659C;&#x7387;&#x4E3A;&#x6B63;&#x7684;&#xFF1B;</li>\n<li>&#x5F53;<code>x &#x65E0;&#x9650;&#x63A5;&#x8FD1; 1</code>&#x65F6;&#xFF0C;<code>derivative&#x4E5F;&#x5C31;&#x65E0;&#x9650;=0</code>&#xFF0C;&#x659C;&#x7387;&#x4E3A;&#x96F6;&#x3002;</li>\n</ul>\n<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x7ED3;&#x8BBA;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x8868;&#x8FBE;&#x5F0F;&#x6765;&#x4EE3;&#x66FF;<code>x</code>&#x5728;&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x79FB;&#x52A8;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = x - reate * derivative</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x5F53;&#x659C;&#x7387;&#x4E3A;&#x8D1F;&#x7684;&#x65F6;&#x5019;&#xFF0C;<code>x</code>&#x589E;&#x5927;&#xFF0C;&#x5F53;&#x659C;&#x7387;&#x4E3A;&#x6B63;&#x7684;&#x65F6;&#x5019;&#xFF0C;<code>x</code>&#x51CF;&#x5C0F;&#xFF1B;&#x56E0;&#x6B64;<code>x</code>&#x603B;&#x662F;&#x4F1A;&#x5411;&#x7740;&#x4F4E;&#x8C37;&#x79FB;&#x52A8;&#xFF0C;&#x4F7F;&#x5F97;<code>error</code>&#x6700;&#x5C0F;&#xFF0C;&#x4ECE;&#x800C;&#x6C42;&#x5F97;<code>f(x) = 0</code>&#x5904;&#x7684;&#x89E3;&#x3002;&#x5176;&#x4E2D;&#x7684;<code>rate</code>&#x4EE3;&#x8868;<code>x</code>&#x9006;&#x7740;&#x5BFC;&#x6570;&#x65B9;&#x5411;&#x79FB;&#x52A8;&#x7684;&#x8DDD;&#x79BB;&#xFF0C;<code>rate</code>&#x8D8A;&#x5927;&#xFF0C;<code>x</code>&#x6BCF;&#x6B21;&#x5C31;&#x79FB;&#x52A8;&#x7684;&#x8D8A;&#x591A;&#x3002;&#x53CD;&#x4E4B;&#x79FB;&#x52A8;&#x7684;&#x8D8A;&#x5C11;&#x3002;</em></p>\n</blockquote>\n<p>&#x8FD9;&#x662F;&#x9488;&#x5BF9;&#x7B80;&#x5355;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x76F4;&#x89C2;&#x7684;&#x6C42;&#x5F97;&#x5B83;&#x7684;&#x5BFC;&#x51FD;&#x6570;&#x3002;&#x4E3A;&#x4E86;&#x5E94;&#x5BF9;&#x590D;&#x6742;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x6C42;&#x5BFC;&#x51FD;&#x6570;&#x7684;&#x5B9A;&#x4E49;&#x6765;&#x8868;&#x8FBE;&#x5BFC;&#x51FD;&#x6570;:&#x82E5;&#x51FD;&#x6570;<code>f(x)</code>&#x5728;&#x70B9;<code>x0</code>&#x5904;&#x53EF;&#x5BFC;&#xFF0C;&#x90A3;&#x4E48;&#x6709;&#x5982;&#x4E0B;&#x5B9A;&#x4E49;&#xFF1A;</p>\n<p><img src=\"/2017/11/06/tensorflow-&#x68AF;&#x5EA6;&#x4E0B;&#x964D;-&#x6709;&#x8FD9;&#x4E00;&#x7BC7;&#x5C31;&#x8DB3;&#x591F;&#x4E86;/tensorflow_gradient_descent_2.svg\" alt></p>\n<p>&#x4E0A;&#x9762;&#x662F;&#x90FD;&#x662F;&#x516C;&#x5F0F;&#x63A8;&#x5BFC;&#xFF0C;&#x4E0B;&#x9762;&#x901A;&#x8FC7;&#x4EE3;&#x7801;&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x662F;&#x4F7F;&#x7528;<code>python</code>&#x8FDB;&#x884C;&#x5B9E;&#x73B0;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; def f(x):</span><br><span class=\"line\">...     return x**3 + 2 * x - 3</span><br><span class=\"line\">...</span><br><span class=\"line\">&gt;&gt;&gt; def error(x):</span><br><span class=\"line\">...     return (f(x) - 0)**2</span><br><span class=\"line\">...</span><br><span class=\"line\">&gt;&gt;&gt; def gradient_descent(x):</span><br><span class=\"line\">...     delta = 0.00000001</span><br><span class=\"line\">...     derivative = (error(x + delta) - error(x)) / delta</span><br><span class=\"line\">...     rate = 0.01</span><br><span class=\"line\">...     return x - rate * derivative</span><br><span class=\"line\">...</span><br><span class=\"line\">&gt;&gt;&gt; x = 0.8</span><br><span class=\"line\">&gt;&gt;&gt; for i in range(50):</span><br><span class=\"line\">...     x = gradient_descent(x)</span><br><span class=\"line\">...     print(&apos;x = {:6f}, f(x) = {:6f}&apos;.format(x, f(x)))</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>&#x6267;&#x884C;&#x4E0A;&#x9762;&#x7A0B;&#x5E8F;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x80FD;&#x5F97;&#x5230;&#x5982;&#x4E0B;&#x7ED3;&#x679C;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = 0.869619, f(x) = -0.603123</span><br><span class=\"line\">x = 0.921110, f(x) = -0.376268</span><br><span class=\"line\">x = 0.955316, f(x) = -0.217521</span><br><span class=\"line\">x = 0.975927, f(x) = -0.118638</span><br><span class=\"line\">x = 0.987453, f(x) = -0.062266</span><br><span class=\"line\">x = 0.993586, f(x) = -0.031946</span><br><span class=\"line\">x = 0.996756, f(x) = -0.016187</span><br><span class=\"line\">x = 0.998369, f(x) = -0.008149</span><br><span class=\"line\">x = 0.999182, f(x) = -0.004088</span><br><span class=\"line\">x = 0.999590, f(x) = -0.002048</span><br><span class=\"line\">x = 0.999795, f(x) = -0.001025</span><br><span class=\"line\">x = 0.999897, f(x) = -0.000513</span><br><span class=\"line\">x = 0.999949, f(x) = -0.000256</span><br><span class=\"line\">x = 0.999974, f(x) = -0.000128</span><br><span class=\"line\">x = 0.999987, f(x) = -0.000064</span><br><span class=\"line\">x = 0.999994, f(x) = -0.000032</span><br><span class=\"line\">x = 0.999997, f(x) = -0.000016</span><br><span class=\"line\">x = 0.999998, f(x) = -0.000008</span><br><span class=\"line\">x = 0.999999, f(x) = -0.000004</span><br><span class=\"line\">x = 1.000000, f(x) = -0.000002</span><br><span class=\"line\">x = 1.000000, f(x) = -0.000001</span><br><span class=\"line\">x = 1.000000, f(x) = -0.000001</span><br><span class=\"line\">x = 1.000000, f(x) = -0.000000</span><br><span class=\"line\">x = 1.000000, f(x) = -0.000000</span><br><span class=\"line\">x = 1.000000, f(x) = -0.000000</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x4E5F;&#x9A8C;&#x8BC1;&#x4E86;&#x6211;&#x4EEC;&#x6700;&#x521D;&#x7684;&#x7ED3;&#x8BBA;&#x3002;<code>x = 1</code>&#x65F6;&#xFF0C;<code>f(x) = 0</code>&#x3002;<br>&#x6240;&#x4EE5;&#x901A;&#x8FC7;&#x8BE5;&#x65B9;&#x6CD5;&#xFF0C;&#x53EA;&#x8981;&#x6B65;&#x6570;&#x8DB3;&#x591F;&#x591A;&#xFF0C;&#x5C31;&#x80FD;&#x5F97;&#x5230;&#x975E;&#x5E38;&#x7CBE;&#x786E;&#x7684;&#x503C;&#x3002;</p>\n<h1 id=\"&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6CD5;&#x7684;&#x4ECA;&#x751F;\"><a href=\"#&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6CD5;&#x7684;&#x4ECA;&#x751F;\" class=\"headerlink\" title=\"&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6CD5;&#x7684;&#x4ECA;&#x751F;\"></a>&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6CD5;&#x7684;&#x4ECA;&#x751F;</h1><p>&#x4E0A;&#x9762;&#x662F;&#x5BF9;<code>&#x4E00;&#x7EF4;</code>&#x51FD;&#x6570;&#x8FDB;&#x884C;&#x6C42;&#x89E3;&#xFF0C;&#x90A3;&#x4E48;&#x5BF9;&#x4E8E;<code>&#x591A;&#x7EF4;</code>&#x51FD;&#x6570;&#x53C8;&#x8981;&#x5982;&#x4F55;&#x6C42;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x5BF9;&#x4E8E;<code>&#x591A;&#x7EF4;</code>&#x51FD;&#x6570;&#x4E5F;&#x662F;&#x90A3;&#x4E48;&#x7684;&#x7B80;&#x5355;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f(x) = x[0] + 2 * x[1] + 4</span><br></pre></td></tr></table></figure>\n<p>&#x540C;&#x6837;&#x7684;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8981;&#x6C42;<code>f(x) = 0</code>&#x5904;&#xFF0C;<code>x[0]</code>&#x4E0E;<code>x[1]</code>&#x7684;&#x503C;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6C42;<code>error</code>&#x51FD;&#x6570;&#x7684;&#x6700;&#x5C0F;&#x503C;&#x6765;&#x95F4;&#x63A5;&#x6C42;<code>f(x)</code>&#x7684;&#x89E3;&#x3002;&#x8DDF;<code>&#x4E00;&#x7EF4;</code>&#x51FD;&#x6570;&#x552F;&#x4E00;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x8981;&#x5206;&#x522B;&#x5BF9;<code>x[0]</code>&#x4E0E;<code>x[1]</code>&#x8FDB;&#x884C;&#x6C42;&#x5BFC;&#x3002;&#x5728;&#x6570;&#x5B66;&#x4E0A;&#x53EB;&#x505A;<code>&#x504F;&#x5BFC;&#x6570;</code>&#xFF1A;</p>\n<ul>\n<li>&#x4FDD;&#x6301;x[1]&#x4E0D;&#x53D8;&#xFF0C;&#x5BF9;<code>x[0]</code>&#x8FDB;&#x884C;&#x6C42;&#x5BFC;&#xFF0C;&#x5373;<code>f(x)</code>&#x5BF9;<code>x[0]</code>&#x7684;&#x504F;&#x5BFC;&#x6570; </li>\n<li>&#x4FDD;&#x6301;x[0]&#x4E0D;&#x53D8;&#xFF0C;&#x5BF9;<code>x[1]</code>&#x8FDB;&#x884C;&#x6C42;&#x5BFC;&#xFF0C;&#x5373;<code>f(x)</code>&#x5BF9;<code>x[1]</code>&#x7684;&#x504F;&#x5BFC;&#x6570;</li>\n</ul>\n<p>&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x7406;&#x89E3;&#x57FA;&#x7840;&#xFF0C;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x7684;<code>gradient_descent</code>&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; def gradient_descent(x):</span><br><span class=\"line\">...     delta = 0.00000001</span><br><span class=\"line\">...     derivative_x0 = (error([x[0] + delta, x[1]]) - error([x[0], x[1]])) / delta</span><br><span class=\"line\">...     derivative_x1 = (error([x[0], x[1] + delta]) - error([x[0], x[1]])) / delta</span><br><span class=\"line\">...     rate = 0.01</span><br><span class=\"line\">...     x[0] = x[0] - rate * derivative_x0</span><br><span class=\"line\">...     x[1] = x[1] - rate * derivative_x1</span><br><span class=\"line\">...     return [x[0], x[1]]</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p><code>rate</code>&#x7684;&#x4F5C;&#x7528;&#x4E0D;&#x53D8;&#xFF0C;&#x552F;&#x4E00;&#x7684;&#x533A;&#x522B;&#x5C31;&#x662F;&#x5206;&#x522B;&#x83B7;&#x53D6;&#x6700;&#x65B0;&#x7684;<code>x[0]</code>&#x4E0E;<code>x[1]</code>&#x3002;&#x4E0B;&#x9762;&#x662F;&#x6574;&#x4E2A;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; def f(x):</span><br><span class=\"line\">...     return x[0] + 2 * x[1] + 4</span><br><span class=\"line\">...</span><br><span class=\"line\">&gt;&gt;&gt; def error(x):</span><br><span class=\"line\">...     return (f(x) - 0)**2</span><br><span class=\"line\">...</span><br><span class=\"line\">&gt;&gt;&gt; def gradient_descent(x):</span><br><span class=\"line\">...     delta = 0.00000001</span><br><span class=\"line\">...     derivative_x0 = (error([x[0] + delta, x[1]]) - error([x[0], x[1]])) / delta</span><br><span class=\"line\">...     derivative_x1 = (error([x[0], x[1] + delta]) - error([x[0], x[1]])) / delta</span><br><span class=\"line\">...     rate = 0.02</span><br><span class=\"line\">...     x[0] = x[0] - rate * derivative_x0</span><br><span class=\"line\">...     x[1] = x[1] - rate * derivative_x1</span><br><span class=\"line\">...     return [x[0], x[1]]</span><br><span class=\"line\">...</span><br><span class=\"line\">&gt;&gt;&gt; x = [-0.5, -1.0]</span><br><span class=\"line\">&gt;&gt;&gt; for i in range(100):</span><br><span class=\"line\">...     x = gradient_descent(x)</span><br><span class=\"line\">...     print(&apos;x = {:6f},{:6f}, f(x) = {:6f}&apos;.format(x[0],x[1],f(x)))</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x4E3A;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = -0.560000,-1.120000, f(x) = 1.200000</span><br><span class=\"line\">x = -0.608000,-1.216000, f(x) = 0.960000</span><br><span class=\"line\">x = -0.646400,-1.292800, f(x) = 0.768000</span><br><span class=\"line\">x = -0.677120,-1.354240, f(x) = 0.614400</span><br><span class=\"line\">x = -0.701696,-1.403392, f(x) = 0.491520</span><br><span class=\"line\">x = -0.721357,-1.442714, f(x) = 0.393216</span><br><span class=\"line\">x = -0.737085,-1.474171, f(x) = 0.314573</span><br><span class=\"line\">x = -0.749668,-1.499337, f(x) = 0.251658</span><br><span class=\"line\">x = -0.759735,-1.519469, f(x) = 0.201327</span><br><span class=\"line\">x = -0.767788,-1.535575, f(x) = 0.161061</span><br><span class=\"line\">x = -0.774230,-1.548460, f(x) = 0.128849</span><br><span class=\"line\">x = -0.779384,-1.558768, f(x) = 0.103079</span><br><span class=\"line\">x = -0.783507,-1.567015, f(x) = 0.082463</span><br><span class=\"line\">x = -0.786806,-1.573612, f(x) = 0.065971</span><br><span class=\"line\">x = -0.789445,-1.578889, f(x) = 0.052777</span><br><span class=\"line\">x = -0.791556,-1.583112, f(x) = 0.042221</span><br><span class=\"line\">x = -0.793245,-1.586489, f(x) = 0.033777</span><br><span class=\"line\">x = -0.794596,-1.589191, f(x) = 0.027022</span><br><span class=\"line\">x = -0.795677,-1.591353, f(x) = 0.021617</span><br><span class=\"line\">x = -0.796541,-1.593082, f(x) = 0.017294</span><br><span class=\"line\">x = -0.797233,-1.594466, f(x) = 0.013835</span><br><span class=\"line\">x = -0.797786,-1.595573, f(x) = 0.011068</span><br><span class=\"line\">x = -0.798229,-1.596458, f(x) = 0.008854</span><br><span class=\"line\">x = -0.798583,-1.597167, f(x) = 0.007084</span><br><span class=\"line\">x = -0.798867,-1.597733, f(x) = 0.005667</span><br><span class=\"line\">x = -0.799093,-1.598187, f(x) = 0.004533</span><br><span class=\"line\">x = -0.799275,-1.598549, f(x) = 0.003627</span><br><span class=\"line\">x = -0.799420,-1.598839, f(x) = 0.002901</span><br><span class=\"line\">x = -0.799536,-1.599072, f(x) = 0.002321</span><br><span class=\"line\">x = -0.799629,-1.599257, f(x) = 0.001857</span><br><span class=\"line\">x = -0.799703,-1.599406, f(x) = 0.001486</span><br><span class=\"line\">x = -0.799762,-1.599525, f(x) = 0.001188</span><br><span class=\"line\">x = -0.799810,-1.599620, f(x) = 0.000951</span><br><span class=\"line\">x = -0.799848,-1.599696, f(x) = 0.000761</span><br><span class=\"line\">x = -0.799878,-1.599757, f(x) = 0.000608</span><br><span class=\"line\">x = -0.799903,-1.599805, f(x) = 0.000487</span><br><span class=\"line\">x = -0.799922,-1.599844, f(x) = 0.000389</span><br><span class=\"line\">x = -0.799938,-1.599875, f(x) = 0.000312</span><br><span class=\"line\">x = -0.799950,-1.599900, f(x) = 0.000249</span><br><span class=\"line\">x = -0.799960,-1.599920, f(x) = 0.000199</span><br><span class=\"line\">x = -0.799968,-1.599936, f(x) = 0.000159</span><br><span class=\"line\">x = -0.799974,-1.599949, f(x) = 0.000128</span><br><span class=\"line\">x = -0.799980,-1.599959, f(x) = 0.000102</span><br><span class=\"line\">x = -0.799984,-1.599967, f(x) = 0.000082</span><br><span class=\"line\">x = -0.799987,-1.599974, f(x) = 0.000065</span><br><span class=\"line\">x = -0.799990,-1.599979, f(x) = 0.000052</span><br><span class=\"line\">x = -0.799992,-1.599983, f(x) = 0.000042</span><br><span class=\"line\">x = -0.799993,-1.599987, f(x) = 0.000033</span><br><span class=\"line\">x = -0.799995,-1.599989, f(x) = 0.000027</span><br><span class=\"line\">x = -0.799996,-1.599991, f(x) = 0.000021</span><br><span class=\"line\">x = -0.799997,-1.599993, f(x) = 0.000017</span><br><span class=\"line\">x = -0.799997,-1.599995, f(x) = 0.000014</span><br><span class=\"line\">x = -0.799998,-1.599996, f(x) = 0.000011</span><br><span class=\"line\">x = -0.799998,-1.599997, f(x) = 0.000009</span><br><span class=\"line\">x = -0.799999,-1.599997, f(x) = 0.000007</span><br><span class=\"line\">x = -0.799999,-1.599998, f(x) = 0.000006</span><br><span class=\"line\">x = -0.799999,-1.599998, f(x) = 0.000004</span><br><span class=\"line\">x = -0.799999,-1.599999, f(x) = 0.000004</span><br><span class=\"line\">x = -0.799999,-1.599999, f(x) = 0.000003</span><br><span class=\"line\">x = -0.800000,-1.599999, f(x) = 0.000002</span><br><span class=\"line\">x = -0.800000,-1.599999, f(x) = 0.000002</span><br><span class=\"line\">x = -0.800000,-1.599999, f(x) = 0.000001</span><br><span class=\"line\">x = -0.800000,-1.600000, f(x) = 0.000001</span><br><span class=\"line\">x = -0.800000,-1.600000, f(x) = 0.000001</span><br><span class=\"line\">x = -0.800000,-1.600000, f(x) = 0.000001</span><br><span class=\"line\">x = -0.800000,-1.600000, f(x) = 0.000001</span><br><span class=\"line\">x = -0.800000,-1.600000, f(x) = 0.000000</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x7EC6;&#x5FC3;&#x7684;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;<code>f(x) = 0</code>&#x4E0D;&#x6B62;&#x8FD9;&#x4E00;&#x4E2A;&#x89E3;&#x8FD8;&#x53EF;&#x4EE5;&#x662F;<code>x = -2, -1</code>&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6CD5;&#x53EA;&#x662F;&#x5BF9;<code>&#x5F53;&#x524D;&#x6240;&#x5904;&#x7684;&#x51F9;&#x8C37;</code>&#x8FDB;&#x884C;&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6C42;&#x89E3;&#xFF0C;&#x5BF9;&#x4E8E;<code>error</code>&#x51FD;&#x6570;&#x5E76;&#x4E0D;&#x4EE3;&#x8868;&#x53EA;&#x6709;&#x4E00;&#x4E2A;<code>f(x) = 0</code>&#x7684;&#x51F9;&#x8C37;&#x3002;&#x6240;&#x4EE5;&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6CD5;&#x53EA;&#x80FD;&#x6C42;&#x5F97;&#x5C40;&#x90E8;&#x89E3;&#xFF0C;&#x4F46;&#x4E0D;&#x4E00;&#x5B9A;&#x80FD;&#x6C42;&#x5F97;&#x5168;&#x90E8;&#x7684;&#x89E3;&#x3002;&#x5F53;&#x7136;&#x5982;&#x679C;&#x5BF9;&#x4E8E;&#x975E;&#x5E38;&#x590D;&#x6742;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x80FD;&#x591F;&#x6C42;&#x5F97;&#x5C40;&#x90E8;&#x89E3;&#x4E5F;&#x662F;&#x975E;&#x5E38;&#x4E0D;&#x9519;&#x7684;&#x3002;</p>\n</blockquote>\n<h1 id=\"tensorflow&#x4E2D;&#x7684;&#x8FD0;&#x7528;\"><a href=\"#tensorflow&#x4E2D;&#x7684;&#x8FD0;&#x7528;\" class=\"headerlink\" title=\"tensorflow&#x4E2D;&#x7684;&#x8FD0;&#x7528;\"></a>tensorflow&#x4E2D;&#x7684;&#x8FD0;&#x7528;</h1><p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x793A;&#x4F8B;&#xFF0C;&#x76F8;&#x4FE1;&#x5BF9;<code>&#x68AF;&#x5EA6;&#x4E0B;&#x964D;</code>&#x4E5F;&#x6709;&#x4E86;&#x4E00;&#x4E2A;&#x57FA;&#x672C;&#x7684;&#x8BA4;&#x8BC6;&#x3002;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x56DE;&#x5230;&#x6700;&#x5F00;&#x59CB;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x5728;<code>tensorflow</code>&#x4E2D;&#x4F7F;&#x7528;<code>gradientDescent</code>&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import tensorflow as tf</span><br><span class=\"line\"> </span><br><span class=\"line\"># Model parameters</span><br><span class=\"line\">W = tf.Variable([.3], dtype=tf.float32)</span><br><span class=\"line\">b = tf.Variable([-.3], dtype=tf.float32)</span><br><span class=\"line\"># Model input and output</span><br><span class=\"line\">x = tf.placeholder(tf.float32)</span><br><span class=\"line\">linear_model = W*x + b</span><br><span class=\"line\">y = tf.placeholder(tf.float32)</span><br><span class=\"line\"> </span><br><span class=\"line\"># loss</span><br><span class=\"line\">loss = tf.reduce_sum(tf.square(linear_model - y)) # sum of the squares</span><br><span class=\"line\"># optimizer</span><br><span class=\"line\">optimizer = tf.train.GradientDescentOptimizer(0.01)</span><br><span class=\"line\">train = optimizer.minimize(loss)</span><br><span class=\"line\"> </span><br><span class=\"line\"># training data</span><br><span class=\"line\">x_train = [1, 2, 3, 4]</span><br><span class=\"line\">y_train = [0, -1, -2, -3]</span><br><span class=\"line\"># training loop</span><br><span class=\"line\">init = tf.global_variables_initializer()</span><br><span class=\"line\">sess = tf.Session()</span><br><span class=\"line\">sess.run(init) # reset values to wrong</span><br><span class=\"line\">for i in range(1000):</span><br><span class=\"line\">  sess.run(train, {x: x_train, y: y_train})</span><br><span class=\"line\"> </span><br><span class=\"line\"># evaluate training accuracy</span><br><span class=\"line\">curr_W, curr_b, curr_loss = sess.run([W, b, loss], {x: x_train, y: y_train})</span><br><span class=\"line\">print(&quot;W: %s b: %s loss: %s&quot;%(curr_W, curr_b, curr_loss))</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x7684;&#x662F;<a href=\"https://www.tensorflow.org/get_started/get_started\" target=\"_blank\" rel=\"noopener\">tensorflow</a>&#x7684;&#x5B98;&#x7F51;&#x793A;&#x4F8B;&#xFF0C;&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x5B9A;&#x4E49;&#x4E86;&#x51FD;&#x6570;<code>linear_model = W * x + b</code>,&#x5176;&#x4E2D;&#x7684;<code>error</code>&#x51FD;&#x6570;&#x4E3A;<code>linear_model - y</code>&#x3002;&#x76EE;&#x7684;&#x662F;&#x5BF9;&#x4E00;&#x7EC4;<code>x_train</code>&#x4E0E;<code>y_train</code>&#x8FDB;&#x884C;&#x7B80;&#x5355;&#x7684;&#x8BAD;&#x7EC3;&#x6C42;&#x89E3;<code>W</code>&#x4E0E;<code>b</code>&#x3002;&#x4E3A;&#x4E86;&#x6C42;&#x5F97;&#x8FD9;&#x4E00;&#x7EC4;&#x6570;&#x636E;&#x7684;&#x6700;&#x4F18;&#x89E3;&#xFF0C;&#x5C06;&#x6BCF;&#x4E00;&#x7EC4;&#x7684;<code>error</code>&#x76F8;&#x52A0;&#x4ECE;&#x800C;&#x5F97;&#x5230;<code>loss</code>&#xFF0C;&#x6700;&#x540E;&#x518D;&#x5BF9;<code>loss</code>&#x8FDB;&#x884C;&#x68AF;&#x5EA6;&#x4E0B;&#x964D;&#x6C42;&#x89E3;&#x6700;&#x4F18;&#x503C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">optimizer = tf.train.GradientDescentOptimizer(0.01)</span><br><span class=\"line\">train = optimizer.minimize(loss)</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;<code>rate</code>&#x4E3A;<code>0.01</code>,&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x793A;&#x4F8B;&#x4E5F;&#x662F;<code>&#x591A;&#x7EF4;</code>&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x4E5F;&#x8981;&#x7528;&#x5230;<code>&#x504F;&#x5BFC;&#x6570;</code>&#x6765;&#x8FDB;&#x884C;&#x9010;&#x6B65;&#x5411;&#x6700;&#x4F18;&#x89E3;&#x9760;&#x8FD1;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for i in range(1000):</span><br><span class=\"line\">  sess.run(train, {x: x_train, y: y_train})</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x4F7F;&#x7528;<code>&#x68AF;&#x5EA6;&#x4E0B;&#x964D;</code>&#x8FDB;&#x884C;&#x5FAA;&#x73AF;&#x63A8;&#x5BFC;&#xFF0C;&#x4E0B;&#x9762;&#x7ED9;&#x51FA;&#x4E00;&#x4E9B;&#x63A8;&#x5BFC;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x76F8;&#x5173;&#x7ED3;&#x679C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">W: [-0.21999997] b: [-0.456] loss: 4.01814</span><br><span class=\"line\">W: [-0.39679998] b: [-0.49552] loss: 1.81987</span><br><span class=\"line\">W: [-0.45961601] b: [-0.4965184] loss: 1.54482</span><br><span class=\"line\">W: [-0.48454273] b: [-0.48487374] loss: 1.48251</span><br><span class=\"line\">W: [-0.49684232] b: [-0.46917531] loss: 1.4444</span><br><span class=\"line\">W: [-0.50490189] b: [-0.45227283] loss: 1.4097</span><br><span class=\"line\">W: [-0.5115062] b: [-0.43511063] loss: 1.3761</span><br><span class=\"line\">....</span><br><span class=\"line\">....</span><br><span class=\"line\">....</span><br><span class=\"line\">W: [-0.99999678] b: [ 0.99999058] loss: 5.84635e-11</span><br><span class=\"line\">W: [-0.99999684] b: [ 0.9999907] loss: 5.77707e-11</span><br><span class=\"line\">W: [-0.9999969] b: [ 0.99999082] loss: 5.69997e-11</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x63A8;&#x7406;&#x9A8C;&#x8BC1;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x770B;&#x4E86;&#x4E0A;&#x9762;&#x7684;<code>&#x68AF;&#x5EA6;&#x4E0B;&#x964D;</code>&#x7684;&#x524D;&#x4E16;&#x4ECA;&#x751F;&#xFF0C;&#x76F8;&#x4FE1;&#x80FD;&#x591F;&#x81EA;&#x4E3B;&#x7684;&#x63A8;&#x5BFC;&#x51FA;&#x6765;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x770B;&#x6700;&#x540E;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x53EF;&#x4EE5;&#x4F30;&#x7B97;&#x4E3A;<code>W = -1.0</code>&#x4E0E;<code>b  = 1.0</code>&#xFF0C;&#x5C06;&#x4ED6;&#x4EEC;&#x5E26;&#x5165;&#x4E0A;&#x9762;&#x7684;<code>loss</code>&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x4E3A;<code>0.0</code>&#xFF0C;&#x5373;&#x8BEF;&#x5DEE;&#x635F;&#x5931;&#x503C;&#x6700;&#x5C0F;&#xFF0C;&#x6240;&#x4EE5;<code>W = -1.0</code>&#x4E0E;<code>b = 1.0</code>&#x5C31;&#x662F;<code>x_train</code>&#x4E0E;<code>y_train</code>&#x8FD9;&#x7EC4;&#x6570;&#x636E;&#x7684;&#x6700;&#x4F18;&#x89E3;&#x3002;</p>\n<p>&#x597D;&#x4E86;&#xFF0C;&#x5173;&#x4E8E;<code>&#x68AF;&#x5EA6;&#x4E0B;&#x964D;</code>&#x7684;&#x5185;&#x5BB9;&#x5C31;&#x5230;&#x8FD9;&#x4E86;&#xFF0C;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x5230;&#x4F60;&#xFF1B;&#x5982;&#x6709;&#x4E0D;&#x8DB3;&#x4E4B;&#x5904;&#x6B22;&#x8FCE;&#x6765;&#x8BA8;&#x8BBA;&#xFF0C;&#x5982;&#x679C;&#x611F;&#x89C9;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E0D;&#x9519;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x6211;&#x7684;&#x535A;&#x5BA2;&#xFF0C;&#x67E5;&#x770B;&#x6211;&#x7684;&#x5176;&#x5B83;&#x6587;&#x7AE0;&#x3002;</p>\n","categories":["tensorflow"],"tags":["gradientDescent"]},{"title":"Kotlin最佳实践","url":"https://www.rousetime.com/2017/08/21/Kotlin最佳实践/","content":"<p>&#x524D;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5F00;&#x53D1;&#x6BD4;&#x8F83;&#x8F7B;&#x677E;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x7814;&#x7A76;&#x4E86;&#x4E00;&#x4E0B;<code>google</code>&#x4E3B;&#x63A8;&#x7684;<code>kotlin</code>&#x8BED;&#x8A00;&#x3002;&#x6211;&#x4E00;&#x76F4;&#x575A;&#x4FE1;&#xFF0C;&#x5FEB;&#x901F;&#x5B66;&#x4E60;&#x4E0E;&#x638C;&#x63E1;&#x4E00;&#x95E8;&#x8BED;&#x8A00;&#x7684;&#x6700;&#x597D;&#x65B9;&#x5F0F;&#x5C31;&#x662F;&#x5B9E;&#x8DF5;&#xFF0C;&#x8FB9;&#x5F00;&#x53D1;&#x9879;&#x76EE;&#x8FB9;&#x5B66;&#x4E60;&#x3002;&#x8FD9;&#x6837;&#x624D;&#x80FD;&#x5FEB;&#x901F;&#x7684;&#x5C06;&#x5B66;&#x4E60;&#x7684;&#x77E5;&#x8BC6;&#x8FD0;&#x7528;&#x5230;&#x5B9E;&#x8DF5;&#x4E2D;&#xFF0C;&#x4ECE;&#x800C;&#x53D1;&#x73B0;&#x95EE;&#x9898;&#xFF0C;&#x603B;&#x7ED3;&#x7ECF;&#x9A8C;&#x3002;&#x5982;&#x679C;&#x4F60;&#x4E5F;&#x60F3;&#x5B66;&#x4E60;<code>kotlin</code>&#x6216;&#x8005;&#x4E5F;&#x6B63;&#x5728;&#x5B66;&#x4E60;<code>kotlin</code>&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x4E0D;&#x59A8;&#x53EF;&#x4EE5;&#x643A;&#x624B;&#x5171;&#x6D4E;&#xFF0C;&#x5728;&#x5B9E;&#x8DF5;&#x4E2D;&#x63D0;&#x5347;&#x81EA;&#x5DF1;&#xFF0C;&#x5FEB;&#x901F;&#x638C;&#x63E1;<code>kotlin</code>&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#x6211;&#x8981;&#x4ECB;&#x7ECD;&#x7684;&#x9879;&#x76EE;&#x662F;&#x5B8C;&#x5168;&#x4F7F;&#x7528;<code>kotlin</code>&#x7F16;&#x5199;&#x7684;&#x4E00;&#x4E2A;&#x5173;&#x4E8E;&#x65B0;&#x95FB;&#x7684;<code>App</code>&#xFF0C;&#x7531;&#x4E8E;&#x662F;&#x5B9E;&#x8DF5;&#x4ECB;&#x7ECD;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x662F;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x9879;&#x76EE;&#x4E2D;&#x8FD0;&#x7528;&#x5230;&#x7684;&#x77E5;&#x8BC6;&#x70B9;&#xFF0C;&#x65B9;&#x4FBF;&#x540E;&#x7EED;&#x60F3;&#x8981;&#x4E00;&#x8D77;&#x5B66;&#x4E60;&#x7684;&#x540C;&#x5B66;&#x4EEC;&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x4E0E;&#x8FD0;&#x7528;&#x3002;</p>\n<h1 id=\"&#x754C;&#x9762;\"><a href=\"#&#x754C;&#x9762;\" class=\"headerlink\" title=\"&#x754C;&#x9762;\"></a>&#x754C;&#x9762;</h1><p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5173;&#x4E8E;&#x65B0;&#x95FB;&#x7684;<code>App</code>&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x5305;&#x62EC;&#x4E09;&#x4E2A;&#x754C;&#x9762;&#xFF0C;&#x5206;&#x522B;&#x4E3A;&#x65B0;&#x95FB;&#x4E3B;&#x754C;&#x9762;&#x3001;&#x65B0;&#x95FB;&#x8BE6;&#x60C5;&#x754C;&#x9762;&#x4E0E;&#x65B0;&#x95FB;&#x8BA2;&#x9605;&#x754C;&#x9762;&#x3002;&#x4E0B;&#x9762;&#x7B80;&#x8981;&#x4ECB;&#x7ECD;&#x4E0B;&#x6BCF;&#x4E2A;&#x754C;&#x9762;&#x8FD0;&#x7528;&#x5230;&#x7684;&#x77E5;&#x8BC6;&#x70B9;&#x3002;</p>\n<h2 id=\"&#x4E3B;&#x754C;&#x9762;\"><a href=\"#&#x4E3B;&#x754C;&#x9762;\" class=\"headerlink\" title=\"&#x4E3B;&#x754C;&#x9762;\"></a>&#x4E3B;&#x754C;&#x9762;</h2><p>&#x4E3B;&#x754C;&#x9762;&#x4E3A;&#x4E86;&#x5C55;&#x793A;&#x4E0D;&#x540C;&#x7684;&#x5206;&#x7C7B;&#x65B0;&#x95FB;&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E86;<code>TabLayout</code>+<code>ViewPager</code>+<code>Fragment</code>&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x56E0;&#x6B64;&#x4E3B;&#x8981;&#x662F;&#x903B;&#x8F91;&#x5C31;&#x662F;<code>NewsCategoryFrament</code>&#x4E2D;&#x7684;&#x63A5;&#x53E3;&#x8BF7;&#x6C42;&#x4E0E;&#x6570;&#x636E;&#x5904;&#x7406;&#x3002;&#x63A5;&#x53E3;&#x8BF7;&#x6C42;&#x4E3B;&#x8981;&#x8FD0;&#x7528;&#x7684;&#x662F;<code>Retrofit</code>+<code>RxJava</code>+<code>RxAndroid</code>&#x3002;&#x6765;&#x770B;&#x4E0B;&#x754C;&#x9762;&#x56FE;&#xFF1A;</p>\n<p><img src=\"/2017/08/21/Kotlin&#x6700;&#x4F73;&#x5B9E;&#x8DF5;/1.png\" alt=\"&#x4E3B;&#x754C;&#x9762;\"></p>\n<blockquote>\n<p>&#x6211;&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x4ECB;&#x7ECD;&#x9879;&#x76EE;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x8981;&#x8FDB;&#x4E00;&#x6B65;&#x4E86;&#x89E3;<code>kotlin</code>&#x7684;&#x5B9E;&#x73B0;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x540E;&#x9762;&#x7684;&#x6E90;&#x7801;&#x5730;&#x5740;</p>\n</blockquote>\n<h2 id=\"&#x8BE6;&#x60C5;&#x754C;&#x9762;\"><a href=\"#&#x8BE6;&#x60C5;&#x754C;&#x9762;\" class=\"headerlink\" title=\"&#x8BE6;&#x60C5;&#x754C;&#x9762;\"></a>&#x8BE6;&#x60C5;&#x754C;&#x9762;</h2><p>&#x7531;&#x4E8E;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x56FD;&#x5916;&#x7684;<code>News Api</code>&#x6240;&#x4EE5;&#xFF0C;&#x5BF9;&#x4E8E;&#x8BE6;&#x60C5;&#x7684;&#x5C55;&#x793A;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x4E00;&#x4E2A;<code>WebView</code>&#xFF0C;&#x5168;&#x90E8;&#x901A;&#x8FC7;&#x539F;&#x751F;&#x7684;<code>WebView</code>&#x6765;&#x5C55;&#x793A;&#x3002;&#x540E;&#x7EED;&#x67E5;&#x770B;&#x6E90;&#x7801;&#x4F1A;&#x53D1;&#x73B0;&#x8BE5;&#x5904;&#x7684;&#x4EE3;&#x7801;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x3002;</p>\n<p><img src=\"/2017/08/21/Kotlin&#x6700;&#x4F73;&#x5B9E;&#x8DF5;/2.png\" alt=\"&#x8BE6;&#x60C5;&#x754C;&#x9762;\"></p>\n<h2 id=\"&#x8BA2;&#x9605;&#x754C;&#x9762;\"><a href=\"#&#x8BA2;&#x9605;&#x754C;&#x9762;\" class=\"headerlink\" title=\"&#x8BA2;&#x9605;&#x754C;&#x9762;\"></a>&#x8BA2;&#x9605;&#x754C;&#x9762;</h2><p>&#x8BA2;&#x9605;&#x754C;&#x9762;&#x4E3B;&#x8981;&#x662F;&#x5BF9;&#x4E3B;&#x754C;&#x9762;&#x7684;&#x5206;&#x7C7B;<code>News</code>&#x8FDB;&#x884C;&#x6DFB;&#x52A0;&#x8BA2;&#x9605;&#x4E0E;&#x53D6;&#x6D88;&#x8BA2;&#x9605;&#x64CD;&#x4F5C;&#x3002;&#x754C;&#x9762;&#x7ED3;&#x6784;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x4E24;&#x4E2A;&#x6ED1;&#x52A8;&#x7684;<code>RecyclerView</code>&#x3002;&#x5B9E;&#x73B0;&#x5B83;&#x4EEC;&#x95F4;<code>item</code>&#x7684;&#x8054;&#x52A8;&#x3002;</p>\n<p><img src=\"/2017/08/21/Kotlin&#x6700;&#x4F73;&#x5B9E;&#x8DF5;/3.png\" alt=\"&#x8BA2;&#x9605;&#x754C;&#x9762;\"></p>\n<h1 id=\"&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;\"><a href=\"#&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;\" class=\"headerlink\" title=\"&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;\"></a>&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;</h1><p>&#x4E0A;&#x9762;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x4E86;&#x754C;&#x9762;&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x4E0B;&#x9762;&#x6765;&#x8BF4;&#x4E0B;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x6709;&#x5173;&#x7F51;&#x7EDC;&#x65B9;&#x9762;&#x7684;&#x77E5;&#x8BC6;&#x3002;&#x4E3B;&#x8981;&#x5305;&#x62EC;<code>&#x63A5;&#x53E3;&#x8BF7;&#x6C42;</code>&#x4E0E;<code>&#x56FE;&#x7247;&#x52A0;&#x8F7D;</code></p>\n<h2 id=\"&#x63A5;&#x53E3;&#x8BF7;&#x6C42;&#x5C01;&#x88C5;\"><a href=\"#&#x63A5;&#x53E3;&#x8BF7;&#x6C42;&#x5C01;&#x88C5;\" class=\"headerlink\" title=\"&#x63A5;&#x53E3;&#x8BF7;&#x6C42;&#x5C01;&#x88C5;\"></a>&#x63A5;&#x53E3;&#x8BF7;&#x6C42;&#x5C01;&#x88C5;</h2><p>&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x4ECB;&#x7ECD;&#x8FC7;&#x4E86;&#xFF0C;&#x9879;&#x76EE;&#x4F7F;&#x7528;&#x7684;&#x662F;<code>Retrofit</code>+<code>RxJava</code>+<code>RxAndroid</code>&#x6765;&#x8FDB;&#x884C;&#x63A5;&#x53E3;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x4E3A;&#x4E86;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x8FDB;&#x884C;&#x66F4;&#x597D;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x8FD9;&#x91CC;&#x5BF9;&#x63A5;&#x53E3;&#x8BF7;&#x6C42;&#x8FDB;&#x884C;&#x4E86;&#x5C01;&#x88C5;&#x3002;&#x4E3B;&#x8981;<code>code</code>&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun &lt;T&gt; doGet(params: MutableMap&lt;String, Any?&gt;, tClass: Class&lt;T&gt;): Observable&lt;T?&gt; {</span><br><span class=\"line\">        return initParams(params, tClass)!!.observeOn(Schedulers.io()).flatMap { tempString -&gt;</span><br><span class=\"line\">            if (tClass == NewsArticleListModel::class.java) {</span><br><span class=\"line\">                getNewsApi().getArticles(tempString).subscribeOn(Schedulers.io())</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                getNewsApi().getSources(tempString).subscribeOn(Schedulers.io())</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }.flatMap { newsResponse -&gt;</span><br><span class=\"line\">            if (newsResponse is NewsArticleListModel &amp;&amp; newsResponse.status.equals(&quot;ok&quot;)</span><br><span class=\"line\">                    || (newsResponse is NewsSourcesListModel &amp;&amp; newsResponse.status.equals(&quot;ok&quot;))) {</span><br><span class=\"line\">                val json = getGson()?.toJson(newsResponse!!)</span><br><span class=\"line\">                if (json.isNullOrEmpty()) return@flatMap null!!</span><br><span class=\"line\">                val data = getGson()?.fromJson(json, tClass)</span><br><span class=\"line\">                Observable.just(data)</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                Observable.error&lt;T&gt; { Exception() }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }.observeOn(AndroidSchedulers.mainThread())</span><br><span class=\"line\">                .doOnError { t -&gt; Log.d(&quot;TAG&quot;, &quot;throwable: &quot; + t) }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x7531;&#x4E8E;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x6765;&#x81EA;&#x4E0E;&#x7F51;&#x7EDC;&#x4E0E;&#x672C;&#x5730;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5C06;&#x6765;&#x6E90;&#x5C4F;&#x853D;&#xFF0C;&#x8BF7;&#x6C42;&#x62BD;&#x8C61;&#x6210;&#x63A5;&#x53E3;&#x3002;&#x65B9;&#x4FBF;&#x4EE5;&#x540E;&#x672C;&#x5730;&#x6570;&#x636E;&#x8BF7;&#x6C42;&#x7684;&#x52A0;&#x5165;<strong><em>&#xFF08;&#x76EE;&#x524D;&#x8FD8;&#x6CA1;&#x6709;&#x5F15;&#x5165;&#x672C;&#x5730;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x540E;&#x7EED;&#x6709;&#x65F6;&#x95F4;&#x5C06;&#x5F15;&#x5165;&#xFF09;</em></strong>&#x3002;&#x5206;&#x522B;&#x4E3A;<code>RequestCommand</code>&#x4E0E;<code>Provider</code>&#x63A5;&#x53E3;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x5B9E;&#x73B0;&#x5C31;&#x662F;<code>NewsReqeustCommand</code>&#x4E0E;<code>NewsProvider</code>&#x3002;&#x56E0;&#x6B64;&#x6700;&#x7EC8;&#x7684;&#x8C03;&#x7528;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun setupRequest(refresh: Boolean) {</span><br><span class=\"line\">        val params = mutableMapOf&lt;String, Any?&gt;(</span><br><span class=\"line\">                NewsConfig.REQUEST_SOURCE to id,</span><br><span class=\"line\">                NewsConfig.REQUEST_SORT_BY to NewsConfig.SortBy.TOP.sort</span><br><span class=\"line\">        )</span><br><span class=\"line\">        requestCommand = NewsRequestCommand(params, NewsArticleListModel::class.java,</span><br><span class=\"line\">                object : DefaultDisposableObserver&lt;NewsArticleListModel&gt;() {</span><br><span class=\"line\">                    override fun onNext(t: NewsArticleListModel) {</span><br><span class=\"line\">                        if (refresh) swipeRefreshLayout.isRefreshing = false</span><br><span class=\"line\">                        dataList.clear()</span><br><span class=\"line\">                        dataList.addAll(t.articles)</span><br><span class=\"line\">                        recyclerView.adapter.notifyDataSetChanged()</span><br><span class=\"line\">                    }</span><br><span class=\"line\"></span><br><span class=\"line\">                    override fun onError(e: Throwable) {</span><br><span class=\"line\">                        super.onError(e)</span><br><span class=\"line\">                        if (refresh) swipeRefreshLayout.isRefreshing = false</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                })</span><br><span class=\"line\">        requestCommand?.execute()</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x81EA;&#x5DF1;&#x6700;&#x8FD1;&#x6CA1;&#x6709;&#x65F6;&#x95F4;&#xFF0C;&#x624B;&#x4E0A;&#x7684;&#x9879;&#x76EE;&#x5C06;&#x8981;&#x5927;&#x6539;&#x7248;&#x3002;&#x5982;&#x679C;&#x5BA2;&#x5B98;&#x4EEC;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x8BDD;&#x53EF;&#x4EE5;&#x5728;<code>Github</code>&#x4E0A;<code>Start/Fork</code>&#x63D0;&#x4EA4;<code>PR</code></p>\n</blockquote>\n<h2 id=\"&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x5C01;&#x88C5;\"><a href=\"#&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x5C01;&#x88C5;\" class=\"headerlink\" title=\"&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x5C01;&#x88C5;\"></a>&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x5C01;&#x88C5;</h2><p>&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x4F7F;&#x7528;&#x7684;&#x662F;<code>facebook</code>&#x7684;<code>fresco</code>&#xFF0C;&#x4E3A;&#x4E86;&#x5168;&#x5C40;&#x4F7F;&#x7528;&#x7EDF;&#x4E00;&#x7684;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;<code>kotlin</code>&#x7684;<code>Extension Functions</code>&#x7279;&#x6027;&#xFF0C;&#x5BF9;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun SimpleDraweeView.displayImage(url: String?, width: Int = 200, listener: BaseControllerListener&lt;Any&gt;? = null) {</span><br><span class=\"line\">    if (url == null) return</span><br><span class=\"line\">    this.hierarchy.setPlaceholderImage(R.drawable.news_default_bg)</span><br><span class=\"line\">    val imageRequest = ImageRequestBuilder.newBuilderWithSource(Uri.parse(url))</span><br><span class=\"line\">            .setResizeOptions(ResizeOptions(width, width))</span><br><span class=\"line\">            .build()</span><br><span class=\"line\">    val controller = Fresco.newDraweeControllerBuilder()</span><br><span class=\"line\">            .setImageRequest(imageRequest)</span><br><span class=\"line\">            .setAutoPlayAnimations(true)</span><br><span class=\"line\">            .setControllerListener(listener)</span><br><span class=\"line\">            .setOldController(this.controller)</span><br><span class=\"line\">            .build()</span><br><span class=\"line\">    this.controller = controller</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x6700;&#x7EC8;&#x7684;&#x8C03;&#x7528;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">itemView.image.displayImage(url = urlToImage)</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#xFF0C;&#x5F53;&#x7136;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x52A8;&#x6001;&#x9009;&#x62E9;</p>\n</blockquote>\n<h1 id=\"Interface\"><a href=\"#Interface\" class=\"headerlink\" title=\"Interface\"></a>Interface</h1><p>&#x5728;<code>kotlin</code>&#x4E2D;&#x7684;<code>interface</code>&#x4E0E;<code>java</code>&#x4E2D;&#x7684;<code>interface</code>&#x6709;&#x4E00;&#x4E2A;&#x5DE8;&#x5927;&#x7684;&#x533A;&#x522B;&#x3002;&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x5728;<code>java</code>&#x4E2D;<code>interface</code>&#x4E2D;&#x662F;&#x4E0D;&#x80FD;&#x591F;&#x5BF9;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x5728;<code>kotlin</code>&#x4E2D;&#x7684;<code>interface</code>&#x53EF;&#x4EE5;&#x5BF9;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x3002;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x501F;&#x52A9;&#x8FD9;&#x4E00;&#x7279;&#x6027;&#x6765;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;<code>ToolBarManager</code>&#xFF0C;&#x65B9;&#x4FBF;&#x754C;&#x9762;&#x7684;&#x5BFC;&#x822A;&#x8BBE;&#x7F6E;&#x3002;&#x5177;&#x4F53;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface ToolBarManager {</span><br><span class=\"line\">    val toolBar: Toolbar</span><br><span class=\"line\">    var toolBarTitle: String</span><br><span class=\"line\">        set(value) {</span><br><span class=\"line\">            toolBar.title = value</span><br><span class=\"line\">        }</span><br><span class=\"line\">        get() = toolBar.title.toString()</span><br><span class=\"line\"> </span><br><span class=\"line\">    fun initToolBar() {</span><br><span class=\"line\">        toolBar.inflateMenu(R.menu.menu)</span><br><span class=\"line\">        toolBar.setOnMenuItemClickListener {</span><br><span class=\"line\">            when (it.itemId) {</span><br><span class=\"line\">                R.id.subscribe -&gt; toolBar.context.startActivity&lt;SubscribeActivity&gt;()</span><br><span class=\"line\">            }</span><br><span class=\"line\">            true</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    fun enableHomeAsUp(back: () -&gt; Unit) {</span><br><span class=\"line\">        toolBar.navigationIcon = DrawerArrowDrawable(toolBar.context)</span><br><span class=\"line\">        toolBar.setNavigationOnClickListener { back() }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x540E;&#x7EED;&#x754C;&#x9762;&#x5BFC;&#x822A;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B9E;&#x73B0;<code>ToolBarManager</code>&#x63A5;&#x53E3;&#x5373;&#x53EF;&#x3002;</p>\n<h1 id=\"Delegated-Properties\"><a href=\"#Delegated-Properties\" class=\"headerlink\" title=\"Delegated Properties\"></a>Delegated Properties</h1><p>&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x5728;&#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F1A;&#x9047;&#x5230;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x7684;&#x7F16;&#x5199;&#xFF0C;&#x57FA;&#x672C;&#x7684;<code>kotlin</code>&#x7F16;&#x5199;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class App : Application() {</span><br><span class=\"line\">\tcompanion object {</span><br><span class=\"line\">\t\tprivate var instance: Application? = null</span><br><span class=\"line\">\t\tfun instance() = instance!!</span><br><span class=\"line\">\t}</span><br><span class=\"line\"> </span><br><span class=\"line\">\toverride fun onCreate() {</span><br><span class=\"line\">\t\tsuper.onCreate()</span><br><span class=\"line\">\t\tinstance = this</span><br><span class=\"line\">\t}</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x4E8E;<code>kotlin</code>&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;<code>standard Delegates</code>&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5176;&#x4E2D;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>lazy</code>&#x6765;&#x8FDB;&#x884C;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x7684;&#x61D2;&#x52A0;&#x8F7D;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">companion object {</span><br><span class=\"line\">    val instance by lazy { NewsApp() }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6216;&#x8005;&#x662F;<code>lateinit</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class App : Application() {</span><br><span class=\"line\">\tcompanion object {</span><br><span class=\"line\">\t\tlateinit var instance: App</span><br><span class=\"line\">\t\t\tprivate set</span><br><span class=\"line\">\t}</span><br><span class=\"line\"> </span><br><span class=\"line\">\toverride fun onCreate() {</span><br><span class=\"line\">\t\tsuper.onCreate()</span><br><span class=\"line\">\t\tinstance = this</span><br><span class=\"line\">\t}</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x81EA;&#x5B9A;&#x4E49;<a href=\"https://kotlinlang.org/docs/reference/delegated-properties.html\" target=\"_blank\" rel=\"noopener\">Delegated</a>&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x901A;&#x8FC7;&#x4F7F;&#x7528;<code>ReadWriteProperty&lt;in R, T&gt;</code>&#x63A5;&#x53E3;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">object DelegatesExt {</span><br><span class=\"line\">    fun &lt;T&gt; notNullSingleValue(): ReadWriteProperty&lt;Any?, T&gt; = NotNullSingleValueVar()</span><br><span class=\"line\">}</span><br><span class=\"line\">class NotNullSingleValueVar&lt;T&gt; : ReadWriteProperty&lt;Any?, T&gt; {</span><br><span class=\"line\"></span><br><span class=\"line\">    private var value: T? = null</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun getValue(thisRef: Any?, property: KProperty&lt;*&gt;): T {</span><br><span class=\"line\">        return value ?: throw IllegalStateException(&quot;${property.name} not initialized&quot;)</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    override fun setValue(thisRef: Any?, property: KProperty&lt;*&gt;, value: T) {</span><br><span class=\"line\">        this.value = if (this.value == null) value else throw IllegalStateException(&quot;${property.name} not initialized&quot;)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5F53;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;&#x503C;&#x4E0E;&#x83B7;&#x53D6;&#x503C;&#x65F6;&#xFF0C;&#x4F1A;&#x8C03;&#x7528;&#x76F8;&#x5E94;&#x7684;<code>getValue</code>&#x4E0E;<code>setValue</code>&#x65B9;&#x6CD5;&#xFF0C;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">companion object {</span><br><span class=\"line\">    var instance: NewsApp by DelegatesExt.notNullSingleValue&lt;NewsApp&gt;()</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x5F53;&#x7136;&#xFF0C;&#x9879;&#x76EE;&#x4E2D;&#x8FD8;&#x5BF9;<code>Preference</code>&#x8FDB;&#x884C;&#x4E86;&#x76F8;&#x4F3C;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>\n</blockquote>\n<h1 id=\"Anko\"><a href=\"#Anko\" class=\"headerlink\" title=\"Anko\"></a>Anko</h1><p>&#x5176;&#x5B9E;&#x4F7F;&#x7528;<code>kotlin</code>&#x8FDB;&#x884C;<code>Android</code>&#x5F00;&#x53D1;&#x4E5F;&#x6709;&#x76F8;&#x5E94;&#x7684;&#x5DE5;&#x5177;&#x5E93;&#x3002;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x63D0;&#x5347;&#x6211;&#x4EEC;&#x7684;&#x5F00;&#x53D1;&#x6548;&#x7387;&#xFF0C;&#x5176;&#x4E2D;<a href=\"https://github.com/Kotlin/anko\" target=\"_blank\" rel=\"noopener\">Anko</a>&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>Anko DSL</code>&#x4EE3;&#x7801;&#x4E66;&#x5199;&#x4EE3;&#x66FF;<code>XML</code>&#x6765;&#x8FDB;&#x884C;<code>UI</code>&#x5E03;&#x5C40;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x6709;&#x6548;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x5F53;&#x7136;&#x5B83;&#x4E5F;&#x6709;&#x8BB8;&#x591A;&#x6709;&#x7528;&#x7684;<code>functions</code>&#xFF0C;&#x53EF;&#x4EE5;&#x5927;&#x5927;&#x63D0;&#x5347;&#x6211;&#x4EEC;&#x7684;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</p>\n<p>1.<code>find()</code>&#x4EE3;&#x66FF;<code>findViewById()</code><br>2.<code>longToast()</code>&#x4EE3;&#x66FF;&#x539F;&#x751F;<code>Toast()</code><br>3.<code>startActivity(vararg params: Pair&lt;String, Any&gt;</code>&#x4EE3;&#x66FF;&#x539F;&#x751F;<code>startActivity()</code><br>4.<code>Anko SQLite</code>&#x7B80;&#x5316;&#x539F;&#x751F;&#x7684;<code>SQLite</code>&#x7684;&#x4F7F;&#x7528;<br>5.<code>Dialogs</code>&#x7684;&#x7B80;&#x5316;&#x4F7F;&#x7528;</p>\n<h1 id=\"End\"><a href=\"#End\" class=\"headerlink\" title=\"End\"></a>End</h1><p>&#x597D;&#x4E86;&#xFF0C;&#x5927;&#x6982;&#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x591A;&#x4E86;&#x3002;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x60F3;&#x5B66;&#x4E0E;&#x6B63;&#x5728;&#x5B66;&#x4E60;<code>kotlin</code>&#x7684;&#x5BA2;&#x5B98;&#x4EEC;&#xFF0C;&#x5C11;&#x8D70;&#x5F2F;&#x8DEF;&#xFF0C;&#x5FEB;&#x901F;&#x6210;&#x957F;&#x3002;&#x5982;&#x6709;&#x4E0D;&#x8DB3;&#x4E4B;&#x5904;&#x6B22;&#x8FCE;&#x4EA4;&#x6D41;&#xFF01;</p>\n<p><a href=\"https://github.com/idisfkj/NewsKotlin\" target=\"_blank\" rel=\"noopener\">&#x9879;&#x76EE;&#x5730;&#x5740;</a></p>\n","categories":["android"],"tags":["Kotlin"]},{"title":"Android共享动画兼容实现","url":"https://www.rousetime.com/2017/07/16/Android共享动画兼容实现/","content":"<blockquote>\n<p><em>&#x751F;&#x547D;&#x4E0D;&#x606F;&#xFF0C;&#x594B;&#x6597;&#x4E0D;&#x6B62;</em></p>\n</blockquote>\n<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p>&#x770B;&#x4E86;&#x4E00;&#x4E0B;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#x8BB0;&#x5F55;&#xFF0C;&#x6700;&#x8FD1;&#x7684;&#x6587;&#x7AE0;&#x662F;&#x5728;3&#x6708;12&#x65E5;&#x5199;&#x7684;&#xFF0C;&#x4ECA;&#x5929;&#x7684;7&#x6708;16&#x65E5;&#x3002;&#x4E0D;&#x77E5;&#x4E0D;&#x89C9;&#x5DF2;&#x7ECF;4&#x4E2A;&#x6708;&#x6CA1;&#x6709;&#x5750;&#x5728;&#x7535;&#x8111;&#x524D;&#x8BA4;&#x771F;&#x7684;&#x601D;&#x8003;&#x4E0E;&#x9759;&#x4E0B;&#x5FC3;&#x6765;&#x505A;&#x4E9B;&#x603B;&#x7ED3;&#x3002;&#x8D81;&#x7740;&#x521A;&#x521A;&#x738B;&#x8005;&#x8363;&#x8000;&#x8D85;&#x795E;&#x7684;&#x5174;&#x594B;&#x70ED;&#x5EA6;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x8BF4;&#x8BF4;&#x6211;&#x5BF9;<code>Android</code>&#x5171;&#x4EAB;&#x52A8;&#x753B;&#x65B9;&#x9762;&#x7684;&#x4E00;&#x4E9B;&#x5FC3;&#x5F97;&#x3002;</p>\n<h1 id=\"&#x5B9E;&#x73B0;&#x65B9;&#x6848;\"><a href=\"#&#x5B9E;&#x73B0;&#x65B9;&#x6848;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;&#x65B9;&#x6848;\"></a>&#x5B9E;&#x73B0;&#x65B9;&#x6848;</h1><p>&#x8FD9;&#x91CC;&#x6211;&#x59D1;&#x4E14;&#x90FD;&#x8BA4;&#x4E3A;&#x5927;&#x5BB6;&#x90FD;&#x5BF9;&#x5171;&#x4EAB;&#x52A8;&#x753B;&#x7684;&#x6548;&#x679C;&#x6709;&#x6240;&#x4E86;&#x89E3;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x8BF4;&#x5C31;&#x662F;&#x4ECE;&#x4E00;&#x4E2A;&#x754C;&#x9762;&#x5E73;&#x79FB;&#x7F29;&#x653E;&#x8FC7;&#x5EA6;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x754C;&#x9762;&#x3002;&#x5728;&#x5B9E;&#x73B0;&#x65B9;&#x9762;&#x4E0A;&#x9488;&#x5BF9;&#x4E0D;&#x540C;<code>Android</code>&#x7CFB;&#x7EDF;&#x7248;&#x672C;&#xFF0C;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x505A;&#x6CD5;&#x3002;&#x5BF9;&#x4E8E;<code>Android 5.0&#xFF08;LOLLIPOP API 21&#xFF09;</code>&#x4EE5;&#x4E0A;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x5B9E;&#x73B0;&#x8D77;&#x6765;&#x76F8;&#x5BF9;&#x6765;&#x8BF4;&#x65B9;&#x4FBF;&#x4E86;&#x8BB8;&#x591A;&#xFF0C;&#x53EA;&#x9700;&#x505A;&#x4E00;&#x4E9B;&#x5951;&#x7EA6;&#x4E0E;&#x8C03;&#x7528;&#x7CFB;&#x7EDF;&#x7684;<code>API</code>&#x5373;&#x53EF;&#x3002;&#x4F46;&#x662F;&#x5E02;&#x573A;&#x4E0A;&#x5BF9;&#x4E8E;<code>Android 5.0</code>&#x4EE5;&#x4E0B;&#x7684;&#x673A;&#x578B;&#x8FD8;&#x662F;&#x5B58;&#x5728;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x80FD;&#x5FFD;&#x7565;&#x5B83;&#x4EEC;&#xFF0C;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x517C;&#x5BB9;&#x4E0A;&#x4E0B;&#x7248;&#x672C;&#x7684;&#x673A;&#x578B;&#xFF0C;&#x540C;&#x65F6;&#x4EE5;&#x4E3A;&#x4E86;&#x8BA9;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x4E00;&#x81F4;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x81EA;&#x5DF1;&#x52A8;&#x624B;&#x5B9E;&#x73B0;&#x5171;&#x4EAB;&#x52A8;&#x753B;&#x7684;&#x9700;&#x6C42;&#x3002;</p>\n<h2 id=\"Android-5-0-&#x53CA;&#x5176;&#x4EE5;&#x4E0A;&#x7684;&#x5B9E;&#x73B0;\"><a href=\"#Android-5-0-&#x53CA;&#x5176;&#x4EE5;&#x4E0A;&#x7684;&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"Android 5.0 &#x53CA;&#x5176;&#x4EE5;&#x4E0A;&#x7684;&#x5B9E;&#x73B0;\"></a>Android 5.0 &#x53CA;&#x5176;&#x4EE5;&#x4E0A;&#x7684;&#x5B9E;&#x73B0;</h2><p>&#x4E3A;&#x4E86;&#x6EE1;&#x8DB3;&#x90E8;&#x5206;&#x53EA;&#x8003;&#x8651;<code>Android 5.0</code>&#x4EE5;&#x4E0A;&#x5B9E;&#x73B0;&#x7684;&#x670B;&#x53CB;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x4E5F;&#x5BF9;&#x7CFB;&#x7EDF;&#x7684;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x7B80;&#x5355;&#x7684;&#x793A;&#x4F8B;&#x8BF4;&#x660E;&#x3002;&#x6211;&#x8FD9;&#x8FB9;&#x603B;&#x7ED3;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x4E3B;&#x8981;&#x5206;&#x4E3A;&#x4E09;&#x6B65;&#x3002;</p>\n<h3 id=\"&#x5EFA;&#x7ACB;&#x5951;&#x7EA6;\"><a href=\"#&#x5EFA;&#x7ACB;&#x5951;&#x7EA6;\" class=\"headerlink\" title=\"&#x5EFA;&#x7ACB;&#x5951;&#x7EA6;\"></a>&#x5EFA;&#x7ACB;&#x5951;&#x7EA6;</h3><p>&#x8981;&#x60F3;&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x754C;&#x9762;&#x70B9;&#x51FB;&#x63A7;&#x4EF6;&#x5171;&#x4EAB;&#x8DF3;&#x8F6C;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x754C;&#x9762;&#x7684;&#x5BF9;&#x4E8E;&#x63A7;&#x4EF6;&#x4E0A;&#xFF0C;&#x9700;&#x8981;&#x5C06;&#x8FD9;&#x4E24;&#x4E2A;&#x5171;&#x4EAB;&#x7684;&#x63A7;&#x4EF6;&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#xFF0C;&#x5373;&#x8981;&#x8BA9;&#x7CFB;&#x7EDF;&#x80FD;&#x591F;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x751F;&#x6548;&#x7684;&#x63A7;&#x4EF6;&#x3002;&#x800C;&#x4E3A;&#x4E86;&#x8FBE;&#x5230;&#x8FD9;&#x79CD;&#x6548;&#x679C;, &#x7CFB;&#x7EDF;&#x7ED9;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public final void setTransitionName(String transitionName)</span><br></pre></td></tr></table></figure></p>\n<p>&#x8FD9;&#x662F;<code>View</code>&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x8BE5;&#x53C2;&#x6570;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;&#x7684;&#x5951;&#x7EA6;&#x540D;&#x79F0;&#x3002;&#x5373;&#x5728;&#x4E24;&#x4E2A;&#x754C;&#x9762;&#x4E0A;&#x5BF9;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x5171;&#x4EAB;&#x7684;&#x4E24;&#x4E2A;&#x63A7;&#x4EF6;&#x8FDB;&#x884C;&#x76F8;&#x540C;&#x540D;&#x79F0;&#x7684;&#x8BBE;&#x5B9A;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static final String TRANSITION_NAME_SHARE = &quot;share&quot;;</span><br><span class=\"line\">imageView.setTransitionName(TRANSITION_NAME_SHARE);</span><br></pre></td></tr></table></figure>\n<p>&#x4EE5;&#x4E0A;&#x662F;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x52A8;&#x6001;&#x8BBE;&#x7F6E;&#xFF0C;&#x5728;<code>xml</code>&#x6587;&#x4EF6;&#x4E2D;&#x4E5F;&#x80FD;&#x8BBE;&#x7F6E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android:transitionName=&quot;share&quot;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x552F;&#x4E00;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x5C31;&#x662F;&#x540D;&#x79F0;&#x5FC5;&#x987B;&#x76F8;&#x540C;</p>\n</blockquote>\n<h3 id=\"&#x8C03;&#x7528;ActivityOptionsCompat\"><a href=\"#&#x8C03;&#x7528;ActivityOptionsCompat\" class=\"headerlink\" title=\"&#x8C03;&#x7528;ActivityOptionsCompat\"></a>&#x8C03;&#x7528;ActivityOptionsCompat</h3><p>&#x4E0A;&#x9762;&#x5EFA;&#x7ACB;&#x7684;&#x5951;&#x7EA6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FDB;&#x5165;&#x4E3B;&#x9898;&#x2013;&#x5F00;&#x542F;&#x5171;&#x4EAB;&#x52A8;&#x753B;&#x3002;&#x5728;&#x8FDB;&#x884C;&#x754C;&#x9762;&#x7684;&#x8DF3;&#x8F6C;&#xFF0C;&#x7ED9;&#x5E73;&#x5E38;&#x7684;&#x7528;&#x53D1;&#x4E00;&#x6837;&#xFF0C;&#x521B;&#x5EFA;<code>Intent</code>&#xFF0C;&#x8C03;&#x7528;<code>startActivity</code>&#x65B9;&#x6CD5;&#x3002;&#x53EA;&#x4E0D;&#x8FC7;&#x5728;&#x8C03;&#x7528;<code>startActivity</code>&#x65F6;&#x8981;&#x5728;&#x4F20;&#x4E2A;<code>Bundle</code>&#x53C2;&#x6570;&#x3002;&#x8BE5;&#x53C2;&#x6570;&#x9700;&#x8981;&#x901A;&#x8FC7;<code>ActivityOptionsCompat</code>&#x83B7;&#x53D6;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ActivityOptionsCompat compat = ActivityOptionsCompat.makeSceneTransitionAnimation(MainActivity.this, imageView, TRANSITION_NAME_SHARE);</span><br></pre></td></tr></table></figure>\n<p>&#x8BF4;&#x4E0B;&#x53C2;&#x6570;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;<code>Activity</code>&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x9700;&#x8981;&#x5171;&#x4EAB;&#x7684;<code>View</code>&#xFF0C;&#x7B2C;&#x4E09;&#x4E2A;&#x5C31;&#x662F;&#x5951;&#x7EA6;&#x540D;&#x79F0;&#x3002;&#x6700;&#x540E;&#x5F00;&#x542F;&#x8DF3;&#x8F6C;&#x65F6;&#x4F20;&#x5165;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">startActivity(intent, compat.toBundle());</span><br></pre></td></tr></table></figure>\n<h3 id=\"finishAfterTransition\"><a href=\"#finishAfterTransition\" class=\"headerlink\" title=\"finishAfterTransition\"></a>finishAfterTransition</h3><p>&#x4F7F;&#x7528;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x80FD;&#x770B;&#x5230;&#x8DF3;&#x8F6C;&#x7684;&#x5F00;&#x542F;&#x5171;&#x4EAB;&#x52A8;&#x753B;&#x4E86;&#xFF0C;&#x5F53;&#x7136;&#x524D;&#x63D0;&#x662F;&#x5728;<code>Andorid 5.0</code>&#x53CA;&#x5176;&#x4EE5;&#x4E0A;&#x7684;&#x624B;&#x673A;&#x4E0A;&#x3002;&#x4E0A;&#x9762;&#x53EA;&#x5B8C;&#x6210;&#x4E86;&#x5F00;&#x542F;&#xFF0C;&#x5BF9;&#x4E8E;&#x9000;&#x51FA;&#xFF0C;&#x5B9E;&#x73B0;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x9700;&#x5728;&#x9000;&#x51FA;&#x7684;&#x65F6;&#x5019;&#x8C03;&#x7528;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#x5373;&#x53EF;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">finishAfterTransition();</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x662F;<code>Activity</code>&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x9000;&#x51FA;&#x754C;&#x9762;&#x4E2D;&#x8C03;&#x7528;&#x3002;&#x5EFA;&#x8BAE;&#x53EF;&#x4EE5;&#x91CD;&#x5199;<code>onBackPressed</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x5176;&#x4E2D;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#x3002;</p>\n<p>&#x518D;&#x56DE;&#x987E;&#x4E00;&#x4E0B;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4E5F;&#x5C31;10&#x884C;&#x4EE3;&#x7801;&#x4EE5;&#x5185;&#x3002;&#x6240;&#x4EE5;&#x5BF9;&#x4E8E;&#x53EA;&#x652F;&#x6301;&#x9AD8;&#x7248;&#x672C;&#x7684;&#x7CFB;&#x7EDF;&#x7684;&#x670B;&#x53CB;&#x6765;&#x8BF4;&#xFF0C;&#x771F;&#x662F;&#x723D;&#x6B6A;&#x6B6A;&#x3002;&#x65E0;&#x56FE;&#x65E0;&#x771F;&#x76F8;&#xFF0C;&#x5BA2;&#x5B98;&#x8BF7;&#x770B;&#x56FE;&#x3002;</p>\n<p><img src=\"/2017/07/16/Android&#x5171;&#x4EAB;&#x52A8;&#x753B;&#x517C;&#x5BB9;&#x5B9E;&#x73B0;/share1.gif\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<hr>\n<h2 id=\"&#x517C;&#x5BB9;&#x5168;&#x7248;&#x672C;&#x5B9E;&#x73B0;\"><a href=\"#&#x517C;&#x5BB9;&#x5168;&#x7248;&#x672C;&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x517C;&#x5BB9;&#x5168;&#x7248;&#x672C;&#x5B9E;&#x73B0;\"></a>&#x517C;&#x5BB9;&#x5168;&#x7248;&#x672C;&#x5B9E;&#x73B0;</h2><p>&#x6211;&#x76F8;&#x4FE1;&#x4E00;&#x76F4;&#x8BFB;&#x5230;&#x8FD9;&#x91CC;&#x7684;&#x5BA2;&#x5B98;&#x5FC3;&#x7406;&#x90FD;&#x662F;&#x5F88;&#x6109;&#x60A6;&#x4E0E;&#x8F7B;&#x677E;&#x7684;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x9700;&#x8981;&#x63D0;&#x9192;&#x5BA2;&#x5B98;&#x4EEC;&#xFF0C;&#x5E94;&#x8BE5;&#x63D0;&#x8D77;&#x51E0;&#x5206;&#x6CE8;&#x610F;&#x4E86;&#x6765;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x7CBE;&#x5F69;&#x5185;&#x5BB9;&#x3002;</p>\n<h3 id=\"&#x539F;&#x7406;\"><a href=\"#&#x539F;&#x7406;\" class=\"headerlink\" title=\"&#x539F;&#x7406;\"></a>&#x539F;&#x7406;</h3><p>&#x57FA;&#x4E8E;&#x4E0A;&#x9762;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x4E0B;&#x4E0A;&#x9762;&#x7684;&#x6548;&#x679C;&#x56FE;&#xFF0C;&#x6240;&#x8C13;&#x4E00;&#x56FE;&#x80DC;&#x5343;&#x8A00;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x8D77;&#x6765;&#x7ED3;&#x5408;&#x6548;&#x679C;&#x56FE;&#x6765;&#x5206;&#x6790;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x6548;&#x679C;&#x56FE;&#x80FD;&#x591F;&#x770B;&#x5230;&#x4E24;&#x4E2A;&#x660E;&#x663E;&#x7684;&#x6548;&#x679C;&#xFF1A;</p>\n<ul>\n<li>&#x754C;&#x9762;&#x80CC;&#x666F;&#x662F;&#x900F;&#x660E;&#x6E10;&#x53D8;&#x7684;&#x65B9;&#x5F0F;&#x8FC7;&#x5EA6;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x754C;&#x9762;&#x7684;&#x3002;</li>\n<li>&#x63A7;&#x4EF6;&#x662F;&#x4ECE;&#x7B2C;&#x4E00;&#x4E2A;&#x754C;&#x9762;&#x539F;&#x5730;&#x653E;&#x5927;&#x5E73;&#x79FB;&#x5230;&#x7B2C;&#x4E8C;&#x4E2A;&#x754C;&#x9762;&#x7684;&#x63A7;&#x4EF6;&#x4F4D;&#x7F6E;&#x4E0A;&#x3002;</li>\n</ul>\n<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x8981;&#x70B9;&#x6765;&#x770B;&#xFF0C;&#x5BF9;&#x63A7;&#x4EF6;&#x7684;&#x52A8;&#x753B;&#x5B9E;&#x73B0;&#x662F;&#x91CD;&#x4E2D;&#x4E4B;&#x91CD;&#x3002;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#x8FC7;&#x7A0B;&#x662F;:<code>&#x5C06;&#x7B2C;&#x4E8C;&#x4E2A;&#x754C;&#x9762;&#x900F;&#x660E;&#x542F;&#x52A8;&#xFF0C;&#x540C;&#x65F6;&#x5C06;&#x7B2C;&#x4E8C;&#x4E2A;&#x754C;&#x9762;&#x7684;&#x63A7;&#x4EF6;&#x7F29;&#x653E;&#x5E73;&#x79FB;&#x5230;&#x7B2C;&#x4E00;&#x4E2A;&#x754C;&#x9762;&#x7684;&#x63A7;&#x4EF6;&#x4F4D;&#x7F6E;&#x4E0A;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x653E;&#x5927;&#x5E73;&#x79FB;&#x5230;&#x7B2C;&#x4E8C;&#x4E2A;&#x754C;&#x9762;&#x539F;&#x59CB;&#x7684;&#x4F4D;&#x7F6E;&#x4E0A;&#x3002;</code>&#x8FD9;&#x6837;&#x5C31;&#x5B9E;&#x73B0;&#x4E86;&#x9AD8;&#x7248;&#x672C;&#x7684;&#x5171;&#x4EAB;&#x52A8;&#x753B;&#x7684;&#x6548;&#x679C;&#x3002;&#x8981;&#x60F3;&#x8FBE;&#x5230;&#x653E;&#x5927;&#x5E73;&#x79FB;&#x52A8;&#x753B;&#x7684;&#x51C6;&#x786E;&#x8FDB;&#x884C;&#xFF0C;&#x81EA;&#x7136;&#x8981;&#x5F97;&#x5230;&#x76F8;&#x5E94;&#x7684;&#x63A7;&#x4EF6;&#x53C2;&#x6570;&#x4FE1;&#x606F;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5728;&#x5B9E;&#x73B0;&#x63A7;&#x4EF6;&#x7684;&#x653E;&#x5927;&#x52A8;&#x753B;&#xFF0C;&#x8FD9;&#x91CC;&#x5FC5;&#x987B;&#x8981;&#x5F97;&#x5230;&#x4E24;&#x4E2A;&#x754C;&#x9762;&#x7684;&#x63A7;&#x4EF6;&#x7684;&#x5BBD;&#x9AD8;&#x4E0E;&#x63A7;&#x4EF6;&#x5185;&#x56FE;&#x7247;&#x7684;&#x5BBD;&#x9AD8;&#x3002;&#x518D;&#x8BA1;&#x7B97;&#x51FA;&#x9700;&#x8981;&#x7F29;&#x653E;&#x7684;&#x6BD4;&#x4F8B;&#x3002;</p>\n<blockquote>\n<p>&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x662F;&#x5BF9;&#x56FE;&#x7247;&#x63A7;&#x4EF6;&#x8FDB;&#x884C;&#x5171;&#x4EAB;&#x52A8;&#x753B;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x7B80;&#x5355;&#x7684;TextView&#x4E4B;&#x7C7B;&#x7684;&#x63A7;&#x4EF6;&#x5C31;&#x53EA;&#x9700;&#x83B7;&#x53D6;&#x63A7;&#x4EF6;&#x7684;&#x5BBD;&#x9AD8;&#xFF0C;&#x76F8;&#x4FE1;&#x5BA2;&#x5B98;&#x4EEC;&#x770B;&#x4E86;&#x4E0B;&#x9762;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6848;&#x4E5F;&#x80FD;&#x8FC5;&#x901F;&#x5E94;&#x5BF9;&#x5176;&#x5B83;&#x63A7;&#x4EF6;&#x7684;&#x7C7B;&#x578B;&#x3002;</p>\n</blockquote>\n<p>&#x6709;&#x7684;&#x5BA2;&#x5B98;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x6240;&#x7591;&#x95EE;&#xFF0C;<code>&#x4E3A;&#x4F55;&#x8981;&#x83B7;&#x53D6;&#x56FE;&#x7247;&#x7684;&#x5BBD;&#x9AD8;&#x5462;&#xFF0C;&#x56FE;&#x7247;&#x7684;&#x5BBD;&#x9AD8;&#x4E0D;&#x5C31;&#x7B49;&#x4E8E;&#x63A7;&#x4EF6;&#x7684;&#x5BBD;&#x9AD8;&#x5417;&#xFF1F;</code>&#x662F;&#x7684;&#xFF0C;&#x5BF9;&#x4E8E;&#x7EDD;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x6765;&#x8BF4;&#x786E;&#x5B9E;&#x662F;&#x5982;&#x6B64;&#xFF0C;&#x4F46;&#x6709;&#x7684;&#x65F6;&#x5019;&#x63A7;&#x4EF6;&#x7684;&#x5BBD;&#x9AD8;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x7B49;&#x4E8E;&#x56FE;&#x7247;&#x7684;&#x5BBD;&#x9AD8;&#xFF0C;&#x4F8B;&#x5982;&#x5927;&#x56FE;&#x6D4F;&#x89C8;&#x6A21;&#x5F0F;&#x4E0B;&#x7684;&#x56FE;&#x7247;&#x3002;&#x5982;&#x679C;&#x6B64;&#x65F6;&#x4F7F;&#x7528;&#x63A7;&#x4EF6;&#x7684;&#x5BBD;&#x9AD8;&#x6765;&#x8BA1;&#x7B97;&#x7F29;&#x653E;&#x6BD4;&#x4F8B;&#xFF0C;&#x81EA;&#x7136;&#x5F97;&#x4E0D;&#x5230;&#x9884;&#x60F3;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x56FE;&#x7247;&#x7F29;&#x653E;&#x7684;&#x6548;&#x679C;&#x5FC5;&#x7136;&#x4F1A;&#x4E0D;&#x51C6;&#x786E;&#x3002;&#x5176;&#x5B9E;&#x672C;&#x8D28;&#x662F;&#x6211;&#x4EEC;&#x8981;<code>&#x8131;&#x79BB;&#x63A7;&#x4EF6;&#xFF0C;&#x5173;&#x6CE8;&#x672C;&#x8D28;---&#x56FE;&#x7247;&#x6548;&#x679C;</code>&#x3002;</p>\n<p>&#x8BF4;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x5BA2;&#x5B98;&#x4EEC;&#x53EF;&#x80FD;&#x6709;&#x70B9;&#x4E0D;&#x8010;&#x70E6;&#x4E86;&#xFF0C;&#x5F00;&#x59CB;<code>show me the code</code>&#x3002;</p>\n<h3 id=\"&#x83B7;&#x53D6;&#x63A7;&#x4EF6;&#x7684;&#x76F8;&#x5173;&#x53C2;&#x6570;\"><a href=\"#&#x83B7;&#x53D6;&#x63A7;&#x4EF6;&#x7684;&#x76F8;&#x5173;&#x53C2;&#x6570;\" class=\"headerlink\" title=\"&#x83B7;&#x53D6;&#x63A7;&#x4EF6;&#x7684;&#x76F8;&#x5173;&#x53C2;&#x6570;\"></a>&#x83B7;&#x53D6;&#x63A7;&#x4EF6;&#x7684;&#x76F8;&#x5173;&#x53C2;&#x6570;</h3><p>&#x63A7;&#x4EF6;&#x7684;&#x5BBD;&#x9AD8;&#x83B7;&#x53D6;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#x3002;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x6765;&#x601D;&#x8003;&#x56FE;&#x7247;&#x5728;&#x63A7;&#x4EF6;&#x4E2D;&#x663E;&#x793A;&#x7684;&#x771F;&#x5B9E;&#x5BBD;&#x9AD8;&#x3002;&#x770B;&#x4E0B;&#x9762;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void convertOriginalInfo(ImageView oriView) {</span><br><span class=\"line\">        if (oriView == null || oriView.getDrawable() == null) {</span><br><span class=\"line\">            throw new NullPointerException(&quot;original ImageView or ImageView drawable must not null&quot;);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        //get original ImageView info        </span><br><span class=\"line\">        oriView.getImageMatrix().getValues(mOriginalValues);</span><br><span class=\"line\">        Rect oriRect = oriView.getDrawable().getBounds();</span><br><span class=\"line\">        mOriginalWidth = (int) (oriRect.width() * mOriginalValues[Matrix.MSCALE_X]);</span><br><span class=\"line\">        mOriginalHeight = (int) (oriRect.height() * mOriginalValues[Matrix.MSCALE_Y]);</span><br><span class=\"line\">        mOriginalViewWidth = oriView.getWidth();</span><br><span class=\"line\">        mOriginalViewHeight = oriView.getHeight();</span><br><span class=\"line\">        oriView.getLocationOnScreen(mOriginalLocation);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<h4 id=\"Matrix\"><a href=\"#Matrix\" class=\"headerlink\" title=\"Matrix\"></a>Matrix</h4><p>&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x77E5;&#x8BC6;&#x70B9;&#xFF0C;&#x6BCF;&#x4E00;&#x5F20;&#x56FE;&#x7247;&#x90FD;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x4E00;&#x4E2A;<code>Matrix</code>&#xFF0C;&#x5B83;&#x4EE3;&#x8868;&#x7684;&#x662F;&#x4E00;&#x4E2A;<code>3*3</code>&#x7684;&#x77E9;&#x9635;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x56FE;&#x7247;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#xFF0C;&#x4F8B;&#x5982;&#x7F29;&#x653E;&#xFF0C;&#x5E73;&#x79FB;&#x3002;</p>\n<blockquote>\n<p>&#x8FD9;&#x91CC;&#x662F;ImageVIew&#x4E2D;&#x7684;ImageMatrix&#x800C;&#x4E0D;&#x662F;View&#x4E2D;&#x7684;Matrix&#xFF0C;&#x5177;&#x4F53;&#x7684;Matrix&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x81EA;&#x884C;google</p>\n</blockquote>\n<p>&#x901A;&#x8FC7;<code>Matrix</code>&#x7684;<code>getValues</code>&#x65B9;&#x6CD5;&#x5C06;<code>3*3</code>&#x7684;&#x77E9;&#x5F62;&#x503C;&#x8F6C;&#x5316;&#x6210;&#x4E00;&#x4E2A;&#x5927;&#x5C0F;&#x4E3A;9&#x7684;<code>float</code>&#x578B;&#x6570;&#x7EC4;<code>mOriginalValues</code>&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<code>Matrix.MSCALE_X</code>&#x4E0E;<code>Matrix.MSCALE_Y</code>&#x5206;&#x522B;&#x83B7;&#x53D6;&#x56FE;&#x7247;&#x7684;<code>x</code>&#x4E0E;<code>y</code>&#x65B9;&#x5411;&#x7684;&#x7F29;&#x653E;&#x6BD4;&#x4F8B;&#x3002;&#x518D;&#x901A;&#x8FC7;<code>ImageView</code>&#x7684;<code>getDrawable.getBounds</code>&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x56FE;&#x7247;&#x539F;&#x59CB;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x3002;&#x6700;&#x540E;&#x4E58;&#x4EE5;&#x6BD4;&#x4F8B;&#x7CFB;&#x6570;&#xFF0C;&#x83B7;&#x53D6;&#x5230;&#x6211;&#x4EEC;&#x6240;&#x8981;&#x7684;&#x7ED3;&#x679C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//calculator scale</span><br><span class=\"line\">mScaleX = (float) mOriginalWidth / mTargetWidth;</span><br><span class=\"line\">mScaleY = (float) mOriginalHeight / mTargetHeight;</span><br></pre></td></tr></table></figure>\n<p>&#x65E2;&#x7136;&#x8BF4;&#x5230;<code>Matrix</code>&#xFF0C;&#x5C31;&#x518D;&#x7B80;&#x5355;&#x8BF4;&#x4E0B;&#x5B83;&#x7684;&#x4E24;&#x4E2A;&#x503C;&#xFF0C;<code>Matrix.MTRANS_X</code>&#x4E0E;<code>Matrix.MTRANS_Y</code>&#x5206;&#x522B;&#x4EE3;&#x8868;&#x56FE;&#x7247;&#x5E73;&#x79FB;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x7C7B;&#x4F3C;&#x4E0E;&#x5FAE;&#x4FE1;&#x670B;&#x53CB;&#x5708;&#x4E2D;&#x7684;&#x5927;&#x56FE;&#x6D4F;&#x89C8;&#x7684;&#x4E0B;&#x6ED1;&#x5E73;&#x79FB;&#x7F29;&#x653E;&#x9000;&#x51FA;&#x6548;&#x679C;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x4E24;&#x4E2A;&#x503C;&#x6765;&#x83B7;&#x53D6;&#x56FE;&#x7247;&#x5728;&#x7F29;&#x653E;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x5E73;&#x79FB;&#x91CF;&#x3002;</p>\n<h4 id=\"getLocationOnScreen\"><a href=\"#getLocationOnScreen\" class=\"headerlink\" title=\"getLocationOnScreen\"></a>getLocationOnScreen</h4><p>&#x8BE5;&#x65B9;&#x6CD5;&#x80FD;&#x591F;&#x76F4;&#x63A5;&#x83B7;&#x53D6;&#x5230;&#x63A7;&#x4EF6;&#x5DE6;&#x4E0A;&#x89D2;&#x5728;&#x5C4F;&#x5E55;&#x4E0A;&#x7684;&#x5750;&#x6807;&#x4F4D;&#x7F6E;&#x3002;&#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5927;&#x5C0F;&#x4E3A;2&#x7684;&#x6570;&#x7EC4;&#x3002;&#x6709;&#x4E2A;&#x8BE5;&#x65B9;&#x6CD5;&#x6211;&#x4EEC;&#x5C31;&#x80FD;&#x65B9;&#x4FBF;&#x7684;&#x83B7;&#x53D6;&#x63A7;&#x4EF6;&#x7684;&#x4E2D;&#x5FC3;&#x5750;&#x6807;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//calculator pivot position</span><br><span class=\"line\">mPivotX = mTargetLocation[0] + mTargetValues[Matrix.MTRANS_X] + mTargetWidth / 2;</span><br><span class=\"line\">mPivotY = mTargetLocation[1] + mTargetValues[Matrix.MTRANS_Y] + mTargetHeight / 2;</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;<code>mTargetLocation[0]</code>&#x4EE3;&#x8868;&#x63A7;&#x4EF6;&#x7684;&#x5728;&#x5C4F;&#x5E55;&#x4E0A;&#x7684;<code>x</code>&#x5750;&#x6807;&#x4F4D;&#x7F6E;&#xFF0C;<code>mTargetLocation[1]</code>&#x4EE3;&#x8868;&#x63A7;&#x4EF6;&#x5728;&#x5C4F;&#x5E55;&#x4E0A;&#x7684;<code>y</code>&#x5750;&#x6807;&#x4F4D;&#x7F6E;&#x3002;</p>\n<blockquote>\n<p>&#x540E;&#x7EED;&#x8FDB;&#x884C;&#x7F29;&#x653E;&#x5E73;&#x79FB;&#x52A8;&#x753B;&#x9700;&#x8981;&#x786E;&#x5B9A;&#x4E2D;&#x5FC3;&#x4F4D;&#x7F6E;&#xFF0C;&#x7531;&#x4E8E;&#x8981;&#x8FBE;&#x5230;&#x5BF9;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x7F29;&#x653E;&#x5E73;&#x79FB;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x5F97;&#x5230;&#x56FE;&#x7247;&#x7684;&#x786E;&#x5207;&#x4E2D;&#x5FC3;&#x4F4D;&#x7F6E;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;&#x63A7;&#x4EF6;&#x7684;&#x4E2D;&#x5FC3;</p>\n</blockquote>\n<h4 id=\"&#x5E73;&#x79FB;&#x504F;&#x79FB;&#x91CF;\"><a href=\"#&#x5E73;&#x79FB;&#x504F;&#x79FB;&#x91CF;\" class=\"headerlink\" title=\"&#x5E73;&#x79FB;&#x504F;&#x79FB;&#x91CF;\"></a>&#x5E73;&#x79FB;&#x504F;&#x79FB;&#x91CF;</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mCenterOffsetX = (int) (mOriginalLocation[0] + mOriginalValues[Matrix.MTRANS_X] + mOriginalViewWidth / 2</span><br><span class=\"line\">                - mTargetLocation[0] - mTargetValues[Matrix.MTRANS_X] - mTargetViewWidth / 2);</span><br><span class=\"line\">mCenterOffsetY = (int) (mOriginalLocation[1] + mOriginalValues[Matrix.MTRANS_Y] + mOriginalViewHeight / 2</span><br><span class=\"line\">                - CommonUtils.getStatusBarHeight(context) - mTargetLocation[1] - mTargetValues[Matrix.MTRANS_Y] - mTargetViewHeight / 2);</span><br></pre></td></tr></table></figure>\n<p>&#x7ECF;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x89E3;&#x91CA;&#x8BF4;&#x660E;&#xFF0C;&#x5BA2;&#x5B98;&#x4EEC;&#x5BF9;&#x5E73;&#x79FB;&#x91CF;&#x7684;&#x8BA1;&#x7B97;&#x5E94;&#x8BE5;&#x4E0D;&#x96BE;&#x7406;&#x89E3;&#x3002;&#x6838;&#x5FC3;&#x662F;&#x5BF9;&#x4E2D;&#x5FC3;&#x4F4D;&#x7F6E;&#x8FDB;&#x884C;&#x504F;&#x79FB;&#x91CF;&#x8BA1;&#x7B97;&#x3002;</p>\n<h3 id=\"&#x8FDB;&#x5165;&#x52A8;&#x753B;\"><a href=\"#&#x8FDB;&#x5165;&#x52A8;&#x753B;\" class=\"headerlink\" title=\"&#x8FDB;&#x5165;&#x52A8;&#x753B;\"></a>&#x8FDB;&#x5165;&#x52A8;&#x753B;</h3><p>&#x9996;&#x5148;&#x8981;&#x786E;&#x8BA4;&#x63A7;&#x4EF6;&#x52A8;&#x753B;&#x7684;&#x8C03;&#x7528;&#x65F6;&#x673A;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x5728;&#x63A7;&#x4EF6;&#x7ED8;&#x5236;&#x7684;&#x65F6;&#x5019;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#xFF0C;&#x53EA;&#x6709;&#x8FD9;&#x6837;&#x624D;&#x80FD;&#x6700;&#x65E9;&#x7684;&#x83B7;&#x53D6;&#x63A7;&#x4EF6;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#xFF0C;&#x4E3A;&#x52A8;&#x753B;&#x8FDB;&#x884C;&#x51C6;&#x5907;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x6CE8;&#x518C;<code>addOnPreDrawListener</code>&#x8FDB;&#x884C;&#x76D1;&#x542C;&#x63A7;&#x4EF6;&#x7684;&#x7ED8;&#x5236;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public FKJShareElement convert(final ImageView tarView) {</span><br><span class=\"line\">        if (mInfo == null) {</span><br><span class=\"line\">            throw new NullPointerException(&quot;ShareElementInfo must not null&quot;);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        tarView.getViewTreeObserver().addOnPreDrawListener(new ViewTreeObserver.OnPreDrawListener() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public boolean onPreDraw() {</span><br><span class=\"line\">                tarView.getViewTreeObserver().removeOnPreDrawListener(this);</span><br><span class=\"line\">                mInfo.convertTargetInfo(tarView, mContext);</span><br><span class=\"line\">                //init</span><br><span class=\"line\">                if (mEnter) {</span><br><span class=\"line\">                    tarView.setPivotX(mInfo.getPivotX());</span><br><span class=\"line\">                    tarView.setPivotY(mInfo.getPivotY());</span><br><span class=\"line\">                    tarView.setTranslationX(mInfo.getCenterOffsetX());</span><br><span class=\"line\">                    tarView.setTranslationY(mInfo.getCenterOffsetY());</span><br><span class=\"line\">                    tarView.setScaleX(mInfo.getScaleX());</span><br><span class=\"line\">                    tarView.setScaleY(mInfo.getScaleY());</span><br><span class=\"line\">                    mAnimator = tarView.animate();</span><br><span class=\"line\">                    start();</span><br><span class=\"line\">                    startBackgroundAlphaAnimation(mBgView, new ColorDrawable(ContextCompat.getColor(mContext, R.color.fkj_white)));</span><br><span class=\"line\">                }</span><br><span class=\"line\">                return true;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        });</span><br><span class=\"line\">        return this;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x4E8E;&#x8FDB;&#x5165;&#x52A8;&#x753B;&#xFF0C;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x539F;&#x7406;&#x5206;&#x6790;&#x4E2D;&#x5DF2;&#x7ECF;&#x6307;&#x51FA;&#xFF0C;&#x8981;&#x5148;&#x5C06;&#x7B2C;&#x4E8C;&#x4E2A;&#x754C;&#x9762;&#x7684;&#x63A7;&#x4EF6;&#x7F29;&#x653E;&#x5230;&#x7B2C;&#x4E00;&#x4E2A;&#x754C;&#x9762;&#x7684;&#x4F4D;&#x7F6E;&#x4E0A;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x5148;&#x5BF9;&#x63A7;&#x4EF6;&#x8FDB;&#x884C;&#x7F29;&#x653E;&#x5E73;&#x79FB;&#xFF0C;&#x4F7F;&#x7528;<code>View</code>&#x7684;<code>setTranslationX</code>&#x7B49;&#x65B9;&#x6CD5;&#x3002;&#x65B9;&#x6CD5;&#x4E2D;&#x7684;<code>mInfo</code>&#x4FDD;&#x5B58;&#x4E86;&#x4E0A;&#x9762;&#x83B7;&#x53D6;&#x7684;&#x56FE;&#x7247;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x3002;&#x771F;&#x6B63;&#x7684;&#x52A8;&#x753B;&#x6267;&#x884C;&#x662F;&#x5728;<code>start</code>&#x4E2D;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#x3002;&#x76EE;&#x7684;&#x662F;&#x6267;&#x884C;&#x63A7;&#x4EF6;&#x7684;&#x8FD8;&#x539F;&#x52A8;&#x753B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void start() {</span><br><span class=\"line\">    mAnimator.setDuration(mDuration)</span><br><span class=\"line\">            .scaleX(1.0f)</span><br><span class=\"line\">            .scaleY(1.0f)</span><br><span class=\"line\">            .translationX(0)</span><br><span class=\"line\">            .translationY(0);</span><br><span class=\"line\">    if (mListener != null) {</span><br><span class=\"line\">        mAnimator.setListener(mListener);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    if (mInterpolator != null) {</span><br><span class=\"line\">        mAnimator.setInterpolator(mInterpolator);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    mAnimator.start();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x9000;&#x51FA;&#x52A8;&#x753B;\"><a href=\"#&#x9000;&#x51FA;&#x52A8;&#x753B;\" class=\"headerlink\" title=\"&#x9000;&#x51FA;&#x52A8;&#x753B;\"></a>&#x9000;&#x51FA;&#x52A8;&#x753B;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void startExitAnimator() {</span><br><span class=\"line\">    mEnter = false;</span><br><span class=\"line\">    mAnimator.setDuration(mDuration)</span><br><span class=\"line\">            .scaleX(mInfo.getScaleX())</span><br><span class=\"line\">            .scaleY(mInfo.getScaleY())</span><br><span class=\"line\">            .translationX(mInfo.getCenterOffsetX())</span><br><span class=\"line\">            .translationY(mInfo.getCenterOffsetY());</span><br><span class=\"line\">    if (mListener != null) {</span><br><span class=\"line\">        mAnimator.setListener(mListener);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    if (mInterpolator != null) {</span><br><span class=\"line\">        mAnimator.setInterpolator(mInterpolator);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    mAnimator.start();</span><br><span class=\"line\">    startBackgroundAlphaAnimation(mBgView, new ColorDrawable(ContextCompat.getColor(mContext, R.color.fkj_white)), 255, 0);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x9000;&#x51FA;&#x52A8;&#x753B;&#x5C31;&#x76F8;&#x5BF9;&#x7B80;&#x5355;&#x4E00;&#x70B9;&#xFF0C;&#x53EA;&#x9700;&#x5C06;&#x7B2C;&#x4E8C;&#x4E2A;&#x754C;&#x9762;&#x7684;&#x63A7;&#x4EF6;&#x7F29;&#x653E;&#x5E73;&#x79FB;&#x5230;&#x7B2C;&#x4E00;&#x4E2A;&#x754C;&#x9762;&#x63A7;&#x4EF6;&#x7684;&#x4F4D;&#x7F6E;&#x4E0A;&#x5373;&#x53EF;&#x3002;</p>\n<h3 id=\"&#x754C;&#x9762;&#x8FC7;&#x5EA6;&#x52A8;&#x753B;\"><a href=\"#&#x754C;&#x9762;&#x8FC7;&#x5EA6;&#x52A8;&#x753B;\" class=\"headerlink\" title=\"&#x754C;&#x9762;&#x8FC7;&#x5EA6;&#x52A8;&#x753B;\"></a>&#x754C;&#x9762;&#x8FC7;&#x5EA6;&#x52A8;&#x753B;</h3><p>&#x5728;&#x8FDB;&#x5165;&#x4E0E;&#x9000;&#x51FA;&#x52A8;&#x753B;&#x4E2D;&#x90FD;&#x8C03;&#x7528;&#x4E86;<code>startBackgroundAlphaAnimation</code>&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x5BF9;&#x754C;&#x9762;&#x8FDB;&#x884C;&#x900F;&#x660E;&#x6E10;&#x53D8;&#x3002;&#x539F;&#x7406;&#x4E5F;&#x7B80;&#x5355;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x5BF9;&#x7B2C;&#x4E8C;&#x4E2A;&#x754C;&#x9762;&#x7684;&#x80CC;&#x666F;<code>View</code>&#x8FDB;&#x884C;&#x80CC;&#x666F;&#x6E10;&#x53D8;&#xFF0C;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void startBackgroundAlphaAnimation(final View bgView, final ColorDrawable colorDrawable, int... value) {</span><br><span class=\"line\">        if (bgView == null)</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        if (value == null || value.length == 0) {</span><br><span class=\"line\">            value = new int[]{0, 255};</span><br><span class=\"line\">        }</span><br><span class=\"line\">        ObjectAnimator animator = ObjectAnimator.ofInt(colorDrawable, &quot;alpha&quot;, value);</span><br><span class=\"line\">        animator.setDuration(mDuration);</span><br><span class=\"line\">        animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onAnimationUpdate(ValueAnimator animation) {</span><br><span class=\"line\">                bgView.setBackground(colorDrawable);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        });</span><br><span class=\"line\">        animator.start();</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x4EE5;&#x4E0A;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x900F;&#x660E;&#x52A8;&#x753B;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x4E0D;&#x8FC7;&#x76F4;&#x63A5;&#x8FD9;&#x6837;&#x8C03;&#x7528;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x6548;&#x679C;&#x4E0D;&#x5BF9;&#xFF0C;&#x56E0;&#x4E3A;&#x4F60;&#x8FD8;&#x9700;&#x8981;&#x5C06;Activity&#x7684;theme&#x8BBE;&#x7F6E;&#x4E3A;&#x900F;&#x660E;&#x6548;&#x679C;&#x3002;&#x53EA;&#x9700;&#x5C06;android:windowBackgroun&#x8BBE;&#x7F6E;&#x4E3A;&#x900F;&#x660E;&#x5373;&#x53EF;</p>\n</blockquote>\n<h1 id=\"&#x6536;&#x5272;\"><a href=\"#&#x6536;&#x5272;\" class=\"headerlink\" title=\"&#x6536;&#x5272;\"></a>&#x6536;&#x5272;</h1><p>&#x4E0D;&#x77E5;&#x9053;&#x575A;&#x6301;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x7684;&#x5BA2;&#x5B98;&#x6709;&#x591A;&#x5C11;&#xFF0C;&#x5148;&#x5728;&#x8FD9;&#x91CC;&#x8C22;&#x8C22;&#x5BA2;&#x5B98;&#x4EEC;&#x7684;&#x652F;&#x6301;&#x3002;&#x6700;&#x540E;&#x5C06;&#x4E24;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x7ED3;&#x5408;&#x4E00;&#x8D77;&#x7075;&#x6D3B;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x5728;<code>Android 5.0</code>&#x4EE5;&#x4E0A;&#x8C03;&#x7528;&#x7CFB;&#x7EDF;&#x65B9;&#x6CD5;&#xFF0C;<code>Android 5.0</code>&#x4EE5;&#x4E0B;&#x8C03;&#x7528;&#x5C01;&#x88C5;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5927;&#x6982;&#x6B65;&#x9AA4;&#x5982;&#x4E0B;&#xFF1A;</p>\n<h2 id=\"&#x5F15;&#x5165;&#x4F9D;&#x8D56;\"><a href=\"#&#x5F15;&#x5165;&#x4F9D;&#x8D56;\" class=\"headerlink\" title=\"&#x5F15;&#x5165;&#x4F9D;&#x8D56;\"></a>&#x5F15;&#x5165;&#x4F9D;&#x8D56;</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">   compile &apos;com.idisfkj.share:sharelibrary:1.0.0&apos;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x6267;&#x884C;&#x754C;&#x9762;\"><a href=\"#&#x6267;&#x884C;&#x754C;&#x9762;\" class=\"headerlink\" title=\"&#x6267;&#x884C;&#x754C;&#x9762;\"></a>&#x6267;&#x884C;&#x754C;&#x9762;</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">imageView.setOnClickListener(new View.OnClickListener() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onClick(View v) {</span><br><span class=\"line\">                Intent intent = new Intent(MainActivity.this, ShareElementActivity.class);</span><br><span class=\"line\">                if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {</span><br><span class=\"line\">                    imageView.setTransitionName(TRANSITION_NAME_SHARE);</span><br><span class=\"line\">                    ActivityOptionsCompat compat = ActivityOptionsCompat.makeSceneTransitionAnimation(MainActivity.this, imageView, TRANSITION_NAME_SHARE);</span><br><span class=\"line\">                    startActivity(intent, compat.toBundle());</span><br><span class=\"line\">                } else {</span><br><span class=\"line\">                    ShareElementInfo info = new ShareElementInfo();</span><br><span class=\"line\">                    info.convertOriginalInfo(imageView);</span><br><span class=\"line\">                    intent.putExtra(EXTRA_SHARE_ELEMENT_INFO, info);</span><br><span class=\"line\">                    startActivity(intent);</span><br><span class=\"line\">                    overridePendingTransition(0, 0);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        });</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x54CD;&#x5E94;&#x754C;&#x9762;\"><a href=\"#&#x54CD;&#x5E94;&#x754C;&#x9762;\" class=\"headerlink\" title=\"&#x54CD;&#x5E94;&#x754C;&#x9762;\"></a>&#x54CD;&#x5E94;&#x754C;&#x9762;</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {</span><br><span class=\"line\">    mImageView.setTransitionName(MainActivity.TRANSITION_NAME_SHARE);</span><br><span class=\"line\">} else {</span><br><span class=\"line\">   ShareElementInfo info = getIntent().getExtras().getParcelable(MainActivity.EXTRA_SHARE_ELEMENT_INFO);</span><br><span class=\"line\">   mShareElement = new FKJShareElement(info, this, mImageView.getRootView());</span><br><span class=\"line\">   mShareElement.convert(mImageView)</span><br><span class=\"line\">           .setDuration(ANIMATOR_DURATION)</span><br><span class=\"line\">           .setInterpolator(new LinearInterpolator())</span><br><span class=\"line\">           .startEnterAnimator();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">public void onBackPressed() {</span><br><span class=\"line\">    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {</span><br><span class=\"line\">        finishAfterTransition();</span><br><span class=\"line\">    } else {</span><br><span class=\"line\">        mShareElement.convert(mImageView)</span><br><span class=\"line\">                .setDuration(ANIMATOR_DURATION)</span><br><span class=\"line\">                .setInterpolator(new LinearInterpolator())</span><br><span class=\"line\">                .setListener(new AnimatorListenerAdapter() {</span><br><span class=\"line\">                    @Override</span><br><span class=\"line\">                    public void onAnimationEnd(Animator animation) {</span><br><span class=\"line\">                        finish();</span><br><span class=\"line\">                        overridePendingTransition(0, 0);</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                })</span><br><span class=\"line\">                .startExitAnimator();</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h1 id=\"&#x9547;&#x6587;&#x4E4B;&#x5B9D;\"><a href=\"#&#x9547;&#x6587;&#x4E4B;&#x5B9D;\" class=\"headerlink\" title=\"&#x9547;&#x6587;&#x4E4B;&#x5B9D;\"></a>&#x9547;&#x6587;&#x4E4B;&#x5B9D;</h1><p><img src=\"/2017/07/16/Android&#x5171;&#x4EAB;&#x52A8;&#x753B;&#x517C;&#x5BB9;&#x5B9E;&#x73B0;/share2.gif\" alt=\"&#x6548;&#x679C;&#x56FE;\"><br><img src=\"/2017/07/16/Android&#x5171;&#x4EAB;&#x52A8;&#x753B;&#x517C;&#x5BB9;&#x5B9E;&#x73B0;/share3.gif\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p><a href=\"https://github.com/idisfkj/AndroidShareElement\" target=\"_blank\" rel=\"noopener\">demo&#x5730;&#x5740;</a></p>\n<blockquote>\n<p>&#x540E;&#x7EED;&#x8FD8;&#x4F1A;&#x7EE7;&#x7EED;&#x6301;&#x7EED;&#x66F4;&#x65B0;&#xFF0C;&#x5982;&#x679C;&#x5BA2;&#x5B98;&#x4EEC;&#x5BF9;&#x6B64;&#x8FD8;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x8BDD;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x6211;&#x7684;&#x535A;&#x5BA2;&#x6216;&#x8005;Github&#xFF0C;&#x8C22;&#x8C22;&#x652F;&#x6301;&#x3002;</p>\n</blockquote>\n","categories":["animation"],"tags":["android"]},{"title":"一个loading动画的全面解析","url":"https://www.rousetime.com/2017/03/12/一个loading动画的全面解析/","content":"<h2 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h2><p>&#x4ECA;&#x5929;&#x6765;&#x804A;&#x804A;&#x5173;&#x4E8E;&#x52A8;&#x753B;&#x7684;&#x4E00;&#x70B9;&#x81EA;&#x5DF1;&#x7684;&#x5FC3;&#x5F97;&#xFF0C;&#x5728;&#x6B64;&#x5BF9;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x5730;&#x65B9;&#x505A;&#x4E0B;&#x603B;&#x7ED3;&#xFF0C;&#x4E5F;&#x5E0C;&#x671B;&#x5E2E;&#x52A9;&#x5927;&#x5BB6;&#x5C11;&#x8D70;&#x4E00;&#x70B9;&#x5F2F;&#x8DEF;&#x3002;&#x5148;&#x6765;&#x770B;&#x4E0B;&#x4ECA;&#x5929;&#x7684;&#x52A8;&#x753B;&#x6548;&#x679C;&#x5427;&#x3002;</p>\n<p><img src=\"/2017/03/12/&#x4E00;&#x4E2A;loading&#x52A8;&#x753B;&#x7684;&#x5168;&#x9762;&#x89E3;&#x6790;/loading.gif\" alt=\"loading\"></p>\n<p>&#x770B;&#x8D77;&#x6765;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x7279;&#x522B;&#x70AB;&#x7684;&#x52A8;&#x753B;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E0D;&#x662F;&#x4ECA;&#x5929;&#x6B63;&#x5728;&#x7684;&#x4E3B;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x771F;&#x6B63;&#x8981;&#x8BA4;&#x8BC6;&#x7684;&#x662F;&#x52A8;&#x753B;&#x5B9E;&#x73B0;&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x76F8;&#x5BF9;&#x8F83;&#x7B80;&#x6D01;&#x7684;&#x52A8;&#x753B;&#xFF0C;&#x6765;&#x4E3E;&#x4E00;&#x53CD;&#x4E09;&#xFF0C;&#x4EE5;&#x540E;&#x7C7B;&#x4F3C;&#x7684;&#x52A8;&#x753B;&#x4E5F;&#x4E0D;&#x6210;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x4E86;&#x3002;</p>\n<h2 id=\"&#x601D;&#x8DEF;&#x62C6;&#x5206;\"><a href=\"#&#x601D;&#x8DEF;&#x62C6;&#x5206;\" class=\"headerlink\" title=\"&#x601D;&#x8DEF;&#x62C6;&#x5206;\"></a>&#x601D;&#x8DEF;&#x62C6;&#x5206;</h2><p>&#x9996;&#x5148;&#x7B2C;&#x4E00;&#x773C;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x52A8;&#x753B;&#xFF0C;&#x4F60;&#x8111;&#x6D77;&#x91CC;&#x60F3;&#x7684;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x53EF;&#x80FD;&#x6709;&#x4E9B;<code>people</code>&#x4F1A;&#x8BF4;&#x4E00;&#x4E2A;<code>gif</code>&#x56FE;&#x5C31;&#x80FD;&#x7B80;&#x5355;&#x7684;&#x89E3;&#x51B3;&#x3002;&#x662F;&#x7684;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x4E00;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF0C;&#x4F46;&#x505A;&#x4E3A;&#x4E00;&#x4E2A;&#x5BF9;&#x4E8E;&#x6280;&#x672F;&#x7684;&#x8FFD;&#x6C42;&#x8005;&#xFF0C;&#x6211;&#x8FD8;&#x662F;&#x8BA4;&#x4E3A;&#x5E94;&#x8BE5;&#x81EA;&#x5DF1;&#x901A;&#x8FC7;&#x539F;&#x751F;&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x6837;&#x5BF9;&#x81EA;&#x5DF1;&#x4E5F;&#x662F;&#x4E00;&#x79CD;&#x5F88;&#x5927;&#x63D0;&#x5347;&#x3002;&#x597D;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x5BF9;&#x8FD9;&#x52A8;&#x753B;&#x8FDB;&#x884C;&#x62C6;&#x5206;&#xFF0C;&#x5BF9;&#x95EE;&#x9898;&#x8FDB;&#x884C;&#x62C6;&#x5206;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x6709;&#x6548;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5B83;&#x80FD;&#x8BA9;&#x6211;&#x4EEC;&#x7684;&#x601D;&#x8DEF;&#x6E05;&#x6670;&#xFF0C;&#x4ECE;&#x800C;&#x6DF1;&#x523B;&#x7684;&#x8BA4;&#x8BC6;&#x5230;&#x95EE;&#x9898;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x5F0F;&#x3002;&#x901A;&#x8FC7;&#x4ED4;&#x7EC6;&#x7684;&#x89C2;&#x5BDF;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x52A8;&#x753B;&#x62C6;&#x9664;&#x56DB;&#x90E8;&#x5206;</p>\n<ul>\n<li>&#x5148;&#x753B;&#x5706;&#x5F27;</li>\n<li>&#x5728;&#x753B;&#x5706;&#x5F27;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5BF9;&#x4E2D;&#x5FC3;&#x90E8;&#x5206;&#x7F29;&#x653E;&#x900F;&#x660E;</li>\n<li>&#x5706;&#x5F27;&#x753B;&#x5B8C;&#x4E4B;&#x540E;&#x6709;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x505C;&#x987F;&#x5F62;&#x6210;&#x5B8C;&#x6574;&#x7684;&#x5706;</li>\n<li>&#x6700;&#x540E;&#x5728;&#x505C;&#x987F;&#x7684;&#x65F6;&#x523B;&#x518D;&#x5BF9;&#x4E2D;&#x5FC3;&#x90E8;&#x5206;&#x653E;&#x5927;&#x900F;&#x660E;</li>\n</ul>\n<p>&#x4EE5;&#x4E0A;&#x662F;&#x52A8;&#x753B;&#x7684;&#x62C6;&#x5206;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5BF9;&#x52A8;&#x753B;&#x6709;&#x4E86;&#x6E05;&#x6670;&#x7684;&#x4E86;&#x89E3;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53C8;&#x53EF;&#x4EE5;&#x5BF9;&#x5B9E;&#x73B0;&#x7684;&#x52A8;&#x753B;&#x90E8;&#x5206;&#x8FDB;&#x884C;&#x62C6;&#x5206;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x5230;&#xFF0C;&#x5176;&#x5B9E;&#x6574;&#x4F53;&#x53EF;&#x4EE5;&#x770B;&#x6210;&#x4E24;&#x4E2A;&#x52A8;&#x753B;&#x7684;&#x5408;&#x6210;</p>\n<ul>\n<li>&#x5706;&#x5F27;&#x7684;&#x7ED8;&#x5236;&#xFF0C;&#x4E0E;&#x753B;&#x5B8C;&#x540E;&#x7684;&#x5706;&#x7684;&#x5B9A;&#x5F62;</li>\n<li>&#x4E2D;&#x5FC3;<code>Icon</code>&#x7684;&#x7F29;&#x653E;&#x3001;&#x653E;&#x5927;&#x4E0E;&#x900F;&#x660E;&#x53D8;&#x5316;</li>\n</ul>\n<p>&#x6240;&#x4EE5;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5BF9;&#x8FD9;&#x4E24;&#x5927;&#x90E8;&#x5206;&#x8FDB;&#x884C;&#x5206;&#x5E03;&#x5B9E;&#x73B0;</p>\n<h2 id=\"&#x5706;&#x5F27;&#x7684;&#x5B9E;&#x73B0;\"><a href=\"#&#x5706;&#x5F27;&#x7684;&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x5706;&#x5F27;&#x7684;&#x5B9E;&#x73B0;\"></a>&#x5706;&#x5F27;&#x7684;&#x5B9E;&#x73B0;</h2><p>&#x9996;&#x5148;&#x662F;&#x5BF9;&#x5706;&#x5F27;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x7ECF;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x5BF9;&#x5706;&#x5F27;&#x8FDB;&#x884C;&#x52A8;&#x6001;&#x7ED8;&#x5236;&#xFF0C;&#x5B8C;&#x6210;&#x5706;&#x540E;&#x8FDB;&#x884C;&#x6709;&#x9650;&#x65F6;&#x95F4;&#x7684;&#x5B9A;&#x5F62;&#xFF0C;&#x6700;&#x540E;&#x5C31;&#x662F;&#x5FAA;&#x73AF;&#x4EE5;&#x4E0A;&#x6B65;&#x9AA4;&#x800C;&#x5DF2;&#x3002;&#x9996;&#x5148;&#x81EA;&#x5B9A;&#x4E49;<code>LoadingCirclerView</code>&#x7EE7;&#x627F;&#x4E0E;<code>ImageView</code>&#x3002;&#x65E2;&#x7136;&#x8981;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x52A8;&#x753B;&#x7684;&#x7ED8;&#x5236;&#xFF0C;&#x81EA;&#x7136;&#x5C11;&#x4E0D;&#x4E86;&#x5BF9;<code>Paint</code>&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x9996;&#x5148;&#x521D;&#x59CB;&#x5316;&#x753B;&#x7B14;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void init() {</span><br><span class=\"line\">        mPaint = new Paint();</span><br><span class=\"line\">        mPaint.setColor(getResources().getColor(R.color.black));</span><br><span class=\"line\">        mPaint.setStyle(Paint.Style.STROKE);</span><br><span class=\"line\">        mPaint.setStrokeWidth(mCircleWidth);</span><br><span class=\"line\">        mPaint.setAntiAlias(true);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x4E8E;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x90FD;&#x8981;&#x5B9E;&#x73B0;<code>onMeasure</code>&#x4E0E;<code>onDraw</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x4E2D;<code>onMeasure</code>&#x65B9;&#x6CD5;&#x662F;&#x5BF9;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;<code>View</code>&#x7684;&#x5927;&#x5C0F;&#x8FDB;&#x884C;&#x4E00;&#x4E2A;&#x6D4B;&#x91CF;&#xFF0C;&#x800C;<code>onDraw</code>&#x65B9;&#x6CD5;&#x81EA;&#x7136;&#x5C31;&#x662F;&#x6838;&#x5FC3;&#x90E8;&#x5206;&#x7684;&#x7ED8;&#x5236;&#x903B;&#x8F91;&#x3002;&#x8FD9;&#x91CC;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x5728;<code>onDraw</code>&#x4E2D;&#x4E0D;&#x8981;&#x6765;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x4E0E;&#x5B9E;&#x73B0;&#x7531;&#x5EF6;&#x65F6;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x56E0;&#x4E3A;<code>onDraw</code>&#x662F;&#x975E;&#x5E38;&#x9891;&#x7E41;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x5176;&#x4E2D;&#x6709;&#x5BF9;&#x8C61;&#x7684;&#x521B;&#x5EFA;&#x4F1A;&#x52A0;&#x901F;&#x5E94;&#x7528;&#x7684;&#x5185;&#x5B58;&#x7684;&#x589E;&#x52A0;&#xFF0C;&#x5BFC;&#x81F4;<code>OOM</code>&#x3002;&#x6240;&#x4EE5;&#x5BF9;&#x4E8E;&#x4E0A;&#x9762;&#x7684;<code>Paint</code>&#x7684;&#x521D;&#x59CB;&#x5316;&#x90FD;&#x662F;&#x5355;&#x72EC;&#x62BD;&#x51FA;&#x6765;&#x3002;&#x4E0B;&#x9762;&#x6765;&#x770B;&#x4E0B;<code>onMeasure</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {</span><br><span class=\"line\">        int width = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class=\"line\">        int height = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class=\"line\">        int widthMode = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class=\"line\">        int heightMode = MeasureSpec.getMode(heightMeasureSpec);</span><br><span class=\"line\">        if (widthMode == MeasureSpec.EXACTLY) {</span><br><span class=\"line\">            mWidth = width;</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            mWidth = DisplayUtils.dip2px(DEFAULT_SIZE);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        if (heightMode == MeasureSpec.EXACTLY) {</span><br><span class=\"line\">            mHeight = height;</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            mHeight = DisplayUtils.dip2px(DEFAULT_SIZE);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        //&#x767E;&#x5206;&#x6BD4;&#x5F27;&#x77E9;&#x5F62;</span><br><span class=\"line\">        mRectF = new RectF(mCircleWidth, mCircleWidth, mWidth - mCircleWidth, mHeight - mCircleWidth);</span><br><span class=\"line\">        setMeasuredDimension(mWidth, mHeight);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x662F;&#x901A;&#x8FC7;&#x4E0D;&#x540C;&#x7684;<code>mode</code>&#x6765;&#x8BBE;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x5982;&#x679C;<code>mode</code>&#x4E3A;<code>EXACTLY</code>&#x5373;&#x4E3A;&#x7CBE;&#x786E;&#x7684;&#x503C;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x4F7F;&#x7528;&#x63A7;&#x4EF6;&#x6240;&#x5B9A;&#x4E49;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x5426;&#x5219;&#x5C31;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x5728;&#x6B64;&#x540C;&#x65F6;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>RectF</code>&#x4E3A;&#x540E;&#x7EED;&#x7684;&#x753B;&#x5706;&#x5F27;&#x8FDB;&#x884C;&#x76F8;&#x5173;&#x6570;&#x636E;&#x7684;&#x914D;&#x7F6E;&#x3002;&#x6700;&#x540E;&#x4E00;&#x5B9A;&#x8981;&#x8C03;&#x7528;<code>setMeasuredDimension</code>&#x65B9;&#x6CD5;&#x6765;&#x8BBE;&#x7F6E;&#x6211;&#x4EEC;&#x6240;&#x8BBE;&#x7F6E;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    protected void onDraw(Canvas canvas) {</span><br><span class=\"line\">        if (isStart) {</span><br><span class=\"line\">            if (mCirclePercent &lt;= 100) { //&#x5F00;&#x59CB;&#x753B;&#x5706;&#x5F27;</span><br><span class=\"line\">                isRestart = true;</span><br><span class=\"line\">                canvas.drawArc(mRectF, 270, -mCirclePercent / 100.f * 360, false, mPaint);</span><br><span class=\"line\">                mCirclePercent += mCirclerPercentIncremental;</span><br><span class=\"line\">            } else if (isRestart) { //&#x662F;&#x5426;&#x91CD;&#x65B0;&#x5F00;&#x59CB;&#x753B;&#x5706;&#x5F27;</span><br><span class=\"line\">                //&#x5468;&#x671F;&#x6027;&#x5B8C;&#x6210;&#x7684;&#x56DE;&#x8C03;</span><br><span class=\"line\">                if (listener != null) {</span><br><span class=\"line\">                    listener.onFinish();</span><br><span class=\"line\">                }</span><br><span class=\"line\">                isRestart = false;</span><br><span class=\"line\">                //&#x91CD;&#x7F6E;&#x6570;&#x636E;</span><br><span class=\"line\">                setReset();</span><br><span class=\"line\"> </span><br><span class=\"line\">                //&#x7ED8;&#x5236;&#x5B8C;&#x6574;&#x7684;&#x5706;</span><br><span class=\"line\">                canvas.drawCircle(mWidth / 2, mHeight / 2, mWidth / 2 - mCircleWidth, mPaint);</span><br><span class=\"line\">                //&#x663E;&#x793A;&#x5B8C;&#x6574;&#x5706;&#x7684;&#x65F6;&#x95F4;</span><br><span class=\"line\">                postInvalidateDelayed(CIRCLE_FIXED_TIME);</span><br><span class=\"line\">            }</span><br><span class=\"line\">            if (isStart &amp;&amp; isRestart) {</span><br><span class=\"line\">                //&#x5B9A;&#x65F6;&#x66F4;&#x65B0;ui</span><br><span class=\"line\">                postInvalidateDelayed(mIntervalTime);</span><br><span class=\"line\">                mIntervalTime -= mDrawIntervalTimeTDecrement;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            //&#x7ED8;&#x5236;&#x5B8C;&#x6574;&#x7684;&#x5706;</span><br><span class=\"line\">            canvas.drawCircle(mWidth / 2, mHeight / 2, mWidth / 2 - mCircleWidth, mPaint);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        super.onDraw(canvas);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p><code>onDraw</code>&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x6574;&#x4E2A;&#x52A8;&#x753B;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x52A8;&#x753B;&#x6548;&#x679C;&#x56FE;&#xFF0C;&#x53D1;&#x73B0;&#x52A8;&#x753B;&#x7684;&#x5F00;&#x59CB;&#x662F;&#x4ECE;<code>270</code>&#x5EA6;&#x7684;&#x89D2;&#x5EA6;&#x8FDB;&#x884C;&#x7ED8;&#x5236;&#x7684;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x9006;&#x65F6;&#x9488;&#x7684;&#x5B8C;&#x6210;&#x5706;&#x7684;&#x7ED8;&#x5236;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x753B;&#x5706;&#x5F27;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B83;&#x7684;&#x521D;&#x59CB;&#x89D2;&#x5EA6;&#x5C31;&#x662F;<code>270</code>,&#x7136;&#x540E;&#x5C31;&#x662F;&#x52A8;&#x6001;&#x7684;&#x589E;&#x52A0;&#x7ED8;&#x5236;&#x7684;&#x89D2;&#x5EA6;&#xFF0C;&#x8C03;&#x7528;<code>canvas.drawArc</code>&#x65B9;&#x6CD5;&#x6765;&#x7ED8;&#x5236;&#x5706;&#x5F27;&#xFF0C;&#x518D;&#x901A;&#x8FC7;<code>postInvalidateDelayed</code>&#x65B9;&#x6CD5;&#x6765;&#x8FBE;&#x5230;&#x5B9A;&#x65F6;&#x7684;&#x66F4;&#x65B0;<code>View</code>&#x7684;&#x7ED8;&#x5236;&#xFF0C;&#x4EE5;&#x6B64;&#x6765;&#x5B9E;&#x73B0;&#x52A8;&#x753B;&#x7684;&#x6548;&#x679C;&#x3002;&#x4EE5;&#x4E0A;&#x5C31;&#x662F;&#x753B;&#x5706;&#x5F27;&#x7684;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x4E00;&#x534A;&#xFF0C;&#x4E0B;&#x9762;&#x8FDB;&#x884C;&#x4E0B;&#x4E00;&#x534A;&#x3002;</p>\n<h2 id=\"Icon&#x7684;&#x7F29;&#x653E;&#x3001;&#x653E;&#x5927;&#x4E0E;&#x900F;&#x660E;\"><a href=\"#Icon&#x7684;&#x7F29;&#x653E;&#x3001;&#x653E;&#x5927;&#x4E0E;&#x900F;&#x660E;\" class=\"headerlink\" title=\"Icon&#x7684;&#x7F29;&#x653E;&#x3001;&#x653E;&#x5927;&#x4E0E;&#x900F;&#x660E;\"></a>Icon&#x7684;&#x7F29;&#x653E;&#x3001;&#x653E;&#x5927;&#x4E0E;&#x900F;&#x660E;</h2><p><code>Icon</code>&#x7684;&#x52A8;&#x753B;&#x4E5F;&#x53EF;&#x4EE5;&#x5206;&#x6210;&#x4E24;&#x6B65;&#xFF0C;&#x7F29;&#x653E;&#x900F;&#x660E;&#x4E0E;&#x653E;&#x5927;&#x900F;&#x660E;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x6CA1;&#x4E00;&#x6B21;<code>Icon</code>&#x52A8;&#x753B;&#x7684;&#x5B9E;&#x73B0;&#x90FD;&#x4F34;&#x6709;&#x900F;&#x660E;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8981;&#x5B9E;&#x73B0;&#x8FD9;&#x4E24;&#x5C0F;&#x6B65;&#x90FD;&#x8981;&#x4F7F;&#x7528;&#x5230;&#x52A8;&#x753B;&#x7684;&#x96C6;&#x5408;&#x6027;&#x8D28;&#x3002;&#x5BF9;&#x52A8;&#x753B;&#x8FDB;&#x884C;&#x53E0;&#x52A0;&#x3002;</p>\n<h3 id=\"&#x653E;&#x5927;&#x900F;&#x660E;\"><a href=\"#&#x653E;&#x5927;&#x900F;&#x660E;\" class=\"headerlink\" title=\"&#x653E;&#x5927;&#x900F;&#x660E;\"></a>&#x653E;&#x5927;&#x900F;&#x660E;</h3><p>&#x65E2;&#x7136;&#x8981;&#x7528;&#x5230;&#x96C6;&#x5408;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>AnimationSet</code>&#x6765;&#x7BA1;&#x7406;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//&#x653E;&#x5927;&#x900F;&#x660E;</span><br><span class=\"line\">AlphaAnimation alphaAnimation1 = new AlphaAnimation(0.2f, 1.0f);</span><br><span class=\"line\">alphaAnimation1.setDuration(550);</span><br><span class=\"line\">mSetAnimation1.addAnimation(alphaAnimation1);</span><br><span class=\"line\"></span><br><span class=\"line\">ScaleAnimation scaleAnimation2 = new ScaleAnimation(1.05f, 1.0f, 1.05f, 1.0f, Animation.RELATIVE_TO_SELF, 0.5f, Animation.RELATIVE_TO_SELF, 0.5f);</span><br><span class=\"line\">scaleAnimation2.setDuration(550);</span><br><span class=\"line\">mSetAnimation1.addAnimation(scaleAnimation2);</span><br><span class=\"line\">mSetAnimation1.setFillAfter(true);</span><br></pre></td></tr></table></figure>\n<p><code>mSetAnimation1.setFillAfter(true);</code>&#x662F;&#x5173;&#x952E;&#xFF0C;&#x5B83;&#x4EE3;&#x8868;&#x52A8;&#x753B;&#x7ED3;&#x675F;&#x540E;&#x4FDD;&#x6301;&#x7ED3;&#x675F;&#x7684;&#x89C6;&#x56FE;&#x6548;&#x679C;&#x3002;&#x5176;&#x5B83;&#x5C31;&#x662F;<code>api</code>&#x7684;&#x4F7F;&#x7528;&#x4E86;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#x3002;</p>\n<h3 id=\"&#x7F29;&#x653E;&#x900F;&#x660E;\"><a href=\"#&#x7F29;&#x653E;&#x900F;&#x660E;\" class=\"headerlink\" title=\"&#x7F29;&#x653E;&#x900F;&#x660E;\"></a>&#x7F29;&#x653E;&#x900F;&#x660E;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//&#x7F29;&#x653E;&#x900F;&#x660E;</span><br><span class=\"line\">mSetAnimation2 = new AnimationSet(true);</span><br><span class=\"line\">AlphaAnimation alphaAnimation2 = new AlphaAnimation(1.0f, 0.2f);</span><br><span class=\"line\">alphaAnimation2.setDuration(100);</span><br><span class=\"line\">ScaleAnimation scaleAnimation3 = new ScaleAnimation(1.0f, 0.6f, 1.0f, 0.6f, Animation.RELATIVE_TO_SELF, 0.5f, Animation.RELATIVE_TO_SELF, 0.5f);</span><br><span class=\"line\">scaleAnimation3.setDuration(100);</span><br><span class=\"line\"></span><br><span class=\"line\">mSetAnimation2.addAnimation(alphaAnimation2);</span><br><span class=\"line\">mSetAnimation2.addAnimation(scaleAnimation3);</span><br><span class=\"line\">mSetAnimation2.setFillAfter(true);</span><br></pre></td></tr></table></figure>\n<p>&#x4EE5;&#x4E0A;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x4ED6;&#x4EEC;&#x7684;&#x65F6;&#x95F4;&#x90FD;&#x4E0D;&#x662F;&#x968F;&#x4FBF;&#x8BBE;&#x7F6E;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x53C8;&#x8981;&#x7ED3;&#x5408;&#x4E0A;&#x9762;&#x7684;&#x753B;&#x5706;&#x5F27;&#x7684;&#x52A8;&#x753B;&#xFF0C;&#x6240;&#x4EE5;&#x65F6;&#x95F4;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x8BA1;&#x7B97;&#x8BBE;&#x8BA1;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x8981;&#x6539;&#x65F6;&#x95F4;&#x8981;&#x4E24;&#x90E8;&#x5206;&#x76F8;&#x5BF9;&#x4E8E;&#x7684;&#x4FEE;&#x6539;&#x3002;</p>\n<p>&#x81F3;&#x6B64;&#x52A8;&#x753B;&#x90FD;&#x57FA;&#x672C;&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x601D;&#x8DEF;&#x662F;&#x5426;&#x5F88;&#x6E05;&#x6670;&#x5462;&#x3002;&#x4E0B;&#x9762;&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F;&#x52A8;&#x753B;&#x7684;&#x8C03;&#x7528;&#x4E86;&#x3002;</p>\n<h2 id=\"&#x52A8;&#x753B;&#x8C03;&#x7528;\"><a href=\"#&#x52A8;&#x753B;&#x8C03;&#x7528;\" class=\"headerlink\" title=\"&#x52A8;&#x753B;&#x8C03;&#x7528;\"></a>&#x52A8;&#x753B;&#x8C03;&#x7528;</h2><h3 id=\"&#x5F00;&#x542F;\"><a href=\"#&#x5F00;&#x542F;\" class=\"headerlink\" title=\"&#x5F00;&#x542F;\"></a>&#x5F00;&#x542F;</h3><p>&#x9996;&#x5148;&#x662F;&#x52A8;&#x753B;&#x7684;&#x5F00;&#x542F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void show() {</span><br><span class=\"line\">        //1.&#x91CD;&#x7F6E;&#xFF0C;&#x5F00;&#x542F;&#x52A8;&#x753B;</span><br><span class=\"line\">        mLoadingImage.setVisibility(VISIBLE);</span><br><span class=\"line\">        mLoadingCircleView.setVisibility(VISIBLE);</span><br><span class=\"line\">        mLoadingCircleView.setReset();</span><br><span class=\"line\">        mLoadingCircleView.startAnimation();</span><br><span class=\"line\">        mLoadingCircleView.invalidate();</span><br><span class=\"line\"> </span><br><span class=\"line\">        //2.&#x7F29;&#x653E;&#x52A8;&#x753B;&#x63A8;&#x8F9E;200&#x6BEB;&#x79D2;&#x6267;&#x884C;</span><br><span class=\"line\">        mLoadingImage.postDelayed(new Runnable() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void run() {</span><br><span class=\"line\">                mLoadingImage.startAnimation(mSetAnimation2);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }, 200);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x7684;<code>mLoadingCircleVieW</code>&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5706;&#x5F27;&#x63A7;&#x4EF6;&#x3002;<code>mLoadingImage</code>&#x5C31;&#x662F;<code>Icon</code>&#x5B83;&#x5C31;&#x662F;&#x4E00;&#x4E2A;<code>ImageView</code>&#x3002;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5F00;&#x542F;&#x5BF9;&#x5706;&#x5F27;&#x7684;&#x7ED8;&#x5236;&#xFF0C;&#x540C;&#x65F6;&#x63A8;&#x8F9E;<code>200</code>&#x6BEB;&#x79D2;&#x518D;&#x5BF9;<code>Icon</code>&#x8FDB;&#x884C;&#x7F29;&#x653E;&#x900F;&#x660E;&#x7684;&#x52A8;&#x753B;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#x3002;&#x5F53;&#x5706;&#x5F27;&#x753B;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x7ECF;&#x8FC7;&#x524D;&#x9762;&#x7684;<code>onDraw</code>&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x6709;<code>1200</code>&#x6BEB;&#x79D2;&#x7684;&#x6574;&#x4E2A;&#x5706;&#x7684;&#x5C55;&#x793A;&#xFF0C;&#x540C;&#x65F6;&#x901A;&#x8FC7;<code>onFinish</code>&#x56DE;&#x8C03;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;<code>Icon</code>&#x7684;&#x653E;&#x5927;&#x900F;&#x660E;&#x52A8;&#x753B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    public void onFinish() {</span><br><span class=\"line\">        //3.&#x5706;&#x5F62;&#x753B;&#x5B8C;&#x540E;&#x7ACB;&#x523B;&#x6267;&#x884C;&#x653E;&#x5927;&#x900F;&#x660E;&#x52A8;&#x753B;</span><br><span class=\"line\">        mLoadingImage.setVisibility(VISIBLE);</span><br><span class=\"line\">        mLoadingImage.startAnimation(mSetAnimation1);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5230;&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#x52A8;&#x753B;&#x7684;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x5468;&#x671F;&#x3002;&#x56E0;&#x4E3A;&#x8981;&#x5B9E;&#x73B0;&#x5FAA;&#x73AF;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x8FD8;&#x5DEE;&#x6700;&#x540E;&#x4E00;&#x6B65;&#xFF0C;&#x5C31;&#x662F;&#x5C06;&#x52A8;&#x753B;&#x8FD8;&#x539F;&#x5230;&#x521D;&#x59CB;&#x7684;&#x72B6;&#x6001;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5BF9;&#x7B2C;&#x4E09;&#x6B65;&#x653E;&#x5927;&#x900F;&#x660E;&#x7684;&#x52A8;&#x753B;&#x8FDB;&#x884C;&#x76D1;&#x542C;&#xFF0C;&#x5F53;&#x653E;&#x5927;&#x900F;&#x660E;&#x7684;&#x52A8;&#x753B;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x518D;&#x8FDB;&#x884C;&#x7F29;&#x653E;&#x900F;&#x660E;&#x8FD8;&#x539F;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scaleAnimation2.setAnimationListener(new Animation.AnimationListener() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onAnimationStart(Animation animation) {</span><br><span class=\"line\"></span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onAnimationEnd(Animation animation) {</span><br><span class=\"line\">                //4:&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x52A8;&#x753B;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x6267;&#x884C;&#x7F29;&#x653E;&#x900F;&#x660E;&#xFF0C;&#x8FD4;&#x56DE;&#x5230;&#x521D;&#x59CB;&#x5316;&#x72B6;&#x6001;&#xFF0C;</span><br><span class=\"line\">                // &#x8FD9;&#x91CC;&#x5EF6;&#x8FDF;650&#x6BEB;&#x79D2;&#xFF0C;&#x56E0;&#x4E3A;&#x56FA;&#x5B9A;&#x5706;&#x5F62;&#x663E;&#x793A;&#x65F6;&#x95F4;&#x4E3A;1200&#x6BEB;&#x79D2; &#x9700;&#x518D;&#x51CF;&#x53BB;&#x524D;&#x9762;&#x7684;&#x653E;&#x5927;&#x900F;&#x660E;&#x52A8;&#x753B;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;550&#x6BEB;&#x79D2;</span><br><span class=\"line\">                mSetAnimation2.setStartOffset(650);</span><br><span class=\"line\">                 mLoadingImage.startAnimation(mSetAnimation2);</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onAnimationRepeat(Animation animation) {</span><br><span class=\"line\"> </span><br><span class=\"line\">            }</span><br><span class=\"line\">        });</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x5173;&#x95ED;\"><a href=\"#&#x5173;&#x95ED;\" class=\"headerlink\" title=\"&#x5173;&#x95ED;\"></a>&#x5173;&#x95ED;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void dismiss() {</span><br><span class=\"line\">        mLoadingCircleView.stopAnimation();</span><br><span class=\"line\">        mLoadingCircleView.setVisibility(GONE);</span><br><span class=\"line\">        mLoadingImage.setVisibility(GONE);</span><br><span class=\"line\">        //&#x6E05;&#x7406;&#x52A8;&#x753B;&#xFF0C;&#x9632;&#x6B62;View&#x65E0;&#x6CD5;&#x9690;&#x85CF;</span><br><span class=\"line\">        //&#x56E0;&#x4E3A;View&#x7684;&#x7C7B;&#x578B;&#x52A8;&#x753B;&#x662F;&#x5BF9;View&#x7684;&#x955C;&#x50CF;&#x8FDB;&#x884C;&#x52A8;&#x753B;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x6539;&#x53D8;View&#x7684;&#x72B6;&#x6001;</span><br><span class=\"line\">        if (mLoadingImage.getAnimation() != null) {</span><br><span class=\"line\">            mLoadingImage.clearAnimation();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x4E8E;&#x52A8;&#x753B;&#x7684;&#x5173;&#x95ED;&#x6211;&#x8981;&#x8BF4;&#x7684;&#x90FD;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x6CE8;&#x91CA;&#x8FDB;&#x884C;&#x4E86;&#x8BE6;&#x7EC6;&#x7684;&#x8BF4;&#x660E;&#x3002;&#x53EA;&#x8981;&#x6CE8;&#x610F;&#x8FD9;&#x4E00;&#x70B9;&#x5C31;&#x57FA;&#x672C;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x4E86;&#x3002;</p>\n<blockquote>\n<p><em>OK,everything is over. &#x6700;&#x540E;&#x9644;&#x4E0A;&#x6E90;&#x7801;&#x5730;&#x5740;</em></p>\n</blockquote>\n<p>&#x6E90;&#x4EE3;&#x7801;&#xFF1A;<a href=\"https://github.com/idisfkj/LoadingCirclerView\" target=\"_blank\" rel=\"noopener\">loading</a></p>\n","categories":["android"],"tags":["自定义View"]},{"title":"基于Fresco的大图浏览","url":"https://www.rousetime.com/2017/03/05/基于Fresco的大图浏览/","content":"<p>&#x4E0A;&#x4E2A;&#x661F;&#x671F;&#x662F;&#x4E2A;&#x5FD9;&#x788C;&#x7684;&#x4E00;&#x5468;&#xFF0C;&#x5168;&#x5468;&#x90FD;&#x5728;&#x8D76;&#x8FDB;&#x5EA6;&#xFF0C;&#x53EF;&#x80FD;&#x662F;&#x8FC7;&#x5E74;&#x8FC7;&#x7684;&#x592A;&#x8212;&#x7545;&#x4E86;&#x5427;&#x3002;&#x73B0;&#x5728;&#x7EC8;&#x4E8E;&#x6709;&#x7A7A;&#x6765;&#x5750;&#x4E0B;&#x6765;&#xFF0C;&#x5B89;&#x5B89;&#x9759;&#x9759;&#x7684;&#x601D;&#x8003;&#x4E0B;&#x8FD9;&#x5FD9;&#x788C;&#x540E;&#x7684;&#x6536;&#x83B7;&#x3002;&#x5728;&#x6B64;&#x4E5F;&#x56DE;&#x987E;&#x4E00;&#x4E0B;&#xFF0C;&#x505A;&#x4E2A;&#x5206;&#x4EAB;&#xFF01;</p>\n<p>&#x4ECA;&#x5929;&#x7684;&#x5185;&#x5BB9;&#x662F;&#x5173;&#x4E8E;&#x5927;&#x56FE;&#x6D4F;&#x89C8;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x53EF;&#x80FD;&#x5404;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x90FD;&#x5F88;&#x591A;&#xFF0C;&#x4F46;&#x6211;&#x8FD9;&#x91CC;&#x8981;&#x8BF4;&#x7684;&#x662F;&#x57FA;&#x4E8E;<code>Fresco</code>&#x6765;&#x5B9E;&#x73B0;&#x3002;&#xFF08;&#x5176;&#x5B9E;&#x4E3B;&#x8981;&#x662F;&#x9879;&#x76EE;&#x4E2D;&#x7528;&#x7684;&#x5C31;&#x662F;<code>Fresco</code>&#xFF09;</p>\n<h1 id=\"Fresco\"><a href=\"#Fresco\" class=\"headerlink\" title=\"Fresco\"></a>Fresco</h1><p>&#x53EF;&#x80FD;&#x8FD8;&#x6709;&#x4EBA;&#x4E0D;&#x4E86;&#x89E3;<code>Fresco</code>&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x6765;&#x7B80;&#x5355;&#x7684;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x3002;</p>\n<p><code>Fresco</code>&#x662F;<code>facebook</code>&#x63A8;&#x51FA;&#x7684;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#xFF0C;&#x8BE5;&#x9879;&#x76EE;&#x4E3B;&#x8981;&#x7528;&#x6765;&#x89E3;&#x51B3;<code>Android</code>&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x7684;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x5F3A;&#x5927;&#x7684;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F7F;&#x7528;&#x5B83;&#x4E4B;&#x540E;&#xFF0C;&#x4F60;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x53BB;&#x5173;&#x5FC3;&#x56FE;&#x7247;&#x7684;&#x52A0;&#x8F7D;&#x548C;&#x663E;&#x793A;&#x7684;&#x7E41;&#x7410;&#x4E8B;&#x4EF6;&#x3002;&#x5BF9;&#x4E8E;&#x4E13;&#x6CE8;&#x4E8E;&#x56FE;&#x7247;<code>App</code>&#x5F3A;&#x70C8;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x5B83;&#x3002;</p>\n<h2 id=\"Feature\"><a href=\"#Feature\" class=\"headerlink\" title=\"Feature\"></a>Feature</h2><p>&#x4E0B;&#x9762;&#x662F;&#x5B83;&#x7684;&#x4E00;&#x4E9B;&#x7A81;&#x51FA;&#x7279;&#x6027;</p>\n<ul>\n<li><code>Fresco</code>&#x4E2D;&#x7684;<code>Image Pipeline</code>&#x8D1F;&#x8D23;&#x4ECE;&#x7F51;&#x7EDC;&#x3001;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3001;&#x672C;&#x5730;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#x56FE;&#x7247;&#xFF0C;&#x6700;&#x5927;&#x7684;&#x8282;&#x7701;&#x7A7A;&#x95F4;&#x4E0E;<code>CPU</code>&#x65F6;&#x95F4;&#xFF0C;&#x540C;&#x65F6;&#x542B;&#x6709;3&#x7EA7;&#x7F13;&#x5B58;&#xFF08;2&#x7EA7;&#x5185;&#x5B58;&#xFF0C;1&#x7EA7;&#x78C1;&#x76D8;&#xFF09;&#xFF0C;&#x652F;&#x6301;&#x7F29;&#x7565;&#x56FE;&#x4E0E;&#x6E05;&#x6670;&#x5EA6;&#x7684;&#x8F6C;&#x6362;&#x7B49;</li>\n<li><code>Fresco</code>&#x7684;<code>Drawees</code>&#xFF0C;&#x8D1F;&#x8D23;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x5B8C;&#x6210;&#x524D;&#x7684;&#x5360;&#x4F4D;&#x56FE;&#x4E0E;&#x56FE;&#x7247;&#x4E0D;&#x53EF;&#x89C1;&#x65F6;&#x7684;&#x91CA;&#x653E;&#xFF0C;&#x540C;&#x65F6;&#x8FD8;&#x652F;&#x6301;&#x5706;&#x5F62;&#x56FE;&#x7247;&#x7684;&#x5B9E;&#x73B0;</li>\n<li><code>Fresco</code>&#x652F;&#x6301;&#x6E10;&#x8FDB;&#x5F0F;&#x56FE;&#x7247;&#x5C55;&#x793A;&#xFF0C;<code>Android</code>&#x672C;&#x8EAB;&#x662F;&#x4E0D;&#x652F;&#x6301;&#x7684;&#x3002;</li>\n<li><p><code>Fresco</code>&#x5B8C;&#x7F8E;&#x652F;&#x6301;<code>Gif</code>&#x4E0E;<code>WebP</code>&#x52A8;&#x56FE;&#xFF0C;&#x8F7B;&#x677E;&#x89E3;&#x51B3;&#x6BCF;&#x4E00;&#x5E27;&#x90FD;&#x662F;&#x5F88;&#x5927;&#x7684;<code>Bitmap</code>&#x70E6;&#x607C;&#x3002;</p>\n<p>&#x4F20;&#x9001;&#x95E8;: <a href=\"https://github.com/facebook/fresco\" target=\"_blank\" rel=\"noopener\">Fresco</a></p>\n</li>\n</ul>\n<h1 id=\"&#x5927;&#x56FE;&#x6D4F;&#x89C8;\"><a href=\"#&#x5927;&#x56FE;&#x6D4F;&#x89C8;\" class=\"headerlink\" title=\"&#x5927;&#x56FE;&#x6D4F;&#x89C8;\"></a>&#x5927;&#x56FE;&#x6D4F;&#x89C8;</h1><h2 id=\"&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\"><a href=\"#&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\" class=\"headerlink\" title=\"&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\"></a>&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;</h2><p>&#x65E2;&#x7136;&#x662F;&#x57FA;&#x4E8E;<code>Fresco</code>,&#x5728;&#x5B9E;&#x73B0;&#x4E4B;&#x524D;&#x81EA;&#x7136;&#x8981;&#x5BFC;&#x5165;<code>Fresco</code>&#x7684;&#x76F8;&#x5173;&#x4F9D;&#x8D56;&#x5305;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">compile &apos;com.facebook.fresco:fresco:1.0.0&apos;</span><br><span class=\"line\">compile &apos;com.facebook.fresco:animated-gif:1.0.0&apos;</span><br><span class=\"line\">compile &apos;com.facebook.fresco:animated-webp:1.0.0&apos;</span><br><span class=\"line\">compile &apos;com.facebook.fresco:webpsupport:1.0.0&apos;</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x53EA;&#x8981;&#x5B9E;&#x73B0;&#x666E;&#x901A;&#x56FE;&#x7247;&#x7684;&#x52A0;&#x8F7D;&#xFF0C;&#x90A3;&#x4E48;&#x53EA;&#x8981;&#x5BFC;&#x5165;&#x7B2C;&#x4E00;&#x4E2A;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;&#x597D;&#x4E86;&#x73B0;&#x5728;&#x4F60;&#x5C31;&#x53EF;&#x725B;&#x903C;&#x54C4;&#x54C4;&#x7684;&#x4F7F;&#x7528;&#x8FD9;&#x4E48;&#x9AD8;&#x5927;&#x4E0A;&#x7684;&#x7EC4;&#x4EF6;&#x6765;&#x52A0;&#x8F7D;&#x56FE;&#x7247;&#xFF0C;&#x81F3;&#x4E8E;&#x4F7F;&#x7528;&#x6B65;&#x9AA4;&#xFF0C;&#x968F;&#x4FBF;&#x770B;&#x4E0B;&#x76F8;&#x5173;&#x6559;&#x7A0B;&#x5C31;&#x80FD;&#x8F7B;&#x677E;&#x641E;&#x5B9A;&#xFF0C;&#x4F8B;&#x5982;&#x524D;&#x9762;&#x6240;&#x8BF4;&#x7684;&#x5706;&#x5F62;&#x56FE;&#x7247;&#x3002;&#x60F3;&#x5F53;&#x521D;&#x6211;&#x8FD8;&#x662F;&#x82E6;&#x903C;&#x662F;&#x627E;&#x76F8;&#x5173;&#x7684;&#x5E93;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#x2026;</p>\n<h2 id=\"SimpleDraweeView\"><a href=\"#SimpleDraweeView\" class=\"headerlink\" title=\"SimpleDraweeView\"></a>SimpleDraweeView</h2><p>&#x4E0A;&#x9762;&#x53EA;&#x662F;&#x9488;&#x5BF9;&#x4E8E;&#x666E;&#x901A;&#x7684;&#x56FE;&#x7247;&#x5C55;&#x793A;&#xFF0C;&#x4F46;&#x4E0D;&#x662F;&#x4ECA;&#x5929;&#x7684;&#x4E3B;&#x9898;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x6BB5;&#x57FA;&#x672C;&#x7684;&#x4F7F;&#x7528;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void displayImage(SimpleDraweeView draweeView, String url) {</span><br><span class=\"line\">        GenericDraweeHierarchy hierarchy = draweeView.getHierarchy();</span><br><span class=\"line\">        //&#x8BBE;&#x7F6E;&#x5360;&#x4F4D;&#x56FE;</span><br><span class=\"line\">        if (hierarchy == null) {</span><br><span class=\"line\">            hierarchy = GenericDraweeHierarchyBuilder.newInstance(getResources())</span><br><span class=\"line\">                    .setPlaceholderImage(getResources().getDrawable(R.mipmap.ic_launcher)</span><br><span class=\"line\">                            , ScalingUtils.ScaleType.CENTER).build();</span><br><span class=\"line\">            draweeView.setHierarchy(hierarchy);</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            hierarchy.setPlaceholderImage(getResources().getDrawable(R.mipmap.ic_launcher)</span><br><span class=\"line\">                    , ScalingUtils.ScaleType.CENTER);</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        //&#x6784;&#x5EFA;ImageRequestBuilder&#xFF0C;&#x4F20;&#x5165;&#x8BF7;&#x6C42;Uri</span><br><span class=\"line\">        ImageRequestBuilder requestBuilder = ImageRequestBuilder.newBuilderWithSource(Uri.parse(url));</span><br><span class=\"line\">        //&#x6784;&#x5EFA;Controller</span><br><span class=\"line\">        DraweeController controller = Fresco.newDraweeControllerBuilder()</span><br><span class=\"line\">                .setOldController(draweeView.getController())</span><br><span class=\"line\">                .setImageRequest(requestBuilder.build())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">        //&#x8BBE;&#x7F6E;&#x56FE;&#x7247;&#xFF0C;Fresco&#x8BBE;&#x7F6E;&#x663E;&#x793A;&#x56FE;&#x7247;&#x90FD;&#x662F;&#x901A;&#x8FC7;Controller&#x6765;&#x5B9E;&#x73B0;</span><br><span class=\"line\">        draweeView.setController(controller);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x76F8;&#x4FE1;&#x4E0A;&#x9762;&#x7684;&#x6CE8;&#x91CA;&#x5DF2;&#x7ECF;&#x975E;&#x5E38;&#x660E;&#x663E;&#x4E86;</em></p>\n</blockquote>\n<h2 id=\"ZoomableView\"><a href=\"#ZoomableView\" class=\"headerlink\" title=\"ZoomableView\"></a>ZoomableView</h2><p>&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x73B0;&#x5728;&#x53EA;&#x8981;&#x662F;&#x4E2A;<code>App</code>&#x4E14;&#x91CC;&#x9762;&#x6709;&#x56FE;&#x7247;&#x7684;&#x5C55;&#x793A;&#xFF0C;&#x90A3;&#x4E48;&#x57FA;&#x672C;&#x4E0A;&#x5C31;&#x6709;&#x56FE;&#x7247;&#x6D4F;&#x89C8;&#x8FD9;&#x4E00;&#x4E2A;&#x529F;&#x80FD;&#x3002;&#x5BF9;&#x4E8E;&#x5927;&#x56FE;&#x6D4F;&#x89C8;&#x9700;&#x8981;&#x652F;&#x6301;&#x7F29;&#x653E;&#x3001;&#x62D6;&#x62FD;&#x3001;&#x53CC;&#x51FB;&#x653E;&#x5927;&#x3002;<code>Fresco</code>&#x539F;&#x751F;&#x7684;<code>SimpleDraweeView</code>&#x662F;&#x4E0D;&#x652F;&#x6301;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x8981;&#x4F7F;&#x7528;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x63A7;&#x4EF6;<code>ZoomableView</code>&#x3002;&#x5F53;&#x7136;&#x5B83;&#x4E5F;&#x662F;<code>Fresco</code>&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x63A5;&#x5165;&#x5230;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x4E2D;&#x3002;&#x524D;&#x9762;&#x7684;&#x4F20;&#x9001;&#x95E8;&#x4E2D;&#x53EF;&#x4EE5;&#x627E;&#x5230;<code>ZoomableView</code>&#x3002;&#x4F46;&#x6BD5;&#x7ADF;&#x662F;<code>Fresco</code>&#x9879;&#x76EE;&#x7684;&#x96C6;&#x5408;&#x4F53;&#xFF0C;&#x672C;&#x7247;&#x6587;&#x7AE0;&#x7684;&#x672B;&#x5C3E;&#x6211;&#x4F1A;&#x63D0;&#x4F9B;&#x6211;&#x5DF2;&#x7ECF;&#x63D0;&#x53D6;&#x597D;&#x7684;&#x76F8;&#x5173;&#x4EE3;&#x7801;&#x3002;</p>\n<h2 id=\"&#x5B9E;&#x73B0;\"><a href=\"#&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;\"></a>&#x5B9E;&#x73B0;</h2><p>&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x754C;&#x9762;<code>ZoomableActivity</code>,&#x81F3;&#x4E8E;&#x5E03;&#x5C40;&#x5927;&#x56FE;&#x6D4F;&#x89C8;&#x81EA;&#x7136;&#x5C11;&#x4E0D;&#x4E86;<code>ViewPager</code>,&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x591A;&#x4ECB;&#x7ECD;<code>ViewPager</code>&#x4E86;,&#x76F4;&#x63A5;&#x4E0A;<code>ZoomableActivity</code>&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class ZoomableActivity extends AppCompatActivity implements ViewPager.OnPageChangeListener {</span><br><span class=\"line\">    private static final String EXTRA_ZOOMABLE_PATHS = &quot;extra_zoomable_paths&quot;;</span><br><span class=\"line\">    private static final String EXTRA_ZOOMABLE_INDEX = &quot;extra_zoomable_index&quot;;</span><br><span class=\"line\"> </span><br><span class=\"line\">    private ViewPager mViewPager;</span><br><span class=\"line\">    private TextView mZoomableIndex;</span><br><span class=\"line\">    private ArrayList&lt;String&gt; mPaths;</span><br><span class=\"line\">    private int mIndex;</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    protected void onCreate(@Nullable Bundle savedInstanceState) {</span><br><span class=\"line\">        super.onCreate(savedInstanceState);</span><br><span class=\"line\">        setContentView(R.layout.zoommable_activity);</span><br><span class=\"line\">        getExtraData();</span><br><span class=\"line\">        initView();</span><br><span class=\"line\">        setupViewPager();</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    private void getExtraData() {</span><br><span class=\"line\">        mPaths = getIntent().getStringArrayListExtra(EXTRA_ZOOMABLE_PATHS);</span><br><span class=\"line\">        mIndex = getIntent().getIntExtra(EXTRA_ZOOMABLE_INDEX, 0);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    private void initView() {</span><br><span class=\"line\">        mViewPager = (ViewPager) findViewById(R.id.view_pager);</span><br><span class=\"line\">        mZoomableIndex = (TextView) findViewById(R.id.zoomable_index);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    private void setupViewPager() {</span><br><span class=\"line\">        mViewPager.setAdapter(new ZoomableViewPagerAdapter(this, mPaths));</span><br><span class=\"line\">        mViewPager.setCurrentItem(mIndex);</span><br><span class=\"line\">        mZoomableIndex.setText(mIndex + 1 + &quot;/&quot; + mPaths.size());</span><br><span class=\"line\">        mViewPager.addOnPageChangeListener(this);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) {</span><br><span class=\"line\"></span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void onPageSelected(int position) {</span><br><span class=\"line\">        mZoomableIndex.setText(position + 1 + &quot;/&quot; + mPaths.size());</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void onPageScrollStateChanged(int state) {</span><br><span class=\"line\"> </span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    public static void goToPage(Context context, ArrayList&lt;String&gt; paths, int index) {</span><br><span class=\"line\">        Intent intent = new Intent(context, ZoomableActivity.class);</span><br><span class=\"line\">         intent.putStringArrayListExtra(EXTRA_ZOOMABLE_PATHS, paths);</span><br><span class=\"line\">        intent.putExtra(EXTRA_ZOOMABLE_INDEX, index);</span><br><span class=\"line\">        context.startActivity(intent);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x5C31;&#x662F;<code>Adapter</code>&#x4E86;&#xFF0C;&#x4E3B;&#x8981;&#x5C31;&#x662F;&#x56FE;&#x7247;&#x7684;&#x663E;&#x793A;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x662F;<code>ViewPager</code>&#x6240;&#x4EE5;&#x4F7F;&#x7528;<code>PagerAdapter</code>,&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#x5C31;&#x662F;&#x5B83;&#x7684;<code>instantiateItem</code>&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    public Object instantiateItem(ViewGroup container, int position) {</span><br><span class=\"line\">        View view = LayoutInflater.from(mContext).inflate(R.layout.zoomable_view_pager_item, null);</span><br><span class=\"line\">        ZoomableDraweeView zoomableDraweeView = (ZoomableDraweeView) view.findViewById(R.id.zoomable_image);</span><br><span class=\"line\">        //&#x5141;&#x8BB8;&#x7F29;&#x653E;&#x65F6;&#x5207;&#x6362;</span><br><span class=\"line\">        zoomableDraweeView.setAllowTouchInterceptionWhileZoomed(true);</span><br><span class=\"line\">        //&#x957F;&#x6309;</span><br><span class=\"line\">        zoomableDraweeView.setIsLongpressEnabled(false);</span><br><span class=\"line\">        //&#x53CC;&#x51FB;&#x51FB;&#x653E;&#x5927;&#x6216;&#x7F29;&#x5C0F;</span><br><span class=\"line\">        zoomableDraweeView.setTapListener(new DoubleTapGestureListener(zoomableDraweeView));</span><br><span class=\"line\"></span><br><span class=\"line\">        DraweeController draweeController = Fresco.newDraweeControllerBuilder()</span><br><span class=\"line\">                .setUri(mPaths.get(position))</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">        //&#x52A0;&#x8F7D;&#x56FE;&#x7247;</span><br><span class=\"line\">        zoomableDraweeView.setController(draweeController);</span><br><span class=\"line\">        container.addView(view);</span><br><span class=\"line\">        view.requestLayout();</span><br><span class=\"line\">        return view;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x8FD9;&#x6837;&#x5C31;&#x5B9E;&#x73B0;&#x4E86;&#x5927;&#x56FE;&#x6D4F;&#x89C8;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x501F;&#x52A9;<code>ZoomableView</code>&#x540E;&#xFF0C;&#x53EA;&#x8981;&#x5B9E;&#x73B0;&#x4EA4;&#x4E92;&#x7684;&#x5C55;&#x793A;&#x903B;&#x8F91;&#x5C31;Ok&#x4E86;</em></p>\n</blockquote>\n<h1 id=\"&#x6548;&#x679C;&#x56FE;\"><a href=\"#&#x6548;&#x679C;&#x56FE;\" class=\"headerlink\" title=\"&#x6548;&#x679C;&#x56FE;\"></a>&#x6548;&#x679C;&#x56FE;</h1><p><img src=\"/2017/03/05/&#x57FA;&#x4E8E;Fresco&#x7684;&#x5927;&#x56FE;&#x6D4F;&#x89C8;/zoomable.gif\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p>&#x9879;&#x76EE;&#x4F20;&#x9001;&#x95E8;&#xFF1A;<a href=\"https://github.com/idisfkj/Zoomable\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/Zoomable</a></p>\n","categories":["Fresco"],"tags":["android"]},{"title":"git使用杂记","url":"https://www.rousetime.com/2017/01/26/git使用杂记/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p>&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x5982;&#x679C;&#x73B0;&#x5728;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;<code>git</code>&#x6216;&#x8005;&#x8FD8;&#x4E0D;&#x4F1A;&#x4F7F;&#x7528;<code>git</code>&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x5E94;&#x8BE5;&#x597D;&#x597D;&#x7684;&#x53CD;&#x7701;&#x3002;&#x81EA;&#x5DF1;&#x53BB;&#x597D;&#x597D;&#x770B;&#x4E00;&#x904D;&#x7684;&#x5165;&#x95E8;&#x4ECB;&#x7ECD;&#x5427;&#x3002;&#x4ECA;&#x5929;&#x53EA;&#x662F;&#x5BF9;&#x81EA;&#x5DF1;&#x5728;&#x65E5;&#x5E38;&#x4E2D;&#x4F7F;&#x7528;<code>git</code>&#x7684;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x547D;&#x4EE4;&#x7684;&#x4ECB;&#x7ECD;&#x4E0E;&#x81EA;&#x5DF1;&#x8BA4;&#x4E3A;&#x4E0D;&#x9519;&#x4E14;&#x80FD;&#x63D0;&#x9AD8;&#x6211;&#x4EEC;&#x529E;&#x516C;&#x6548;&#x7387;&#x7684;&#x547D;&#x4EE4;&#x3002;&#x5185;&#x5BB9;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x70B9;&#x6742;&#x4E71;&#xFF0C;&#x4F46;&#x7EDD;&#x5BF9;&#x90FD;&#x662F;&#x7ECF;&#x5178;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x5728;&#x6B64;&#x8BB0;&#x4E0B;&#x7B14;&#x8BB0;&#xFF0C;&#x4E5F;&#x5E0C;&#x671B;&#x80FD;&#x5E2E;&#x52A9;&#x6765;&#x8D4F;&#x8138;&#x5173;&#x987E;&#x7684;&#x4F60;&#x4EEC;&#x3002;</p>\n<h2 id=\"&#x533A;&#x57DF;\"><a href=\"#&#x533A;&#x57DF;\" class=\"headerlink\" title=\"&#x533A;&#x57DF;\"></a>&#x533A;&#x57DF;</h2><p>&#x5728;&#x8FD9;&#x4E4B;&#x524D;&#xFF0C;&#x6765;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;<code>git</code>&#x7684;&#x4E09;&#x4E2A;&#x533A;&#x57DF;</p>\n<ul>\n<li>&#x5DE5;&#x4F5C;&#x533A;&#xFF08;working directory&#xFF09;</li>\n<li>&#x6682;&#x5B58;&#x533A;&#xFF08;stage index&#xFF09;</li>\n<li>&#x672C;&#x5730;&#x5386;&#x53F2;&#x533A;&#xFF08;history&#xFF09;</li>\n</ul>\n<p>&#x901A;&#x8FC7;&#x4E00;&#x5F20;&#x56FE;&#x5C31;&#x80FD;&#x7B80;&#x6D01;&#x6613;&#x61C2;&#x7684;&#x660E;&#x767D;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x8F6C;&#x5316;&#x3002;</p>\n<p><img src=\"/2017/01/26/git&#x4F7F;&#x7528;&#x6742;&#x8BB0;/5.png\" alt=\"git\"></p>\n<h2 id=\"clone\"><a href=\"#clone\" class=\"headerlink\" title=\"clone\"></a>clone</h2><p>&#x5148;&#x4ECE;<code>clone</code>&#x547D;&#x4EE4;&#x6765;&#x4ECB;&#x7ECD;&#xFF0C;&#x4F7F;&#x7528;&#x8FC7;<code>git</code>&#x7684;&#x90FD;&#x77E5;&#x9053;&#x5B83;&#x3002;<code>git colne</code>&#x547D;&#x4EE4;&#x62C9;&#x53D6;&#x8FDC;&#x7A0B;&#x4ED3;&#x5E93;&#x5230;&#x672C;&#x5730;&#x3002;&#x4F46;&#x5F53;&#x6211;&#x4EEC;&#x8981;&#x62C9;&#x53D6;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x65F6;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x76F4;&#x63A5;<code>mkdir</code>&#xFF0C;&#x5176;&#x5B9E;&#x65E0;&#x9700;&#x5982;&#x6B64;&#xFF0C;&#x4E00;&#x6761;&#x547D;&#x4EE4;&#x5C31;&#x80FD;&#x641E;&#x5B9A;<code>git clone &#x8FDC;&#x7A0B;&#x4ED3;&#x5E93; &#x6587;&#x4EF6;&#x540D;</code>&#xFF0C;&#x5C31;&#x662F;&#x5982;&#x6B64;&#x7B80;&#x5355;&#x3002;</p>\n<h2 id=\"rm\"><a href=\"#rm\" class=\"headerlink\" title=\"rm\"></a>rm</h2><p>&#x6211;&#x4EEC;&#x5728;&#x5DE5;&#x4F5C;&#x4E2D;&#x53EF;&#x80FD;&#x4F1A;&#x9047;&#x5230;&#x8FD9;&#x4E48;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x4F7F;&#x7528;<code>git add .</code>&#x76F4;&#x63A5;&#x5C06;&#x5DE5;&#x4F5C;&#x533A;&#x7684;&#x6240;&#x6709;&#x4FEE;&#x6539;&#x7684;&#x6587;&#x4EF6;&#x52A0;&#x5165;&#x5230;&#x6682;&#x5B58;&#x533A;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x540E;&#x9762;&#x53D1;&#x73B0;&#x6709;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5148;&#x4E0D;&#x8981;&#x52A0;&#x8FDB;&#x53BB;&#xFF0C;&#x6B64;&#x65F6;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x8BE5;&#x6587;&#x4EF6;&#x9000;&#x56DE;&#x5230;&#x5DE5;&#x4F5C;&#x533A;&#x4E2D;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git rm --cached &lt;file&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"stash\"><a href=\"#stash\" class=\"headerlink\" title=\"stash\"></a>stash</h2><p>&#x6709;&#x8FD9;&#x4E48;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x5F53;&#x4F60;&#x6B63;&#x5728;&#x5F00;&#x53D1;&#x4E2D;&#x65F6;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x4E0A;&#x7684;&#x7D27;&#x6025;<code>bug</code>&#x9700;&#x8981;&#x4FEE;&#x590D;&#xFF0C;&#x6B64;&#x65F6;&#x5F00;&#x53D1;&#x4E2D;&#x7684;&#x529F;&#x80FD;&#x53C8;&#x6CA1;&#x6709;&#x5B8C;&#x6210;&#x4F60;&#x4E0D;&#x60F3;&#x63D0;&#x4EA4;&#xFF0C;&#x6B64;&#x65F6;&#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>git stash</code>&#x5C06;&#x5DE5;&#x4F5C;&#x533A;&#x7684;&#x6587;&#x4EF6;&#x90FD;&#x5B58;&#x653E;&#x8D77;&#x6765;&#x3002;&#x8FD9;&#x65F6;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;&#x653E;&#x5FC3;&#x7684;&#x53BB;&#x5207;&#x5206;&#x652F;&#x4FEE;&#x590D;<code>bug</code>&#xFF0C;&#x4FEE;&#x590D;&#x5B8C;&#x4E4B;&#x540E;&#x6267;&#x884C;<code>git stash pop</code>&#x53EF;&#x4EE5;&#x5C06;&#x5148;&#x524D;&#x5B58;&#x653E;&#x7684;&#x53D6;&#x51FA;&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x7684;&#x76F8;&#x5173;&#x547D;&#x4EE4;&#x4F8B;&#x5982;&#xFF1A;<code>git stash list</code>&#x67E5;&#x770B;&#x5B58;&#x653E;&#x7684;&#x8BB0;&#x5F55;,<code>git stash drop</code>&#x4E22;&#x5F03;&#x5B58;&#x653E;&#x7684;&#x8BB0;&#x5F55;&#x3002;</p>\n<h2 id=\"tag\"><a href=\"#tag\" class=\"headerlink\" title=\"tag\"></a>tag</h2><p>&#x53EF;&#x80FD;&#x5728;&#x5F00;&#x53D1;&#x4E2D;&#x6211;&#x4EEC;&#x8981;&#x6253;&#x6807;&#x7B7E;<code>git tag tagName</code>&#xFF0C;&#x5E76;&#x4E14;&#x8981;&#x5C06;&#x76F8;&#x5E94;&#x7684;&#x6807;&#x7B7E;&#x63A8;&#x9001;&#x5230;&#x8FDC;&#x7A0B;&#x4ED3;&#x5E93;&#x4E2D;&#xFF0C;&#x6B64;&#x65F6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x8FDB;&#x884C;&#x63A8;&#x9001;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push --tags tagName</span><br></pre></td></tr></table></figure>\n<h2 id=\"amend\"><a href=\"#amend\" class=\"headerlink\" title=\"amend\"></a>amend</h2><p>&#x5F53;&#x4F60;<code>commit</code>&#x4EE5;&#x540E;&#xFF0C;&#x53D1;&#x73B0;&#x6709;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x6CA1;&#x6709;&#x52A0;&#x8FDB;&#x4E0A;&#x6B21;&#x7684;<code>commit</code>&#x4E2D;&#xFF0C;&#x6216;&#x8005;&#x53C8;&#x4FEE;&#x6539;&#x4E86;&#x4E00;&#x4E9B;&#x6587;&#x4EF6;&#x3002;&#x6B64;&#x65F6;&#x4F60;&#x5E76;&#x4E0D;&#x60F3;&#x589E;&#x52A0;&#x65B0;&#x7684;<code>commit</code>&#x4FE1;&#x606F;&#xFF0C;&#x53EA;&#x662F;&#x60F3;&#x5C06;&#x5176;&#x52A0;&#x5165;&#x5230;&#x4E0A;&#x6B21;&#x7684;<code>commit</code>&#x4E2D;&#x3002;&#x8FD9;&#x65F6;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit --amend &lt;file&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x5C06;&#x6682;&#x5B58;&#x533A;&#x7684;&#x6587;&#x4EF6;&#x52A0;&#x5165;&#x5176;&#x4E2D;,&#x5E76;&#x4E14;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x6B64;&#x65F6;&#x7684;<code>commit</code>&#x4FE1;&#x606F;&#x3002;</p>\n<h2 id=\"reset\"><a href=\"#reset\" class=\"headerlink\" title=\"reset\"></a>reset</h2><p><code>reset</code>&#x4E5F;&#x80FD;&#x5B9E;&#x73B0;&#x524D;&#x9762;&#x7684;<code>rm</code>&#x7684;&#x6548;&#x679C;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x6765;&#x66FF;&#x4EE3;&#x524D;&#x9762;&#x7684;<code>git rm --cached &lt;file&gt;</code>&#x547D;&#x4EE4;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reset HEAD &lt;file&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x4F46;<code>reset</code>&#x7528;&#x9014;&#x66F4;&#x5E7F;&#xFF0C;&#x7ED3;&#x5408;<code>soft</code>&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x56DE;&#x64A4;&#x5230;&#x4EFB;&#x610F;&#x7684;<code>commit</code>&#x8282;&#x70B9;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reset --soft index</span><br></pre></td></tr></table></figure>\n<p>&#x6267;&#x884C;&#x8BE5;&#x547D;&#x4EE4;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x56DE;&#x5230;<code>index</code>&#x5904;&#xFF0C;&#x5DE5;&#x4F5C;&#x533A;&#x4E0D;&#x53D8;&#x3001;&#x6682;&#x5B58;&#x533A;&#x56DE;&#x5230;&#x5F53;&#x65F6;&#x7684;<code>index</code>&#x5904;&#x3002;&#x53E6;&#x5916;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;<code>hard</code>&#x53C2;&#x6570;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reset --hard index</span><br></pre></td></tr></table></figure>\n<p>&#x4E0E;<code>soft</code>&#x53EF;&#x4EE5;&#x8BF4;&#x5BF9;&#x7ACB;&#xFF0C;&#x5B83;&#x7684;&#x6548;&#x679C;&#x5C31;&#x5728;&#x4E8E;&#x5DE5;&#x4F5C;&#x533A;&#x4E0E;&#x6682;&#x5B58;&#x533A;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x5B83;&#x4F1A;&#x6E05;&#x7A7A;&#x8FD9;&#x4E24;&#x4E2A;&#x533A;&#x3002;</p>\n<h2 id=\"rebase\"><a href=\"#rebase\" class=\"headerlink\" title=\"rebase\"></a>rebase</h2><p>&#x5BF9;&#x4E8E;<code>rebase</code>&#x662F;&#x91CD;&#x5B9A;&#x5411;&#x7684;&#x610F;&#x601D;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x5F53;&#x524D;&#x7684;&#x5206;&#x652F;&#x4E0E;&#x8FDC;&#x7A0B;&#x7684;&#x5206;&#x652F;<code>commit</code>&#x4FE1;&#x606F;&#x5B58;&#x5728;&#x5DEE;&#x5F02;&#x65F6;&#xFF0C;&#x4F1A;&#x63D0;&#x9192;&#x4F60;&#x6B64;&#x65F6;&#x4E0D;&#x80FD;&#x8FDB;&#x884C;<code>push</code>&#xFF0C;&#x5FC5;&#x987B;&#x5148;&#x5C06;&#x8FDC;&#x7A0B;&#x7684;<code>commit</code>&#x4FE1;&#x606F;&#x62C9;&#x53BB;&#x5230;&#x672C;&#x5730;&#x6765;&#xFF0C;&#x624D;&#x80FD;&#x8FDB;&#x884C;&#x63D0;&#x4EA4;&#x3002;&#x5BF9;&#x4E8E;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>rebase</code>&#x547D;&#x4EE4;&#x4E86;&#x3002;&#x5982;&#x4E0B;&#x5F53;&#x524D;&#x5904;&#x5728;<code>develop</code>&#x5206;&#x652F;</p>\n<p><img src=\"/2017/01/26/git&#x4F7F;&#x7528;&#x6742;&#x8BB0;/1.png\" alt=\"rebase\"></p>\n<p>&#x6B64;&#x65F6;&#x5E94;&#x8BE5;&#x5148;&#x6267;&#x884C;<code>rebase</code>&#x547D;&#x4EE4;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git fetch</span><br><span class=\"line\">git rebase origin/master</span><br></pre></td></tr></table></figure>\n<p>&#x6267;&#x884C;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x6700;&#x540E;&#x518D;<code>push</code>&#x5230;&#x8FDC;&#x7A0B;<code>master</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin master</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x7EC8;&#x5404;&#x4E2A;&#x5206;&#x652F;&#x7684;&#x60C5;&#x51B5;&#x5C31;&#x662F;&#x4E0A;&#x56FE;&#x7684;&#x6548;&#x679C;&#x4E86;&#x3002;&#x5982;&#x679C;&#x89C9;&#x5F97;&#x547D;&#x4EE4;&#x591A;&#x96BE;&#x8BB0;&#xFF0C;&#x8FD9;&#x91CC;&#x4E5F;&#x53EF;&#x7528;&#x4E00;&#x6761;&#x547D;&#x4EE4;&#x6765;&#x5B8C;&#x6210;&#x4E0A;&#x9762;&#x7684;&#x6548;&#x679C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git pull --rebase origin master</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x662F;<code>rebase</code>&#x7684;&#x7B80;&#x5355;&#x8FD0;&#x7528;&#xFF0C;&#x4E5F;&#x662F;&#x5E38;&#x89C1;&#x7684;&#x547D;&#x4EE4;&#x4E86;&#x3002;&#x4E0B;&#x9762;&#x4ECB;&#x7ECD;<code>rebase</code>&#x7684;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x53C2;&#x6570;<code>--onto</code>&#x3002;</p>\n<h3 id=\"&#x2013;onto\"><a href=\"#&#x2013;onto\" class=\"headerlink\" title=\"&#x2013;onto\"></a>&#x2013;onto</h3><p>&#x4F7F;&#x7528;&#x573A;&#x666F;&#xFF1A;&#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x4E2D;&#x6211;&#x4EEC;&#x90FD;&#x4F1A;&#x521B;&#x5EFA;&#x4E0D;&#x540C;&#x7684;&#x5206;&#x652F;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#x4E0D;&#x540C;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5F53;&#x4F60;&#x5728;&#x5206;&#x652F;<code>A</code>&#x4E0A;&#x521B;&#x5EFA;&#x4E86;&#x65B0;&#x5206;&#x652F;<code>B</code>&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#x529F;&#x80FD;&#x5E76;&#x4E14;&#x4E5F;&#x63D0;&#x4EA4;&#x4E86;&#x4E00;&#x4E9B;<code>commit</code>&#x65F6;&#xFF0C;&#x6B64;&#x65F6;&#x4F60;&#x53D1;&#x73B0;&#x539F;&#x6765;<code>A</code>&#x5206;&#x652F;&#x4E0A;&#x6709;&#x9519;&#x8BEF;&#x7684;<code>commit</code>&#xFF0C;&#x5982;&#x679C;&#x8981;<code>rebase</code>&#x5230;<code>master</code>&#x4E0A;&#x65F6;&#xFF0C;&#x4E0D;&#x80FD;&#x5C06;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x7684;<code>commit</code>&#x4E5F;&#x9644;&#x5E26;&#x4E0A;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5C31;&#x8BE5;<code>--onto</code>&#x5927;&#x663E;&#x795E;&#x901A;&#x4E86;&#x3002;</p>\n<p><img src=\"/2017/01/26/git&#x4F7F;&#x7528;&#x6742;&#x8BB0;/3.png\" alt=\"--onto\"></p>\n<p>&#x5F53;&#x524D;&#x5904;&#x5728;<code>B</code>&#x5206;&#x652F;&#xFF0C;&#x8981;&#x5F97;&#x5230;&#x4E0A;&#x9762;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x53EA;&#x9700;&#x6267;&#x884C;&#x5982;&#x4E0B;&#x547D;&#x4EE4;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git rebase --onto master &lt;b&#x7684;commit hash code&gt; B</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;&#x4E0D;&#x4EC5;&#x53EF;&#x4EE5;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x7684;&#x5206;&#x652F;&#xFF0C;&#x4E5F;&#x80FD;&#x4F5C;&#x7528;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;&#x5206;&#x652F;&#x4E0A;&#x3002;&#x6240;&#x4EE5;&#x9488;&#x5BF9;&#x4E0A;&#x9762;&#x7684;&#x60C5;&#x51B5;&#x53EF;&#x4EE5;&#x53EA;&#x5BF9;&#x5206;&#x652F;<code>B</code>&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x7B49;&#x4EF7;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git rebase --onto &lt;a&#x7684;commit hash code&gt; &lt;b&#x7684;commit hash code&gt; B</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x2013;interactive\"><a href=\"#&#x2013;interactive\" class=\"headerlink\" title=\"&#x2013;interactive\"></a>&#x2013;interactive</h3><p>&#x5F53;&#x6211;&#x4EEC;&#x8981;&#x4FEE;&#x6539;<code>commit</code>&#x4FE1;&#x606F;&#x7684;&#x540D;&#x79F0;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x4FEE;&#x6539;&#x7684;<code>commit</code>&#x5904;&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit --amend</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x4E0D;&#x662F;&#x7B2C;&#x4E00;&#x4E2A;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x8981;&#x4F7F;&#x7528;&#x5230;<code>rebase</code>&#x7684;<code>--interactive</code>&#x53EF;&#x9009;&#x53C2;&#x6570;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x7B80;&#x5199;&#x4E3A;<code>-i</code>&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git rebase -i &lt;commit hash code&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x53C2;&#x6570;&#x540E;&#x9762;&#x7684;<code>commit hash code</code>&#x4E3A;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x7684;<code>commit</code>&#x7684;&#x524D;&#x4E00;&#x4E2A;&#x3002;&#x6267;&#x884C;&#x4E4B;&#x540E;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x5982;&#x4E0B;&#x7C7B;&#x4F3C;&#x7684;&#x4FE1;&#x606F;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pick 137cf0a First coommit</span><br><span class=\"line\">pick 163dc38 Second commit</span><br><span class=\"line\"></span><br><span class=\"line\"># Rebase f9aee6e..163dc38 onto f9aee6e (2 command(s))</span><br><span class=\"line\">#</span><br><span class=\"line\"># Commands:</span><br><span class=\"line\"># p, pick = use commit</span><br><span class=\"line\"># r, reword = use commit, but edit the commit message</span><br><span class=\"line\"># e, edit = use commit, but stop for amending</span><br><span class=\"line\"># s, squash = use commit, but meld into previous commit</span><br><span class=\"line\"># f, fixup = like &quot;squash&quot;, but discard this commit&apos;s log message</span><br><span class=\"line\"># x, exec = run command (the rest of the line) using shell</span><br><span class=\"line\">#</span><br><span class=\"line\"># These lines can be re-ordered; they are executed from top to bottom.</span><br><span class=\"line\">#</span><br><span class=\"line\"># If you remove a line here THAT COMMIT WILL BE LOST.</span><br><span class=\"line\">#</span><br><span class=\"line\"># However, if you remove everything, the rebase will be aborted.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Note that empty commits are commented out</span><br></pre></td></tr></table></figure>\n<p>&#x6839;&#x636E;&#x63D0;&#x793A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6709;<code>6</code>&#x4E2A;&#x53EF;&#x9009;&#x62E9;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x76F8;&#x4FE1;&#x63D0;&#x793A;&#x5DF2;&#x7ECF;&#x8BF4;&#x7684;&#x5F88;&#x660E;&#x663E;&#x4E86;&#xFF0C;&#x5BF9;&#x4E8E;&#x6211;&#x4EEC;&#x8FD9;&#x79CD;&#x8981;&#x4FEE;&#x6539;<code>First coommit</code>&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;<code>r</code>&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r 137cf0a First commit</span><br><span class=\"line\">pick 163dc38 Second commit</span><br></pre></td></tr></table></figure>\n<p>&#x6267;&#x884C;&#x4E4B;&#x540E;&#x4F1A;&#x8DF3;&#x5230;&#x4FEE;&#x8BE5;<code>First coomit</code>&#x7684;&#x754C;&#x9762;&#xFF0C;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x5373;&#x53EF;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">First commit</span><br><span class=\"line\"></span><br><span class=\"line\"># Please enter the commit message for your changes. Lines starting</span><br><span class=\"line\"># with &apos;#&apos; will be ignored, and an empty message aborts the commit.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Date:      Thu Jan 26 23:07:10 2017 +0800</span><br><span class=\"line\">#</span><br><span class=\"line\"># rebase in progress; onto f9aee6e</span><br><span class=\"line\"># You are currently editing a commit while rebasing branch &apos;master&apos; on &apos;f9aee6e&apos;.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Changes to be committed:</span><br><span class=\"line\">#       new file:   file1</span><br></pre></td></tr></table></figure>\n<p>&#x81F3;&#x4E8E;&#x5176;&#x4ED6;&#x7684;&#x64CD;&#x4F5C;&#x9879;&#xFF0C;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x53BB;&#x5C1D;&#x8BD5;&#x4E00;&#x4E0B;&#x3002;&#x4F8B;&#x5982;<code>s</code>&#x64CD;&#x4F5C;&#x5C31;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x5408;&#x5E76;<code>commit</code>&#x3002;</p>\n<h2 id=\"branch\"><a href=\"#branch\" class=\"headerlink\" title=\"branch\"></a>branch</h2><p>&#x76F8;&#x4FE1;<code>branch</code>&#x90FD;&#x5F88;&#x719F;&#x6089;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x8981;&#x8BF4;&#x7684;&#x662F;&#x4ED6;&#x7684;&#x53E6;&#x4E00;&#x79CD;&#x53EF;&#x80FD;&#x4F1A;&#x7528;&#x5230;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x573A;&#x666F;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;&#x5982;&#x679C;&#x5728;&#x4F60;&#x8FDB;&#x884C;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x5206;&#x652F;&#x65F6;&#xFF0C;&#x5E76;&#x4E0D;&#x60F3;&#x4ECE;&#x5F53;&#x524D;&#x7684;<code>commit</code>&#x4FE1;&#x606F;&#x8282;&#x70B9;&#x8FDB;&#x884C;&#x521B;&#x5EFA;&#x5206;&#x652F;&#x3002;</p>\n<p><img src=\"/2017/01/26/git&#x4F7F;&#x7528;&#x6742;&#x8BB0;/2.png\" alt=\"branch\"></p>\n<p>&#x8981;&#x5B9E;&#x73B0;&#x5982;&#x4E0A;&#x6548;&#x679C;&#x53EA;&#x9700;&#x5728;&#x521B;&#x5EFA;&#x5206;&#x652F;&#x65F6;&#x5728;&#x540E;&#x9762;&#x518D;&#x6DFB;&#x52A0;&#x989D;&#x5916;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x8BE5;&#x53C2;&#x6570;&#x5C31;&#x662F;&#x4F60;&#x6240;&#x9700;&#x8C03;&#x5230;&#x7684;<code>commit</code>&#x8282;&#x70B9;&#x7684;<code>hash code</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch new_branch &lt;commit hash code&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"push\"><a href=\"#push\" class=\"headerlink\" title=\"push\"></a>push</h2><p>&#x8FD9;&#x91CC;&#x63D0;&#x4E00;&#x4E0B;<code>push</code>&#x7684;<code>--set-upstream</code>,&#x5B83;&#x7684;&#x6548;&#x679C;&#x662F;&#x8BBE;&#x7F6E;&#x4E0A;&#x6E38;&#x5206;&#x652F;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x5C06;&#x8FDC;&#x7A0B;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x672C;&#x5730;&#x5206;&#x652F;&#x63A8;&#x9001;&#x5230;&#x8FDC;&#x7A0B;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5728;&#x63A8;&#x9001;&#x7684;&#x5206;&#x652F;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x4F1A;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x8FDB;&#x884C;&#x63A8;&#x9001;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout push_branch</span><br><span class=\"line\">git push origin push_branch</span><br></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x662F;&#x7B80;&#x6D01;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F7F;&#x7528;&#x8BE5;&#x53C2;&#x6570;&#x65E0;&#x9700;&#x5207;&#x6362;&#x5206;&#x652F;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x8FDB;&#x884C;&#x63A8;&#x9001;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push --set-upstream origin push_branch</span><br></pre></td></tr></table></figure>\n<h2 id=\"cherry-pick\"><a href=\"#cherry-pick\" class=\"headerlink\" title=\"cherry-pick\"></a>cherry-pick</h2><p>&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x7684;&#x573A;&#x666F;&#x662F;&#xFF1A;&#x5F53;&#x4F60;&#x6240;&#x5728;&#x7684;&#x5206;&#x652F;&#x6CA1;&#x7528;&#xFF0C;&#x4F60;&#x8981;&#x5220;&#x9664;&#x5B83;&#xFF0C;&#x4F46;&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;<code>commit</code>&#x4F60;&#x8FD8;&#x662F;&#x60F3;&#x63A8;&#x9001;&#x5230;&#x8FDC;&#x7A0B;<code>master</code>&#x4E0A;&#x3002;<br><img src=\"/2017/01/26/git&#x4F7F;&#x7528;&#x6742;&#x8BB0;/4.png\" alt=\"cherry-pick\"></p>\n<p>&#x5C06;&#x5206;&#x652F;&#x5207;&#x6362;&#x5230;<code>master</code>&#xFF0C;&#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git cherry-pick &lt;b&#x7684; commit hash code&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"merge\"><a href=\"#merge\" class=\"headerlink\" title=\"merge\"></a>merge</h2><p>&#x6211;&#x4EEC;&#x6240;&#x719F;&#x77E5;&#x7684;&#x662F;&#x4F7F;&#x7528;<code>merge</code>&#x6765;&#x8FDB;&#x884C;&#x5206;&#x652F;&#x7684;&#x5408;&#x5E76;&#xFF0C;&#x6BCF;&#x6B21;&#x4F7F;&#x7528;<code>merge</code>&#x65F6;&#x90FD;&#x4F1A;&#x81EA;&#x52A8;&#x5C06;&#x526F;&#x5206;&#x652F;&#x5408;&#x5E76;&#x6210;&#x4E00;&#x4E2A;<code>commit</code>&#x8FDB;&#x884C;&#x63A8;&#x9001;&#x5230;&#x4E3B;&#x5206;&#x652F;&#x4E0A;&#xFF0C;&#x90A3;&#x4E48;&#x5982;&#x679C;&#x6211;&#x4E0D;&#x60F3;&#x5B83;&#x81EA;&#x52A8;&#x63A8;&#x9001;&#x5230;&#x4E3B;&#x5206;&#x652F;&#x4E0A;&#x65F6;&#xFF08;&#x53EF;&#x80FD;&#x6211;&#x8FD8;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF09;&#xFF0C;&#x8FD9;&#x65F6;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>--squash</code>&#x64CD;&#x4F5C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git merge --squash dev_branch</span><br></pre></td></tr></table></figure>\n<p>&#x6267;&#x884C;&#x5B8C;&#x4EE5;&#x4E0A;&#x547D;&#x4EE4;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x6682;&#x5B58;&#x533A;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x8FD8;&#x672A;&#x63D0;&#x4EA4;&#x7684;&#x6587;&#x4EF6;&#x72B6;&#x6001;&#x3002;</p>\n<h2 id=\"reflog\"><a href=\"#reflog\" class=\"headerlink\" title=\"reflog\"></a>reflog</h2><p>&#x5F53;&#x6211;&#x4EEC;&#x5207;&#x5206;&#x652F;&#x592A;&#x9891;&#x7E41;&#x4E86;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5FD8;&#x4E86;&#x4E00;&#x4E9B;&#x5206;&#x652F;&#x662F;&#x4ECE;&#x54EA;&#x4E2A;&#x5206;&#x652F;&#x5207;&#x8FC7;&#x6765;&#x7684;&#xFF0C;&#x6B64;&#x65F6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x67E5;&#x770B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reflog</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">894a16d HEAD@{0}: commit: commit another todo</span><br><span class=\"line\">6876e5b HEAD@{1}: checkout: moving from solve_world_hunger to kill_the_batman</span><br><span class=\"line\">324336a HEAD@{2}: commit: commit todo</span><br><span class=\"line\">6876e5b HEAD@{3}: checkout: moving from blowup_sun_for_ransom to solve_world_hunger</span><br><span class=\"line\">6876e5b HEAD@{4}: checkout: moving from kill_the_batman to blowup_sun_for_ransom</span><br><span class=\"line\">6876e5b HEAD@{5}: checkout: moving from cure_common_cold to kill_the_batman</span><br><span class=\"line\">6876e5b HEAD@{6}: commit (initial): initial commit</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6240;&#x7528;&#x7684;&#x64CD;&#x4F5C;&#x5386;&#x53F2;&#x4E86;&#x3002;&#x8FD9;&#x6837;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<code>git reset</code>&#x547D;&#x4EE4;&#x4E0D;&#x5C0F;&#x5FC3;&#x5220;&#x9664;&#x4E86;&#x9700;&#x8981;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6B64;&#x6765;&#x67E5;&#x627E;&#x5230;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#x7684;<code>hash code</code>&#xFF0C;&#x4E4B;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x8FDB;&#x884C;&#x6062;&#x590D;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout &lt;hash code&gt;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x76EE;&#x524D;&#x60F3;&#x5230;&#x7684;&#x5C31;&#x8FD9;&#x4E9B;&#x4E86;&#xFF0C;&#x5E0C;&#x671B;&#x80FD;&#x6709;&#x6240;&#x5E2E;&#x52A9;</em></p>\n</blockquote>\n","categories":["git"],"tags":["git"]},{"title":"Andorid多渠道打包","url":"https://www.rousetime.com/2017/01/02/Andorid多渠道打包/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p><code>2016</code>&#x521A;&#x521A;&#x8FC7;&#x53BB;&#xFF0C;&#x81EA;&#x5DF1;&#x5199;&#x535A;&#x5BA2;&#x662F;&#x5728;<code>2016.03.04</code>&#xFF0C;&#x5176;&#x5B9E;&#x8FD9;&#x4E2A;&#x65E5;&#x5B50;&#x5F88;&#x7279;&#x522B;&#xFF0C;&#x4E5F;&#x5F88;&#x6709;&#x620F;&#x5267;&#x8272;&#x5F69;(&#x5185;&#x5E55;&#x6211;&#x73B0;&#x5728;&#x662F;&#x4E0D;&#x4F1A;&#x544A;&#x8BC9;&#x4F60;&#x4EEC;&#x6EF4;&#xFF0C;&#x731C;&#x53BB;&#x5427;&#xFF01;)&#x3002;&#x6D4F;&#x89C8;&#x4E86;&#x4E0B;&#x81EA;&#x5DF1;&#x53BB;&#x5E74;&#x7684;&#x6210;&#x679C;&#xFF0C;&#x6587;&#x7AE0;&#x6570;&#x91CF;&#x8FD8;&#x662F;&#x5F88;&#x53EF;&#x89C2;&#x7684;&#xFF0C;&#x8D77;&#x521D;&#x7684;&#x4E00;&#x4E2A;&#x6708;<code>4</code>&#x7BC7;&#x5230;&#x540E;&#x9762;&#x7684;&#x4E00;&#x4E2A;&#x6708;<code>1</code>&#x7BC7;&#x3002;&#x73B0;&#x5728;&#x81EA;&#x5DF1;&#x4E5F;&#x8981;&#x5DE5;&#x4F5C;&#xFF0C;&#x4E0D;&#x518D;&#x50CF;&#x539F;&#x6765;&#x5728;&#x5B66;&#x6821;&#x90A3;&#x4E48;&#x591A;&#x65F6;&#x95F4;&#xFF0C;&#x4ECE;&#x6700;&#x8FD1;&#x7684;&#x535A;&#x5BA2;&#x66F4;&#x65B0;&#x6765;&#x770B;&#xFF0C;&#x53D1;&#x73B0;&#x81EA;&#x5DF1;&#x6700;&#x8FD1;&#x5077;&#x61D2;&#x4E86;&#x54E6;(&#x5077;&#x61D2;&#x786E;&#x5B9E;&#x5F88;&#x723D;)&#xFF01;&#x65B0;&#x7684;&#x4E00;&#x5E74;&#x7ED9;&#x6211;&#x4E00;&#x51FB;&#x8B66;&#x949F;&#xFF0C;&#x6211;&#x4E0D;&#x80FD;&#x8352;&#x5E9F;&#x6211;&#x7684;&#x535A;&#x5BA2;&#xFF0C;&#x6211;&#x8981;&#x91CD;&#x62FE;&#x6211;&#x7684;&#x521D;&#x8877;&#x3002;<code>&#x5728;&#x6B64;&#x501F;&#x52A9;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x7ACB;&#x4E0B;&#x8BC1;&#x636E;</code>&#x3002;</p>\n<p>&#x65B0;&#x7684;&#x4E00;&#x5E74;&#x65B0;&#x7684;&#x5F00;&#x59CB;&#xFF0C;&#x4E00;&#x6B65;&#x4E00;&#x4E2A;&#x811A;&#x5370;&#x8FCE;&#x63A5;<code>2017</code></p>\n<hr>\n<h1 id=\"&#x6B63;&#x6587;\"><a href=\"#&#x6B63;&#x6587;\" class=\"headerlink\" title=\"&#x6B63;&#x6587;\"></a>&#x6B63;&#x6587;</h1><p>&#x611F;&#x8C22;&#x503E;&#x542C;&#x6211;&#x7684;&#x611F;&#x6168;&#xFF0C;&#x4E0B;&#x9762;&#x6B63;&#x5F0F;&#x8FDB;&#x5165;&#x4E3B;&#x9898;&#x3002;&#x5173;&#x4E8E;&#x8FD9;&#x6B21;&#x7684;&#x591A;&#x6E20;&#x9053;&#x6253;&#x5305;&#x4E5F;&#x662F;&#x5728;&#x5DE5;&#x4F5C;&#x4E2D;&#x624D;&#x8BA4;&#x8BC6;&#x6709;&#x8FD9;&#x4E00;&#x56DE;&#x4E8B;&#xFF0C;&#x539F;&#x6765;&#x5728;&#x5B66;&#x6821;&#x66F4;&#x672C;&#x4E0D;&#x4F1A;&#x63A5;&#x89E6;&#x5230;&#x8FD9;&#x4E9B;&#xFF0C;<code>&#x793E;&#x4F1A;&#x662F;&#x6700;&#x597D;&#x7684;&#x8001;&#x5E08;</code>&#x3002;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E00;&#x4E2A;<code>App</code>&#x90FD;&#x8981;&#x53D1;&#x5E03;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x5E73;&#x53F0;&#xFF0C;&#x56E0;&#x6B64;&#x5C31;&#x6709;&#x4E86;&#x8BB8;&#x591A;&#x7684;&#x6E20;&#x9053;(360&#x3001;baidu&#x3001;xiaomi&#x3001;91&#x3001;oppo&#x7B49;)&#xFF0C;&#x800C;&#x516C;&#x53F8;&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x8FFD;&#x8E2A;&#x7528;&#x6237;&#x5BF9;&#x4EA7;&#x54C1;&#x7684;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF0C;&#x8981;&#x5BF9;&#x4E0D;&#x540C;&#x6E20;&#x9053;&#x4E0B;&#x8F7D;&#x7684;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x7EDF;&#x8BA1;&#x3002;&#x81F3;&#x4E8E;&#x7EDF;&#x8BA1;&#x73B0;&#x5728;&#x5927;&#x591A;&#x6570;&#x90FD;&#x662F;&#x4F7F;&#x7528;&#x53CB;&#x76DF;&#x3002;&#x5982;&#x4F55;&#x7EDF;&#x8BA1;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x770B;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x3002;&#x6240;&#x4EE5;&#x5BF9;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x6E20;&#x9053;&#x6211;&#x4EEC;&#x8981;&#x5206;&#x522B;&#x6253;&#x5305;&#xFF0C;&#x5F53;&#x7136;&#x8FD9;&#x4E5F;&#x662F;<code>Android</code>&#x591A;&#x5E73;&#x53F0;&#x7684;&#x7F18;&#x6545;&#xFF0C;&#x76F8;&#x5BF9;&#x4E8E;<code>IOS</code>&#x5374;&#x6CA1;&#x6709;&#x8FD9;&#x4E48;&#x4E00;&#x56DE;&#x4E8B;&#x3002;&#x73B0;&#x5728;&#x6E20;&#x9053;&#x6709;<code>900</code>&#x591A;&#x4E2A;&#xFF0C;&#x4E00;&#x822C;&#x6253;&#x4E00;&#x6B21;&#x5305;&#x5C31;&#x8981;<code>3~4</code>&#x5206;&#x949F;&#xFF0C;&#x50CF;&#x6211;&#x516C;&#x53F8;&#x8981;&#x9488;&#x5BF9;<code>66</code>&#x4E2A;&#x6E20;&#x9053;&#x8FDB;&#x884C;&#x6253;&#x5305;&#x3002;&#x5982;&#x679C;&#x6309;&#x90E8;&#x5C31;&#x73ED;&#x6765;&#x90A3;&#x5C31;&#x8981;<code>3~4</code>&#x4E2A;&#x5C0F;&#x65F6;&#x4E86;&#xFF08;&#x54C7;&#x597D;&#x723D;&#x554A;&#xFF0C;&#x534A;&#x5929;&#x5DE5;&#x4F5C;&#x65F6;&#x95F4;&#x5C31;&#x8FC7;&#x53BB;&#x4E86;&#xFF0C;&#x5077;&#x61D2;&#x6210;&#x529F;&#xFF09;&#x8FD9;&#x6837;&#x5DE5;&#x4F5C;&#x6548;&#x7387;&#x5B8C;&#x5168;&#x88AB;&#x8FD9;&#x79CD;&#x65E0;&#x610F;&#x4E49;&#x7684;&#x4E1C;&#x897F;&#x6D6A;&#x8D39;&#x4E86;&#x3002;&#x5982;&#x679C;&#x628A;&#x8FD9;&#x4E9B;&#x65F6;&#x95F4;&#x7528;&#x6765;&#x64A9;&#x59B9;&#x7EC8;&#x8EAB;&#x5927;&#x4E8B;&#x5C31;&#x4E0D;&#x6101;&#x4E86;&#xFF08;&#x563B;&#x563B;&#xFF09;&#x3002;</p>\n<h2 id=\"&#x89E3;&#x51B3;\"><a href=\"#&#x89E3;&#x51B3;\" class=\"headerlink\" title=\"&#x89E3;&#x51B3;\"></a>&#x89E3;&#x51B3;</h2><h3 id=\"&#x6700;&#x57FA;&#x672C;&#x65B9;&#x5F0F;\"><a href=\"#&#x6700;&#x57FA;&#x672C;&#x65B9;&#x5F0F;\" class=\"headerlink\" title=\"&#x6700;&#x57FA;&#x672C;&#x65B9;&#x5F0F;\"></a>&#x6700;&#x57FA;&#x672C;&#x65B9;&#x5F0F;</h3><p>&#x6700;&#x57FA;&#x672C;&#x7684;&#x8BBE;&#x7F6E;&#x6E20;&#x9053;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#x5728;<code>AndroidManifest.xml</code>&#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x4E49;<code>&lt;meta-data&gt;</code>&#x5143;&#x7D20;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;meta-data</span><br><span class=\"line\">    android:name=&quot;UMENG_CHANNEL&quot;</span><br><span class=\"line\">    android:value=&quot;Channel_ID&quot; /&gt;</span><br><span class=\"line\">&lt;meta-data</span><br><span class=\"line\">\tandroid:name=&quot;UMENG_CHANNEL&quot;</span><br><span class=\"line\">   \tandroid:value=&quot;web&quot; /&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x662F;&#x4F7F;&#x7528;&#x4E86;&#x53CB;&#x76DF;&#x7EDF;&#x8BA1;&#xFF0C; &#x4E0A;&#x9762;&#x7684;<code>web</code>&#x5C31;&#x662F;&#x6E20;&#x9053;&#x540D;&#xFF0C;&#x4E0D;&#x540C;&#x6E20;&#x9053;&#x5BF9;&#x5E94;&#x4E0D;&#x540C;&#x7684;&#x503C;&#x3002;&#x5BF9;&#x4E8E;&#x6E20;&#x9053;&#x5C11;&#x7684;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;<code>build.gradle</code>&#x4E2D;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;<code>productFlavors</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">productFlavors {</span><br><span class=\"line\">        xiaomi {</span><br><span class=\"line\">            manifestPlaceholders = [UMENG_CHANNEL_VALUE: &quot;xiaomi&quot;]</span><br><span class=\"line\">        }</span><br><span class=\"line\">        _360 {</span><br><span class=\"line\">            manifestPlaceholders = [UMENG_CHANNEL_VALUE: &quot;_360&quot;]</span><br><span class=\"line\">        }</span><br><span class=\"line\">        baidu {</span><br><span class=\"line\">            manifestPlaceholders = [UMENG_CHANNEL_VALUE: &quot;baidu&quot;]</span><br><span class=\"line\">        }</span><br><span class=\"line\">        wandoujia {</span><br><span class=\"line\">            manifestPlaceholders = [UMENG_CHANNEL_VALUE: &quot;wandoujia&quot;]</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x6216;&#x8005;&#x7EDF;&#x4E00;&#x4FEE;&#x6539;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">productFlavors {</span><br><span class=\"line\">        xiaomi {}</span><br><span class=\"line\">        _360 {}</span><br><span class=\"line\">        baidu {}</span><br><span class=\"line\">        wandoujia {}</span><br><span class=\"line\">    }  </span><br><span class=\"line\">    productFlavors.all { </span><br><span class=\"line\">        flavor -&gt; flavor.manifestPlaceholders = [UMENG_CHANNEL_VALUE: name] </span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x662F;&#x9488;&#x5BF9;&#x6E20;&#x9053;&#x5C11;&#x7684;&#xFF0C;&#x4E5F;&#x662F;&#x6700;&#x57FA;&#x672C;&#x7684;&#x65B9;&#x5F0F;&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x6E20;&#x9053;&#x8FC7;&#x591A;&#x7684;&#xFF0C;&#x4F8B;&#x5982;&#x6211;&#x73B0;&#x5728;&#x9047;&#x5230;&#x7684;<code>60</code>&#x591A;&#x4E2A;&#xFF0C;&#x53C8;&#x8BE5;&#x5982;&#x4F55;&#x89E3;&#x51B3;&#x5462;&#xFF1F;</p>\n<h3 id=\"&#x4F18;&#x5316;&#x65B9;&#x5F0F;\"><a href=\"#&#x4F18;&#x5316;&#x65B9;&#x5F0F;\" class=\"headerlink\" title=\"&#x4F18;&#x5316;&#x65B9;&#x5F0F;\"></a>&#x4F18;&#x5316;&#x65B9;&#x5F0F;</h3><p>&#x8FD9;&#x91CC;&#x501F;&#x52A9;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;<code>packer-ng</code>&#xFF0C;&#x8FDB;&#x884C;&#x5FEB;&#x901F;&#x6253;&#x5305;&#xFF0C;&#x5B83;&#x53EA;&#x9700;&#x6267;&#x884C;&#x4E00;&#x6B21;&#x6B63;&#x5E38;&#x7684;&#x6253;&#x5305;&#x64CD;&#x4F5C;&#xFF0C;&#x5269;&#x4E0B;&#x7684;&#x6E20;&#x9053;&#x6BCF;&#x4E2A;&#x4EE5;<code>1</code>&#x79D2;&#x4EE5;&#x5185;&#x7684;&#x901F;&#x5EA6;&#x8FDB;&#x884C;&#x6253;&#x5305;&#x3002;&#x901F;&#x5EA6;&#x662F;&#x4E0D;&#x662F;&#x975E;&#x5E38;&#x53EF;&#x89C2;&#x5462;(&#x9EBB;&#x9EBB;&#x518D;&#x4E5F;&#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#x6211;&#x7684;&#x6548;&#x7387;&#x4E86;)&#x3002;</p>\n<p>&#x9996;&#x5148;&#x5728;&#x9879;&#x76EE;&#x7684;&#x6839;&#x76EE;&#x5F55;&#x7684;<code>bulid.gradle</code>&#x4E2D;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">        classpath &apos;com.mcxiaoke.gradle:packer-ng:1.0.8&apos;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x518D;&#x5207;&#x6362;&#x5230;<code>app</code>&#x4E0B;&#x7684;<code>build.gradle</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply plugin: &apos;packer&apos;</span><br><span class=\"line\"> </span><br><span class=\"line\">signingConfigs {</span><br><span class=\"line\">        release {</span><br><span class=\"line\">            //&#x7701;&#x7565;&#x76F8;&#x5173;&#x914D;&#x7F6E;</span><br><span class=\"line\">            ....</span><br><span class=\"line\">            //&#x5982;&#x679C;&#x4F60;&#x7684;gradle&#x7248;&#x672C;&#x8D85;&#x8FC7;2.14.1</span><br><span class=\"line\">            //gradle plugin&#x7248;&#x672C;&#x8D85;&#x8FC7;2.2.0 &#x5C31;&#x8981;&#x8BBE;&#x7F6E;&#x8BE5;&#x9879;</span><br><span class=\"line\">            //&#x4E3A;&#x4E86;&#x7981;&#x7528;&#x9ED8;&#x8BA4;&#x7684;v2&#x7248;&#x7B7E;&#x540D;&#x6A21;&#x5F0F;</span><br><span class=\"line\">            v2SigningEnabled false</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">     </span><br><span class=\"line\">dependencies {</span><br><span class=\"line\">    compile &apos;com.mcxiaoke.gradle:packer-helper:1.0.8&apos;</span><br><span class=\"line\">    }</span><br><span class=\"line\">     </span><br><span class=\"line\">packer {</span><br><span class=\"line\">        // &#x6307;&#x5B9A;&#x6E20;&#x9053;&#x6253;&#x5305;&#x8F93;&#x51FA;&#x76EE;&#x5F55;</span><br><span class=\"line\">         archiveOutput = file(new File(project.rootProject.buildDir.path, &quot;cyzs_apks&quot;))</span><br><span class=\"line\">        // &#x6307;&#x5B9A;&#x6E20;&#x9053;&#x6253;&#x5305;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x540D;&#x683C;&#x5F0F;</span><br><span class=\"line\">        // &#x9ED8;&#x8BA4;&#x662F; `${appPkg}-${flavorName}-${buildType}-v${versionName}-${versionCode}`</span><br><span class=\"line\">         archiveNameFormat = &apos;cyzs.${versionName}.${flavorName}&apos;</span><br><span class=\"line\">        // &#x662F;&#x5426;&#x68C0;&#x67E5;Gradle&#x914D;&#x7F6E;&#x4E2D;&#x7684;signingConfig&#xFF0C;&#x9ED8;&#x8BA4;&#x4E0D;&#x68C0;&#x67E5;</span><br><span class=\"line\">        // checkSigningConfig = false</span><br><span class=\"line\">        // &#x662F;&#x5426;&#x68C0;&#x67E5;Gradle&#x914D;&#x7F6E;&#x4E2D;&#x7684;zipAlignEnabled&#xFF0C;&#x9ED8;&#x8BA4;&#x4E0D;&#x68C0;&#x67E5;</span><br><span class=\"line\">        // checkZipAlign = false</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x662F;&#x5173;&#x4E8E;<code>gradle</code>&#x65B9;&#x9762;&#x7684;&#xFF0C;&#x65E2;&#x7136;&#x73B0;&#x5728;&#x4E0D;&#x5728;<code>AndroidManifes.xml</code>&#x4E2D;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;&#x6E20;&#x9053;&#xFF0C;&#x5C31;&#x8981;&#x53E6;&#x5BFB;&#x5B83;&#x6CD5;&#xFF0C;&#x8FD9;&#x91CC;&#x5728;&#x9879;&#x76EE;&#x7684;&#x6839;&#x76EE;&#x5F55;&#x521B;&#x5EFA;<code>marktes.txt</code>&#x6587;&#x672C;&#xFF0C;&#x6587;&#x672C;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x5C31;&#x662F;&#x6240;&#x9700;&#x7684;&#x6E20;&#x9053;&#xFF0C;&#x683C;&#x5F0F;&#x5982;&#x4E0B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">web</span><br><span class=\"line\">360</span><br><span class=\"line\">Tencent</span><br><span class=\"line\">baidu</span><br><span class=\"line\">91</span><br><span class=\"line\">Anzhuo</span><br><span class=\"line\">anzhi</span><br><span class=\"line\">Wandou</span><br><span class=\"line\">ppzhushou</span><br><span class=\"line\">Xiaomi</span><br><span class=\"line\">zhihuiyun</span><br><span class=\"line\">oppo</span><br><span class=\"line\">vivo</span><br></pre></td></tr></table></figure>\n<p>&#x65E2;&#x7136;&#x73B0;&#x5728;&#x89E3;&#x51B3;&#x4E86;&#x6E20;&#x9053;&#x7684;&#x5B9A;&#x4E49;&#xFF0C;&#x90A3;&#x4E48;&#x4E0B;&#x4E00;&#x6B65;&#x5C31;&#x662F;&#x5982;&#x4F55;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x8FDB;&#x884C;&#x8BFB;&#x53D6;&#x8BBE;&#x7F6E;&#x7684;&#x6E20;&#x9053;&#x4E86;&#xFF0C;&#x524D;&#x9762;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x7EE7;&#x627F;&#x4E86;&#x76F8;&#x5173;&#x7684;&#x5E93;&#xFF0C;&#x6240;&#x4EE5;&#x8BFB;&#x53D6;&#x4E5F;&#x975E;&#x5E38;&#x7B80;&#x5355;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">channel = PackerNg.getMarket(context);</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x5C31;&#x62FF;&#x5230;&#x4E86;&#x6E20;&#x9053;&#x540D;&#xFF0C;&#x540E;&#x7EED;&#x7684;&#x64CD;&#x4F5C;&#x5C31;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x64CD;&#x4F5C;&#x4E86;&#x3002;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x9700;&#x6C42;&#x6765;&#xFF0C;&#x4E00;&#x822C;&#x90FD;&#x662F;&#x5C06;&#x6E20;&#x9053;&#x4E0A;&#x4F20;&#x5230;&#x53CB;&#x76DF;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F;&#x6267;&#x884C;&#x6253;&#x5305;&#x4E86;&#xFF0C;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x6267;&#x884C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew -Pmarket=markets.txt clean apkRelease</span><br></pre></td></tr></table></figure>\n<p><code>-Pmarket</code>&#x662F;&#x4E3A;&#x4E86;&#x6307;&#x5B9A;&#x6E20;&#x9053;&#x5B58;&#x653E;&#x7684;&#x8DEF;&#x5F84;&#xFF0C;&#x6839;&#x76EE;&#x5F55;&#x4E2D;&#x76F4;&#x63A5;&#x4E3A;<code>markets.txt</code>&#xFF0C;<code>clean</code>&#x662F;&#x4E3A;&#x4E86;&#x6E05;&#x9664;&#x539F;&#x6765;&#x8F93;&#x51FA;&#x76EE;&#x5F55;&#x4E2D;&#x7684;<code>apk</code>&#xFF0C;<code>apk[buildType]</code>&#x662F;&#x6807;&#x660E;&#x6253;&#x4EC0;&#x4E48;&#x5305;&#x3002;&#x8FD9;&#x91CC;&#x662F;<code>release</code>&#x3002;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x7B80;&#x6D01;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x7701;&#x7565;<code>-Pmarket=markets.txt</code>&#x3002;&#x5982;&#x6B64;&#x9700;&#x8981;&#x5728;<code>gradle.properites</code>&#x4E2D;&#x8FDB;&#x884C;&#x914D;&#x7F6E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">market=markets.txt</span><br></pre></td></tr></table></figure>\n<p>&#x518D;&#x6267;&#x884C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew clean apkRelease</span><br></pre></td></tr></table></figure>\n<p>&#x597D;&#x4E86;&#xFF0C;&#x5927;&#x529F;&#x544A;&#x6210;&#xFF0C;&#x518D;&#x7B49;<code>3~4</code>&#x5206;&#x949F;&#x5C31;&#x5B8C;&#x7F8E;&#x6536;&#x5DE5;&#x4E86;&#x3002;&#x6700;&#x540E;&#x6253;&#x597D;&#x7684;<code>apk</code>&#x4F1A;&#x5728;&#x4E0A;&#x9762;&#x5B9A;&#x4E49;&#x7684;&#x8DEF;&#x5F84;&#x4E2D;,&#x4F8B;&#x5982;&#x5BF9;&#x4E8E;&#x4E0A;&#x9762;&#x6240;&#x5B9A;&#x4E49;&#x7684;&#x8DEF;&#x5F84;&#xFF1A;<code>&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;/build/cyzs_apks</code>&#x3002;</p>\n<p><img src=\"/2017/01/02/Andorid&#x591A;&#x6E20;&#x9053;&#x6253;&#x5305;/1.png\" alt=\"apks\"></p>\n<h2 id=\"&#x539F;&#x7406;\"><a href=\"#&#x539F;&#x7406;\" class=\"headerlink\" title=\"&#x539F;&#x7406;\"></a>&#x539F;&#x7406;</h2><p><code>Android</code>&#x5E94;&#x7528;&#x7684;<code>APK</code>&#x90FD;&#x662F;&#x4E00;&#x4E2A;<code>zip</code>&#x6587;&#x4EF6;&#xFF0C;&#x800C;<a href=\"https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT\" target=\"_blank\" rel=\"noopener\">zip&#x6587;&#x4EF6;&#x89C4;&#x5B9A;</a>&#x5728;&#x6BCF;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x672B;&#x5C3E;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x53EB;<a href=\"https://users.cs.jmu.edu/buchhofp/forensics/formats/pkzip.html\" target=\"_blank\" rel=\"noopener\">Central Directory Record</a>&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x5B83;&#x5305;&#x542B;&#x4E00;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x5B83;&#x7684;&#x672B;&#x5C3E;&#x662F;<code>apk</code>&#x7684;&#x6CE8;&#x91CA;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x501F;&#x52A9;&#x8FD9;&#x4E00;&#x70B9;&#x4FEE;&#x6539;&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5411;&#x5176;&#x4E2D;&#x52A0;&#x5165;&#x6211;&#x4EEC;&#x6240;&#x9700;&#x7684;&#x6E20;&#x9053;&#x540D;&#xFF0C;&#x4F46;&#x8FD9;&#x5374;&#x4E0D;&#x7834;&#x574F;<code>apk</code>&#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x6839;&#x672C;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x5C31;&#x662F;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x5BF9;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x8BFB;&#x4E0E;&#x5199;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x6700;&#x7EC8;&#x7684;&#x89E3;&#x51B3;&#x601D;&#x8DEF;&#x3002;    </p>\n<p>&#x5F53;&#x7136;&#x8FD8;&#x6709;&#x4E0D;&#x501F;&#x52A9;<code>gradle</code>&#x7684;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x884C;&#x6253;&#x5305;&#xFF0C;&#x5206;&#x522B;&#x6709;<code>java</code>&#x4E0E;<code>python</code>&#x811A;&#x672C;&#x3002;&#x4ECA;&#x5929;&#x65F6;&#x95F4;&#x6709;&#x70B9;&#x665A;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x5982;&#x9700;&#x4E86;&#x89E3;&#x7684;&#x53EF;&#x4EE5;&#x540E;&#x7EED;&#x518D;&#x5355;&#x72EC;&#x8BA8;&#x8BBA;&#x3002;</p>\n<blockquote>\n<p><em><code>2017</code>&#x7B2C;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x5B8C;&#x7F8E;&#x6536;&#x5DE5;</em></p>\n</blockquote>\n","categories":["android"],"tags":["打包"]},{"title":"使用Retrofit原生的最佳实践","url":"https://www.rousetime.com/2016/11/18/使用Retrofit原生的最佳实践/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p>&#x524D;&#x9762;&#x8BF4;&#x5230;&#x4E86;<code>Retrofit</code>&#x7684;&#x4E00;&#x4E9B;&#x7B80;&#x5355;&#x7684;&#x5165;&#x95E8;&#x4F7F;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x8FD8;&#x6CA1;&#x5165;&#x95E8;&#x7684;&#x63A8;&#x8350;&#x5148;&#x9605;&#x8BFB;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;<a href=\"https://idisfkj.github.io/2016/11/15/%E5%B8%A6%E4%BD%A0%E8%B5%B0%E8%BF%9BRetrofit%E7%9A%84%E6%96%B0%E4%B8%96%E7%95%8C/#Headers-And-Header\" target=\"_blank\" rel=\"noopener\">&#x5E26;&#x4F60;&#x8D70;&#x8FDB;Retrofit&#x7684;&#x65B0;&#x4E16;&#x754C;</a>&#xFF0C;&#x4ECA;&#x5929;&#x5C06;&#x76F4;&#x63A5;&#x4EE5;&#x5B9E;&#x8DF5;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x4ECB;&#x7ECD;<code>Retrofit</code><strong>&#x539F;&#x751F;</strong>&#x7684;&#x5404;&#x65B9;&#x9762;&#x7684;&#x5177;&#x4F53;&#x4F7F;&#x7528;&#xFF0C;&#x6709;&#x4E0D;&#x8DB3;&#x4E4B;&#x5904;&#x6B22;&#x8FCE;&#x6307;&#x51FA;&#x3002;&#x4E0B;&#x9762;&#x5C06;&#x8981;&#x4ECB;&#x7ECD;&#x7684;&#x5185;&#x5BB9;&#x4E3B;&#x8981;&#x4E3A;&#xFF1A;</p>\n<ul>\n<li><code>Retrofit</code>&#x7684;&#x5C01;&#x88C5;</li>\n<li><code>Converter</code>&#x7684;&#x4F7F;&#x7528;</li>\n<li><code>OkHttp</code>&#x7684;<code>Interceptor</code>&#x7684;&#x4F7F;&#x7528;</li>\n<li><code>url</code>&#x7684;&#x52A8;&#x6001;&#x8BBE;&#x7F6E;&#x4E0E;&#x8FD0;&#x884C;&#x65F6;<code>url</code>&#x7684;&#x8BBE;&#x7F6E;</li>\n<li><code>request</code>&#x7684;&#x91CD;&#x590D;&#x4F7F;&#x7528;&#x4E0E;&#x5206;&#x6790;</li>\n<li><code>Retrofit</code>&#x7684;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;</li>\n<li><code>Retrofit</code>&#x7684;&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;</li>\n</ul>\n<h2 id=\"Retrofit&#x7684;&#x5C01;&#x88C5;\"><a href=\"#Retrofit&#x7684;&#x5C01;&#x88C5;\" class=\"headerlink\" title=\"Retrofit&#x7684;&#x5C01;&#x88C5;\"></a>Retrofit&#x7684;&#x5C01;&#x88C5;</h2><p>&#x9996;&#x5148;&#x7ED9;&#x4E00;&#x4E2A;&#x5E38;&#x89C4;&#x7684;&#x5199;&#x6CD5;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface GithubService {</span><br><span class=\"line\">    @GET(&quot;/repos/{owner}/{repo}/contributors&quot;)</span><br><span class=\"line\">    Call&lt;List&lt;Contributors&gt;&gt; contributors(</span><br><span class=\"line\">            @Path(&quot;owner&quot;) String owner,</span><br><span class=\"line\">            @Path(&quot;repo&quot;) String repo);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Retrofit retrofit = new Retrofit.Builder()</span><br><span class=\"line\">                .baseUrl(&quot;https://api.github.com&quot;)</span><br><span class=\"line\">                .addConverterFactory(GsonConverterFactory.create())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"> </span><br><span class=\"line\">        GithubService service = retrofit.create(GithubService.class);</span><br><span class=\"line\">        Call&lt;List&lt;Contributors&gt;&gt; call = service.contributors(&quot;square&quot;, &quot;retrofit&quot;);</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x7684;&#x8BF7;&#x6C42;&#x4E00;&#x822C;&#x90FD;&#x5F88;&#x591A;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6BCF;&#x6B21;&#x90FD;&#x6362;&#x63A5;&#x53E3;&#x90FD;&#x8981;&#x91CD;&#x590D;&#x5199;<code>Retrofit</code>&#xFF0C;&#x4ECE;&#x800C;&#x4EA7;&#x751F;&#x4E86;&#x7D2F;&#x8D58;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x901A;&#x7528;&#x7684;<code>ServiceGenerator</code>,&#x5411;&#x5176;&#x4E2D;&#x4F20;&#x5165;&#x9700;&#x8981;&#x8C03;&#x7528;&#x7684;&#x63A5;&#x53E3;&#x7C7B;&#xFF0C;&#x8BA9;&#x5176;&#x8FD4;&#x56DE;&#x6211;&#x4EEC;&#x6240;&#x9700;&#x8981;&#x7684;&#x63A5;&#x53E3;&#x5B9E;&#x4F8B;&#x5373;&#x53EF;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class ServiceGenerator {</span><br><span class=\"line\">    public static String API_BASE_URL = &quot;https://api.github.com&quot;;</span><br><span class=\"line\">  </span><br><span class=\"line\">    private ServiceGenerator() {</span><br><span class=\"line\"> </span><br><span class=\"line\">    }</span><br><span class=\"line\">  </span><br><span class=\"line\">    private static OkHttpClient.Builder okHttpClient = new OkHttpClient.Builder();</span><br><span class=\"line\"> </span><br><span class=\"line\">    private static Retrofit.Builder builder = new Retrofit.Builder()</span><br><span class=\"line\">            .baseUrl(API_BASE_URL)</span><br><span class=\"line\">            .addConverterFactory(ScalarsConverterFactory.create())</span><br><span class=\"line\">            .addConverterFactory(GsonConverterFactory.create());</span><br><span class=\"line\">   </span><br><span class=\"line\">    public static &lt;S&gt; S createService(Class&lt;S&gt; serviceClass) {</span><br><span class=\"line\">        Retrofit retrofit = builder.client(okHttpClient.build()).build();</span><br><span class=\"line\">        return retrofit.create(serivceClass)</span><br><span class=\"line\">        }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x5C01;&#x88C5;&#x7684;<code>ServiceGenerator</code>&#x8FDB;&#x884C;&#x8C03;&#x7528;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GithubService service = ServiceGenerator.createService(GithubService.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">Call&lt;List&lt;Contributors&gt;&gt; call = service.contributors(&quot;square&quot;, &quot;retrofit&quot;);</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x662F;&#x4E0D;&#x662F;&#x7B80;&#x5355;&#x5F88;&#x591A;&#x4E86;&#x5462;&#xFF0C;&#x4E24;&#x884C;&#x4EE3;&#x7801;&#x5C31;&#x641E;&#x5B9A;</em></p>\n</blockquote>\n<h2 id=\"Converter&#x7684;&#x4F7F;&#x7528;\"><a href=\"#Converter&#x7684;&#x4F7F;&#x7528;\" class=\"headerlink\" title=\"Converter&#x7684;&#x4F7F;&#x7528;\"></a>Converter&#x7684;&#x4F7F;&#x7528;</h2><p><code>converter</code>&#x7684;&#x4F5C;&#x7528;&#x662F;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x8F6C;&#x5316;&#xFF0C;&#x9ED8;&#x8BA4;<code>Retrofit</code>&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x662F;<code>OkHttp</code>&#x7684;<code>RequestBody</code>&#x4E0E;<code>ResponseBody</code>,&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x5728;&#x5E94;&#x7528;&#x4E2D;&#x4F1A;&#x9047;&#x5230;&#x8BB8;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F8B;&#x5982;<code>JSON</code>&#x3001;<code>XML</code>&#x8FD9;&#x65F6;&#x4EEC;&#x5C31;&#x8981;&#x4F7F;&#x7528;&#x5230;<code>converter</code>&#x8FDB;&#x884C;&#x8F6C;&#x5316;&#x6210;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x503C;&#x5F97;&#x5E86;&#x5E78;&#x7684;&#x662F;&#x5B98;&#x65B9;&#x5DF2;&#x7ECF;&#x5E2E;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;&#x5927;&#x90E8;&#x5206;&#x5E38;&#x7528;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x8F6C;&#x5316;&#x3002;</p>\n<ul>\n<li>Gson: com.squareup.retrofit2:converter-gson</li>\n<li>Jackson: com.squareup.retrofit2:converter-jackson</li>\n<li>Moshi: com.squareup.retrofit2:converter-moshi</li>\n<li>Protobuf: com.squareup.retrofit2:converter-protobuf</li>\n<li>Wire: com.squareup.retrofit2:converter-wire</li>\n<li>Simple XML: com.squareup.retrofit2:converter-simplexml</li>\n<li>Scalars (primitives, boxed, and String): com.squareup.retrofit2:converter-scalars</li>\n</ul>\n<p>&#x53EA;&#x9700;&#x4E24;&#x6B65;&#x5C31;&#x80FD;&#x5FEB;&#x901F;&#x914D;&#x7F6E;&#x4F7F;&#x7528;&#xFF0C;&#x4F8B;&#x5982;<code>Gson</code></p>\n<p>1.&#x5728;<code>Gradle</code>&#x4E2D;&#x914D;&#x7F6E;&#x4E0E;<code>Retrofit</code>&#x5BF9;&#x4E8E;&#x7684;&#x7248;&#x672C;&#x53F7;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">compile &apos;com.squareup.retrofit2:converter-gson:2.1.0&apos;</span><br></pre></td></tr></table></figure>\n<p>2.&#x5728;<code>Retrofit.Builder</code>&#x4E2D;&#x901A;&#x8FC7;<code>.addConverterFactory()</code>&#x8FDB;&#x884C;&#x914D;&#x7F6E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Retrofit.Builder builder = new Retrofit.Builder()</span><br><span class=\"line\">            .baseUrl(API_DUOSHUO_URL)</span><br><span class=\"line\">            .addConverterFactory(GsonConverterFactory.create());</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x7528;&#x591A;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x7C7B;&#x578B;&#x6570;&#x636E;&#x5462;&#xFF1F;&#x4F8B;&#x5982;<code>Gson</code>&#x3001;<code>String</code>&#xFF0C;&#x653E;&#x5FC3;&#x4E5F;&#x662F;&#x901A;&#x8FC7;<code>.addConverterFactory()</code>&#x8FDB;&#x884C;&#x6DFB;&#x52A0;.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Retrofit.Builder builder = new Retrofit.Builder()</span><br><span class=\"line\">            .baseUrl(API_DUOSHUO_URL)</span><br><span class=\"line\">            .addConverterFactory(ScalarsConverterFactory.create())</span><br><span class=\"line\">            .addConverterFactory(GsonConverterFactory.create());</span><br></pre></td></tr></table></figure>\n<p>&#x81F3;&#x4E8E;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x51B2;&#x7A81;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;<code>Retrofit</code>&#x4F1A;&#x6309;&#x7167;&#x6DFB;&#x52A0;&#x7684;&#x987A;&#x5E8F;&#x8FDB;&#x884C;&#x5148;&#x540E;&#x7684;&#x5339;&#x914D;&#xFF0C;&#x76F4;&#x5230;&#x627E;&#x5230;&#x76F8;&#x9002;&#x5408;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x3002;&#x4E00;&#x822C;&#x63A8;&#x8350;&#x5C06;<code>Gson</code>&#x653E;&#x5230;&#x6700;&#x540E;&#x9762;&#x3002;</p>\n<h2 id=\"OkHttp&#x7684;Interceptor&#x7684;&#x4F7F;&#x7528;\"><a href=\"#OkHttp&#x7684;Interceptor&#x7684;&#x4F7F;&#x7528;\" class=\"headerlink\" title=\"OkHttp&#x7684;Interceptor&#x7684;&#x4F7F;&#x7528;\"></a>OkHttp&#x7684;Interceptor&#x7684;&#x4F7F;&#x7528;</h2><p>&#x5047;&#x8BBE;&#x6709;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x60C5;&#x5F62;&#xFF1A;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x90FD;&#x8981;&#x6DFB;&#x52A0;<code>Connection</code>&#x7684;&#x8BF7;&#x6C42;&#x5934;&#x90E8;&#xFF0C;&#x6839;&#x636E;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x5B66;&#x4E60;&#xFF0C;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Headers(&quot;Connection: keep-alive&quot;)</span><br><span class=\"line\">@POST(&quot;/login&quot;)</span><br><span class=\"line\">Call&lt;String&gt; loginService();</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x8981;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x90FD;&#x6DFB;&#x52A0;<code>@Headers</code>&#x5B57;&#x6BB5;&#x6216;&#x8005;&#x5728;&#x53C2;&#x6570;&#x4E2D;&#x6DFB;&#x52A0;<code>@Header</code>&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x6709;&#x70B9;&#x591A;&#x4F59;&#x4E0E;&#x9EBB;&#x70E6;&#x5462;&#x3002;&#x56E0;&#x4E3A;<code>Retrofit</code>&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x662F;&#x4EA4;&#x7ED9;<code>OkHttp</code>&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4E48;&#x53EF;&#x4EE5;&#x5BF9;<code>OkHttp</code>&#x5C42;&#x8FDB;&#x884C;&#x8BF7;&#x6C42;&#x4FE1;&#x606F;&#x7684;&#x4FEE;&#x6539;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<code>Interceptor</code>&#x5C31;&#x80FD;&#x5B8C;&#x7F8E;&#x7684;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;,&#x8C03;&#x7528;<code>OkHttp</code>&#x7684;<code>.addInterceptor()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x8FD8;&#x662F;&#x5728;<code>ServiceGenerator</code>&#x4E2D;&#x4FEE;&#x6539;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static &lt;S&gt; S createService(Class&lt;S&gt; serviceClass) {</span><br><span class=\"line\">okHttpClient.addInterceptor(new Interceptor() {</span><br><span class=\"line\">                @Override</span><br><span class=\"line\">                public Response intercept(Chain chain) throws IOException {</span><br><span class=\"line\">                    Request original = chain.request();</span><br><span class=\"line\"></span><br><span class=\"line\">                    Request.Builder builder = original.newBuilder()</span><br><span class=\"line\">                            .addHeader(&quot;Connection&quot;, &quot;keep-alive&quot;)</span><br><span class=\"line\">                            .method(original.method(), original.body());</span><br><span class=\"line\"> </span><br><span class=\"line\">                    Request request = builder.build();</span><br><span class=\"line\"> </span><br><span class=\"line\">                    return chain.proceed(request);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            });</span><br><span class=\"line\">Retrofit retrofit = builder.client(okHttpClient.build()).build();</span><br><span class=\"line\">return retrofit.create(serivceClass);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;<code>chain.request()</code>&#x83B7;&#x53D6;&#x539F;&#x6765;&#x7684;<code>request</code>&#xFF0C;&#x518D;&#x91CD;&#x65B0;&#x4F7F;&#x7528;<code>request.newBuilder()</code>&#x65B9;&#x6CD5;&#x6784;&#x9020;&#x65B0;&#x7684;<code>Request.Builder</code>&#xFF0C;&#x8FD9;&#x65F6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>.addHeader</code>&#x6216;&#x8005;<code>.Header</code>&#x65B9;&#x6CD5;&#x6765;&#x6DFB;&#x52A0;<code>Header</code>&#x3002;&#x6700;&#x540E;&#x518D;&#x6784;&#x9020;&#x65B0;&#x7684;<code>request</code>&#x8C03;&#x7528;<code>chain.proceed(request)</code>&#x3002;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;<code>.addHeader</code>&#x4E0E;<code>.Header</code>&#x7684;&#x533A;&#x522B;&#x3002;</p>\n<ul>\n<li><code>.addHeader</code>&#x5BF9;&#x76F8;&#x540C;&#x7684;<code>name</code>&#xFF0C;&#x4E0D;&#x540C;<code>value</code>&#x4E0D;&#x4F1A;&#x8FDB;&#x884C;&#x8986;&#x76D6;&#xFF0C;&#x8BF4;&#x660E;&#x5B83;&#x53EF;&#x4EE5;&#x5B58;&#x5728;&#x591A;&#x6761;&#x76F8;&#x540C;<code>name</code>&#x7684;&#x8BF7;&#x6C42;&#x5934;</li>\n<li><code>.Header</code>&#x5BF9;&#x76F8;&#x540C;<code>name</code>&#x4F1A;&#x8FDB;&#x884C;&#x8986;&#x76D6;&#xFF0C;&#x8BF4;&#x660E;&#x5BF9;&#x4E8E;&#x76F8;&#x540C;<code>name</code>&#x7684;&#x8BF7;&#x6C42;&#x5934;&#x53EA;&#x80FD;&#x5B58;&#x5728;&#x4E00;&#x4E2A;</li>\n</ul>\n<p>&#x65E2;&#x7136;<code>Interceptor</code>&#x53EF;&#x4EE5;&#x5BF9;<code>header</code>&#x8FDB;&#x884C;&#x7EDF;&#x4E00;&#x8BBE;&#x7F6E;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5927;&#x80C6;&#x731C;&#x60F3;&#x5BF9;&#x4E8E;&#x67E5;&#x8BE2;&#x5B57;&#x6BB5;&#x662F;&#x5426;&#x4E5F;&#x53EF;&#x4EE5;&#x7EDF;&#x4E00;&#x8BBE;&#x7F6E;&#x5462;&#xFF0C;&#x7B54;&#x6848;&#x662F;&#x80AF;&#x5B9A;&#x7684;&#xFF0C;&#x4F8B;&#x5982;<code>apikey</code>&#x5B57;&#x6BB5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">okHttpClient.addInterceptor(new Interceptor() {</span><br><span class=\"line\">                @Override</span><br><span class=\"line\">                public Response intercept(Chain chain) throws IOException {</span><br><span class=\"line\">                    Request original = chain.request();</span><br><span class=\"line\">                    //&#x83B7;&#x53D6;url</span><br><span class=\"line\">                    HttpUrl originalUrl = original.url();</span><br><span class=\"line\"> </span><br><span class=\"line\">                    Request.Builder builder = original.newBuilder()</span><br><span class=\"line\">                            .addHeader(&quot;Authorization&quot;, authToken)</span><br><span class=\"line\">                            .method(original.method(), original.body());                            </span><br><span class=\"line\">                    //&#x4E3A;url&#x6DFB;&#x52A0;apikey&#x5B57;&#x6BB5;</span><br><span class=\"line\">                    HttpUrl url = originalUrl.newBuilder()</span><br><span class=\"line\">                            .addQueryParameter(&quot;apikey&quot;, &quot;isdhh324bdsa&quot;)</span><br><span class=\"line\">                            .build();</span><br><span class=\"line\">                    //&#x5C06;&#x4FEE;&#x6539;&#x7684;url&#x6DFB;&#x52A0;&#x5230;&#x65B0;&#x7684;Request&#x4E2D;</span><br><span class=\"line\">                    Request request = builder</span><br><span class=\"line\">                            .url(url)</span><br><span class=\"line\">                            .build();</span><br><span class=\"line\">                    //&#x6267;&#x884C;</span><br><span class=\"line\">                    return chain.proceed(request);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            });</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"url&#x7684;&#x52A8;&#x6001;&#x8BBE;&#x7F6E;&#x4E0E;&#x8FD0;&#x884C;&#x65F6;url&#x7684;&#x8BBE;&#x7F6E;\"><a href=\"#url&#x7684;&#x52A8;&#x6001;&#x8BBE;&#x7F6E;&#x4E0E;&#x8FD0;&#x884C;&#x65F6;url&#x7684;&#x8BBE;&#x7F6E;\" class=\"headerlink\" title=\"url&#x7684;&#x52A8;&#x6001;&#x8BBE;&#x7F6E;&#x4E0E;&#x8FD0;&#x884C;&#x65F6;url&#x7684;&#x8BBE;&#x7F6E;\"></a>url&#x7684;&#x52A8;&#x6001;&#x8BBE;&#x7F6E;&#x4E0E;&#x8FD0;&#x884C;&#x65F6;url&#x7684;&#x8BBE;&#x7F6E;</h2><h3 id=\"url&#x7684;&#x52A8;&#x6001;&#x8BBE;&#x7F6E;\"><a href=\"#url&#x7684;&#x52A8;&#x6001;&#x8BBE;&#x7F6E;\" class=\"headerlink\" title=\"url&#x7684;&#x52A8;&#x6001;&#x8BBE;&#x7F6E;\"></a>url&#x7684;&#x52A8;&#x6001;&#x8BBE;&#x7F6E;</h3><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x7684;<code>baseUrl</code>&#x4E3A;<code>https://github.com/api/v2</code>&#x800C;&#x8BBE;&#x7F6E;&#x7684;&#x63A5;&#x53E3;&#x7684;&#x8BBE;&#x7F6E;&#x5982;&#x4E0B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface GithubService {</span><br><span class=\"line\">    @GET(&quot;repos&quot;)</span><br><span class=\"line\">    Call&lt;List&lt;Contributors&gt;&gt; contributors();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8BF7;&#x6C42;&#x7684;<code>url</code>&#x4E3A;<code>https://github.com/api/v2/repos</code>,&#x5982;&#x679C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x8981;&#x8BF7;&#x6C42;<code>v3</code>&#x7248;&#x672C;&#x7684;<code>repos</code>&#x5462;&#xFF1F;&#x4F60;&#x4F1A;&#x8BF4;&#x5F88;&#x7B80;&#x5355;&#x76F4;&#x63A5;&#x4FEE;&#x6539;<code>baseUrl</code>&#x4E3A;<code>https://github.com/api/v3</code>,&#x4F46;&#x5728;&#x524D;&#x9762;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5728;<code>ServiceGenerator</code>&#x4E2D;&#x8FDB;&#x884C;&#x4E86;&#x5C01;&#x88C5;<code>baseUrl</code>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4E0D;&#x5E94;&#x8BE5;&#x53BB;&#x4FEE;&#x6539;&#x5B83;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5C31;&#x8981;&#x7528;&#x5230;<code>/</code>&#xFF0C;&#x5B83;&#x80FD;&#x5C06;<code>host</code>&#x540E;&#x9762;&#x7684;&#x5168;&#x90E8;&#x5FFD;&#x7565;&#xFF0C;&#x5373;<code>baseUrl</code>&#x76F4;&#x63A5;&#x6210;&#x4E3A;<code>https://github.com</code>&#xFF0C;&#x518D;&#x5728;&#x540E;&#x9762;&#x6DFB;&#x52A0;&#x8BBE;&#x7F6E;&#x7684;<code>endpoint url</code>&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface GithubService {</span><br><span class=\"line\">    @GET(&quot;/api/v3/repos&quot;)</span><br><span class=\"line\">    Call&lt;List&lt;Contributors&gt;&gt; contributors();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#x8BF7;&#x6C42;&#x7684;<code>url</code>&#x4E3A;<code>https://github.com/api/v3/repos</code> ,&#x6240;&#x4EE5;<strong>&#x8981;&#x614E;&#x91CD;&#x4F7F;&#x7528;<code>/</code></strong>&#x3002;</p>\n<p>&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x662F;&#x4F7F;&#x7528;<code>//</code>,&#x5B83;&#x7684;&#x6548;&#x679C;&#x662F;&#x5BF9;<code>scheme</code>&#x8FDB;&#x884C;&#x4FDD;&#x6301;&#xFF0C;&#x4F8B;&#x5982;<code>baseUrl</code>&#x4E3A;<code>https://api.github.com</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface GithubService {</span><br><span class=\"line\">\t//url&#x4E3A;https://api.github.com/api/v3/repos</span><br><span class=\"line\">\t@GET(&quot;/api/v3/repos&quot;)</span><br><span class=\"line\">\tCall&lt;List&lt;Contributors&gt;&gt; contributors();</span><br><span class=\"line\">    </span><br><span class=\"line\">    //url&#x4E3A;https://api.github.com</span><br><span class=\"line\">    @GET(&quot;//api.github.com&quot;)</span><br><span class=\"line\">    Call&lt;List&lt;Contributors&gt;&gt; contributors();      </span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x8FD0;&#x884C;&#x65F6;url&#x7684;&#x8BBE;&#x7F6E;\"><a href=\"#&#x8FD0;&#x884C;&#x65F6;url&#x7684;&#x8BBE;&#x7F6E;\" class=\"headerlink\" title=\"&#x8FD0;&#x884C;&#x65F6;url&#x7684;&#x8BBE;&#x7F6E;\"></a>&#x8FD0;&#x884C;&#x65F6;url&#x7684;&#x8BBE;&#x7F6E;</h3><p>&#x5728;&#x5F00;&#x53D1;&#x4E2D;&#x53EF;&#x80FD;&#x4F1A;&#x9047;&#x5230;&#x8FD9;&#x79CD;&#x60C5;&#x5F62;&#xFF1A;&#x524D;&#x9762;&#x8BF7;&#x6C42;&#x662F;<code>url</code>&#x4E3A;<code>https://github.com/api/repos</code>&#x4F46;&#x540E;&#x9762;&#x6709;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x7684;<code>host</code>&#x4E0D;&#x540C;&#x4F8B;&#x5982;&#x4E3A;<code>https://duoshuo.com/api/repos</code>,&#x4F46;&#x4ED6;&#x4EEC;&#x8C03;&#x7528;&#x7684;&#x90FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x63A5;&#x53E3;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x7684;<code>endpoint</code>&#x76F8;&#x540C;<code>/api/repos</code>&#xFF0C;&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x53EA;&#x80FD;&#x6539;&#x53D8;&#x8BF7;&#x6C42;&#x7684;<code>baseUrl</code>&#x3002;&#x5BF9;<code>ServiceGenerator</code>&#x6DFB;&#x52A0;&#x65B0;&#x7684;&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private static OkHttpClient.Builder okHttpClient = new OkHttpClient.Builder();</span><br><span class=\"line\"></span><br><span class=\"line\">    private static Retrofit.Builder builder = new Retrofit.Builder()</span><br><span class=\"line\">            .baseUrl(API_DUOSHUO_URL)</span><br><span class=\"line\">            .addConverterFactory(ScalarsConverterFactory.create())</span><br><span class=\"line\">            .addConverterFactory(GsonConverterFactory.create());</span><br><span class=\"line\">\t//&#x6784;&#x9020;&#x65B0;&#x7684;builder </span><br><span class=\"line\">    public static void changeApiBaseUrl(String newApiBaseUrl) {</span><br><span class=\"line\">        apiBaseUrl = newApiBaseUrl;</span><br><span class=\"line\">        builder = new Retrofit.Builder()</span><br><span class=\"line\">                .baseUrl(apiBaseUrl)</span><br><span class=\"line\">                .addConverterFactory(ScalarsConverterFactory.create())</span><br><span class=\"line\">                .addConverterFactory(GsonConverterFactory.create());</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x65F6;&#x8C03;&#x7528;<code>changeApiBaseUrl</code>&#x65B9;&#x6CD5;&#x5373;&#x53EF;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//&#x6539;&#x53D8;baseUrl</span><br><span class=\"line\">ServiceGenerator.changeApiBaseUrl(&quot;https://duoshuo.com&quot;);</span><br></pre></td></tr></table></figure>\n<p>&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x60C5;&#x5F62;&#xFF1A;&#x5C31;&#x662F;&#x5B8C;&#x5168;&#x4E0D;&#x76F8;&#x540C;&#x7684;<code>url</code>&#x4F8B;&#x5982;<code>https://example.com/ioe/we</code>,&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x6CE8;&#x91CA;<code>@Url</code>,&#x8BE5;&#x6CE8;&#x91CA;&#x4F5C;&#x7528;&#x4E8E;&#x53C2;&#x6570;&#x5B57;&#x6BB5;&#xFF0C;&#x5BF9;&#x8BF7;&#x6C42;&#x65F6;&#x7684;<code>url</code>&#x52A8;&#x6001;&#x8BBE;&#x7F6E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GET</span><br><span class=\"line\">Call&lt;List&lt;Contributors&gt;&gt; contributors(@Url String  url);</span><br></pre></td></tr></table></figure>\n<p>&#x8C03;&#x7528;&#x65F6;&#x76F4;&#x63A5;&#x4F20;&#x9012;<code>url</code>&#x53C2;&#x6570;&#x5373;&#x53EF;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GithubService service = ServiceGenerator.createService(GithubService.class);</span><br><span class=\"line\">Call&lt;List&lt;Contributors&gt;&gt; call = service.contributors(&quot;https://example.com/ioe/we&quot;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"request&#x7684;&#x91CD;&#x590D;&#x4F7F;&#x7528;&#x4E0E;&#x5206;&#x6790;\"><a href=\"#request&#x7684;&#x91CD;&#x590D;&#x4F7F;&#x7528;&#x4E0E;&#x5206;&#x6790;\" class=\"headerlink\" title=\"request&#x7684;&#x91CD;&#x590D;&#x4F7F;&#x7528;&#x4E0E;&#x5206;&#x6790;\"></a>request&#x7684;&#x91CD;&#x590D;&#x4F7F;&#x7528;&#x4E0E;&#x5206;&#x6790;</h2><p>&#x5BF9;&#x540C;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x8FDB;&#x884C;&#x591A;&#x6B21;&#x8BF7;&#x6C42;&#x4E0D;&#x80FD;&#x91CD;&#x590D;&#x518D;&#x8C03;&#x7528;&#x5B83;&#x7684;<code>Call</code>&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x5B83;&#x7684;<code>clone</code>&#x65B9;&#x6CD5;&#xFF0C;&#x590D;&#x5236;&#x4E00;&#x4E2A;&#x65B0;&#x7684;<code>Call</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GithubService service = ServiceGenerator.createService(GithubService.class);</span><br><span class=\"line\">  </span><br><span class=\"line\">Call&lt;List&lt;Contributors&gt;&gt; call = service.contributors(&quot;square&quot;, &quot;retrofit&quot;);</span><br><span class=\"line\">  </span><br><span class=\"line\">Callback&lt;ResponseBody&gt; callBack = new Callback&lt;ResponseBody&gt;() {...};</span><br><span class=\"line\"> </span><br><span class=\"line\">call.enqueue(callBack);</span><br><span class=\"line\">//&#x518D;&#x4E00;&#x6B21;&#x8BF7;&#x6C42; </span><br><span class=\"line\">Call&lt;ResponseBody&gt; newCall = originalCall.clone();</span><br><span class=\"line\">newCall.enqueue(callBack);</span><br></pre></td></tr></table></figure>\n<p>&#x540C;&#x65F6;&#x53EF;&#x4EE5;&#x8C03;&#x7528;<code>Call.request</code>&#x83B7;&#x53D6;&#x8BF7;&#x6C42;&#x7684;<code>request</code>&#xFF0C;&#x4E0D;&#x7BA1;&#x5B83;&#x662F;&#x5426;&#x6267;&#x884C;&#x5B8C;&#x4E86;&#x8FD8;&#x662F;&#x672A;&#x6267;&#x884C;&#xFF0C;&#x8FD8;&#x662F;&#x5728;&#x6267;&#x884C;&#x7684;&#x65F6;&#x5019;&#x8C03;&#x7528;&#x4E86;<code>request.cacel()</code>&#x53D6;&#x6D88;&#x4E86;&#xFF0C;&#x90FD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x83B7;&#x53D6;&#x7684;<code>request</code>&#x67E5;&#x8BE2;&#x8BF7;&#x6C42;&#x7684;&#x4FE1;&#x606F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void checkRequestContent(Request request) {  </span><br><span class=\"line\">    Headers requestHeaders = request.headers();</span><br><span class=\"line\">    RequestBody requestBody = request.body();</span><br><span class=\"line\">    HttpUrl requestUrl = request.url();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"Retrofit&#x7684;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;\"><a href=\"#Retrofit&#x7684;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;\" class=\"headerlink\" title=\"Retrofit&#x7684;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;\"></a>Retrofit&#x7684;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;</h2><p>&#x5BF9;&#x4E8E;&#x6587;&#x4EF6;&#x7684;&#x4E0A;&#x4F20;<code>Retrofit</code>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>@Multipart</code>&#x8FDB;&#x884C;&#x6807;&#x6CE8;&#x6765;&#x5B9A;&#x4E49;&#x76F8;&#x5173;&#x7684;&#x4E0A;&#x4F20;&#x63A5;&#x53E3;&#xFF0C;&#x4E0B;&#x9762;&#x4EE5;&#x591A;&#x8BF4;&#x7684;&#x5934;&#x50CF;&#x4E0A;&#x4F20;&#x4E3A;&#x4F8B;&#xFF0C;&#x9996;&#x5148;&#x6765;&#x770B;&#x4E0B;&#x4E0A;&#x4F20;&#x7684;&#x6570;&#x636E;&#x683C;&#x5F0F;&#xFF0C;&#x901A;&#x8FC7;&#x6293;&#x5305;&#x5206;&#x6790;</p>\n<p><img src=\"/2016/11/18/&#x4F7F;&#x7528;Retrofit&#x539F;&#x751F;&#x7684;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;/1.png\" alt=\"general\"><br><img src=\"/2016/11/18/&#x4F7F;&#x7528;Retrofit&#x539F;&#x751F;&#x7684;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;/2.png\" alt=\"request headers\"><br><img src=\"/2016/11/18/&#x4F7F;&#x7528;Retrofit&#x539F;&#x751F;&#x7684;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;/3.png\" alt=\"request payload\"></p>\n<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x8BF7;&#x6C42;&#x7684;&#x65B9;&#x5F0F;&#x4E3A;<code>post</code>&#xFF0C;&#x8BF7;&#x6C42;&#x7684;<code>url</code>&#x4E3A;<code>http://duoshuo.com/api/avatars/upload.json</code>,<code>Content-Type</code>&#x7C7B;&#x578B;&#x4E3A;<code>multipart/form-data</code>&#x8FD9;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x540E;&#x7EED;&#x8981;&#x8BBE;&#x7F6E;&#x6570;&#x636E;&#x7684;&#x7C7B;&#x578B;,&#x8BF7;&#x6C42;&#x7684;<code>Disposition</code>&#x5206;&#x4E3A;&#x4E24;&#x90E8;&#x5206;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x90E8;&#x5206;&#x4E3A;<code>RequestBody</code>&#x7C7B;&#x578B;&#x7684;<code>nonce</code>&#x6570;&#x636E;&#xFF0C;&#x53E6;&#x4E00;&#x90E8;&#x5206;&#x4E3A;&#x4E0A;&#x4F20;&#x7684;&#x56FE;&#x7247;&#x4FE1;&#x606F;&#xFF0C;&#x6211;&#x4EEC;&#x8FD9;&#x90E8;&#x5206;&#x4EE5;<code>MultipartBody.Part</code>&#x5B9A;&#x4E49;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface DuoShuoUploadService {</span><br><span class=\"line\">@Headers(&quot;Cookie: duoshuo_unique=your duoshuo cookie&quot;)</span><br><span class=\"line\">    @Multipart</span><br><span class=\"line\">    @POST(&quot;/api/avatars/upload.json&quot;)</span><br><span class=\"line\">    Call&lt;ResponseBody&gt; uploadService(@Part(&quot;nonce&quot;) RequestBody nonce,</span><br><span class=\"line\">                                     @Part MultipartBody.Part body);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F;&#x6784;&#x9020;&#x6570;&#x636E;&#xFF0C;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#x8BF7;&#x6C42;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void getUpdateFile(File file, String nonceString) {</span><br><span class=\"line\">        // &#x521B;&#x5EFA;&#x4E0A;&#x4F20;&#x7684;Service&#x670D;&#x52A1;&#x7AEF;</span><br><span class=\"line\">        DuoShuoUploadService uploadService = ServiceGenerator.createService(DuoShuoUploadService.class);</span><br><span class=\"line\">        // &#x521B;&#x5EFA;nonce&#x6570;&#x636E;&#x7684;RequestBody</span><br><span class=\"line\">        RequestBody nonce = RequestBody.create(MediaType.parse(&quot;multipart/form-data&quot;), nonceString);</span><br><span class=\"line\">        // &#x521B;&#x5EFA;&#x6587;&#x4EF6;&#x7684;RequestBody</span><br><span class=\"line\">        RequestBody requestFile = RequestBody.create(MediaType.parse(&quot;multipart/form-data&quot;), file);</span><br><span class=\"line\">        // &#x521B;&#x5EFA;MultipartBody.Part</span><br><span class=\"line\">        MultipartBody.Part body = MultipartBody.Part.createFormData(&quot;image&quot;, file.getName(), requestFile);</span><br><span class=\"line\">        // &#x8C03;&#x7528;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;,&#x5E76;&#x6267;&#x884C;&#x8BF7;&#x6C42;</span><br><span class=\"line\">        Call&lt;ResponseBody&gt; call = uploadService.uploadService(nonce, body);</span><br><span class=\"line\">        call.enqueue(new Callback&lt;ResponseBody&gt;() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onResponse(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response) {</span><br><span class=\"line\">                if (response.isSuccessful()) {</span><br><span class=\"line\">                    Log.v(&quot;TAG&quot;, &quot;success&quot; + &quot;-&gt;&quot; + response.body());</span><br><span class=\"line\">                } else {</span><br><span class=\"line\">//                    APIError apiError = ErrorUtils.parseError(response);</span><br><span class=\"line\">//                    Log.e(&quot;TAG&quot;, apiError.message());</span><br><span class=\"line\">                }</span><br><span class=\"line\">                Log.d(&quot;TAG&quot;, &quot; service contacted at:&quot; + call.request().url());</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onFailure(Call&lt;ResponseBody&gt; call, Throwable t) {</span><br><span class=\"line\">                Log.e(&quot;TAG&quot;, &quot;error:&quot; + t.getMessage());</span><br><span class=\"line\">                Log.d(&quot;TAG&quot;, &quot; service contacted at:&quot; + call.request().url());</span><br><span class=\"line\">            }</span><br><span class=\"line\">        });</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x6709;&#x4E24;&#x70B9;</p>\n<ul>\n<li>&#x5728;&#x521B;&#x5EFA;<code>RequestBody.create</code>&#x65F6;&#xFF0C;&#x5176;&#x4E2D;&#x7684;<code>Content-Type</code>&#x5373;<code>MediaType</code>&#x7C7B;&#x578B;&#x8981;&#x8BBE;&#x7F6E;&#x4E3A;<code>multipart/form-data</code>&#x8FD9;&#x662F;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x7684;&#x7C7B;&#x578B;&#x3002;</li>\n<li><code>MultipartBody.Part.createFormData()</code>&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x4E3A;&#x524D;&#x9762;&#x56FE;&#x4E2D;&#x7B2C;&#x4E8C;&#x4E2A;<code>Disposition</code>&#x7684;<code>name</code>&#x5B57;&#x6BB5;&#x7684;&#x503C;&#xFF0C;&#x8FD9;&#x4E2A;&#x5FC5;&#x987B;&#x76F8;&#x540C;&#x56E0;&#x4E3A;&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x901A;&#x8FC7;&#x8BE5;&#x5B57;&#x6BB5;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x5C31;&#x662F;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x7B2C;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x5373;&#x4E3A;&#x4E0A;&#x4F20;&#x7684;&#x56FE;&#x7247;&#x6570;&#x636E;<code>RequestBody</code>&#x7C7B;&#x578B;&#x3002;</li>\n</ul>\n<p>&#x5BF9;&#x4E8E;&#x591A;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x6216;&#x8005;&#x591A;&#x4E2A;<code>RequestBody</code>&#x7684;&#x5B57;&#x6BB5;&#xFF0C;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x7684;&#x901A;&#x8FC7;&#x4F20;&#x9012;&#x591A;&#x4E2A;<code>MultipartBody.Part</code>&#x7C7B;&#x578B;&#x7684;<code>body</code>&#x4E0E;<code>@PartMap</code>&#x6765;&#x5B9E;&#x73B0;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Headers(&quot;Cookie: duoshuo_unique=your duoshuo cookie&quot;)</span><br><span class=\"line\">   @Multipart</span><br><span class=\"line\">   @POST(&quot;/api/avatars/upload.json&quot;)</span><br><span class=\"line\">   Call&lt;ResponseBody&gt; uploadMultipleService(@PartMap() Map&lt;String, RequestBody&gt; partMap,</span><br><span class=\"line\">                                            @Part MultipartBody.Part body1,</span><br><span class=\"line\">                                            @Part MultipartBody.Part body2);</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x9700;&#x6C42;&#x589E;&#x52A0;&#x4E86;&#xFF0C;&#x9700;&#x8981;&#x4E0A;&#x4F20;&#x7684;&#x8FDB;&#x5EA6;&#x6761;&#xFF0C;&#x8FD9;&#x65F6;&#x53EF;&#x4EE5;&#x7EE7;&#x627F;<code>RequestBody</code>&#x6765;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x6709;&#x8FDB;&#x5EA6;&#x6761;&#x7684;&#x4E0A;&#x4F20;&#xFF0C;&#x8FD9;&#x91CC;&#x7B80;&#x5355;&#x7684;&#x8D34;&#x4E0B;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class ProgressRequestBody extends RequestBody {    </span><br><span class=\"line\">    public interface OkHttpProgressListener {       </span><br><span class=\"line\">        void onProgress(long currentBytesCount, long totalBytesCount);    </span><br><span class=\"line\">    }    </span><br><span class=\"line\">    //&#x5B9E;&#x9645;&#x7684;&#x5F85;&#x5305;&#x88C5;&#x8BF7;&#x6C42;&#x4F53;    </span><br><span class=\"line\">    private final RequestBody requestBody;    </span><br><span class=\"line\">    //&#x8FDB;&#x5EA6;&#x56DE;&#x8C03;&#x63A5;&#x53E3;    </span><br><span class=\"line\">    private final OkHttpProgressListener progressListener;    </span><br><span class=\"line\">    //&#x5305;&#x88C5;&#x5B8C;&#x6210;&#x7684;BufferedSink    </span><br><span class=\"line\">    private BufferedSink bufferedSink;    </span><br><span class=\"line\">    public ProgressRequestBody(RequestBody requestBody, OkHttpProgressListener progressListener) {        </span><br><span class=\"line\">        this.requestBody = requestBody;        </span><br><span class=\"line\">        this.progressListener = progressListener;    </span><br><span class=\"line\">    }    </span><br><span class=\"line\">    /**     </span><br><span class=\"line\">      * &#x91CD;&#x5199;&#x8C03;&#x7528;&#x5B9E;&#x9645;&#x7684;&#x54CD;&#x5E94;&#x4F53;&#x7684;contentType     </span><br><span class=\"line\">      * @return MediaType     </span><br><span class=\"line\">      */    </span><br><span class=\"line\">    @Override    </span><br><span class=\"line\">    public MediaType contentType() {        </span><br><span class=\"line\">        return requestBody.contentType();    </span><br><span class=\"line\">    }    </span><br><span class=\"line\">    /**     </span><br><span class=\"line\">      * &#x91CD;&#x5199;&#x8C03;&#x7528;&#x5B9E;&#x9645;&#x7684;&#x54CD;&#x5E94;&#x4F53;&#x7684;contentLength     </span><br><span class=\"line\">      * @return contentLength     </span><br><span class=\"line\">      * @throws IOException &#x5F02;&#x5E38;     </span><br><span class=\"line\">      */    </span><br><span class=\"line\">    @Override    </span><br><span class=\"line\">    public long contentLength() throws IOException {        </span><br><span class=\"line\">        return requestBody.contentLength();    </span><br><span class=\"line\">    }    </span><br><span class=\"line\">    /**     </span><br><span class=\"line\">      * &#x91CD;&#x5199;&#x8FDB;&#x884C;&#x5199;&#x5165;     </span><br><span class=\"line\">      * @param sink BufferedSink     </span><br><span class=\"line\">      * @throws IOException &#x5F02;&#x5E38;     </span><br><span class=\"line\">      */    </span><br><span class=\"line\">    @Override    </span><br><span class=\"line\">    public void writeTo(BufferedSink sink) throws IOException {        </span><br><span class=\"line\">        if (null == bufferedSink) {            </span><br><span class=\"line\">            bufferedSink = Okio.buffer(sink(sink));        </span><br><span class=\"line\">        }        </span><br><span class=\"line\">        requestBody.writeTo(bufferedSink);        </span><br><span class=\"line\">        //&#x5FC5;&#x987B;&#x8C03;&#x7528;flush&#xFF0C;&#x5426;&#x5219;&#x6700;&#x540E;&#x4E00;&#x90E8;&#x5206;&#x6570;&#x636E;&#x53EF;&#x80FD;&#x4E0D;&#x4F1A;&#x88AB;&#x5199;&#x5165;        </span><br><span class=\"line\">        bufferedSink.flush();    </span><br><span class=\"line\">     }    </span><br><span class=\"line\">      /**     </span><br><span class=\"line\">        * &#x5199;&#x5165;&#xFF0C;&#x56DE;&#x8C03;&#x8FDB;&#x5EA6;&#x63A5;&#x53E3;     </span><br><span class=\"line\">        * @param sink Sink     </span><br><span class=\"line\">        * @return Sink     </span><br><span class=\"line\">        */    </span><br><span class=\"line\">      private Sink sink(Sink sink) {        </span><br><span class=\"line\">          return new ForwardingSink(sink) {            </span><br><span class=\"line\">              //&#x5F53;&#x524D;&#x5199;&#x5165;&#x5B57;&#x8282;&#x6570;            </span><br><span class=\"line\">              long writtenBytesCount = 0L;            </span><br><span class=\"line\">              //&#x603B;&#x5B57;&#x8282;&#x957F;&#x5EA6;&#xFF0C;&#x907F;&#x514D;&#x591A;&#x6B21;&#x8C03;&#x7528;contentLength()&#x65B9;&#x6CD5;            </span><br><span class=\"line\">              long totalBytesCount = 0L;            </span><br><span class=\"line\">              @Override            </span><br><span class=\"line\">              public void write(Buffer source, long byteCount) throws IOException {    </span><br><span class=\"line\">                  super.write(source, byteCount);                </span><br><span class=\"line\">                  //&#x589E;&#x52A0;&#x5F53;&#x524D;&#x5199;&#x5165;&#x7684;&#x5B57;&#x8282;&#x6570;                </span><br><span class=\"line\">                  writtenBytesCount += byteCount;                </span><br><span class=\"line\">                  //&#x83B7;&#x5F97;contentLength&#x7684;&#x503C;&#xFF0C;&#x540E;&#x7EED;&#x4E0D;&#x518D;&#x8C03;&#x7528;                </span><br><span class=\"line\">                  if (totalBytesCount == 0) {                    </span><br><span class=\"line\">                      totalBytesCount = contentLength();                </span><br><span class=\"line\">                  }                </span><br><span class=\"line\">                   progressListener.onProgress(writtenBytesCount, totalBytesCount);            </span><br><span class=\"line\">              }        </span><br><span class=\"line\">          };    </span><br><span class=\"line\">      }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"Retrofit&#x7684;&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;\"><a href=\"#Retrofit&#x7684;&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;\" class=\"headerlink\" title=\"Retrofit&#x7684;&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;\"></a>Retrofit&#x7684;&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;</h2><p><code>Retrofit</code>&#x7684;&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;&#x4E5F;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x53EA;&#x8981;&#x77E5;&#x9053;&#x4E0B;&#x8F7D;&#x6587;&#x4EF6;&#x7684;<code>url</code>&#xFF0C;&#x5B9A;&#x5236;&#x76F8;&#x5E94;&#x7684;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x54CD;&#x5E94;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x4FDD;&#x5B58;&#xFF0C;&#x76F4;&#x63A5;&#x4E0A;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface DownloadFileService {</span><br><span class=\"line\">    @Streaming</span><br><span class=\"line\">    @GET</span><br><span class=\"line\">    Call&lt;ResponseBody&gt; downloadFileWithDynamicUrlSync(@Url String url);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x5230;&#x4E86;<code>@Streaming</code>&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x4F7F;&#x7528;&#x7684;&#x8BDD;&#x54CD;&#x5E94;&#x7684;&#x6570;&#x636E;&#x662F;&#x6574;&#x4E2A;&#x4E00;&#x6B21;&#x6027;&#x4FDD;&#x5B58;&#xFF0C;&#x5982;&#x679C;&#x6570;&#x636E;&#x8FC7;&#x5927;&#x5F88;&#x5BB9;&#x6613;&#x4EA7;&#x751F;<code>OOM</code>&#x73B0;&#x8C61;&#xFF1B;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4E86;&#x54CD;&#x5E94;&#x7684;&#x6570;&#x636E;&#x5C06;&#x4F1A;&#x6309;&#x6D41;&#x7684;&#x5F62;&#x5F0F;&#x5206;&#x6563;&#x4F20;&#x9012;&#xFF0C;&#x6240;&#x4EE5;&#x5927;&#x6587;&#x4EF6;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;<code>@Streaming</code></em></p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void getDownloadFile(final String filePath) {</span><br><span class=\"line\">        final DownloadFileService downloadFileService = ServiceGenerator.createService(DownloadFileService.class);</span><br><span class=\"line\"> </span><br><span class=\"line\">        Call&lt;ResponseBody&gt; call = downloadFileService.downloadFileWithDynamicUrlSync(filePath);</span><br><span class=\"line\"></span><br><span class=\"line\">        call.enqueue(new Callback&lt;ResponseBody&gt;() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onResponse(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response) {</span><br><span class=\"line\">                if (response.isSuccessful()) {</span><br><span class=\"line\">                    boolean writeToDisk = WriteToDiskUtils.writeResponseBodyToDiskUtils(MainActivity.this, response.body());</span><br><span class=\"line\">                    Log.d(&quot;TAG&quot;, &quot;&#x4E0B;&#x8F7D;&#x6210;&#x529F;?&quot; + writeToDisk);</span><br><span class=\"line\">                } else {</span><br><span class=\"line\">                    Log.d(&quot;TAG&quot;, &quot;&#x4E0B;&#x8F7D;&#x5931;&#x8D25;!&quot;);</span><br><span class=\"line\">                }</span><br><span class=\"line\">                Log.d(&quot;TAG&quot;, &quot; service contacted at:&quot; + call.request().url());</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onFailure(Call&lt;ResponseBody&gt; call, Throwable t) {</span><br><span class=\"line\">                if (call.isCanceled()) {</span><br><span class=\"line\">                    Log.d(&quot;TAG&quot;, &quot;&#x8BF7;&#x6C42;&#x5DF2;&#x7ECF;&#x53D6;&#x6D88;!&quot;);</span><br><span class=\"line\">                } else {</span><br><span class=\"line\">                    Log.e(&quot;TAG&quot;, t.getMessage());</span><br><span class=\"line\">                }</span><br><span class=\"line\">                Log.d(&quot;TAG&quot;, &quot; service contacted at:&quot; + call.request().url());</span><br><span class=\"line\">            }</span><br><span class=\"line\">        });</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x6587;&#x4EF6;&#x7684;&#x4FDD;&#x5B58;&#x4F7F;&#x7528;&#x4E86;<code>WriteToDiskUtils.writeResponseBodyToDiskUtils()</code>&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x6570;&#x636E;&#x8BFB;&#x53D6;&#x4E0E;&#x5199;&#x5165;&#xFF0C;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#x76F4;&#x63A5;&#x770B;&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class WriteToDiskUtils {</span><br><span class=\"line\"> </span><br><span class=\"line\">    public static boolean writeResponseBodyToDiskUtils(Context context, ResponseBody body) {</span><br><span class=\"line\">        File file = new File(Environment.getExternalStorageDirectory() + File.separator + &quot;retrofit/&quot;);</span><br><span class=\"line\">        InputStream in = null;</span><br><span class=\"line\">        OutputStream out = null;</span><br><span class=\"line\">        long fileSize = body.contentLength();</span><br><span class=\"line\">        int line;</span><br><span class=\"line\">        long downloadSize = 0;</span><br><span class=\"line\"> </span><br><span class=\"line\">        if (!file.exists()){</span><br><span class=\"line\">            file.mkdirs();</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        File realFile = new File(file,&quot;vso.mp4&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        try {</span><br><span class=\"line\">            in = body.byteStream();</span><br><span class=\"line\">            out = new FileOutputStream(realFile);</span><br><span class=\"line\">            byte[] buffer = new byte[4096];</span><br><span class=\"line\">            while ((line = in.read(buffer)) != -1) {</span><br><span class=\"line\">                out.write(buffer, 0, line);</span><br><span class=\"line\">                downloadSize += line;</span><br><span class=\"line\">                Log.d(&quot;TAG&quot;, &quot;&#x6587;&#x4EF6;&#x603B;&#x7684;&#x5927;&#x5C0F;:&quot; + fileSize + &quot;&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;&#x7684;&#x5927;&#x5C0F;:&quot; + downloadSize);</span><br><span class=\"line\">            }</span><br><span class=\"line\">            out.flush();</span><br><span class=\"line\">            return true;</span><br><span class=\"line\">        } catch (IOException e) {</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">            return false;</span><br><span class=\"line\">        } finally {</span><br><span class=\"line\">            try {</span><br><span class=\"line\">                if (in != null)</span><br><span class=\"line\">                    in.close();</span><br><span class=\"line\">                if (out != null)</span><br><span class=\"line\">                    out.close();</span><br><span class=\"line\">            } catch (IOException e) {</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">                return false;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x8FD9;&#x6B21;&#x5C31;&#x5230;&#x8FD9;&#x91CC;&#x5427;&#xFF0C;&#x53BB;&#x4F11;&#x606F;&#x4E86;&#x3002;&#x3002;&#x3002;&#x4E0B;&#x6B21;&#x5C06;&#x5BF9;<code>Retrofit</code>&#x4E0E;<code>RXJava</code>&#x7684;&#x7ED3;&#x5408;&#x4F7F;&#x7528;&#x8FDB;&#x884C;&#x4ECB;&#x7ECD;</em></p>\n</blockquote>\n","categories":["android"],"tags":["retrofit"]},{"title":"带你走进Retrofit的新世界","url":"https://www.rousetime.com/2016/11/15/带你走进Retrofit的新世界/","content":"<p>&#x5BF9;&#x4E8E;<code>Android</code>&#x6765;&#x8BF4;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x7684;&#x5B9E;&#x73B0;&#x6709;&#x5F88;&#x591A;&#xFF0C;&#x4F8B;&#x5982;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x6CA1;&#x6709;&#x5C01;&#x88C5;&#x7684;<code>HttpUrlConnection</code>&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;&#x4E00;&#x4E9B;&#x5DF2;&#x7ECF;&#x8FDB;&#x884C;&#x4E86;&#x5C01;&#x88C5;&#x7684;&#x4F8B;&#x5982;<code>Volley</code>&#x3001;<code>OkHttp</code>&#xFF0C;&#x8FD9;&#x4E9B;&#x5C01;&#x88C5;&#x597D;&#x7684;&#x5F00;&#x6E90;&#x5E93;&#x4E5F;&#x662F;&#x4E0D;&#x9519;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x8BB2;&#x7684;&#x8BDD;&#x4E5F;&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x5199;&#x597D;&#x51E0;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x4E86;&#x89E3;<code>Volley</code>&#x539F;&#x7406;&#x7684;&#x7684;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x8FD9;&#x4E24;&#x7BC7;&#x6587;&#x7AE0;<a href=\"https://idisfkj.github.io/2016/10/14/Android-Volley%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E4%B8%80/\" target=\"_blank\" rel=\"noopener\">Android Volley&#x6E90;&#x7801;&#x5206;&#x6790;(&#x4E00;)</a>&#x3001;<a href=\"https://idisfkj.github.io/2016/10/17/Android-Volley%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E4%BA%8C/\" target=\"_blank\" rel=\"noopener\">Android Volley&#x6E90;&#x7801;&#x5206;&#x6790;(&#x4E8C;)</a>&#x3002;&#x4F46;&#x662F;&#x4ECA;&#x5929;&#x8981;&#x8BF4;&#x7684;&#x662F;&#x73B0;&#x5728;<code>Android</code>&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x8FDB;&#x9636;&#x5FC5;&#x5907;&#x7684;&#x7F51;&#x7EDC;&#x5E93;<code>Retrofit</code>&#xFF0C;&#x4E5F;&#x662F;&#x73B0;&#x5728;&#x6700;&#x6D41;&#x884C;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x4E4B;&#x524D;&#x4F7F;&#x7528;&#x8FC7;<code>OkHttp</code>&#x90A3;&#x4E48;&#x606D;&#x559C;&#x4F60;&#x6709;&#x4E86;&#x4E00;&#x4E2A;&#x597D;&#x7684;&#x4F18;&#x52BF;&#xFF0C;&#x56E0;&#x4E3A;<code>Retrofit</code>&#x5185;&#x90E8;&#x5C31;&#x662F;&#x4F7F;&#x7528;<code>OkHttp</code>&#x8FDB;&#x884C;&#x8BF7;&#x6C42;&#x7684;&#x3002;<code>Retrofit</code>&#x505A;&#x7684;&#x53EA;&#x662F;&#x5C01;&#x88C5;&#x8BF7;&#x6C42;&#x53C2;&#x6570;&#x3001;<code>Header</code>&#x3001;<code>Url</code>&#x7B49;&#x4FE1;&#x606F;&#xFF0C;&#x6700;&#x540E;&#x518D;&#x4F20;&#x7ED9;<code>OkHttp</code>&#x5B8C;&#x6210;&#x8BF7;&#x6C42;&#xFF0C;&#x8BF7;&#x6C42;&#x5B8C;&#x4E4B;&#x540E;<code>OkHttp</code>&#x5728;&#x4F20;&#x56DE;&#x7ED9;<code>Retrofit</code>&#x3002;&#x4E0B;&#x9762;&#x6765;&#x8BF4;&#x4E0B;<code>Retrofit</code>&#x7684;&#x57FA;&#x672C;&#x4F7F;&#x7528;&#x3002;</p>\n<blockquote>\n<p>&#x672C;&#x7AE0;&#x4ECB;&#x7ECD;&#x7684;&#x90FD;&#x662F;&#x5165;&#x95E8;&#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x53EA;&#x505A;&#x4E00;&#x4E2A;&#x5F15;&#x5BFC;&#x4F5C;&#x7528;&#xFF0C;&#x5927;&#x795E;&#x8BF7;&#x81EA;&#x52A8;&#x8DF3;&#x8FC7;</p>\n</blockquote>\n<h1 id=\"Retrofit\"><a href=\"#Retrofit\" class=\"headerlink\" title=\"Retrofit\"></a>Retrofit</h1><p>&#x5BF9;&#x4E8E;<code>Retrofit</code>&#x7684;&#x4ECB;&#x7ECD;&#x6211;&#x5F15;&#x7528;&#x5B98;&#x65B9;&#x7684;&#x4E00;&#x53E5;&#x8BDD;<code>Type-safe HTTP client for Android and Java by Square, Inc.</code>&#x7B80;&#x5355;&#x7684;&#x7FFB;&#x8BD1;&#x4E00;&#x4E0B;&#x5C31;&#x662F;&#xFF1A;&#x5BF9;&#x4E8E;<code>Android</code>&#x4E0E;<code>Java</code>&#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x5B89;&#x5168;&#x7684;<code>Http</code>&#x8BF7;&#x6C42;&#x5E93;&#x3002;&#x5B83;&#x662F;&#x4F7F;&#x7528;&#x6CE8;&#x91CA;&#x6765;&#x63CF;&#x8FF0;<code>Http</code>&#x8BF7;&#x6C42;&#xFF0C;&#x4E3B;&#x8981;&#x6709;&#x4EE5;&#x4E0B;&#x7279;&#x70B9;&#xFF1A;</p>\n<ul>\n<li>&#x652F;&#x6301;<code>URL</code>&#x53C2;&#x6570;&#x66FF;&#x4EE3;&#x4E0E;<code>query</code>&#x53C2;&#x6570;&#x7684;&#x67E5;&#x8BE2;</li>\n<li>&#x5BF9;&#x4E8E;&#x8BF7;&#x6C42;<code>body</code>&#x7C7B;&#x578B;&#x7684;&#x8F6C;&#x6362;&#xFF08;&#x4F8B;&#x5982;&#xFF1A;<code>Json</code>&#x3001;<code>protocol buffers</code>&#xFF09;</li>\n<li>&#x652F;&#x6301;<code>Multipart</code>&#x8BF7;&#x6C42;&#x4E0E;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;</li>\n</ul>\n<h2 id=\"&#x914D;&#x7F6E;\"><a href=\"#&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;\"></a>&#x914D;&#x7F6E;</h2><p>&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x66F4;&#x65B0;&#x5230;<code>Retrofit2</code>&#x4E86;&#xFF0C;&#x5BF9;&#x4E8E;<code>Android</code>&#x6765;&#x8BF4;&#x76F4;&#x63A5;&#x5728;<code>Gradle</code>&#x4E2D;&#x914D;&#x7F6E;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">compile &apos;com.squareup.retrofit2:retrofit:2.1.0&apos;</span><br></pre></td></tr></table></figure>\n<p>&#x6216;&#x8005;&#x67E5;&#x770B;<a href=\"https://github.com/square/retrofit\" target=\"_blank\" rel=\"noopener\">&#x5B98;&#x7F51;</a>&#x914D;&#x7F6E;&#x6700;&#x65B0;&#x7248;&#x672C;,<code>Retrofit</code>&#x9700;&#x8981;&#x7684;<code>Android</code>&#x6700;&#x4F4E;&#x7248;&#x672C;&#x4E3A;<code>2.3</code><br>&#x5BF9;&#x4E8E;<code>Retrofit2</code>&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x914D;&#x7F6E;<code>OkHttp</code>&#x4F9D;&#x8D56;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x9ED8;&#x8BA4;&#x4F1A;&#x4E00;&#x8D77;&#x914D;&#x7F6E;&#xFF0C;&#x5728;&#x4F7F;&#x7528;<code>Retrofit</code>&#x65F6;&#xFF0C;&#x4F1A;&#x4F7F;&#x7528;&#x4E00;&#x4E9B;&#x7C7B;&#x578B;&#x7684;&#x8F6C;&#x6362;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x4EE5;&#x4E0B;<code>6</code>&#x4E2D;&#x6D41;&#x884C;&#x7684;&#x7C7B;&#x578B;&#x4F9B;&#x9009;&#x62E9;</p>\n<ul>\n<li>Gson: com.squareup.retrofit2:converter-gson</li>\n<li>Jackson: com.squareup.retrofit2:converter-jackson</li>\n<li>Moshi: com.squareup.retrofit2:converter-moshi</li>\n<li>Protobuf: com.squareup.retrofit2:converter-protobuf</li>\n<li>Wire: com.squareup.retrofit2:converter-wire</li>\n<li>Simple XML: com.squareup.retrofit2:converter-simplexml</li>\n<li><p>Scalars (primitives, boxed, and String): com.squareup.retrofit2:converter-scalars</p>\n<p>&#x5728;<code>Gradle</code>&#x4E2D;&#x914D;&#x7F6E;&#x4E0E;<code>Retrofit</code>&#x5BF9;&#x4E8E;&#x7684;&#x7248;&#x672C;&#x53F7;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">compile &apos;com.squareup.retrofit2:converter-gson:2.1.0&apos;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h1 id=\"&#x4F7F;&#x7528;\"><a href=\"#&#x4F7F;&#x7528;\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;\"></a>&#x4F7F;&#x7528;</h1><p>&#x524D;&#x9762;&#x8BF4;&#x4E86;<code>Retrofit</code>&#x662F;&#x4F7F;&#x7528;&#x6CE8;&#x91CA;&#x6765;&#x5B9A;&#x4E49;&#x8BF7;&#x6C42;&#xFF0C;&#x4E14;&#x5B83;&#x5B9A;&#x4E49;&#x7684;&#x6CE8;&#x91CA;&#x662F;&#x5728;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6240;&#x4EE5;&#x6BCF;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x90FD;&#x5FC5;&#x987B;&#x8981;&#x6709;&#x76F8;&#x5E94;&#x7684;<code>Http</code>&#x6CE8;&#x91CA;&#x4E0E;&#x8BF7;&#x6C42;&#x7684;<code>URL</code>&#x3002;<code>Retrofit</code>&#x652F;&#x6301;<code>5</code>&#x4E2D;&#x5185;&#x7F6E;&#x7684;&#x6CE8;&#x91CA;&#x7684;<code>Http</code>&#x8BF7;&#x6C42;&#x65B9;&#x5F0F;&#xFF1A;<code>GET</code>&#x3001;<code>POST</code>&#x3001;<code>PUT</code>&#x3001;<code>DELETE</code>&#x4E0E;<code>HEAD</code>&#x3002;&#x4E0B;&#x9762;&#x6765;&#x770B;&#x4E0B;&#x7B80;&#x5355;&#x7684;&#x5B9A;&#x4E49;&#x3002;</p>\n<p>&#x5B9A;&#x4E49;&#x7684;<code>URL</code>&#x5305;&#x62EC;&#x4E24;&#x90E8;&#x5206;&#x4E00;&#x90E8;&#x5206;&#x4E3A;<code>host</code>&#x4E5F;&#x79F0;&#x4E3A;<code>baseUrl</code>&#x4F8B;&#x5982;&#xFF1A;<code>https://api.github.com</code>&#xFF0C;&#x522B;&#x4E00;&#x90E8;&#x5206;&#x4E3A;<code>path</code>&#x4F8B;&#x5982;:<code>users/list</code>&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x6CE8;&#x91CA;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;<code>url</code>&#x4E00;&#x822C;&#x4E3A;<code>path</code>&#x90E8;&#x5206;&#x3002;</p>\n<blockquote>\n<p>&#x4EE5;&#x4E0B;&#x7684;&#x4ECB;&#x7ECD;&#x90FD;&#x662F;&#x9488;&#x5BF9;<code>Retrofit2</code>&#x6765;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x4E0E;<code>Retrofit1.9</code>&#x6709;&#x7684;&#x5730;&#x65B9;&#x8FD8;&#x662F;&#x6709;&#x533A;&#x522B;&#x3002;</p>\n</blockquote>\n<h2 id=\"GET\"><a href=\"#GET\" class=\"headerlink\" title=\"GET\"></a>GET</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GET(&quot;users/list&quot;)</span><br></pre></td></tr></table></figure>\n<p>&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5E26;&#x53C2;&#x6570;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GET(&quot;users/list?sort=desc&quot;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"Path\"><a href=\"#Path\" class=\"headerlink\" title=\"Path\"></a>Path</h2><p>&#x5176;&#x5B9E;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x52A8;&#x6001;&#x66F4;&#x65B0;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x5B9A;&#x4E49;<code>path</code>&#xFF0C;&#x518D;<code>path</code>&#x4E2D;&#x901A;&#x8FC7;&#x4F7F;&#x7528;<code>{}</code>&#x6765;&#x5B9A;&#x4E49;&#x9700;&#x8981;&#x52A8;&#x6001;&#x66FF;&#x4EE3;&#x7684;&#x5B57;&#x6BB5;&#xFF0C;&#x518D;&#x5230;&#x65B9;&#x6CD5;&#x4E2D;&#x4F7F;&#x7528;<code>@Path()</code>&#x6765;&#x5B9A;&#x4E49;&#x66FF;&#x4EE3;&#x7684;&#x53D8;&#x91CF;&#x503C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GET(&quot;group/{address}/users&quot;)</span><br><span class=\"line\">Call&lt;List&lt;User&gt;&gt; groupList(@Path(&quot;address&quot;) String address);</span><br></pre></td></tr></table></figure>\n<p><code>@Path</code>&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x7684;&#x5B57;&#x6BB5;<code>encoded</code>&#x9ED8;&#x8BA4;&#x4E3A;<code>false</code>&#xFF0C;&#x5982;&#x679C;&#x4E3A;<code>true</code>&#x5C06;&#x4F1A;&#x5BF9;&#x7279;&#x6B8A;&#x7684;&#x5B57;&#x7B26;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#x8F6C;&#x6362;&#xFF0C;&#x4F8B;&#x5982;<code>key</code>&#x4E3A;<code>address</code>&#x7684;<code>value</code>&#x4E3A;<code>maer-se</code>,&#x9ED8;&#x8BA4;&#x7F16;&#x7801;&#x7684;<code>url</code>&#x4E3A;<code>group/maer-se/users</code>&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x5BF9;<code>encoded</code>&#x8BBE;&#x7F6E;&#x4E3A;<code>true</code>&#x5C06;&#x4F1A;&#x5BF9;<code>-</code>&#x5B57;&#x7B26;&#x8FDB;&#x884C;&#x8F6C;&#x6362;&#x6700;&#x7EC8;&#x53D8;&#x6210;&#x4E86;<code>group/maer%2Dse/users</code>,&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GET(&quot;group/{address}/users&quot;)</span><br><span class=\"line\">Call&lt;List&lt;User&gt;&gt; groupList(@Path(value = &quot;address&quot;, encoded = true) String address);</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x540E;&#x7EED;&#x7684;<code>Query</code>&#x3001;<code>QueryMap</code>&#x3001;<code>Part</code>&#x3001;<code>PartMap</code>&#x3001;<code>Field</code>&#x4E0E;<code>FieldMap</code>&#x90FD;&#x6709;&#x8FD9;&#x4E2A;&#x7279;&#x6027;</p>\n</blockquote>\n<h2 id=\"Query\"><a href=\"#Query\" class=\"headerlink\" title=\"Query\"></a>Query</h2><p>&#x53C2;&#x6570;&#x67E5;&#x8BE2;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F7F;&#x7528;<code>@Query()</code>&#x6765;&#x5B9A;&#x4E49;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET(&quot;group/{id}/users&quot;)</span><br><span class=\"line\">Call&lt;List&lt;User&gt;&gt; groupList(@Path(&quot;id&quot;) int groupId, @Query(&quot;user&quot;) String user,</span><br><span class=\"line\">@Query(&quot;address&quot;) String address);</span><br></pre></td></tr></table></figure>\n<h2 id=\"QueryMap\"><a href=\"#QueryMap\" class=\"headerlink\" title=\"QueryMap\"></a>QueryMap</h2><p>&#x5982;&#x679C;&#x53C2;&#x6570;&#x8FC7;&#x591A;&#x53EF;&#x4EE5;&#x501F;&#x52A9;<code>@QueryMap</code> &#x6765;&#x6784;&#x9020;<code>Map</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GET(&quot;group/{id}/users&quot;)</span><br><span class=\"line\">Call&lt;List&lt;User&gt;&gt; groupList(@Path(&quot;id&quot;) int groupId, @QueryMap Map&lt;String, String&gt; options);</span><br></pre></td></tr></table></figure>\n<p>&#x540C;&#x65F6;&#x5982;&#x679C;&#x5728;&#x8C03;&#x7528;<code>.groupList</code>&#x65F6;,&#x53EA;&#x8981;&#x53C2;&#x6570;&#x7684;&#x7C7B;&#x578B;&#x4E0D;&#x4E3A;&#x57FA;&#x672C;&#x7C7B;&#x578B;(<code>int</code>&#x3001;<code>double</code>&#x7B49;)&#xFF0C;&#x6216;&#x8005;&#x5C06;&#x57FA;&#x672C;&#x578B;&#x8F6C;&#x6362;&#x4E3A;<code>Integer,Double</code>&#x7B49;&#x65F6;&#x53EF;&#x4EE5;&#x4E3A;<code>null</code>&#xFF0C;&#x5982;&#x679C;&#x4E3A;<code>null</code>&#x90A3;&#x4E48;<code>Retrofit</code>&#x5C06;&#x4F1A;&#x5FFD;&#x7565;&#x4E0D;&#x4F1A;&#x5339;&#x914D;&#x8BE5;&#x53C2;&#x6570;&#x3002;&#x53E6;&#x5916;&#x5728;&#x4F7F;&#x7528;<code>QueryMap</code>&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x52A8;&#x6001;&#x5339;&#x914D;&#x4F60;&#x9700;&#x8981;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x7684;&#x53C2;&#x6570;&#x5C06;&#x4F1A;&#x81EA;&#x52A8;&#x5FFD;&#x7565;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Map&lt;String, String&gt; data = new HashMap&lt;&gt;();</span><br><span class=\"line\">    data.put(&quot;user&quot;, &quot;Marcus&quot;);</span><br><span class=\"line\">    Call&lt;List&lt;User&gt;&gt; call = newsService.groupList(2,data);</span><br><span class=\"line\">    call.enqueue(&#x2026;)</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x7684;<code>url</code>&#x4E3A;<code>https://api.github.com/group/2/users?user=Marcus</code>&#x5BF9;&#x4E8E;<code>address</code>&#x5C06;&#x81EA;&#x52A8;&#x5FFD;&#x7565;&#x3002;</p>\n<blockquote>\n<p>&#x8BF4;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#x8FD8;&#x662F;&#x4EE5;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#x6765;&#x5C55;&#x793A;&#x6574;&#x4E2A;&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x662F;<code>Github</code>&#x4E0A;&#x7684;</p>\n</blockquote>\n<h2 id=\"&#x793A;&#x4F8B;\"><a href=\"#&#x793A;&#x4F8B;\" class=\"headerlink\" title=\"&#x793A;&#x4F8B;\"></a>&#x793A;&#x4F8B;</h2><p>&#x5B9A;&#x4E49;&#x63A5;&#x53E3;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface GithubService {</span><br><span class=\"line\">    @GET(&quot;/repos/{owner}/{repo}/contributors&quot;)</span><br><span class=\"line\">    Call&lt;List&lt;Contributors&gt;&gt; contributors(</span><br><span class=\"line\">            @Path(&quot;owner&quot;) String owner,</span><br><span class=\"line\">            @Path(&quot;repo&quot;) String repo);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p><code>Contributors</code>&#x662F;&#x4E00;&#x4E2A;&#x5B9E;&#x4F53;&#x7C7B;&#xFF0C;&#x5BF9;&#x5E94;&#x4E8E;&#x8BF7;&#x6C42;&#x4E4B;&#x540E;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Contributors {</span><br><span class=\"line\">    public String login;</span><br><span class=\"line\">    public String contributions;</span><br><span class=\"line\"> </span><br><span class=\"line\">    public Contributors(String contributions, String login) {</span><br><span class=\"line\">        this.contributions = contributions;</span><br><span class=\"line\">        this.login = login;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;<code>Retrofit</code>&#x751F;&#x6210;&#x4F60;&#x5B9A;&#x4E49;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x5176;&#x4E2D;&#x54CD;&#x5E94;&#x7684;&#x6570;&#x636E;&#x662F;<code>Json</code>&#x7C7B;&#x578B;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x5BF9;<code>body</code>&#x505A;&#x76F8;&#x5E94;&#x7684;&#x8F6C;&#x5316;&#xFF0C;&#x901A;&#x8FC7;&#x6DFB;&#x52A0;<code>Converter</code>&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6DFB;&#x52A0;<code>Converter</code>&#x5B83;&#x9ED8;&#x8BA4;&#x662F;&#x4F7F;&#x7528;<code>OkHttp</code>&#x7684;<code>ResponseBody</code>&#x4E0E;<code>ResponseBody</code>&#x5BF9;&#x4E8E;&#x540E;&#x7EED;<code>POST</code>&#x8BBE;&#x7F6E;&#x7684;<code>@Body</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Retrofit retrofit = new Retrofit.Builder()</span><br><span class=\"line\">                .baseUrl(&quot;https://api.github.com&quot;)</span><br><span class=\"line\">                .addConverterFactory(GsonConverterFactory.create())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"> </span><br><span class=\"line\">GithubService service = retrofit.create(GithubService.class)</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x4F7F;&#x7528;<code>GsonConverterFactory.create()</code>&#x5FC5;&#x987B;&#x5728;<code>Gradle</code>&#x4E2D;&#x914D;&#x7F6E;&#x4E86;&#x524D;&#x9762;&#x6240;&#x8BF4;&#x7684;<code>6</code>&#x79CD;&#x7C7B;&#x578B;&#x4E2D;&#x7684;<code>Gson</code></p>\n</blockquote>\n<p>&#x6BCF;&#x4E00;&#x4E2A;<code>Call</code>&#x90FD;&#x662F;&#x6765;&#x81EA;&#x4E8E;&#x521B;&#x5EFA;&#x7684;&#x63A5;&#x53E3;&#x901A;&#x8FC7;&#x540C;&#x6B65;&#x6216;&#x8005;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x800C;&#x83B7;&#x5F97;&#x3002;&#x5728;&#x8C03;&#x7528;&#x63A5;&#x53E3;&#x7684;&#x65B9;&#x6CD5;&#x65F6;&#x53EF;&#x4EE5;&#x4F20;&#x5165;&#x5BF9;&#x5E94;&#x7684;&#x53C2;&#x6570;&#x6570;&#x636E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Call&lt;List&lt;Contributors&gt;&gt; call = service.contributors(&quot;square&quot;, &quot;retrofit&quot;);</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x540C;&#x8C03;&#x7528;<code>Call</code>&#x7684;<code>execute</code>&#x6267;&#x884C;&#x540C;&#x6B65;&#x8BF7;&#x6C42;&#xFF0C;&#x6216;&#x8005;&#x8C03;&#x7528;<code>Call</code>&#x7684;<code>enqueue</code>&#x6765;&#x6267;&#x884C;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#xFF0C;&#x83B7;&#x53D6;&#x54CD;&#x5E94;&#x7684;&#x7ED3;&#x679C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">try {</span><br><span class=\"line\">            List&lt;Contributors&gt; contributorses = call.execute().body();</span><br><span class=\"line\">            for (Contributors contributors : contributorses) {</span><br><span class=\"line\">                Log.v(&quot;TAG&quot;, contributors.login + &quot;(&quot; + contributors.contributions + &quot;)&quot;);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        } catch (IOException e) {</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        }</span><br></pre></td></tr></table></figure>\n<h2 id=\"POST\"><a href=\"#POST\" class=\"headerlink\" title=\"POST\"></a>POST</h2><p>&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x53EF;&#x80FD;&#x4F1A;&#x4F5C;&#x4E3A;<code>Http</code>&#x8BF7;&#x6C42;&#x7684;<code>body</code>&#x3002;&#x8FD9;&#x65F6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>@Body</code>&#x6CE8;&#x91CA;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@POST(&quot;users/new&quot;)</span><br><span class=\"line\">Call&lt;User&gt; createUser(@Body User user);</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>Retrofit</code>&#x7684;<code>converter</code>&#x6765;&#x8FDB;&#x884C;&#x7279;&#x6B8A;&#x7684;&#x8F6C;&#x5316;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6DFB;&#x52A0;<code>converter</code>&#x5B83;&#x5C06;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;<code>RequestBody</code></p>\n<h2 id=\"FormUrlEncoded-And-Multipart\"><a href=\"#FormUrlEncoded-And-Multipart\" class=\"headerlink\" title=\"FormUrlEncoded And Multipart\"></a>FormUrlEncoded And Multipart</h2><p>&#x5BF9;&#x4E8E;&#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x7684;&#x65B9;&#x6CD5;&#x4E5F;&#x53EF;&#x4EE5;&#x53D1;&#x9001;<code>form-encoded</code>&#x4E0E;<code>multipart</code>&#x6570;&#x636E;&#x7C7B;&#x578B;&#x3002;</p>\n<h3 id=\"Field-And-FiledMap\"><a href=\"#Field-And-FiledMap\" class=\"headerlink\" title=\"Field And FiledMap\"></a>Field And FiledMap</h3><p>&#x5BF9;&#x4E8E;<code>form-encoded</code>&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x4E00;&#x822C;<code>Content-type</code>&#x4E3A;<code>x-www-form-urlencoded</code>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>@FormUrlEncoded</code>&#x6765;&#x5BF9;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x6CE8;&#x91CA;&#x8BF4;&#x660E;&#xFF0C;&#x6BCF;&#x4E00;&#x5BF9;&#x7684;<code>key-value</code>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>@Field</code>&#x6765;&#x8FDB;&#x884C;&#x5B9A;&#x4E49;&#xFF0C;&#x5206;&#x522B;&#x63D0;&#x4F9B;<code>key</code>&#x4E0E;<code>value</code>&#x3002;&#x5BF9;&#x4E8E;&#x591A;&#x5BF9;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>@FieldMap</code>&#x8FDB;&#x884C;&#x7EDF;&#x4E00;&#x8BBE;&#x7F6E;,&#x4F7F;&#x7528;&#x4E0E;<code>@QueryMap</code>&#x7C7B;&#x4F3C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@FormUrlEncoded</span><br><span class=\"line\">@POST(&quot;user/edit&quot;)</span><br><span class=\"line\">Call&lt;User&gt; updateUser(@Field(&quot;first_name&quot;) String first, @Field(&quot;last_name&quot;) String last);</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;&#x6709;&#x591A;&#x4E2A;&#x76F8;&#x540C;&#x7684;&#x5B57;&#x6BB5;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6570;&#x7EC4;&#x6765;&#x5B9A;&#x4E49;&#x5B57;&#x6BB5;&#x7684;&#x503C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@FormUrlEncoded</span><br><span class=\"line\">@POST(&quot;tasks&quot;)</span><br><span class=\"line\">Call&lt;List&lt;Task&gt;&gt; createTasks(@Field(&quot;title&quot;) List&lt;String&gt; titles);</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><code>FromUrlEncoded</code>&#x4E0E;<code>Query Parameter</code>&#x7684;&#x4E3B;&#x8981;&#x533A;&#x522B;&#x662F;&#xFF0C;&#x524D;&#x8005;&#x662F;<code>POST</code>&#x540E;&#x8005;&#x662F;<code>GET</code>&#xFF0C;&#x540C;&#x65F6;&#x524D;&#x8005;&#x7684;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x662F;&#x653E;&#x5728;<code>request body</code>&#x4E2D;&#xFF0C;&#x800C;&#x540E;&#x8005;&#x662F;&#x653E;&#x5728;<code>url</code>&#x4E2D;&#x3002;</p>\n</blockquote>\n<h3 id=\"Part-And-PartMap\"><a href=\"#Part-And-PartMap\" class=\"headerlink\" title=\"Part And PartMap\"></a>Part And PartMap</h3><p>&#x9700;&#x8981;<code>Multipart</code>&#x8BF7;&#x6C42;&#x65F6;&#x5373;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x4E00;&#x822C;<code>Content-type</code>&#x4E3A;<code>multipart/form-data</code>,&#x53EA;&#x8981;&#x5728;&#x65B9;&#x6CD5;&#x4E0A;&#x9762;&#x4F7F;&#x7528;<code>@Multipart</code>&#x6CE8;&#x91CA;&#xFF0C;&#x540C;&#x65F6;&#x5BF9;&#x4E8E;<code>Parts</code>&#x90E8;&#x5206;&#x7684;&#x5B9A;&#x4E49;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>@Part</code>&#x6CE8;&#x91CA;&#xFF0C;&#x76F8;&#x5E94;&#x7684;<code>@PartMap</code>&#x4E5F;&#x5B58;&#x5728;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Multipart</span><br><span class=\"line\">@PUT(&quot;user/photo&quot;)</span><br><span class=\"line\">Call&lt;User&gt; updateUser(@Part(&quot;photo&quot;) RequestBody photo, </span><br><span class=\"line\">\t\t\t\t @Part(&quot;description&quot;) RequestBody description);</span><br></pre></td></tr></table></figure>\n<p><code>Multipart</code>&#x9ED8;&#x8BA4;&#x4E5F;&#x662F;&#x4F7F;&#x7528;<code>RequestBody</code>&#x64CD;&#x4F5C;&#x5B83;&#x7684;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x6216;&#x8005;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>converter</code>&#x6765;&#x5B9E;&#x73B0;&#x3002;</p>\n<h2 id=\"Headers-And-Header\"><a href=\"#Headers-And-Header\" class=\"headerlink\" title=\"Headers And Header\"></a>Headers And Header</h2><p><code>@Headers</code>&#x6CE8;&#x91CA;&#x662F;&#x4E3A;&#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x9759;&#x6001;&#x7684;<code>headers</code>&#xFF0C;&#x4E14;&#x76F8;&#x540C;&#x7684;<code>name</code>&#x4E0D;&#x4F1A;&#x88AB;&#x8986;&#x76D6;&#xFF0C;&#x90FD;&#x4F1A;&#x5305;&#x542B;&#x5230;&#x8BF7;&#x6C42;&#x4E2D;;&#x800C;<code>@Header</code>&#x6CE8;&#x91CA;&#x662F;&#x4E3A;&#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x52A8;&#x6001;&#x7684;<code>header</code>,&#x5B83;&#x5C06;&#x4F1A;&#x76F8;&#x5F53;&#x4E0E;&#x53C2;&#x6570;&#x6765;&#x5BF9;<code>@Header</code>&#x8FDB;&#x884C;&#x63D0;&#x4F9B;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x503C;&#x4E3A;<code>null</code>&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C06;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Headers({&quot;Connection: keep-alive&quot;,</span><br><span class=\"line\">            &quot;Accept-Language:zh-CN,zh;q=0.8,en;q=0.6&quot;})</span><br><span class=\"line\">    @GET(&quot;/settings&quot;)</span><br><span class=\"line\">    Call&lt;String&gt; settingService(@Header(&quot;Cookie&quot;) String cookie);</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x5982;&#x679C;&#x662F;&#x6700;&#x65B0;&#x7248;&#x672C;&#x7684;<code>Retrofit2.1</code>,&#x4E5F;&#x652F;&#x6301;<code>@HeaderMap</code></p>\n</blockquote>\n<h2 id=\"&#x793A;&#x4F8B;-1\"><a href=\"#&#x793A;&#x4F8B;-1\" class=\"headerlink\" title=\"&#x793A;&#x4F8B;\"></a>&#x793A;&#x4F8B;</h2><p>&#x518D;&#x6765;&#x8D34;&#x4E00;&#x4E2A;&#x591A;&#x8BF4;&#x6587;&#x7AE0;&#x8BF7;&#x6C42;&#x7684;&#x5B8C;&#x6574;&#x793A;&#x4F8B;&#xFF0C;&#x5148;&#x6765;&#x770B;&#x4E0B;&#x9700;&#x8981;&#x8BF7;&#x6C42;&#x793A;&#x4F8B;&#x8D44;&#x6E90;</p>\n<p><img src=\"/2016/11/15/&#x5E26;&#x4F60;&#x8D70;&#x8FDB;Retrofit&#x7684;&#x65B0;&#x4E16;&#x754C;/1.png\" alt=\"General\"></p>\n<p><img src=\"/2016/11/15/&#x5E26;&#x4F60;&#x8D70;&#x8FDB;Retrofit&#x7684;&#x65B0;&#x4E16;&#x754C;/2.png\" alt=\"Query String Parameters\"></p>\n<p>&#x76F8;&#x4FE1;&#x5E94;&#x8BE5;&#x5F88;&#x6E05;&#x695A;&#x4E86;&#xFF0C;&#x8BF7;&#x6C42;&#x65B9;&#x5F0F;&#x4E3A;<code>GET</code>&#xFF0C;&#x8BF7;&#x6C42;&#x7684;<code>Url</code>&#x4E3A;<code>http://idisfkj.duoshuo.com/api/threads/list.json?short_name=idisfkj&amp;order=desc&amp;limit=30&amp;nonce=57f1b19209428</code>,&#x8BF7;&#x6C42;&#x67E5;&#x8BE2;&#x7684;&#x53C2;&#x6570;&#x4E3A;<code>short_name</code>&#x3001;<code>order</code>&#x3001;<code>limit</code>&#x4E0E;<code>nonce</code>&#xFF0C;<code>Ok</code>&#x9700;&#x8981;&#x77E5;&#x9053;&#x7684;&#x90FD;&#x6709;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x6765;<code>code</code>&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface DuoShuoArticleService {</span><br><span class=\"line\">    @GET(&quot;/api/threads/list.json&quot;)</span><br><span class=\"line\">    Call&lt;DuoShuoArticle&gt; articleService(@Query(&quot;short_name&quot;) String shortName,</span><br><span class=\"line\">                                        @Query(&quot;order&quot;) String order,</span><br><span class=\"line\">                                        @Query(&quot;limit&quot;) int limit,</span><br><span class=\"line\">                                        @Query(&quot;nonce&quot;) String onnce);</span><br><span class=\"line\"> </span><br><span class=\"line\">    @GET(&quot;/api/threads/list.json&quot;)</span><br><span class=\"line\">    Call&lt;DuoShuoArticle&gt; articleServiceMap(@Query(&quot;limit&quot;) int limit,</span><br><span class=\"line\">                                           @QueryMap Map&lt;String, String&gt; options);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   /**</span><br><span class=\"line\">     * get &#x5BF9;url&#x7684;&#x4F20;&#x53C2;&#x67E5;&#x8BE2;&#x53D1;&#x8D77;&#x8BF7;&#x6C42; &#x8FD4;&#x56DE;json&#x7C7B;&#x578B;&#x7684;response</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public void getDuoShuoArticle() {</span><br><span class=\"line\">        Retrofit retrofit = new Retrofit.Builder()</span><br><span class=\"line\">                .baseUrl(&quot;http://idisfkj.duoshuo.com&quot;)</span><br><span class=\"line\">                .addConverterFactory(GsonConverterFactory.create())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">        DuoShuoArticleService articleService = retrofit.create(DuoShuoArticleService.class);</span><br><span class=\"line\">        Call&lt;DuoShuoArticle&gt; call = articleService.articleService(&quot;idisfkj&quot;, &quot;desc&quot;, 5, &quot;57f1b19209428&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        //&#x4F7F;&#x7528;QueryMap</span><br><span class=\"line\">//                Map&lt;String,String&gt; map = new HashMap&lt;String, String&gt;();</span><br><span class=\"line\">//                map.put(&quot;short_name&quot;,&quot;idisfkj&quot;);</span><br><span class=\"line\">//                map.put(&quot;order&quot;,&quot;desc&quot;);</span><br><span class=\"line\">//                map.put(&quot;nonce&quot;,&quot;57f1b19209428&quot;);</span><br><span class=\"line\">//                Call&lt;DuoShuoArticle&gt; call = articleService.articleServiceMap(5,map);</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            Response&lt;DuoShuoArticle&gt; response = call.execute();</span><br><span class=\"line\">            List&lt;DuoShuoArticle.ResponseBean&gt; list = response.body().getResponse();</span><br><span class=\"line\"> </span><br><span class=\"line\">            for (DuoShuoArticle.ResponseBean responseBean : list) {</span><br><span class=\"line\">                Log.v(&quot;TAG&quot;, responseBean.getThread_key() + &quot;-&gt;&quot; + responseBean.getTitle());</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">        } catch (IOException e) {</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">11-16 02:09:43.989 2061-2079/? V/TAG: duoshuo-&gt;&#x5E26;&#x4F60;&#x8D70;&#x8FDB;Retrofit&#x7684;&#x65B0;&#x4E16;&#x754C;</span><br><span class=\"line\">11-16 02:09:43.989 2061-2079/? V/TAG: duoshuo-&gt;Android &#x81EA;&#x5B9A;&#x4E49;View</span><br><span class=\"line\">11-16 02:09:43.989 2061-2079/? V/TAG: duoshuo-&gt;Android Handler&#x3001;Looper&#x4E0E;MessageQueue&#x6E90;&#x7801;&#x5206;&#x6790;</span><br><span class=\"line\">11-16 02:09:43.989 2061-2079/? V/TAG: duoshuo-&gt;Android Volley&#x6E90;&#x7801;&#x5206;&#x6790;(&#x4E8C;)</span><br><span class=\"line\">11-16 02:09:43.989 2061-2079/? V/TAG: duoshuo-&gt;Android Volley&#x6E90;&#x7801;&#x5206;&#x6790;(&#x4E00;)</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x5982;&#x679C;&#x4F60;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x90A3;&#x4E48;&#x606D;&#x559C;&#x4F60;&#x5BF9;<code>Retrofit</code>&#x4E5F;&#x5165;&#x95E8;&#x4E86;&#xFF0C;&#x540E;&#x7EED;&#x6211;&#x8FD8;&#x4F1A;&#x7EE7;&#x7EED;&#x63A2;&#x7A76;&#x4E0E;&#x5927;&#x5BB6;&#x8FDB;&#x884C;&#x5206;&#x4EAB;&#x3002;</p>\n</blockquote>\n","categories":["android"],"tags":["retrofit"]},{"title":"Android 自定义View","url":"https://www.rousetime.com/2016/11/13/Android-自定义View/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p><code>Android</code>&#x81EA;&#x5B9A;&#x4E49;<code>View</code>&#x7684;&#x8BE6;&#x7EC6;&#x6B65;&#x9AA4;&#x662F;&#x6211;&#x4EEC;&#x6BCF;&#x4E00;&#x4E2A;<code>Android</code>&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x90FD;&#x5FC5;&#x987B;&#x638C;&#x63E1;&#x7684;&#x6280;&#x80FD;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x5F00;&#x53D1;&#x4E2D;&#x603B;&#x4F1A;&#x9047;&#x5230;&#x81EA;&#x5B9A;&#x4E49;<code>View</code>&#x7684;&#x9700;&#x6C42;&#x3002;&#x4E3A;&#x4E86;&#x63D0;&#x9AD8;&#x81EA;&#x5DF1;&#x7684;&#x6280;&#x672F;&#x6C34;&#x5E73;&#xFF0C;&#x81EA;&#x5DF1;&#x5C31;&#x7CFB;&#x7EDF;&#x7684;&#x53BB;&#x7814;&#x7A76;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x5199;&#x4E0B;&#x4E00;&#x70B9;&#x5FC3;&#x5F97;&#xFF0C;&#x6709;&#x4E0D;&#x8DB3;&#x4E4B;&#x5904;&#x5E0C;&#x671B;&#x5927;&#x5BB6;&#x53CA;&#x65F6;&#x6307;&#x51FA;&#x3002;</p>\n<h1 id=\"&#x6D41;&#x7A0B;\"><a href=\"#&#x6D41;&#x7A0B;\" class=\"headerlink\" title=\"&#x6D41;&#x7A0B;\"></a>&#x6D41;&#x7A0B;</h1><p>&#x5728;<code>Android</code>&#x4E2D;&#x5BF9;&#x4E8E;&#x5E03;&#x5C40;&#x7684;&#x8BF7;&#x6C42;&#x7ED8;&#x5236;&#x662F;&#x5728;<code>Android framework</code>&#x5C42;&#x5F00;&#x59CB;&#x5904;&#x7406;&#x7684;&#x3002;&#x7ED8;&#x5236;&#x662F;&#x4ECE;&#x6839;&#x8282;&#x70B9;&#x5F00;&#x59CB;&#xFF0C;&#x5BF9;&#x5E03;&#x5C40;&#x6811;&#x8FDB;&#x884C;<code>measure</code>&#x4E0E;<code>draw</code>&#x3002;&#x5728;<code>RootViewImpl</code>&#x4E2D;&#x7684;<code>performTraversals</code>&#x5C55;&#x5F00;&#x3002;&#x5B83;&#x6240;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5BF9;&#x9700;&#x8981;&#x7684;&#x89C6;&#x56FE;&#x8FDB;&#x884C;<code>measure</code>&#xFF08;&#x6D4B;&#x91CF;&#x89C6;&#x56FE;&#x5927;&#x5C0F;&#xFF09;&#x3001;<code>layout</code>&#xFF08;&#x786E;&#x5B9A;&#x89C6;&#x56FE;&#x7684;&#x4F4D;&#x7F6E;&#xFF09;&#x4E0E;<code>draw</code>&#xFF08;&#x7ED8;&#x5236;&#x89C6;&#x56FE;&#xFF09;&#x3002;&#x4E0B;&#x9762;&#x7684;&#x56FE;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x5C55;&#x73B0;&#x89C6;&#x56FE;&#x7684;&#x7ED8;&#x5236;&#x6D41;&#x7A0B;&#xFF1A;</p>\n<p><img src=\"https://raw.githubusercontent.com/android-cn/android-open-project-analysis/master/tech/viewdrawflow/image/view_draw_method_chain.png\" alt=\"View&#x7684;&#x7ED8;&#x5236;&#x6D41;&#x7A0B;&#x56FE;\"></p>\n<blockquote>\n<p>&#x5F53;&#x7528;&#x6237;&#x8C03;&#x7528;<code>requestLayout</code>&#x65F6;&#xFF0C;&#x53EA;&#x4F1A;&#x89E6;&#x53D1;<code>measure</code>&#x4E0E;<code>layout</code>&#xFF0C;&#x4F46;&#x7CFB;&#x7EDF;&#x5F00;&#x59CB;&#x8C03;&#x7528;&#x65F6;&#x8FD8;&#x4F1A;&#x89E6;&#x53D1;<code>draw</code></p>\n</blockquote>\n<p>&#x4E0B;&#x9762;&#x6765;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x8FD9;&#x51E0;&#x4E2A;&#x6D41;&#x7A0B;&#x3002;</p>\n<h2 id=\"measure\"><a href=\"#measure\" class=\"headerlink\" title=\"measure\"></a>measure</h2><p><code>measure</code>&#x662F;<code>View</code>&#x4E2D;&#x7684;<code>final</code>&#x578B;&#x65B9;&#x6CD5;&#x4E0D;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x91CD;&#x5199;&#x3002;&#x5B83;&#x662F;&#x5BF9;&#x89C6;&#x56FE;&#x7684;&#x5927;&#x5C0F;&#x8FDB;&#x884C;&#x6D4B;&#x91CF;&#x8BA1;&#x7B97;&#xFF0C;&#x4F46;&#x5B83;&#x4F1A;&#x56DE;&#x8C03;<code>onMeasure</code>&#x65B9;&#x6CD5;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5728;&#x81EA;&#x5B9A;&#x4E49;<code>View</code>&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x91CD;&#x5199;<code>onMeasure</code>&#x65B9;&#x6CD5;&#x6765;&#x5BF9;<code>View</code>&#x8FDB;&#x884C;&#x6211;&#x4EEC;&#x6240;&#x9700;&#x8981;&#x7684;&#x6D4B;&#x91CF;&#x3002;&#x5B83;&#x6709;&#x4E24;&#x4E2A;&#x53C2;&#x6570;<code>widthMeasureSpec</code>&#x4E0E;<code>heightMeasureSpec</code>&#x3002;&#x5176;&#x5B9E;&#x8FD9;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x90FD;&#x5305;&#x542B;&#x4E24;&#x90E8;&#x5206;&#xFF0C;&#x5206;&#x522B;&#x4E3A;<code>size</code>&#x4E0E;<code>mode</code>&#x3002;<code>size</code>&#x4E3A;&#x6D4B;&#x91CF;&#x7684;&#x5927;&#x5C0F;&#x800C;<code>mode</code>&#x4E3A;&#x89C6;&#x56FE;&#x5E03;&#x5C40;&#x7684;&#x6A21;&#x5F0F;<br>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x5206;&#x522B;&#x83B7;&#x53D6;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int widthSize = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class=\"line\">int heightSize = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class=\"line\">int widthMode = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class=\"line\">int heightMode = MeasureSpec.getMode(heightMeasureSpec);</span><br></pre></td></tr></table></figure>\n<p>&#x83B7;&#x53D6;&#x5230;&#x7684;<code>mode</code>&#x79CD;&#x7C7B;&#x5206;&#x4E3A;&#x4EE5;&#x4E0B;&#x4E09;&#x79CD;&#xFF1A;</p>\n<table>\n<thead>\n<tr>\n<th>MODE</th>\n<th>EXPLAIN</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>UNSPECIFiED</td>\n<td>&#x7236;&#x89C6;&#x56FE;&#x4E0D;&#x5BF9;&#x5B50;&#x89C6;&#x56FE;&#x8FDB;&#x884C;&#x7EA6;&#x675F;&#xFF0C;&#x5B50;&#x89C6;&#x56FE;&#x5927;&#x5C0F;&#x53EF;&#x4EE5;&#x662F;&#x4EFB;&#x610F;&#x5927;&#x5C0F;&#xFF0C;&#x4E00;&#x822C;&#x662F;&#x5BF9;<code>ListView</code>&#x3001;<code>ScrollView</code>&#x7B49;&#x8FDB;&#x884C;&#x81EA;&#x5B9A;&#x4E49;&#xFF0C;&#x4E00;&#x822C;&#x7528;&#x4E0D;&#x5230;</td>\n</tr>\n<tr>\n<td>EXACTLY</td>\n<td>&#x7236;&#x89C6;&#x56FE;&#x5BF9;&#x5B50;&#x89C6;&#x56FE;&#x8BBE;&#x5B9A;&#x4E86;&#x4E00;&#x4E2A;&#x7CBE;&#x786E;&#x7684;&#x5C3A;&#x5BF8;&#xFF0C;&#x5B50;&#x89C6;&#x56FE;&#x4E0D;&#x8D85;&#x8FC7;&#x8BE5;&#x5C3A;&#x5BF8;&#xFF0C;&#x4E00;&#x822C;&#x4E3A;&#x7CBE;&#x786E;&#x7684;&#x503C;&#x4F8B;&#x5982;<code>200dp</code>&#x6216;&#x8005;&#x4F7F;&#x7528;&#x4E86;<code>match_parent</code></td>\n</tr>\n<tr>\n<td>AT_MOST</td>\n<td>&#x7236;&#x89C6;&#x56FE;&#x5BF9;&#x5B50;&#x89C6;&#x56FE;&#x6307;&#x5B9A;&#x4E86;&#x4E00;&#x6700;&#x5927;&#x7684;&#x5C3A;&#x5BF8;&#xFF0C;&#x786E;&#x4FDD;&#x5B50;&#x89C6;&#x56FE;&#x7684;&#x6240;&#x4EE5;&#x5185;&#x5BB9;&#x90FD;&#x521A;&#x597D;&#x80FD;&#x5728;&#x8BE5;&#x5C3A;&#x5BF8;&#x4E2D;&#x663E;&#x793A;&#x51FA;&#x6765;&#xFF0C;&#x4E00;&#x822C;&#x4E3A;<code>wrap_content</code>,&#x8FD9;&#x79CD;&#x7236;&#x89C6;&#x56FE;&#x4E0D;&#x80FD;&#x83B7;&#x53D6;&#x5B50;&#x89C6;&#x56FE;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x53EA;&#x80FD;&#x7531;&#x5B50;&#x89C6;&#x56FE;&#x81EA;&#x5DF1;&#x53BB;&#x8BA1;&#x7B97;&#x5C3A;&#x5BF8;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x6211;&#x4EEC;&#x6D4B;&#x91CF;&#x8981;&#x5B9E;&#x73B0;&#x7684;&#x903B;&#x8F91;&#x60C5;&#x51B5;</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"setMeasuredDimension\"><a href=\"#setMeasuredDimension\" class=\"headerlink\" title=\"setMeasuredDimension\"></a>setMeasuredDimension</h3><p>&#x901A;&#x8FC7;&#x4EE5;&#x4E0A;&#x903B;&#x8F91;&#x83B7;&#x53D6;&#x89C6;&#x56FE;&#x7684;&#x5BBD;&#x9AD8;&#xFF0C;&#x6700;&#x540E;&#x8981;&#x8C03;&#x7528;<code>setMeasuredDimension</code>&#x65B9;&#x6CD5;&#x5C06;&#x6D4B;&#x91CF;&#x597D;&#x7684;&#x5BBD;&#x9AD8;&#x8FDB;&#x884C;&#x4F20;&#x9012;&#x51FA;&#x53BB;&#x3002;&#x5176;&#x5B9E;&#x6700;&#x7EC8;&#x662F;&#x8C03;&#x7528;<code>setMeasuredDimensionRaw</code>&#x65B9;&#x6CD5;&#x5BF9;&#x4F20;&#x8FC7;&#x6765;&#x7684;&#x503C;&#x8FDB;&#x884C;&#x5C5E;&#x6027;&#x8D4B;&#x503C;&#x3002;&#x8C03;&#x7528;<code>super.onMeasure()</code>&#x7684;&#x8C03;&#x7528;&#x903B;&#x8F91;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;<br>&#x4E0B;&#x9762;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;<code>&#x9A8C;&#x8BC1;&#x7801;&#x7684;View</code>&#x4E3A;&#x4F8B;&#xFF0C;&#x5B83;&#x7684;<code>onMeasure</code>&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {</span><br><span class=\"line\">        int widthSize = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class=\"line\">        int heightSize = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class=\"line\">        int widthMode = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class=\"line\">        int heightMode = MeasureSpec.getMode(heightMeasureSpec);</span><br><span class=\"line\">        if (widthMode == MeasureSpec.EXACTLY) {</span><br><span class=\"line\">            //&#x76F4;&#x63A5;&#x83B7;&#x53D6;&#x7CBE;&#x786E;&#x7684;&#x5BBD;&#x5EA6;</span><br><span class=\"line\">            width = widthSize;</span><br><span class=\"line\">        } else if (widthMode == MeasureSpec.AT_MOST) {</span><br><span class=\"line\">            //&#x8BA1;&#x7B97;&#x51FA;&#x5BBD;&#x5EA6;(&#x6587;&#x672C;&#x7684;&#x5BBD;&#x5EA6;+padding&#x7684;&#x5927;&#x5C0F;)</span><br><span class=\"line\">            width = bounds.width() + getPaddingLeft() + getPaddingRight();</span><br><span class=\"line\">        }</span><br><span class=\"line\">        if (heightMode == MeasureSpec.EXACTLY) {</span><br><span class=\"line\">            //&#x76F4;&#x63A5;&#x83B7;&#x53D6;&#x7CBE;&#x786E;&#x7684;&#x9AD8;&#x5EA6;</span><br><span class=\"line\">            height = heightSize;</span><br><span class=\"line\">        } else if (heightMode == MeasureSpec.AT_MOST) {</span><br><span class=\"line\">            //&#x8BA1;&#x7B97;&#x51FA;&#x9AD8;&#x5EA6;(&#x6587;&#x672C;&#x7684;&#x9AD8;&#x5EA6;+padding&#x7684;&#x5927;&#x5C0F;)</span><br><span class=\"line\">            height = bounds.height() + getPaddingBottom() + getPaddingTop();</span><br><span class=\"line\">        }</span><br><span class=\"line\">        //&#x8BBE;&#x7F6E;&#x83B7;&#x53D6;&#x7684;&#x5BBD;&#x9AD8;</span><br><span class=\"line\">        setMeasuredDimension(width, height);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x53EF;&#x4EE5;&#x5BF9;&#x81EA;&#x5B9A;&#x4E49;<code>View</code>&#x7684;<code>layout_width</code>&#x4E0E;<code>layout_height</code>&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x8FBE;&#x5230;&#x4E0D;&#x540C;&#x7684;<code>mode</code>&#x7C7B;&#x578B;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x6548;&#x679C;</p>\n</blockquote>\n<h3 id=\"measureChildren\"><a href=\"#measureChildren\" class=\"headerlink\" title=\"measureChildren\"></a>measureChildren</h3><p>&#x5982;&#x679C;&#x4F60;&#x662F;&#x5BF9;&#x7EE7;&#x627F;<code>ViewGroup</code>&#x7684;&#x81EA;&#x5B9A;&#x4E49;<code>View</code>&#x90A3;&#x4E48;&#x5728;&#x8FDB;&#x884C;&#x6D4B;&#x91CF;&#x81EA;&#x8EAB;&#x7684;&#x5927;&#x5C0F;&#x65F6;&#x8FD8;&#x8981;&#x6D4B;&#x91CF;&#x5B50;&#x89C6;&#x56FE;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x4E00;&#x822C;&#x901A;&#x8FC7;<code>measureChildren(int widthMeasureSpec, int heightMeasureSpec)</code>&#x65B9;&#x6CD5;&#x6765;&#x6D4B;&#x91CF;&#x5B50;&#x89C6;&#x56FE;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected void measureChildren(int widthMeasureSpec, int heightMeasureSpec) {</span><br><span class=\"line\">        final int size = mChildrenCount;</span><br><span class=\"line\">        final View[] children = mChildren;</span><br><span class=\"line\">        for (int i = 0; i &lt; size; ++i) {</span><br><span class=\"line\">            final View child = children[i];</span><br><span class=\"line\">            if ((child.mViewFlags &amp; VISIBILITY_MASK) != GONE) {</span><br><span class=\"line\">                measureChild(child, widthMeasureSpec, heightMeasureSpec);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x6E90;&#x7801;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x5B83;&#x5176;&#x5B9E;&#x662F;&#x904D;&#x5386;&#x6BCF;&#x4E00;&#x4E2A;&#x5B50;&#x89C6;&#x56FE;&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x5B50;&#x89C6;&#x56FE;&#x4E0D;&#x662F;&#x9690;&#x85CF;&#x7684;&#x5C31;&#x8C03;&#x7528;<code>measureChild</code>&#x65B9;&#x6CD5;&#xFF0C;&#x90A3;&#x4E48;&#x6765;&#x770B;&#x4E0B;<code>measureChild</code>&#x6E90;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected void measureChild(View child, int parentWidthMeasureSpec,</span><br><span class=\"line\">            int parentHeightMeasureSpec) {</span><br><span class=\"line\">        final LayoutParams lp = child.getLayoutParams();</span><br><span class=\"line\">        final int childWidthMeasureSpec = getChildMeasureSpec(parentWidthMeasureSpec,</span><br><span class=\"line\">                mPaddingLeft + mPaddingRight, lp.width);</span><br><span class=\"line\">        final int childHeightMeasureSpec = getChildMeasureSpec(parentHeightMeasureSpec,</span><br><span class=\"line\">                mPaddingTop + mPaddingBottom, lp.height);</span><br><span class=\"line\">        child.measure(childWidthMeasureSpec, childHeightMeasureSpec);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x9996;&#x5148;&#x8C03;&#x7528;&#x4E86;<code>getChildMeasureSpec</code>&#x65B9;&#x6CD5;&#x6765;&#x5206;&#x522B;&#x83B7;&#x53D6;&#x5BBD;&#x9AD8;&#xFF0C;&#x6700;&#x540E;&#x518D;&#x8C03;&#x7528;&#x7684;&#x5C31;&#x662F;<code>View</code>&#x7684;<code>measure</code>&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x901A;&#x8FC7;&#x524D;&#x9762;&#x7684;&#x5206;&#x6790;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x5B83;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5BF9;&#x89C6;&#x56FE;&#x5927;&#x5C0F;&#x7684;&#x8BA1;&#x7B97;&#x3002;&#x800C;&#x5BF9;&#x4E8E;<code>measure</code>&#x4E2D;&#x7684;&#x53C2;&#x6570;&#x662F;&#x901A;&#x8FC7;<code>getChildMeasureSpec</code>&#x83B7;&#x53D6;&#xFF0C;&#x518D;&#x6765;&#x770B;&#x4E0B;&#x5176;&#x6E90;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static int getChildMeasureSpec(int spec, int padding, int childDimension) {</span><br><span class=\"line\">        int specMode = MeasureSpec.getMode(spec);</span><br><span class=\"line\">        int specSize = MeasureSpec.getSize(spec);</span><br><span class=\"line\"> </span><br><span class=\"line\">        int size = Math.max(0, specSize - padding);</span><br><span class=\"line\"> </span><br><span class=\"line\">        int resultSize = 0;</span><br><span class=\"line\">        int resultMode = 0;</span><br><span class=\"line\"> </span><br><span class=\"line\">        switch (specMode) {</span><br><span class=\"line\">        // Parent has imposed an exact size on us</span><br><span class=\"line\">        case MeasureSpec.EXACTLY:</span><br><span class=\"line\">            if (childDimension &gt;= 0) {</span><br><span class=\"line\">                resultSize = childDimension;</span><br><span class=\"line\">                resultMode = MeasureSpec.EXACTLY;</span><br><span class=\"line\">            } else if (childDimension == LayoutParams.MATCH_PARENT) {</span><br><span class=\"line\">                // Child wants to be our size. So be it.</span><br><span class=\"line\">                resultSize = size;</span><br><span class=\"line\">                resultMode = MeasureSpec.EXACTLY;</span><br><span class=\"line\">            } else if (childDimension == LayoutParams.WRAP_CONTENT) {</span><br><span class=\"line\">                // Child wants to determine its own size. It can&apos;t be</span><br><span class=\"line\">                // bigger than us.</span><br><span class=\"line\">                resultSize = size;</span><br><span class=\"line\">                resultMode = MeasureSpec.AT_MOST;</span><br><span class=\"line\">            }</span><br><span class=\"line\">            break;</span><br><span class=\"line\"> </span><br><span class=\"line\">        // Parent has imposed a maximum size on us</span><br><span class=\"line\">        case MeasureSpec.AT_MOST:</span><br><span class=\"line\">            if (childDimension &gt;= 0) {</span><br><span class=\"line\">                // Child wants a specific size... so be it</span><br><span class=\"line\">                resultSize = childDimension;</span><br><span class=\"line\">                resultMode = MeasureSpec.EXACTLY;</span><br><span class=\"line\">            } else if (childDimension == LayoutParams.MATCH_PARENT) {</span><br><span class=\"line\">                // Child wants to be our size, but our size is not fixed.</span><br><span class=\"line\">                // Constrain child to not be bigger than us.</span><br><span class=\"line\">                resultSize = size;</span><br><span class=\"line\">                resultMode = MeasureSpec.AT_MOST;</span><br><span class=\"line\">            } else if (childDimension == LayoutParams.WRAP_CONTENT) {</span><br><span class=\"line\">                // Child wants to determine its own size. It can&apos;t be</span><br><span class=\"line\">                // bigger than us.</span><br><span class=\"line\">                resultSize = size;</span><br><span class=\"line\">                resultMode = MeasureSpec.AT_MOST;</span><br><span class=\"line\">            }</span><br><span class=\"line\">            break;</span><br><span class=\"line\"> </span><br><span class=\"line\">        // Parent asked to see how big we want to be</span><br><span class=\"line\">        case MeasureSpec.UNSPECIFIED:</span><br><span class=\"line\">            if (childDimension &gt;= 0) {</span><br><span class=\"line\">                // Child wants a specific size... let him have it</span><br><span class=\"line\">                resultSize = childDimension;</span><br><span class=\"line\">                resultMode = MeasureSpec.EXACTLY;</span><br><span class=\"line\">            } else if (childDimension == LayoutParams.MATCH_PARENT) {</span><br><span class=\"line\">                // Child wants to be our size... find out how big it should</span><br><span class=\"line\">                // be</span><br><span class=\"line\">                resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;</span><br><span class=\"line\">                resultMode = MeasureSpec.UNSPECIFIED;</span><br><span class=\"line\">            } else if (childDimension == LayoutParams.WRAP_CONTENT) {</span><br><span class=\"line\">                // Child wants to determine its own size.... find out how</span><br><span class=\"line\">                // big it should be</span><br><span class=\"line\">                resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;</span><br><span class=\"line\">                resultMode = MeasureSpec.UNSPECIFIED;</span><br><span class=\"line\">            }</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        //noinspection ResourceType</span><br><span class=\"line\">        return MeasureSpec.makeMeasureSpec(resultSize, resultMode);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x662F;&#x4E0D;&#x662F;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x4E86;&#x70B9;&#x5462;&#x3002;&#x5B83;&#x505A;&#x7684;&#x5C31;&#x662F;&#x524D;&#x9762;&#x6240;&#x8BF4;&#x7684;&#x6839;&#x636E;<code>mode</code>&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x83B7;&#x53D6;&#x76F8;&#x5E94;&#x7684;<code>size</code>&#x3002;&#x6839;&#x636E;&#x7236;&#x89C6;&#x56FE;&#x7684;<code>mode</code>&#x7C7B;&#x578B;&#x4E0E;&#x5B50;&#x89C6;&#x56FE;&#x7684;<code>LayoutParams</code>&#x7C7B;&#x578B;&#x6765;&#x51B3;&#x5B9A;&#x5B50;&#x89C6;&#x56FE;&#x6240;&#x5C5E;&#x7684;<code>mode</code>,&#x6700;&#x540E;&#x518D;&#x5C06;&#x83B7;&#x53D6;&#x7684;<code>size</code>&#x4E0E;<code>mode</code>&#x901A;&#x8FC7;<code>MeasureSpec.makeMeasureSpec</code>&#x65B9;&#x6CD5;&#x6574;&#x5408;&#x8FD4;&#x56DE;&#x3002;&#x6700;&#x540E;&#x4F20;&#x9012;&#x5230;<code>measure</code>&#x4E2D;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x524D;&#x9762;&#x6240;&#x8BF4;&#x7684;<code>widthMeasureSpec</code>&#x4E0E;<code>heightMeasureSpec</code>&#x4E2D;&#x5305;&#x542B;&#x7684;&#x4E24;&#x90E8;&#x5206;&#x7684;&#x503C;&#x3002;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E3A;<code>measureChildren</code>-&gt;<code>measureChild</code>-&gt;<code>getChildMeasureSpec</code>-&gt;<code>measure</code>-&gt;<code>onMeasure</code>-&gt;<code>setMeasuredDimension</code>,&#x6240;&#x4EE5;&#x901A;&#x8FC7;<code>measureChildren</code>&#x5C31;&#x53EF;&#x4EE5;&#x5BF9;&#x5B50;&#x89C6;&#x56FE;&#x8FDB;&#x884C;&#x6D4B;&#x91CF;&#x8BA1;&#x7B97;&#x3002;</p>\n<h2 id=\"layout\"><a href=\"#layout\" class=\"headerlink\" title=\"layout\"></a>layout</h2><p><code>layout</code>&#x4E5F;&#x662F;&#x4E00;&#x6837;&#x7684;&#x5185;&#x90E8;&#x4F1A;&#x56DE;&#x8C03;<code>onLayout</code>&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x662F;&#x7528;&#x6765;&#x786E;&#x5B9A;&#x5B50;&#x89C6;&#x56FE;&#x7684;&#x7ED8;&#x5236;&#x4F4D;&#x7F6E;&#xFF0C;&#x4F46;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5728;<code>ViewGroup</code>&#x4E2D;&#x662F;&#x4E2A;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x8981;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<code>View</code>&#x662F;&#x7EE7;&#x627F;<code>ViewGroup</code>&#x7684;&#x8BDD;&#x5C31;&#x5FC5;&#x987B;&#x5B9E;&#x73B0;&#x8BE5;&#x65B9;&#x6CD5;&#x3002;&#x4F46;&#x5982;&#x679C;&#x662F;&#x7EE7;&#x627F;<code>View</code>&#x7684;&#x8BDD;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x4E86;&#xFF0C;<code>View</code>&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x7A7A;&#x5B9E;&#x73B0;&#x3002;&#x800C;&#x5BF9;&#x5B50;&#x89C6;&#x56FE;&#x4F4D;&#x7F6E;&#x7684;&#x8BBE;&#x7F6E;&#x662F;&#x901A;&#x8FC7;<code>View</code>&#x7684;<code>layout</code>&#x65B9;&#x6CD5;&#x901A;&#x8FC7;&#x4F20;&#x9012;&#x8BA1;&#x7B97;&#x51FA;&#x6765;&#x7684;<code>left</code>&#x3001;<code>top</code>&#x3001;<code>right</code>&#x4E0E;<code>bottom</code>&#x503C;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x503C;&#x4E00;&#x822C;&#x90FD;&#x8981;&#x501F;&#x52A9;<code>View</code>&#x7684;&#x5BBD;&#x9AD8;&#x6765;&#x8BA1;&#x7B97;,&#x89C6;&#x56FE;&#x7684;&#x5BBD;&#x9AD8;&#x5219;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>getMeasureWidth</code>&#x4E0E;<code>getMeasureHeight</code>&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x7684;&#x503C;&#x5C31;&#x662F;&#x4E0A;&#x9762;<code>onMeasure</code>&#x4E2D;<code>setMeasuredDimension</code>&#x4F20;&#x9012;&#x7684;&#x503C;&#xFF0C;&#x5373;&#x5B50;&#x89C6;&#x56FE;&#x6D4B;&#x91CF;&#x7684;&#x5BBD;&#x9AD8;&#x3002;</p>\n<blockquote>\n<p><code>getWidth</code>&#x3001;<code>getHeight</code>&#x4E0E;<code>getMeasureWidth</code>&#x3001;<code>getMeasureHeight</code>&#x662F;&#x4E0D;&#x540C;&#x7684;&#xFF0C;&#x524D;&#x8005;&#x662F;&#x5728;<code>onLayout</code>&#x4E4B;&#x540E;&#x624D;&#x80FD;&#x83B7;&#x53D6;&#x5230;&#x7684;&#x503C;&#xFF0C;&#x5206;&#x522B;&#x4E3A;<code>left</code>-<code>right</code>&#x4E0E;<code>top</code>-<code>bottom</code>&#xFF1B;&#x800C;&#x540E;&#x8005;&#x662F;&#x5728;<code>onMeasure</code>&#x4E4B;&#x540E;&#x624D;&#x80FD;&#x83B7;&#x53D6;&#x5230;&#x7684;&#x503C;&#x3002;&#x53EA;&#x4E0D;&#x8FC7;&#x8FD9;&#x4E24;&#x79CD;&#x83B7;&#x53D6;&#x7684;&#x503C;<code>&#x4E00;&#x822C;</code>&#x90FD;&#x662F;&#x76F8;&#x540C;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x6CE8;&#x610F;&#x8C03;&#x7528;&#x7684;<code>&#x65F6;&#x673A;</code>&#x3002;</p>\n</blockquote>\n<p>&#x4E0B;&#x9762;&#x4EE5;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x628A;&#x5B50;&#x89C6;&#x56FE;&#x653E;&#x7F6E;&#x4E8E;&#x7236;&#x89C6;&#x56FE;&#x7684;&#x56DB;&#x4E2A;&#x89D2;&#x7684;<code>View</code>&#x4E3A;&#x4F8B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    protected void onLayout(boolean changed, int l, int t, int r, int b) {</span><br><span class=\"line\">        int count = getChildCount();</span><br><span class=\"line\">        MarginLayoutParams params;</span><br><span class=\"line\">        </span><br><span class=\"line\">        int cl;</span><br><span class=\"line\">        int ct;</span><br><span class=\"line\">        int cr;</span><br><span class=\"line\">        int cb;</span><br><span class=\"line\">            </span><br><span class=\"line\">        for (int i = 0; i &lt; count; i++) {</span><br><span class=\"line\">            View child = getChildAt(i);</span><br><span class=\"line\">            params = (MarginLayoutParams) child.getLayoutParams();</span><br><span class=\"line\">                </span><br><span class=\"line\">            if (i == 0) {</span><br><span class=\"line\">                //&#x5DE6;&#x4E0A;&#x89D2;</span><br><span class=\"line\">                cl = params.leftMargin;</span><br><span class=\"line\">                ct = params.topMargin;</span><br><span class=\"line\">            } else if (i == 1) {</span><br><span class=\"line\">                //&#x53F3;&#x4E0A;&#x89D2;</span><br><span class=\"line\">                cl = getMeasuredWidth() - params.rightMargin - child.getMeasuredWidth();</span><br><span class=\"line\">                ct = params.topMargin;</span><br><span class=\"line\">            } else if (i == 2) {</span><br><span class=\"line\">                //&#x5DE6;&#x4E0B;&#x89D2;</span><br><span class=\"line\">                cl = params.leftMargin;</span><br><span class=\"line\">                ct = getMeasuredHeight() - params.bottomMargin - child.getMeasuredHeight()</span><br><span class=\"line\">                 - params.topMargin;</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                //&#x53F3;&#x4E0B;&#x89D2;</span><br><span class=\"line\">                cl = getMeasuredWidth() - params.rightMargin - child.getMeasuredWidth();</span><br><span class=\"line\">                ct = getMeasuredHeight() - params.bottomMargin - child.getMeasuredHeight()</span><br><span class=\"line\">                 - params.topMargin;</span><br><span class=\"line\">            }</span><br><span class=\"line\">            cr = cl + child.getMeasuredWidth();</span><br><span class=\"line\">            cb = ct + child.getMeasuredHeight();</span><br><span class=\"line\">            //&#x786E;&#x5B9A;&#x5B50;&#x89C6;&#x56FE;&#x5728;&#x7236;&#x89C6;&#x56FE;&#x4E2D;&#x653E;&#x7F6E;&#x7684;&#x4F4D;&#x7F6E;</span><br><span class=\"line\">            child.layout(cl, ct, cr, cb);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x81F3;&#x4E8E;<code>onMeasure</code>&#x7684;&#x5B9E;&#x73B0;&#x6E90;&#x7801;&#x6211;&#x540E;&#x9762;&#x4F1A;&#x7ED9;&#x94FE;&#x63A5;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x770B;&#x6548;&#x679C;&#x56FE;&#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x540E;&#x9762;&#x4E5F;&#x4F1A;&#x8D34;&#x51FA;&#x6765;&#xFF0C;&#x524D;&#x9762;&#x7684;&#x90A3;&#x4E2A;&#x9A8C;&#x8BC1;&#x7801;&#x7684;&#x4E5F;&#x662F;&#x4E00;&#x6837;</p>\n</blockquote>\n<h2 id=\"draw\"><a href=\"#draw\" class=\"headerlink\" title=\"draw\"></a>draw</h2><p><code>draw</code>&#x662F;&#x7531;<code>dispatchDraw</code>&#x53D1;&#x52A8;&#x7684;&#xFF0C;<code>dispatchDraw</code>&#x662F;<code>ViewGroup</code>&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5728;<code>View</code>&#x662F;&#x7A7A;&#x5B9E;&#x73B0;&#x3002;&#x81EA;&#x5B9A;&#x4E49;<code>View</code>&#x65F6;&#x4E0D;&#x9700;&#x8981;&#x53BB;&#x7BA1;&#x7406;&#x8BE5;&#x65B9;&#x6CD5;&#x3002;&#x800C;<code>draw</code>&#x65B9;&#x6CD5;&#x53EA;&#x5728;<code>View</code>&#x4E2D;&#x5B58;&#x5728;&#xFF0C;<code>ViewGoup</code>&#x505A;&#x7684;&#x53EA;&#x662F;&#x5728;<code>dispatchDraw</code>&#x4E2D;&#x8C03;&#x7528;<code>drawChild</code>&#x65B9;&#x6CD5;&#xFF0C;&#x800C;<code>drawChild</code>&#x4E2D;&#x8C03;&#x7528;&#x7684;&#x5C31;&#x662F;<code>View</code>&#x7684;<code>draw</code>&#x65B9;&#x6CD5;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;<code>draw</code>&#x7684;&#x6E90;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void draw(Canvas canvas) {</span><br><span class=\"line\">        final int privateFlags = mPrivateFlags;</span><br><span class=\"line\">        final boolean dirtyOpaque = (privateFlags &amp; PFLAG_DIRTY_MASK) == PFLAG_DIRTY_OPAQUE &amp;&amp;</span><br><span class=\"line\">                (mAttachInfo == null || !mAttachInfo.mIgnoreDirtyState);</span><br><span class=\"line\">        mPrivateFlags = (privateFlags &amp; ~PFLAG_DIRTY_MASK) | PFLAG_DRAWN;</span><br><span class=\"line\">         </span><br><span class=\"line\">        /*</span><br><span class=\"line\">         * Draw traversal performs several drawing steps which must be executed</span><br><span class=\"line\">         * in the appropriate order:</span><br><span class=\"line\">         *</span><br><span class=\"line\">         *      1. Draw the background</span><br><span class=\"line\">         *      2. If necessary, save the canvas&apos; layers to prepare for fading</span><br><span class=\"line\">         *      3. Draw view&apos;s content</span><br><span class=\"line\">         *      4. Draw children</span><br><span class=\"line\">         *      5. If necessary, draw the fading edges and restore layers</span><br><span class=\"line\">         *      6. Draw decorations (scrollbars for instance)</span><br><span class=\"line\">         */</span><br><span class=\"line\">          </span><br><span class=\"line\">        // Step 1, draw the background, if needed</span><br><span class=\"line\">        int saveCount;</span><br><span class=\"line\"> </span><br><span class=\"line\">        if (!dirtyOpaque) {</span><br><span class=\"line\">            drawBackground(canvas);</span><br><span class=\"line\">        }</span><br><span class=\"line\">         </span><br><span class=\"line\">        // skip step 2 &amp; 5 if possible (common case)</span><br><span class=\"line\">        final int viewFlags = mViewFlags;</span><br><span class=\"line\">        boolean horizontalEdges = (viewFlags &amp; FADING_EDGE_HORIZONTAL) != 0;</span><br><span class=\"line\">        boolean verticalEdges = (viewFlags &amp; FADING_EDGE_VERTICAL) != 0;</span><br><span class=\"line\">        if (!verticalEdges &amp;&amp; !horizontalEdges) {</span><br><span class=\"line\">            // Step 3, draw the content</span><br><span class=\"line\">            if (!dirtyOpaque) onDraw(canvas);</span><br><span class=\"line\">             </span><br><span class=\"line\">            // Step 4, draw the children</span><br><span class=\"line\">            dispatchDraw(canvas);</span><br><span class=\"line\">             </span><br><span class=\"line\">            // Overlay is part of the content and draws beneath Foreground</span><br><span class=\"line\">            if (mOverlay != null &amp;&amp; !mOverlay.isEmpty()) {</span><br><span class=\"line\">                            mOverlay.getOverlayView().dispatchDraw(canvas);</span><br><span class=\"line\">            }</span><br><span class=\"line\">                         </span><br><span class=\"line\">            // Step 6, draw decorations (foreground, scrollbars)</span><br><span class=\"line\">            onDrawForeground(canvas);</span><br><span class=\"line\">                       </span><br><span class=\"line\">            // we&apos;re done...</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        //&#x7701;&#x7565;2&amp;5&#x7684;&#x60C5;&#x51B5;</span><br><span class=\"line\">        ....</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6E90;&#x7801;&#x5DF2;&#x7ECF;&#x975E;&#x5E38;&#x6E05;&#x6670;&#x4E86;<code>draw</code>&#x603B;&#x5171;&#x5206;&#x4E3A;6&#x6B65;&#xFF1B;</p>\n<ul>\n<li>&#x7ED8;&#x5236;&#x80CC;&#x666F;</li>\n<li>&#x5982;&#x679C;&#x9700;&#x8981;&#x7684;&#x8BDD;&#xFF0C;&#x4FDD;&#x5B58;<code>layers</code></li>\n<li>&#x7ED8;&#x5236;&#x81EA;&#x8EAB;&#x6587;&#x672C;</li>\n<li>&#x7ED8;&#x5236;&#x5B50;&#x89C6;&#x56FE;</li>\n<li>&#x5982;&#x679C;&#x9700;&#x8981;&#x7684;&#x8BDD;&#xFF0C;&#x7ED8;&#x5236;<code>fading edges</code></li>\n<li>&#x7ED8;&#x5236;<code>scrollbars</code></li>\n</ul>\n<p>&#x5176;&#x4E2D;    &#x7B2C;<code>2</code>&#x6B65;&#x4E0E;&#x7B2C;<code>5</code>&#x6B65;&#x4E0D;&#x662F;&#x5FC5;&#x987B;&#x7684;&#x3002;&#x5728;&#x7B2C;<code>3</code>&#x6B65;&#x8C03;&#x7528;&#x4E86;<code>onDraw</code>&#x65B9;&#x6CD5;&#x6765;&#x7ED8;&#x5236;&#x81EA;&#x8EAB;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5728;<code>View</code>&#x4E2D;&#x662F;&#x7A7A;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4E3A;&#x4EC0;&#x4E48;&#x5728;&#x81EA;&#x5B9A;&#x4E49;<code>View</code>&#x65F6;&#x5FC5;&#x987B;&#x8981;&#x91CD;&#x5199;&#x8BE5;&#x65B9;&#x6CD5;&#x3002;&#x800C;&#x7B2C;<code>4</code>&#x6B65;&#x8C03;&#x7528;&#x4E86;<code>dispatchDraw</code>&#x5BF9;&#x5B50;&#x89C6;&#x56FE;&#x8FDB;&#x884C;&#x7ED8;&#x5236;&#x3002;&#x8FD8;&#x662F;&#x4EE5;<code>&#x9A8C;&#x8BC1;&#x7801;</code>&#x4E3A;&#x4F8B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    protected void onDraw(Canvas canvas) {</span><br><span class=\"line\">        //&#x7ED8;&#x5236;&#x80CC;&#x666F;</span><br><span class=\"line\">        mPaint.setColor(getResources().getColor(R.color.autoCodeBg));</span><br><span class=\"line\">        canvas.drawRect(0, 0, getMeasuredWidth(), getMeasuredHeight(), mPaint);</span><br><span class=\"line\"></span><br><span class=\"line\">        mPaint.getTextBounds(autoText, 0, autoText.length(), bounds);</span><br><span class=\"line\">        //&#x7ED8;&#x5236;&#x6587;&#x672C;</span><br><span class=\"line\">        for (int i = 0; i &lt; autoText.length(); i++) {</span><br><span class=\"line\">             mPaint.setColor(getResources().getColor(colorRes[random.nextInt(6)]));</span><br><span class=\"line\">            canvas.drawText(autoText, i, i + 1, getWidth() / 2 - bounds.width() / 2 + i * bounds.width() / autoNum</span><br><span class=\"line\">                    , bounds.height() + random.nextInt(getHeight() - bounds.height())</span><br><span class=\"line\">                    , mPaint);</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        //&#x7ED8;&#x5236;&#x5E72;&#x6270;&#x70B9;</span><br><span class=\"line\">        for (int j = 0; j &lt; 250; j++) {</span><br><span class=\"line\">             canvas.drawPoint(random.nextInt(getWidth()), random.nextInt(getHeight()), pointPaint);</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        //&#x7ED8;&#x5236;&#x5E72;&#x6270;&#x7EBF;</span><br><span class=\"line\">        for (int k = 0; k &lt; 20; k++) {</span><br><span class=\"line\">            int startX = random.nextInt(getWidth());</span><br><span class=\"line\">            int startY = random.nextInt(getHeight());</span><br><span class=\"line\">            int stopX = startX + random.nextInt(getWidth() - startX);</span><br><span class=\"line\">            int stopY = startY + random.nextInt(getHeight() - startY);</span><br><span class=\"line\">             linePaint.setColor(getResources().getColor(colorRes[random.nextInt(6)]));</span><br><span class=\"line\">            canvas.drawLine(startX, startY, stopX, stopY, linePaint);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>&#x5176;&#x5B9E;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x4E00;&#x4E9B;&#x7ED8;&#x5236;&#x7684;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x3002;&#x597D;&#x4E86;&#x57FA;&#x672C;&#x5C31;&#x5230;&#x8FD9;&#x91CC;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x4E0A;&#x4F20;&#x4E00;&#x5F20;&#x793A;&#x4F8B;&#x7684;&#x6548;&#x679C;&#x56FE;&#xFF0C;&#x4E0E;&#x6E90;&#x7801;&#x94FE;&#x63A5;</p>\n</blockquote>\n<h1 id=\"&#x793A;&#x4F8B;&#x56FE;\"><a href=\"#&#x793A;&#x4F8B;&#x56FE;\" class=\"headerlink\" title=\"&#x793A;&#x4F8B;&#x56FE;\"></a>&#x793A;&#x4F8B;&#x56FE;</h1><p><img src=\"/2016/11/13/Android-&#x81EA;&#x5B9A;&#x4E49;View/custom.gif\" alt=\"&#x793A;&#x4F8B;&#x56FE;\"></p>\n<blockquote>\n<p>&#x5BF9;&#x4E86;&#x8FD8;&#x6709;&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;&#xFF0C;&#x8FD9;&#x91CC;&#x7B80;&#x5355;&#x8BF4;&#x4E00;&#x4E0B;&#x3002;&#x81EA;&#x5B9A;&#x4E49;<code>View</code>&#x65F6;&#x4E00;&#x822C;&#x90FD;&#x8981;&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#x90FD;&#x4F1A;&#x5728;<code>res/values/attr.xml</code>&#x4E2D;&#x5B9A;&#x4E49;<code>attr</code>&#x4E0E;<code>declare-styleable</code>,&#x6700;&#x540E;&#x5728;&#x81EA;&#x5B9A;&#x4E49;<code>View</code>&#x4E2D;&#x901A;&#x8FC7;<code>TypedArray</code>&#x83B7;&#x53D6;&#x3002;</p>\n</blockquote>\n<p>&#x793A;&#x4F8B;&#x6E90;&#x7801;&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/idisfkj/CustomViewOrViewGroup\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/CustomViewOrViewGroup</a></p>\n","categories":["android"],"tags":["源码分析"]},{"title":"Handler、Looper与MessageQueue源码分析","url":"https://www.rousetime.com/2016/10/19/Android-Handler、Looper与MessageQueue源码分析/","content":"<p>&#x5728;<code>Android</code>&#x4E2D;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>Handler</code>&#x6765;&#x66F4;&#x65B0;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;<code>UI</code>&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x66F4;&#x65B0;<code>UI</code>&#x53EA;&#x80FD;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x8FDB;&#x884C;&#x66F4;&#x65B0;&#xFF0C;&#x800C;&#x4E3A;&#x4E86;&#x8BA9;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x4E5F;&#x80FD;&#x63A7;&#x5236;<code>UI</code>&#x7684;&#x53D8;&#x5316;&#xFF0C;<code>Android</code>&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x673A;&#x5236;<code>Handler</code>&#x3001;<code>Looper</code>&#x4E0E;<code>MessageQueue</code>&#x4E00;&#x540C;&#x534F;&#x4F5C;&#x6765;&#x8FBE;&#x5230;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x66F4;&#x65B0;<code>UI</code>&#x7684;&#x76EE;&#x7684;&#x3002;</p>\n<p>&#x4E00;&#x822C;&#x6211;&#x4EEC;&#x4F1A;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;<code>Handler</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private Handler mHandler = new Handler() {</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void handleMessage(Message msg) {</span><br><span class=\"line\">            tv.setText(&quot;mHandler change UI&quot;);</span><br><span class=\"line\">            super.handleMessage(msg);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    };</span><br></pre></td></tr></table></figure>\n<p>&#x4E00;&#x822C;&#x90FD;&#x89C1;&#x4E0D;&#x5230;<code>Looper</code>&#x4E0E;<code>MessageQueue</code>&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x4EEC;&#x90FD;&#x662F;&#x5728;&#x54EA;&#x91CC;&#x8C03;&#x7528;&#x4E0E;&#x5982;&#x4F55;&#x534F;&#x4F5C;&#x7684;&#x5462;&#xFF1F;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E0D;&#x4F1A;&#x663E;&#x5F0F;&#x7684;&#x8C03;&#x7528;<code>Looper</code>&#x800C;&#x662F;&#x4F1A;&#x5728;<code>ActivityThread.main</code>&#x65B9;&#x6CD5;&#x4E2D;&#x9ED8;&#x8BA4;&#x8C03;&#x7528;&#x3002;</p>\n<h1 id=\"ActivityThread-main\"><a href=\"#ActivityThread-main\" class=\"headerlink\" title=\"ActivityThread.main\"></a>ActivityThread.main</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void main(String[] args) {</span><br><span class=\"line\">         Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, &quot;ActivityThreadMain&quot;);</span><br><span class=\"line\">        SamplingProfilerIntegration.start();</span><br><span class=\"line\"> </span><br><span class=\"line\">        // CloseGuard defaults to true and can be quite spammy.  We</span><br><span class=\"line\">        // disable it here, but selectively enable it later (via</span><br><span class=\"line\">        // StrictMode) on debug builds, but using DropBox, not logs.</span><br><span class=\"line\">        CloseGuard.setEnabled(false);</span><br><span class=\"line\"> </span><br><span class=\"line\">        Environment.initForCurrentUser();</span><br><span class=\"line\"> </span><br><span class=\"line\">        // Set the reporter for event logging in libcore</span><br><span class=\"line\">        EventLogger.setReporter(new EventLoggingReporter());</span><br><span class=\"line\"> </span><br><span class=\"line\">        // Make sure TrustedCertificateStore looks in the right place for CA certificates</span><br><span class=\"line\">        final File configDir = Environment.getUserConfigDirectory(UserHandle.myUserId());</span><br><span class=\"line\">         TrustedCertificateStore.setDefaultUserDirectory(configDir);</span><br><span class=\"line\"> </span><br><span class=\"line\">        Process.setArgV0(&quot;&lt;pre-initialized&gt;&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        Looper.prepareMainLooper();//&#x521B;&#x5EFA;Looper</span><br><span class=\"line\"> </span><br><span class=\"line\">        ActivityThread thread = new ActivityThread();</span><br><span class=\"line\">        thread.attach(false);</span><br><span class=\"line\"> </span><br><span class=\"line\">        if (sMainThreadHandler == null) {</span><br><span class=\"line\">            sMainThreadHandler = thread.getHandler();</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        if (false) {</span><br><span class=\"line\">            Looper.myLooper().setMessageLogging(new</span><br><span class=\"line\">                    LogPrinter(Log.DEBUG, &quot;ActivityThread&quot;));</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        // End of event ActivityThreadMain.</span><br><span class=\"line\">         Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</span><br><span class=\"line\">        Looper.loop();//&#x5F00;&#x542F;Looper&#x5FAA;&#x73AF;</span><br><span class=\"line\"> </span><br><span class=\"line\">        throw new RuntimeException(&quot;Main thread loop unexpectedly exited&quot;);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x4E0A;&#x4EE3;&#x7801;&#xFF0C;&#x8C03;&#x7528;&#x4E86;<code>Looper.prepareMainLooper()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;<code>Looper</code>&#xFF0C;&#x4E0D;&#x4FE1;&#x7684;&#x8BDD;&#x6211;&#x4EEC;&#x518D;&#x67E5;&#x770B;&#x8BE5;&#x65B9;&#x6CD5;&#x505A;&#x4E86;&#x4EC0;&#x4E48;</p>\n<h1 id=\"Looper\"><a href=\"#Looper\" class=\"headerlink\" title=\"Looper\"></a>Looper</h1><h2 id=\"prepare\"><a href=\"#prepare\" class=\"headerlink\" title=\"prepare\"></a>prepare</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void prepare() {</span><br><span class=\"line\">        prepare(true);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    private static void prepare(boolean quitAllowed) {</span><br><span class=\"line\">        if (sThreadLocal.get() != null) {</span><br><span class=\"line\">            throw new RuntimeException(&quot;Only one Looper may be created per thread&quot;);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        sThreadLocal.set(new Looper(quitAllowed));//&#x521B;&#x5EFA;Looper&#x5E76;&#x8D4B;&#x7ED9;sThreadLocal</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Initialize the current thread as a looper, marking it as an</span><br><span class=\"line\">     * application&apos;s main looper. The main looper for your application</span><br><span class=\"line\">     * is created by the Android environment, so you should never need</span><br><span class=\"line\">     * to call this function yourself.  See also: {@link #prepare()}</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public static void prepareMainLooper() {</span><br><span class=\"line\">        prepare(false);</span><br><span class=\"line\">        synchronized (Looper.class) {</span><br><span class=\"line\">            if (sMainLooper != null) {</span><br><span class=\"line\">                throw new IllegalStateException(&quot;The main Looper has already been prepared.&quot;);</span><br><span class=\"line\">            }</span><br><span class=\"line\">            sMainLooper = myLooper();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">     </span><br><span class=\"line\">    public static @Nullable Looper myLooper() {</span><br><span class=\"line\">        return sThreadLocal.get();</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5728;<code>prepareMainLooper</code>&#x65B9;&#x6CD5;&#x4E2D;&#x8C03;&#x7528;&#x4E86;<code>prepare</code>&#x800C;&#x901A;&#x8FC7;<code>prepare</code>&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;<code>Looper</code>&#xFF0C;&#x5E76;&#x628A;&#x5B83;&#x8D4B;&#x7ED9;&#x4E86;<code>sThreadLocal</code>&#x3002;&#x540C;&#x65F6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>myLooper</code>&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E2D;&#x7684;<code>Looper</code>&#x3002;&#x518D;&#x6765;&#x770B;&#x4E0B;<code>new Looper(quitAllowed)</code>&#x521D;&#x59CB;&#x5316;&#x4E86;&#x4EC0;&#x4E48;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private Looper(boolean quitAllowed) {</span><br><span class=\"line\">        mQueue = new MessageQueue(quitAllowed);</span><br><span class=\"line\">        mThread = Thread.currentThread();</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x7EC8;&#x4E8E;&#x770B;&#x5230;&#x4E86;<code>MessageQueue</code>&#x4E86;&#xFF0C;&#x5B83;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;<code>MessageQueue</code>&#x3002;&#x8BE5;&#x6D88;&#x606F;&#x961F;&#x5217;&#x5C31;&#x662F;&#x7528;&#x6765;&#x4FDD;&#x5B58;&#x540E;&#x7EED;&#x7684;<code>Message</code>&#x3002;&#x518D;&#x56DE;&#x5230;<code>ActivityThread.main</code>&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x53D1;&#x73B0;&#x5B83;&#x8C03;&#x7528;&#x4E86;<code>Looper.loop()</code>&#x662F;&#x7528;&#x6765;&#x5F00;&#x542F;<code>Looper</code>&#x5FAA;&#x73AF;&#x7684;&#xFF0C;&#x76D1;&#x542C;&#x6D88;&#x606F;&#x961F;&#x5217;<code>MessageQueue</code>&#x4E2D;&#x7684;&#x6D88;&#x606F;&#x3002;</p>\n<h2 id=\"loop\"><a href=\"#loop\" class=\"headerlink\" title=\"loop\"></a>loop</h2><p>&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;<code>Looper.loop()</code>&#x7684;&#x6E90;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void loop() {</span><br><span class=\"line\">        final Looper me = myLooper();//&#x83B7;&#x53D6;Looper</span><br><span class=\"line\">        if (me == null) {</span><br><span class=\"line\">            throw new RuntimeException(&quot;No Looper; Looper.prepare() wasn&apos;t called on this thread.&quot;);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        final MessageQueue queue = me.mQueue;//&#x83B7;&#x53D6;&#x6D88;&#x606F;&#x961F;&#x5217;</span><br><span class=\"line\"> </span><br><span class=\"line\">        // Make sure the identity of this thread is that of the local process,</span><br><span class=\"line\">        // and keep track of what that identity token actually is.</span><br><span class=\"line\">        Binder.clearCallingIdentity();</span><br><span class=\"line\">        final long ident = Binder.clearCallingIdentity();</span><br><span class=\"line\"> </span><br><span class=\"line\">        for (;;) {        </span><br><span class=\"line\">            Message msg = queue.next(); // might block</span><br><span class=\"line\">            if (msg == null) {</span><br><span class=\"line\">                // No message indicates that the message queue is quitting.</span><br><span class=\"line\">                return;</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            // This must be in a local variable, in case a UI event sets the logger</span><br><span class=\"line\">            final Printer logging = me.mLogging;</span><br><span class=\"line\">            if (logging != null) {</span><br><span class=\"line\">                logging.println(&quot;&gt;&gt;&gt;&gt;&gt; Dispatching to &quot; + msg.target + &quot; &quot; +</span><br><span class=\"line\">                        msg.callback + &quot;: &quot; + msg.what);</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            final long traceTag = me.mTraceTag;</span><br><span class=\"line\">            if (traceTag != 0) {</span><br><span class=\"line\">                Trace.traceBegin(traceTag, msg.target.getTraceName(msg));</span><br><span class=\"line\">            }</span><br><span class=\"line\">            try {</span><br><span class=\"line\">                msg.target.dispatchMessage(msg);//&#x901A;&#x8FC7;Handler&#x5206;&#x53D1;&#x6D88;&#x606F;</span><br><span class=\"line\">            } finally {</span><br><span class=\"line\">                if (traceTag != 0) {</span><br><span class=\"line\">                    Trace.traceEnd(traceTag);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            if (logging != null) {</span><br><span class=\"line\">                logging.println(&quot;&lt;&lt;&lt;&lt;&lt; Finished to &quot; + msg.target + &quot; &quot; + msg.callback);</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            // Make sure that during the course of dispatching the</span><br><span class=\"line\">            // identity of the thread wasn&apos;t corrupted.</span><br><span class=\"line\">            final long newIdent = Binder.clearCallingIdentity();</span><br><span class=\"line\">            if (ident != newIdent) {</span><br><span class=\"line\">                Log.wtf(TAG, &quot;Thread identity changed from 0x&quot;</span><br><span class=\"line\">                        + Long.toHexString(ident) + &quot; to 0x&quot;</span><br><span class=\"line\">                        + Long.toHexString(newIdent) + &quot; while dispatching to &quot;</span><br><span class=\"line\">                        + msg.target.getClass().getName() + &quot; &quot;</span><br><span class=\"line\">                        + msg.callback + &quot; what=&quot; + msg.what);</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            msg.recycleUnchecked();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5728;<code>loop</code>&#x4E2D;&#x9996;&#x5148;&#x83B7;&#x53D6;&#x4E86;&#x5F53;&#x524D;&#x6240;&#x5728;&#x7EBF;&#x7A0B;&#x7684;<code>Looper</code>&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x83B7;&#x53D6;&#x5230;&#x4E86;<code>Looper</code>&#x4E2D;&#x7684;<code>MessageQueue</code>&#xFF0C;&#x8BF4;&#x660E;<code>Looper</code>&#x5DF2;&#x7ECF;&#x4E0E;&#x5F53;&#x524D;&#x7684;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x4E86;&#x7ED1;&#x5B9A;&#x3002;&#x5728;&#x540E;&#x9762;&#x5F00;&#x542F;&#x4E86;&#x4E00;&#x4E2A;<code>for</code>&#x7684;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;&#x53D1;&#x73B0;&#x5B83;&#x505A;&#x7684;&#x4E8B;&#x4EF6;&#x662F;&#x4E0D;&#x65AD;&#x7684;&#x4ECE;&#x6D88;&#x606F;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x51FA;&#x6D88;&#x606F;&#xFF0C;&#x6700;&#x540E;&#x90FD;&#x4EA4;&#x7ED9;<code>msg.target</code>&#x8C03;&#x7528;&#x5B83;&#x7684;<code>dispatchMessage</code>&#x65B9;&#x6CD5;&#xFF0C;&#x90A3;&#x4E48;<code>target</code>&#x53C8;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x8FDB;&#x5165;<code>Message</code></p>\n<h1 id=\"Message\"><a href=\"#Message\" class=\"headerlink\" title=\"Message\"></a>Message</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/*package*/ int flags;</span><br><span class=\"line\"></span><br><span class=\"line\">    /*package*/ long when;</span><br><span class=\"line\">    </span><br><span class=\"line\">    /*package*/ Bundle data;</span><br><span class=\"line\">    </span><br><span class=\"line\">    /*package*/ Handler target;</span><br><span class=\"line\">    </span><br><span class=\"line\">    /*package*/ Runnable callback;</span><br><span class=\"line\">    </span><br><span class=\"line\">    // sometimes we store linked lists of these things</span><br><span class=\"line\">    /*package*/ Message next;</span><br></pre></td></tr></table></figure>\n<p>&#x53D1;&#x73B0;&#x5B83;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x719F;&#x6089;&#x7684;<code>Handler</code>&#xFF0C;&#x8BF4;&#x660E;&#x6700;&#x540E;&#x8C03;&#x7528;&#x7684;&#x5C31;&#x662F;<code>Handler</code>&#x4E2D;&#x7684;<code>dispatchMessage</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5BF9;&#x6D88;&#x606F;&#x7684;&#x5206;&#x53D1;&#x5904;&#x7406;&#x3002;&#x8FD9;&#x6837;&#x4E00;&#x6765;<code>Handler</code>&#x5C31;&#x901A;&#x8FC7;<code>Looper</code>&#x8054;&#x7CFB;&#x4E0A;&#x4E86;<code>Looper</code>&#x6240;&#x7ED1;&#x5B9A;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x5373;&#x4E3A;&#x4E3B;&#x7EBF;&#x7A0B;&#x3002;</p>\n<h1 id=\"Handler\"><a href=\"#Handler\" class=\"headerlink\" title=\"Handler\"></a>Handler</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public Handler(Callback callback, boolean async) {</span><br><span class=\"line\">        if (FIND_POTENTIAL_LEAKS) {</span><br><span class=\"line\">            final Class&lt;? extends Handler&gt; klass = getClass();</span><br><span class=\"line\">            if ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp;</span><br><span class=\"line\">                    (klass.getModifiers() &amp; Modifier.STATIC) == 0) {</span><br><span class=\"line\">                Log.w(TAG, &quot;The following Handler class should be static or leaks might occur: &quot; +</span><br><span class=\"line\">                    klass.getCanonicalName());</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        mLooper = Looper.myLooper();</span><br><span class=\"line\">        if (mLooper == null) {</span><br><span class=\"line\">            throw new RuntimeException(</span><br><span class=\"line\">                &quot;Can&apos;t create handler inside thread that has not called Looper.prepare()&quot;);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        mQueue = mLooper.mQueue;</span><br><span class=\"line\">        mCallback = callback;</span><br><span class=\"line\">        mAsynchronous = async;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;<code>Handler</code>&#x7684;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x5B83;&#x83B7;&#x53D6;&#x4E86;&#x5B83;&#x6240;&#x5904;&#x7EBF;&#x7A0B;&#x7684;<code>Looper</code>&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x83B7;&#x53D6;&#x4E86;<code>Looper</code>&#x4E2D;&#x7684;&#x6D88;&#x606F;&#x961F;&#x5217;&#x3002;&#x5F53;&#x7136;&#x5982;&#x679C;&#x6240;&#x5904;&#x7EBF;&#x7A0B;&#x7684;<code>Looper</code>&#x4E3A;&#x7A7A;&#x7684;&#x8BDD;&#x5C31;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x8FD9;&#x5C31;&#x89E3;&#x91CA;&#x4E86;&#x4E3A;&#x4EC0;&#x4E48;&#x5728;&#x975E;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x521B;&#x5EFA;<code>Handler</code>&#x8981;&#x5206;&#x522B;&#x8C03;&#x7528;<code>Looper.prepare</code>&#x4E0E;<code>Looper.loop</code>&#x800C;&#x4E3B;&#x7EBF;&#x7A0B;&#x5219;&#x4E0D;&#x9700;&#x8981;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x9ED8;&#x8BA4;&#x5DF2;&#x7ECF;&#x8C03;&#x7528;&#x4E86;&#x3002;</p>\n<h2 id=\"dispatchMessage\"><a href=\"#dispatchMessage\" class=\"headerlink\" title=\"dispatchMessage\"></a>dispatchMessage</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void dispatchMessage(Message msg) {</span><br><span class=\"line\">        if (msg.callback != null) {</span><br><span class=\"line\">            handleCallback(msg);</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            if (mCallback != null) {</span><br><span class=\"line\">                if (mCallback.handleMessage(msg)) {</span><br><span class=\"line\">                    return;</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">            handleMessage(msg);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">private static void handleCallback(Message message) {</span><br><span class=\"line\">        message.callback.run();</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x56DE;&#x5230;&#x524D;&#x9762;&#xFF0C;&#x5BF9;&#x4E8E;<code>dispatchMessage</code>&#x7684;&#x5904;&#x7406;&#xFF0C;&#x9996;&#x5148;&#x5224;&#x65AD;<code>msg.callback</code>&#x662F;&#x5426;&#x4E3A;&#x7A7A;&#xFF0C;&#x8FD9;&#x91CC;<code>callback</code>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;<code>Message</code>&#x5E94;&#x8BE5;&#x80FD;&#x77E5;&#x9053;&#x4ED6;&#x5C31;&#x662F;&#x4E00;&#x4E2A;<code>Runnable</code>&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x4E3A;&#x7A7A;&#x5219;&#x76F4;&#x63A5;&#x8C03;&#x7528;<code>Runnable</code>&#x7684;<code>run</code>&#x65B9;&#x6CD5;&#x3002;&#x5426;&#x5219;&#x8C03;&#x7528;<code>Handler</code>&#x7684;<code>handleMessage</code>&#x65B9;&#x6CD5;.&#x800C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x76F8;&#x4FE1;&#x5927;&#x5BB6;&#x5DF2;&#x7ECF;&#x5F88;&#x719F;&#x6089;&#x4E86;&#xFF0C;&#x5BF9;&#x4E8B;&#x4EF6;&#x7684;&#x5904;&#x7406;&#x90FD;&#x662F;&#x5728;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#x6267;&#x884C;&#x7684;&#x3002;&#x56E0;&#x4E3A;&#x901A;&#x8FC7;&#x524D;&#x9762;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x4E86;<code>Handler</code>&#x5DF2;&#x7ECF;&#x8054;&#x7CFB;&#x4E0A;&#x4E86;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF0C;&#x6240;&#x4EE5;<code>handleMessage</code>&#x4E2D;&#x7684;&#x5904;&#x7406;&#x81EA;&#x7136;&#x76F8;&#x5BF9;&#x4E8E;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x8FDB;&#x884C;&#xFF0C;&#x81EA;&#x7136;&#x4E5F;&#x80FD;&#x66F4;&#x65B0;<code>UI</code>&#x4E86;&#x3002;&#x901A;&#x8FC7;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x80FD;&#x628A;<code>Looper</code>&#x6BD4;&#x4F5C;&#x662F;&#x4E00;&#x4E2A;&#x6865;&#x6881;&#xFF0C;&#x6765;&#x8FDE;&#x63A5;<code>Looper</code>&#x6240;&#x5728;&#x7684;&#x7EBF;&#x7A0B;&#x4E0E;<code>Handler</code>&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#xFF0C;&#x540C;&#x65F6;&#x7BA1;&#x7406;&#x6D88;&#x606F;&#x961F;&#x5217;<code>MessageQueue</code>&#x4E2D;&#x7684;&#x6D88;&#x606F;&#x3002;&#x90A3;&#x4E48;&#x524D;&#x9762;&#x7684;<code>Runnable</code>&#x53C8;&#x662F;&#x5982;&#x4F55;&#x4E0D;&#x4E3A;&#x7A7A;&#x7684;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<code>Handler</code>&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x76F4;&#x63A5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>Handler</code>&#x5E76;&#x4E14;&#x91CD;&#x5199;&#x5B83;&#x7684;<code>handleMessage</code>&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x53E6;&#x4E00;&#x79CD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>Handler.post(Runnable)</code>&#x6765;&#x4F7F;&#x7528;&#xFF0C;&#x8FD9;&#x6837;&#x4E8B;&#x4EF6;&#x7684;&#x5904;&#x7406;&#x81EA;&#x7136;&#x5C31;&#x5728;<code>run</code>&#x65B9;&#x6CD5;&#x4E2D;&#x5B9E;&#x73B0;&#x3002;</p>\n<p>&#x4E0A;&#x9762;&#x4ECB;&#x7ECD;&#x4E86;<code>Handler</code>&#x662F;&#x5982;&#x4F55;&#x8054;&#x7CFB;&#x4E0A;&#x4E86;&#x9700;&#x8981;&#x64CD;&#x4F5C;&#x7684;&#x7EBF;&#x7A0B;&#x4E0E;&#x5BF9;&#x6D88;&#x606F;&#x662F;&#x5982;&#x4F55;&#x53D6;&#x51FA;&#x4E0E;&#x5904;&#x7406;&#x7684;&#x3002;&#x4E0B;&#x9762;&#x6765;&#x8C08;&#x8C08;&#x6D88;&#x606F;&#x662F;&#x5982;&#x4F55;&#x653E;&#x5165;&#x5230;<code>Looper</code>&#x4E2D;&#x7684;<code>MessageQueue</code>&#x4E2D;&#x7684;&#x3002;</p>\n<h2 id=\"sendMessageAtTime\"><a href=\"#sendMessageAtTime\" class=\"headerlink\" title=\"sendMessageAtTime\"></a>sendMessageAtTime</h2><p>&#x901A;&#x8FC7;<code>Handler</code>&#x53D1;&#x9001;&#x6D88;&#x606F;&#x7684;&#x65B9;&#x5F0F;&#x5F88;&#x591A;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;<code>sendMessage</code>&#x3001;<code>sendEmptyMessage</code>&#x4E0E;<code>sendMessageDelayed</code>&#x7B49;&#xFF0C;&#x5176;&#x5B9E;&#x5230;&#x6700;&#x540E;&#x4ED6;&#x4EEC;&#x8C03;&#x7528;&#x7684;&#x90FD;&#x662F;<code>sendMessageAtTime</code>&#x65B9;&#x6CD5;&#x3002;&#x6240;&#x4EE5;&#x8FD8;&#x662F;&#x6765;&#x770B;&#x4E0B;<code>sendMessageAtTime</code>&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public boolean sendMessageAtTime(Message msg, long uptimeMillis) {</span><br><span class=\"line\">        MessageQueue queue = mQueue;</span><br><span class=\"line\">        if (queue == null) {</span><br><span class=\"line\">            RuntimeException e = new RuntimeException(</span><br><span class=\"line\">                    this + &quot; sendMessageAtTime() called with no mQueue&quot;);</span><br><span class=\"line\">            Log.w(&quot;Looper&quot;, e.getMessage(), e);</span><br><span class=\"line\">            return false;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        return enqueueMessage(queue, msg, uptimeMillis);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x800C;<code>sendMessageAtTime</code>&#x5219;&#x5C31;&#x662F;&#x8C03;&#x7528;&#x4E86;<code>enqueueMessage</code>&#x64CD;&#x4F5C;&#xFF0C;&#x770B;&#x8FD9;&#x65B9;&#x6CD5;&#x540D;&#x5C31;&#x77E5;&#x9053;&#x662F;&#x5165;&#x961F;&#x5217;&#x64CD;&#x4F5C;&#x4E86;&#x3002;</p>\n<h2 id=\"enqueueMessage\"><a href=\"#enqueueMessage\" class=\"headerlink\" title=\"enqueueMessage\"></a>enqueueMessage</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) {</span><br><span class=\"line\">        msg.target = this;</span><br><span class=\"line\">        if (mAsynchronous) {</span><br><span class=\"line\">            msg.setAsynchronous(true);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        return queue.enqueueMessage(msg, uptimeMillis);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x679C;&#x4E0D;&#x5176;&#x7136;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x4E86;<code>MessageQueue</code>&#x4E2D;&#x7684;<code>queue.enqueueMessage(msg, uptimeMillis)</code>&#x5C06;&#x6D88;&#x606F;&#x52A0;&#x5165;&#x6D88;&#x606F;&#x961F;&#x5217;&#xFF0C;&#x540C;&#x65F6;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;<code>msg.target = this</code> &#x5C06;&#x5F53;&#x524D;&#x7684;<code>Handler</code>&#x8D4B;&#x7ED9;&#x4E86;<code>msg.target</code>,&#x8FD9;&#x5C31;&#x662F;&#x524D;&#x9762;&#x6240;&#x8BF4;&#x7684;<code>Looper.loop</code>&#x65B9;&#x6CD5;&#x4E2D;&#x8C03;&#x7528;&#x7684;<code>Handler</code>&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x628A;&#x6D88;&#x606F;&#x653E;&#x5230;&#x4E86;<code>MessageQueue</code>&#x4E2D;&#xFF0C;&#x8FDB;&#x800C;&#x901A;&#x8FC7;&#x524D;&#x9762;&#x6240;&#x8BB2;&#x7684;<code>loop</code>&#x6765;&#x53D6;&#x51FA;&#x6D88;&#x606F;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x6784;&#x6210;&#x4E86;&#x6574;&#x4E2A;&#x5BF9;&#x6D88;&#x606F;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x7684;&#x7CFB;&#x7EDF;&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x4F7F;&#x7528;<code>Handler</code>&#x5185;&#x90E8;&#x6240;&#x53D1;&#x751F;&#x7684;&#x539F;&#x7406;&#x3002;&#x597D;&#x4E86;<code>Handler</code>&#x3001;<code>Looper</code>&#x4E0E;<code>MessageQueue</code>&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x8054;&#x7CFB;&#x57FA;&#x672C;&#x5C31;&#x662F;&#x8FD9;&#x4E9B;&#x4E86;&#x3002;&#x6211;&#x4E5F;&#x7B80;&#x5355;&#x753B;&#x4E86;&#x5F20;&#x56FE;&#x5E0C;&#x671B;&#x6709;&#x6240;&#x5E2E;&#x52A9;</p>\n<p><img src=\"/2016/10/19/Android-Handler&#x3001;Looper&#x4E0E;MessageQueue&#x6E90;&#x7801;&#x5206;&#x6790;/Handler&#x3001;Looper&#x4E0E;MessageQueue.png\" alt=\"&#x8349;&#x56FE;\"></p>\n<h1 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h1><p>&#x6765;&#x603B;&#x7ED3;&#x4E0B;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x6D41;&#x7A0B;&#x3002;&#x9996;&#x5148;&#x521B;&#x5EFA;<code>Handler</code>&#x800C;&#x5728;<code>Handler</code>&#x6240;&#x5904;&#x7684;&#x7EBF;&#x7A0B;&#x4E2D;&#x5FC5;&#x987B;&#x8981;&#x6709;&#x4E00;&#x4E2A;<code>Looper</code>&#xFF0C;&#x5982;&#x679C;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x9ED8;&#x8BA4;&#x5E2E;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x5FC5;&#x987B;&#x8C03;&#x7528;<code>Looper.prepare</code>&#x6765;&#x521B;&#x5EFA;<code>Looper</code>&#x540C;&#x65F6;&#x8C03;&#x7528;<code>Looper.loop</code>&#x5F00;&#x542F;&#x5BF9;&#x6D88;&#x606F;&#x7684;&#x5904;&#x7406;&#x3002;&#x6BCF;&#x4E2A;<code>Looper</code>&#x4E2D;&#x90FD;&#x6709;&#x4E00;&#x4E2A;<code>MessageQueue</code>&#x5B83;&#x662F;&#x7528;&#x6765;&#x5B58;&#x50A8;<code>Message</code>&#x7684;&#xFF0C;<code>Handler</code>&#x901A;&#x8FC7;<code>post</code>&#x6216;&#x8005;<code>send..</code>&#x7B49;&#x4E00;&#x7CFB;&#x5217;&#x64CD;&#x4F5C;&#x901A;&#x8FC7;<code>Looper</code>&#x5C06;&#x6D88;&#x606F;&#x653E;&#x5165;&#x5230;&#x6D88;&#x606F;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x800C;<code>Looper</code>&#x901A;&#x8FC7;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x65E0;&#x9650;&#x7684;&#x5FAA;&#x73AF;&#x6765;&#x4E00;&#x76F4;&#x76D1;&#x542C;&#x7740;&#x6D88;&#x606F;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x4E0D;&#x65AD;&#x4ECE;<code>MessageQueue</code>&#x4E2D;&#x53D6;&#x51FA;&#x6D88;&#x606F;&#xFF0C;&#x5E76;&#x4EA4;&#x7ED9;&#x4E0E;&#x5F53;&#x524D;<code>Looper</code>&#x6240;&#x7ED1;&#x5B9A;&#x7684;<code>handler</code>&#x7684;<code>dispatchMessage</code>&#x8FDB;&#x884C;&#x5206;&#x53D1;&#xFF0C;&#x6700;&#x540E;&#x6839;&#x636E;&#x60C5;&#x51B5;&#x8C03;&#x7528;<code>Runnable</code>&#x7684;<code>run</code>&#x6216;&#x8005;<code>Handler</code>&#x7684;<code>HandlerMessage</code>&#x65B9;&#x6CD5;&#x5BF9;&#x6D88;&#x606F;&#x8FDB;&#x884C;&#x6700;&#x540E;&#x7684;&#x5904;&#x7406;&#x3002;</p>\n","categories":["android"],"tags":["源码分析"]},{"title":"Android Volley源码分析(二)","url":"https://www.rousetime.com/2016/10/17/Android-Volley源码分析-二/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p>&#x4E0A;&#x4E00;&#x6B21;&#x5206;&#x6790;&#x4E86;&#x5173;&#x4E8E;<code>Volley</code>&#x6700;&#x6838;&#x5FC3;&#x7684;&#x539F;&#x7406;&#xFF0C;&#x5BF9;<code>Volley</code>&#x5982;&#x4F55;&#x5904;&#x7406;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x505A;&#x4E86;&#x4E00;&#x4E2A;&#x5168;&#x9762;&#x7684;&#x5256;&#x6790;&#x3002;&#x8FD8;&#x6CA1;&#x6709;&#x4E86;&#x89E3;&#x7684;&#x53EF;&#x4EE5;&#x5148;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;<a href=\"https://idisfkj.github.io/2016/10/14/Android-Volley%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E4%B8%80/\" target=\"_blank\" rel=\"noopener\">Android Volley&#x6E90;&#x7801;&#x5206;&#x6790;(&#x4E00;)</a>,&#x8FD9;&#x6B21;&#x6211;&#x518D;&#x6765;&#x5BF9;&#x5B83;&#x7684;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x539F;&#x7406;&#x8FDB;&#x884C;&#x81EA;&#x6211;&#x8BB2;&#x89E3;&#xFF0C;&#x5E0C;&#x671B;&#x80FD;&#x5E2E;&#x52A9;&#x5230;&#x4E00;&#x90E8;&#x5206;&#x4EBA;&#xFF0C;&#x4E5F;&#x80FD;&#x5DE9;&#x56FA;&#x81EA;&#x5DF1;&#x6240;&#x5B66;&#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x4E0D;&#x8DB3;&#x4E4B;&#x5904;&#x6B22;&#x8FCE;&#x6307;&#x51FA;&#xFF01;</p>\n<h1 id=\"ImageLoader\"><a href=\"#ImageLoader\" class=\"headerlink\" title=\"ImageLoader\"></a>ImageLoader</h1><p>&#x5BF9;&#x4E8E;&#x56FE;&#x7247;&#x8BF7;&#x6C42;&#xFF0C;&#x662F;&#x5C11;&#x4E0D;&#x4E86;&#x5BF9;<code>ImageLoader</code>&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x56FE;&#x7247;&#x88C5;&#x8F7D;&#x5668;&#xFF0C;&#x5BF9;&#x56FE;&#x7247;&#x8BF7;&#x6C42;&#x7684;&#x7BA1;&#x7406;&#x3002;&#x4E0B;&#x9762;&#x6765;&#x770B;&#x4E0B;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private static final ImageLoader imageLoader = new ImageLoader(VolleyUtil.volleyQueue, new ImageCache(CACHE_SIZE));</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x6709;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x5206;&#x522B;&#x4E3A;<code>RequestQueue</code>&#x4E0E;<code>ImageCache</code>&#xFF0C;&#x5BF9;&#x4E8E;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x6211;&#x4EEC;&#x518D;&#x719F;&#x6089;&#x4E0D;&#x8FC7;&#x4E86;&#xFF0C;&#x81F3;&#x4E8E;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x4E3A;&#x4E86;&#x6784;&#x5EFA;&#x56FE;&#x7247;&#x7F13;&#x5B58;&#x7684;&#xFF0C;&#x5982;&#x4E0D;&#x6784;&#x5EFA;&#x5219;&#x7F13;&#x5B58;&#x81EA;&#x7136;&#x5C31;&#x5931;&#x6548;&#x4E86;&#x3002;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x8FDB;&#x5165;<code>ImageLoader</code>&#x67E5;&#x770B;&#x5B83;&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x770B;&#x5B83;&#x5230;&#x5E95;&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#xFF1F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public ImageLoader(RequestQueue queue, ImageCache imageCache) {</span><br><span class=\"line\">        mRequestQueue = queue;</span><br><span class=\"line\">        mCache = imageCache;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x8FDB;&#x53BB;&#x53D1;&#x73B0;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;<code>get</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5BF9;&#x56FE;&#x7247;&#x7684;&#x5904;&#x7406;&#x5C31;&#x662F;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x8FC7;<code>Volley</code>&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x7684;&#x90FD;&#x77E5;&#x9053;&#x6211;&#x4EEC;&#x90FD;&#x8981;&#x8C03;&#x7528;&#x5B83;&#x7684;<code>get</code>&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5230;&#x5E95;&#x53C8;&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p>\n<h2 id=\"get\"><a href=\"#get\" class=\"headerlink\" title=\"get\"></a>get</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public ImageContainer get(String requestUrl, ImageListener imageListener,</span><br><span class=\"line\">            int maxWidth, int maxHeight, ScaleType scaleType) {</span><br><span class=\"line\"> </span><br><span class=\"line\">        // only fulfill requests that were initiated from the main thread.</span><br><span class=\"line\">        throwIfNotOnMainThread();</span><br><span class=\"line\"> </span><br><span class=\"line\">        final String cacheKey = getCacheKey(requestUrl, maxWidth, maxHeight, scaleType);</span><br><span class=\"line\"> </span><br><span class=\"line\">        // Try to look up the request in the cache of remote images.</span><br><span class=\"line\">        Bitmap cachedBitmap = mCache.getBitmap(cacheKey);</span><br><span class=\"line\">        if (cachedBitmap != null) {</span><br><span class=\"line\">            // Return the cached bitmap.</span><br><span class=\"line\">            ImageContainer container = new ImageContainer(cachedBitmap, requestUrl, null, null);</span><br><span class=\"line\">            imageListener.onResponse(container, true);</span><br><span class=\"line\">            return container;</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        // The bitmap did not exist in the cache, fetch it!</span><br><span class=\"line\">        ImageContainer imageContainer =</span><br><span class=\"line\">                new ImageContainer(null, requestUrl, cacheKey, imageListener);</span><br><span class=\"line\"> </span><br><span class=\"line\">        // Update the caller to let them know that they should use the default bitmap.</span><br><span class=\"line\">        imageListener.onResponse(imageContainer, true);</span><br><span class=\"line\"> </span><br><span class=\"line\">        // Check to see if a request is already in-flight.</span><br><span class=\"line\">        BatchedImageRequest request = mInFlightRequests.get(cacheKey);</span><br><span class=\"line\">        if (request != null) {</span><br><span class=\"line\">            // If it is, add this request to the list of listeners.</span><br><span class=\"line\">            request.addContainer(imageContainer);</span><br><span class=\"line\">            return imageContainer;</span><br><span class=\"line\">        }</span><br><span class=\"line\"> </span><br><span class=\"line\">        // The request is not already in flight. Send the new request to the network and</span><br><span class=\"line\">        // track it.</span><br><span class=\"line\">        Request&lt;Bitmap&gt; newRequest = makeImageRequest(requestUrl, maxWidth, maxHeight, scaleType,</span><br><span class=\"line\">                cacheKey);</span><br><span class=\"line\"> </span><br><span class=\"line\">        mRequestQueue.add(newRequest);</span><br><span class=\"line\">        mInFlightRequests.put(cacheKey,</span><br><span class=\"line\">                new BatchedImageRequest(newRequest, imageContainer));</span><br><span class=\"line\">        return imageContainer;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x6839;&#x636E;&#x4E0A;&#x9762;&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x5B83;&#x4F20;&#x9012;&#x4E86;&#x51E0;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x62EC;&#x8BF7;&#x6C42;&#x7684;<code>url</code>&#x3001;&#x76D1;&#x542C;&#x5668;<code>ImageListener</code>&#x3001;&#x8FD4;&#x56DE;&#x7684;&#x56FE;&#x7247;&#x5BBD;&#x9AD8;&#x4E0E;&#x7F29;&#x653E;&#x7C7B;&#x578B;&#xFF0C;<code>ImageListener</code>&#x662F;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x5BF9;&#x54CD;&#x5E94;&#x4E0D;&#x540C;&#x5904;&#x7406;&#x7684;&#x56DE;&#x8C03;,&#x5305;&#x62EC;<code>onResponse</code>&#x4E0E;<code>onErrorResponse</code>&#x3002;&#x4E0B;&#x9762;&#x770B;&#x4E3B;&#x8981;&#x4EE3;&#x7801;&#xFF0C;&#x9996;&#x5148;&#x5224;&#x65AD;&#x8BE5;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x662F;&#x5426;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF0C;&#x4E0D;&#x662F;&#x5219;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x5BF9;&#x4E8E;&#x5BF9;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;&#x5224;&#x65AD;&#x5E94;&#x8BE5;&#x5F88;&#x5BB9;&#x6613;&#x60F3;&#x5230;&#xFF0C;&#x56E0;&#x4E3A;&#x8981;&#x5BF9;&#x8BF7;&#x6C42;&#x7684;&#x54CD;&#x5E94;&#x505A;&#x5904;&#x7406;&#x66F4;&#x65B0;&#x56FE;&#x7247;&#x7B49;&#xFF0C;&#x5BF9;<code>UI</code>&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x8981;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF0C;&#x6240;&#x4EE5;&#x81EA;&#x7136;&#x8981;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x66F4;&#x65B0;&#x3002;&#x4E0B;&#x4E00;&#x6B65;&#x90FD;&#x662F;&#x4E00;&#x8D2F;&#x7684;&#x4F5C;&#x98CE;&#xFF0C;&#xFF08;<code>10</code>&#x884C;&#x4EE3;&#x7801;&#xFF09;&#x5148;&#x5224;&#x65AD;&#x7F13;&#x5B58;&#x4E2D;&#x662F;&#x5426;&#x5B58;&#x5728;&#x8BE5;&#x8BF7;&#x6C42;&#x7684;<code>Bitmap</code>&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x5728;&#x5219;&#x6784;&#x9020;&#x4E00;&#x4E2A;<code>ImageContainer</code>&#xFF0C;&#x5C06;&#x5FC5;&#x8981;&#x4FE1;&#x606F;&#x4F20;&#x5165;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x7528;&#x6765;&#x4FDD;&#x5B58;&#x56FE;&#x7247;&#x7684;&#x4FE1;&#x606F;,&#x5305;&#x62EC;</p>\n<ul>\n<li><code>Bitmap</code>&#x8BF7;&#x6C42;&#x7684;&#x56FE;&#x7247;</li>\n<li><code>ImageListener</code> &#x76D1;&#x542C;&#x5668;,&#x5305;&#x62EC;&#x540E;&#x7EED;&#x56DE;&#x8C03;&#x7684;<code>onResponse</code>&#x4E0E;<code>onErrorResponse</code>&#x65B9;&#x6CD5;</li>\n<li><code>mCacheKey</code> &#x7F13;&#x5B58;&#x7684;<code>key</code></li>\n<li><code>mRequestUrl</code> &#x8BF7;&#x6C42;&#x7684;<code>url</code></li>\n</ul>\n<p>&#x7136;&#x540E;&#x8C03;&#x7528;<code>imageListener</code>&#x7684;<code>onResponse</code>&#x65B9;&#x6CD5;&#x3002;&#x4E0D;&#x5B58;&#x5728;&#x4E0E;&#x4F1A;&#x4E3A;&#x5176;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>ImageContainer</code>&#x4E3A;&#x4E86;&#x4FDD;&#x5B58;&#x540E;&#x7EED;&#x7684;<code>Bitmpa</code>&#xFF0C;&#x540C;&#x65F6;&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x4E5F;&#x4F1A;&#x5148;&#x8C03;&#x7528;<code>onResponse</code>&#x8FD9;&#x4E00;&#x6B65;&#x5E76;&#x4E0D;&#x662F;&#x8BBE;&#x7F6E;&#x52A0;&#x8F7D;&#x7684;&#x56FE;&#x7247;&#xFF0C;&#x800C;&#x662F;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x6B63;&#x5728;&#x52A0;&#x8F7D;&#x7684;&#x56FE;&#x7247;&#xFF08;&#x5982;&#x679C;&#x4F60;&#x8BBE;&#x7F6E;&#x4E86;&#x7684;&#x8BDD;&#xFF09;&#x3002;&#xFF08;<code>25</code>&#x884C;&#x4EE3;&#x7801;&#xFF09;&#x5982;&#x679C;&#x8BE5;&#x8BF7;&#x6C42;&#x6B63;&#x5728;&#x88AB;&#x6267;&#x884C;,&#x5C06;&#x5F53;&#x524D;&#x7684;<code>ImageContainer</code>&#x52A0;&#x5165;&#x5230;&#x4E00;&#x4E2A;<code>LinkedList</code>&#x4E2D;&#x4E3A;le&#x540E;&#x7EED;&#x54CD;&#x5E94;&#x7684;&#x9012;&#x9001;&#xFF1B;&#x4E0B;&#x9762;&#x624D;&#x662F;&#x771F;&#x5728;&#x4ECE;&#x7F51;&#x7EDC;&#x4E0A;&#x83B7;&#x53D6;&#xFF08;<code>34</code>&#x884C;&#x4EE3;&#x7801;&#xFF09;&#x6784;&#x9020;&#x4E86;&#x4E00;&#x4E2A;<code>Request</code>&#x5E76;&#x5C06;&#x5176;&#x52A0;&#x5165;&#x5230;&#x4E86;&#x8BF7;&#x6C42;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x8FD9;&#x4E2A;<code>makeImageRequest</code>&#x5B9E;&#x73B0;&#x4E86;&#x4EC0;&#x4E48;</p>\n<h2 id=\"makeImageRequest\"><a href=\"#makeImageRequest\" class=\"headerlink\" title=\"makeImageRequest\"></a>makeImageRequest</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected Request&lt;Bitmap&gt; makeImageRequest(String requestUrl, int maxWidth, int maxHeight,</span><br><span class=\"line\">            ScaleType scaleType, final String cacheKey) {</span><br><span class=\"line\">        return new ImageRequest(requestUrl, new Listener&lt;Bitmap&gt;() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onResponse(Bitmap response) {</span><br><span class=\"line\">                onGetImageSuccess(cacheKey, response);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }, maxWidth, maxHeight, scaleType, Config.RGB_565, new ErrorListener() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onErrorResponse(VolleyError error) {</span><br><span class=\"line\">                onGetImageError(cacheKey, error);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        });</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x73B0;&#x5728;&#x660E;&#x767D;&#x4E86;&#x5427;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4F7F;&#x7528;&#x4E86;<code>ImageRequest</code>&#xFF0C;&#x4E0E;<code>StringRequest</code>&#x7C7B;&#x4F3C;&#xFF0C;&#x5728;&#x4E0A;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;<a href=\"https://idisfkj.github.io/2016/10/14/Android-Volley%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E4%B8%80/\" target=\"_blank\" rel=\"noopener\">Android Volley&#x6E90;&#x7801;&#x5206;&#x6790;(&#x4E00;)</a>&#x5DF2;&#x7ECF;&#x8BB2;&#x4E86;&#xFF0C;&#x4E0D;&#x7BA1;&#x662F;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x8FD8;&#x662F;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x5728;&#x6700;&#x540E;&#x90FD;&#x4F1A;&#x5C06;&#x7ED3;&#x679C;&#x4EA4;&#x7531;<code>DeliveryResponse</code>&#x8FDB;&#x884C;&#x9012;&#x9001;,&#x6839;&#x636E;&#x54CD;&#x5E94;&#x60C5;&#x51B5;&#x5206;&#x522B;&#x8C03;&#x7528;&#x76D1;&#x542C;&#x5668;&#x7684;<code>onResponse</code>&#x4E0E;<code>onErrorResponse</code>&#x65B9;&#x6CD5;&#x3002;&#x90A3;&#x4E48;&#x5176;&#x4E2D;&#x7684;<code>onGetImageSuccess</code>&#x4E0E;<code>onGetImageError</code>&#x65B9;&#x6CD5;&#x53C8;&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p>\n<h2 id=\"onGetImageSuccess-amp-amp-onGetImageError\"><a href=\"#onGetImageSuccess-amp-amp-onGetImageError\" class=\"headerlink\" title=\"onGetImageSuccess &amp;&amp; onGetImageError\"></a>onGetImageSuccess &amp;&amp; onGetImageError</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected void onGetImageSuccess(String cacheKey, Bitmap response) {</span><br><span class=\"line\">        // cache the image that was fetched.</span><br><span class=\"line\">        mCache.putBitmap(cacheKey, response);</span><br><span class=\"line\"> </span><br><span class=\"line\">        // remove the request from the list of in-flight requests.</span><br><span class=\"line\">        BatchedImageRequest request = mInFlightRequests.remove(cacheKey);</span><br><span class=\"line\"> </span><br><span class=\"line\">        if (request != null) {</span><br><span class=\"line\">            // Update the response bitmap.</span><br><span class=\"line\">            request.mResponseBitmap = response;</span><br><span class=\"line\"></span><br><span class=\"line\">            // Send the batched response</span><br><span class=\"line\">            batchResponse(cacheKey, request);</span><br><span class=\"line\">        }</span><br></pre></td></tr></table></figure>\n<p>&#x505A;&#x7684;&#x4E8B;&#x65E0;&#x975E;&#x5C31;&#x662F;&#x5C06;<code>Bitmap</code>&#x52A0;&#x5165;&#x7F13;&#x5B58;&#x4E2D;&#x540C;&#x65F6;&#x66F4;&#x65B0;&#x8BF7;&#x6C42;&#x4E2D;&#x7684;<code>Bitmap</code>&#x4EE5;&#x4FBF;&#x540E;&#x7EED;<code>batchResponse</code>&#x7684;&#x6279;&#x5904;&#x7406;&#x64CD;&#x4F5C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected void onGetImageError(String cacheKey, VolleyError error) {</span><br><span class=\"line\">        // Notify the requesters that something failed via a null result.</span><br><span class=\"line\">        // Remove this request from the list of in-flight requests.</span><br><span class=\"line\">        BatchedImageRequest request = mInFlightRequests.remove(cacheKey);</span><br><span class=\"line\"> </span><br><span class=\"line\">        if (request != null) {</span><br><span class=\"line\">            // Set the error for this request</span><br><span class=\"line\">            request.setError(error);</span><br><span class=\"line\"> </span><br><span class=\"line\">            // Send the batched response</span><br><span class=\"line\">            batchResponse(cacheKey, request);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p><code>onGetImageError</code>&#x4E5F;&#x7C7B;&#x4F3C;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x662F;&#x9519;&#x8BEF;&#x7684;&#x54CD;&#x5E94;&#x65E0;&#x9700;&#x52A0;&#x5165;&#x5230;&#x7F13;&#x5B58;&#x4E2D;&#xFF0C;&#x4F46;&#x8FD8;&#x662F;&#x8981;&#x8FDB;&#x884C;<code>batchResponse</code>&#xFF0C;&#x65E2;&#x7136;&#x5982;&#x6B64;&#x90A3;&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x8FDB;&#x5165;<code>batchResponse</code>&#x6E90;&#x7801;&#x3002;</p>\n<h2 id=\"batchResponse\"><a href=\"#batchResponse\" class=\"headerlink\" title=\"batchResponse\"></a>batchResponse</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void batchResponse(String cacheKey, BatchedImageRequest request) {</span><br><span class=\"line\">        mBatchedResponses.put(cacheKey, request);</span><br><span class=\"line\">        // If we don&apos;t already have a batch delivery runnable in flight, make a new one.</span><br><span class=\"line\">        // Note that this will be used to deliver responses to all callers in mBatchedResponses.</span><br><span class=\"line\">        if (mRunnable == null) {</span><br><span class=\"line\">            mRunnable = new Runnable() {</span><br><span class=\"line\">                @Override</span><br><span class=\"line\">                public void run() {</span><br><span class=\"line\">                    for (BatchedImageRequest bir : mBatchedResponses.values()) {</span><br><span class=\"line\">                        for (ImageContainer container : bir.mContainers) {</span><br><span class=\"line\">                            // If one of the callers in the batched request canceled the request</span><br><span class=\"line\">                            // after the response was received but before it was delivered,</span><br><span class=\"line\">                            // skip them.</span><br><span class=\"line\">                            if (container.mListener == null) {</span><br><span class=\"line\">                                continue;</span><br><span class=\"line\">                            }</span><br><span class=\"line\">                            if (bir.getError() == null) {</span><br><span class=\"line\">                                container.mBitmap = bir.mResponseBitmap;</span><br><span class=\"line\">                                 container.mListener.onResponse(container, false);</span><br><span class=\"line\">                            } else {</span><br><span class=\"line\">                                 container.mListener.onErrorResponse(bir.getError());</span><br><span class=\"line\">                            }</span><br><span class=\"line\">                        }</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                    mBatchedResponses.clear();</span><br><span class=\"line\">                    mRunnable = null;</span><br><span class=\"line\">                }</span><br><span class=\"line\"> </span><br><span class=\"line\">            };</span><br><span class=\"line\">            // Post the runnable.</span><br><span class=\"line\">            mHandler.postDelayed(mRunnable, mBatchResponseDelayMs);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x4EE3;&#x7801;&#x53D1;&#x73B0;&#x5176;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;<code>run</code>&#x65B9;&#x6CD5;&#xFF0C;&#x91CC;&#x9762;&#x6839;&#x636E;&#x56FE;&#x7247;&#x5BB9;&#x5668;<code>ImageContainer</code>&#x4E2D;&#x7684;&#x4FE1;&#x606F;&#x5206;&#x522B;&#x8C03;&#x7528;&#x76D1;&#x542C;&#x5668;&#x4E2D;&#x7684;<code>onResponse</code>&#x4E0E;<code>onErrorResponse</code>&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x524D;&#x9762;<code>get</code>&#x4E2D;&#x6240;&#x4F20;&#x9012;&#x7684;<code>ImageListener</code>&#x63A5;&#x53E3;&#x3002;&#x5176;&#x4E2D;&#x65B9;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;&#x53EF;&#x4EE5;&#x7531;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x6765;&#x5B9E;&#x73B0;&#x3002;&#x6700;&#x540E;&#x901A;&#x8FC7;<code>mHandler</code>&#xFF08;&#x4F5C;&#x7528;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF09;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;<br>&#x5BF9;&#x4E8E;<code>ImageListener</code>&#x63A5;&#x53E3;&#xFF0C;&#x4E5F;&#x6709;&#x9ED8;&#x8BA4;&#x7684;&#x5B9E;&#x73B0;<code>getImageListener</code></p>\n<h2 id=\"&#x9ED8;&#x8BA4;&#x7684;getImageListener&#x5B9E;&#x73B0;\"><a href=\"#&#x9ED8;&#x8BA4;&#x7684;getImageListener&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x9ED8;&#x8BA4;&#x7684;getImageListener&#x5B9E;&#x73B0;\"></a>&#x9ED8;&#x8BA4;&#x7684;getImageListener&#x5B9E;&#x73B0;</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static ImageListener getImageListener(final ImageView view,</span><br><span class=\"line\">            final int defaultImageResId, final int errorImageResId) {</span><br><span class=\"line\">        return new ImageListener() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onErrorResponse(VolleyError error) {</span><br><span class=\"line\">                if (errorImageResId != 0) {</span><br><span class=\"line\">                    view.setImageResource(errorImageResId);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onResponse(ImageContainer response, boolean isImmediate) {</span><br><span class=\"line\">                if (response.getBitmap() != null) {</span><br><span class=\"line\">                    view.setImageBitmap(response.getBitmap());</span><br><span class=\"line\">                } else if (defaultImageResId != 0) {</span><br><span class=\"line\">                    view.setImageResource(defaultImageResId);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        };</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x80FD;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x6700;&#x559C;&#x6B22;&#x770B;&#x5230;&#x7684;&#x4EE3;&#x7801;&#xFF1A;&#x5BF9;<code>ImageView</code>&#x8FDB;&#x884C;&#x56FE;&#x7247;&#x586B;&#x5145;&#x3002;&#x4F46;&#x6211;&#x4EEC;&#x53EA;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x7684;&#x5B9E;&#x73B0;&#x53EF;&#x80FD;&#x4F1A;&#x5B58;&#x5728;&#x8BB8;&#x591A;&#x95EE;&#x9898;&#xFF0C;&#x4F8B;&#x5982;&#x591A;&#x6761;&#x76EE;&#x7684;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x4F1A;&#x590D;&#x7528;<code>item</code>&#x5982;&#x679C;&#x4E0D;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x7279;&#x6B8A;&#x5904;&#x7406;&#x4F1A;&#x5F88;&#x5BB9;&#x6613;&#x4EA7;&#x751F;<code>&#x591A;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x65F6;&#x7684;&#x95EA;&#x70C1;&#x4E0E;&#x5F02;&#x4F4D;&#x95EE;&#x9898;</code>&#x3002;&#x90A3;&#x8981;&#x5982;&#x4F55;&#x89E3;&#x51B3;&#x5462;&#xFF1F;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x4E0D;&#x8BA9;&#x4ED6;&#x76F4;&#x63A5;&#x5C31;&#x5904;&#x7406;&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x800C;&#x662F;&#x8981;&#x8FDB;&#x884C;&#x7279;&#x6B8A;&#x7684;&#x5224;&#x65AD;&#xFF0C;&#x65E2;&#x7136;&#x5982;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x6709;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x63A5;&#x53E3;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x81EA;&#x5DF1;&#x6765;&#x5B9E;&#x73B0;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x3002;</p>\n<h2 id=\"&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;ImageListener&#x63A5;&#x53E3;\"><a href=\"#&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;ImageListener&#x63A5;&#x53E3;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;ImageListener&#x63A5;&#x53E3;\"></a>&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;ImageListener&#x63A5;&#x53E3;</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static ImageLoader.ImageListener getImageListener(final ImageView view, final String url, final int defaultImageResId</span><br><span class=\"line\">            , final int errorImageResId) {</span><br><span class=\"line\">        return new ImageLoader.ImageListener() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onResponse(ImageLoader.ImageContainer response, boolean isImmediate) {</span><br><span class=\"line\">                if (response.getBitmap() != null) {</span><br><span class=\"line\">                    //&#x9632;&#x6B62;&#x672A;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x52A0;&#x8F7D;&#x524D;&#x7684;&#x663E;&#x793A;&#x56FE;&#x7247;&#x800C;&#x5BFC;&#x81F4;&#x7684;&#x56FE;&#x7247;&#x9519;&#x4E71;&#x95EE;&#x9898;</span><br><span class=\"line\">                    String preUrl = (String) view.getTag();</span><br><span class=\"line\">                    if (preUrl != null &amp;&amp; preUrl.trim().equals(url)) {</span><br><span class=\"line\">                        if (!isImmediate &amp;&amp; defaultImageResId != 0) {</span><br><span class=\"line\">                            //&#x4F7F;&#x7528;&#x7F51;&#x7EDC;&#x4E0B;&#x8F7D;&#x7684;&#x56FE;&#x7247;</span><br><span class=\"line\">                            TransitionDrawable transitionDrawable = new TransitionDrawable(</span><br><span class=\"line\">                                    new Drawable[]{</span><br><span class=\"line\">                                            App.mContext.getResources().getDrawable(defaultImageResId),</span><br><span class=\"line\">                                            new BitmapDrawable(App.mContext.getResources(),</span><br><span class=\"line\">                                                    response.getBitmap())</span><br><span class=\"line\">                                    }</span><br><span class=\"line\">                            );</span><br><span class=\"line\">                            transitionDrawable.setCrossFadeEnabled(true);</span><br><span class=\"line\">                            view.setImageDrawable(transitionDrawable);</span><br><span class=\"line\">                            transitionDrawable.startTransition(100);</span><br><span class=\"line\">                        } else {</span><br><span class=\"line\">                            //&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x56FE;&#x7247;</span><br><span class=\"line\">                            view.setImageBitmap(response.getBitmap());</span><br><span class=\"line\">                        }</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                } else {</span><br><span class=\"line\">                    if (defaultImageResId != 0)</span><br><span class=\"line\">                        view.setImageResource(defaultImageResId);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\"></span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onErrorResponse(VolleyError error) {</span><br><span class=\"line\">                if (errorImageResId != 0)</span><br><span class=\"line\">                    view.setImageResource(errorImageResId);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        };</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5982;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x6CE8;&#x91CA;&#x6240;&#x793A;&#xFF0C;&#x5BF9;<code>View</code>&#x5176;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;<code>Tag</code>&#x53EF;&#x4EE5;&#x662F;<code>url</code>&#x3002;&#x53EA;&#x6709;&#x7B26;&#x5408;&#x5F53;&#x524D;&#x4F4D;&#x7F6E;&#x7684;<code>url</code>&#x94FE;&#x63A5;&#x7684;<code>Bitmap</code>&#x624D;&#x80FD;&#x586B;&#x5145;&#x5F53;&#x524D;&#x7684;<code>View</code>&#xFF0C;&#x5176;&#x5B9E;&#x8981;&#x5B8C;&#x7F8E;&#x89E3;&#x51B3;&#x662F;&#x6709;&#x4E00;&#x4E2A;&#x524D;&#x63D0;&#x7684;&#xFF0C;&#x8BBE;&#x7F6E;&#x4E86;&#x9ED8;&#x8BA4;&#x7684;&#x663E;&#x793A;&#x56FE;&#x7247;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x56FE;&#x7247;&#x7684;&#x663E;&#x793A;&#xFF0C;&#x867D;&#x7136;&#x5F02;&#x4F4D;&#x7684;&#x60C5;&#x51B5;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x4F46;&#x53EF;&#x80FD;&#x8FD8;&#x662F;&#x4F1A;&#x5BFC;&#x81F4;&#x56FE;&#x7247;&#x7684;&#x95EA;&#x70C1;&#x3002;&#x53EA;&#x4E0D;&#x8FC7;&#x73B0;&#x5728;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x90FD;&#x4F1A;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x7684;&#x56FE;&#x7247;&#x663E;&#x793A;&#xFF0C;&#x6240;&#x4EE5;&#x57FA;&#x672C;&#x5C31;&#x4E0D;&#x5B58;&#x8FD9;&#x79CD;&#x95EE;&#x9898;&#x4E86;&#x3002;</p>\n<h2 id=\"ImageCache\"><a href=\"#ImageCache\" class=\"headerlink\" title=\"ImageCache\"></a>ImageCache</h2><p>&#x5173;&#x4E8E;&#x7F13;&#x5B58;&#x5728;<code>ImageLoader</code>&#x4E2D;&#x63D0;&#x4F9B;&#x4E86;<code>ImageLoader.ImageCache</code>&#x63A5;&#x53E3;&#xFF0C;&#x5C31;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;<code>getBitmap</code>&#x4E0E;<code>putBitmap</code>,&#x5982;&#x679C;&#x7EC6;&#x5FC3;&#x7684;&#x8BDD;&#x524D;&#x9762;&#x5BF9;&#x7F13;&#x5B58;&#x7684;&#x5904;&#x7406;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x4E0E;&#x4FDD;&#x5B58;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x8981;&#x5B9E;&#x73B0;&#x7F13;&#x5B58;&#x7684;&#x8BDD;&#x5C31;&#x5FC5;&#x987B;&#x5B9E;&#x73B0;&#x8BE5;&#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x5B9E;&#x73B0;&#x5176;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x4E0D;&#x8FC7;&#x5BF9;&#x7F13;&#x5B58;&#x7684;&#x7BA1;&#x7406;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7EE7;&#x627F;<code>LruCache</code>&#x7B97;&#x6CD5;&#x6765;&#x5B9E;&#x73B0;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class ImageCache extends LruCache&lt;String, Bitmap&gt; implements ImageLoader.ImageCache {</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * @param maxSize for caches that do not override {@link #sizeOf}, this is</span><br><span class=\"line\">     *                the maximum number of entries in the cache. For all other caches,</span><br><span class=\"line\">     *                this is the maximum sum of the sizes of the entries in this cache.</span><br><span class=\"line\">     */</span><br><span class=\"line\"> </span><br><span class=\"line\">    public ImageCache(int maxSize) {</span><br><span class=\"line\">        super(maxSize);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    protected int sizeOf(String key, Bitmap value) {</span><br><span class=\"line\">        return value.getRowBytes() * value.getHeight();</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public Bitmap getBitmap(String url) {</span><br><span class=\"line\">        return get(url);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void putBitmap(String url, Bitmap bitmap) {</span><br><span class=\"line\">        put(url, bitmap);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x4E8E;&#x7F13;&#x5B58;<code>maxSize</code>&#x7684;&#x5927;&#x5C0F;&#x53EF;&#x4EE5;&#x53D6;&#x5185;&#x5B58;&#x9600;&#x503C;&#x7684;1/8</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private static final int CACHE_SIZE = 1024 * 1024 * ((ActivityManager) App.mContext.</span><br><span class=\"line\">            getSystemService(Context.ACTIVITY_SERVICE)).getMemoryClass() / 8;</span><br></pre></td></tr></table></figure>\n<h1 id=\"NetWorkImageView\"><a href=\"#NetWorkImageView\" class=\"headerlink\" title=\"NetWorkImageView\"></a>NetWorkImageView</h1><p><code>Volley</code>&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x4E13;&#x95E8;&#x7684;&#x7F51;&#x7EDC;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x7684;&#x63A7;&#x4EF6;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5C06;<code>xml</code>&#x6587;&#x4EF6;&#x4E2D;&#x7684;<code>ImageView</code>&#x66FF;&#x6362;&#x6210;<code>NetWorkImageView</code>&#xFF0C;&#x8BE5;&#x63A7;&#x4EF6;&#x4E5F;&#x662F;&#x7EE7;&#x627F;&#x4E86;<code>ImageView</code>&#x53EA;&#x4E0D;&#x8FC7;&#x5B83;&#x5BF9;&#x4E13;&#x95E8;&#x5BF9;&#x4F7F;&#x7528;<code>Volley</code>&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x8FDB;&#x884C;&#x4E86;&#x5C01;&#x88C5;&#x3002;&#x4F7F;&#x7528;&#x65F6;&#x901A;&#x8FC7;<code>setDefaultImageResId</code>&#x4E0E;<code>setErrorImageResId</code>&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x4E0E;&#x9519;&#x8BEF;&#x663E;&#x793A;&#x56FE;&#x7247;&#xFF0C;&#x8C03;&#x7528;&#x5219;&#x662F;&#x76F4;&#x63A5;<code>setImageUrl</code>&#xFF0C;&#x8FD8;&#x662F;&#x6765;&#x770B;&#x4E0B;&#x6E90;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void setImageUrl(String url, ImageLoader imageLoader) {</span><br><span class=\"line\">        mUrl = url;</span><br><span class=\"line\">        mImageLoader = imageLoader;</span><br><span class=\"line\">        // The URL has potentially changed. See if we need to load it.</span><br><span class=\"line\">        loadImageIfNecessary(false);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x53C2;&#x6570;<code>url</code>&#x4E0E;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684;<code>ImageLoader</code>,&#x8BF4;&#x660E;&#x4E0D;&#x7BA1;&#x4F7F;&#x7528;&#x54EA;&#x79CD;&#x65B9;&#x5F0F;<code>ImageLoader</code>&#x90FD;&#x662F;&#x5FC5;&#x987B;&#x7684;&#x3002;&#x518D;&#x770B;&#x4E0B;<code>loadImageIfNecessary</code>&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#xFF1F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void loadImageIfNecessary(final boolean isInLayoutPass) {</span><br><span class=\"line\">        int width = getWidth();</span><br><span class=\"line\">        int height = getHeight();</span><br><span class=\"line\">        ScaleType scaleType = getScaleType();</span><br><span class=\"line\">   </span><br><span class=\"line\">        boolean wrapWidth = false, wrapHeight = false;</span><br><span class=\"line\">        if (getLayoutParams() != null) {</span><br><span class=\"line\">            wrapWidth = getLayoutParams().width == LayoutParams.WRAP_CONTENT;</span><br><span class=\"line\">            wrapHeight = getLayoutParams().height == LayoutParams.WRAP_CONTENT;</span><br><span class=\"line\">        }</span><br><span class=\"line\">   </span><br><span class=\"line\">        // if the view&apos;s bounds aren&apos;t known yet, and this is not a wrap-content/wrap-content</span><br><span class=\"line\">        // view, hold off on loading the image.</span><br><span class=\"line\">        boolean isFullyWrapContent = wrapWidth &amp;&amp; wrapHeight;</span><br><span class=\"line\">        if (width == 0 &amp;&amp; height == 0 &amp;&amp; !isFullyWrapContent) {</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        }</span><br><span class=\"line\">   </span><br><span class=\"line\">        // if the URL to be loaded in this view is empty, cancel any old requests and clear the</span><br><span class=\"line\">        // currently loaded image.</span><br><span class=\"line\">        if (TextUtils.isEmpty(mUrl)) {</span><br><span class=\"line\">            if (mImageContainer != null) {</span><br><span class=\"line\">                mImageContainer.cancelRequest();</span><br><span class=\"line\">                mImageContainer = null;</span><br><span class=\"line\">            }</span><br><span class=\"line\">            setDefaultImageOrNull();</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        }</span><br><span class=\"line\">   </span><br><span class=\"line\">        // if there was an old request in this view, check if it needs to be canceled.</span><br><span class=\"line\">        if (mImageContainer != null &amp;&amp; mImageContainer.getRequestUrl() != null) {</span><br><span class=\"line\">            if (mImageContainer.getRequestUrl().equals(mUrl)) {</span><br><span class=\"line\">                // if the request is from the same URL, return.</span><br><span class=\"line\">                return;</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                // if there is a pre-existing request, cancel it if it&apos;s fetching a different URL.</span><br><span class=\"line\">                mImageContainer.cancelRequest();</span><br><span class=\"line\">                setDefaultImageOrNull();</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">   </span><br><span class=\"line\">        // Calculate the max image width / height to use while ignoring WRAP_CONTENT dimens.</span><br><span class=\"line\">        int maxWidth = wrapWidth ? 0 : width;</span><br><span class=\"line\">        int maxHeight = wrapHeight ? 0 : height;</span><br><span class=\"line\">     </span><br><span class=\"line\">        // The pre-existing content of this view didn&apos;t match the current URL. Load the new image</span><br><span class=\"line\">        // from the network.</span><br><span class=\"line\">        ImageContainer newContainer = mImageLoader.get(mUrl,</span><br><span class=\"line\">                new ImageListener() {</span><br><span class=\"line\">                    @Override</span><br><span class=\"line\">                    public void onErrorResponse(VolleyError error) {</span><br><span class=\"line\">                        if (mErrorImageId != 0) {</span><br><span class=\"line\">                                 setImageResource(mErrorImageId);</span><br><span class=\"line\">                        }</span><br><span class=\"line\">                    }</span><br><span class=\"line\">      </span><br><span class=\"line\">                    @Override</span><br><span class=\"line\">                    public void onResponse(final ImageContainer response, boolean isImmediate) {</span><br><span class=\"line\">                        // If this was an immediate response that was delivered inside of a layout</span><br><span class=\"line\">                        // pass do not set the image immediately as it will trigger a requestLayout</span><br><span class=\"line\">                        // inside of a layout. Instead, defer setting the image by posting back to</span><br><span class=\"line\">                        // the main thread.</span><br><span class=\"line\">                        if (isImmediate &amp;&amp; isInLayoutPass) {</span><br><span class=\"line\">                            post(new Runnable() {</span><br><span class=\"line\">                                @Override</span><br><span class=\"line\">                                public void run() {</span><br><span class=\"line\">                                      onResponse(response, false);</span><br><span class=\"line\">                                }</span><br><span class=\"line\">                            });</span><br><span class=\"line\">                            return;</span><br><span class=\"line\">                        }</span><br><span class=\"line\"></span><br><span class=\"line\">                        if (response.getBitmap() != null) {</span><br><span class=\"line\">                                 setImageBitmap(response.getBitmap());</span><br><span class=\"line\">                        } else if (mDefaultImageId != 0) {</span><br><span class=\"line\">                                   setImageResource(mDefaultImageId);</span><br><span class=\"line\">                        }</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }, maxWidth, maxHeight, scaleType);</span><br><span class=\"line\"> </span><br><span class=\"line\">        // update the ImageContainer to be the new bitmap container.</span><br><span class=\"line\">        mImageContainer = newContainer;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x4EE3;&#x7801;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x4F46;&#x90FD;&#x662F;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x7684;&#xFF0C;&#x524D;&#x9762;&#x4E00;&#x90E8;&#x5206;&#x90FD;&#x662F;&#x5BF9;&#x5BBD;&#x5EA6;&#x4E0E;&#x9AD8;&#x5EA6;&#x7684;&#x8BA1;&#x7B97;&#xFF0C;&#x4F7F;&#x56FE;&#x7247;&#x80FD;&#x9002;&#x5E94;&#x63A7;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x627E;&#x5230;&#x6211;&#x4EEC;&#x6240;&#x719F;&#x6089;&#x7684;&#xFF08;<code>48</code>&#x884C;&#x4EE3;&#x7801;&#xFF09;&#xFF0C;&#x5B83;&#x5C31;&#x662F;&#x524D;&#x9762;&#x7684;<code>get</code>&#x65B9;&#x6CD5;&#x4EE5;&#x53CA;<code>ImageListener</code>&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x91CC;&#x76F8;&#x4FE1;&#x73B0;&#x5728;&#x4E0D;&#x7528;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x5B83;&#x8C03;&#x7528;&#x7684;&#x6E90;&#x7801;&#x90FD;&#x5728;&#x524D;&#x9762;&#x8BB2;&#x4E86;&#x3002;&#x518D;&#x5411;&#x4E0A;&#x8D70;(<code>32</code>&#x884C;&#x4EE3;&#x7801;)&#x53D1;&#x73B0;&#x6CA1;&#xFF0C;&#x5B83;&#x5C06;&#x5F53;&#x524D;<code>NetWorkImageView</code>&#x4E2D;&#x7684;<code>ImageContainer</code>&#x4E2D;&#x4FDD;&#x5B58;&#x7684;<code>url</code>&#x4E0E;&#x8BF7;&#x6C42;&#x7684;<code>url</code>&#x76F8;&#x6BD4;&#x8F83;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x4E0E;&#x524D;&#x9762;&#x6240;&#x8BF4;&#x7684;<code>&#x9632;&#x95EA;&#x70C1;&#x4E0E;&#x5F02;&#x4F4D;</code>&#x7684;&#x5904;&#x7406;&#x76F8;&#x4F3C;&#x5462;&#xFF1F;&#x4F60;&#x770B;&#xFF0C;&#x5982;&#x679C;<code>url</code>&#x76F8;&#x540C;&#x7684;&#x8BDD;&#x8BF4;&#x660E;&#x5F53;&#x524D;&#x63A7;&#x4EF6;&#x4E0A;&#x6240;&#x663E;&#x793A;&#x7684;&#x56FE;&#x7247;&#x4E0E;&#x7ED3;&#x679C;&#x543B;&#x5408;&#xFF0C;&#x5C31;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x4E0D;&#x505A;&#x5904;&#x7406;&#xFF1B;&#x5426;&#x5219;<code>mImageContainer.cancelRequest()</code>&#x53D6;&#x6D88;&#x539F;&#x6765;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x4E14;<code>setDefaultImageOrNull()</code>&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x4F5C;&#x7528;&#x770B;&#x65B9;&#x6CD5;&#x540D;&#x5C31;&#x77E5;&#x9053;&#xFF1A;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;&#x9ED8;&#x8BA4;&#x56FE;&#x7247;&#x5C31;&#x663E;&#x793A;&#x9ED8;&#x8BA4;&#x56FE;&#x7247;&#xFF0C;&#x6CA1;&#x6709;&#x5C31;&#x8BBE;&#x7F6E;&#x7A7A;&#x56FE;&#x7247;&#x4E0D;&#x663E;&#x793A;&#x3002;&#x540E;&#x9762;&#x7684;&#x5904;&#x7406;&#x5C31;&#x662F;&#x4E0A;&#x9762;&#x7684;<code>get</code>&#x5904;&#x7406;&#x4E86;&#xFF0C;&#x518D;&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x3002;&#x6240;&#x4EE5;<code>NetWorkImageView</code>&#x4F7F;&#x7528;&#x8D77;&#x6765;&#x76F8;&#x5BF9;&#x4E8E;&#x66F4;&#x7B80;&#x5355;&#xFF0C;&#x66F4;&#x5BB9;&#x6613;&#x4E0A;&#x624B;&#x3002;</p>\n<h1 id=\"&#x5410;&#x69FD;\"><a href=\"#&#x5410;&#x69FD;\" class=\"headerlink\" title=\"&#x5410;&#x69FD;\"></a>&#x5410;&#x69FD;</h1><p>&#x5176;&#x5B9E;&#x4E0A;&#x9762;&#x7684;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x52A0;&#x8F7D;&#x56FE;&#x7247;&#x6700;&#x7EC8;&#x90FD;&#x662F;&#x8C03;&#x7528;&#x7684;<code>ImageRequest</code>&#xFF0C;&#x800C;<code>ImageRequest</code>&#x662F;&#x7EE7;&#x627F;&#x4E0E;<code>Request</code>&#xFF0C;&#x6240;&#x4EE5;&#x8FD8;&#x662F;&#x8D70;&#x5230;&#x4E86;&#x524D;&#x9762;&#x90A3;&#x7BC7;&#x6587;&#x7AE0;&#x6240;&#x8BB2;&#x7684;&#x5185;&#x5BB9;&#x3002;&#x540C;&#x7406;&#x518D;&#x53BB;&#x770B;<code>StringRequest</code>&#x3001;<code>JsonObjectRequest</code>&#x4E0E;<code>JsonArrayRequest</code>&#x90FD;&#x662F;&#x7C7B;&#x4F3C;&#x7684;&#xFF0C;&#x90FD;&#x662F;&#x91CD;&#x5199;<code>deliverResponse</code>&#x4E0E;<code>parseNetworkResponse</code>&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x540C;&#x6837;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x53C8;&#x56DE;&#x5230;&#x4E86;<a href=\"https://idisfkj.github.io/2016/10/14/Android-Volley%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E4%B8%80/\" target=\"_blank\" rel=\"noopener\">Android Volley&#x6E90;&#x7801;&#x5206;&#x6790;(&#x4E00;)</a>&#x4E2D;&#x6240;&#x5206;&#x6790;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>\n<h1 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h1><p>&#x8FD9;&#x91CC;&#x5BF9;<code>Volley</code>&#x52A0;&#x8F7D;&#x56FE;&#x7247;&#x7684;&#x4F7F;&#x7528;&#x8FDB;&#x884C;&#x7B80;&#x5355;&#x7684;&#x6982;&#x62EC;</p>\n<ul>\n<li>&#x521B;&#x5EFA;<code>RequestQueue</code></li>\n<li>&#x521B;&#x5EFA;<code>ImageLoader</code></li>\n<li>&#x5B9E;&#x73B0;&#x7F13;&#x5B58;&#x3002;&#x7EE7;&#x627F;<code>LruCache</code>&#x5B9E;&#x73B0;<code>ImageLoader</code>&#x7684;<code>ImageLoader.ImageCache</code>&#x63A5;&#x53E3;</li>\n<li>&#x5982;&#x679C;&#x4F7F;&#x7528;<code>ImageView</code>&#x5219;&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;<code>ImageLoader.ImageListener</code>,&#x8C03;&#x7528;<code>get</code>&#x65B9;&#x6CD5;</li>\n<li>&#x5982;&#x679C;&#x4F7F;&#x7528;<code>NetWorkImageView</code>&#x5219;&#x76F4;&#x63A5;&#x8C03;&#x7528;<code>setImageUrl</code>&#x65B9;&#x6CD5;</li>\n</ul>\n","categories":["android"],"tags":["源码分析"]},{"title":"Android Volley源码分析(一)","url":"https://www.rousetime.com/2016/10/14/Android-Volley源码分析-一/","content":"<p><code>volley</code>&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x6D41;&#x884C;&#x7684;<code>Android</code>&#x5F00;&#x6E90;&#x6846;&#x67B6;&#xFF0C;&#x81EA;&#x5DF1;&#x5E73;&#x65F6;&#x4E5F;&#x7ECF;&#x5E38;&#x4F7F;&#x7528;&#x5B83;&#xFF0C;&#x4F46;&#x81EA;&#x5DF1;&#x5BF9;&#x4E8E;&#x5B83;&#x7684;&#x5185;&#x90E8;&#x7684;&#x5B9E;&#x73B0;&#x8FC7;&#x7A0B;&#x5E76;&#x6CA1;&#x6709;&#x8FDB;&#x884C;&#x592A;&#x591A;&#x7684;&#x6DF1;&#x7A76;&#x3002;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x4EE5;&#x540E;&#x80FD;&#x66F4;&#x901A;&#x900F;&#x7684;&#x4F7F;&#x7528;&#x5B83;&#xFF0C;&#x4E86;&#x89E3;&#x5B83;&#x7684;&#x5B9E;&#x73B0;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x81EA;&#x5DF1;&#x6709;&#x4E86;&#x4E00;&#x70B9;&#x7814;&#x7A76;&#xFF0C;&#x505A;&#x4E2A;&#x7B14;&#x8BB0;&#x540C;&#x65F6;&#x4E0E;&#x5927;&#x5BB6;&#x4E00;&#x8D77;&#x5206;&#x4EAB;&#x3002;&#x671F;&#x95F4;&#x81EA;&#x5DF1;&#x4E5F;&#x753B;&#x4E86;&#x4E00;&#x5F20;&#x56FE;&#xFF0C;&#x5E0C;&#x671B;&#x80FD;&#x66F4;&#x597D;&#x7684;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x7406;&#x89E3;&#x5176;&#x4E2D;&#x7684;&#x6B65;&#x9AA4;&#x4E0E;&#x539F;&#x7406;&#x3002;&#x5982;&#x4E0B;&#xFF1A;<br><img src=\"/2016/10/14/Android-Volley&#x6E90;&#x7801;&#x5206;&#x6790;-&#x4E00;/Volley&#x6846;&#x67B6;&#x56FE;.png\" alt=\"Volley&#x6846;&#x67B6;&#x56FE;\"><br>&#x5F00;&#x59CB;&#x770B;&#x53EF;&#x80FD;&#x4F1A;&#x4E00;&#x8138;&#x61F5;&#x903C;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x7ED3;&#x5408;&#x6E90;&#x7801;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x6765;&#xFF0C;&#x73B0;&#x5728;&#x8BA9;&#x6211;&#x4EEC;&#x4E00;&#x8D77;&#x8FDB;&#x5165;<code>Volley</code>&#x7684;&#x6E90;&#x7801;&#x4E16;&#x754C;&#xFF0C;&#x6765;&#x89E3;&#x8BFB;&#x5927;&#x795E;&#x4EEC;&#x7684;&#x7F16;&#x7A0B;&#x601D;&#x60F3;&#x3002;</p>\n<h1 id=\"newRequestQueue\"><a href=\"#newRequestQueue\" class=\"headerlink\" title=\"newRequestQueue\"></a>newRequestQueue</h1><p>&#x5982;&#x679C;&#x4F7F;&#x7528;&#x8FC7;<code>Volley</code>&#x7684;&#x90FD;&#x77E5;&#x9053;&#xFF0C;&#x4E0D;&#x7BA1;&#x662F;&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x8FD8;&#x662F;&#x4EC0;&#x4E48;&#x522B;&#x7684;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#xFF0C;&#x9996;&#x5148;&#x90FD;&#x8981;&#x521B;&#x5EFA;&#x597D;&#x4E00;&#x4E2A;<code>RequestQueue</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static final RequestQueue volleyQueue = Volley.newRequestQueue(App.mContext);</span><br></pre></td></tr></table></figure>\n<p>&#x800C;<code>RequestQueue</code>&#x7684;&#x521B;&#x5EFA;&#x81EA;&#x7136;&#x79BB;&#x4E0D;&#x5F00;<code>Volley</code>&#x4E2D;&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;<code>newRequestQueue</code>&#xFF0C;&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x56FE;&#x7247;&#x4E5F;&#x80FD;&#x77E5;&#x9053;&#x9996;&#x5148;&#x8FDB;&#x5165;&#x70B9;&#x662F;<code>newRequestQueue</code>,&#x597D;&#x4E86;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x5230;&#x5E95;&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static RequestQueue newRequestQueue(Context context, HttpStack stack) {</span><br><span class=\"line\">        File cacheDir = new File(context.getCacheDir(), DEFAULT_CACHE_DIR);</span><br><span class=\"line\">        String userAgent = &quot;volley/0&quot;;</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            String packageName = context.getPackageName();</span><br><span class=\"line\">            PackageInfo info = context.getPackageManager().getPackageInfo(packageName, 0);</span><br><span class=\"line\">            userAgent = packageName + &quot;/&quot; + info.versionCode;</span><br><span class=\"line\">        } catch (NameNotFoundException e) {</span><br><span class=\"line\">        }</span><br><span class=\"line\">        if (stack == null) {</span><br><span class=\"line\">            if (Build.VERSION.SDK_INT &gt;= 9) {</span><br><span class=\"line\">                stack = new HurlStack();</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                // Prior to Gingerbread, HttpUrlConnection was unreliable.</span><br><span class=\"line\">                // See: http://android-developers.blogspot.com/2011/09/androids-http-clients.html</span><br><span class=\"line\">                stack = new HttpClientStack(AndroidHttpClient.newInstance(userAgent));</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        Network network = new BasicNetwork(stack);</span><br><span class=\"line\">        RequestQueue queue = new RequestQueue(new DiskBasedCache(cacheDir), network);</span><br><span class=\"line\">        queue.start();</span><br><span class=\"line\">        return queue;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x6E90;&#x7801;&#x4E2D;&#x6211;&#x4EEC;&#x80FD;&#x53D1;&#x73B0;&#x6709;&#x4E00;&#x4E2A;<code>stack</code>&#xFF0C;&#x5B83;&#x4EE3;&#x8868;&#x7740;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x901A;&#x4FE1;<code>HttpClient</code>&#x4E0E;<code>HttpUrlConnection</code>&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x90FD;&#x662F;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#x4E3A;<code>null</code>&#x3002;&#x56E0;&#x4E3A;&#x5B83;&#x4F1A;&#x9ED8;&#x8BA4;&#x5E2E;&#x6211;&#x4EEC;&#x8FDB;&#x5224;&#x65AD;&#x9009;&#x62E9;&#x66F4;&#x9002;&#x5408;&#x7684;&#x3002;&#x5F53;&#x624B;&#x673A;&#x7248;&#x672C;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;<code>9</code>&#x65F6;&#x4F1A;&#x4F7F;&#x7528;<code>HurlStack</code>&#x5B83;&#x91CC;&#x9762;&#x4F7F;&#x7528;<code>HttpUrlConnection</code>&#x8FDB;&#x884C;&#x5B9E;&#x73B0;&#x901A;&#x4FE1;&#x7684;&#xFF0C;&#x800C;&#x5C0F;&#x4E8E;<code>9</code>&#x65F6;&#x5219;&#x521B;&#x5EFA;<code>HttpClientStack</code>&#xFF0C;&#x5B83;&#x91CC;&#x9762;&#x81EA;&#x7136;&#x662F;<code>HttpClient</code>&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x901A;&#x8FC7;<code>BasicNetwork</code>&#x6784;&#x9020;&#x6210;<code>Network</code>&#x6765;&#x8FDB;&#x884C;&#x4F20;&#x9012;&#x4F7F;&#x7528;&#xFF1B;&#x5728;&#x8FD9;&#x4E4B;&#x540E;&#x6784;&#x5EFA;&#x4E86;<code>RequestQueue</code>&#xFF0C;&#x5176;&#x4E2D;&#x5E2E;&#x6211;&#x4EEC;&#x6784;&#x9020;&#x4E86;&#x4E00;&#x4E2A;&#x7F13;&#x5B58;<code>new DiskBasedCache(cacheDir)</code>&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;<code>5MB</code>,&#x7F13;&#x5B58;&#x76EE;&#x5F55;&#x4E3A;<code>volley</code>&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x80FD;&#x5728;<code>data/data/&#x5E94;&#x7528;&#x5305;&#x540D;/volley</code>&#x4E0B;&#x627E;&#x5230;&#x7F13;&#x5B58;&#x3002;&#x6700;&#x540E;&#x8C03;&#x7528;&#x5176;<code>start</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;<code>RequestQueue</code>&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x7B2C;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#x7684;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x8FDB;&#x5165;<code>RequestQueue</code>&#x4E2D;&#x7684;<code>start</code>&#x65B9;&#x6CD5;&#x770B;&#x4E0B;&#x5B83;&#x5230;&#x5E95;&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p>\n<h1 id=\"RequestQueue\"><a href=\"#RequestQueue\" class=\"headerlink\" title=\"RequestQueue\"></a>RequestQueue</h1><p>&#x5728;<code>RequestQueue</code>&#x4E2D;&#x901A;&#x8FC7;<code>this</code>&#x8C03;&#x7528;&#x81EA;&#x8EAB;&#x6765;&#x9ED8;&#x8BA4;&#x5E2E;&#x6211;&#x4EEC;&#x8C03;&#x7528;&#x4E86;&#x4E0B;&#x9762;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public RequestQueue(Cache cache, Network network, int threadPoolSize,</span><br><span class=\"line\">            ResponseDelivery delivery) {</span><br><span class=\"line\">        mCache = cache;</span><br><span class=\"line\">        mNetwork = network;</span><br><span class=\"line\">        mDispatchers = new NetworkDispatcher[threadPoolSize];</span><br><span class=\"line\">        mDelivery = delivery;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p><code>cache</code>&#x540E;&#x7EED;&#x5728;<code>NetworkDispatcher</code>&#x4E2D;&#x4F1A;&#x5E2E;&#x6211;&#x4EEC;&#x8FDB;&#x884C;<code>response.cacheEntry</code>&#x7684;&#x7F13;&#x5B58;&#xFF0C;<code>netWork</code>&#x662F;&#x524D;&#x9762;&#x7684;&#x6839;&#x636E;&#x7248;&#x672C;&#x6240;&#x5C01;&#x88C5;&#x7684;&#x901A;&#x4FE1;&#xFF0C;<code>threadPoolSize</code>&#x7EBF;&#x7A0B;&#x6C60;&#x5927;&#x5C0F;&#x9ED8;&#x8BA4;&#x4E3A;<code>4</code>&#xFF0C;<code>delivery</code>,&#x662F;<code>ExecutorDelivery</code>&#x4F5C;&#x7528;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;,&#x5728;&#x6700;&#x540E;&#x5BF9;&#x8BF7;&#x6C42;&#x54CD;&#x5E94;&#x7684;&#x5206;&#x53D1;&#x3002;</p>\n<h2 id=\"start\"><a href=\"#start\" class=\"headerlink\" title=\"start\"></a>start</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void start() {</span><br><span class=\"line\">        stop();  // Make sure any currently running dispatchers are stopped.</span><br><span class=\"line\">        // Create the cache dispatcher and start it.</span><br><span class=\"line\">        mCacheDispatcher = new CacheDispatcher(mCacheQueue, mNetworkQueue, mCache, mDelivery);</span><br><span class=\"line\">        mCacheDispatcher.start();</span><br><span class=\"line\">        // Create network dispatchers (and corresponding threads) up to the pool size.</span><br><span class=\"line\">        for (int i = 0; i &lt; mDispatchers.length; i++) {</span><br><span class=\"line\">            NetworkDispatcher networkDispatcher = new NetworkDispatcher(mNetworkQueue, mNetwork,</span><br><span class=\"line\">                    mCache, mDelivery);</span><br><span class=\"line\">            mDispatchers[i] = networkDispatcher;</span><br><span class=\"line\">            networkDispatcher.start();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5728;<code>start</code>&#x65B9;&#x6CD5;&#x4E2D;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x5B83;&#x5B9E;&#x73B0;&#x4E86;&#x4E24;&#x4E2A;<code>dispatch</code>,&#x4E00;&#x4E2A;&#x662F;<code>CacheDispatcher</code>&#x7F13;&#x5B58;&#x6D3E;&#x9063;,&#x53E6;&#x4E00;&#x4E2A;&#x662F;<code>networkDispatcher</code>&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x6D3E;&#x9063;&#xFF0C;&#x5176;&#x5B9E;&#x4ED6;&#x4EEC;&#x90FD;&#x662F;<code>Thread</code>&#xFF0C;&#x6240;&#x4EE5;&#x90FD;&#x8C03;&#x7528;&#x4E86;&#x4ED6;&#x4EEC;&#x7684;<code>start</code>&#x65B9;&#x6CD5;&#x3002;&#x5176;&#x4E2D;<code>networkDispatcher</code>&#x9ED8;&#x8BA4;&#x6784;&#x5EFA;&#x4E86;<code>4</code>&#x4E2A;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x5305;&#x542B;<code>4</code>&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#x3002;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5148;&#x4E0D;&#x53BB;&#x770B;&#x4ED6;&#x4EEC;&#x5185;&#x90E8;&#x7684;<code>run</code>&#x65B9;&#x6CD5;&#x5230;&#x5E95;&#x5B9E;&#x73B0;&#x4E86;&#x4EC0;&#x4E48;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x63A5;&#x7740;&#x770B;<code>RequestQueue</code>&#x4E2D;&#x6211;&#x4EEC;&#x9891;&#x7E41;&#x4F7F;&#x7528;&#x7684;<code>add</code>&#x65B9;&#x6CD5;&#x3002;</p>\n<h2 id=\"add\"><a href=\"#add\" class=\"headerlink\" title=\"add\"></a>add</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public &lt;T&gt; Request&lt;T&gt; add(Request&lt;T&gt; request) {</span><br><span class=\"line\">        // Tag the request as belonging to this queue and add it to the set of current requests.</span><br><span class=\"line\">        request.setRequestQueue(this);</span><br><span class=\"line\">        synchronized (mCurrentRequests) {</span><br><span class=\"line\">            mCurrentRequests.add(request);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        // Process requests in the order they are added.</span><br><span class=\"line\">        request.setSequence(getSequenceNumber());</span><br><span class=\"line\">        request.addMarker(&quot;add-to-queue&quot;);</span><br><span class=\"line\">        // If the request is uncacheable, skip the cache queue and go straight to the network.</span><br><span class=\"line\">        if (!request.shouldCache()) {</span><br><span class=\"line\">            mNetworkQueue.add(request);</span><br><span class=\"line\">            return request;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        // Insert request into stage if there&apos;s already a request with the same cache key in flight.</span><br><span class=\"line\">        synchronized (mWaitingRequests) {</span><br><span class=\"line\">            String cacheKey = request.getCacheKey();</span><br><span class=\"line\">            if (mWaitingRequests.containsKey(cacheKey)) {</span><br><span class=\"line\">                // There is already a request in flight. Queue up.</span><br><span class=\"line\">                Queue&lt;Request&lt;?&gt;&gt; stagedRequests = mWaitingRequests.get(cacheKey);</span><br><span class=\"line\">                if (stagedRequests == null) {</span><br><span class=\"line\">                    stagedRequests = new LinkedList&lt;Request&lt;?&gt;&gt;();</span><br><span class=\"line\">                }</span><br><span class=\"line\">                stagedRequests.add(request);</span><br><span class=\"line\">                mWaitingRequests.put(cacheKey, stagedRequests);</span><br><span class=\"line\">                if (VolleyLog.DEBUG) {</span><br><span class=\"line\">                    VolleyLog.v(&quot;Request for cacheKey=%s is in flight, putting on hold.&quot;, cacheKey);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                // Insert &apos;null&apos; queue for this cacheKey, indicating there is now a request in</span><br><span class=\"line\">                // flight.</span><br><span class=\"line\">                mWaitingRequests.put(cacheKey, null);</span><br><span class=\"line\">                mCacheQueue.add(request);</span><br><span class=\"line\">            }</span><br><span class=\"line\">            return request;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x7ED3;&#x5408;&#x4EE3;&#x7801;&#x4E0E;&#x524D;&#x9762;&#x7684;&#x56FE;&#xFF0C;&#x9996;&#x5148;&#x4F1A;&#x4E3A;&#x5F53;&#x524D;&#x7684;<code>request</code>&#x8BBE;&#x7F6E;<code>RequestQueue</code>,&#x5E76;&#x4E14;&#x6839;&#x636E;&#x60C5;&#x51B5;&#x540C;&#x6B65;&#x662F;&#x5426;&#x662F;&#x5F53;&#x524D;&#x6B63;&#x5728;&#x8FDB;&#x884C;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x52A0;&#x5165;&#x5230;<code>mCurrentRequests</code>&#x4E2D;&#xFF0C;&#x770B;<code>11</code>&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x4E4B;&#x540E;&#x5BF9;&#x5F53;&#x524D;<code>request</code>&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x662F;&#x5426;&#x9700;&#x8981;&#x7F13;&#x5B58;&#xFF08;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x662F;<code>true</code>&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x53EF;&#x8C03;&#x7528;<code>request.setShouldCache()</code>&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;&#xFF09;,&#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x5219;&#x76F4;&#x63A5;&#x52A0;&#x5165;&#x5230;&#x524D;&#x9762;&#x7684;<code>mNetworkQueue</code>&#x4E2D;&#xFF0C;&#x5B83;&#x4F1A;&#x5728;<code>CacheDispatcher</code>&#x4E0E;<code>NetworkDispatcher</code>&#x4E2D;&#x505A;&#x76F8;&#x5E94;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x7136;&#x540E;&#x8FD4;&#x56DE;<code>request</code>&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x7F13;&#x5B58;&#xFF0C;&#x770B;16&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x5219;&#x5BF9;<code>mWaitingRequests</code>&#x4E2D;&#x662F;&#x5426;&#x5305;&#x542B;<code>cacheKey</code>&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x5904;&#x7406;&#x3002;&#x5176;&#x4E2D;<code>cacheKey</code>&#x4E3A;&#x8BF7;&#x6C42;&#x7684;<code>url</code>&#x3002;&#x6700;&#x540E;&#x518D;&#x52A0;&#x5165;&#x5230;&#x7F13;&#x5B58;&#x961F;&#x5217;<code>mCacheQueue</code>&#x4E2D;&#x3002;</p>\n<h2 id=\"finish\"><a href=\"#finish\" class=\"headerlink\" title=\"finish\"></a>finish</h2><p>&#x7EC6;&#x5FC3;&#x7684;&#x4EBA;&#x4F1A;&#x53D1;&#x73B0;&#x5F53;&#x5BF9;&#x5E94;<code>cacheKey</code>&#x7684;<code>value</code>&#x4E0D;&#x4E3A;&#x7A7A;&#x65F6;&#xFF0C;&#x521B;&#x5EFA;&#x4E86;<code>LinkedList</code>&#x5373;<code>Queue</code>,&#x53EA;&#x662F;&#x5C06;<code>request</code>&#x52A0;&#x5165;&#x5230;&#x4E86;<code>Queue</code>&#x4E2D;&#xFF0C;&#x53EA;&#x662F;&#x66F4;&#x65B0;&#x4E86;<code>mWaitingRequests</code>&#x4E2D;&#x76F8;&#x5E94;&#x7684;<code>value</code>&#x4F46;&#x5E76;&#x6CA1;&#x6709;&#x52A0;&#x5165;&#x5230;<code>mCacheQueue</code>&#x4E2D;&#x3002;&#x5176;&#x5B9E;&#x4E0D;&#x7136;&#xFF0C;&#x56E0;&#x4E3A;&#x540E;&#x7EED;&#x4F1A;&#x8C03;&#x7528;<code>finish</code>&#x65B9;&#x6CD5;,&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x6E90;&#x7801;:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;T&gt; void finish(Request&lt;T&gt; request) {</span><br><span class=\"line\">        // Remove from the set of requests currently being processed.</span><br><span class=\"line\">        synchronized (mCurrentRequests) {</span><br><span class=\"line\">            mCurrentRequests.remove(request);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        synchronized (mFinishedListeners) {</span><br><span class=\"line\">          for (RequestFinishedListener&lt;T&gt; listener : mFinishedListeners) {</span><br><span class=\"line\">            listener.onRequestFinished(request);</span><br><span class=\"line\">          }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        if (request.shouldCache()) {</span><br><span class=\"line\">            synchronized (mWaitingRequests) {</span><br><span class=\"line\">                String cacheKey = request.getCacheKey();</span><br><span class=\"line\">                Queue&lt;Request&lt;?&gt;&gt; waitingRequests = mWaitingRequests.remove(cacheKey);</span><br><span class=\"line\">                if (waitingRequests != null) {</span><br><span class=\"line\">                    if (VolleyLog.DEBUG) {</span><br><span class=\"line\">                        VolleyLog.v(&quot;Releasing %d waiting requests for cacheKey=%s.&quot;,</span><br><span class=\"line\">                                waitingRequests.size(), cacheKey);</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                    // Process all queued up requests. They won&apos;t be considered as in flight, but</span><br><span class=\"line\">                    // that&apos;s not a problem as the cache has been primed by &apos;request&apos;.</span><br><span class=\"line\">                    mCacheQueue.addAll(waitingRequests);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x770B;<code>14</code>&#x3001;<code>22</code>&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x6B63;&#x5982;&#x4E0A;&#x9762;&#x6211;&#x6240;&#x8BF4;&#xFF0C;&#x4F1A;&#x5C06;<code>Queue</code>&#x4E2D;&#x7684;<code>request</code>&#x5168;&#x90E8;&#x52A0;&#x5165;&#x5230;<code>mCacheQueue</code>&#x4E2D;&#x3002;<br>&#x597D;&#x4E86;<code>RequestQueue</code>&#x7684;&#x4E3B;&#x8981;&#x6E90;&#x7801;&#x5DEE;&#x4E0D;&#x591A;&#x5C31;&#x8FD9;&#x4E9B;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x8FDB;&#x5165;<code>CacheDispatcher</code>&#x7684;&#x6E90;&#x7801;&#x5206;&#x6790;,&#x770B;&#x5B83;&#x7A76;&#x7ADF;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#x5462;&#xFF1F;</p>\n<h1 id=\"CacheDispatcher\"><a href=\"#CacheDispatcher\" class=\"headerlink\" title=\"CacheDispatcher\"></a>CacheDispatcher</h1><p>&#x524D;&#x9762;&#x63D0;&#x5230;&#x4E86;&#x5B83;&#x4E0E;<code>NetworkDispatcher</code>&#x672C;&#x8D28;&#x90FD;&#x662F;<code>Thread</code>&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x81EA;&#x7136;&#x662F;&#x770B;<code>run</code>&#x65B9;&#x6CD5;</p>\n<h2 id=\"run\"><a href=\"#run\" class=\"headerlink\" title=\"run\"></a>run</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    public void run() {</span><br><span class=\"line\">        if (DEBUG) VolleyLog.v(&quot;start new dispatcher&quot;);</span><br><span class=\"line\">                Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);</span><br><span class=\"line\">        </span><br><span class=\"line\">        // Make a blocking call to initialize the cache.</span><br><span class=\"line\">        mCache.initialize();</span><br><span class=\"line\">                </span><br><span class=\"line\">        while (true) {</span><br><span class=\"line\">            try {</span><br><span class=\"line\">                // Get a request from the cache triage queue, blocking until</span><br><span class=\"line\">                // at least one is available.</span><br><span class=\"line\">                final Request&lt;?&gt; request = mCacheQueue.take();</span><br><span class=\"line\">                request.addMarker(&quot;cache-queue-take&quot;);</span><br><span class=\"line\">                </span><br><span class=\"line\">                // If the request has been canceled, don&apos;t bother dispatching it.</span><br><span class=\"line\">                if (request.isCanceled()) {</span><br><span class=\"line\">                    request.finish(&quot;cache-discard-canceled&quot;);</span><br><span class=\"line\">                    continue;</span><br><span class=\"line\">                }</span><br><span class=\"line\">                </span><br><span class=\"line\">                // Attempt to retrieve this item from cache.</span><br><span class=\"line\">                Cache.Entry entry = mCache.get(request.getCacheKey());</span><br><span class=\"line\">                if (entry == null) {</span><br><span class=\"line\">                    request.addMarker(&quot;cache-miss&quot;);</span><br><span class=\"line\">                    // Cache miss; send off to the network dispatcher.</span><br><span class=\"line\">                    mNetworkQueue.put(request);</span><br><span class=\"line\">                    continue;</span><br><span class=\"line\">                }</span><br><span class=\"line\">                </span><br><span class=\"line\">                // If it is completely expired, just send it to the network.</span><br><span class=\"line\">                if (entry.isExpired()) {</span><br><span class=\"line\">                    request.addMarker(&quot;cache-hit-expired&quot;);</span><br><span class=\"line\">                    request.setCacheEntry(entry);</span><br><span class=\"line\">                    mNetworkQueue.put(request);</span><br><span class=\"line\">                    continue;</span><br><span class=\"line\">                }</span><br><span class=\"line\">                </span><br><span class=\"line\">                // We have a cache hit; parse its data for delivery back to the request.</span><br><span class=\"line\">                request.addMarker(&quot;cache-hit&quot;);</span><br><span class=\"line\">                Response&lt;?&gt; response = request.parseNetworkResponse(</span><br><span class=\"line\">                        new NetworkResponse(entry.data, entry.responseHeaders));</span><br><span class=\"line\">                request.addMarker(&quot;cache-hit-parsed&quot;);</span><br><span class=\"line\">                    </span><br><span class=\"line\">                if (!entry.refreshNeeded()) {</span><br><span class=\"line\">                    // Completely unexpired cache hit. Just deliver the response.</span><br><span class=\"line\">                    mDelivery.postResponse(request, response);</span><br><span class=\"line\">                } else {</span><br><span class=\"line\">                    // Soft-expired cache hit. We can deliver the cached response,</span><br><span class=\"line\">                    // but we need to also send the request to the network for</span><br><span class=\"line\">                    // refreshing.</span><br><span class=\"line\">                    request.addMarker(&quot;cache-hit-refresh-needed&quot;);</span><br><span class=\"line\">                    request.setCacheEntry(entry);</span><br><span class=\"line\">                    </span><br><span class=\"line\">                    // Mark the response as intermediate.</span><br><span class=\"line\">                    response.intermediate = true;</span><br><span class=\"line\">             </span><br><span class=\"line\">                    // Post the intermediate response back to the user and have</span><br><span class=\"line\">                    // the delivery then forward the request along to the network.</span><br><span class=\"line\">                    mDelivery.postResponse(request, response, new Runnable() {</span><br><span class=\"line\">                        @Override</span><br><span class=\"line\">                        public void run() {</span><br><span class=\"line\">                            try {</span><br><span class=\"line\">                                                                            mNetworkQueue.put(request);</span><br><span class=\"line\">                            } catch (InterruptedException e) {</span><br><span class=\"line\">                                // Not much we can do about this.</span><br><span class=\"line\">                            }</span><br><span class=\"line\">                        }</span><br><span class=\"line\">                    });</span><br><span class=\"line\">                }</span><br><span class=\"line\">                                                                                          </span><br><span class=\"line\">            } catch (InterruptedException e) {</span><br><span class=\"line\">                // We may have been interrupted because it was time to quit.</span><br><span class=\"line\">                if (mQuit) {</span><br><span class=\"line\">                    return;</span><br><span class=\"line\">                }</span><br><span class=\"line\">                continue;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x770B;&#x8D77;&#x6765;&#x5F88;&#x591A;&#xFF0C;&#x6211;&#x4EEC;&#x7ED3;&#x5408;&#x56FE;&#x6765;&#x6311;&#x4E3B;&#x8981;&#x7684;&#x770B;&#x3002;&#x9996;&#x5148;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#x4E00;&#x76F4;&#x5728;&#x76D1;&#x89C6;&#x7740;<code>request</code>&#x7684;&#x53D8;&#x5316;&#x3002;&#x4ECE;&#x7F13;&#x5B58;&#x961F;&#x5217;<code>mCacheQueue</code>&#x4E2D;&#x83B7;&#x53D6;<code>request</code>,&#x5982;&#x679C;&#x8BE5;&#x8BF7;&#x6C42;&#x662F;<code>cancle</code>&#x4E86;&#xFF0C;&#x8C03;&#x7528;<code>request.finish()</code>&#x6E05;&#x9664;&#x76F8;&#x5E94;&#x6570;&#x636E;&#x5E76;&#x8FDB;&#x884C;&#x4E0B;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5426;&#x5219;&#x4ECE;&#x524D;&#x9762;&#x63D0;&#x5230;&#x7684;<code>mCache</code>&#x4E2D;&#x83B7;&#x53D6;<code>Cache.Entry</code>&#x3002;&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#x6216;&#x8005;&#x5DF2;&#x7ECF;&#x8FC7;&#x671F;&#xFF0C;&#x5C06;&#x8BF7;&#x6C42;&#x52A0;&#x5165;&#x5230;&#x7F51;&#x7EDC;&#x961F;&#x5217;&#x4E2D;<code>mNetWorkQueue</code>&#xFF0C;&#x8FDB;&#x884C;&#x540E;&#x7EED;&#x7684;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x3002;&#x5982;&#x679C;&#x5B58;&#x5728;&#xFF08;<code>41</code>&#x884C;&#x4EE3;&#x7801;&#xFF09;&#x5219;&#x8FDB;&#x884C;<code>request.parseNetworkResponse()</code>&#x89E3;&#x6790;&#x51FA;<code>response</code>,&#x4E0D;&#x540C;&#x7684;<code>request</code>&#x5BF9;&#x5E94;&#x4E0D;&#x540C;&#x7684;&#x89E3;&#x6790;&#x65B9;&#x6CD5;&#x3002;&#x4F8B;&#x5982;<code>StringRequest</code>&#x4E0E;<code>JsonObjectRequest</code>&#x6709;&#x5404;&#x81EA;&#x7684;&#x89E3;&#x6790;&#x5B9E;&#x73B0;&#x3002;&#x518D;&#x770B;<code>45</code>&#x884C;&#xFF0C;&#x53D1;&#x73B0;&#x4E0D;&#x7BA1;<code>entry</code>&#x662F;&#x5426;&#x9700;&#x8981;&#x66F4;&#x65B0;&#x7684;&#xFF0C;&#x90FD;&#x4F1A;&#x8FDB;&#x4E00;&#x6B65;&#x5BF9;<code>response</code>&#x8FDB;&#x884C;<code>mDelivery.postResponse(request, response)</code>&#x9012;&#x9001;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x9700;&#x8981;&#x66F4;&#x65B0;&#x7684;&#x8BDD;&#x91CD;&#x65B0;&#x8BBE;&#x7F6E;<code>request</code>&#x7684;<code>entry</code>&#x4E0E;&#x52A0;&#x5165;&#x5230;<code>mNetworkQueue</code>&#x4E2D;&#xFF0C;&#x4E5F;&#x5C31;&#x76F8;&#x5F53;&#x4E0E;&#x91CD;&#x65B0;&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x4E00;&#x904D;&#x3002;&#x90A3;&#x4E48;&#x518D;&#x56DE;&#x5230;&#x9012;&#x9001;&#x7684;&#x9636;&#x6BB5;&#xFF0C;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x63D0;&#x5230;&#x5728;&#x521B;&#x5EFA;<code>RequestQueue</code>&#x662F;&#x5B9E;&#x73B0;&#x4E86;<code>ExecutorDelivery</code>,<code>mDelivery.postResponse</code>&#x5C31;&#x662F;&#x5176;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x4E0B;</p>\n<h2 id=\"ExecutorDelivery\"><a href=\"#ExecutorDelivery\" class=\"headerlink\" title=\"ExecutorDelivery\"></a>ExecutorDelivery</h2><p>&#x5728;&#x8FD9;&#x91CC;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;<code>Executor</code>&#xFF0C;&#x5BF9;&#x540E;&#x9762;&#x8FDB;&#x884C;&#x9012;&#x9001;,&#x4F5C;&#x7528;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public ExecutorDelivery(final Handler handler) {</span><br><span class=\"line\">        // Make an Executor that just wraps the handler.</span><br><span class=\"line\">        mResponsePoster = new Executor() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void execute(Runnable command) {</span><br><span class=\"line\">                handler.post(command);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        };</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"postResponse\"><a href=\"#postResponse\" class=\"headerlink\" title=\"postResponse\"></a>postResponse</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    public void postResponse(Request&lt;?&gt; request, Response&lt;?&gt; response) {</span><br><span class=\"line\">        postResponse(request, response, null);</span><br><span class=\"line\">    }</span><br><span class=\"line\"> </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void postResponse(Request&lt;?&gt; request, Response&lt;?&gt; response, Runnable runnable) {</span><br><span class=\"line\">        request.markDelivered();</span><br><span class=\"line\">        request.addMarker(&quot;post-response&quot;);</span><br><span class=\"line\">        mResponsePoster.execute(new ResponseDeliveryRunnable(request, response, runnable));</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5C31;&#x7B80;&#x5355;&#x4E86;&#x5C31;&#x662F;&#x8C03;&#x7528;<code>execute</code>&#x8FDB;&#x884C;&#x6267;&#x884C;&#xFF0C;&#x5728;&#x8FDB;&#x5165;<code>ResponseDeliveryRunnable</code>&#x7684;<code>run</code>&#x770B;&#x5B83;&#x5982;&#x4F55;&#x6267;&#x884C;</p>\n<h3 id=\"ResponseDeliveryRunnable\"><a href=\"#ResponseDeliveryRunnable\" class=\"headerlink\" title=\"ResponseDeliveryRunnable\"></a>ResponseDeliveryRunnable</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void run() {</span><br><span class=\"line\">            // If this request has canceled, finish it and don&apos;t deliver.</span><br><span class=\"line\">            if (mRequest.isCanceled()) {</span><br><span class=\"line\">                mRequest.finish(&quot;canceled-at-delivery&quot;);</span><br><span class=\"line\">                return;</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            // Deliver a normal response or error, depending.</span><br><span class=\"line\">            if (mResponse.isSuccess()) {</span><br><span class=\"line\">                 mRequest.deliverResponse(mResponse.result);</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                mRequest.deliverError(mResponse.error);</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            // If this is an intermediate response, add a marker, otherwise we&apos;re done</span><br><span class=\"line\">            // and the request can be finished.</span><br><span class=\"line\">            if (mResponse.intermediate) {</span><br><span class=\"line\">                mRequest.addMarker(&quot;intermediate-response&quot;);</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                mRequest.finish(&quot;done&quot;);</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            // If we have been provided a post-delivery runnable, run it.</span><br><span class=\"line\">            if (mRunnable != null) {</span><br><span class=\"line\">                mRunnable.run();</span><br><span class=\"line\">            }</span><br><span class=\"line\">       }</span><br></pre></td></tr></table></figure>\n<p>&#x4E3B;&#x8981;&#x662F;&#x7B2C;<code>9</code>&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x54CD;&#x5E94;&#x505A;&#x4E0D;&#x540C;&#x7684;&#x9012;&#x9001;&#xFF0C;<code>deliverResponse</code>&#x4E0E;<code>deliverError</code>&#x5185;&#x90E8;&#x5206;&#x522B;&#x8C03;&#x7528;&#x7684;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x975E;&#x5E38;&#x719F;&#x6089;&#x7684;<code>Listener</code>&#x4E2D;&#x7684;<code>onResponse</code>&#x4E0E;<code>onErrorResponse</code>&#x65B9;&#x6CD5;&#xFF0C;&#x8FDB;&#x800C;&#x8FD4;&#x56DE;&#x5230;&#x6211;&#x4EEC;&#x5BF9;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x7ED3;&#x679C;&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;&#x3002;</p>\n<p>&#x8FD9;&#x5C31;&#x662F;&#x6574;&#x4E2A;&#x7684;&#x7F13;&#x5B58;&#x6D3E;&#x9063;&#xFF0C;&#x7B80;&#x800C;&#x8A00;&#x4E4B;&#xFF0C;&#x5B58;&#x5728;&#x8BF7;&#x6C42;&#x54CD;&#x5E94;&#x7684;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x5C31;&#x4E0D;&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x7F13;&#x5B58;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5206;&#x53D1;&#x9012;&#x9001;&#x3002;&#x53CD;&#x4E4B;&#x6267;&#x884C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x3002;<br>&#x4E0B;&#x9762;&#x6211;&#x6765;&#x770B;&#x4E0B;<code>NetworkDispatcher</code>&#x662F;&#x5982;&#x4F55;&#x5904;&#x7406;&#x7684;</p>\n<h1 id=\"NetworkDispatcher\"><a href=\"#NetworkDispatcher\" class=\"headerlink\" title=\"NetworkDispatcher\"></a>NetworkDispatcher</h1><h2 id=\"run-1\"><a href=\"#run-1\" class=\"headerlink\" title=\"run\"></a>run</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    public void run() {</span><br><span class=\"line\">         Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);</span><br><span class=\"line\">        while (true) {</span><br><span class=\"line\">            long startTimeMs = SystemClock.elapsedRealtime();</span><br><span class=\"line\">            Request&lt;?&gt; request;</span><br><span class=\"line\">            try {</span><br><span class=\"line\">                // Take a request from the queue.</span><br><span class=\"line\">                request = mQueue.take();</span><br><span class=\"line\">            } catch (InterruptedException e) {</span><br><span class=\"line\">                // We may have been interrupted because it was time to quit.</span><br><span class=\"line\">                if (mQuit) {</span><br><span class=\"line\">                    return;</span><br><span class=\"line\">                }</span><br><span class=\"line\">                continue;</span><br><span class=\"line\">            }</span><br><span class=\"line\"> </span><br><span class=\"line\">            try {</span><br><span class=\"line\">                request.addMarker(&quot;network-queue-take&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">                // If the request was cancelled already, do not perform the</span><br><span class=\"line\">                // network request.</span><br><span class=\"line\">                if (request.isCanceled()) {</span><br><span class=\"line\">                    request.finish(&quot;network-discard-cancelled&quot;);</span><br><span class=\"line\">                    continue;</span><br><span class=\"line\">                }</span><br><span class=\"line\"> </span><br><span class=\"line\">                addTrafficStatsTag(request);</span><br><span class=\"line\"> </span><br><span class=\"line\">                // Perform the network request.</span><br><span class=\"line\">                NetworkResponse networkResponse = mNetwork.performRequest(request);</span><br><span class=\"line\">                request.addMarker(&quot;network-http-complete&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">                // If the server returned 304 AND we delivered a response already,</span><br><span class=\"line\">                // we&apos;re done -- don&apos;t deliver a second identical response.</span><br><span class=\"line\">                if (networkResponse.notModified &amp;&amp; request.hasHadResponseDelivered()) {</span><br><span class=\"line\">                    request.finish(&quot;not-modified&quot;);</span><br><span class=\"line\">                    continue;</span><br><span class=\"line\">                }</span><br><span class=\"line\"> </span><br><span class=\"line\">                // Parse the response here on the worker thread.</span><br><span class=\"line\">                Response&lt;?&gt; response = request.parseNetworkResponse(networkResponse);</span><br><span class=\"line\">                request.addMarker(&quot;network-parse-complete&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">                // Write to cache if applicable.</span><br><span class=\"line\">                // TODO: Only update cache metadata instead of entire record for 304s.</span><br><span class=\"line\">                if (request.shouldCache() &amp;&amp; response.cacheEntry != null) {</span><br><span class=\"line\">                     mCache.put(request.getCacheKey(), response.cacheEntry);</span><br><span class=\"line\">                    request.addMarker(&quot;network-cache-written&quot;);</span><br><span class=\"line\">                }</span><br><span class=\"line\"> </span><br><span class=\"line\">                // Post the response back.</span><br><span class=\"line\">                request.markDelivered();</span><br><span class=\"line\">                mDelivery.postResponse(request, response);</span><br><span class=\"line\">            } catch (VolleyError volleyError) {</span><br><span class=\"line\">                 volleyError.setNetworkTimeMs(SystemClock.elapsedRealtime() - startTimeMs);</span><br><span class=\"line\">                parseAndDeliverNetworkError(request, volleyError);</span><br><span class=\"line\">            } catch (Exception e) {</span><br><span class=\"line\">                VolleyLog.e(e, &quot;Unhandled exception %s&quot;, e.toString());</span><br><span class=\"line\">                VolleyError volleyError = new VolleyError(e);</span><br><span class=\"line\">                 volleyError.setNetworkTimeMs(SystemClock.elapsedRealtime() - startTimeMs);</span><br><span class=\"line\">                mDelivery.postError(request, volleyError);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x4E5F;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#x7684;<code>while</code>,&#x540C;&#x6837;&#x4E5F;&#x662F;&#x5148;&#x83B7;&#x53D6;<code>request</code>&#xFF0C;&#x4E0D;&#x8FC7;&#x662F;&#x4ECE;<code>mQueue</code>&#x4E2D;&#xFF0C;&#x5373;&#x524D;&#x9762;&#x591A;&#x6B21;&#x51FA;&#x73B0;&#x7684;<code>mNetWorkQueue</code>,&#x901A;&#x8FC7;&#x770B;&#x4EE3;&#x7801;&#x53D1;&#x73B0;&#x4E00;&#x4E9B;&#x5B9E;&#x73B0;&#x8DDF;<code>CacheDispatcher</code>&#x4E2D;&#x7684;&#x7C7B;&#x4F3C;&#x3002;&#x4E5F;&#x6B63;&#x5982;&#x56FE;&#x7247;&#x4E2D;&#x6240;&#x5C55;&#x793A;&#x7684;&#x4E00;&#x6837;&#xFF0C;&#xFF08;<code>23</code>&#x884C;&#xFF09;&#x5982;&#x4F55;&#x8BF7;&#x6C42;&#x53D6;&#x6D88;&#x4E86;&#xFF0C;&#x76F4;&#x63A5;<code>finish</code>&#xFF1B;&#x5426;&#x5219;&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x8C03;&#x7528;(<code>31</code>&#x884C;)<code>mNetwork.performRequest(request)</code>&#xFF0C;&#x8FD9;&#x91CC;&#x7684;<code>mNetWork</code>&#x5373;&#x4E3A;&#x524D;&#x9762;<code>RequestQueue</code>&#x4E2D;&#x5BF9;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x8FDB;&#x884C;&#x9009;&#x62E9;&#x7684;<code>stack</code>&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x5206;&#x522B;&#x8C03;&#x7528;<code>HurlStack</code>&#x4E0E;<code>HttpClientStack</code>&#x5404;&#x81EA;&#x7684;<code>performRequest</code>&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x6784;&#x9020;&#x8BF7;&#x6C42;&#x5934;&#x4E0E;&#x53C2;&#x6570;&#x5206;&#x522B;&#x4F7F;&#x7528;<code>HttpClient</code>&#x6216;&#x8005;<code>HttpUrlConnection</code>&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x3002;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;<code>42</code>&#x884C;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x719F;&#x6089;&#xFF0C;&#x4E0E;<code>CacheDispatcher</code>&#x4E2D;&#x7684;&#x4E00;&#x6837;&#x8FDB;&#x884C;<code>response</code>&#x8FDB;&#x884C;&#x89E3;&#x6790;&#xFF0C;&#x7136;&#x540E;&#x5982;&#x679C;&#x9700;&#x8981;&#x7F13;&#x5B58;&#x5C31;&#x52A0;&#x5165;&#x5230;&#x7F13;&#x5B58;&#x4E2D;&#xFF0C;&#x6700;&#x540E;&#xFF08;<code>54</code>&#x884C;&#xFF09;&#x518D;&#x8C03;&#x7528;<code>mDelivery.postResponse(request, response)</code>&#x8FDB;&#x884C;&#x9012;&#x9001;&#x3002;&#x81F3;&#x4E8E;&#x540E;&#x9762;&#x7684;&#x5269;&#x4F59;&#x7684;&#x6B65;&#x9AA4;&#x4E0E;<code>CacheDispatcher</code>&#x4E2D;&#x7684;&#x4E00;&#x6A21;&#x4E00;&#x6837;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x591A;&#x7D2F;&#x8D58;&#x4E86;&#x3002;</p>\n<blockquote>\n<p><em>&#x597D;&#x4E86;&#xFF0C;<code>Volley</code>&#x7684;&#x6E90;&#x7801;&#x89E3;&#x6790;&#x5148;&#x5C31;&#x5230;&#x8FD9;&#x91CC;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x56DE;&#x8FC7;&#x53BB;&#x770B;&#x90A3;&#x5F20;&#x56FE;&#x662F;&#x4E0D;&#x662F;&#x611F;&#x89C9;&#x5F88;&#x6E05;&#x6670;&#x4E86;&#x5462;?</em></p>\n</blockquote>\n<h1 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h1><p>&#x6211;&#x4EEC;&#x6765;&#x5BF9;&#x4F7F;&#x7528;<code>Volley</code>&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x505A;&#x4E2A;&#x603B;&#x7ED3;</p>\n<ul>\n<li>&#x901A;&#x8FC7;<code>newRequestQueue</code>&#x521D;&#x59CB;&#x5316;&#x4E0E;&#x6784;&#x9020;<code>RequestQueue</code></li>\n<li>&#x8C03;&#x7528;<code>RequestQueue</code>&#x4E2D;&#x7684;<code>add</code>&#x65B9;&#x6CD5;&#x6DFB;&#x52A0;<code>request</code>&#x5230;&#x8BF7;&#x6C42;&#x961F;&#x5217;&#x4E2D;</li>\n<li>&#x7F13;&#x5B58;&#x6D3E;&#x9063;&#xFF0C;&#x5148;&#x8FDB;&#x884C;<code>CacheDispatcher</code>,&#x5224;&#x65AD;&#x7F13;&#x5B58;&#x4E2D;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x6709;&#x5219;&#x89E3;&#x6790;<code>response</code>&#xFF0C;&#x518D;&#x76F4;&#x63A5;<code>postResponse</code>&#x9012;&#x9001;&#xFF0C;&#x5426;&#x5219;&#x8FDB;&#x884C;&#x540E;&#x7EED;&#x7684;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;</li>\n<li>&#x7F51;&#x7EDC;&#x6D3E;&#x9063;&#xFF0C;<code>NetworkDispatcher</code>&#x4E2D;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;<code>request</code>&#x8BF7;&#x6C42;&#xFF0C;&#x89E3;&#x6790;<code>response</code>&#x5982;&#x8BBE;&#x7F6E;&#x4E86;&#x7F13;&#x5B58;&#x5C31;&#x5C06;&#x7ED3;&#x679C;&#x4FDD;&#x5B58;&#x5230;<code>cache</code>&#x4E2D;&#xFF0C;&#x518D;&#x8FDB;&#x884C;&#x6700;&#x540E;&#x7684;<code>postResponse</code>&#x9012;&#x9001;&#x3002;</li>\n</ul>\n","categories":["android"],"tags":["源码分析"]},{"title":"AIDL入门","url":"https://www.rousetime.com/2016/09/25/AIDL入门/","content":"<p>&#x4E00;&#x76F4;&#x542C;&#x8BF4;<code>AIDL</code>&#x4F46;&#x662F;&#x81EA;&#x5DF1;&#x8FD8;&#x6CA1;&#x6709;&#x771F;&#x6B63;&#x4F7F;&#x7528;&#x8FC7;&#xFF0C;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x78B0;&#x5230;&#x8FC7;&#x4F7F;&#x7528;&#x5B83;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x4F46;&#x8FD9;&#x5E76;&#x4E0D;&#x80FD;&#x6210;&#x4E3A;&#x6211;&#x4E0D;&#x53BB;&#x4E86;&#x89E3;&#x5B83;&#x7684;&#x501F;&#x53E3;&#x3002;&#x73B0;&#x5728;&#x8FD8;&#x6CA1;&#x6709;&#x4E86;&#x89E3;&#x7684;&#x53EF;&#x4EE5;&#x548C;&#x6211;&#x4E00;&#x8D77;&#x8FDB;&#x884C;&#x4E86;&#x89E3;&#xFF08;&#x4EC5;&#x9650;&#x4E8E;&#x5165;&#x95E8;&#xFF0C;&#x5927;&#x795E;&#x53EF;&#x4EE5;&#x79FB;&#x6B65;&#x4E86;&#xFF09;</p>\n<h2 id=\"&#x4EC0;&#x4E48;&#x662F;AIDL\"><a href=\"#&#x4EC0;&#x4E48;&#x662F;AIDL\" class=\"headerlink\" title=\"&#x4EC0;&#x4E48;&#x662F;AIDL\"></a>&#x4EC0;&#x4E48;&#x662F;AIDL</h2><p>&#x4EC0;&#x4E48;&#x662F;AIDL&#x5462;&#xFF1F;&#x5B83;&#x7684;&#x5168;&#x79F0;&#x662F;<code>Android Interface Definition Language</code>,&#x4E2D;&#x6587;&#x540D;&#x5B57;&#x5C31;&#x662F;<code>Android</code>&#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x8BED;&#x8A00;&#x3002;<code>Android</code>&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;&#x95F4;&#x4E0D;&#x80FD;&#x8FDB;&#x884C;&#x5185;&#x5B58;&#x5171;&#x4EAB;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x540C;&#x7684;&#x8FDB;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#xFF0C;<code>Android</code>&#x91C7;&#x7528;&#x8FDC;&#x7A0B;&#x8FC7;&#x7A0B;&#x8C03;&#x5EA6;&#xFF0C;&#x540C;&#x65F6;&#x4F7F;&#x7528;&#x4E00;&#x79CD;&#x5B9A;&#x4E49;&#x63A5;&#x53E3;&#x4E0E;&#x516C;&#x5F00;&#x63A5;&#x53E3;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x5B9E;&#x73B0;&#x3002;&#x4ECE;&#x800C;&#x8FBE;&#x5230;&#x8DE8;&#x8FDB;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x65B9;&#x5F0F;&#x6210;&#x4E3A;AIDL&#x3002;</p>\n<h2 id=\"&#x5B9E;&#x73B0;AIDL&#x7684;&#x6B65;&#x9AA4;\"><a href=\"#&#x5B9E;&#x73B0;AIDL&#x7684;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;AIDL&#x7684;&#x6B65;&#x9AA4;\"></a>&#x5B9E;&#x73B0;AIDL&#x7684;&#x6B65;&#x9AA4;</h2><p>&#x603B;&#x4F53;&#x6765;&#x8BF4;&#x6211;&#x628A;&#x5176;&#x5206;&#x4E3A;3&#x4E2A;&#x6B65;&#x9AA4;</p>\n<ul>\n<li>&#x521B;&#x5EFA;&#x76F8;&#x5E94;&#x7684;<code>.aidl</code>&#x6587;&#x4EF6;&#xFF0C;&#x4E0E;&#x9700;&#x8981;&#x7684;&#x63A5;&#x53E3;</li>\n<li>&#x5B9E;&#x73B0;&#x521B;&#x5EFA;&#x7684;&#x63A5;&#x53E3;</li>\n<li>&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x66B4;&#x9732;&#x5B9E;&#x73B0;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x5B9E;&#x73B0;&#x8C03;&#x7528;</li>\n</ul>\n<p>&#x4E0B;&#x9762;&#x6765;&#x8BE6;&#x7EC6;&#x7684;&#x8BF4;&#x8BF4;&#x5404;&#x4E2A;&#x6B65;&#x9AA4;&#x7684;&#x5B9E;&#x73B0;</p>\n<h2 id=\"&#x521B;&#x5EFA;-aidl&#x6587;&#x4EF6;&#x4E0E;&#x63A5;&#x53E3;\"><a href=\"#&#x521B;&#x5EFA;-aidl&#x6587;&#x4EF6;&#x4E0E;&#x63A5;&#x53E3;\" class=\"headerlink\" title=\"&#x521B;&#x5EFA;.aidl&#x6587;&#x4EF6;&#x4E0E;&#x63A5;&#x53E3;\"></a>&#x521B;&#x5EFA;.aidl&#x6587;&#x4EF6;&#x4E0E;&#x63A5;&#x53E3;</h2><p>&#x5728;<code>Android Studio</code>&#x4E2D;&#x65B0;&#x5EFA;&#x9879;&#x76EE;&#xFF0C;&#x5728;&#x9879;&#x76EE;&#x7684;<code>src</code>&#x76EE;&#x5F55;&#x4E0B;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;<code>.aidl</code>&#x6587;&#x4EF6;</p>\n<p><img src=\"/2016/09/25/AIDL&#x5165;&#x95E8;/1.png\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p>&#x8FD9;&#x4E2A;&#x65B0;&#x5EFA;&#x7684;<code>.aidl</code>&#x6587;&#x4EF6;&#x662F;&#x5B9A;&#x4E49;&#x8FDC;&#x7A0B;&#x8FDB;&#x7A0B;&#x6240;&#x4EE5;&#x66B4;&#x9732;&#x7684;&#x63A5;&#x53E3;,&#x6211;&#x8FD9;&#x91CC;&#x547D;&#x540D;&#x4E3A;<code>IRemoteService</code>&#x3002;&#x521B;&#x5EFA;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x5728;<code>src/main/aidl</code>&#x4E2D;&#x627E;&#x5230;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x6211;&#x4EEC;&#x66B4;&#x9732;&#x4E00;&#x4E2A;<code>sayHello</code>&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x7684;&#x7C7B;&#x578B;&#x662F;<code>HelloMessage</code>&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// IRemoteService.aidl</span><br><span class=\"line\">package com.idisfkj.aidldemo;</span><br><span class=\"line\"></span><br><span class=\"line\">// Declare any non-default types here with import statements</span><br><span class=\"line\">import com.idisfkj.aidldemo.HelloMessage;</span><br><span class=\"line\">interface IRemoteService {</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Demonstrates some basic types that you can use as parameters</span><br><span class=\"line\">     * and return values in AIDL.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat,</span><br><span class=\"line\">            double aDouble, String aString);</span><br><span class=\"line\"></span><br><span class=\"line\">    HelloMessage sayHello();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6765;&#x521B;&#x5EFA;<code>HelloMessage</code>&#x7C7B;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x65E5;&#x5E38;&#x521B;&#x5EFA;&#x6587;&#x4EF6;&#x7684;<code>main/java</code>&#x4E2D;&#x521B;&#x5EFA;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.idisfkj.aidldemo;</span><br><span class=\"line\"></span><br><span class=\"line\">import android.os.Parcel;</span><br><span class=\"line\">import android.os.Parcelable;</span><br><span class=\"line\"></span><br><span class=\"line\">public class HelloMessage implements Parcelable{</span><br><span class=\"line\">    private String message;</span><br><span class=\"line\">    private int pId;</span><br><span class=\"line\"></span><br><span class=\"line\">    public HelloMessage(String message, int pId) {</span><br><span class=\"line\">        this.message = message;</span><br><span class=\"line\">        this.pId = pId;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    protected HelloMessage(Parcel in) {</span><br><span class=\"line\">        message = in.readString();</span><br><span class=\"line\">        pId = in.readInt();</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public static final Creator&lt;HelloMessage&gt; CREATOR = new Creator&lt;HelloMessage&gt;() {</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public HelloMessage createFromParcel(Parcel in) {</span><br><span class=\"line\">            return new HelloMessage(in);</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public HelloMessage[] newArray(int size) {</span><br><span class=\"line\">            return new HelloMessage[size];</span><br><span class=\"line\">        }</span><br><span class=\"line\">    };</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getMessage() {</span><br><span class=\"line\">        return message;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setMessage(String message) {</span><br><span class=\"line\">        this.message = message;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public int getpId() {</span><br><span class=\"line\">        return pId;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setpId(int pId) {</span><br><span class=\"line\">        this.pId = pId;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public int describeContents() {</span><br><span class=\"line\">        return 0;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void writeToParcel(Parcel parcel, int i) {</span><br><span class=\"line\">        parcel.writeString(message);</span><br><span class=\"line\">        parcel.writeInt(pId);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5B83;&#x5305;&#x62EC;&#x4E24;&#x4E2A;&#x5C5E;&#x6027;&#x5B57;&#x6BB5;<code>message</code>&#x4E0E;<code>pId</code>,&#x4EE3;&#x8868;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x8981;&#x4F20;&#x9012;&#x7684;&#x4FE1;&#x606F;&#x4E0E;&#x65B9;&#x4FBF;&#x67E5;&#x770B;&#x7684;&#x8FDB;&#x7A0B;<code>ID</code>&#x3002;&#x8FD9;&#x91CC;&#x5B9E;&#x73B0;&#x4E86;<code>Parcelable</code>&#x63A5;&#x53E3;&#xFF0C;&#x8FDB;&#x884C;&#x5E8F;&#x5217;&#x5316;&#x3002;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x5230;&#x4E86;<code>Parcelable</code>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8981;&#x56DE;&#x5230;<code>aidl</code>&#x76EE;&#x5F55;&#xFF0C;&#x518D;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x4E0E;<code>HelloMessage</code>&#x76F8;&#x540C;&#x540D;&#x5B57;&#x7684;<code>.aidl</code>&#x6587;&#x4EF6;&#xFF0C;&#x5185;&#x5BB9;&#x4E3A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// HelloMessage.aidl</span><br><span class=\"line\">package com.idisfkj.aidldemo;</span><br><span class=\"line\"></span><br><span class=\"line\">// Declare any non-default types here with import statements</span><br><span class=\"line\"></span><br><span class=\"line\">parcelable HelloMessage;</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x5728;&#x524D;&#x9762;&#x65B0;&#x5EFA;&#x7684;<code>IRemoteService.aidl</code>&#x6587;&#x4EF6;&#x4E2D;&#x5BFC;&#x5165;&#x8BE5;&#x7C7B;&#x578B;&#x7684;&#x5305;&#x3002;&#xFF08;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x524D;&#x9762;&#x8D34;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x5DF2;&#x7ECF;&#x5B9E;&#x73B0;&#x4E86;&#xFF09;&#xFF0C;&#x8FD9;&#x6837;&#x6240;&#x9700;&#x7684;<code>.aidl</code>&#x6587;&#x4EF6;&#x4E0E;&#x63A5;&#x53E3;&#x90FD;&#x5DF2;&#x7ECF;&#x5EFA;&#x597D;&#x4E86;&#xFF0C;&#x6700;&#x540E;&#x518D;<code>Build -&gt; Make Project</code>(&#x5982;&#x679C;&#x4F60;&#x662F;&#x5728;<code>Module</code>&#x4E2D;&#x5219;<code>Build -&gt; Make Module App</code>)&#x3002;&#x5B8C;&#x4E86;&#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x5C31;&#x80FD;&#x5728;<code>build/generated/source/aidl</code>&#x4E2D;&#x67E5;&#x770B;&#x751F;&#x6210;&#x7684;<code>IRemoteService</code>&#x3002;&#x6253;&#x5F00;&#x4E4B;&#x540E;&#x80FD;&#x770B;&#x5230;&#x5982;&#x4E0B;&#x4FE1;&#x606F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface IRemoteService extends android.os.IInterface</span><br><span class=\"line\">{</span><br><span class=\"line\">/** Local-side IPC implementation stub class. */</span><br><span class=\"line\">public static abstract class Stub extends android.os.Binder implements com.idisfkj.aidldemo.IRemoteService</span><br><span class=\"line\">{</span><br><span class=\"line\">private static final java.lang.String DESCRIPTOR = &quot;com.idisfkj.aidldemo.IRemoteService&quot;;</span><br><span class=\"line\">/** Construct the stub at attach it to the interface. */</span><br><span class=\"line\">public Stub()</span><br><span class=\"line\">{</span><br><span class=\"line\">this.attachInterface(this, DESCRIPTOR);</span><br><span class=\"line\">}</span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Cast an IBinder object into an com.idisfkj.aidldemo.IRemoteService interface,</span><br><span class=\"line\"> * generating a proxy if needed.</span><br><span class=\"line\"> */</span><br><span class=\"line\">public static com.idisfkj.aidldemo.IRemoteService asInterface(android.os.IBinder obj)</span><br><span class=\"line\">{</span><br><span class=\"line\"> //&#x7701;&#x7565;</span><br></pre></td></tr></table></figure>\n<p>&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x9759;&#x6001;&#x62BD;&#x8C61;&#x7C7B;<code>Stub</code>&#xFF0C;&#x5B83;&#x7EE7;&#x627F;&#x4E8E;<code>Binder</code>&#x540C;&#x65F6;&#x5B9E;&#x73B0;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x7684;<code>IRemoteService</code>&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>New IRemoteService.Stub()</code>&#x6765;&#x5B9E;&#x73B0;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x7684;&#x63A5;&#x53E3;,&#x540C;&#x65F6;&#x901A;&#x8FC7;<code>asInterface</code>&#x6765;&#x83B7;&#x53D6;&#x5176;&#x4EE3;&#x7406;&#xFF0C;&#x8C03;&#x7528;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x3002;</p>\n<h2 id=\"&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;\"><a href=\"#&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;\"></a>&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;</h2><p>&#x9996;&#x5148;&#x5EFA;&#x4E00;&#x4E2A;<code>Service</code>&#xFF0C;&#x901A;&#x8FC7;<code>Service</code>&#x7684;<code>onBind</code>&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x4F20;&#x9012;&#x7ED1;&#x5B9A;&#x7684;<code>IBinder</code>&#xFF0C;&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x8BF4;&#x4E86;<code>Stub</code>&#x7EE7;&#x627F;&#x4E0E;<code>Binder</code>&#x800C;<code>Binder</code>&#x5B9E;&#x73B0;&#x4E86;<code>IBinder</code>&#x63A5;&#x53E3;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>Stub</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class RemoteService extends Service {</span><br><span class=\"line\">    public RemoteService() {</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    IRemoteService.Stub mBinder = new IRemoteService.Stub() {</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat, double aDouble, String aString) throws RemoteException {</span><br><span class=\"line\"></span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public HelloMessage sayHello() throws RemoteException {</span><br><span class=\"line\">            return new HelloMessage(&quot;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;:&quot; + Thread.currentThread().toString() + &quot;\\n&quot;</span><br><span class=\"line\">                    + &quot;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;id:&quot; + Thread.currentThread().getId() + &quot;\\n&quot;</span><br><span class=\"line\">                    + &quot;&#x4E3B;&#x7EBF;&#x7A0B;id:&quot; + getMainLooper().getThread().getId(), Process.myPid());</span><br><span class=\"line\">        }</span><br><span class=\"line\">    };</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public IBinder onBind(Intent intent) {</span><br><span class=\"line\">        // TODO: Return the communication channel to the service.</span><br><span class=\"line\">        return mBinder;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x8C03;&#x7528;\"><a href=\"#&#x8C03;&#x7528;\" class=\"headerlink\" title=\"&#x8C03;&#x7528;\"></a>&#x8C03;&#x7528;</h2><p>&#x5728;<code>MainActivity</code>&#x4E2D;&#x7ED1;&#x5B9A;&#x5F00;&#x542F;<code>Service</code>&#xFF0C;&#x5B9E;&#x73B0;<code>ServiceConnection</code>,&#x5728;<code>onServiceConnected</code>&#x4E2D;&#x901A;&#x8FC7;<code>iRemoteService = IRemoteService.Stub.asInterface(iBinder);</code>&#x6765;&#x83B7;&#x53D6;&#x8C03;&#x7528;&#x7684;&#x4EE3;&#x7406;&#xFF0C;&#x6700;&#x540E;&#x8C03;&#x7528;<code>iRemoteService.sayHello()</code>&#x83B7;&#x53D6;&#x901A;&#x4FE1;&#x7684;&#x4FE1;&#x606F;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class MainActivity extends AppCompatActivity {</span><br><span class=\"line\"></span><br><span class=\"line\">    private TextView mPidText;</span><br><span class=\"line\">    private IRemoteService iRemoteService;</span><br><span class=\"line\">    private boolean mBind = false;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    protected void onCreate(Bundle savedInstanceState) {</span><br><span class=\"line\">        super.onCreate(savedInstanceState);</span><br><span class=\"line\">        setContentView(R.layout.activity_main);</span><br><span class=\"line\">        mPidText = (TextView) findViewById(R.id.pid_text);</span><br><span class=\"line\">        mPidText.setText(&quot;&#x672C;&#x5730;id:&quot; + Process.myPid());</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    protected void onStart() {</span><br><span class=\"line\">        super.onStart();</span><br><span class=\"line\">        Intent intent = new Intent(MainActivity.this, RemoteService.class);</span><br><span class=\"line\">        bindService(intent, conn, BIND_AUTO_CREATE);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    protected void onStop() {</span><br><span class=\"line\">        super.onStop();</span><br><span class=\"line\">        unbindService(conn);</span><br><span class=\"line\">        mBind = false;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    private ServiceConnection conn = new ServiceConnection() {</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void onServiceConnected(ComponentName componentName, IBinder iBinder) {</span><br><span class=\"line\">            iRemoteService = IRemoteService.Stub.asInterface(iBinder);</span><br><span class=\"line\">            mBind = true;</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void onServiceDisconnected(ComponentName componentName) {</span><br><span class=\"line\">            iRemoteService = null;</span><br><span class=\"line\">            mBind = false;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    };</span><br><span class=\"line\"></span><br><span class=\"line\">    public void myClick(View view) {</span><br><span class=\"line\">        switch (view.getId()) {</span><br><span class=\"line\">            case R.id.show_pid_bt:</span><br><span class=\"line\">                if (mBind) {</span><br><span class=\"line\">                    try {</span><br><span class=\"line\">                        Log.v(&quot;TAG&quot;, &quot;&#x8FDC;&#x7A0B;id:&quot; + iRemoteService.sayHello().getpId());</span><br><span class=\"line\">                    } catch (RemoteException e) {</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }</span><br><span class=\"line\">                break;</span><br><span class=\"line\">            case R.id.show_message_bt:</span><br><span class=\"line\">                if (mBind) {</span><br><span class=\"line\">                    try {</span><br><span class=\"line\">                        Log.v(&quot;TAG&quot;, &quot;Message:&quot; + iRemoteService.sayHello().getMessage());</span><br><span class=\"line\">                    } catch (RemoteException e) {</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }</span><br><span class=\"line\">                break;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5F53;&#x7136;&#x5728;<code>AndroidManifest.xml</code>&#x4E2D;&#x8981;&#x5BF9;<code>Service</code>&#x8FDB;&#x884C;&#x914D;&#x7F6E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;service</span><br><span class=\"line\">            android:name=&quot;.RemoteService&quot;</span><br><span class=\"line\">            android:enabled=&quot;true&quot;</span><br><span class=\"line\">            android:exported=&quot;true&quot;</span><br><span class=\"line\">            android:process=&quot;:remote&quot;&gt;&lt;/service&gt;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x6CE8;&#x610F;&#x56E0;&#x4E3A;&#x8981;&#x6A21;&#x4EFF;&#x8FDC;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x5C06;process&#x8BBE;&#x7F6E;&#x6210;remote&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x8BBE;&#x7F6E;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#xFF0C;&#x4F46;&#x8FD9;&#x5C31;&#x4E0D;&#x662F;&#x4E0D;&#x540C;&#x8FDB;&#x7A0B;&#x4E2D;&#x7684;&#x901A;&#x4FE1;&#x4E86;&#xFF0C;aidl&#x5C31;&#x6CA1;&#x4EC0;&#x4E48;&#x610F;&#x4E49;&#x4E86;</em></p>\n</blockquote>\n<p>&#x6765;&#x770B;&#x4E0B;&#x6548;&#x679C;&#x5427;</p>\n<p><img src=\"/2016/09/25/AIDL&#x5165;&#x95E8;/2.png\" alt=\"&#x6548;&#x679C;\"></p>\n<p><img src=\"/2016/09/25/AIDL&#x5165;&#x95E8;/3.png\" alt=\"&#x6548;&#x679C;\"></p>\n<p>&#x5BA2;&#x6237;&#x7AEF;&#x8FDB;&#x7A0B;&#x662F;<code>26951</code>&#x800C;&#x670D;&#x52A1;&#x7AEF;&#x8FDB;&#x7A0B;&#x4E3A;<code>26974</code>&#xFF0C;&#x8BF4;&#x660E;&#x4ED6;&#x4EEC;&#x5904;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x8FD9;&#x6837;<code>AIDL</code>&#x4E5F;&#x5C31;&#x5B9E;&#x73B0;&#x4E86;&#x3002;&#x5F53;&#x7136;&#x5982;&#x4E0A;&#x6240;&#x8FF0;&#x5C06;<code>process</code>&#x53BB;&#x6389;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x8FDB;&#x7A0B;&#x5C31;&#x662F;&#x4E00;&#x6837;&#x7684;&#x4E86;&#x3002;&#x8FD9;&#x4E2A;&#x5C31;&#x7559;&#x4E2A;&#x8BFB;&#x8005;&#x81EA;&#x884C;&#x6D4B;&#x8BD5;&#x4E86;&#x3002;</p>\n<p>&#x6E90;&#x4EE3;&#x7801;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/idisfkj/AIDLDemo\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/AIDLDemo</a></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904;idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["AIDL"]},{"title":"React Native For Android","url":"https://www.rousetime.com/2016/08/29/React-Native-For-Android/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p><code>React Native</code>&#x6709;&#x70B9;&#x5927;&#x52BF;&#x6240;&#x8D8B;&#xFF0C;&#x6240;&#x4EE5;&#x524D;&#x6BB5;&#x65F6;&#x95F4;&#x7814;&#x7A76;&#x4E86;&#x4E0B;&#x5B83;&#xFF0C;&#x770B;&#x4E86;&#x5B83;&#x7684;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x540C;&#x65F6;&#x4E5F;&#x5728;<code>Github</code>&#x6D4F;&#x89C8;&#x4E86;&#x524D;&#x8F88;&#x4EEC;&#x7684;&#x6770;&#x4F5C;&#xFF0C;&#x6240;&#x4EE5;&#x81EA;&#x5DF1;&#x4E5F;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;<code>Demo</code>&#x4E5F;&#x7B97;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x7684;&#x5165;&#x95E8;&#x3002;&#x914D;&#x5408;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x4E0E;&#x4EE3;&#x7801;&#x5B9E;&#x4F8B;&#x76F8;&#x4FE1;&#x90FD;&#x80FD;&#x5F88;&#x5FEB;&#x7684;&#x8FDB;&#x5165;<code>React Native</code>&#x7684;&#x4E16;&#x754C;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4ECB;&#x7ECD;&#x7684;&#x4E0D;&#x4F1A;&#x5F88;&#x8BE6;&#x7EC6;&#xFF0C;&#x662F;&#x9488;&#x5BF9;<code>React Native</code>&#x8BED;&#x6CD5;&#x6709;&#x4E00;&#x5B9A;&#x4F1A;&#x57FA;&#x7840;&#x7684;&#x540C;&#x5B66;&#x3002;</p>\n<h1 id=\"React-Native&#x4ECB;&#x7ECD;\"><a href=\"#React-Native&#x4ECB;&#x7ECD;\" class=\"headerlink\" title=\"React Native&#x4ECB;&#x7ECD;\"></a>React Native&#x4ECB;&#x7ECD;</h1><p>&#x8FD9;&#x91CC;&#x7B80;&#x5355;&#x7684;&#x4ECB;&#x7ECD;&#x4E0B;<code>React Native</code></p>\n<ul>\n<li>&#x5B83;&#x662F;&#x501F;&#x52A9;&#x4E8E;<code>FaceBook</code>&#x73B0;&#x6709;&#x7684;&#x8F6E;&#x5B50;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5BF9;<code>ISO</code>&#x548C;<code>Android</code>&#x4E24;&#x5927;&#x5E73;&#x53F0;&#x7684;&#x652F;&#x6301;</li>\n<li>&#x4F7F;&#x7528;<code>React.js</code>&#x6765;&#x64CD;&#x4F5C;&#x539F;&#x751F;&#x7684;<code>UI</code>&#x7EC4;&#x4EF6;&#xFF0C;&#x66FF;&#x4EE3;&#x4E86;<code>DOM</code>&#x5143;&#x7D20;</li>\n<li>&#x5728;<code>UI</code>&#x65B9;&#x9762;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;<code>Flexbox</code>&#x7684;&#x5E03;&#x5C40;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x652F;&#x6301;<code>css-layout</code>&#x6837;&#x5F0F;</li>\n<li>&#x4F7F;&#x7528;<code>JSX</code>&#x6765;&#x8F6C;&#x6362;&#x6210;<code>JS</code>&#x6765;&#x6267;&#x884C;&#xFF0C;<code>JSX</code>&#x662F;&#x4E00;&#x79CD;&#x7C7B;&#x4F3C;&#x4E8E;<code>XML</code>&#x8BED;&#x6CD5;&#x7684;&#x811A;&#x6B65;&#x6269;&#x5C55;&#x8BED;&#x8A00;&#x3002;</li>\n</ul>\n<p>&#x5BF9;&#x4E8E;<code>React Native</code>&#x7684;&#x73AF;&#x5883;&#x642D;&#x5EFA;,&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x5B98;&#x65B9;&#x6587;&#x6863;<a href=\"https://facebook.github.io/react-native/docs/getting-started.html\" target=\"_blank\" rel=\"noopener\">Getting Started</a>,&#x5982;&#x679C;&#x82F1;&#x6587;&#x4E0D;&#x597D;&#x7684;&#x522B;&#x6025;&#xFF0C;&#x8FD9;&#x91CC;&#x8FD8;&#x6709;&#x4E2D;&#x6587;&#x7248;&#x7684;<a href=\"http://reactnative.cn/docs/0.31/getting-started.html\" target=\"_blank\" rel=\"noopener\">Getting Started</a></p>\n<blockquote>\n<p><em>&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x82F1;&#x6587;&#x7248;&#x7684;&#xFF0C;&#x4E2D;&#x6587;&#x7248;&#x7684;&#x8FD8;&#x662F;&#x5B58;&#x5728;&#x5751;&#xFF0C;&#x4E0B;&#x9762;&#x7B80;&#x5355;&#x7684;&#x4ECB;&#x7ECD;&#x4E0B;Demo&#x4E2D;&#x7528;&#x5230;&#x7684;&#x7EC4;&#x4EF6;</em></p>\n</blockquote>\n<h1 id=\"Navigator\"><a href=\"#Navigator\" class=\"headerlink\" title=\"Navigator\"></a>Navigator</h1><p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5BFC;&#x822A;&#x5668;,&#x76F4;&#x767D;&#x7684;&#x7406;&#x89E3;&#x5C31;&#x662F;&#x5B9E;&#x73B0;&#x754C;&#x9762;&#x4E4B;&#x95F4;&#x7684;&#x8DF3;&#x8F6C;&#xFF0C;&#x5728;<code>React Native</code>&#x4E2D;&#x501F;&#x52A9;&#x5B83;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x5B9E;&#x73B0;&#x754C;&#x9762;&#x7684;&#x5207;&#x6362;&#x3002;&#x5B9E;&#x73B0;&#x5B83;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x51E0;&#x4E2A;&#x5FC5;&#x8981;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Navigator initialRoute={{title: &apos;&#x4E3B;&#x9875;&apos;, component: Welcome}}</span><br><span class=\"line\">          configureScene={(route,routeStack) =&gt; Navigator.SceneConfigs.FloatFromLeft}</span><br><span class=\"line\">          renderScene={this.renderScene}/&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"initialRoute\"><a href=\"#initialRoute\" class=\"headerlink\" title=\"initialRoute\"></a>initialRoute</h2><p><code>Navigator</code>&#x90FD;&#x662F;&#x7531;<code>route</code>&#x6765;&#x63A7;&#x5236;&#x8DF3;&#x8F6C;&#x8DEF;&#x7EBF;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x65F6;&#x8981;&#x521D;&#x59CB;&#x5316;<code>route</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">initialRoute={{title: &apos;&#x4E3B;&#x9875;&apos;, component: Welcome}}</span><br></pre></td></tr></table></figure>\n<p>&#x91CC;&#x9762;&#x7684;&#x53C2;&#x6570;&#x540D;&#x4E0D;&#x53D7;&#x9650;&#x5236;&#xFF0C;&#x4F46;&#x662F;&#x4F60;&#x5FC5;&#x987B;&#x8981;&#x6307;&#x660E;&#x8DF3;&#x8F6C;&#x7684;<code>Componnet</code>&#x7EC4;&#x4EF6;&#x540D;&#xFF0C;&#x65B9;&#x4FBF;&#x5728;&#x540E;&#x7EED;&#x6267;&#x884C;&#x4E2D;&#x53D6;&#x51FA;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>route.component</code>&#x53D6;&#x51FA;&#x3002;</p>\n<h2 id=\"renderScene\"><a href=\"#renderScene\" class=\"headerlink\" title=\"renderScene\"></a>renderScene</h2><p>&#x8BE5;&#x914D;&#x7F6E;&#x5C31;&#x662F;&#x6267;&#x884C;&#x6CA1;&#x4E00;&#x4E2A;<code>route</code>&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#xFF0C;&#x4ECE;&#x800C;&#x6E32;&#x67D3;&#x51FA;&#x6765;&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E24;&#x4E2A;&#x5185;&#x7F6E;&#x53C2;&#x6570;<code>route</code>&#x4E0E;<code>navigator</code>&#xFF0C;&#x6765;&#x65B9;&#x4FBF;&#x6E32;&#x67D3;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">renderScene={this.renderScene}</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">renderScene(route, navigator){</span><br><span class=\"line\">    _navigator = navigator;</span><br><span class=\"line\">    let DefaultComponet = route.component;</span><br><span class=\"line\">    return &lt;DefaultComponet</span><br><span class=\"line\">      route = {route} navigator = {navigator}/&gt;</span><br><span class=\"line\">  }</span><br></pre></td></tr></table></figure>\n<p>&#x5728;<code>renderScene</code>&#x4E2D;&#x6211;&#x4EEC;&#x53D6;&#x51FA;&#x6BCF;&#x6B21;&#x8981;&#x5BFC;&#x822A;&#x7684;<code>Component</code>&#xFF0C;&#x540C;&#x65F6;&#x6E32;&#x67D3;&#x51FA;&#x6765;&#xFF0C;&#x5E76;&#x4E14;&#x628A;<code>route</code>&#x4E0E;<code>navigator</code>&#x4F20;&#x5230;&#x6E32;&#x67D3;&#x7684;&#x754C;&#x9762;&#x4E2D;&#x3002;&#x5728;&#x6E32;&#x67D3;&#x754C;&#x9762;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>this.props.rout</code>&#x4E0E;<code>this.props.navigator</code>&#x6765;&#x83B7;&#x53D6;&#x3002;&#x6700;&#x540E;&#x4E00;&#x6B65;&#x5C31;&#x662F;&#x8981;&#x7ED1;&#x5B9A;&#x4E8B;&#x4EF6;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">this.renderScene = this.renderScene.bind(this);</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x4E0D;&#x61C2;props&#x7684;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x67E5;&#x9605;&#x5B98;&#x65B9;&#x6587;&#x6863;</em></p>\n</blockquote>\n<h2 id=\"push&#x4E0E;pop\"><a href=\"#push&#x4E0E;pop\" class=\"headerlink\" title=\"push&#x4E0E;pop\"></a>push&#x4E0E;pop</h2><p><code>Navigator</code>&#x63D0;&#x4F9B;&#x4E86;<code>push</code>&#x4E0E;<code>pop</code>&#x65B9;&#x6CD5;&#x6765;&#x63A7;&#x5236;<code>route</code>&#x7684;&#x8DEF;&#x7EBF;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x6211;&#x4EEC;&#x719F;&#x77E5;&#x7684;&#x6808;&#x3002;&#x901A;&#x8FC7;<code>push</code>&#x6765;&#x8BBE;&#x7F6E;&#x4E0B;&#x4E00;&#x4E2A;&#x5BFC;&#x822A;&#x7684;<code>route</code>&#xFF0C;&#x901A;&#x8FC7;<code>pop</code>&#x6765;&#x9000;&#x51FA;&#x8BE5;&#x754C;&#x9762;&#x8FD4;&#x56DE;&#x539F;&#x6765;&#x7684;&#x754C;&#x9762;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;TouchableOpacity onPress={() =&gt; this.props.navigator.push({</span><br><span class=\"line\">        title: &apos;&#x8BE6;&#x60C5;&apos;,</span><br><span class=\"line\">        component: Detail,</span><br><span class=\"line\">        number: rowID,</span><br><span class=\"line\">      })}&gt;</span><br><span class=\"line\">      &lt;View style={styles.item}&gt;</span><br><span class=\"line\">        &lt;View style={styles.content}&gt;</span><br><span class=\"line\">          &lt;Text style={styles.des}&gt;</span><br><span class=\"line\">            {rowData.title}</span><br><span class=\"line\">          &lt;/Text&gt;</span><br><span class=\"line\">          ....</span><br><span class=\"line\">      &lt;/View&gt;</span><br><span class=\"line\">&lt;/TouchableOpacity&gt;</span><br></pre></td></tr></table></figure>\n<p><code>TouchableOpacity</code>&#x662F;&#x4E00;&#x4E2A;&#x70B9;&#x51FB;&#x76D1;&#x542C;&#x7EC4;&#x4EF6;&#xFF0C;&#x53EF;&#x4EE5;&#x7ED1;&#x5B9A;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;TouchableOpacity onPress={() =&gt; this.props.navigator.pop()}&gt;</span><br><span class=\"line\">            &lt;Image source={require(&apos;../imgs/back.png&apos;)} style={styles.back}/&gt;</span><br><span class=\"line\">          &lt;/TouchableOpacity&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x70B9;&#x51FB;&#x4EE5;&#x540E;&#x6E32;&#x67D3;&#x51FA;&#x6765;&#x7684;&#x754C;&#x9762;&#x4E2D;&#x8C03;&#x7528;<code>pop</code>&#x65B9;&#x6CD5;&#x9000;&#x51FA;&#x8BE5;&#x6E32;&#x67D3;.</p>\n<h1 id=\"ListView\"><a href=\"#ListView\" class=\"headerlink\" title=\"ListView\"></a>ListView</h1><p>&#x662F;&#x4E0D;&#x662F;&#x611F;&#x89C9;&#x5F88;&#x4EB2;&#x5207;&#xFF0C;&#x5B83;&#x8981;&#x5B9E;&#x73B0;&#x7684;&#x529F;&#x80FD;&#x8DDF;<code>Android</code>&#x4E2D;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;&#x4F46;&#x662F;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x5C31;&#x4E0D;&#x540C;&#x4E86;&#x54E6;&#x3002;&#x4E0D;&#x8FC7;&#x6574;&#x4F53;&#x9700;&#x8981;&#x7684;&#x6570;&#x636E;&#x539F;&#x7406;&#x8FD8;&#x662F;&#x7C7B;&#x4F3C;&#x3002;&#x65E0;&#x975E;&#x4E5F;&#x8981;&#x6574;&#x4E2A;&#x7684;&#x6570;&#x636E;&#x6E90;&#xFF0C;&#x4E0E;&#x7ED1;&#x5B9A;&#x6CA1;&#x4E2A;<code>Item</code>&#x7684;&#x6570;&#x636E;&#x3002;</p>\n<h2 id=\"rowHasChanged\"><a href=\"#rowHasChanged\" class=\"headerlink\" title=\"rowHasChanged\"></a>rowHasChanged</h2><p>&#x5728;&#x6E32;&#x67D3;&#x4E4B;&#x524D;&#x8981;&#x8BBE;&#x7F6E;&#x5224;&#x65AD;&#x8BE5;&#x6570;&#x636E;&#x662F;&#x5426;&#x9700;&#x8981;&#x4ECE;&#x65B0;&#x6E32;&#x67D3;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x51CF;&#x5C11;&#x8BB8;&#x591A;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x6E32;&#x67D3;&#x6B65;&#x9AA4;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x80FD;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const listView = new ListView.DataSource({</span><br><span class=\"line\">      rowHasChanged: (r1,r2) =&gt; r1!==r2});</span><br></pre></td></tr></table></figure>\n<h2 id=\"cloneWithRows\"><a href=\"#cloneWithRows\" class=\"headerlink\" title=\"cloneWithRows\"></a>cloneWithRows</h2><p>&#x4E3A;<code>listView</code>&#x521D;&#x59CB;&#x5316;&#x6570;&#x636E;&#x6E90;,&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>state</code>&#x72B6;&#x6001;&#x6765;&#x8FDB;&#x884C;&#x4FDD;&#x5B58;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">this.state={</span><br><span class=\"line\">      dataSource: listView.cloneWithRows(this._rowData())};</span><br><span class=\"line\">  }</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x7ED1;&#x5B9A;\"><a href=\"#&#x7ED1;&#x5B9A;\" class=\"headerlink\" title=\"&#x7ED1;&#x5B9A;\"></a>&#x7ED1;&#x5B9A;</h2><p>&#x6700;&#x540E;&#x5728;&#x6E32;&#x67D3;<code>render()</code>&#x751F;&#x547D;&#x5468;&#x671F;&#x65B9;&#x6CD5;&#x4E2D;&#x8FDB;&#x884C;&#x7EC4;&#x4EF6;&#x8D44;&#x6E90;&#x7ED1;&#x5B9A;:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;ListView</span><br><span class=\"line\">            style={styles.container}</span><br><span class=\"line\">            dataSource={this.state.dataSource}</span><br><span class=\"line\">            renderRow={this._renderRow.bind(this)}/&gt;</span><br><span class=\"line\">          &lt;/View&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;<code>dataSource</code>&#x4E0E;<code>renderRow</code>&#x662F;&#x4E24;&#x4E2A;&#x5FC5;&#x8981;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x524D;&#x4E00;&#x4E2A;&#x662F;&#x7ED1;&#x5B9A;&#x6570;&#x636E;&#x6E90;&#xFF0C;&#x540E;&#x4E00;&#x4E2A;&#x662F;&#x7ED1;&#x5B9A;&#x6E32;&#x67D3;&#x7684;&#x6BCF;&#x4E00;&#x884C;&#x7684;&#x6570;&#x636E;&#x3002;&#x5176;&#x4E2D;<code>_renderRow</code>&#x662F;<code>Item</code>&#x7684;&#x5E03;&#x5C40;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_renderRow(rowData,sectionID,rowID,highlightRow){</span><br><span class=\"line\">    return(</span><br><span class=\"line\">    &lt;TouchableOpacity onPress={() =&gt; this.props.navigator.push({</span><br><span class=\"line\">        title: &apos;&#x8BE6;&#x60C5;&apos;,</span><br><span class=\"line\">        component: Detail,</span><br><span class=\"line\">        number: rowID,</span><br><span class=\"line\">      })}&gt;</span><br><span class=\"line\">      &lt;View style={styles.item}&gt;</span><br><span class=\"line\">        &lt;View style={styles.content}&gt;</span><br><span class=\"line\">          &lt;Text style={styles.des}&gt;</span><br><span class=\"line\">            {rowData.title}</span><br><span class=\"line\">          &lt;/Text&gt;</span><br><span class=\"line\">          &lt;View style={styles.bottom}&gt;</span><br><span class=\"line\">            &lt;Text style={styles.fb}&gt;</span><br><span class=\"line\">              {&quot;&#x53D1;&#x5E03;: &quot;+rowData.fb}</span><br><span class=\"line\">            &lt;/Text&gt;</span><br><span class=\"line\">            &lt;Text style={styles.data}&gt;</span><br><span class=\"line\">              {&quot;&#x65E5;&#x671F;: &quot;+rowData.data}</span><br><span class=\"line\">            &lt;/Text&gt;</span><br><span class=\"line\">          &lt;/View&gt;</span><br><span class=\"line\">        &lt;/View&gt;</span><br><span class=\"line\">        &lt;Image style={styles.image}</span><br><span class=\"line\">        source={{uri: rowData.image}}/&gt;</span><br><span class=\"line\">      &lt;/View&gt;</span><br><span class=\"line\">      &lt;/TouchableOpacity&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  }</span><br></pre></td></tr></table></figure>\n<p><code>renderRow</code>&#x63D0;&#x4F9B;&#x4E86;&#x56DB;&#x4E2A;&#x53C2;&#x6570;<code>rowData,sectionID,rowID,highlightRow</code>&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x662F;&#x5229;&#x7528;<code>rowData</code>&#x6765;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x6E90;&#x3002;&#x5E03;&#x5C40;&#x6837;&#x5F0F;&#x662F;&#x4F7F;&#x7528;<code>css-layout</code>&#x6765;&#x5B9E;&#x73B0;,&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x7EC4;&#x4EF6;&#x662F;&#x4F7F;&#x7528;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">style={{flex: 1}}</span><br></pre></td></tr></table></figure>\n<p>&#x6216;&#x8005;&#x901A;&#x8FC7;<code>StyleSheet</code>&#x6765;&#x7EDF;&#x4E00;&#x521B;&#x5EFA;:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const styles = StyleSheet.create({</span><br><span class=\"line\">  container: {</span><br><span class=\"line\">    flex: 1,</span><br><span class=\"line\">    backgroundColor: &apos;#F5FCFF&apos;,</span><br><span class=\"line\">  },</span><br><span class=\"line\">  title: {</span><br><span class=\"line\">    backgroundColor: &apos;royalblue&apos;,</span><br><span class=\"line\">    justifyContent: &apos;center&apos;,</span><br><span class=\"line\">    alignItems: &apos;center&apos;,</span><br><span class=\"line\">    borderColor: &apos;gray&apos;,</span><br><span class=\"line\">    borderBottomWidth: 1,</span><br><span class=\"line\">  },</span><br><span class=\"line\">  ...</span><br><span class=\"line\">});</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>css&#x8FD9;&#x91CC;&#x4E0D;&#x591A;&#x8BF4;&#xFF0C;&#x81EA;&#x5DF1;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x5B98;&#x65B9;&#x6587;&#x6863;</em></p>\n</blockquote>\n<h1 id=\"TabNavigator\"><a href=\"#TabNavigator\" class=\"headerlink\" title=\"TabNavigator\"></a>TabNavigator</h1><p>&#x8FD9;&#x91CC;&#x518D;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E0B;<code>TabNavigator</code>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x4E8E;<code>Android</code>&#x4E2D;&#x7684;<code>FragmentTabHost</code>&#x3002;&#x76F8;&#x4FE1;&#x90FD;&#x77E5;&#x9053;&#x5B83;&#x7684;&#x529F;&#x80FD;&#x662F;&#x4EC0;&#x4E48;&#x4E86;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;TabNavigator&gt;</span><br><span class=\"line\">        &lt;TabNavigator.Item</span><br><span class=\"line\">          title=&quot;&#x65B0;&#x95FB;&quot;</span><br><span class=\"line\">          selected={this.state.selectedTab===&apos;news&apos;}</span><br><span class=\"line\">          selectedTitleStyle={styles.selectedText}</span><br><span class=\"line\">          titleStyle={styles.text}</span><br><span class=\"line\">          renderIcon={() =&gt; &lt;Image source={require(&apos;../imgs/ic_news.png&apos;)} style={styles.image}/&gt;}</span><br><span class=\"line\">          renderSelectedIcon={() =&gt; &lt;Image source={require(&apos;../imgs/ic_news_pressed.png&apos;)} style={styles.image}/&gt;}</span><br><span class=\"line\">          onPress={() =&gt; this.setState({selectedTab: &apos;news&apos;})}&gt;</span><br><span class=\"line\">          &lt;News {...this.props}/&gt;</span><br><span class=\"line\">        &lt;/TabNavigator.Item&gt;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">&lt;/TabNavigator&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;<code>&lt;TabNavigator.Item&gt;</code>&#x5B50;&#x6807;&#x7B7E;&#x6765;&#x8BBE;&#x7F6E;&#x6BCF;&#x4E00;&#x4E2A;&#x5E95;&#x90E8;<code>Item</code>&#xFF0C;&#x5728;&#x5176;&#x4E2D;&#x5728;&#x8BBE;&#x7F6E;&#x8BE5;<code>Item</code>&#x8981;&#x6E32;&#x67D3;&#x7684;&#x754C;&#x9762;&#xFF0C;&#x4E0A;&#x9762;&#x7684;<code>News</code>&#x5C31;&#x662F;&#x8981;&#x6E32;&#x67D3;&#x7684;&#x754C;&#x9762;,&#x8BE5;&#x754C;&#x9762;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>export default News</code>&#x5BFC;&#x51FA;&#xFF0C;<code>import News from &apos;./News&apos;</code>&#x5BFC;&#x5165;&#x3002;</p>\n<blockquote>\n<p><em>&#x5148;&#x5C31;&#x4ECB;&#x7ECD;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x5982;&#x679C;&#x8FD8;&#x6709;&#x9700;&#x8981;&#x53EF;&#x4EE5;&#x4E0B;&#x8F7D;&#x6E90;&#x7801;,&#x540E;&#x7EED;&#x8FD8;&#x4F1A;&#x7EE7;&#x7EED;&#x518D;&#x505A;&#x6269;&#x5C55;</em></p>\n</blockquote>\n<h1 id=\"&#x6548;&#x679C;&#x56FE;\"><a href=\"#&#x6548;&#x679C;&#x56FE;\" class=\"headerlink\" title=\"&#x6548;&#x679C;&#x56FE;\"></a>&#x6548;&#x679C;&#x56FE;</h1><p><img src=\"/2016/08/29/React-Native-For-Android/rn.gif\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p>&#x9879;&#x76EE;&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/idisfkj/RNDemo\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/RNDemo</a></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["React Native"]},{"title":"hexo使用新node版本问题","url":"https://www.rousetime.com/2016/08/29/hexo使用新node版本问题/","content":"<p>&#x4ECA;&#x5929;&#x5728;&#x4F7F;&#x7528;<code>hexo</code>&#x5199;&#x535A;&#x5BA2;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x73B0;&#x4F7F;&#x7528;<code>hexo</code>&#x547D;&#x4EE4;&#x5C45;&#x7136;&#x51FA;&#x73B0;&#x9519;&#x8BEF;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Error: Module version mismatch. Expected 48, got 47.</span><br><span class=\"line\">    at Error (native)</span><br><span class=\"line\">    at Object.Module._extensions..node (module.js:568:18)</span><br><span class=\"line\">    at Module.load (module.js:458:32)</span><br><span class=\"line\">    at tryModuleLoad (module.js:417:12)</span><br><span class=\"line\">    at Function.Module._load (module.js:409:3)</span><br><span class=\"line\">    at Module.require (module.js:468:17)</span><br><span class=\"line\">    at require (internal/module.js:20:19)</span><br><span class=\"line\">    at Object.&lt;anonymous&gt; (/usr/local/lib/node_modules/hexo/node_modules/dtrace-provider/dtrace-provider.js:17:23)</span><br><span class=\"line\">    at Module._compile (module.js:541:32)</span><br><span class=\"line\">    at Object.Module._extensions..js (module.js:550:10)</span><br><span class=\"line\">    at Module.load (module.js:458:32)</span><br><span class=\"line\">    at tryModuleLoad (module.js:417:12)</span><br><span class=\"line\">    at Function.Module._load (module.js:409:3)</span><br><span class=\"line\">    at Module.require (module.js:468:17)</span><br><span class=\"line\">    at require (internal/module.js:20:19)</span><br><span class=\"line\">    at Object.&lt;anonymous&gt; (/usr/local/lib/node_modules/hexo/node_modules/bunyan/lib/bunyan.js:79:18)</span><br><span class=\"line\">{ Error: Cannot find module &apos;./build/default/DTraceProviderBindings&apos;</span><br><span class=\"line\">    at Function.Module._resolveFilename (module.js:440:15)</span><br><span class=\"line\">    at Function.Module._load (module.js:388:25)</span><br><span class=\"line\">    at Module.require (module.js:468:17)</span><br><span class=\"line\">    at require (internal/module.js:20:19)</span><br><span class=\"line\">    at Object.&lt;anonymous&gt; (/usr/local/lib/node_modules/hexo/node_modules/dtrace-provider/dtrace-provider.js:17:23)</span><br><span class=\"line\">    at Module._compile (module.js:541:32)</span><br><span class=\"line\">    at Object.Module._extensions..js (module.js:550:10)</span><br><span class=\"line\">    at Module.load (module.js:458:32)</span><br><span class=\"line\">    at tryModuleLoad (module.js:417:12)</span><br><span class=\"line\">    at Function.Module._load (module.js:409:3)</span><br><span class=\"line\">    at Module.require (module.js:468:17)</span><br><span class=\"line\">    at require (internal/module.js:20:19)</span><br><span class=\"line\">    at Object.&lt;anonymous&gt; (/usr/local/lib/node_modules/hexo/node_modules/bunyan/lib/bunyan.js:79:18)</span><br><span class=\"line\">    at Module._compile (module.js:541:32)</span><br><span class=\"line\">    at Object.Module._extensions..js (module.js:550:10)</span><br><span class=\"line\">    at Module.load (module.js:458:32) code: &apos;MODULE_NOT_FOUND&apos; }</span><br><span class=\"line\">{ Error: Cannot find module &apos;./build/Debug/DTraceProviderBindings&apos;</span><br><span class=\"line\">    at Function.Module._resolveFilename (module.js:440:15)</span><br><span class=\"line\">    at Function.Module._load (module.js:388:25)</span><br><span class=\"line\">    at Module.require (module.js:468:17)</span><br><span class=\"line\">    at require (internal/module.js:20:19)</span><br><span class=\"line\">    at Object.&lt;anonymous&gt; (/usr/local/lib/node_modules/hexo/node_modules/dtrace-provider/dtrace-provider.js:17:23)</span><br><span class=\"line\">    at Module._compile (module.js:541:32)</span><br><span class=\"line\">    at Object.Module._extensions..js (module.js:550:10)</span><br><span class=\"line\">    at Module.load (module.js:458:32)</span><br><span class=\"line\">    at tryModuleLoad (module.js:417:12)</span><br><span class=\"line\">    at Function.Module._load (module.js:409:3)</span><br><span class=\"line\">    at Module.require (module.js:468:17)</span><br><span class=\"line\">    at require (internal/module.js:20:19)</span><br><span class=\"line\">    at Object.&lt;anonymous&gt; (/usr/local/lib/node_modules/hexo/node_modules/bunyan/lib/bunyan.js:79:18)</span><br><span class=\"line\">    at Module._compile (module.js:541:32)</span><br><span class=\"line\">    at Object.Module._extensions..js (module.js:550:10)</span><br><span class=\"line\">    at Module.load (module.js:458:32) code: &apos;MODULE_NOT_FOUND&apos; }</span><br></pre></td></tr></table></figure>\n<p>&#x867D;&#x7136;&#x4E5F;&#x80FD;&#x8FD0;&#x884C;<code>hexo</code>&#xFF0C;&#x4F46;&#x662F;&#x60F3;&#x5230;&#x6BCF;&#x6B21;&#x770B;&#x5230;&#x8FD9;&#x79CD;&#x4E1C;&#x897F;&#x5FC3;&#x91CC;&#x90FD;&#x4E0D;&#x723D;&#xFF0C;&#x6240;&#x4EE5;&#x575A;&#x51B3;&#x8981;&#x89E3;&#x51B3;&#x5B83;&#x3002;&#x6700;&#x540E;&#x7ECF;&#x8FC7;&#x5404;&#x79CD;&#x67E5;&#x8D44;&#x6599;&#x53D1;&#x73B0;&#x662F;<code>node</code>&#x7684;&#x7248;&#x672C;&#x95EE;&#x9898;&#xFF0C;&#x7531;&#x4E8E;&#x524D;&#x6BB5;&#x65F6;&#x95F4;&#x641E;&#x4E86;&#x4E0B;<code>React-Native</code>&#x5347;&#x7EA7;&#x4E86;<code>node</code>&#x7248;&#x672C;&#xFF0C;&#x4EE5;&#x81F3;&#x4E8E;&#x73B0;&#x5728;&#x7684;<code>node</code>&#x7248;&#x672C;&#x662F;&#x6700;&#x65B0;&#x7684;<code>6.3.1</code>&#x3002;&#x7531;&#x4E8E;&#x65B0;&#x7248;&#x672C;&#x4E2D;&#x6709;&#x7684;&#x6A21;&#x5757;&#x4E0D;&#x652F;&#x6301;&#xFF0C;&#x6240;&#x6709;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x6309;&#x7167;&#x6D41;&#x884C;&#x7248;&#x5427;<code>(node4-lts)</code></p>\n<blockquote>\n<p><em>&#x597D;&#x4E86;&#x4E0B;&#x9762;&#x8BF4;&#x4E0B;&#x5177;&#x4F53;&#x89E3;&#x51B3;&#x6B65;&#x9AA4;</em></p>\n</blockquote>\n<h2 id=\"&#x89E3;&#x51B3;&#x65B9;&#x6848;\"><a href=\"#&#x89E3;&#x51B3;&#x65B9;&#x6848;\" class=\"headerlink\" title=\"&#x89E3;&#x51B3;&#x65B9;&#x6848;\"></a>&#x89E3;&#x51B3;&#x65B9;&#x6848;</h2><p>&#x65E2;&#x7136;&#x77E5;&#x9053;&#x539F;&#x56E0;&#x90A3;&#x5C31;&#x597D;&#x529E;&#x4E86;&#xFF0C;&#x53EA;&#x8981;&#x66F4;&#x6539;<code>node</code>&#x7684;&#x7248;&#x672C;&#x3002;</p>\n<h3 id=\"&#x67E5;&#x770B;&#x7248;&#x672C;\"><a href=\"#&#x67E5;&#x770B;&#x7248;&#x672C;\" class=\"headerlink\" title=\"&#x67E5;&#x770B;&#x7248;&#x672C;\"></a>&#x67E5;&#x770B;&#x7248;&#x672C;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install homebrew/versions/node</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x5B89;&#x88C5;&#x6307;&#x5B9A;&#x7248;&#x672C;\"><a href=\"#&#x5B89;&#x88C5;&#x6307;&#x5B9A;&#x7248;&#x672C;\" class=\"headerlink\" title=\"&#x5B89;&#x88C5;&#x6307;&#x5B9A;&#x7248;&#x672C;\"></a>&#x5B89;&#x88C5;&#x6307;&#x5B9A;&#x7248;&#x672C;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install homebrew/versions/node4-lts</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x5B89;&#x88C5;&#x6A21;&#x677F;\"><a href=\"#&#x5B89;&#x88C5;&#x6A21;&#x677F;\" class=\"headerlink\" title=\"&#x5B89;&#x88C5;&#x6A21;&#x677F;\"></a>&#x5B89;&#x88C5;&#x6A21;&#x677F;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo npm install hexo-cli -g</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x8FD0;&#x884C;&#x4E0B;<code>hexo server</code>&#x53D1;&#x73B0;&#x95EE;&#x9898;&#x89E3;&#x51B3;&#x4E86;&#x3002;</p>\n<p><em>&#x679C;&#x7136;&#x65B0;&#x7248;&#x672C;&#x8FD8;&#x662F;&#x4E0D;&#x8981;&#x8F7B;&#x6613;&#x4F7F;&#x7528;&#xFF0C;&#x8001;&#x7248;&#x672C;&#x8FD8;&#x662F;&#x76F8;&#x5BF9;&#x7A33;&#x5B9A;</em></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904;idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["hexo"],"tags":["hexo"]},{"title":"LoopView-循环轮播控件","url":"https://www.rousetime.com/2016/08/09/LoopView-循环轮播控件/","content":"<p>&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x6765;&#x5B66;&#x4E60;&#x4E00;&#x4E0B;&#x65E5;&#x5E38;&#x770B;&#x5230;&#x7684;&#x5E7F;&#x544A;&#x8F6E;&#x64AD;&#x5668;&#xFF0C;&#x51E0;&#x4E4E;&#x6BCF;&#x4E2A;<code>App</code>&#x4E2D;&#x90FD;&#x62E5;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x63A7;&#x4EF6;&#x3002;&#x8FD9;&#x79CD;&#x4F7F;&#x7528;&#x9891;&#x7E41;&#x7684;&#x63A7;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x61C2;&#x5F97;&#x5B83;&#x4EEC;&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x5DE5;&#x7A0B;&#x4E2D;&#x5C31;&#x80FD;&#x66F4;&#x52A0;&#x719F;&#x7EC3;&#x4E0E;&#x8F7B;&#x677E;&#x3002;&#x5148;&#x6765;&#x770B;&#x4E0B;&#x6548;&#x679C;&#x5427;&#x3002;</p>\n<h1 id=\"&#x6548;&#x679C;&#x56FE;\"><a href=\"#&#x6548;&#x679C;&#x56FE;\" class=\"headerlink\" title=\"&#x6548;&#x679C;&#x56FE;\"></a>&#x6548;&#x679C;&#x56FE;</h1><p><img src=\"/2016/08/09/LoopView-&#x5FAA;&#x73AF;&#x8F6E;&#x64AD;&#x63A7;&#x4EF6;/loopView.gif\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<h1 id=\"&#x539F;&#x7406;\"><a href=\"#&#x539F;&#x7406;\" class=\"headerlink\" title=\"&#x539F;&#x7406;\"></a>&#x539F;&#x7406;</h1><p>&#x5176;&#x5B9E;&#x8FD9;&#x4E2A;&#x63A7;&#x4EF6;&#x7684;&#x5B9E;&#x73B0;&#x672C;&#x8D28;&#x5C31;&#x662F;&#x4E00;&#x4E2A;<code>ViewPager</code>&#xFF0C;&#x76F8;&#x4FE1;&#x5927;&#x5BB6;&#x5BF9;<code>ViewPager</code>&#x4E0D;&#x4F1A;&#x5F88;&#x964C;&#x751F;&#xFF0C;&#x4F8B;&#x5982;<code>ViewPager</code>+<code>Fragment</code>&#x5B9E;&#x73B0;&#x65B0;&#x95FB;&#x7684;&#x754C;&#x9762;&#x3002;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x8981;&#x660E;&#x786E;&#x6211;&#x4EEC;&#x6240;&#x8981;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x5B9E;&#x73B0;<code>ViewPager</code>&#x6ED1;&#x52A8;&#x5207;&#x6362;&#x753B;&#x9762;&#xFF0C;&#x540C;&#x65F6;&#x6700;&#x91CD;&#x8981;&#x7684;&#x662F;&#x5B83;&#x81EA;&#x5DF1;&#x80FD;&#x5FAA;&#x73AF;&#x5207;&#x6362;&#x3002;&#x597D;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x6765;&#x7B80;&#x8981;&#x7684;&#x89E3;&#x91CA;&#x4E0B;&#x6838;&#x5FC3;&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>\n<h2 id=\"&#x521D;&#x59CB;&#x5316;\"><a href=\"#&#x521D;&#x59CB;&#x5316;\" class=\"headerlink\" title=\"&#x521D;&#x59CB;&#x5316;\"></a>&#x521D;&#x59CB;&#x5316;</h2><p>&#x8981;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x8F6E;&#x64AD;&#x63A7;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x8981;&#x81EA;&#x5B9A;&#x4E49;<code>LoopView</code>&#x63A7;&#x4EF6;&#xFF0C;&#x8BBE;&#x7F6E;&#x76F8;&#x5173;&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#xFF0C;&#x4E0E;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E9B;&#x6BD4;&#x8F83;&#x7684;&#x4E8B;&#x4EF6;&#xFF0C;&#x4F8B;&#x5982;&#x7ED1;&#x5B9A;&#x63A7;&#x4EF6;&#x3001;&#x8BBE;&#x7F6E;&#x76D1;&#x542C;&#x4E0E;&#x83B7;&#x53D6;&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;&#x503C;&#x3002;&#x8FD9;&#x91CC;&#x5E03;&#x5C40;&#x6211;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x67E5;&#x770B;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void init(Context context) {</span><br><span class=\"line\">        LayoutInflater.from(context).inflate(R.layout.loopview_layout, this, true);</span><br><span class=\"line\">        viewPager = (ViewPager) findViewById(R.id.loopView);</span><br><span class=\"line\">        linearCircler = (LinearLayout) findViewById(R.id.linear_circler);</span><br><span class=\"line\">        linearCirclerNo = (LinearLayout) findViewById(R.id.linear_circler_no);</span><br><span class=\"line\">        descript = (TextView) findViewById(R.id.descript);</span><br><span class=\"line\">        viewPager.addOnPageChangeListener(this);</span><br><span class=\"line\">        viewPager.setOnTouchListener(this);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x662F;&#x4E00;&#x4E9B;&#x5FC5;&#x8981;&#x7684;&#x5E03;&#x5C40;&#x586B;&#x5145;&#x4E0E;&#x76D1;&#x542C;&#x7ED1;&#x5B9A;&#xFF0C;&#x540C;&#x65F6;&#x6211;&#x8FD9;&#x91CC;&#x81EA;&#x5B9A;&#x4E49;&#x4E86;&#x5C5E;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#x4E5F;&#x8981;&#x83B7;&#x53D6;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public LoopView(Context context, AttributeSet attrs, int defStyleAttr) {</span><br><span class=\"line\">        super(context, attrs, defStyleAttr);</span><br><span class=\"line\">        TypedArray typedArray = getContext().obtainStyledAttributes(attrs, R.styleable.LoopView);</span><br><span class=\"line\">        rate = typedArray.getInteger(R.styleable.LoopView_rate, DEF_RATE);</span><br><span class=\"line\">        bottomStyle = typedArray.getInteger(R.styleable.LoopView_bottom_style, DEF_BOTTOM_STYLE);</span><br><span class=\"line\">        typedArray.recycle();</span><br><span class=\"line\">        init(context);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;<code>rate</code>&#x4EE3;&#x8868;&#x4E0B;&#x9762;&#x4F1A;&#x63D0;&#x5230;&#x7684;&#x8F6E;&#x64AD;&#x7684;&#x901F;&#x5EA6;&#xFF0C;<code>bottomStyle</code>&#x4EE3;&#x8868;&#x7684;&#x662F;<code>LoopView</code>&#x7684;&#x6837;&#x5F0F;&#x3002;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#x90FD;&#x662F;&#x5728;&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#x4E2D;&#x8BBE;&#x7F6E;&#x3002;</p>\n<h2 id=\"addOnPageChangeListener\"><a href=\"#addOnPageChangeListener\" class=\"headerlink\" title=\"addOnPageChangeListener\"></a>addOnPageChangeListener</h2><p>&#x8FD9;&#x4E2A;&#x662F;&#x76D1;&#x542C;<code>LoopView</code>&#x4E2D;<code>ViewPager</code>&#x63A7;&#x4EF6;&#x7684;<code>pager</code>&#x5207;&#x6362;&#x3002;&#x8981;&#x5B9E;&#x73B0;&#x5B83;&#x7684;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;<code>onPageScrolled</code>&#x3001;<code>onPageSelected</code>&#x4E0E;<code>onPageScrollStateChanged</code>&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x8981;&#x7528;&#x7684;&#x662F;&#x4E2D;&#x95F4;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<h3 id=\"onPageSelected\"><a href=\"#onPageSelected\" class=\"headerlink\" title=\"onPageSelected\"></a>onPageSelected</h3><p>&#x5728;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#x6211;&#x4EEC;&#x8981;&#x5B9E;&#x73B0;&#x5BF9;&#x754C;&#x9762;&#x4E2D;&#x5706;&#x70B9;&#x9009;&#x4E2D;&#x5207;&#x6362;&#x4E0E;&#x63CF;&#x8FF0;&#x6587;&#x672C;&#x7684;&#x5185;&#x5BB9;&#x7684;&#x53D8;&#x66F4;,&#x4EE3;&#x7801;&#x4E0D;&#x662F;&#x5F88;&#x591A;,&#x76F4;&#x63A5;&#x770B;&#x6E90;&#x7801;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">   public void onPageSelected(int position) {</span><br><span class=\"line\">       mCurrentPos = position;</span><br><span class=\"line\">       if (bottomStyle == getResources().getInteger(R.integer.loop_have_descript))</span><br><span class=\"line\">           descript.setText(list.get(position % list.size()).getDescript());</span><br><span class=\"line\">       for (int i = 0; i &lt; linearLayout.getChildCount(); i++) {</span><br><span class=\"line\">           if (i == position % list.size())</span><br><span class=\"line\">               linearLayout.getChildAt(i).setSelected(true);</span><br><span class=\"line\">           else</span><br><span class=\"line\">               linearLayout.getChildAt(i).setSelected(false);</span><br><span class=\"line\">       }</span><br><span class=\"line\">   }</span><br></pre></td></tr></table></figure>\n<h2 id=\"setOnTouchListener\"><a href=\"#setOnTouchListener\" class=\"headerlink\" title=\"setOnTouchListener\"></a>setOnTouchListener</h2><p>&#x5B9E;&#x73B0;&#x89E6;&#x6478;&#x76D1;&#x542C;&#x4E3B;&#x8981;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x5728;&#x6211;&#x4EEC;&#x624B;&#x52A8;&#x5207;&#x6362;&#x65F6;&#xFF0C;<code>LoopView</code>&#x8FD8;&#x5728;&#x81EA;&#x5DF1;&#x5FAA;&#x73AF;&#x5207;&#x6362;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4F7F;&#x5F97;&#x6211;&#x4EEC;&#x624B;&#x52A8;&#x5207;&#x6362;&#x65F6;&#x4E0D;&#x534F;&#x8C03;&#x3002;&#x6211;&#x4EEC;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x624B;&#x6307;&#x89E6;&#x6478;&#x5230;<code>LoopView</code>&#x65F6;&#x505C;&#x6B62;&#x81EA;&#x52A8;&#x5FAA;&#x73AF;&#xFF0C;&#x5373;<code>ACTION_DOWN</code>&#x4E0E;<code>ACTION_MOVE</code>&#x3002;&#x5728;&#x624B;&#x6307;&#x79BB;&#x5F00;&#x65F6;&#x5F00;&#x542F;&#x5FAA;&#x73AF;&#xFF0C;&#x5373;<code>ACTION_UP</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">   public boolean onTouch(View view, MotionEvent motionEvent) {</span><br><span class=\"line\">       switch (motionEvent.getAction()) {</span><br><span class=\"line\">           case MotionEvent.ACTION_DOWN:</span><br><span class=\"line\">           case MotionEvent.ACTION_MOVE:</span><br><span class=\"line\">               pauseLoop();</span><br><span class=\"line\">               break;</span><br><span class=\"line\">           case MotionEvent.ACTION_UP:</span><br><span class=\"line\">               if (mSes.isShutdown())</span><br><span class=\"line\">                   startLoop();</span><br><span class=\"line\">               break;</span><br><span class=\"line\">       }</span><br><span class=\"line\">       return false;</span><br><span class=\"line\">   }</span><br></pre></td></tr></table></figure>\n<p>&#x81F3;&#x4E8E;&#x5FAA;&#x73AF;&#x64AD;&#x653E;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x662F;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x6027;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x8BA9;&#x5B83;&#x5FAA;&#x73AF;&#x81EA;&#x52A8;&#x64CD;&#x4F5C;&#xFF0C;&#x501F;&#x52A9;&#x7684;&#x662F;<code>ScheduledExecutorService</code>&#x3002;&#x4E0B;&#x9762;&#x662F;<code>pauseLoop();</code>&#x4E0E;<code>startLoop()</code>&#x4EE3;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected void startLoop() {</span><br><span class=\"line\">        mSes = Executors.newSingleThreadScheduledExecutor();</span><br><span class=\"line\">        mSes.scheduleAtFixedRate(new AutoRunnable(), rate, rate, TimeUnit.SECONDS);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    protected void pauseLoop() {</span><br><span class=\"line\">        mSes.shutdown();</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x6765;&#x63A7;&#x5236;&#x4E0E;&#x5B9E;&#x73B0;&#x5FAA;&#x73AF;&#x8F6E;&#x64AD;&#xFF0C;&#x539F;&#x7406;&#x5C31;&#x4ECB;&#x7ECD;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x4E0B;&#x9762;&#x6765;&#x8BF4;&#x4E0B;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x5982;&#x4F55;&#x4F7F;&#x7528;</em></p>\n</blockquote>\n<h1 id=\"&#x4F7F;&#x7528;\"><a href=\"#&#x4F7F;&#x7528;\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;\"></a>&#x4F7F;&#x7528;</h1><h2 id=\"&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\"><a href=\"#&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\" class=\"headerlink\" title=\"&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\"></a>&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;</h2><h3 id=\"Maven\"><a href=\"#Maven\" class=\"headerlink\" title=\"Maven\"></a>Maven</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">  &lt;groupId&gt;com.idisfkj.loopview&lt;/groupId&gt;</span><br><span class=\"line\">  &lt;artifactId&gt;loopview&lt;/artifactId&gt;</span><br><span class=\"line\">  &lt;version&gt;2.0.0&lt;/version&gt;</span><br><span class=\"line\">  &lt;type&gt;pom&lt;/type&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Gradle\"><a href=\"#Gradle\" class=\"headerlink\" title=\"Gradle\"></a>Gradle</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">compile &apos;com.idisfkj.loopview:loopview:2.0.0&apos;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x9700;&#x6C42;&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;</em></p>\n</blockquote>\n<h2 id=\"&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#x4E2D;&#x5F15;&#x7528;\"><a href=\"#&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#x4E2D;&#x5F15;&#x7528;\" class=\"headerlink\" title=\"&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#x4E2D;&#x5F15;&#x7528;\"></a>&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#x4E2D;&#x5F15;&#x7528;</h2><p>&#x9996;&#x5148;&#x5728;&#x6839;&#x5E03;&#x5C40;&#x4E2D;&#x52A0;&#x4E0A;&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;&#x7684;&#x5F15;&#x7528;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xmlns:loop=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br></pre></td></tr></table></figure>\n<p>&#x5F15;&#x7528;<code>LoopView</code>&#x63A7;&#x4EF6;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;com.idisfkj.loopview.LoopView</span><br><span class=\"line\">            android:id=&quot;@+id/loop_view&quot;</span><br><span class=\"line\">            android:layout_width=&quot;match_parent&quot;</span><br><span class=\"line\">            android:layout_height=&quot;200dp&quot;</span><br><span class=\"line\">            loop:bottom_style=&quot;@integer/loop_have_descript&quot;</span><br><span class=\"line\">            loop:rate=&quot;3&quot;&gt;</span><br><span class=\"line\">&lt;/com.idisfkj.loopview.LoopView&gt;</span><br></pre></td></tr></table></figure>\n<p><code>bottom_style</code>&#x4EE3;&#x8868;<code>LoopView</code>&#x5E95;&#x90E8;&#x6837;&#x5F0F;&#xFF0C;&#x6709;&#x4E09;&#x4E2A;&#x53EF;&#x9009;&#x503C;,&#x9ED8;&#x8BA4;&#x4E3A;<code>loop_have_descript</code></p>\n<ul>\n<li>loop_have_descript &#x4EE3;&#x8868;&#x6709;&#x63CF;&#x8FF0;&#x7684;&#x5E03;&#x5C40;</li>\n<li>loop_no_descript_right &#x4EE3;&#x8868;&#x6CA1;&#x6709;&#x63CF;&#x8FF0;&#x4E14;&#x5706;&#x70B9;&#x5C45;&#x53F3;&#x7684;&#x5E03;&#x5C40;</li>\n<li>loop_no_descript_center &#x4EE3;&#x8868;&#x6CA1;&#x6709;&#x63CF;&#x8FF0;&#x4E14;&#x5706;&#x70B9;&#x5C45;&#x4E2D;&#x7684;&#x5E03;&#x5C40;</li>\n</ul>\n<p><code>rate</code>&#x4EE3;&#x8868;&#x8F6E;&#x64AD;&#x7684;&#x901F;&#x5EA6;&#xFF0C;<code>&#x5355;&#x4F4D;&#x4E3A;s</code>,&#x9ED8;&#x8BA4;&#x4E3A;3s</p>\n<h2 id=\"&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x56FE;&#x7247;\"><a href=\"#&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x56FE;&#x7247;\" class=\"headerlink\" title=\"&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x56FE;&#x7247;\"></a>&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x56FE;&#x7247;</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">loopView.setDefaultImageView(xxx);</span><br><span class=\"line\">loopView.setErrorImageView(xxx);</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x586B;&#x5145;&#x6570;&#x636E;\"><a href=\"#&#x586B;&#x5145;&#x6570;&#x636E;\" class=\"headerlink\" title=\"&#x586B;&#x5145;&#x6570;&#x636E;\"></a>&#x586B;&#x5145;&#x6570;&#x636E;</h2><p>&#x586B;&#x5145;&#x6570;&#x636E;&#x9700;&#x8981;&#x501F;&#x52A9;<code>LoopViewEntity</code>&#x5B9E;&#x4F53;&#x7C7B;&#x6765;&#x5B58;&#x50A8;,&#x4F8B;&#x5982;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for (int i = 0; i &lt; urls.length; i++) {</span><br><span class=\"line\">            LoopViewEntity entity = new LoopViewEntity();</span><br><span class=\"line\">            entity.setImageUrl(urls[i]);</span><br><span class=\"line\">            entity.setDescript(descripts[i]);</span><br><span class=\"line\">            list.add(entity);</span><br><span class=\"line\">        }</span><br><span class=\"line\">loopView.setLoopData(list);</span><br></pre></td></tr></table></figure>\n<h2 id=\"item&#x70B9;&#x51FB;&#x76D1;&#x542C;\"><a href=\"#item&#x70B9;&#x51FB;&#x76D1;&#x542C;\" class=\"headerlink\" title=\"item&#x70B9;&#x51FB;&#x76D1;&#x542C;\"></a>item&#x70B9;&#x51FB;&#x76D1;&#x542C;</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">loopView.setOnItemClickListener(new LoopView.OnItemClickListener() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onItemClick(int position) {</span><br><span class=\"line\">                //to do ...</span><br><span class=\"line\">            }</span><br><span class=\"line\">        });</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x6B22;&#x8FCE;Star&#x4E0E;Fork&#xFF0C;&#x5982;&#x6709;&#x9700;&#x8981;&#x540E;&#x7EED;&#x6211;&#x4F1A;&#x7EE7;&#x7EED;&#x4F18;&#x5316;&#xFF0C;&#x6216;&#x8005;&#x52A0;&#x5165;&#x4E0E;&#x6211;&#x4E00;&#x8D77;&#x6765;&#x4F18;&#x5316;</em></p>\n</blockquote>\n<p>&#x9879;&#x76EE;&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/idisfkj/AndroidLoopView\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/AndroidLoopView</a></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["ViewPager"]},{"title":"RecyclerView下拉刷新与上拉更多","url":"https://www.rousetime.com/2016/08/03/RecyclerView下拉刷新与上拉更多/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p>&#x5728;&#x539F;&#x6765;&#x7684;&#x6587;&#x7AE0;&#x4E2D;&#x6211;&#x63D0;&#x53CA;&#x4E86;&#x5982;&#x4F55;&#x4F7F;&#x7528;<code>RecyclerView</code>&#x6DFB;&#x52A0;<code>header</code>&#x4E0E;<code>footer</code>&#xFF0C;&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x6765;&#x66F4;&#x6DF1;&#x5165;&#x7684;&#x6269;&#x5C55;&#x4E00;&#x4E0B;&#x4F7F;&#x7528;<code>RecyclerView</code>&#x5B9E;&#x73B0;&#x5E38;&#x7528;&#x7684;&#x4E0B;&#x62C9;&#x5237;&#x65B0;&#x4E0E;&#x4E0A;&#x62C9;&#x52A0;&#x8F7D;&#x66F4;&#x591A;&#x7684;&#x529F;&#x80FD;&#x3002;&#x5F53;&#x7136;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x7684;&#x5B9E;&#x73B0;&#x4E5F;&#x662F;&#x57FA;&#x4E8E;&#x524D;&#x9762;&#x7684;<a href=\"https://idisfkj.github.io/2016/07/05/RecyclerView%E6%B7%BB%E5%8A%A0header%E4%B8%8Efooter/\" target=\"_blank\" rel=\"noopener\">RecyclerView&#x6DFB;&#x52A0;header&#x4E0E;footer</a>&#x4E3A;&#x57FA;&#x7840;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x4E0D;&#x662F;&#x5F88;&#x4E86;&#x89E3;&#x7684;&#x53EF;&#x4EE5;&#x5148;&#x770B;&#x770B;&#x524D;&#x9762;&#x7684;&#x6587;&#x7AE0;&#x53EF;&#x80FD;&#x80FD;&#x66F4;&#x597D;&#x7684;&#x5E2E;&#x52A9;&#x7406;&#x89E3;&#x3002;</p>\n<h2 id=\"&#x4F9D;&#x8D56;\"><a href=\"#&#x4F9D;&#x8D56;\" class=\"headerlink\" title=\"&#x4F9D;&#x8D56;\"></a>&#x4F9D;&#x8D56;</h2><p>&#x4E3A;&#x4E86;&#x65B9;&#x6CD5;&#x5927;&#x5BB6;&#x7684;&#x4F7F;&#x7528;&#x6211;&#x5DF2;&#x7ECF;&#x628A;&#x4ED6;&#x4E0A;&#x4F20;&#x5230;<code>Jcenter</code>&#x4E2D;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E86;&#x76F4;&#x63A5;&#x83B7;&#x53D6;&#x4F7F;&#x7528;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">compile &apos;com.idisfkj.enchancerecyclerview:mylibrary:1.1.1&apos;</span><br></pre></td></tr></table></figure>\n<h2 id=\"EnhanceRecyclerView\"><a href=\"#EnhanceRecyclerView\" class=\"headerlink\" title=\"EnhanceRecyclerView\"></a>EnhanceRecyclerView</h2><p>&#x6211;&#x5C06;&#x8FD9;&#x4E2A;&#x6269;&#x5C55;&#x7684;<code>RecyclerView</code>&#x547D;&#x540D;&#x4E3A;<code>EnhanceRecyclerView</code>&#xFF0C;&#x7EE7;&#x627F;<code>RecyclerView</code>&#x3002;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x65E2;&#x7136;&#x8981;&#x5B9E;&#x73B0;&#x4E0B;&#x62C9;&#x5237;&#x65B0;&#x4E0E;&#x4E0A;&#x62C9;&#x66F4;&#x591A;&#x81EA;&#x7136;&#x5148;&#x8981;&#x5B9E;&#x73B0;&#x5934;&#x90E8;&#x4E0E;&#x5C3E;&#x90E8;&#x7684;&#x5E03;&#x5C40;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5148;&#x5229;&#x7528;&#x524D;&#x9762;&#x7684;&#x77E5;&#x8BC6;&#x6765;&#x4E3A;<code>EnhanceRecycleView</code>&#x6DFB;&#x52A0;<code>header</code>&#x4E0E;<code>footer</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void initView() {</span><br><span class=\"line\">        View headerView = LayoutInflater.from(getContext()).inflate(R.layout.head_layout, null);</span><br><span class=\"line\">        View footerView = LayoutInflater.from(getContext()).inflate(R.layout.footer_layout, null);</span><br><span class=\"line\">        addHeaderView(headerView);</span><br><span class=\"line\">        addFooterView(footerView);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x5176;&#x4E2D;&#x7684;&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x81F3;&#x4E8E;addHeaderView&#x4E0E;addFooterView&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x6211;&#x524D;&#x9762;&#x7684;&#x90A3;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x6709;&#x8BE6;&#x7EC6;&#x7684;&#x4ECB;&#x7ECD;</em></p>\n</blockquote>\n<h2 id=\"&#x8BBE;&#x7F6E;&#x76D1;&#x542C;&#x5668;\"><a href=\"#&#x8BBE;&#x7F6E;&#x76D1;&#x542C;&#x5668;\" class=\"headerlink\" title=\"&#x8BBE;&#x7F6E;&#x76D1;&#x542C;&#x5668;\"></a>&#x8BBE;&#x7F6E;&#x76D1;&#x542C;&#x5668;</h2><p>&#x65E2;&#x7136;&#x8981;&#x5B9E;&#x73B0;&#x4E0B;&#x62C9;&#x5237;&#x65B0;&#x4E0E;&#x4E0A;&#x62C9;&#x52A0;&#x8F7D;&#xFF0C;&#x81EA;&#x7136;&#x5C11;&#x4E0D;&#x4E86;&#x5BF9;&#x76D1;&#x542C;&#x5668;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x6240;&#x4EE5;&#x4E0B;&#x9762;&#x6765;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E0B;&#x5BF9;&#x76D1;&#x542C;&#x5668;<code>OnScrollListener</code>&#x4E0E;<code>OnTouchListener</code>&#x7684;&#x5904;&#x7406;&#x3002;</p>\n<h2 id=\"OnScrollListener\"><a href=\"#OnScrollListener\" class=\"headerlink\" title=\"OnScrollListener\"></a>OnScrollListener</h2><p>&#x4E3A;<code>EnhanceRecyclerView</code>&#x6DFB;&#x52A0;<code>addOnScrollListener</code>&#x5B9E;&#x73B0;&#x5176;&#x4E2D;&#x7684;<code>onScrollStateChanged</code>&#x4E0E;<code>onScrolled</code>&#x65B9;&#x6CD5;&#x3002;</p>\n<h3 id=\"onScrolled\"><a href=\"#onScrolled\" class=\"headerlink\" title=\"onScrolled\"></a>onScrolled</h3><p>&#x5728;<code>onScrolled</code>&#x4E2D;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x505A;&#x7684;&#x662F;&#x83B7;&#x53D6;<code>EnhanceRcyclerView</code>&#x4E2D;<code>item</code>&#x7684;&#x603B;&#x6570;&#x91CF;&#x3001;&#x89C6;&#x56FE;&#x663E;&#x793A;&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;<code>item</code>&#x5728;<code>EnhanceRecyclerView</code>&#x4E2D;&#x6240;&#x5904;&#x7684;&#x4F4D;&#x7F6E;&#x4E0E;&#x89C6;&#x56FE;&#x663E;&#x793A;&#x4E2D;&#x6700;&#x540E;&#x4E00;&#x4E2A;<code>item</code>&#x5728;<code>EnhanceRecyclerView</code>&#x4E2D;&#x6240;&#x5904;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;<code>item</code>&#x7684;&#x603B;&#x6570;&#x91CF;&#x5F88;&#x597D;&#x83B7;&#x53D6;&#x76F4;&#x63A5;&#x8C03;&#x7528;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">totalCount = getLayoutManager().getItemCount();</span><br></pre></td></tr></table></figure>\n<p>&#x7531;&#x4E8E;<code>RecyclerView</code>&#x80FD;&#x5B9E;&#x73B0;<code>LinearLayoutManager</code>&#x3001;<code>GridLayoutManager</code>&#x4E0E;<code>StaggeredGridLayoutManager</code>&#x4E0D;&#x540C;&#x7684;&#x5E03;&#x5C40;&#xFF0C;&#x6240;&#x4EE5;&#x53E6;&#x5916;&#x4E24;&#x4E2A;&#x8981;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;<code>manager</code>&#x6765;&#x83B7;&#x53D6;,&#x8FD8;&#x662F;&#x770B;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5427;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (getLayoutManager() instanceof LinearLayoutManager) {</span><br><span class=\"line\">                    lastItem = ((LinearLayoutManager) getLayoutManager()).findLastVisibleItemPosition();</span><br><span class=\"line\">                    firstVisible = ((LinearLayoutManager) getLayoutManager()).findFirstVisibleItemPosition();</span><br><span class=\"line\">                } else {</span><br><span class=\"line\">                    into = ((StaggeredGridLayoutManager) getLayoutManager()).findLastVisibleItemPositions(into);</span><br><span class=\"line\">                    firstInto = ((StaggeredGridLayoutManager) getLayoutManager()).findFirstVisibleItemPositions(firstInto);</span><br><span class=\"line\">                    lastItem = into[0];</span><br><span class=\"line\">                    firstVisible = firstInto[0];</span><br><span class=\"line\">                }</span><br></pre></td></tr></table></figure>\n<h3 id=\"onScrollStateChanged\"><a href=\"#onScrollStateChanged\" class=\"headerlink\" title=\"onScrollStateChanged\"></a>onScrollStateChanged</h3><p>&#x83B7;&#x53D6;&#x5230;&#x4E86;&#x90A3;&#x4E09;&#x4E2A;&#x5173;&#x952E;&#x6570;&#x636E;&#x4EE5;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5728;<code>onScrollStateChanged</code>&#x4E2D;&#x5B9E;&#x73B0;&#x5177;&#x4F53;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#x4E3B;&#x8981;&#x5B9E;&#x73B0;&#x7684;&#x662F;&#x5BF9;&#x4E0A;&#x62C9;&#x52A0;&#x8F7D;&#x66F4;&#x591A;&#x7684;&#x5904;&#x7406;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (lastItem == adapter.getItemCount() + 1 &amp;&amp; newState == RecyclerView.SCROLL_STATE_IDLE &amp;&amp; !isLoad) {</span><br><span class=\"line\">                    ViewGroup.LayoutParams params = getFooterView(0).getLayoutParams();</span><br><span class=\"line\">                    params.width = RecyclerView.LayoutParams.MATCH_PARENT;</span><br><span class=\"line\">                    params.height = RecyclerView.LayoutParams.WRAP_CONTENT;</span><br><span class=\"line\">                    getFooterView(0).setLayoutParams(params);</span><br><span class=\"line\">                    getFooterView(0).setVisibility(View.VISIBLE);</span><br><span class=\"line\">                    smoothScrollToPosition(totalCount);</span><br><span class=\"line\">                    isLoad = true;</span><br><span class=\"line\">                    loadMoreListener.onLoadMore();</span><br><span class=\"line\">                }</span><br><span class=\"line\">                if (firstVisible == 0) {</span><br><span class=\"line\">                    isTop = true;</span><br><span class=\"line\">                } else {</span><br><span class=\"line\">                    isTop = false;</span><br><span class=\"line\">                    RecyclerView.LayoutParams params = (RecyclerView.LayoutParams) getHeaderView(0).getLayoutParams();</span><br><span class=\"line\">                    params.width = RecyclerView.LayoutParams.MATCH_PARENT;</span><br><span class=\"line\">                    params.height = RecyclerView.LayoutParams.WRAP_CONTENT;</span><br><span class=\"line\">                    params.setMargins(0, -getHeaderView(0).getHeight(), 0, 0);</span><br><span class=\"line\">                    getHeaderView(0).setLayoutParams(params);</span><br><span class=\"line\">                }</span><br></pre></td></tr></table></figure>\n<p>&#x7B80;&#x5355;&#x8BF4;&#x660E;&#x4E0B;&#xFF0C;&#x6838;&#x5FC3;&#x5C31;&#x662F;&#x5224;&#x65AD;<code>lastItem</code>&#x662F;&#x5426;&#x5904;&#x5728;&#x6700;&#x540E;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x7684;&#x8BDD;&#x5C31;&#x7EE7;&#x7EED;&#x52A0;&#x8F7D;&#x66F4;&#x591A;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x8FD9;&#x91CC;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x5BF9;&#x6570;&#x636E;&#x5904;&#x7406;&#x7684;&#x63A5;&#x53E3;&#x6240;&#x4EE5;&#x53EA;&#x8981;&#x5B9E;&#x73B0;<code>loadMoreListener.onLoadMore();</code>&#x5373;&#x53EF;&#x3002;</p>\n<blockquote>\n<p><em>&#x4E0A;&#x62C9;&#x52A0;&#x8F7D;&#x66F4;&#x591A;&#x6838;&#x5FC3;&#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x5176;&#x5B83;&#x7684;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x6E90;&#x7801;</em></p>\n</blockquote>\n<h2 id=\"OnTouchListener\"><a href=\"#OnTouchListener\" class=\"headerlink\" title=\"OnTouchListener\"></a>OnTouchListener</h2><p>&#x8FD9;&#x4E2A;&#x76D1;&#x542C;&#x5668;&#x4E3B;&#x8981;&#x662F;&#x5BF9;&#x4E0B;&#x62C9;&#x5237;&#x65B0;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;&#x6211;&#x4EEC;&#x8981;&#x5206;&#x522B;&#x5BF9;&#x5176;&#x4E2D;&#x6211;&#x4EEC;&#x6240;&#x719F;&#x6089;&#x7684;<code>MotionEvent.ACTION_DOWN</code>&#x3001;<code>MotionEvent.ACTION_MOVE</code>&#x4E0E;<code>MotionEvent.ACTION_UP</code>&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;<code>ACTION_DOWN</code>&#x5C31;&#x662F;&#x7B80;&#x5355;&#x7684;&#x83B7;&#x53D6;&#x6309;&#x4E0B;&#x7684;&#x5750;&#x6807;&#x4F4D;&#x7F6E;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x4E3B;&#x8981;&#x7684;&#x9488;&#x5BF9;&#x53E6;&#x5916;&#x7684;&#x4E24;&#x4E2A;&#x8FDB;&#x884C;&#x7B80;&#x5355;&#x8BF4;&#x660E;&#x3002;</p>\n<h3 id=\"ACTION-MOVE\"><a href=\"#ACTION-MOVE\" class=\"headerlink\" title=\"ACTION_MOVE\"></a>ACTION_MOVE</h3><p>&#x8FD9;&#x505A;&#x7684;&#x903B;&#x8F91;&#x5C31;&#x662F;&#x5BF9;&#x89E6;&#x6478;&#x540E;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x6839;&#x636E;&#x6ED1;&#x52A8;&#x7684;&#x8DDD;&#x79BB;&#x6765;&#x52A8;&#x6001;&#x7684;&#x6539;&#x53D8;<code>header</code>&#x7684;&#x6587;&#x672C;&#x4E0E;&#x5E03;&#x5C40;&#x89C6;&#x56FE;&#x7684;&#x663E;&#x793A;&#x3002;    </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void touchMove(MotionEvent event) {</span><br><span class=\"line\">        endY = event.getY();</span><br><span class=\"line\">        moveY = endY - startY;</span><br><span class=\"line\">        //&#x9632;&#x6B62;item&#x5411;&#x4E0A;&#x6ED1;&#x51FA;</span><br><span class=\"line\">        if (moveY &gt; 0 &amp;&amp; !isRefreshing) {</span><br><span class=\"line\">            //&#x9632;&#x6B62;&#x56DE;&#x9000;&#x6587;&#x672C;&#x663E;&#x793A;&#x5F02;&#x5E38;</span><br><span class=\"line\">            scrollToPosition(0);</span><br><span class=\"line\"></span><br><span class=\"line\">            if (getHeaderView(0).getVisibility() == GONE)</span><br><span class=\"line\">                getHeaderView(0).setVisibility(VISIBLE);</span><br><span class=\"line\"></span><br><span class=\"line\">            RecyclerView.LayoutParams params = (RecyclerView.LayoutParams) getHeaderView(0).getLayoutParams();</span><br><span class=\"line\">            params.width = RecyclerView.LayoutParams.MATCH_PARENT;</span><br><span class=\"line\">            params.height = RecyclerView.LayoutParams.WRAP_CONTENT;</span><br><span class=\"line\">            //&#x4F7F;header&#x968F;moveY&#x7684;&#x503C;&#x4ECE;&#x9876;&#x90E8;&#x6E10;&#x6E10;&#x51FA;&#x73B0;</span><br><span class=\"line\">            if (moveY &gt;= 400) {</span><br><span class=\"line\">                moveY = 100 + moveY / 4;</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                moveY = moveY / 2;</span><br><span class=\"line\">            }</span><br><span class=\"line\">            viewHeight = getHeaderView(0).getHeight();</span><br><span class=\"line\">            if (viewHeight &lt;= 0)</span><br><span class=\"line\">                viewHeight = 130;</span><br><span class=\"line\">            moveY = moveY - viewHeight;</span><br><span class=\"line\">            params.setMargins(0, (int) moveY, 0, 0);</span><br><span class=\"line\">            getHeaderView(0).setLayoutParams(params);</span><br><span class=\"line\">            if (moveY &gt; 80) {</span><br><span class=\"line\">                text.setText(getResources().getString(R.string.release_to_refresh));</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                text.setText(getResources().getString(R.string.pull_to_refresh));</span><br><span class=\"line\">            }</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            if (getHeaderView(0).getVisibility() != GONE &amp;&amp; !isRefreshing) {</span><br><span class=\"line\">                getHeaderView(0).setVisibility(GONE);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x81F3;&#x4E8E;&#x4E0B;&#x62C9;&#x65F6;&#x4E0E;&#x9876;&#x90E8;&#x7684;&#x8DDD;&#x79BB;&#x53D8;&#x5316;&#x662F;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;<code>margin</code>&#x6765;&#x52A8;&#x6001;&#x6539;&#x53D8;&#x7684;&#x3002;</p>\n<h3 id=\"ACTION-UP\"><a href=\"#ACTION-UP\" class=\"headerlink\" title=\"ACTION_UP\"></a>ACTION_UP</h3><p>&#x6700;&#x540E;&#x7684;&#x89E6;&#x6478;&#x5904;&#x7406;&#x5C31;&#x662F;&#x5728;&#x79BB;&#x5F00;&#x5C4F;&#x5E55;&#x65F6;&#x6839;&#x636E;&#x6ED1;&#x52A8;&#x7684;&#x8DDD;&#x79BB;&#xFF0C;&#x662F;&#x5426;&#x8C03;&#x7528;&#x52A0;&#x8F7D;&#x6570;&#x636E;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x6216;&#x8005;&#x9690;&#x85CF;&#x4E0B;&#x62C9;&#x5237;&#x65B0;&#x5934;&#x90E8;&#xFF0C;&#x5177;&#x4F53;&#x8FD8;&#x662F;&#x770B;&#x4EE3;&#x7801;&#x5427;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void touchUp() {</span><br><span class=\"line\">        if (!isRefreshing &amp;&amp; (endY -startY) != 0 ) {</span><br><span class=\"line\"></span><br><span class=\"line\">            RecyclerView.LayoutParams params1 = (RecyclerView.LayoutParams) getHeaderView(0).getLayoutParams();</span><br><span class=\"line\">            params1.width = RecyclerView.LayoutParams.MATCH_PARENT;</span><br><span class=\"line\">            params1.height = RecyclerView.LayoutParams.WRAP_CONTENT;</span><br><span class=\"line\"></span><br><span class=\"line\">            if (moveY &gt;= 80) {</span><br><span class=\"line\">                text.setText(getResources().getString(R.string.refreshing));</span><br><span class=\"line\">                params1.setMargins(0, 0, 0, 0);</span><br><span class=\"line\">                isRefreshing = true;</span><br><span class=\"line\">                //&#x5237;&#x65B0;&#x6570;&#x636E;</span><br><span class=\"line\">                pullToRefresh.onRefreshing();</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                if (viewHeight &lt;= 0)</span><br><span class=\"line\">                    viewHeight = 130;</span><br><span class=\"line\">                params1.setMargins(0, -viewHeight, 0, 0);</span><br><span class=\"line\">                getHeaderView(0).setVisibility(GONE);</span><br><span class=\"line\">            }</span><br><span class=\"line\">            getHeaderView(0).setLayoutParams(params1);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x4EE3;&#x7801;&#x4E2D;&#x91CD;&#x8981;&#x7684;&#x5730;&#x65B9;&#x90FD;&#x6709;&#x6307;&#x51FA;&#x76F8;&#x4FE1;&#x90FD;&#x80FD;&#x770B;&#x61C2;&#xFF0C;&#x8FD9;&#x6837;&#x4E0B;&#x62C9;&#x4E0E;&#x4E0A;&#x62C9;&#x7684;&#x903B;&#x8F91;&#x5C31;&#x57FA;&#x672C;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x6765;&#x770B;&#x63A5;&#x53E3;&#x7684;&#x8BBE;&#x8BA1;&#x5427;</em></p>\n</blockquote>\n<h2 id=\"&#x4E0B;&#x62C9;&#x4E0E;&#x4E0A;&#x62C9;&#x63A5;&#x53E3;\"><a href=\"#&#x4E0B;&#x62C9;&#x4E0E;&#x4E0A;&#x62C9;&#x63A5;&#x53E3;\" class=\"headerlink\" title=\"&#x4E0B;&#x62C9;&#x4E0E;&#x4E0A;&#x62C9;&#x63A5;&#x53E3;\"></a>&#x4E0B;&#x62C9;&#x4E0E;&#x4E0A;&#x62C9;&#x63A5;&#x53E3;</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface PullToRefreshListener {</span><br><span class=\"line\">        void onRefreshing();</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setPullToRefreshListener(PullToRefreshListener pullToRefresh) {</span><br><span class=\"line\">        if (loadMoreListener == null) {</span><br><span class=\"line\">            initListener();</span><br><span class=\"line\">        }</span><br><span class=\"line\">        this.pullToRefresh = pullToRefresh;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public interface LoadMoreListener {</span><br><span class=\"line\">        void onLoadMore();</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setLoadMoreListener(LoadMoreListener loadMoreListener) {</span><br><span class=\"line\">        if (pullToRefresh == null) {</span><br><span class=\"line\">            initListener();</span><br><span class=\"line\">        }</span><br><span class=\"line\">        this.loadMoreListener = loadMoreListener;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5728;&#x8FD0;&#x7528;&#x662F;&#x6DFB;&#x52A0;&#x63A5;&#x53E3;&#x76D1;&#x542C;&#x65F6;&#x521D;&#x59CB;&#x5316;&#x524D;&#x9762;&#x4E3A;<code>EnhanceRecyclerView</code>&#x6240;&#x8BBE;&#x7F6E;&#x7684;&#x76D1;&#x542C;&#x3002;</p>\n<h2 id=\"&#x72B6;&#x6001;&#x91CD;&#x7F6E;&#x8BBE;&#x7F6E;\"><a href=\"#&#x72B6;&#x6001;&#x91CD;&#x7F6E;&#x8BBE;&#x7F6E;\" class=\"headerlink\" title=\"&#x72B6;&#x6001;&#x91CD;&#x7F6E;&#x8BBE;&#x7F6E;\"></a>&#x72B6;&#x6001;&#x91CD;&#x7F6E;&#x8BBE;&#x7F6E;</h2><p>&#x5728;&#x8C03;&#x7528;&#x4E0B;&#x62C9;&#x5237;&#x65B0;&#x6216;&#x8005;&#x4E0A;&#x62C9;&#x52A0;&#x8F7D;&#x66F4;&#x591A;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x4E3A;&#x5176;&#x6784;&#x9020;&#x901A;&#x7528;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#xFF0C;&#x72B6;&#x6001;&#x7684;&#x91CD;&#x7F6E;&#x4E0E;&#x6570;&#x636E;&#x7684;&#x66F4;&#x65B0;&#xFF0C;&#x65B9;&#x4FBF;&#x7EDF;&#x4E00;&#x8C03;&#x7528;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void setLoadMoreComplete() {</span><br><span class=\"line\">       RecyclerView.LayoutParams params = (LayoutParams) getFooterView(0).getLayoutParams();</span><br><span class=\"line\">       params.width = 0;</span><br><span class=\"line\">       params.height = 0;</span><br><span class=\"line\">       getFooterView(0).setLayoutParams(params);</span><br><span class=\"line\">       getFooterView(0).setVisibility(View.GONE);</span><br><span class=\"line\">       this.getAdapter().notifyDataSetChanged();</span><br><span class=\"line\">       isLoad = false;</span><br><span class=\"line\">   }</span><br><span class=\"line\"></span><br><span class=\"line\">   public void setRefreshComplete() {</span><br><span class=\"line\">       RecyclerView.LayoutParams params1 = (RecyclerView.LayoutParams) getHeaderView(0).getLayoutParams();</span><br><span class=\"line\">       params1.width = RecyclerView.LayoutParams.MATCH_PARENT;</span><br><span class=\"line\">       params1.height = RecyclerView.LayoutParams.WRAP_CONTENT;</span><br><span class=\"line\">       params1.setMargins(0, -getHeaderView(0).getHeight(), 0, 0);</span><br><span class=\"line\">       getHeaderView(0).setLayoutParams(params1);</span><br><span class=\"line\">       getHeaderView(0).setVisibility(GONE);</span><br><span class=\"line\">       this.getAdapter().notifyDataSetChanged();</span><br><span class=\"line\">       isRefreshing = false;</span><br><span class=\"line\">   }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x6240;&#x7528;&#x5DE5;&#x4F5C;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x4E0B;&#x9762;&#x6765;&#x505A;&#x4E2A;&#x8C03;&#x7528;&#x793A;&#x8303;</em></p>\n</blockquote>\n<h2 id=\"&#x4F7F;&#x7528;\"><a href=\"#&#x4F7F;&#x7528;\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;\"></a>&#x4F7F;&#x7528;</h2><h3 id=\"xml&#x4E2D;&#x5F15;&#x7528;\"><a href=\"#xml&#x4E2D;&#x5F15;&#x7528;\" class=\"headerlink\" title=\"xml&#x4E2D;&#x5F15;&#x7528;\"></a>xml&#x4E2D;&#x5F15;&#x7528;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;com.idisfkj.mylibrary.EnhanceRecyclerView</span><br><span class=\"line\">        android:id=&quot;@+id/recyclerView&quot;</span><br><span class=\"line\">        android:layout_width=&quot;match_parent&quot;</span><br><span class=\"line\">        android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class=\"line\">&lt;/com.idisfkj.mylibrary.EnhanceRecyclerView&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x8BBE;&#x7F6E;&#x76D1;&#x542C;\"><a href=\"#&#x8BBE;&#x7F6E;&#x76D1;&#x542C;\" class=\"headerlink\" title=\"&#x8BBE;&#x7F6E;&#x76D1;&#x542C;\"></a>&#x8BBE;&#x7F6E;&#x76D1;&#x542C;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mRecyclerView.setPullToRefreshListener(new com.idisfkj.mylibrary.EnhanceRecyclerView.PullToRefreshListener() {</span><br><span class=\"line\">           @Override</span><br><span class=\"line\">           public void onRefreshing() {</span><br><span class=\"line\">               refreshData();</span><br><span class=\"line\">           }</span><br><span class=\"line\">       });</span><br><span class=\"line\">       mRecyclerView.setLoadMoreListener(new EnhanceRecyclerView.LoadMoreListener() {</span><br><span class=\"line\">           @Override</span><br><span class=\"line\">           public void onLoadMore() {</span><br><span class=\"line\">               loadMoreData();</span><br><span class=\"line\">           }</span><br><span class=\"line\">       });</span><br></pre></td></tr></table></figure>\n<p><code>refreshData()</code>&#x4E0E;<code>loadMoreData()</code>&#x52A0;&#x8F7D;&#x6570;&#x636E;&#x7684;&#x903B;&#x8F91;&#x5C31;&#x4E0D;&#x5C55;&#x793A;&#x4E86;&#xFF0C;&#x53EA;&#x662F;&#x8981;&#x8BB0;&#x4F4F;&#x5728;&#x8BF7;&#x6C42;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#x5B8C;&#x4E4B;&#x540E;&#x8981;&#x5728;&#x4ED6;&#x4EEC;&#x4E2D;&#x8C03;&#x7528;&#x76F8;&#x5E94;&#x7684;<code>mRecyclerView.setRefreshComplete()</code>&#x4E0E;<code>mRecyclerView.setLoadMoreComplete()</code>&#x6765;&#x91CD;&#x7F6E;&#x72B6;&#x6001;&#x3002;</p>\n<p>&#x81F3;&#x4E8E;&#x5176;&#x4ED6;&#x7684;<code>Adapter</code>&#x3001;<code>LayoutManager</code>&#x7B49;&#x7684;&#x8BBE;&#x7F6E;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x4E0E;&#x539F;&#x751F;&#x7684;<code>RecyclerView</code>&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>\n<h2 id=\"&#x6548;&#x679C;\"><a href=\"#&#x6548;&#x679C;\" class=\"headerlink\" title=\"&#x6548;&#x679C;\"></a>&#x6548;&#x679C;</h2><p><img src=\"/2016/08/03/RecyclerView&#x4E0B;&#x62C9;&#x5237;&#x65B0;&#x4E0E;&#x4E0A;&#x62C9;&#x66F4;&#x591A;/1.gif\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<h1 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h1><p>&#x5176;&#x5B9E;&#x603B;&#x7684;&#x6765;&#x8BF4;&#x96BE;&#x70B9;&#x6709;&#x4E24;&#x4E2A;</p>\n<ul>\n<li>&#x6DFB;&#x52A0;<code>header</code>&#x4E0E;<code>footer</code>&#x3002;&#x8FD9;&#x4E2A;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x653B;&#x514B;&#x4E86;&#xFF0C;&#x800C;&#x4E14;&#x539F;&#x7406;&#x4E5F;&#x76F8;&#x5BF9;&#x7B80;&#x5355;</li>\n<li>&#x5B9E;&#x73B0;&#x89E6;&#x6478;&#x4E0E;&#x6ED1;&#x52A8;&#x76D1;&#x542C;&#x903B;&#x8F91;&#x3002;&#x8FD9;&#x4E2A;&#x4E3B;&#x8981;&#x662F;&#x5BF9;&#x903B;&#x8F91;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x5BF9;&#x6574;&#x4E2A;&#x5237;&#x65B0;&#x7684;&#x8FC7;&#x7A0B;&#x505A;&#x4E2A;&#x6574;&#x4F53;&#x5206;&#x6790;&#xFF0C;&#x5C31;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x7406;&#x89E3;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x5BF9;&#x5176;&#x4E2D;&#x89C6;&#x56FE;&#x7684;&#x52A8;&#x6001;&#x663E;&#x793A;&#x505A;&#x76F8;&#x5E94;&#x7684;&#x53D8;&#x5316;&#x4E0E;&#x63A5;&#x53E3;&#x7684;&#x8C03;&#x7528;&#x5C31;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x5DE5;&#x7A0B;&#x3002;</li>\n</ul>\n<p>&#x5F53;&#x7136;&#x4E0A;&#x9762;&#x7684;&#x5B9E;&#x73B0;&#x53EF;&#x80FD;&#x8FD8;&#x6709;&#x7455;&#x75B5;&#xFF0C;&#x5E0C;&#x671B;&#x6307;&#x51FA;&#xFF0C;&#x6211;&#x4F1A;&#x76F8;&#x5E94;&#x7684;&#x505A;&#x4FEE;&#x6539;&#x6216;&#x8005;&#x4F60;&#x4EEC;&#x4FEE;&#x6539;&#x540E;&#x53EF;&#x4EE5;&#x63D0;&#x4EA4;&#x7ED9;&#x6211;&#xFF0C;&#x6211;&#x7EDF;&#x4E00;&#x505A;&#x4FEE;&#x6539;&#xFF0C;&#x8C22;&#x8C22;&#xFF01;</p>\n<p>&#x9879;&#x76EE;&#x5730;&#x5740;:<a href=\"https://github.com/idisfkj/EnhanceRecyclerView\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/EnhanceRecyclerView</a></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["RecyclerView"]},{"title":"RecyclerView添加header与footer","url":"https://www.rousetime.com/2016/07/05/RecyclerView添加header与footer/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p>&#x8FD9;&#x6B21;&#x4E3B;&#x8981;&#x5173;&#x4E8E;<code>RecyclerView</code>&#x6DFB;&#x52A0;<code>header</code>&#x548C;<code>footer</code>&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#xFF0C;&#x5728;&#x4F7F;&#x7528;<code>ListView</code>&#x7684;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x80FD;&#x81EA;&#x7531;&#x7684;&#x7ED9;&#x81EA;&#x5DF1;&#x7684;<code>ListView</code>&#x6DFB;&#x52A0;&#x5934;&#x90E8;&#x4E0E;&#x5C3E;&#x90E8;&#x3002;&#x4F7F;&#x7528;<code>addHeaderView()</code>&#x4E0E;<code>addFooterView()</code>&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x3002;&#x53EA;&#x8981;&#x81EA;&#x5DF1;&#x81EA;&#x5B9A;&#x4E49;&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#xFF0C;&#x6DFB;&#x52A0;&#x8FDB;&#x53BB;&#x5373;&#x53EF;&#x3002;&#x4F46;&#x5F53;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<code>RecyclerView</code>&#x7684;&#x65F6;&#x5019;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x4FBF;&#x7684;&#x65B9;&#x6CD5;&#x6CA1;&#x6709;&#x4E86;&#x3002;&#x90A3;&#x4E48;&#x5982;&#x679C;&#x6B64;&#x65F6;&#x6211;&#x4EEC;&#x8981;&#x5B9E;&#x73B0;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x65F6;&#x8981;&#x600E;&#x4E48;&#x529E;&#x5462;&#xFF1F;&#x4E0D;&#x6025;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x719F;&#x6089;&#x4E0B;<code>ListView</code>&#x7684;&#x6DFB;&#x52A0;<code>header</code>&#x4E0E;<code>footer</code>&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x3002;</p>\n<h1 id=\"ListView&#x6E90;&#x7801;\"><a href=\"#ListView&#x6E90;&#x7801;\" class=\"headerlink\" title=\"ListView&#x6E90;&#x7801;\"></a>ListView&#x6E90;&#x7801;</h1><p>&#x65E2;&#x7136;<code>ListView</code>&#x5B9E;&#x73B0;&#x4E86;&#x6DFB;&#x52A0;&#x5934;&#x90E8;&#x4E0E;&#x5C3E;&#x90E8;&#x7684;&#x539F;&#x7406;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5148;&#x8FDB;&#x5165;<code>ListView</code>&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x67E5;&#x770B;&#x5176;&#x4E2D;&#x7684;<code>addHeaderView()</code>&#x65B9;&#x6CD5;&#x4E0E;<code>addFooterView()</code>&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void addHeaderView(View v, Object data, boolean isSelectable) {</span><br><span class=\"line\">        final FixedViewInfo info = new FixedViewInfo();</span><br><span class=\"line\">        info.view = v;</span><br><span class=\"line\">        info.data = data;</span><br><span class=\"line\">        info.isSelectable = isSelectable;</span><br><span class=\"line\">        mHeaderViewInfos.add(info);</span><br><span class=\"line\">        mAreAllItemsSelectable &amp;= isSelectable;</span><br><span class=\"line\"></span><br><span class=\"line\">        // Wrap the adapter if it wasn&apos;t already wrapped.</span><br><span class=\"line\">        if (mAdapter != null) {</span><br><span class=\"line\">            if (!(mAdapter instanceof HeaderViewListAdapter)) {</span><br><span class=\"line\">                mAdapter = new HeaderViewListAdapter(mHeaderViewInfos, mFooterViewInfos, mAdapter);</span><br><span class=\"line\">            }</span><br><span class=\"line\"></span><br><span class=\"line\">            // In the case of re-adding a header view, or adding one later on,</span><br><span class=\"line\">            // we need to notify the observer.</span><br><span class=\"line\">            if (mDataSetObserver != null) {</span><br><span class=\"line\">                mDataSetObserver.onChanged();</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x8FD9;&#x91CC;&#x7701;&#x7565;addFooterView()&#x6E90;&#x7801;&#xFF0C;&#x5176;&#x5B9E;&#x8DDF;addHeaderView()&#x57FA;&#x672C;&#x4E00;&#x81F4;</em></p>\n</blockquote>\n<p>&#x901A;&#x8FC7;<code>addHeaderView()</code>&#x7684;&#x6E90;&#x7801;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x5B83;&#x662F;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;<code>FixedViewInfo</code>&#x7C7B;&#x6765;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class FixedViewInfo {</span><br><span class=\"line\">        /** The view to add to the list */</span><br><span class=\"line\">        public View view;</span><br><span class=\"line\">        /** The data backing the view. This is returned from {@link ListAdapter#getItem(int)}. */</span><br><span class=\"line\">        public Object data;</span><br><span class=\"line\">        /** &lt;code&gt;true&lt;/code&gt; if the fixed view should be selectable in the list */</span><br><span class=\"line\">        public boolean isSelectable;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x662F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (!(mAdapter instanceof HeaderViewListAdapter)) {</span><br><span class=\"line\">               mAdapter = new HeaderViewListAdapter(mHeaderViewInfos, mFooterViewInfos, mAdapter);</span><br><span class=\"line\">           }</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0;&#x5B83;<code>new</code>&#x4E86;&#x4E00;&#x4E2A;<code>HeaderViewListAdapter</code>&#x7C7B;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x518D;&#x8FDB;&#x5165;<code>HeaderViewListAdapter</code>&#x6E90;&#x7801;&#x4E2D;&#xFF0C;&#x53D1;&#x73B0;&#x4ED6;&#x5C31;&#x76F8;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<code>Adapter</code>&#x5BF9;<code>header</code>&#x4E0E;<code>footer</code>&#x7684;&#x5C01;&#x88C5;&#x3002;</p>\n<p>&#x4EE3;&#x7801;&#x90FD;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x601D;&#x60F3;&#xFF0C;&#x5176;&#x4E2D;&#x4E3B;&#x8981;&#x7684;&#x662F;&#x6709;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public int getCount() {</span><br><span class=\"line\">        if (mAdapter != null) {</span><br><span class=\"line\">            return getFootersCount() + getHeadersCount() + mAdapter.getCount();</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            return getFootersCount() + getHeadersCount();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x6839;&#x636E;<code>position</code>&#x6765;&#x8BBE;&#x7F6E;<code>ViewType</code>&#x7684;&#x503C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public int getItemViewType(int position) {</span><br><span class=\"line\">       int numHeaders = getHeadersCount();</span><br><span class=\"line\">       if (mAdapter != null &amp;&amp; position &gt;= numHeaders) {</span><br><span class=\"line\">           int adjPosition = position - numHeaders;</span><br><span class=\"line\">           int adapterCount = mAdapter.getCount();</span><br><span class=\"line\">           if (adjPosition &lt; adapterCount) {</span><br><span class=\"line\">               return mAdapter.getItemViewType(adjPosition);</span><br><span class=\"line\">           }</span><br><span class=\"line\">       }</span><br><span class=\"line\"></span><br><span class=\"line\">       return AdapterView.ITEM_VIEW_TYPE_HEADER_OR_FOOTER;</span><br><span class=\"line\">   }</span><br></pre></td></tr></table></figure>\n<p>&#x518D;&#x770B;<code>getView()</code>&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public View getView(int position, View convertView, ViewGroup parent) {</span><br><span class=\"line\">        // Header (negative positions will throw an IndexOutOfBoundsException)</span><br><span class=\"line\">        int numHeaders = getHeadersCount();</span><br><span class=\"line\">        if (position &lt; numHeaders) {</span><br><span class=\"line\">            return mHeaderViewInfos.get(position).view;</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        // Adapter</span><br><span class=\"line\">        final int adjPosition = position - numHeaders;</span><br><span class=\"line\">        int adapterCount = 0;</span><br><span class=\"line\">        if (mAdapter != null) {</span><br><span class=\"line\">            adapterCount = mAdapter.getCount();</span><br><span class=\"line\">            if (adjPosition &lt; adapterCount) {</span><br><span class=\"line\">                return mAdapter.getView(adjPosition, convertView, parent);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        // Footer (off-limits positions will throw an IndexOutOfBoundsException)</span><br><span class=\"line\">        return mFooterViewInfos.get(adjPosition - adapterCount).view;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x4E0E;<code>getItemViewType</code>&#x7C7B;&#x4F3C;&#xFF0C;&#x5F53;<code>position</code>&#x5C0F;&#x4E8E;<code>header</code>&#x7684;<code>count</code>&#x65F6;&#xFF0C;&#x6B64;&#x65F6;&#x8FD4;&#x56DE;&#x5934;&#x90E8;<code>View</code>,&#x5F53;<code>position</code>&#x51CF;&#x53BB;<code>headeer</code>&#x7684;<code>count</code>&#x65F6;&#x4F9D;&#x7136;&#x5C0F;&#x4E8E;&#x6B63;&#x5E38;&#x7684;<code>adapter</code>&#x7684;<code>count</code>,&#x6B64;&#x65F6;&#x8FD4;&#x56DE;&#x6B63;&#x5E38;&#x7684;<code>View</code>&#xFF0C;&#x5982;&#x679C;&#x8FD8;&#x6709;&#xFF0C;&#x81EA;&#x7136;&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F;<code>footer</code>&#x4E86;&#x3002;</p>\n<p>&#x6240;&#x4EE5;&#x6839;&#x636E;<code>ListView</code>&#x7684;&#x6DFB;&#x52A0;&#x5934;&#x90E8;&#x4E0E;&#x5C3E;&#x90E8;&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6A21;&#x4EFF;&#x5B9E;&#x73B0;<code>RecyclerView</code>&#x7684;&#x76F8;&#x540C;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<h1 id=\"EnhanceRecyclerView\"><a href=\"#EnhanceRecyclerView\" class=\"headerlink\" title=\"EnhanceRecyclerView\"></a>EnhanceRecyclerView</h1><p>&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x6839;&#x636E;<code>ListView</code>&#x6765;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x80FD;&#x591F;&#x6DFB;&#x52A0;<code>header</code>&#x4E0E;<code>footer</code>&#x7684;<code>RecyclerView</code>&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x5B9A;&#x4E49;&#x4E3A;<code>EnhanceRecyclerView</code></p>\n<h2 id=\"FixedViewInfo\"><a href=\"#FixedViewInfo\" class=\"headerlink\" title=\"FixedViewInfo\"></a>FixedViewInfo</h2><p>&#x5728;&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x770B;&#x5230;<code>ListView</code>&#x4E2D;&#x4F7F;&#x7528;&#x5230;&#x4E86;<code>FixedViewInfo</code>&#xFF0C;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x7C7B;&#xFF0C;&#x7528;&#x6765;&#x5B58;&#x50A8;&#x6570;&#x636E;&#xFF0C;&#x6211;&#x4EEC;&#x505A;&#x9002;&#x5F53;&#x7684;&#x4FEE;&#x6539;&#x5982;&#x4E0B;&#xFF0C;<code>View</code>&#x8FD8;&#x662F;&#x4E0D;&#x53D8;&#xFF0C;&#x4F9D;&#x7136;&#x662F;&#x6DFB;&#x52A0;&#x7684;&#x89C6;&#x56FE;&#xFF0C;&#x5C06;&#x5176;&#x4F59;&#x7684;&#x5220;&#x6389;&#xFF0C;&#x6362;&#x6210;<code>viewType</code>&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class FixedViewInfo {</span><br><span class=\"line\">        public View view;</span><br><span class=\"line\">        public int viewType;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<h2 id=\"addHeaderView&#x4E0E;addFooterView\"><a href=\"#addHeaderView&#x4E0E;addFooterView\" class=\"headerlink\" title=\"addHeaderView&#x4E0E;addFooterView\"></a>addHeaderView&#x4E0E;addFooterView</h2><p>&#x505A;&#x76F8;&#x5E94;&#x7684;&#x4FEE;&#x6539;&#xFF0C;&#x5176;&#x4E2D;<code>BASE_HEADER_VIEW_TYPE</code>&#x4E0E;<code>BASE_FOOTER_VIEW_TYPE</code>&#x662F;&#x4E00;&#x4E2A;<code>final</code>&#x7684;<code>int</code>&#x6570;&#x636E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void addHeaderView(View view) {</span><br><span class=\"line\">        FixedViewInfo info = new FixedViewInfo();</span><br><span class=\"line\">        info.view = view;</span><br><span class=\"line\">        info.viewType = BASE_HEADER_VIEW_TYPE + mHeaderViewInfos.size();</span><br><span class=\"line\">        mHeaderViewInfos.add(info);</span><br><span class=\"line\"></span><br><span class=\"line\">        if (mAdapter != null) {</span><br><span class=\"line\">            mAdapter.notifyDataSetChanged();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void addFooterView(View view) {</span><br><span class=\"line\">    FixedViewInfo info = new FixedViewInfo();</span><br><span class=\"line\">    info.view = view;</span><br><span class=\"line\">    info.viewType = BASE_FOOTER_VIEW_TYPE + mFooterViewInfos.size();</span><br><span class=\"line\">    mFooterViewInfos.add(info);</span><br><span class=\"line\"></span><br><span class=\"line\">    if (mAdapter != null) {</span><br><span class=\"line\">        mAdapter.notifyDataSetChanged();</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"setAdapter\"><a href=\"#setAdapter\" class=\"headerlink\" title=\"setAdapter\"></a>setAdapter</h2><p>&#x4E0B;&#x9762;&#x662F;<code>setAdapter()</code>&#xFF0C;&#x4F7F;&#x7528;&#x540E;&#x9762;&#x5C01;&#x88C5;&#x7684;<code>WrapperRecyclerViewAdapter</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    @Override</span><br><span class=\"line\">    public void setAdapter(Adapter adapter) {</span><br><span class=\"line\">        if (!(adapter instanceof WrapperRecyclerViewAdapter))</span><br><span class=\"line\">            mAdapter = new WrapperRecyclerViewAdapter(mHeaderViewInfos, mFooterViewInfos, adapter);</span><br><span class=\"line\">        super.setAdapter(mAdapter);</span><br><span class=\"line\"></span><br><span class=\"line\">//        if (isShouldSpan) {</span><br><span class=\"line\">//            ((WrapperRecyclerViewAdapter) mAdapter).adjustSpanSize(this);</span><br><span class=\"line\">//        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<h1 id=\"WrapperRecyclerViewAdapter\"><a href=\"#WrapperRecyclerViewAdapter\" class=\"headerlink\" title=\"WrapperRecyclerViewAdapter\"></a>WrapperRecyclerViewAdapter</h1><p>&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x6839;&#x636E;<code>ListView</code>&#x7684;<code>HeaderViewListAdapter</code>&#x6765;&#x6A21;&#x4EFF;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x5C01;&#x88C5;&#x5934;&#x90E8;&#x4E0E;&#x5C3E;&#x90E8;&#x7684;<code>adapter</code>&#x3002;&#x6211;&#x8FD9;&#x91CC;&#x5B9A;&#x4E49;&#x4E3A;<code>WrapperRecyclerViewAdapter</code>&#x7EE7;&#x627F;<code>RecyclerView.Adapter</code>&#x6839;&#x636E;&#x60C5;&#x51B5;&#x9002;&#x5F53;&#x4FEE;&#x6539;&#x3002;</p>\n<h2 id=\"getItemCount\"><a href=\"#getItemCount\" class=\"headerlink\" title=\"getItemCount\"></a>getItemCount</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    public int getItemCount() {</span><br><span class=\"line\">        if (mAdapter != null) {</span><br><span class=\"line\">            return getHeadersCount() + getFootersCount() + mAdapter.getItemCount();</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            return getHeadersCount() + getFootersCount();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<h2 id=\"getItemViewType\"><a href=\"#getItemViewType\" class=\"headerlink\" title=\"getItemViewType\"></a>getItemViewType</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    public int getItemViewType(int position) {</span><br><span class=\"line\">        int numHeaders = getHeadersCount();</span><br><span class=\"line\">        if (position &lt; numHeaders) {</span><br><span class=\"line\">            return mHeaderViewInfos.get(position).viewType;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        int adjPosition = position - numHeaders;</span><br><span class=\"line\">        int adapterPosition = 0;</span><br><span class=\"line\">        if (mAdapter != null) {</span><br><span class=\"line\">            adapterPosition = mAdapter.getItemCount();</span><br><span class=\"line\">            if (adjPosition &lt; adapterPosition) {</span><br><span class=\"line\">                return mAdapter.getItemViewType(adjPosition);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        return mFooterViewInfos.get(position - adapterPosition - getHeadersCount()).viewType;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x903B;&#x8F91;&#x4E0E;<code>ListView</code>&#x7684;&#x57FA;&#x672C;&#x4E00;&#x81F4;&#x3002;</p>\n<h2 id=\"onCreateViewHolder\"><a href=\"#onCreateViewHolder\" class=\"headerlink\" title=\"onCreateViewHolder\"></a>onCreateViewHolder</h2><p>&#x8FD9;&#x91CC;&#x9700;&#x5C06;<code>HeaderViewListAdapter</code>&#x4E2D;&#x7684;<code>getView()</code>&#x65B9;&#x6CD5;&#x5206;&#x6210;&#x4E24;&#x90E8;&#x5206;&#x6765;&#x5B9E;&#x73B0;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">public RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {</span><br><span class=\"line\">    if (viewType &gt;= EnhanceRecyclerView.BASE_HEADER_VIEW_TYPE &amp;&amp; viewType &lt; EnhanceRecyclerView.BASE_HEADER_VIEW_TYPE + getHeadersCount()) {</span><br><span class=\"line\">        View view = mHeaderViewInfos.get(viewType - EnhanceRecyclerView.BASE_HEADER_VIEW_TYPE).view;</span><br><span class=\"line\">        return viewHolder(view);</span><br><span class=\"line\">    } else if (viewType &gt;= EnhanceRecyclerView.BASE_FOOTER_VIEW_TYPE &amp;&amp; viewType &lt; EnhanceRecyclerView.BASE_FOOTER_VIEW_TYPE + getFootersCount()) {</span><br><span class=\"line\">        View view = mFooterViewInfos.get(viewType - EnhanceRecyclerView.BASE_FOOTER_VIEW_TYPE).view;</span><br><span class=\"line\">        return viewHolder(view);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return mAdapter.onCreateViewHolder(parent, viewType);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;<code>viewType</code>&#x6765;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x7684;&#x5E03;&#x5C40;&#x6587;&#x4EF6;.&#x4E0D;&#x662F;<code>header</code>&#x4E0E;<code>footer</code>&#x5E03;&#x5C40;&#x65F6;&#x5219;&#x76F4;&#x63A5;&#x56DE;&#x8C03;&#x539F;&#x59CB;<code>adapter</code>&#x7684;<code>onCreateViewHolder()</code>&#x65B9;&#x6CD5;&#x3002;&#x5B9E;&#x73B0;&#x6B63;&#x5E38;&#x7684;&#x5E03;&#x5C40;&#x3002;</p>\n<h2 id=\"onBindViewHolder\"><a href=\"#onBindViewHolder\" class=\"headerlink\" title=\"onBindViewHolder\"></a>onBindViewHolder</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">public void onBindViewHolder(RecyclerView.ViewHolder holder, int position) {</span><br><span class=\"line\">    int numHeaders = getHeadersCount();</span><br><span class=\"line\">    if (position &lt; numHeaders) {</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    int adjPosition = position - numHeaders;</span><br><span class=\"line\">    int adapterCount = 0;</span><br><span class=\"line\">    if (mAdapter != null) {</span><br><span class=\"line\">        adapterCount = mAdapter.getItemCount();</span><br><span class=\"line\">        if (adjPosition &lt; adapterCount) {</span><br><span class=\"line\">            mAdapter.onBindViewHolder(holder, adjPosition);</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6839;&#x636E;<code>position</code>&#x7684;&#x4F4D;&#x7F6E;&#x6765;&#x9009;&#x62E9;&#xFF0C;&#x5F53;<code>position</code>&#x5C5E;&#x4E8E;&#x6B63;&#x5E38;&#x7684;&#x4F4D;&#x7F6E;&#x8303;&#x56F4;&#x4E4B;&#x5185;&#x65F6;&#xFF0C;&#x5219;&#x56DE;&#x8C03;&#x539F;&#x59CB;&#x7684;<code>adapter</code>&#x7684;<code>onBindViewHolder()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x7684;&#x7ED1;&#x5B9A;&#xFF1B;&#x5BF9;&#x4E8E;&#x5176;&#x5B83;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x65E0;&#x9700;&#x505A;&#x5904;&#x7406;&#x3002;</p>\n<blockquote>\n<p><em>&#x4E3B;&#x8981;&#x7684;&#x6A21;&#x4EFF;&#x53D8;&#x52A8;&#x5C31;&#x662F;&#x8FD9;&#x4E9B;&#xFF0C;&#x7136;&#x540E;&#x81EA;&#x5DF1;&#x5728;&#x6839;&#x636E;&#x60C5;&#x51B5;&#x8FDB;&#x884C;&#x9002;&#x5F53;&#x7684;&#x4FEE;&#x6539;&#xFF0C;&#x6700;&#x540E;&#x5728;&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#x4E2D;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<code>EnhanceRecyclerView</code>&#x66FF;&#x4EE3;<code>RecyclerView</code></em></p>\n</blockquote>\n<h1 id=\"&#x8C03;&#x6574;\"><a href=\"#&#x8C03;&#x6574;\" class=\"headerlink\" title=\"&#x8C03;&#x6574;\"></a>&#x8C03;&#x6574;</h1><p>&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x5728;&#x4F7F;&#x7528;<code>RecyclerView</code>&#x7684;&#x65F6;&#x5019;&#x8981;&#x8BBE;&#x7F6E;<code>LayoutManager</code>&#xFF0C;&#x5982;&#x679C;&#x6309;&#x7167;&#x4E0A;&#x9762;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5F53;<code>LayoutManager</code>&#x8BBE;&#x7F6E;&#x4E3A;<code>LinearLayout</code>&#x65F6;&#xFF0C;&#x81EA;&#x7136;&#x6CA1;&#x4E0A;&#x9762;&#x95EE;&#x9898;&#xFF0C;&#x5934;&#x90E8;&#x4E0E;&#x5C3E;&#x90E8;&#x80FD;&#x6B63;&#x5E38;&#x6DFB;&#x52A0;&#xFF1B;&#x4F46;&#x5F53;&#x6211;&#x4EEC;&#x7684;<code>LayoutManager</code>&#x8BBE;&#x7F6E;&#x4E3A;<code>GridLayoutManager</code>&#x4E0E;<code>StaggeredGridLayoutManager</code>&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0;&#x5934;&#x90E8;&#x4E0E;&#x5C3E;&#x90E8;&#x7684;&#x6DFB;&#x52A0;&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#xFF0C;&#x5C31;&#x662F;&#x4ED6;&#x4EEC;&#x4E0D;&#x80FD;&#x72EC;&#x81EA;&#x5360;&#x4E00;&#x884C;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x8981;&#x505A;&#x76F8;&#x5E94;&#x7684;&#x8C03;&#x6574;&#xFF0C;&#x4F7F;&#x4ED6;&#x4EEC;&#x5728;&#x6DFB;&#x52A0;&#x5934;&#x90E8;&#x4E0E;&#x5C3E;&#x90E8;&#x7684;&#x65F6;&#x5019;&#x72EC;&#x81EA;&#x5360;&#x4E00;&#x884C;&#x3002;</p>\n<h2 id=\"adjustSpanSize\"><a href=\"#adjustSpanSize\" class=\"headerlink\" title=\"adjustSpanSize\"></a>adjustSpanSize</h2><p>&#x5728;&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<code>WrapperRecyclerViewAdapter</code>&#x4E2D;&#x6DFB;&#x52A0;<code>adjustSpanSize()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x7528;&#x6765;&#x5B9E;&#x73B0;&#x8C03;&#x6574;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void adjustSpanSize(RecyclerView recyclerView) {</span><br><span class=\"line\">        if (recyclerView.getLayoutManager() instanceof GridLayoutManager) {</span><br><span class=\"line\">            final GridLayoutManager manager = (GridLayoutManager) recyclerView.getLayoutManager();</span><br><span class=\"line\">            manager.setSpanSizeLookup(new GridLayoutManager.SpanSizeLookup() {</span><br><span class=\"line\">                @Override</span><br><span class=\"line\">                public int getSpanSize(int position) {</span><br><span class=\"line\">                    int numHeaders = getHeadersCount();</span><br><span class=\"line\">                    int adjPosition = position - numHeaders;</span><br><span class=\"line\">                    if (position &lt; numHeaders || adjPosition &gt;= mAdapter.getItemCount())</span><br><span class=\"line\">                        return manager.getSpanCount();</span><br><span class=\"line\">                    return 1;</span><br><span class=\"line\">                }</span><br><span class=\"line\">            });</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        if (recyclerView.getLayoutManager() instanceof StaggeredGridLayoutManager) {</span><br><span class=\"line\">            isStaggered = true;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x5F53;<code>LayoutManager</code>&#x4E3A;<code>GridLayoutManager</code>&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;<code>manager</code>&#x6765;&#x8BBE;&#x7F6E;<code>setSpanSizeLookup()</code>&#x5728;<code>getSpanSize()</code>&#x65B9;&#x6CD5;&#x4E2D;&#x6839;&#x636E;&#x5177;&#x4F53;&#x5224;&#x65AD;&#x6765;&#x8C03;&#x7528;<code>manager.getSpanCount()</code>&#x6765;&#x5B9E;&#x73B0;&#x5934;&#x90E8;&#x4E0E;&#x5C3E;&#x90E8;&#x7684;&#x5360;&#x4E00;&#x884C;&#x7684;&#x6548;&#x679C;&#xFF1B;&#x5BF9;&#x4E8E;<code>StaggeredGridLayoutManager</code>&#x56E0;&#x4E3A;&#x5176;&#x6CA1;&#x6709;<code>setSpanSizeLookup()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5148;&#x505A;&#x6807;&#x8BB0;&#xFF0C;&#x5728;<code>ViewHolder</code>&#x4E2D;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x9700;&#x8981;&#x7684;<code>ItemView</code>&#x6765;&#x8BBE;&#x7F6E;<code>params</code>&#xFF0C;<code>setFullSpa(true)</code>&#x65B9;&#x6CD5;&#x6765;&#x586B;&#x5145;&#x4E00;&#x884C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private RecyclerView.ViewHolder viewHolder(View itemView) {</span><br><span class=\"line\"></span><br><span class=\"line\">    if (isStaggered) {</span><br><span class=\"line\">        StaggeredGridLayoutManager.LayoutParams params = new StaggeredGridLayoutManager.LayoutParams(StaggeredGridLayoutManager.LayoutParams.MATCH_PARENT,</span><br><span class=\"line\">                StaggeredGridLayoutManager.LayoutParams.WRAP_CONTENT);</span><br><span class=\"line\">        params.setFullSpan(true);</span><br><span class=\"line\">        itemView.setLayoutParams(params);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return new RecyclerView.ViewHolder(itemView) {</span><br><span class=\"line\">    };</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"setLayoutManager\"><a href=\"#setLayoutManager\" class=\"headerlink\" title=\"setLayoutManager\"></a>setLayoutManager</h2><p>&#x5728;<code>EnhanceRecyclerView</code>&#x4E2D;&#x91CD;&#x5199;<code>setLayoutManager()</code>&#x65B9;&#x6CD5;,&#x6DFB;&#x52A0;&#x6807;&#x8BB0;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    public void setLayoutManager(LayoutManager layout) {</span><br><span class=\"line\">        if (layout instanceof GridLayoutManager || layout instanceof StaggeredGridLayoutManager)</span><br><span class=\"line\">            isShouldSpan = true;</span><br><span class=\"line\">        super.setLayoutManager(layout);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x518D; &#x5728;<code>EnhanceRecyclerView</code>&#x7684;<code>setAdapter()</code>&#x65B9;&#x6CD5;&#x4E2D;&#x6839;&#x636E;&#x6807;&#x8BB0;&#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x8C03;&#x7528;<code>adjustSpanSize()</code>&#x65B9;&#x6CD5;&#x6765;&#x8FDB;&#x884C;&#x8C03;&#x6574;<code>header</code>&#x4E0E;<code>footer</code>.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (isShouldSpan) {</span><br><span class=\"line\">            ((WrapperRecyclerViewAdapter) mAdapter).adjustSpanSize(this);</span><br><span class=\"line\">        }</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x524D;&#x9762;<code>setAdapter()</code>&#x4E2D;&#x6240;&#x6CE8;&#x91CA;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>\n<p>&#x8FD9;&#x6837;&#x6574;&#x4E2A;&#x8C03;&#x6574;&#x90E8;&#x5206;&#x5C31;&#x57FA;&#x672C;&#x5B8C;&#x6210;&#x3002;<code>header</code>&#x4E0E;<code>footer</code>&#x7684;&#x6DFB;&#x52A0;&#x4E5F;&#x5C31;&#x57FA;&#x672C;&#x5B8C;&#x6210;&#x4E86;&#x3002;</p>\n<h1 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h1><p>&#x901A;&#x8FC7;<code>RecyclerView</code>&#x7684;&#x5934;&#x90E8;&#x4E0E;&#x5C3E;&#x90E8;&#x7684;&#x6DFB;&#x52A0;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x80FD;&#x5B66;&#x4E60;&#x5982;&#x4F55;&#x8FD0;&#x7528;&#x539F;&#x6709;&#x7684;&#x8D44;&#x6E90;&#x6765;&#x5B9E;&#x73B0;&#x6211;&#x4EEC;&#x6240;&#x9700;&#x8981;&#x7684;&#x529F;&#x80FD;&#x3002;&#x867D;&#x7136;&#x65B9;&#x6CD5;&#x4E0D;&#x4E00;&#x5B9A;&#x662F;&#x6700;&#x597D;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x4E5F;&#x5B58;&#x5728;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x4F8B;&#x5982;&#x4E0D;&#x80FD;&#x5728;&#x521D;&#x59CB;&#x5316;&#xFF08;onCreate&#xFF09;&#x4E2D;&#x540C;&#x65F6;&#x6DFB;&#x52A0;<code>header</code>&#x4E0E;<code>footer</code>&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x51FA;&#x73B0;&#x5E03;&#x5C40;&#x6DF7;&#x4E71;&#x7684;&#x73B0;&#x8C61;&#xFF0C;&#x73B0;&#x5728;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;&#x4E3A;&#x4F55;&#x6709;&#x8FD9;&#x79CD;&#x7279;&#x4F8B;&#xFF0C;&#x5E0C;&#x671B;&#x77E5;&#x9053;&#x7684;&#x53EF;&#x4EE5;&#x544A;&#x77E5;&#x89E3;&#x51B3;&#x4E0B;&#xFF0C;&#x4F46;&#x8FD9;&#x79CD;&#x6A21;&#x4EFF;&#x7684;&#x601D;&#x60F3;&#x8FD8;&#x662F;&#x5F88;&#x503C;&#x5F97;&#x63A8;&#x8350;&#x7684;&#x3002;</p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["RecyclerView"]},{"title":"多线程下载","url":"https://www.rousetime.com/2016/06/26/多线程下载/","content":"<h1 id=\"&#x539F;&#x7406;\"><a href=\"#&#x539F;&#x7406;\" class=\"headerlink\" title=\"&#x539F;&#x7406;\"></a>&#x539F;&#x7406;</h1><p>&#x591A;&#x7EBF;&#x7A0B;&#x4E0B;&#x8F7D;&#x7684;&#x539F;&#x7406;&#x5C31;&#x662F;&#x5C06;&#x8981;&#x4E0B;&#x8F7D;&#x7684;&#x6587;&#x4EF6;&#x5206;&#x6210;&#x82E5;&#x5E72;&#x4EFD;&#xFF0C;&#x5176;&#x4E2D;&#x6BCF;&#x4EFD;&#x90FD;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x4E0B;&#x8F7D;&#xFF0C;&#x8FD9;&#x6837;&#x5BF9;&#x4E8E;&#x6587;&#x4EF6;&#x7684;&#x4E0B;&#x8F7D;&#x901F;&#x5EA6;&#x81EA;&#x7136;&#x5C31;&#x63D0;&#x9AD8;&#x4E86;&#x8BB8;&#x591A;&#x3002;</p>\n<p>&#x65E2;&#x7136;&#x8981;&#x5206;&#x6210;&#x82E5;&#x5E72;&#x90E8;&#x5206;&#x5206;&#x5DE5;&#x4E0B;&#x8F7D;&#xFF0C;&#x81EA;&#x7136;&#x8981;&#x77E5;&#x9053;&#x5404;&#x4E2A;&#x7EBF;&#x7A0B;&#x81EA;&#x5DF1;&#x8981;&#x4E0B;&#x8F7D;&#x7684;&#x8D77;&#x59CB;&#x4F4D;&#x7F6E;&#xFF0C;&#x4E0E;&#x8981;&#x4E0B;&#x8F7D;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8981;&#x89E3;&#x51B3;&#x7EBF;&#x7A0B;&#x7684;&#x5206;&#x914D;&#x4E0E;&#x5404;&#x4E2A;&#x7EBF;&#x7A0B;&#x5B9A;&#x4F4D;&#x5230;&#x4E0B;&#x8F7D;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>\n<h1 id=\"&#x5C01;&#x88C5;\"><a href=\"#&#x5C01;&#x88C5;\" class=\"headerlink\" title=\"&#x5C01;&#x88C5;\"></a>&#x5C01;&#x88C5;</h1><p>&#x5BF9;&#x4E8E;&#x591A;&#x7EBF;&#x7A0B;&#x4E0B;&#x8F7D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x5C01;&#x88C5;&#x5230;&#x4E00;&#x4E2A;&#x5DE5;&#x5177;&#x7C7B;&#x4E2D;<code>DownUtil</code>&#xFF0C;&#x5411;&#x5176;&#x4E2D;&#x4F20;&#x5165;&#x4E0B;&#x8F7D;&#x7684;&#x94FE;&#x63A5;&#x3001;&#x6587;&#x4EF6;&#x5B58;&#x50A8;&#x8DEF;&#x5F84;&#x3001;&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x7684;&#x7EBF;&#x7A0B;&#x6570;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public DownUtil(String path, String targetFile, int threadNum) {</span><br><span class=\"line\">        this.path = path;</span><br><span class=\"line\">        this.targetFile = targetFile;</span><br><span class=\"line\">        this.threadNum = threadNum;</span><br><span class=\"line\">        downThreads = new DownThread[threadNum];</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;<code>DownThread</code>&#x5B9E;&#x73B0;&#x7684;&#x662F;&#x5404;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x4E0B;&#x8F7D;</p>\n<h1 id=\"&#x5206;&#x914D;&#x7EBF;&#x7A0B;\"><a href=\"#&#x5206;&#x914D;&#x7EBF;&#x7A0B;\" class=\"headerlink\" title=\"&#x5206;&#x914D;&#x7EBF;&#x7A0B;\"></a>&#x5206;&#x914D;&#x7EBF;&#x7A0B;</h1><p>&#x8FD9;&#x91CC;&#x901A;&#x8FC7;<code>HttpURLConnection</code>&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x4E0B;&#x8F7D;&#xFF0C;&#x901A;&#x8FC7;<code>getContentLength()</code>&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x4E0B;&#x8F7D;&#x6587;&#x4EF6;&#x7684;&#x603B;&#x5927;&#x5C0F;&#xFF0C;&#x518D;&#x5BF9;&#x5176;&#x5E73;&#x5747;&#x5206;&#x914D;&#x5404;&#x4E2A;&#x7EBF;&#x7A0B;&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x786E;&#x5B9A;&#x4E86;&#x4E0B;&#x8F7D;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x4E0B;&#x9762;&#x5C31;&#x662F;&#x5B9A;&#x4F4D;&#x5230;&#x5404;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x5F00;&#x59CB;&#x4F4D;&#x7F6E;&#x8FDB;&#x884C;&#x4E0B;&#x8F7D;&#xFF0C;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>RandomAccessFile</code>&#x6765;&#x8FFD;&#x8E2A;&#x5B9A;&#x4F4D;&#x5230;&#x8981;&#x4E0B;&#x8F7D;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5B83;&#x7684;<code>seek()</code>&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x5B9A;&#x4F4D;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x8BE6;&#x7EC6;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void download() throws Exception {</span><br><span class=\"line\">    URL url = new URL(path);</span><br><span class=\"line\">    HttpURLConnection conn = (HttpURLConnection) url.openConnection();</span><br><span class=\"line\">    conn.setRequestMethod(&quot;GET&quot;);</span><br><span class=\"line\">    conn.setConnectTimeout(5000);</span><br><span class=\"line\">    conn.setRequestProperty(&quot;Accept-Language&quot;, &quot;zh-CN&quot;);</span><br><span class=\"line\">    conn.setRequestProperty(&quot;Charset&quot;, &quot;UTF-8&quot;);</span><br><span class=\"line\">    conn.setRequestProperty(&quot;Connection&quot;, &quot;Keep-Alive&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">    fileSize = conn.getContentLength();</span><br><span class=\"line\">    conn.disconnect();</span><br><span class=\"line\">    //&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x7684;&#x5927;&#x5C0F;</span><br><span class=\"line\">    int currentPartSize = fileSize / threadNum + 1;</span><br><span class=\"line\">    RandomAccessFile file = new RandomAccessFile(targetFile, &quot;rw&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">    //&#x8BBE;&#x7F6E;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x5927;&#x5C0F;</span><br><span class=\"line\">    file.setLength(fileSize);</span><br><span class=\"line\">    file.close();</span><br><span class=\"line\">    for (int i = 0; i &lt; threadNum; i++) {</span><br><span class=\"line\">        //&#x4E0B;&#x8F7D;&#x5F00;&#x59CB;&#x4F4D;&#x7F6E;</span><br><span class=\"line\">        int startPos = i * currentPartSize;</span><br><span class=\"line\">        RandomAccessFile currentPart = new RandomAccessFile(targetFile, &quot;rw&quot;);</span><br><span class=\"line\">        //&#x5B9A;&#x4F4D;&#x5230;&#x4E0B;&#x8F7D;&#x4F4D;&#x7F6E;</span><br><span class=\"line\">        currentPart.seek(startPos);</span><br><span class=\"line\">        //&#x4E0B;&#x8F7D;&#x7EBF;&#x7A0B;</span><br><span class=\"line\">        downThreads[i] = new DownThread(startPos, currentPartSize, currentPart);</span><br><span class=\"line\">        downThreads[i].start();</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h1 id=\"&#x7EBF;&#x7A0B;&#x4E0B;&#x8F7D;\"><a href=\"#&#x7EBF;&#x7A0B;&#x4E0B;&#x8F7D;\" class=\"headerlink\" title=\"&#x7EBF;&#x7A0B;&#x4E0B;&#x8F7D;\"></a>&#x7EBF;&#x7A0B;&#x4E0B;&#x8F7D;</h1><p>&#x4E0B;&#x9762;&#x5C31;&#x662F;&#x5404;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x4E0B;&#x8F7D;<code>DownThread</code>&#xFF0C;&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x5F97;&#x5230;&#x4E86;&#x5404;&#x4E2A;&#x7EBF;&#x7A0B;&#x8981;&#x4E0B;&#x8F7D;&#x7684;&#x521D;&#x59CB;&#x4F4D;&#x7F6E;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x83B7;&#x53D6;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x7684;&#x8F93;&#x5165;&#x6D41;<code>InputStream</code>&#xFF0C;&#x901A;&#x8FC7;<code>skip()</code>&#x65B9;&#x6CD5;&#x8DF3;&#x8DC3;&#x5230;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;&#x8FDB;&#x884C;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x518D;&#x5199;&#x5165;&#x5230;<code>RandomAccessFile</code>&#x6587;&#x4EF6;&#x4E2D;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    public DownThread(int startPos, int currentPartSize, RandomAccessFile currentPart) {</span><br><span class=\"line\">        this.startPos = startPos;</span><br><span class=\"line\">        this.currentPartSize = currentPartSize;</span><br><span class=\"line\">        this.currentPart = currentPart;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void run() {</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            URL url = new URL(path);</span><br><span class=\"line\">            HttpURLConnection conn = (HttpURLConnection) url.openConnection();</span><br><span class=\"line\">            conn.setRequestMethod(&quot;GET&quot;);</span><br><span class=\"line\">            conn.setConnectTimeout(5000);</span><br><span class=\"line\">            conn.setRequestProperty(&quot;Accept-Language&quot;, &quot;zh-CN&quot;);</span><br><span class=\"line\">            conn.setRequestProperty(&quot;Charset&quot;, &quot;UTF-8&quot;);</span><br><span class=\"line\">            InputStream in = conn.getInputStream();</span><br><span class=\"line\">            </span><br><span class=\"line\">            skipFully(in, startPos);</span><br><span class=\"line\">            byte[] buffer = new byte[1024];</span><br><span class=\"line\">            int hasRead = 0;</span><br><span class=\"line\">            while ((hasRead = in.read(buffer)) &gt; 0 &amp;&amp; length &lt; currentPartSize) {</span><br><span class=\"line\">                currentPart.write(buffer, 0, hasRead);</span><br><span class=\"line\">                length += hasRead;</span><br><span class=\"line\">            }</span><br><span class=\"line\">            currentPart.close();</span><br><span class=\"line\">            in.close();</span><br><span class=\"line\">        } catch (Exception e) {</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x591A;&#x7EBF;&#x7A0B;&#x7684;&#x4E0B;&#x8F7D;&#xFF0C;&#x6700;&#x540E;&#x8C03;&#x7528;&#x5C01;&#x88C5;&#x7C7B;<code>DownUtil</code>&#x5C31;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x591A;&#x7EBF;&#x7A0B;&#x4E0B;&#x8F7D;&#x3002;</p>\n<h1 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h1><p>&#x591A;&#x7EBF;&#x7A0B;&#x7684;&#x5173;&#x952E;&#x5C31;&#x662F;&#x5206;&#x914D;&#x597D;&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x5B9A;&#x4F4D;&#x8FDB;&#x7A0B;&#x4E0B;&#x8F7D;&#x7684;&#x51C6;&#x786E;&#x4F4D;&#x7F6E;&#xFF0C;&#x83B7;&#x53D6;&#x8F93;&#x5165;&#x6D41;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x540C;&#x65F6;&#x5199;&#x5165;&#x5230;&#x6587;&#x4EF6;&#x7684;&#x76F8;&#x5E94;&#x4F4D;&#x7F6E;&#x3002;&#x53EF;&#x4EE5;&#x501F;&#x52A9;<code>RandomAccessFile</code>&#x6765;&#x8FDB;&#x884C;&#x5B9A;&#x4F4D;&#x3002;</p>\n<p>&#x5F53;&#x7136;&#x4E5F;&#x5E76;&#x975E;&#x5F00;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#x8D8A;&#x591A;&#x4E0B;&#x8F7D;&#x7684;&#x901F;&#x5EA6;&#x4E5F;&#x5C31;&#x8D8A;&#x5FEB;&#xFF0C;&#x56E0;&#x4E3A;&#x7EBF;&#x7A0B;&#x8D8A;&#x591A;&#x5BF9;&#x4E8E;&#x7A0B;&#x5E8F;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x7EBF;&#x7A0B;&#x4E5F;&#x662F;&#x4E00;&#x79CD;&#x8D1F;&#x62C5;&#xFF0C;&#x8FC7;&#x591A;&#x7684;&#x8BDD;&#x53CD;&#x800C;&#x4F1A;&#x964D;&#x4F4E;&#x4E0B;&#x8F7D;&#x7684;&#x901F;&#x5EA6;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x5408;&#x7406;&#x8FD0;&#x7528;&#x3002;</p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["多线程"]},{"title":"七大排序算法总结","url":"https://www.rousetime.com/2016/06/19/七大排序算法总结/","content":"<p>&#x524D;&#x9762;&#x4ECB;&#x7ECD;&#x4E86;&#x4E03;&#x5927;&#x7B97;&#x6CD5;&#x7684;&#x601D;&#x60F3;&#x4E0E;&#x5B9E;&#x73B0;&#x6B65;&#x9AA4;&#xFF0C;&#x4E0B;&#x9762;&#x6765;&#x505A;&#x4E00;&#x4E2A;&#x5F52;&#x603B;&#x3002;</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">&#x6392;&#x5E8F;&#x65B9;&#x6CD5;</th>\n<th style=\"text-align:center\">&#x5E73;&#x5747;&#x590D;&#x6742;&#x5EA6;</th>\n<th style=\"text-align:center\">&#x6700;&#x574F;&#x590D;&#x6742;&#x5EA6;</th>\n<th style=\"text-align:center\">&#x6700;&#x597D;&#x590D;&#x6742;&#x5EA6;</th>\n<th style=\"text-align:center\">&#x8F85;&#x52A9;&#x7A7A;&#x95F4;</th>\n<th style=\"text-align:center\">&#x7A33;&#x5B9A;&#x6027;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">&#x76F4;&#x63A5;&#x9009;&#x62E9;&#x6392;&#x5E8F;</td>\n<td style=\"text-align:center\">O(n^2)</td>\n<td style=\"text-align:center\">O(n^2)</td>\n<td style=\"text-align:center\">O(n^2)</td>\n<td style=\"text-align:center\">O(1)</td>\n<td style=\"text-align:center\">&#x7A33;&#x5B9A;</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&#x5192;&#x6CE1;&#x6392;&#x5E8F;</td>\n<td style=\"text-align:center\">O(n^2)</td>\n<td style=\"text-align:center\">O(n^2)</td>\n<td style=\"text-align:center\">O(n^2)</td>\n<td style=\"text-align:center\">O(1)</td>\n<td style=\"text-align:center\">&#x7A33;&#x5B9A;</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;</td>\n<td style=\"text-align:center\">O(n^2)</td>\n<td style=\"text-align:center\">O(n^2)</td>\n<td style=\"text-align:center\">O(n^2)</td>\n<td style=\"text-align:center\">O(1)</td>\n<td style=\"text-align:center\">&#x7A33;&#x5B9A;</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&#x5F52;&#x5E76;&#x6392;&#x5E8F;</td>\n<td style=\"text-align:center\">O(nlogn)</td>\n<td style=\"text-align:center\">O(nlogn)</td>\n<td style=\"text-align:center\">O(nlogn)</td>\n<td style=\"text-align:center\">O(n)</td>\n<td style=\"text-align:center\">&#x7A33;&#x5B9A;</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&#x5FEB;&#x901F;&#x6392;&#x5E8F;</td>\n<td style=\"text-align:center\">O(nlogn)</td>\n<td style=\"text-align:center\">O(n^2)</td>\n<td style=\"text-align:center\">O(nlogn)</td>\n<td style=\"text-align:center\">O(1)</td>\n<td style=\"text-align:center\">&#x4E0D;&#x7A33;&#x5B9A;</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&#x5E0C;&#x5C14;&#x6392;&#x5E8F;</td>\n<td style=\"text-align:center\">O(nlogn)~O(n^2)</td>\n<td style=\"text-align:center\">O(n^1.3)</td>\n<td style=\"text-align:center\">O(n^2)</td>\n<td style=\"text-align:center\">O(logn)~O(n)</td>\n<td style=\"text-align:center\">&#x4E0D;&#x7A33;&#x5B9A;</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&#x5806;&#x6392;&#x5E8F;</td>\n<td style=\"text-align:center\">O(nlogn)</td>\n<td style=\"text-align:center\">O(nlogn)</td>\n<td style=\"text-align:center\">O(nlogn)</td>\n<td style=\"text-align:center\">O(1)</td>\n<td style=\"text-align:center\">&#x4E0D;&#x7A33;&#x5B9A;</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"&#x76F4;&#x63A5;&#x9009;&#x62E9;&#x6392;&#x5E8F;\"><a href=\"#&#x76F4;&#x63A5;&#x9009;&#x62E9;&#x6392;&#x5E8F;\" class=\"headerlink\" title=\"&#x76F4;&#x63A5;&#x9009;&#x62E9;&#x6392;&#x5E8F;\"></a>&#x76F4;&#x63A5;&#x9009;&#x62E9;&#x6392;&#x5E8F;</h1><h2 id=\"&#x601D;&#x60F3;\"><a href=\"#&#x601D;&#x60F3;\" class=\"headerlink\" title=\"&#x601D;&#x60F3;\"></a>&#x601D;&#x60F3;</h2><p><a href=\"https://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E4%B8%80-%E7%9B%B4%E6%8E%A5%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x76F4;&#x63A5;&#x9009;&#x62E9;&#x6392;&#x5E8F;</a>&#xFF0C;&#x6574;&#x4F53;&#x601D;&#x60F3;&#x662F;&#x5C06;&#x6570;&#x636E;&#x5206;&#x6210;&#x4E24;&#x4E2A;&#x533A;&#x57DF;&#xFF0C;<code>&#x6709;&#x5E8F;&#x533A;</code>&#x4E0E;<code>&#x65E0;&#x5E8F;&#x533A;</code>&#x3002;&#x6392;&#x5E8F;&#x7684;&#x65F6;&#x5019;&#x662F;&#x6BCF;&#x6B21;&#x4ECE;<code>&#x65E0;&#x5E8F;&#x533A;</code>&#x4E2D;&#x9009;&#x62E9;&#x51FA;&#x6700;&#x5C0F;&#x7684;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x63D2;&#x5165;&#x5230;<code>&#x6709;&#x5E8F;&#x533A;</code>&#x4E2D;&#x7684;&#x6700;&#x672B;&#x5C3E;&#xFF0C;&#x4ECE;&#x800C;&#x5F62;&#x6210;&#x66F4;&#x5927;&#x7684;<code>&#x6709;&#x5E8F;&#x533A;</code>&#x3002;&#x76F4;&#x5230;<code>&#x65E0;&#x5E8F;&#x533A;</code>&#x4E2D;&#x7684;&#x6570;&#x4E3A;&#x96F6;&#xFF0C;&#x7ED3;&#x675F;&#x6392;&#x5E8F;&#x3002;</p>\n<h2 id=\"&#x6B65;&#x9AA4;\"><a href=\"#&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x6B65;&#x9AA4;\"></a>&#x6B65;&#x9AA4;</h2><p>&#x5047;&#x8BBE;&#x6392;&#x5E8F;&#x6570;&#x7EC4;&#x4E3A;a[0&#x2026;n-1];</p>\n<ol>\n<li>&#x9996;&#x5148;<code>&#x6709;&#x5E8F;&#x533A;</code>&#x4E2D;&#x7684;&#x4E2A;&#x6570;&#x4E3A;0&#xFF0C;&#x4EE4;<code>i = 0</code>&#x3002;&#x4ECE;<code>&#x65E0;&#x5E8F;&#x533A;</code>&#x4E2D;&#x9009;&#x62E9;&#x6700;&#x5C0F;&#x7684;&#x6570;&#xFF0C;&#x52A0;&#x5165;&#x5230;<code>&#x6709;&#x5E8F;&#x533A;a[i]</code>&#x4E2D;&#x3002;&#x4F7F;&#x5F97;<code>&#x6709;&#x5E8F;&#x533A;</code>&#x4E3A;<code>a[0..i]</code>,<code>&#x65E0;&#x5E8F;&#x533A;</code>&#x4E3A;<code>a[i...n-1]</code></li>\n<li>&#x5B8C;&#x6210;&#x540E; <code>i++</code> ,&#x7136;&#x540E;&#x7EE7;&#x7EED;&#x524D;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230; <code>i = n-1</code> &#x4E3A;&#x6B62;&#x3002;&#x4F7F;&#x5F97;&#x5168;&#x90E8;&#x6570;&#x90FD;&#x5728;<code>&#x6709;&#x5E8F;&#x533A;</code>&#x4E2D;&#x3002;</li>\n</ol>\n<h1 id=\"&#x5192;&#x6CE1;&#x6392;&#x5E8F;\"><a href=\"#&#x5192;&#x6CE1;&#x6392;&#x5E8F;\" class=\"headerlink\" title=\"&#x5192;&#x6CE1;&#x6392;&#x5E8F;\"></a>&#x5192;&#x6CE1;&#x6392;&#x5E8F;</h1><h2 id=\"&#x601D;&#x60F3;-1\"><a href=\"#&#x601D;&#x60F3;-1\" class=\"headerlink\" title=\"&#x601D;&#x60F3;\"></a>&#x601D;&#x60F3;</h2><p><a href=\"https://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E4%BA%8C-%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x5192;&#x6CE1;&#x6392;&#x5E8F;</a>&#x4E3B;&#x8981;&#x662F;&#x76F8;&#x90BB;&#x7684;&#x4E24;&#x4E2A;&#x6570;&#x4E24;&#x4E24;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x62FF;&#x4ECE;&#x5C0F;&#x5230;&#x5927;&#x8BF4;&#x660E;&#xFF0C;&#x8FDB;&#x884C;&#x5192;&#x6CE1;&#x6392;&#x5E8F;&#x540E;&#x4F1A;&#x5C06;&#x5927;&#x7684;&#x6570;<code>&#x6C89;</code>&#x5230;&#x5E95;&#x90E8;&#xFF0C;&#x5C06;&#x5C0F;&#x5F97;&#x6570;<code>&#x6D6E;</code>&#x5230;&#x9876;&#x90E8;&#x3002;&#x6240;&#x4EE5;&#x5192;&#x6CE1;&#x8BF4;&#x6CD5;&#x7531;&#x6B64;&#x5F97;&#x540D;&#x3002;</p>\n<h2 id=\"&#x6B65;&#x9AA4;-1\"><a href=\"#&#x6B65;&#x9AA4;-1\" class=\"headerlink\" title=\"&#x6B65;&#x9AA4;\"></a>&#x6B65;&#x9AA4;</h2><p>&#x4EE5;&#x4ECE;&#x5C0F;&#x5230;&#x5927;&#x4E3A;&#x4F8B;&#xFF0C;&#x6392;&#x5E8F;&#x6570;&#x7EC4;&#x5927;&#x5C0F;&#x4E3A;<code>n</code>&#x3002;</p>\n<ol>\n<li>&#x7B2C;<code>N = 0</code>&#x8D9F;&#x6392;&#x5E8F;&#x5F00;&#x59CB;&#x90FD;&#x4ECE;<code>a[0]</code>&#x5F00;&#x59CB;&#x4E0E;&#x5176;&#x4E0B;&#x9762;&#x7684;&#x76F8;&#x90BB;&#x7684;&#x6570;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x5982;&#x679C;&#x5927;&#x4E8E;&#x76F8;&#x90BB;&#x7684;&#x6570;&#x5219;&#x4EA4;&#x6362;&#x4ED6;&#x4EEC;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</li>\n<li>&#x7EE7;&#x7EED;&#x4E0E;&#x4E0B;&#x4E00;&#x4E2A;&#x76F8;&#x90BB;&#x7684;&#x6570;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x5927;&#x4E8E;&#x76F8;&#x90BB;&#x7684;&#x5C31;&#x4EA4;&#x6362;&#xFF0C;&#x6700;&#x540E;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;<code>n-1</code>&#x6B21;&#x540E;&#xFF0C;&#x7B2C;<code>N = 0</code>&#x8D9F;&#x6392;&#x5E8F;&#x7ED3;&#x675F;&#xFF0C;&#x6700;&#x5927;&#x7684;&#x6570;&#x5C31;&#x5728;&#x6570;&#x7EC4;&#x7684;<code>a[n-1]</code>&#x5904;&#x3002;</li>\n<li>&#x91CD;&#x590D;&#x524D;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230; <code>N = n-1</code>,&#x6392;&#x5E8F;&#x7ED3;&#x675F;&#x3002;</li>\n</ol>\n<h1 id=\"&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;\"><a href=\"#&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;\" class=\"headerlink\" title=\"&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;\"></a>&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;</h1><h2 id=\"&#x601D;&#x60F3;-2\"><a href=\"#&#x601D;&#x60F3;-2\" class=\"headerlink\" title=\"&#x601D;&#x60F3;\"></a>&#x601D;&#x60F3;</h2><p><a href=\"https://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E4%B8%89-%E7%9B%B4%E6%8E%A5%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;</a>&#x7684;&#x57FA;&#x672C;&#x601D;&#x60F3;&#x662F;:<code>&#x5C06;&#x9700;&#x8981;&#x6392;&#x5E8F;&#x7684;&#x5173;&#x952E;&#x6570;&#x4E0E;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x6392;&#x597D;&#x5E8F;&#x7684;&#x6570;&#x636E;&#x4ECE;&#x540E;&#x5F80;&#x524D;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x4F7F;&#x5176;&#x63D2;&#x5165;&#x5230;&#x5408;&#x9002;&#x7684;&#x4F4D;&#x7F6E;</code>&#x3002;</p>\n<h2 id=\"&#x6B65;&#x9AA4;-2\"><a href=\"#&#x6B65;&#x9AA4;-2\" class=\"headerlink\" title=\"&#x6B65;&#x9AA4;\"></a>&#x6B65;&#x9AA4;</h2><p>&#x6392;&#x5E8F;&#x6570;&#x7EC4;&#x4E3A;<code>a[0...n]</code></p>\n<ol>\n<li>&#x5C06;<code>a[0]</code>&#x4F5C;&#x4E3A;&#x8D77;&#x59CB;&#x6570;&#x636E;&#xFF0C;&#x4ECE;<code>a[1]</code>&#x5F00;&#x59CB;&#x4F5C;&#x4E3A;&#x5173;&#x952E;&#x5B57;&#x5411;&#x524D;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x82E5;&#x5C0F;&#x4E8E;&#x524D;&#x9762;&#x6240;&#x9047;&#x5230;&#x7684;&#x6BD4;&#x8F83;&#x6570;&#xFF0C;&#x5219;&#x4EA4;&#x6362;&#x4E24;&#x4E2A;&#x6BD4;&#x8F83;&#x6570;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5426;&#x5219;&#x76F4;&#x63A5;&#x8FDB;&#x884C;&#x4E0B;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x5B57;&#x7684;&#x6BD4;&#x8F83;&#x3002;</li>\n<li>&#x91CD;&#x590D;&#x524D;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230;&#x5C06;<code>a[n]</code>&#x4F5C;&#x4E3A;&#x5173;&#x952E;&#x5B57;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x3002;&#x6BD4;&#x8F83;&#x5B8C;&#x4EE5;&#x540E;&#x5219;&#x6392;&#x5E8F;&#x7ED3;&#x675F;&#x3002;</li>\n</ol>\n<h1 id=\"&#x5F52;&#x5E76;&#x6392;&#x5E8F;\"><a href=\"#&#x5F52;&#x5E76;&#x6392;&#x5E8F;\" class=\"headerlink\" title=\"&#x5F52;&#x5E76;&#x6392;&#x5E8F;\"></a>&#x5F52;&#x5E76;&#x6392;&#x5E8F;</h1><h2 id=\"&#x601D;&#x60F3;-3\"><a href=\"#&#x601D;&#x60F3;-3\" class=\"headerlink\" title=\"&#x601D;&#x60F3;\"></a>&#x601D;&#x60F3;</h2><p><a href=\"https://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E5%9B%9B-%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x5F52;&#x5E76;&#x6392;&#x5E8F;</a>&#x662F;&#x4E00;&#x4E2A;&#x6548;&#x7387;&#x76F8;&#x5BF9;&#x8F83;&#x9AD8;&#x7684;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;&#xFF0C;&#x5B83;&#x91C7;&#x7528;&#x7684;&#x662F;<code>&#x5206;&#x6CBB;&#x7684;&#x601D;&#x60F3;</code>&#xFF0C;&#x5C06;&#x5F85;&#x6392;&#x5E8F;&#x7684;&#x5E8F;&#x5217;&#x5206;&#x6210;&#x82E5;&#x5E72;&#x7EC4;&#xFF0C;&#x4FDD;&#x8BC1;&#x6BCF;&#x7EC4;&#x90FD;&#x6709;&#x5E8F;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x5408;&#x5E76;&#x6392;&#x5E8F;&#xFF0C;&#x6700;&#x7EC8;&#x4F7F;&#x6574;&#x4E2A;&#x5E8F;&#x5217;&#x6709;&#x5E8F;&#x3002;</p>\n<h2 id=\"&#x6B65;&#x9AA4;-3\"><a href=\"#&#x6B65;&#x9AA4;-3\" class=\"headerlink\" title=\"&#x6B65;&#x9AA4;\"></a>&#x6B65;&#x9AA4;</h2><ol>\n<li>&#x5C06;&#x5F85;&#x6392;&#x5E8F;&#x7684;&#x5E8F;&#x5217;&#x91C7;&#x7528;<code>&#x5206;&#x6CBB;&#x601D;&#x60F3;</code>&#x5C06;&#x5176;&#x5212;&#x5206;&#x6210;&#x82E5;&#x5E72;&#x7EC4;&#xFF0C;&#x4F7F;&#x5176;&#x6709;&#x5E8F;&#xFF0C;&#x5176;&#x4E2D;&#x53EF;&#x91C7;&#x7528;&#x9012;&#x5F52;&#x8FDB;&#x884C;&#x5212;&#x5206;&#x3002;</li>\n<li>&#x5C06;&#x6709;&#x5E8F;&#x7684;&#x7EC4;&#x5206;&#x522B;&#x8FDB;&#x884C;&#x5F52;&#x5E76;&#x64CD;&#x4F5C;&#xFF0C;&#x5176;&#x4E2D;&#x501F;&#x52A9;&#x4E00;&#x4E2A;&#x8F85;&#x52A9;&#x6570;&#x7EC4;&#xFF0C;&#x5C06;&#x5DE6;&#x53F3;&#x5212;&#x5206;&#x7684;&#x6709;&#x5E8F;&#x7EC4;&#x4ECE;&#x5934;&#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x5C06;&#x8F83;&#x5C0F;&#x7684;&#x6570;&#x52A0;&#x5165;&#x5230;&#x8F85;&#x52A9;&#x6570;&#x7EC4;&#x4E2D;&#xFF0C;&#x4E14;&#x8F83;&#x5C0F;&#x7684;&#x6240;&#x5728;&#x6709;&#x5E8F;&#x6570;&#x7EC4;&#x5411;&#x540E;&#x81EA;&#x589E;&#xFF0C;&#x518D;&#x4E0E;&#x539F;&#x6765;&#x6BD4;&#x8F83;&#x7684;&#x6570;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x3002;</li>\n<li>&#x91CD;&#x590D;&#x4E0A;&#x9762;<code>2</code>&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230;&#x6240;&#x6709;&#x6570;&#x636E;&#x6BD4;&#x8F83;&#x5B8C;&#x6BD5;&#xFF0C;&#x6216;&#x8005;&#x5C06;&#x8FD8;&#x6709;&#x5269;&#x4F59;&#x6570;&#x672A;&#x6BD4;&#x8F83;&#x7684;&#x6709;&#x5E8F;&#x6570;&#x636E;&#x76F4;&#x63A5;&#x6309;&#x539F;&#x6709;&#x7684;&#x987A;&#x5E8F;&#x52A0;&#x5165;&#x5230;&#x8F85;&#x52A9;&#x6570;&#x7EC4;&#x4E2D;,&#x6700;&#x540E;&#x5C06;&#x5DF2;&#x7ECF;&#x6392;&#x597D;&#x5E8F;&#x7684;&#x8F85;&#x52A9;&#x6570;&#x7EC4;&#x52A0;&#x5165;&#x5230;&#x539F;&#x6709;&#x6570;&#x7EC4;&#x7684;&#x76F8;&#x5E94;&#x4F4D;&#x7F6E;&#x3002;</li>\n<li>&#x91CD;&#x590D;&#x4E0A;&#x9762;&#x7684;<code>2</code>&#x3001;<code>3</code>&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230;&#x6240;&#x6709;&#x7684;&#x5DE6;&#x53F3;&#x5212;&#x5206;&#x5F52;&#x5E76;&#x5B8C;&#x6BD5;&#x3002;</li>\n</ol>\n<h1 id=\"&#x5FEB;&#x901F;&#x6392;&#x5E8F;\"><a href=\"#&#x5FEB;&#x901F;&#x6392;&#x5E8F;\" class=\"headerlink\" title=\"&#x5FEB;&#x901F;&#x6392;&#x5E8F;\"></a>&#x5FEB;&#x901F;&#x6392;&#x5E8F;</h1><h2 id=\"&#x601D;&#x60F3;-4\"><a href=\"#&#x601D;&#x60F3;-4\" class=\"headerlink\" title=\"&#x601D;&#x60F3;\"></a>&#x601D;&#x60F3;</h2><p><a href=\"https://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E4%BA%94-%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x5FEB;&#x901F;&#x6392;&#x5E8F;</a>&#x7684;&#x4E3B;&#x8981;&#x601D;&#x60F3;&#x662F;&#xFF1A;<code>&#x5C06;&#x4E00;&#x4E2A;&#x5F85;&#x6392;&#x5E8F;&#x5E8F;&#x5217;&#x5206;&#x6210;&#x4E24;&#x4E2A;&#x90E8;&#x5206;&#xFF0C;&#x4EE5;&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x4F5C;&#x4E3A;&#x5206;&#x754C;&#x7EBF;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x90E8;&#x5206;&#x5C0F;&#x4E8E;&#x8FD9;&#x4E2A;&#x5206;&#x754C;&#x7EBF;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x53E6;&#x4E00;&#x90E8;&#x5206;&#x5927;&#x4E8E;&#x8FD9;&#x4E2A;&#x5206;&#x754C;&#x7EBF;&#x7684;&#x6570;&#x636E;&#x3002;&#x56E0;&#x4E3A;&#x91C7;&#x7528;&#x9012;&#x5F52;&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x518D;&#x5BF9;&#x8FD9;&#x4E24;&#x4E2A;&#x5E8F;&#x5217;&#x8FDB;&#x884C;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#xFF0C;&#x76F4;&#x5230;&#x6240;&#x4EE5;&#x7684;&#x6570;&#x636E;&#x90FD;&#x662F;&#x6709;&#x5E8F;&#x7684;</code>&#x3002;</p>\n<h2 id=\"&#x6B65;&#x9AA4;-4\"><a href=\"#&#x6B65;&#x9AA4;-4\" class=\"headerlink\" title=\"&#x6B65;&#x9AA4;\"></a>&#x6B65;&#x9AA4;</h2><p>&#x5047;&#x8BBE;&#x5F85;&#x6392;&#x5E8F;&#x7684;&#x6570;&#x7EC4;&#x4E3A;<code>a[0...n-1]</code></p>\n<ol>\n<li>&#x4E00;&#x822C;&#x90FD;&#x5C06;&#x7B2C;&#x4E00;&#x4E2A;&#x6570;<code>a[i]</code> (<code>i = 0</code>) &#x4F5C;&#x4E3A;&#x5173;&#x952E;&#x6570;&#xFF0C;&#x5373;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x7684;&#x5206;&#x754C;&#x6570;&#x3002;&#x5148;&#x4ECE;&#x6570;&#x7EC4;&#x7684;&#x540E;&#x9762;&#x5F00;&#x59CB;&#x5373;&#x521D;&#x503C;<code>j = n-1</code>&#xFF0C;&#x9010;&#x4E2A;&#x5411;&#x524D;&#x8FDB;&#x884C;&#x904D;&#x5386;&#x4E0E;&#x9009;&#x7684;&#x7684;&#x5173;&#x952E;&#x6570;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;(<code>j--</code>)&#xFF0C;&#x82E5;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;&#x5173;&#x952E;&#x6570;&#x5219;&#x7EE7;&#x7EED;&#x904D;&#x5386;&#xFF0C;&#x5426;&#x5219;&#x5C06;&#x5176;&#x4E0E;&#x5173;&#x952E;&#x6570;&#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#x8FDB;&#x884C;&#x4EA4;&#x6362;&#xFF0C;&#x5E76;&#x505C;&#x6B62;&#x904D;&#x5386;&#x4E14;<code>i++</code>&#x8BB0;&#x5F55;&#x6B64;&#x65F6;&#x7684;<code>i</code>&#x3001;<code>j</code>&#x3002;</li>\n<li>&#x505C;&#x6B62;&#x524D;&#x9762;&#x7684;&#x904D;&#x5386;&#xFF0C;&#x518D;&#x4ECE;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<code>i</code>&#x4E2A;&#x4F4D;&#x7F6E;&#x5F00;&#x59CB;&#x5411;&#x540E;&#x8FDB;&#x884C;&#x904D;&#x5386;&#xFF0C;&#x9010;&#x4E2A;&#x4E0E;&#x5173;&#x952E;&#x6570;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;(<code>i++</code>)&#xFF0C;&#x82E5;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;&#x5173;&#x952E;&#x6570;&#x5219;&#x7EE7;&#x7EED;&#x904D;&#x5386;&#xFF0C;&#x5426;&#x5219;&#x5C06;&#x5176;&#x4E0E;&#x5173;&#x952E;&#x6570;&#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#x8FDB;&#x884C;&#x4EA4;&#x6362;&#xFF0C;&#x5E76;&#x505C;&#x6B62;&#x904D;&#x5386;&#x4E14;<code>j--</code>&#x8BB0;&#x5F55;&#x6B64;&#x65F6;&#x7684;<code>i</code>&#x3001;<code>j</code>&#x3002;</li>\n<li>&#x91CD;&#x590D;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230;<code>i==j</code>&#x5C31;&#x7ED3;&#x675F;&#x672C;&#x6B21;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x3002;</li>\n<li>&#x6B64;&#x65F6;&#x5DF2;&#x7ECF;&#x5C06;&#x5176;&#x6309;&#x5173;&#x952E;&#x6570;&#x5206;&#x6210;&#x4E24;&#x4E2A;&#x90E8;&#x5206;&#xFF0C;&#x518D;&#x91CD;&#x590D;&#x524D;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x5BF9;&#x5212;&#x5206;&#x7684;&#x90E8;&#x5206;&#x8FDB;&#x884C;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#xFF0C;&#x76F4;&#x5230;&#x5212;&#x5206;&#x7684;&#x7EC4;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x4E2A;&#x6570;&#x4E3A;<code>1</code>&#x5373;&#x6B64;&#x65F6;&#x6240;&#x6709;&#x6570;&#x636E;&#x6709;&#x5E8F;&#x3002;</li>\n</ol>\n<h1 id=\"&#x5E0C;&#x5C14;&#x6392;&#x5E8F;\"><a href=\"#&#x5E0C;&#x5C14;&#x6392;&#x5E8F;\" class=\"headerlink\" title=\"&#x5E0C;&#x5C14;&#x6392;&#x5E8F;\"></a>&#x5E0C;&#x5C14;&#x6392;&#x5E8F;</h1><h2 id=\"&#x601D;&#x60F3;-5\"><a href=\"#&#x601D;&#x60F3;-5\" class=\"headerlink\" title=\"&#x601D;&#x60F3;\"></a>&#x601D;&#x60F3;</h2><p><a href=\"https://idisfkj.github.io/2016/06/19/%E7%AE%97%E6%B3%95-%E5%85%AD-%E5%B8%8C%E5%B0%94%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x5E0C;&#x5C14;&#x6392;&#x5E8F;</a>&#x662F;&#x8BB0;&#x5F55;&#x589E;&#x91CF;&#x6765;&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;&#x518D;&#x5BF9;&#x5206;&#x7EC4;&#x5185;&#x90E8;&#x8FDB;&#x884C;<a href=\"http://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E4%B8%89-%E7%9B%B4%E6%8E%A5%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;</a>&#xFF0C;&#x968F;&#x7740;&#x589E;&#x91CF;&#x7684;&#x4E0D;&#x65AD;&#x51CF;&#x5C0F;&#xFF0C;&#x76F4;&#x5230;&#x589E;&#x91CF;&#x51CF;&#x5C0F;&#x5230;<code>1</code>&#x65F6;&#xFF0C;&#x5373;&#x6BCF;&#x4E2A;&#x5206;&#x7EC4;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x91CF;&#x4E3A;<code>1</code>&#xFF0C;&#x6B64;&#x65F6;&#x6392;&#x5E8F;&#x7ED3;&#x675F;&#x3002;</p>\n<h2 id=\"&#x6B65;&#x9AA4;-5\"><a href=\"#&#x6B65;&#x9AA4;-5\" class=\"headerlink\" title=\"&#x6B65;&#x9AA4;\"></a>&#x6B65;&#x9AA4;</h2><p>&#x8BBE;&#x5F85;&#x6392;&#x5E8F;&#x7684;&#x6570;&#x7EC4;&#x4E3A;<code>a[0...n-1]</code></p>\n<ol>\n<li>&#x4E00;&#x822C;&#x5F00;&#x59CB;&#x53D6;&#x589E;&#x91CF;&#x6570;<code>d=n/2</code>&#x3002;&#x4ECE;<code>a[0]~a[d-1]</code>&#x5C06;&#x6570;&#x7EC4;&#x4E2D;&#x6570;&#x636E;&#x4E4B;&#x95F4;&#x7684;&#x95F4;&#x9694;&#x4E3A;&#x589E;&#x91CF;&#x6570;<code>d</code>&#x7684;&#x500D;&#x6570;&#x5F52;&#x4E3A;&#x76F8;&#x540C;&#x7EC4;&#x3002;</li>\n<li>&#x4F9D;&#x6B21;&#x5BF9;&#x6BCF;&#x7EC4;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;<a href=\"http://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E4%B8%89-%E7%9B%B4%E6%8E%A5%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;</a>&#xFF0C;&#x4F7F;&#x5176;&#x6709;&#x5E8F;&#x3002;</li>\n<li>&#x518D;&#x589E;&#x91CF;&#x6570;<code>d=d/2</code>&#xFF0C;&#x91CD;&#x590D;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230;<code>d=1</code>&#x4E3A;&#x6B62;&#x3002;</li>\n</ol>\n<h1 id=\"&#x5806;&#x6392;&#x5E8F;\"><a href=\"#&#x5806;&#x6392;&#x5E8F;\" class=\"headerlink\" title=\"&#x5806;&#x6392;&#x5E8F;\"></a>&#x5806;&#x6392;&#x5E8F;</h1><h2 id=\"&#x601D;&#x60F3;-6\"><a href=\"#&#x601D;&#x60F3;-6\" class=\"headerlink\" title=\"&#x601D;&#x60F3;\"></a>&#x601D;&#x60F3;</h2><p><a href=\"https://idisfkj.github.io/2016/06/19/%E7%AE%97%E6%B3%95-%E4%B8%83-%E5%A0%86%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x5806;&#x6392;&#x5E8F;</a>&#x662F;&#x91C7;&#x7528;&#x6811;&#x7684;&#x5F62;&#x5F0F;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x6765;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x7684;&#xFF0C;&#x5176;&#x4E2D;&#x6BCF;&#x4E00;&#x4E2A;&#x5806;&#x90FD;&#x662F;&#x5B8C;&#x5168;&#x4E8C;&#x53C9;&#x6811;&#x3002;&#x5806;&#x6392;&#x5E8F;&#x5206;&#x4E3A;&#x5927;&#x6839;&#x5806;&#x4E0E;&#x5C0F;&#x6839;&#x5806;&#xFF0C;<code>&#x5927;&#x6839;&#x5806;&#xFF08;&#x5C0F;&#x6839;&#x5806;&#xFF09;&#x8868;&#x793A;&#x5728;&#x5B8C;&#x5168;&#x4E8C;&#x53C9;&#x6811;&#x4E2D;&#xFF0C;&#x6240;&#x7528;&#x7684;&#x975E;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x90FD;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;&#xFF08;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;&#xFF09;&#x4ED6;&#x4EEC;&#x5DE6;&#x53F3;&#x5B50;&#x8282;&#x70B9;&#xFF08;&#x5B58;&#x5728;&#xFF09;</code>&#x3002;&#x6240;&#x4EE5;&#x5806;&#x7684;&#x9876;&#x70B9;&#x4E0D;&#x662F;&#x6700;&#x5927;&#x6570;&#x5C31;&#x662F;&#x6700;&#x5C0F;&#x6570;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x501F;&#x52A9;&#x8FD9;&#x79CD;&#x6027;&#x8D28;&#xFF0C;<code>&#x6BCF;&#x6B21;&#x90FD;&#x53D6;&#x51FA;&#x5927;&#x6839;&#x5806;&#xFF08;&#x5C0F;&#x6839;&#x5806;&#xFF09;&#x7684;&#x9876;&#x70B9;&#x6570;&#xFF0C;&#x5F62;&#x6210;&#x6709;&#x5E8F;&#x5E8F;&#x5217;</code>&#x3002;</p>\n<h2 id=\"&#x6B65;&#x9AA4;-6\"><a href=\"#&#x6B65;&#x9AA4;-6\" class=\"headerlink\" title=\"&#x6B65;&#x9AA4;\"></a>&#x6B65;&#x9AA4;</h2><ol>\n<li>&#x9996;&#x5148;&#x751F;&#x6210;&#x5C0F;&#x6839;&#x5806;&#x6216;&#x5927;&#x6839;&#x5806;&#xFF0C;&#x8FD9;&#x91CC;&#x4EE5;&#x5C0F;&#x6839;&#x5806;&#x4E3A;&#x4F8B;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x6BCF;&#x4E00;&#x4E2A;&#x975E;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x90FD;&#x770B;&#x505A;&#x662F;&#x4E00;&#x4E2A;&#x6700;&#x5C0F;&#x7684;&#x5B8C;&#x5168;&#x4E8C;&#x53C9;&#x6811;&#xFF0C;&#x5C06;&#x4ED6;&#x4EEC;&#x90FD;&#x751F;&#x6210;&#x5C0F;&#x6839;&#x5806;&#xFF0C;&#x4ECE;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x975E;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x5F00;&#x59CB;&#xFF0C;&#x628A;&#x5176;&#x5F53;&#x505A;&#x662F;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x9010;&#x6B65;&#x5411;&#x524D;&#x8FDB;&#x884C;&#x521B;&#x5EFA;&#x5C0F;&#x6839;&#x5806;&#x3002;&#x4F8B;&#x5982;&#x4E0A;&#x56FE;&#x4E2D;&#x7684;&#x5927;&#x6839;&#x5806;&#xFF0C;&#x5C06;&#x5176;&#x53D8;&#x6210;&#x5C0F;&#x6839;&#x5806;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x5148;&#x4EE5;<code>30</code>&#x4E3A;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x6839;&#x636E;&#x5C0F;&#x6839;&#x5806;&#x7684;&#x6027;&#x8D28;&#xFF0C;&#x9700;&#x8981;&#x4E0E;<code>10</code>&#x4E92;&#x6362;&#x4F4D;&#x7F6E;;&#x518D;&#x4EE5;<code>60</code>&#x4E3A;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x53D1;&#x73B0;&#x9700;&#x8981;&#x4E0E;<code>15</code>&#x4E92;&#x6362;&#x4F4D;&#x7F6E;&#xFF1B;&#x6700;&#x540E;&#x4E0E;<code>70</code>&#x4E3A;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x9700;&#x8981;&#x4E0E;&#x539F;&#x6765;<code>30</code>&#x7684;&#x4F4D;&#x7F6E;&#x5373;&#x73B0;&#x5728;&#x4EA4;&#x6362;&#x4F4D;&#x7F6E;&#x7684;<code>10</code>&#x4E92;&#x6362;&#x4F4D;&#x7F6E;&#xFF0C;&#x6700;&#x7EC8;&#x5F62;&#x6210;&#x5C0F;&#x6839;&#x5806;&#x3002;</li>\n<li>&#x7136;&#x540E;&#x5C31;&#x662F;&#x53D6;&#x51FA;&#x5F62;&#x6210;&#x7684;&#x5C0F;&#x6839;&#x5806;&#x5F97;&#x9876;&#x70B9;&#x503C;&#xFF0C;&#x5C06;&#x5176;&#x4E0E;&#x5806;&#x4E2D;&#x7B2C;<code>N</code>(N=n)&#x4E2A;&#x8282;&#x70B9;&#x4E92;&#x6362;&#x4F4D;&#x7F6E;&#xFF0C;&#x5373;<code>a[N-1]</code>&#x3002;</li>\n<li>&#x6B64;&#x65F6;&#x5C0F;&#x6839;&#x5806;&#x88AB;&#x7834;&#x574F;&#xFF0C;&#x518D;&#x91CD;&#x65B0;&#x751F;&#x4EA7;&#x5C0F;&#x6839;&#x5806;<code>N--</code>&#xFF0C;&#x4F46;&#x6B64;&#x65F6;&#x8981;&#x751F;&#x6210;&#x7684;&#x6570;&#x7684;&#x8303;&#x56F4;&#x4E3A;<code>a[0...N-1]</code>&#x3002;</li>\n<li>&#x91CD;&#x590D;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;<code>2</code>&#x3001;<code>3</code>&#xFF0C;&#x76F4;&#x5230;<code>N=1</code>&#xFF0C;&#x5373;<code>a[0]</code>&#xFF0C;&#x6392;&#x5E8F;&#x7ED3;&#x675F;&#x3002;</li>\n</ol>\n<p>&#x5982;&#x6709;&#x4E0D;&#x8DB3;&#x4E4B;&#x5904;&#x6B22;&#x8FCE;&#x6307;&#x51FA;&#xFF0C;&#x5168;&#x90E8;&#x4EE3;&#x7801;&#x5DF2;&#x7ECF;&#x653E;&#x5230;github&#x4E0A;&#xFF0C;&#x6709;&#x9700;&#x8981;&#x7684;&#x53EF;&#x4EE5;&#x4E0B;&#x8F7D;&#x3002;</p>\n<p>github&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/idisfkj/Arithmetic\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/Arithmetic</a></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["java"],"tags":["算法"]},{"title":"算法(七)堆排序","url":"https://www.rousetime.com/2016/06/19/算法-七-堆排序/","content":"<p>&#x5806;&#x6392;&#x5E8F;&#x662F;&#x91C7;&#x7528;&#x6811;&#x7684;&#x5F62;&#x5F0F;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x6765;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x7684;&#xFF0C;&#x5176;&#x4E2D;&#x6BCF;&#x4E00;&#x4E2A;&#x5806;&#x90FD;&#x662F;&#x5B8C;&#x5168;&#x4E8C;&#x53C9;&#x6811;&#x3002;&#x5806;&#x6392;&#x5E8F;&#x5206;&#x4E3A;&#x5927;&#x6839;&#x5806;&#x4E0E;&#x5C0F;&#x6839;&#x5806;&#xFF0C;<code>&#x5927;&#x6839;&#x5806;&#xFF08;&#x5C0F;&#x6839;&#x5806;&#xFF09;&#x8868;&#x793A;&#x5728;&#x5B8C;&#x5168;&#x4E8C;&#x53C9;&#x6811;&#x4E2D;&#xFF0C;&#x6240;&#x7528;&#x7684;&#x975E;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x90FD;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;&#xFF08;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;&#xFF09;&#x4ED6;&#x4EEC;&#x5DE6;&#x53F3;&#x5B50;&#x8282;&#x70B9;&#xFF08;&#x5B58;&#x5728;&#xFF09;</code>&#x3002;&#x6240;&#x4EE5;&#x5806;&#x7684;&#x9876;&#x70B9;&#x4E0D;&#x662F;&#x6700;&#x5927;&#x6570;&#x5C31;&#x662F;&#x6700;&#x5C0F;&#x6570;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x501F;&#x52A9;&#x8FD9;&#x79CD;&#x6027;&#x8D28;&#xFF0C;<code>&#x6BCF;&#x6B21;&#x90FD;&#x53D6;&#x51FA;&#x5927;&#x6839;&#x5806;&#xFF08;&#x5C0F;&#x6839;&#x5806;&#xFF09;&#x7684;&#x9876;&#x70B9;&#x6570;&#xFF0C;&#x5F62;&#x6210;&#x6709;&#x5E8F;&#x5E8F;&#x5217;</code>&#x3002;</p>\n<h1 id=\"&#x57FA;&#x672C;&#x6B65;&#x9AA4;\"><a href=\"#&#x57FA;&#x672C;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x57FA;&#x672C;&#x6B65;&#x9AA4;\"></a>&#x57FA;&#x672C;&#x6B65;&#x9AA4;</h1><p>&#x9996;&#x5148;&#x8981;&#x660E;&#x767D;&#x5806;&#x5728;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x8868;&#x793A;&#x65B9;&#x5F0F;&#x3002;<code>&#x662F;&#x6309;&#x7167;&#x4ECE;&#x5806;&#x5F97;&#x9876;&#x70B9;&#x5F00;&#x59CB;&#x4ECE;&#x4E0A;&#x5F80;&#x4E0B;&#xFF0C;&#x4ECE;&#x5DE6;&#x5F80;&#x53F3;&#x5B58;&#x653E;&#x5230;&#x6570;&#x7EC4;&#x4E2D;</code>&#x3002;</p>\n<p><img src=\"/2016/06/19/&#x7B97;&#x6CD5;-&#x4E03;-&#x5806;&#x6392;&#x5E8F;/1.jpg\" alt=\"&#x5806;&#x56FE;\"></p>\n<blockquote>\n<p><em>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x56FE;&#x5E94;&#x8BE5;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x5806;&#x5728;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x5B58;&#x653E;&#x4F4D;&#x7F6E;</em></p>\n</blockquote>\n<p>&#x8BBE;&#x6570;&#x7EC4;&#x4E3A;<code>a[0...n-1]</code></p>\n<p>&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0;&#x975E;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x7684;<code>i</code>&#x7684;&#x5DE6;&#x53F3;&#x5B50;&#x8282;&#x70B9;(&#x5B58;&#x5728;)&#x5728;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#x5206;&#x522B;&#x4E3A;<code>i*2+1</code>&#x3001;<code>i*2+2</code>&#x3002;&#x800C;&#x5728;&#x6570;&#x7EC4;&#x4E2D;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x975E;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x7684;&#x4F4D;&#x7F6E;&#x53EF;&#x4EE5;&#x8868;&#x793A;&#x4E3A;<code>n/2-1</code>(n&#x4E3A;&#x6570;&#x7EC4;&#x7684;&#x5927;&#x5C0F;)&#x3002;&#x501F;&#x52A9;&#x8FD9;&#x4E9B;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5C0F;&#x6839;&#x5806;&#x4E0E;&#x5927;&#x6839;&#x5806;&#x7684;&#x5F62;&#x6210;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x80FD;&#x5B9E;&#x73B0;&#x5806;&#x6392;&#x5E8F;&#x3002;</p>\n<ol>\n<li>&#x9996;&#x5148;&#x751F;&#x6210;&#x5C0F;&#x6839;&#x5806;&#x6216;&#x5927;&#x6839;&#x5806;&#xFF0C;&#x8FD9;&#x91CC;&#x4EE5;&#x5C0F;&#x6839;&#x5806;&#x4E3A;&#x4F8B;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x6BCF;&#x4E00;&#x4E2A;&#x975E;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x90FD;&#x770B;&#x505A;&#x662F;&#x4E00;&#x4E2A;&#x6700;&#x5C0F;&#x7684;&#x5B8C;&#x5168;&#x4E8C;&#x53C9;&#x6811;&#xFF0C;&#x5C06;&#x4ED6;&#x4EEC;&#x90FD;&#x751F;&#x6210;&#x5C0F;&#x6839;&#x5806;&#xFF0C;&#x4ECE;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x975E;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x5F00;&#x59CB;&#xFF0C;&#x628A;&#x5176;&#x5F53;&#x505A;&#x662F;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x9010;&#x6B65;&#x5411;&#x524D;&#x8FDB;&#x884C;&#x521B;&#x5EFA;&#x5C0F;&#x6839;&#x5806;&#x3002;&#x4F8B;&#x5982;&#x4E0A;&#x56FE;&#x4E2D;&#x7684;&#x5927;&#x6839;&#x5806;&#xFF0C;&#x5C06;&#x5176;&#x53D8;&#x6210;&#x5C0F;&#x6839;&#x5806;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x5148;&#x4EE5;<code>30</code>&#x4E3A;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x6839;&#x636E;&#x5C0F;&#x6839;&#x5806;&#x7684;&#x6027;&#x8D28;&#xFF0C;&#x9700;&#x8981;&#x4E0E;<code>10</code>&#x4E92;&#x6362;&#x4F4D;&#x7F6E;;&#x518D;&#x4EE5;<code>60</code>&#x4E3A;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x53D1;&#x73B0;&#x9700;&#x8981;&#x4E0E;<code>15</code>&#x4E92;&#x6362;&#x4F4D;&#x7F6E;&#xFF1B;&#x6700;&#x540E;&#x4E0E;<code>70</code>&#x4E3A;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x9700;&#x8981;&#x4E0E;&#x539F;&#x6765;<code>30</code>&#x7684;&#x4F4D;&#x7F6E;&#x5373;&#x73B0;&#x5728;&#x4EA4;&#x6362;&#x4F4D;&#x7F6E;&#x7684;<code>10</code>&#x4E92;&#x6362;&#x4F4D;&#x7F6E;&#xFF0C;&#x6700;&#x7EC8;&#x5F62;&#x6210;&#x5C0F;&#x6839;&#x5806;&#x3002;</li>\n<li>&#x7136;&#x540E;&#x5C31;&#x662F;&#x53D6;&#x51FA;&#x5F62;&#x6210;&#x7684;&#x5C0F;&#x6839;&#x5806;&#x5F97;&#x9876;&#x70B9;&#x503C;&#xFF0C;&#x5C06;&#x5176;&#x4E0E;&#x5806;&#x4E2D;&#x7B2C;<code>N</code>(N=n)&#x4E2A;&#x8282;&#x70B9;&#x4E92;&#x6362;&#x4F4D;&#x7F6E;&#xFF0C;&#x5373;<code>a[N-1]</code>&#x3002;</li>\n<li>&#x6B64;&#x65F6;&#x5C0F;&#x6839;&#x5806;&#x88AB;&#x7834;&#x574F;&#xFF0C;&#x518D;&#x91CD;&#x65B0;&#x751F;&#x4EA7;&#x5C0F;&#x6839;&#x5806;<code>N--</code>&#xFF0C;&#x4F46;&#x6B64;&#x65F6;&#x8981;&#x751F;&#x6210;&#x7684;&#x6570;&#x7684;&#x8303;&#x56F4;&#x4E3A;<code>a[0...N-1]</code>&#x3002;</li>\n<li>&#x91CD;&#x590D;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;<code>2</code>&#x3001;<code>3</code>&#xFF0C;&#x76F4;&#x5230;<code>N=1</code>&#xFF0C;&#x5373;<code>a[0]</code>&#xFF0C;&#x6392;&#x5E8F;&#x7ED3;&#x675F;&#x3002;</li>\n</ol>\n<h1 id=\"&#x5B9E;&#x73B0;\"><a href=\"#&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;\"></a>&#x5B9E;&#x73B0;</h1><p>&#x4E0D;&#x7BA1;&#x662F;&#x6700;&#x5F00;&#x59CB;&#x7684;&#x521B;&#x5EFA;&#x5C0F;&#x6839;&#x5806;&#x8FD8;&#x662F;&#x6BCF;&#x6B21;&#x53D6;&#x4E86;&#x9876;&#x70B9;&#x6570;&#x4E4B;&#x540E;&#x518D;&#x8C03;&#x6574;&#x6210;&#x5C0F;&#x8DDF;&#x5806;&#xFF0C;&#x4ED6;&#x4EEC;&#x7684;&#x903B;&#x8F91;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;<code>&#x5373;&#x90FD;&#x662F;&#x4E0E;&#x5176;&#x5173;&#x952E;&#x5B57;&#x7684;&#x5B50;&#x8282;&#x70B9;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x9009;&#x51FA;&#x6700;&#x5C0F;&#x503C;&#xFF0C;&#x5C06;&#x5176;&#x653E;&#x5230;&#x7236;&#x8282;&#x70B9;&#x5904;&#x7684;&#x4F4D;&#x7F6E;</code>&#x3002;&#x6240;&#x4EE5;&#x8C03;&#x6574;&#x5C0F;&#x6839;&#x5806;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\">     * &#x8C03;&#x6574;&#x6210;&#x6700;&#x5C0F;&#x5806;</span><br><span class=\"line\">     * @param arr &#x6570;&#x7EC4;</span><br><span class=\"line\">     * @param top &#x5806;&#x9876;&#x4F4D;&#x7F6E;</span><br><span class=\"line\">     * @param tail &#x5806;&#x672A;&#x4F4D;&#x7F6E;</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public static void fitToMinHeap(int[] arr, int top, int tail) {</span><br><span class=\"line\">        int i = top;</span><br><span class=\"line\">        int temp = arr[i];</span><br><span class=\"line\">        int j = 2 * i + 1;//&#x627E;&#x5230;&#x5B50;&#x8282;&#x70B9;</span><br><span class=\"line\">        while (j &lt; tail) {</span><br><span class=\"line\">            if (j + 1 &lt; tail &amp;&amp; arr[j + 1] &lt; arr[j])//&#x627E;&#x51FA;&#x5DE6;&#x53F3;&#x5B50;&#x8282;&#x70B9;&#x4E2D;&#x7684;&#x6700;&#x5C0F;</span><br><span class=\"line\">                j++;</span><br><span class=\"line\"></span><br><span class=\"line\">            if (arr[j] &gt;= temp)//&#x5B50;&#x8282;&#x70B9;&#x90FD;&#x5927;&#x4E8E;&#x7236;&#x8282;&#x70B9;&#x5219;&#x8DF3;&#x51FA;</span><br><span class=\"line\">                break;</span><br><span class=\"line\"></span><br><span class=\"line\">            arr[i] = arr[j];//&#x5C06;&#x5B50;&#x8282;&#x70B9;&#x5411;&#x4E0A;&#x79FB;,&#x5373;&#x79FB;&#x5230;&#x7236;&#x8282;&#x70B9;</span><br><span class=\"line\">            i = j;</span><br><span class=\"line\">            j = 2 * i + 1;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        arr[i] = temp;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x7684;&#x4F4D;&#x7F6E;&#x4EA4;&#x6362;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x6BCF;&#x6B21;&#x90FD;&#x8FDB;&#x884C;&#x4EA4;&#x6362;&#xFF0C;&#x800C;&#x662F;&#x4E0E;&#x524D;&#x9762;&#x7684;<a href=\"https://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E4%BA%94-%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x5FEB;&#x901F;&#x6392;&#x5E8F;</a>&#x4E00;&#x6837;&#xFF0C;&#x6700;&#x540E;&#x624D;&#x5C06;&#x5173;&#x952E;&#x5B57;&#x653E;&#x5230;&#x4ED6;&#x6240;&#x8981;&#x5B58;&#x653E;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>\n<p>&#x4E3B;&#x8981;&#x7684;&#x751F;&#x6210;&#x6700;&#x5C0F;&#x5806;&#x7684;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x5C31;&#x662F;&#x53D6;&#x6570;&#xFF0C;&#x518D;&#x8C03;&#x6574;&#xFF0C;&#x518D;&#x53D6;&#x6570;&#x7684;&#x5FAA;&#x73AF;&#x5B9E;&#x73B0;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void heapSort(int[] arr) {</span><br><span class=\"line\">        int n = arr.length;</span><br><span class=\"line\">        for (int j = n / 2 - 1; j &gt;= 0; j--)//&#x4ECE;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x975E;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x5F00;&#x59CB;,&#x521D;&#x59CB;&#x5316;&#x751F;&#x6210;&#x6570;&#x7EC4;&#x8868;&#x793A;&#x7684;&#x6700;&#x5C0F;&#x5806;</span><br><span class=\"line\">            fitToMinHeap(arr, j, n);</span><br><span class=\"line\"></span><br><span class=\"line\">        for (int i = n - 1; i &gt; 0; i--) {//&#x6BCF;&#x6B21;&#x62FF;&#x51FA;&#x5806;&#x7684;&#x9876;&#x70B9;&#x503C;</span><br><span class=\"line\">            //&#x628A;&#x5806;&#x4E2D;&#x7684;&#x9876;&#x70B9;&#x4E0E;a[i]&#x70B9;&#x4E92;&#x6362;</span><br><span class=\"line\">            int temp = arr[0];</span><br><span class=\"line\">            arr[0] = arr[i];</span><br><span class=\"line\">            arr[i] = temp;</span><br><span class=\"line\">            fitToMinHeap(arr, 0, i);//&#x4EA4;&#x6362;&#x540E;&#x518D;&#x5BF9;&#x524D;i&#x4E2A;&#x8282;&#x70B9;&#x8FDB;&#x884C;&#x6700;&#x5C0F;&#x5806;&#x5316;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x5F53;&#x7136;&#x4F7F;&#x7528;&#x5C0F;&#x6839;&#x5806;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x9006;&#x5E8F;&#x5E8F;&#x5217;&#xFF0C;&#x5373;&#x4ECE;&#x5927;&#x5230;&#x5C0F;&#x7684;&#x6392;&#x5E8F;</em></p>\n</blockquote>\n<h1 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h1><p>&#x4E2A;&#x4EBA;&#x8BA4;&#x4E3A;&#xFF0C;&#x5806;&#x6392;&#x5E8F;&#x8981;&#x7406;&#x89E3;&#x4EE5;&#x4E0B;&#x51E0;&#x70B9;</p>\n<ul>\n<li>&#x4F55;&#x4E3A;&#x5C0F;&#x6839;&#x5806;&#x3001;&#x5927;&#x6839;&#x5806;</li>\n<li>&#x5806;&#x7684;&#x521B;&#x5EFA;&#x539F;&#x7406;</li>\n<li>&#x5806;&#x6392;&#x5E8F;&#x7684;&#x53D6;&#x6570;&#x539F;&#x7406;</li>\n</ul>\n<p>&#x901A;&#x8FC7;&#x4EE5;&#x4E0A;&#x51E0;&#x70B9;&#x7684;&#x7406;&#x89E3;&#x5C31;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x638C;&#x63E1;&#x5806;&#x6392;&#x5E8F;&#x3002;&#x6700;&#x540E;&#x5806;&#x6392;&#x5E8F;&#x4E3A;&#x4E0D;&#x7A33;&#x5B9A;&#x6392;&#x5E8F;&#xFF0C;&#x4E14;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;<code>O(nlogn)</code>&#x3002;</p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["java"],"tags":["算法"]},{"title":"算法(六)希尔排序","url":"https://www.rousetime.com/2016/06/19/算法-六-希尔排序/","content":"<p>&#x5E0C;&#x5C14;&#x6392;&#x5E8F;&#x662F;&#x63D2;&#x5165;&#x6392;&#x5E8F;&#x7684;&#x4E00;&#x79CD;&#xFF0C;&#x662F;<a href=\"https://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E4%B8%89-%E7%9B%B4%E6%8E%A5%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;</a>&#x7684;&#x66F4;&#x9AD8;&#x6548;&#x7684;&#x6539;&#x8FDB;&#x7248;&#x3002;&#x5E0C;&#x5C14;&#x6392;&#x5E8F;&#x662F;&#x8BB0;&#x5F55;&#x589E;&#x91CF;&#x6765;&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;&#x518D;&#x5BF9;&#x5206;&#x7EC4;&#x5185;&#x90E8;&#x8FDB;&#x884C;<a href=\"https://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E4%B8%89-%E7%9B%B4%E6%8E%A5%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;</a>&#xFF0C;&#x968F;&#x7740;&#x589E;&#x91CF;&#x7684;&#x4E0D;&#x65AD;&#x51CF;&#x5C0F;&#xFF0C;&#x76F4;&#x5230;&#x589E;&#x91CF;&#x51CF;&#x5C0F;&#x5230;<code>1</code>&#x65F6;&#xFF0C;&#x5373;&#x6BCF;&#x4E2A;&#x5206;&#x7EC4;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x91CF;&#x4E3A;<code>1</code>&#xFF0C;&#x6B64;&#x65F6;&#x6392;&#x5E8F;&#x7ED3;&#x675F;&#x3002;</p>\n<h1 id=\"&#x57FA;&#x672C;&#x6B65;&#x9AA4;\"><a href=\"#&#x57FA;&#x672C;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x57FA;&#x672C;&#x6B65;&#x9AA4;\"></a>&#x57FA;&#x672C;&#x6B65;&#x9AA4;</h1><p>&#x8BBE;&#x5F85;&#x6392;&#x5E8F;&#x7684;&#x6570;&#x7EC4;&#x4E3A;<code>a[0...n-1]</code></p>\n<ol>\n<li>&#x4E00;&#x822C;&#x5F00;&#x59CB;&#x53D6;&#x589E;&#x91CF;&#x6570;<code>d=n/2</code>&#x3002;&#x4ECE;<code>a[0]~a[d-1]</code>&#x5C06;&#x6570;&#x7EC4;&#x4E2D;&#x6570;&#x636E;&#x4E4B;&#x95F4;&#x7684;&#x95F4;&#x9694;&#x4E3A;&#x589E;&#x91CF;&#x6570;<code>d</code>&#x7684;&#x500D;&#x6570;&#x5F52;&#x4E3A;&#x76F8;&#x540C;&#x7EC4;&#x3002;</li>\n<li>&#x4F9D;&#x6B21;&#x5BF9;&#x6BCF;&#x7EC4;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;<a href=\"https://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E4%B8%89-%E7%9B%B4%E6%8E%A5%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;</a>&#xFF0C;&#x4F7F;&#x5176;&#x6709;&#x5E8F;&#x3002;</li>\n<li>&#x518D;&#x589E;&#x91CF;&#x6570;<code>d=d/2</code>&#xFF0C;&#x91CD;&#x590D;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230;<code>d=1</code>&#x4E3A;&#x6B62;&#x3002;</li>\n</ol>\n<p>&#x4F8B;&#x5982;&#x53D6;<code>d=10</code>&#x4E3A;&#x4F8B;&#xFF1A;</p>\n<p><code>23, 4, 6, 34, 35, 47, 546, 32, 6,10</code></p>\n<p>&#x53D6;<code>d=5</code>,&#x4EE5;&#x540E;&#x4F9D;&#x6B21;&#x533A;<code>d</code>&#x7684;&#x4E00;&#x534A;</p>\n<p><code>23, 4, 6, 34, 35, 47, 546, 32, 6,10</code><br><code>23</code> &#x2014;&#x2014;&#x2014;&#x2014;&#x2014; <code>47</code><br>&#x2014;&#x2013;<code>4</code> &#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2013;<code>546</code><br>&#x2014;&#x2014;&#x2014;<code>6</code> &#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014; <code>32</code><br>&#x2014;&#x2014;&#x2014;&#x2014;<code>34</code> &#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014; <code>6</code><br>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014; <code>35</code> &#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2013; <code>10</code><br>&#x7B2C;&#x4E00;&#x8D9F;&#x7ED3;&#x679C;&#xFF1A;<br><code>23, 4, 6, 6, 10, 47, 546, 32, 34, 35</code></p>\n<p><code>d=2</code></p>\n<p><code>23</code>&#x2014;<code>6</code>&#x2014;<code>10</code>&#x2014; <code>546</code>&#x2014;&#x2013;<code>34</code><br>&#x2014;&#x2013;<code>4</code>&#x2013;<code>6</code>&#x2014; <code>47</code>&#x2014;&#x2014; <code>32</code>&#x2014; <code>35</code><br>&#x7B2C;&#x4E8C;&#x8D9F;&#x7ED3;&#x679C;&#xFF1A;<br><code>6, 4, 10, 6, 23, 32, 34, 35, 546, 47</code></p>\n<p><code>d=1</code></p>\n<p><code>6, 4, 10, 6, 23, 32, 34, 35, 546, 47</code><br>&#x7B2C;&#x4E09;&#x8D9F;&#x7ED3;&#x679C;&#xFF1A;<br><code>4, 6, 6, 10, 23, 32, 34, 35, 47, 546</code></p>\n<p>&#x5E8F;&#x5217;&#x6709;&#x5E8F;&#xFF0C;&#x6B64;&#x65F6;&#x6392;&#x5E8F;&#x7ED3;&#x675F;&#x3002;</p>\n<h1 id=\"&#x5B9E;&#x73B0;\"><a href=\"#&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;\"></a>&#x5B9E;&#x73B0;</h1><p>&#x6309;&#x7167;&#x4E0A;&#x9762;&#x7684;&#x5206;&#x6790;&#x6B65;&#x9AA4;&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x4E3B;&#x8981;&#x662F;&#x5BF9;<code>d</code>&#x7684;&#x503C;&#x8FDB;&#x884C;&#x63A7;&#x5236;&#xFF0C;&#x6240;&#x4EE5;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x5982;&#x4E0B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void shellSort(int[] arr) {</span><br><span class=\"line\">        int temp;</span><br><span class=\"line\">        //&#x589E;&#x91CF;&#x503C;</span><br><span class=\"line\">        int d = arr.length / 2;</span><br><span class=\"line\">        while (true) {</span><br><span class=\"line\">            for (int i = 0; i &lt; d; i++) {//&#x5206;&#x6210;&#x82E5;&#x5E72;&#x7EC4;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</span><br><span class=\"line\">                for (int j = i; j + d &lt; arr.length; j += d) {</span><br><span class=\"line\">                    for (int k = j + d; k - d &gt;= 0; k -= d) {//&#x4F7F;&#x7528;&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;</span><br><span class=\"line\">                        if (arr[k] &lt; arr[k - d]) {</span><br><span class=\"line\">                            temp = arr[k];</span><br><span class=\"line\">                            arr[k] = arr[k - d];</span><br><span class=\"line\">                            arr[k - d] = temp;</span><br><span class=\"line\">                        } else {</span><br><span class=\"line\">                            break;</span><br><span class=\"line\">                        }</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">            if (d == 1) break;</span><br><span class=\"line\">            d = d / 2;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<h1 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h1><p>&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x662F;&#x4E0D;&#x7A33;&#x5B9A;&#x6392;&#x5E8F;&#xFF0C;&#x867D;&#x7136;&#x5BF9;&#x6BCF;&#x7EC4;&#x7684;&#x6392;&#x5E8F;&#x662F;&#x4F7F;&#x7528;<a href=\"https://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E4%B8%89-%E7%9B%B4%E6%8E%A5%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;</a>&#xFF0C;&#x5728;&#x5206;&#x7EC4;&#x4E2D;&#x662F;&#x7A33;&#x5B9A;&#x7684;&#xFF0C;&#x4F46;&#x7531;&#x4E8E;&#x4F1A;&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;&#x6570;&#x7EC4;&#x6240;&#x5728;&#x7EC4;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x6240;&#x4EE5;&#x5E76;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x5B83;&#x6574;&#x4F53;&#x662F;&#x7A33;&#x5B9A;&#x6392;&#x5E8F;&#x3002;&#x81F3;&#x4E8E;<code>d</code>&#x7684;&#x53D6;&#x503C;&#x4E5F;&#x6CA1;&#x6709;&#x7EDD;&#x5BF9;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x60C5;&#x51B5;&#x53D6;&#x503C;&#x4E0E;&#x53D8;&#x5316;&#x3002;</p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["java"],"tags":["算法"]},{"title":"算法(五)快速排序","url":"https://www.rousetime.com/2016/06/18/算法-五-快速排序/","content":"<p>&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x662F;&#x5BF9;<a href=\"https://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E4%BA%8C-%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x5192;&#x6CE1;&#x6392;&#x5E8F;</a>&#x7684;&#x4E00;&#x79CD;&#x6539;&#x8FDB;&#x3002;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x7531;<code>C. A. R. Hoare</code>&#x5728;<code>1962</code>&#x5E74;&#x63D0;&#x51FA;&#x3002;&#x5B83;&#x7684;&#x4E3B;&#x8981;&#x601D;&#x60F3;&#x662F;&#xFF1A;<code>&#x5C06;&#x4E00;&#x4E2A;&#x5F85;&#x6392;&#x5E8F;&#x5E8F;&#x5217;&#x5206;&#x6210;&#x4E24;&#x4E2A;&#x90E8;&#x5206;&#xFF0C;&#x4EE5;&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x4F5C;&#x4E3A;&#x5206;&#x754C;&#x7EBF;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x90E8;&#x5206;&#x5C0F;&#x4E8E;&#x8FD9;&#x4E2A;&#x5206;&#x754C;&#x7EBF;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x53E6;&#x4E00;&#x90E8;&#x5206;&#x5927;&#x4E8E;&#x8FD9;&#x4E2A;&#x5206;&#x754C;&#x7EBF;&#x7684;&#x6570;&#x636E;&#x3002;&#x56E0;&#x4E3A;&#x91C7;&#x7528;&#x9012;&#x5F52;&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x518D;&#x5BF9;&#x8FD9;&#x4E24;&#x4E2A;&#x5E8F;&#x5217;&#x8FDB;&#x884C;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#xFF0C;&#x76F4;&#x5230;&#x6240;&#x4EE5;&#x7684;&#x6570;&#x636E;&#x90FD;&#x662F;&#x6709;&#x5E8F;&#x7684;</code>&#x3002;</p>\n<h1 id=\"&#x57FA;&#x672C;&#x6B65;&#x9AA4;\"><a href=\"#&#x57FA;&#x672C;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x57FA;&#x672C;&#x6B65;&#x9AA4;\"></a>&#x57FA;&#x672C;&#x6B65;&#x9AA4;</h1><p>&#x5047;&#x8BBE;&#x5F85;&#x6392;&#x5E8F;&#x7684;&#x6570;&#x7EC4;&#x4E3A;<code>a[0...n-1]</code></p>\n<ol>\n<li>&#x4E00;&#x822C;&#x90FD;&#x5C06;&#x7B2C;&#x4E00;&#x4E2A;&#x6570;<code>a[i]</code> (<code>i = 0</code>) &#x4F5C;&#x4E3A;&#x5173;&#x952E;&#x6570;&#xFF0C;&#x5373;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x7684;&#x5206;&#x754C;&#x6570;&#x3002;&#x5148;&#x4ECE;&#x6570;&#x7EC4;&#x7684;&#x540E;&#x9762;&#x5F00;&#x59CB;&#x5373;&#x521D;&#x503C;<code>j = n-1</code>&#xFF0C;&#x9010;&#x4E2A;&#x5411;&#x524D;&#x8FDB;&#x884C;&#x904D;&#x5386;&#x4E0E;&#x9009;&#x7684;&#x7684;&#x5173;&#x952E;&#x6570;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;(<code>j--</code>)&#xFF0C;&#x82E5;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;&#x5173;&#x952E;&#x6570;&#x5219;&#x7EE7;&#x7EED;&#x904D;&#x5386;&#xFF0C;&#x5426;&#x5219;&#x5C06;&#x5176;&#x4E0E;&#x5173;&#x952E;&#x6570;&#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#x8FDB;&#x884C;&#x4EA4;&#x6362;&#xFF0C;&#x5E76;&#x505C;&#x6B62;&#x904D;&#x5386;&#x4E14;<code>i++</code>&#x8BB0;&#x5F55;&#x6B64;&#x65F6;&#x7684;<code>i</code>&#x3001;<code>j</code>&#x3002;</li>\n<li>&#x505C;&#x6B62;&#x524D;&#x9762;&#x7684;&#x904D;&#x5386;&#xFF0C;&#x518D;&#x4ECE;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<code>i</code>&#x4E2A;&#x4F4D;&#x7F6E;&#x5F00;&#x59CB;&#x5411;&#x540E;&#x8FDB;&#x884C;&#x904D;&#x5386;&#xFF0C;&#x9010;&#x4E2A;&#x4E0E;&#x5173;&#x952E;&#x6570;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;(<code>i++</code>)&#xFF0C;&#x82E5;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;&#x5173;&#x952E;&#x6570;&#x5219;&#x7EE7;&#x7EED;&#x904D;&#x5386;&#xFF0C;&#x5426;&#x5219;&#x5C06;&#x5176;&#x4E0E;&#x5173;&#x952E;&#x6570;&#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#x8FDB;&#x884C;&#x4EA4;&#x6362;&#xFF0C;&#x5E76;&#x505C;&#x6B62;&#x904D;&#x5386;&#x4E14;<code>j--</code>&#x8BB0;&#x5F55;&#x6B64;&#x65F6;&#x7684;<code>i</code>&#x3001;<code>j</code>&#x3002;</li>\n<li>&#x91CD;&#x590D;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230;<code>i==j</code>&#x5C31;&#x7ED3;&#x675F;&#x672C;&#x6B21;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x3002;</li>\n<li>&#x6B64;&#x65F6;&#x5DF2;&#x7ECF;&#x5C06;&#x5176;&#x6309;&#x5173;&#x952E;&#x6570;&#x5206;&#x6210;&#x4E24;&#x4E2A;&#x90E8;&#x5206;&#xFF0C;&#x518D;&#x91CD;&#x590D;&#x524D;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x5BF9;&#x5212;&#x5206;&#x7684;&#x90E8;&#x5206;&#x8FDB;&#x884C;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#xFF0C;&#x76F4;&#x5230;&#x5212;&#x5206;&#x7684;&#x7EC4;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x4E2A;&#x6570;&#x4E3A;<code>1</code>&#x5373;&#x6B64;&#x65F6;&#x6240;&#x6709;&#x6570;&#x636E;&#x6709;&#x5E8F;&#x3002;</li>\n</ol>\n<blockquote>\n<p><em>&#x6839;&#x636E;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x5148;&#x8FDB;&#x884C;&#x5173;&#x952E;&#x5B57;&#x5212;&#x5206;&#x7684;&#x5B9E;&#x73B0;</em></p>\n</blockquote>\n<h1 id=\"&#x5B9E;&#x73B0;\"><a href=\"#&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;\"></a>&#x5B9E;&#x73B0;</h1><h2 id=\"&#x6392;&#x5E8F;\"><a href=\"#&#x6392;&#x5E8F;\" class=\"headerlink\" title=\"&#x6392;&#x5E8F;\"></a>&#x6392;&#x5E8F;</h2><p>&#x6309;&#x7167;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;<code>1</code>&#x3001;<code>2</code>&#x3001;<code>3</code>&#x5B9E;&#x73B0;&#x5173;&#x952E;&#x5B57;&#x7684;&#x5212;&#x5206;&#x5373;&#x4E00;&#x8D9F;&#x5B8C;&#x6574;&#x7684;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x3002;<br>&#x6211;&#x8FD9;&#x91CC;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x6570;&#x636E;&#x7684;&#x9891;&#x7E41;&#x4EA4;&#x6362;&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x6B21;&#x90FD;&#x662F;&#x4E0E;&#x5173;&#x952E;&#x5B57;&#x8FDB;&#x884C;&#x4EA4;&#x6362;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x6700;&#x540E;&#x8FD9;&#x8D9F;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x5B8C;&#x4E86;&#x4EE5;&#x540E;&#x518D;&#x5C06;&#x5176;&#x653E;&#x5230;&#x4ED6;&#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#x4E0A;&#x3002;&#x76F8;&#x5F53;&#x4E8E;&#x6570;&#x636E;&#x7684;&#x4F20;&#x9012;<code>a=b,b=c,c=d,d=e</code>&#x6700;&#x7EC8;&#x5C31;&#x662F;<code>a=e</code>&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static int sort(int[] arr, int low, int height) {</span><br><span class=\"line\">        int i = low;</span><br><span class=\"line\">        int j = height;</span><br><span class=\"line\">        int k = arr[low];//&#x8BB0;&#x5F55;&#x5F00;&#x59CB;&#x7684;&#x5173;&#x952E;&#x6570;</span><br><span class=\"line\">        while (i &lt; j) {</span><br><span class=\"line\">            while (i &lt; j &amp;&amp; arr[j] &gt;= k) //&#x5148;&#x4ECE;&#x53F3;&#x5411;&#x5DE6;&#x627E;&#x5230;&#x7B2C;&#x4E00;&#x4E2A;&#x5C0F;&#x4E8E;k&#x7684;&#x4F4D;&#x7F6E;</span><br><span class=\"line\">                j--;</span><br><span class=\"line\">            if (i &lt; j) {</span><br><span class=\"line\">                arr[i] = arr[j];//&#x5C06;&#x627E;&#x5230;&#x7684;&#x6570;&#x66FF;&#x6362;&#x5230;i&#x4F4D;&#x7F6E;</span><br><span class=\"line\">                i++;</span><br><span class=\"line\">            }</span><br><span class=\"line\"></span><br><span class=\"line\">            while (i &lt; j &amp;&amp; arr[i] &lt;= k) //&#x518D;&#x4ECE;&#x5DE6;&#x5411;&#x53F3;&#x627E;&#x5230;&#x7B2C;&#x4E00;&#x4E2A;&#x5927;&#x4E8E;k&#x7684;&#x4F4D;&#x7F6E;</span><br><span class=\"line\">                i++;</span><br><span class=\"line\">            if (i &lt; j) {</span><br><span class=\"line\">                arr[j] = arr[i];//&#x5C06;&#x627E;&#x5230;&#x7684;&#x6570;&#x66FF;&#x6362;&#x5230;j&#x4F4D;&#x7F6E;</span><br><span class=\"line\">                j--;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        arr[i] = k;//&#x5F53;i == j &#x65F6;,&#x6700;&#x540E;&#x5C06;&#x6700;&#x521D;&#x7684;&#x5173;&#x952E;&#x6570;&#x66FF;&#x4EE3;&#x5230;i&#x4F4D;&#x7F6E;</span><br><span class=\"line\">        return i;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x5206;&#x6CBB;&#x9012;&#x5F52;\"><a href=\"#&#x5206;&#x6CBB;&#x9012;&#x5F52;\" class=\"headerlink\" title=\"&#x5206;&#x6CBB;&#x9012;&#x5F52;\"></a>&#x5206;&#x6CBB;&#x9012;&#x5F52;</h2><p>&#x7136;&#x540E;&#x5C31;&#x662F;&#x5BF9;&#x6574;&#x4E2A;&#x5F85;&#x6392;&#x5E8F;&#x6570;&#x7EC4;&#x8FDB;&#x884C;<code>&#x5206;&#x6CBB;&#x9012;&#x5F52;</code>&#x9010;&#x4E2A;&#x8FDB;&#x884C;&#x5FEB;&#x901F;&#x6392;&#x5E8F;,&#x76F4;&#x5230;&#x5212;&#x5206;&#x7684;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x4E2A;&#x6570;&#x4E3A;<code>1</code>&#x4E3A;&#x6B62;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ublic static void quickSort(int[] arr, int low, int height) {</span><br><span class=\"line\">        if (low &lt; height) {</span><br><span class=\"line\">            int mid = sort(arr, low, height);</span><br><span class=\"line\">            quickSort(arr, low, mid - 1);</span><br><span class=\"line\">            quickSort(arr, mid + 1, height);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<h1 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h1><p>&#x5F53;&#x7136;&#x5BF9;&#x4E8E;&#x5173;&#x952E;&#x6570;&#x7684;&#x9009;&#x53D6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#xFF0C;&#x4F8B;&#x5982;&#x9009;&#x53D6;&#x4E2D;&#x95F4;&#x7684;&#x503C;&#x4F5C;&#x4E3A;&#x5173;&#x952E;&#x6570;&#xFF0C;&#x81F3;&#x4E8E;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x7684;&#x6700;&#x597D;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;<code>O(logn)</code>&#xFF0C;&#x6700;&#x574F;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;<code>O(n^2)</code>&#x4E14;&#x5176;&#x4E3A;&#x4E0D;&#x7A33;&#x5B9A;&#x6392;&#x5E8F;&#x3002;</p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["java"],"tags":["算法"]},{"title":"算法(四)归并排序","url":"https://www.rousetime.com/2016/06/18/算法-四-归并排序/","content":"<p>&#x5F52;&#x5E76;&#x6392;&#x5E8F;&#x662F;&#x4E00;&#x4E2A;&#x6548;&#x7387;&#x76F8;&#x5BF9;&#x8F83;&#x9AD8;&#x7684;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;&#xFF0C;&#x5B83;&#x91C7;&#x7528;&#x7684;&#x662F;<code>&#x5206;&#x6CBB;&#x7684;&#x601D;&#x60F3;</code>&#xFF0C;&#x5C06;&#x5F85;&#x6392;&#x5E8F;&#x7684;&#x5E8F;&#x5217;&#x5206;&#x6210;&#x82E5;&#x5E72;&#x7EC4;&#xFF0C;&#x4FDD;&#x8BC1;&#x6BCF;&#x7EC4;&#x90FD;&#x6709;&#x5E8F;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x5408;&#x5E76;&#x6392;&#x5E8F;&#xFF0C;&#x6700;&#x7EC8;&#x4F7F;&#x6574;&#x4E2A;&#x5E8F;&#x5217;&#x6709;&#x5E8F;&#x3002;</p>\n<h1 id=\"&#x57FA;&#x672C;&#x6B65;&#x9AA4;\"><a href=\"#&#x57FA;&#x672C;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x57FA;&#x672C;&#x6B65;&#x9AA4;\"></a>&#x57FA;&#x672C;&#x6B65;&#x9AA4;</h1><ol>\n<li>&#x5C06;&#x5F85;&#x6392;&#x5E8F;&#x7684;&#x5E8F;&#x5217;&#x91C7;&#x7528;<code>&#x5206;&#x6CBB;&#x601D;&#x60F3;</code>&#x5C06;&#x5176;&#x5212;&#x5206;&#x6210;&#x82E5;&#x5E72;&#x7EC4;&#xFF0C;&#x4F7F;&#x5176;&#x6709;&#x5E8F;&#xFF0C;&#x5176;&#x4E2D;&#x53EF;&#x91C7;&#x7528;&#x9012;&#x5F52;&#x8FDB;&#x884C;&#x5212;&#x5206;&#x3002;</li>\n<li>&#x5C06;&#x6709;&#x5E8F;&#x7684;&#x7EC4;&#x5206;&#x522B;&#x8FDB;&#x884C;&#x5F52;&#x5E76;&#x64CD;&#x4F5C;&#xFF0C;&#x5176;&#x4E2D;&#x501F;&#x52A9;&#x4E00;&#x4E2A;&#x8F85;&#x52A9;&#x6570;&#x7EC4;&#xFF0C;&#x5C06;&#x5DE6;&#x53F3;&#x5212;&#x5206;&#x7684;&#x6709;&#x5E8F;&#x7EC4;&#x4ECE;&#x5934;&#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x5C06;&#x8F83;&#x5C0F;&#x7684;&#x6570;&#x52A0;&#x5165;&#x5230;&#x8F85;&#x52A9;&#x6570;&#x7EC4;&#x4E2D;&#xFF0C;&#x4E14;&#x8F83;&#x5C0F;&#x7684;&#x6240;&#x5728;&#x6709;&#x5E8F;&#x6570;&#x7EC4;&#x5411;&#x540E;&#x81EA;&#x589E;&#xFF0C;&#x518D;&#x4E0E;&#x539F;&#x6765;&#x6BD4;&#x8F83;&#x7684;&#x6570;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x3002;</li>\n<li>&#x91CD;&#x590D;&#x4E0A;&#x9762;<code>2</code>&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230;&#x6240;&#x6709;&#x6570;&#x636E;&#x6BD4;&#x8F83;&#x5B8C;&#x6BD5;&#xFF0C;&#x6216;&#x8005;&#x5C06;&#x8FD8;&#x6709;&#x5269;&#x4F59;&#x6570;&#x672A;&#x6BD4;&#x8F83;&#x7684;&#x6709;&#x5E8F;&#x6570;&#x636E;&#x76F4;&#x63A5;&#x6309;&#x539F;&#x6709;&#x7684;&#x987A;&#x5E8F;&#x52A0;&#x5165;&#x5230;&#x8F85;&#x52A9;&#x6570;&#x7EC4;&#x4E2D;,&#x6700;&#x540E;&#x5C06;&#x5DF2;&#x7ECF;&#x6392;&#x597D;&#x5E8F;&#x7684;&#x8F85;&#x52A9;&#x6570;&#x7EC4;&#x52A0;&#x5165;&#x5230;&#x539F;&#x6709;&#x6570;&#x7EC4;&#x7684;&#x76F8;&#x5E94;&#x4F4D;&#x7F6E;&#x3002;</li>\n<li>&#x91CD;&#x590D;&#x4E0A;&#x9762;&#x7684;<code>2</code>&#x3001;<code>3</code>&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230;&#x6240;&#x6709;&#x7684;&#x5DE6;&#x53F3;&#x5212;&#x5206;&#x5F52;&#x5E76;&#x5B8C;&#x6BD5;&#x3002;</li>\n</ol>\n<blockquote>\n<p><em>&#x6839;&#x636E;&#x6B65;&#x9AA4;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5148;&#x5BF9;&#x4E24;&#x4E2A;&#x6709;&#x5E8F;&#x5E8F;&#x5217;&#x5F52;&#x5E76;&#x7684;&#x64CD;&#x4F5C;&#x8FDB;&#x884C;&#x5B9E;&#x73B0;</em></p>\n</blockquote>\n<h1 id=\"&#x5B9E;&#x73B0;\"><a href=\"#&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;\"></a>&#x5B9E;&#x73B0;</h1><h2 id=\"&#x5408;&#x5E76;\"><a href=\"#&#x5408;&#x5E76;\" class=\"headerlink\" title=\"&#x5408;&#x5E76;\"></a>&#x5408;&#x5E76;</h2><p>&#x6309;&#x7167;&#x4E0A;&#x9762;&#x7684;<code>2</code>&#x3001;<code>3</code>&#x6B65;&#x9AA4;&#xFF0C;&#x5B9E;&#x73B0;&#x5408;&#x5E76;&#x64CD;&#x4F5C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void merge(int[] arr, int low, int mid, int height) {</span><br><span class=\"line\">        int i = low;</span><br><span class=\"line\">        int j = mid + 1;</span><br><span class=\"line\">        int k = 0;</span><br><span class=\"line\">        int[] temp = new int[height - low + 1];</span><br><span class=\"line\">        while (i &lt;= mid &amp;&amp; j &lt;= height) {</span><br><span class=\"line\">            if (arr[i] &lt;= arr[j]) {//&#x5DE6;&#x8FB9;&#x52A0;&#x5165;</span><br><span class=\"line\">                temp[k++] = arr[i++];</span><br><span class=\"line\">            } else {//&#x53F3;&#x8FB9;&#x52A0;&#x5165;</span><br><span class=\"line\">                temp[k++] = arr[j++];</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        while (i &lt;= mid) {//&#x5DE6;&#x8FB9;&#x5269;&#x4F59;&#x5168;&#x90E8;&#x52A0;&#x5165;</span><br><span class=\"line\">            temp[k++] = arr[i++];</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        while (j &lt;= height) {//&#x53F3;&#x8FB9;&#x5269;&#x4F59;&#x5168;&#x90E8;&#x52A0;&#x5165;</span><br><span class=\"line\">            temp[k++] = arr[j++];</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        for (int m = 0; m &lt; temp.length; m++) {//&#x8F85;&#x52A9;&#x6570;&#x7EC4;&#x8FD8;&#x539F;&#x5230;&#x539F;&#x6570;&#x7EC4;</span><br><span class=\"line\">            arr[low + m] = temp[m];</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x5C31;&#x662F;&#x91C7;&#x7528;<code>&#x5206;&#x6CBB;</code>&#x8FDB;&#x884C;&#x5212;&#x5206;</p>\n<h2 id=\"&#x5206;&#x6CBB;\"><a href=\"#&#x5206;&#x6CBB;\" class=\"headerlink\" title=\"&#x5206;&#x6CBB;\"></a>&#x5206;&#x6CBB;</h2><p>&#x8FD9;&#x91CC;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x7591;&#x95EE;&#xFF0C;&#x5982;&#x4F55;&#x5C06;&#x5212;&#x5206;&#x7684;&#x5E8F;&#x5217;&#x751F;&#x6210;&#x6709;&#x5E8F;&#x5E8F;&#x5217;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x7684;&#x662F;<code>&#x5206;&#x6CBB;&#x7684;&#x601D;&#x60F3;</code>&#x4E0E;<code>&#x9012;&#x5F52;&#x601D;&#x60F3;</code>&#xFF0C;&#x53EA;&#x8981;&#x5E8F;&#x5217;&#x80FD;&#x8FDB;&#x884C;&#x5212;&#x5206;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x4E00;&#x76F4;&#x5212;&#x5206;&#x4E0B;&#x53BB;&#xFF0C;&#x76F4;&#x5230;&#x5212;&#x5206;&#x7684;&#x5E8F;&#x5217;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x8BE5;&#x5212;&#x5206;&#x7684;&#x5E8F;&#x5217;&#x81EA;&#x7136;&#x5C31;&#x6709;&#x5E8F;&#x4E86;&#xFF0C;&#x540C;&#x65F6;&#x518D;&#x8FDB;&#x884C;&#x5408;&#x5E76;&#xFF0C;&#x81EA;&#x7136;&#x5408;&#x5E76;&#x7684;&#x5E8F;&#x5217;&#x4E5F;&#x5C31;&#x4E00;&#x76F4;&#x6709;&#x5E8F;&#x4E86;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void mergeSort(int[] arr, int low, int height) {</span><br><span class=\"line\">        if (low &lt; height) {</span><br><span class=\"line\">            int mid = (low + height) / 2;</span><br><span class=\"line\">            mergeSort(arr, low, mid);//&#x5DE6;&#x5212;&#x5206;</span><br><span class=\"line\">            mergeSort(arr, mid + 1, height);//&#x53F3;&#x5212;&#x5206;</span><br><span class=\"line\">            merge(arr, low, mid, height);//&#x5DE6;&#x53F3;&#x5F52;&#x5E76;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<h1 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h1><p>&#x5F52;&#x5E76;&#x6392;&#x5E8F;&#x4E3A;&#x7A33;&#x5B9A;&#x6392;&#x5E8F;&#xFF0C;&#x6392;&#x5E8F;&#x540E;&#x76F8;&#x540C;&#x6570;&#x7684;&#x76F8;&#x5BF9;&#x4F4D;&#x7F6E;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x3002;&#x7531;&#x4E0A;&#x9762;&#x7684;&#x601D;&#x60F3;&#x53EF;&#x77E5;&#xFF0C;&#x5C06;&#x5E8F;&#x5217;&#x5212;&#x5206;&#x6210;&#x7EC4;&#x9700;&#x8981;<code>logn</code>&#x6B21;&#xFF0C;&#x5C06;&#x5212;&#x5206;&#x7684;&#x7EC4;&#x5408;&#x5E76;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;<code>O(n)</code>&#xFF0C;&#x6240;&#x4EE5;&#x6700;&#x7EC8;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;<code>O(nlogn)</code>&#x3002;&#x6240;&#x4EE5;&#x901A;&#x8FC7;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x5F52;&#x5E76;&#x6392;&#x5E8F;&#x7684;&#x6548;&#x7387;&#x8981;&#x6BD4;&#x5176;&#x4ED6;&#x7684;<a href=\"https://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E4%BA%8C-%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x5192;&#x6CE1;&#x6392;&#x5E8F;</a>&#x3001;<a href=\"https://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E4%B8%89-%E7%9B%B4%E6%8E%A5%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;</a>&#x3001;<a href=\"https://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E4%B8%80-%E7%9B%B4%E6%8E%A5%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x76F4;&#x63A5;&#x9009;&#x62E9;&#x6392;&#x5E8F;</a>&#x7B49;&#x8981;&#x9AD8;&#x3002;</p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["java"],"tags":["算法"]},{"title":"算法(三)直接插入排序","url":"https://www.rousetime.com/2016/06/18/算法-三-直接插入排序/","content":"<p>&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;&#x7684;&#x57FA;&#x672C;&#x601D;&#x60F3;&#x662F;:<code>&#x5C06;&#x9700;&#x8981;&#x6392;&#x5E8F;&#x7684;&#x5173;&#x952E;&#x6570;&#x4E0E;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x6392;&#x597D;&#x5E8F;&#x7684;&#x6570;&#x636E;&#x4ECE;&#x540E;&#x5F80;&#x524D;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x4F7F;&#x5176;&#x63D2;&#x5165;&#x5230;&#x5408;&#x9002;&#x7684;&#x4F4D;&#x7F6E;</code>&#x3002;</p>\n<h1 id=\"&#x57FA;&#x672C;&#x6B65;&#x9AA4;\"><a href=\"#&#x57FA;&#x672C;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x57FA;&#x672C;&#x6B65;&#x9AA4;\"></a>&#x57FA;&#x672C;&#x6B65;&#x9AA4;</h1><p>&#x6392;&#x5E8F;&#x6570;&#x7EC4;&#x4E3A;<code>a[0...n]</code></p>\n<ol>\n<li>&#x5C06;<code>a[0]</code>&#x4F5C;&#x4E3A;&#x8D77;&#x59CB;&#x6570;&#x636E;&#xFF0C;&#x4ECE;<code>a[1]</code>&#x5F00;&#x59CB;&#x4F5C;&#x4E3A;&#x5173;&#x952E;&#x5B57;&#x5411;&#x524D;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x82E5;&#x5C0F;&#x4E8E;&#x524D;&#x9762;&#x6240;&#x9047;&#x5230;&#x7684;&#x6BD4;&#x8F83;&#x6570;&#xFF0C;&#x5219;&#x4EA4;&#x6362;&#x4E24;&#x4E2A;&#x6BD4;&#x8F83;&#x6570;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5426;&#x5219;&#x76F4;&#x63A5;&#x8FDB;&#x884C;&#x4E0B;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x5B57;&#x7684;&#x6BD4;&#x8F83;&#x3002;</li>\n<li>&#x91CD;&#x590D;&#x524D;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230;&#x5C06;<code>a[n]</code>&#x4F5C;&#x4E3A;&#x5173;&#x952E;&#x5B57;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x3002;&#x6BD4;&#x8F83;&#x5B8C;&#x4EE5;&#x540E;&#x5219;&#x6392;&#x5E8F;&#x7ED3;&#x675F;&#x3002;</li>\n</ol>\n<blockquote>\n<p><em>&#x8BE5;&#x7B97;&#x6CD5;&#x5B9E;&#x73B0;&#x8FD8;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x6B65;&#x9AA4;&#x8FC5;&#x901F;&#x5199;&#x51FA;</em></p>\n</blockquote>\n<h1 id=\"&#x5B9E;&#x73B0;\"><a href=\"#&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;\"></a>&#x5B9E;&#x73B0;</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void insertSort(int[] arr) {</span><br><span class=\"line\">        int temp;</span><br><span class=\"line\">        for (int i = 1; i &lt; arr.length; i++) {</span><br><span class=\"line\">            for (int j = i; j &gt; 0; j--) {</span><br><span class=\"line\">                if (arr[j] &lt; arr[j - 1]) {//&#x4EA4;&#x6362;</span><br><span class=\"line\">                    temp = arr[j];</span><br><span class=\"line\">                    arr[j] = arr[j - 1];</span><br><span class=\"line\">                    arr[j - 1] = temp;</span><br><span class=\"line\">                } else {//&#x53EA;&#x8981;&#x6BD4;&#x8F83;&#x4E0D;&#x5C0F;&#x4E8E;&#x7684;&#x8BDD;&#x5C31;&#x76F4;&#x63A5;&#x8DF3;&#x51FA;</span><br><span class=\"line\">                    break;</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<h1 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h1><p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x601D;&#x60F3;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x8BE5;&#x6392;&#x5E8F;&#x4E3A;&#x7A33;&#x5B9A;&#x6392;&#x5E8F;&#xFF0C;&#x4E14;&#x6700;&#x597D;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x3001;&#x6700;&#x574F;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x90FD;&#x4E0E;&#x524D;&#x9762;&#x7684;<a href=\"https://idisfkj.github.io/2016/06/18/%E7%AE%97%E6%B3%95-%E4%BA%8C-%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/\" target=\"_blank\" rel=\"noopener\">&#x5192;&#x6CE1;&#x6392;&#x5E8F;</a>&#x4E00;&#x6837;&#x662F;<code>O(n)</code>&#x4E0E;<code>O(n^2)</code>&#x3002;</p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["java"],"tags":["算法"]},{"title":"算法(二)冒泡排序","url":"https://www.rousetime.com/2016/06/18/算法-二-冒泡排序/","content":"<p>&#x5192;&#x6CE1;&#x6392;&#x5E8F;&#x4E3B;&#x8981;&#x662F;&#x76F8;&#x90BB;&#x7684;&#x4E24;&#x4E2A;&#x6570;&#x4E24;&#x4E24;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x62FF;&#x4ECE;&#x5C0F;&#x5230;&#x5927;&#x8BF4;&#x660E;&#xFF0C;&#x8FDB;&#x884C;&#x5192;&#x6CE1;&#x6392;&#x5E8F;&#x540E;&#x4F1A;&#x5C06;&#x5927;&#x7684;&#x6570;<code>&#x6C89;</code>&#x5230;&#x5E95;&#x90E8;&#xFF0C;&#x5C06;&#x5C0F;&#x5F97;&#x6570;<code>&#x6D6E;</code>&#x5230;&#x9876;&#x90E8;&#x3002;&#x6240;&#x4EE5;&#x5192;&#x6CE1;&#x8BF4;&#x6CD5;&#x7531;&#x6B64;&#x5F97;&#x540D;&#x3002;</p>\n<h1 id=\"&#x5B9E;&#x73B0;&#x6B65;&#x9AA4;\"><a href=\"#&#x5B9E;&#x73B0;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;&#x6B65;&#x9AA4;\"></a>&#x5B9E;&#x73B0;&#x6B65;&#x9AA4;</h1><p>&#x4EE5;&#x4ECE;&#x5C0F;&#x5230;&#x5927;&#x4E3A;&#x4F8B;&#xFF0C;&#x6392;&#x5E8F;&#x6570;&#x7EC4;&#x5927;&#x5C0F;&#x4E3A;<code>n</code>&#x3002;</p>\n<ol>\n<li>&#x7B2C;<code>N = 0</code>&#x8D9F;&#x6392;&#x5E8F;&#x5F00;&#x59CB;&#x90FD;&#x4ECE;<code>a[0]</code>&#x5F00;&#x59CB;&#x4E0E;&#x5176;&#x4E0B;&#x9762;&#x7684;&#x76F8;&#x90BB;&#x7684;&#x6570;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x5982;&#x679C;&#x5927;&#x4E8E;&#x76F8;&#x90BB;&#x7684;&#x6570;&#x5219;&#x4EA4;&#x6362;&#x4ED6;&#x4EEC;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</li>\n<li>&#x7EE7;&#x7EED;&#x4E0E;&#x4E0B;&#x4E00;&#x4E2A;&#x76F8;&#x90BB;&#x7684;&#x6570;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x5927;&#x4E8E;&#x76F8;&#x90BB;&#x7684;&#x5C31;&#x4EA4;&#x6362;&#xFF0C;&#x6700;&#x540E;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;<code>n-1</code>&#x6B21;&#x540E;&#xFF0C;&#x7B2C;<code>N = 0</code>&#x8D9F;&#x6392;&#x5E8F;&#x7ED3;&#x675F;&#xFF0C;&#x6700;&#x5927;&#x7684;&#x6570;&#x5C31;&#x5728;&#x6570;&#x7EC4;&#x7684;<code>a[n-1]</code>&#x5904;&#x3002;</li>\n<li>&#x91CD;&#x590D;&#x524D;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230; <code>N = n-1</code>,&#x6392;&#x5E8F;&#x7ED3;&#x675F;&#x3002;</li>\n</ol>\n<blockquote>\n<p><em>&#x6839;&#x636E;&#x601D;&#x60F3;&#x5B9E;&#x73B0;&#x5C31;&#x4E0D;&#x96BE;&#x4E86;</em></p>\n</blockquote>\n<h1 id=\"&#x5B9E;&#x73B0;\"><a href=\"#&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;\"></a>&#x5B9E;&#x73B0;</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void bubbleSort(int[] arr) {</span><br><span class=\"line\">        int temp;</span><br><span class=\"line\">        for (int n = 0; n &lt; arr.length - 1; n++)//&#x9700;&#x8981;n-1&#x6B21;</span><br><span class=\"line\">            for (int j = 0; j &lt; arr.length - n - 1; j++) {</span><br><span class=\"line\">                if (arr[j] &gt; arr[j + 1]) {//&#x4EA4;&#x6362;</span><br><span class=\"line\">                    temp = arr[j];</span><br><span class=\"line\">                    arr[j] = arr[j + 1];</span><br><span class=\"line\">                    arr[j + 1] = temp;</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x5B9E;&#x73B0;&#x5B8C;&#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x662F;&#x5426;&#x5FC3;&#x4E2D;&#x6709;&#x70B9;&#x7591;&#x95EE;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x8981;&#x9010;&#x4E2A;&#x6BD4;&#x8F83;&#xFF0C;&#x5982;&#x679C;&#x6570;&#x7EC4;&#x540E;&#x9762;&#x7684;&#x4E00;&#x4E9B;&#x6570;&#x662F;&#x6709;&#x5E8F;&#x7684;&#x5462;&#xFF0C;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x6392;&#x5E8F;&#x7684;&#x6B21;&#x6570;&#x5462;&#xFF1F;&#x7ED3;&#x679C;&#x662F;&#x80AF;&#x5B9A;&#x7684;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x6570;&#x7EC4;&#x540E;&#x9762;&#x7684;<code>30</code>&#x4E2A;&#x6570;&#x662F;&#x5DF2;&#x7ECF;&#x6392;&#x597D;&#x5E8F;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5728;&#x6392;&#x5E8F;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5FFD;&#x7565;&#x540E;&#x9762;&#x7684;&#x6570;&#xFF0C;&#x53EA;&#x8003;&#x8651;&#x4ED6;&#x4EEC;&#x524D;&#x9762;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5728;&#x6392;&#x5E8F;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x8BBE;&#x8BA1;&#x4E2A;&#x6807;&#x8BC6;<code>flag</code>,&#x5F53;&#x4ECE;&#x7B2C;<code>j</code>&#x5F00;&#x59CB;&#x90FD;&#x6CA1;&#x6709;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x7684;&#x4EA4;&#x6362;&#xFF0C;&#x5373;&#x6709;&#x5E8F;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x628A;&#x539F;&#x6765;&#x7684;&#x6570;&#x636E;&#x5207;&#x6BB5;&#x53EA;&#x5BF9;<code>j</code>&#x524D;&#x9762;&#x7684;&#x6570;&#x7EE7;&#x7EED;&#x6BD4;&#x8F83;&#xFF0C;&#x76F8;&#x5BF9;&#x4E8E;&#x5F62;&#x6210;&#x65B0;&#x7684;&#x6392;&#x5E8F;&#x6570;&#x7EC4;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x5BF9;&#x539F;&#x6765;&#x7684;&#x6392;&#x5E8F;&#x8FDB;&#x884C;&#x4E86;&#x4E00;&#x4E9B;&#x4F18;&#x5316;&#x3002;</p>\n<h1 id=\"&#x4F18;&#x5316;\"><a href=\"#&#x4F18;&#x5316;\" class=\"headerlink\" title=\"&#x4F18;&#x5316;\"></a>&#x4F18;&#x5316;</h1><p>&#x6839;&#x636E;&#x4E0A;&#x9762;&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void bubbleSort2(int[] arr) {</span><br><span class=\"line\">        int temp;</span><br><span class=\"line\">        int flag = arr.length - 1;</span><br><span class=\"line\">        while (flag &gt; 0) {</span><br><span class=\"line\">            int n = flag;</span><br><span class=\"line\">            flag = 0;</span><br><span class=\"line\">            for (int j = 0; j &lt; n; j++) {</span><br><span class=\"line\">                if (arr[j] &gt; arr[j + 1]) {</span><br><span class=\"line\">                    temp = arr[j];</span><br><span class=\"line\">                    arr[j] = arr[j + 1];</span><br><span class=\"line\">                    arr[j + 1] = temp;</span><br><span class=\"line\">                    flag = j;</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<h1 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h1><p>&#x6839;&#x636E;&#x524D;&#x9762;&#x7684;&#x601D;&#x60F3;&#x6211;&#x4EEC;&#x4F1A;&#x77E5;&#x9053;&#x8BE5;&#x6392;&#x5E8F;&#x4E3A;&#x7A33;&#x5B9A;&#x6392;&#x5E8F;&#xFF0C;&#x6700;&#x597D;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;<code>O(n)</code>&#x5373;&#x6392;&#x5E8F;&#x6570;&#x7EC4;&#x5F00;&#x59CB;&#x5C31;&#x662F;&#x6709;&#x5E8F;&#x7684;&#x4E14;&#x4E0E;&#x8981;&#x6392;&#x5E8F;&#x7684;&#x987A;&#x5E8F;&#x76F8;&#x540C;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x8981;&#x8FDB;&#x884C;&#x4E00;&#x8D9F;&#x6BD4;&#x8F83;&#x6392;&#x5E8F;&#xFF0C;&#x904D;&#x5386;&#x4E00;&#x6B21;&#x6570;&#x7EC4;&#x3002;&#x6700;&#x574F;&#x7684;&#x60C5;&#x51B5;&#x81EA;&#x7136;&#x662F;&#x6570;&#x7EC4;&#x5F00;&#x59CB;&#x65F6;&#x4E0E;&#x8981;&#x6392;&#x5E8F;&#x7684;&#x987A;&#x5E8F;&#x76F8;&#x53CD;&#xFF0C;&#x6240;&#x4EE5;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;<code>O(n^2)</code></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["java"],"tags":["算法"]},{"title":"算法(一)直接选择排序","url":"https://www.rousetime.com/2016/06/18/算法-一-直接选择排序/","content":"<p>&#x76F4;&#x63A5;&#x9009;&#x62E9;&#x6392;&#x5E8F;&#xFF0C;&#x6574;&#x4F53;&#x601D;&#x60F3;&#x662F;&#x5C06;&#x6570;&#x636E;&#x5206;&#x6210;&#x4E24;&#x4E2A;&#x533A;&#x57DF;&#xFF0C;<code>&#x6709;&#x5E8F;&#x533A;</code>&#x4E0E;<code>&#x65E0;&#x5E8F;&#x533A;</code>&#x3002;&#x6392;&#x5E8F;&#x7684;&#x65F6;&#x5019;&#x662F;&#x6BCF;&#x6B21;&#x4ECE;<code>&#x65E0;&#x5E8F;&#x533A;</code>&#x4E2D;&#x9009;&#x62E9;&#x51FA;&#x6700;&#x5C0F;&#x7684;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x63D2;&#x5165;&#x5230;<code>&#x6709;&#x5E8F;&#x533A;</code>&#x4E2D;&#x7684;&#x6700;&#x672B;&#x5C3E;&#xFF0C;&#x4ECE;&#x800C;&#x5F62;&#x6210;&#x66F4;&#x5927;&#x7684;<code>&#x6709;&#x5E8F;&#x533A;</code>&#x3002;&#x76F4;&#x5230;<code>&#x65E0;&#x5E8F;&#x533A;</code>&#x4E2D;&#x7684;&#x6570;&#x4E3A;&#x96F6;&#xFF0C;&#x7ED3;&#x675F;&#x6392;&#x5E8F;&#x3002;</p>\n<h1 id=\"&#x8BE6;&#x7EC6;&#x6B65;&#x9AA4;\"><a href=\"#&#x8BE6;&#x7EC6;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x8BE6;&#x7EC6;&#x6B65;&#x9AA4;\"></a>&#x8BE6;&#x7EC6;&#x6B65;&#x9AA4;</h1><p>&#x5047;&#x8BBE;&#x6392;&#x5E8F;&#x6570;&#x7EC4;&#x4E3A;a[0&#x2026;n-1];</p>\n<ol>\n<li>&#x9996;&#x5148;<code>&#x6709;&#x5E8F;&#x533A;</code>&#x4E2D;&#x7684;&#x4E2A;&#x6570;&#x4E3A;0&#xFF0C;&#x4EE4;<code>i = 0</code>&#x3002;&#x4ECE;<code>&#x65E0;&#x5E8F;&#x533A;</code>&#x4E2D;&#x9009;&#x62E9;&#x6700;&#x5C0F;&#x7684;&#x6570;&#xFF0C;&#x52A0;&#x5165;&#x5230;<code>&#x6709;&#x5E8F;&#x533A;a[i]</code>&#x4E2D;&#x3002;&#x4F7F;&#x5F97;<code>&#x6709;&#x5E8F;&#x533A;</code>&#x4E3A;<code>a[0..i]</code>,<code>&#x65E0;&#x5E8F;&#x533A;</code>&#x4E3A;<code>a[i...n-1]</code></li>\n<li>&#x5B8C;&#x6210;&#x540E; <code>i++</code> ,&#x7136;&#x540E;&#x7EE7;&#x7EED;&#x524D;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230; <code>i = n-1</code> &#x4E3A;&#x6B62;&#x3002;&#x4F7F;&#x5F97;&#x5168;&#x90E8;&#x6570;&#x90FD;&#x5728;<code>&#x6709;&#x5E8F;&#x533A;</code>&#x4E2D;&#x3002;</li>\n</ol>\n<blockquote>\n<p><em>&#x6240;&#x4EE5;&#x6839;&#x636E;&#x4E0A;&#x9762;&#x7684;&#x601D;&#x60F3;&#x6B65;&#x9AA4;&#x5C31;&#x80FD;&#x5F88;&#x5BB9;&#x6613;&#x7684;&#x5199;&#x51FA;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x4E86;</em></p>\n</blockquote>\n<h1 id=\"&#x5B9E;&#x73B0;\"><a href=\"#&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;\"></a>&#x5B9E;&#x73B0;</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void selectSort(int[] arr) {</span><br><span class=\"line\">        int temp;</span><br><span class=\"line\">        int mid;</span><br><span class=\"line\">        for (int i = 0; i &lt; arr.length - 1; i++) {</span><br><span class=\"line\">            mid = i;//&#x5173;&#x952E;&#x6570;</span><br><span class=\"line\">            for (int j = mid + 1; j &lt; arr.length; j++) {</span><br><span class=\"line\">                if (arr[mid] &gt; arr[j])//&#x627E;&#x5230;&#x6700;&#x5C0F;&#x503C;</span><br><span class=\"line\">                    mid = j;</span><br><span class=\"line\">            }</span><br><span class=\"line\">            if (mid != i) {//&#x4E0D;&#x7B49;&#x4E8E;&#x5173;&#x952E;&#x6570;&#x5219;&#x4EA4;&#x6362;</span><br><span class=\"line\">                temp = arr[mid];</span><br><span class=\"line\">                arr[mid] = arr[i];</span><br><span class=\"line\">                arr[i] = temp;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<h1 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h1><p>&#x8BE5;&#x6392;&#x5E8F;&#x4E3A;&#x4E0D;&#x7A33;&#x5B9A;&#x6392;&#x5E8F;&#xFF0C;&#x9996;&#x5148;&#x8BF4;&#x660E;&#x4F55;&#x4E3A;&#x7A33;&#x5B9A;&#x6392;&#x5E8F;&#xFF1A;<code>&#x5728;&#x6392;&#x5E8F;&#x7ED3;&#x675F;&#x540E;&#x5982;&#x679C;&#x6392;&#x5E8F;&#x4E2D;&#x76F8;&#x540C;&#x5927;&#x5C0F;&#x7684;&#x6570;&#x4E0E;&#x6392;&#x5E8F;&#x524D;&#x7684;&#x76F8;&#x5BF9;&#x4F4D;&#x7F6E;&#x76F8;&#x540C;(&#x5373;&#x524D;&#x540E;&#x4F4D;&#x7F6E;&#x4E0D;&#x53D8;)&#xFF0C;&#x5219;&#x79F0;&#x4E3A;&#x7A33;&#x5B9A;&#x6392;&#x5E8F;</code> &#x76F4;&#x63A5;&#x9009;&#x62E9;&#x6392;&#x5E8F;&#x6211;&#x4EEC;&#x5F88;&#x5BB9;&#x6613;&#x53D1;&#x73B0;&#xFF0C;&#x5982;&#x679C;&#x6392;&#x5E8F;&#x6570;&#x7EC4;&#x4E3A;<code>a[11,11,2]</code>&#x5728;&#x8FDB;&#x884C;&#x7B2C;&#x4E00;&#x8D9F;&#x6392;&#x5E8F;&#x4E4B;&#x540E;&#x7B2C;&#x4E00;&#x4E2A;<code>11</code>&#x4E0E;<code>2</code>&#x4EA4;&#x6362;&#x4F4D;&#x7F6E;&#x4F7F;&#x5F97;&#x539F;&#x6765;&#x524D;&#x9762;&#x7684;<code>11</code>&#x6392;&#x5E8F;&#x5230;&#x540E;&#x9762;&#x7684;<code>11</code>&#x4E4B;&#x540E;&#xFF0C;&#x6240;&#x4EE5;&#x76F4;&#x63A5;&#x9009;&#x62E9;&#x6392;&#x5E8F;&#x4E3A;&#x4E0D;&#x7A33;&#x5B9A;&#x6392;&#x5E8F;&#x3002;&#x540C;&#x65F6;&#x5B83;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;<code>O(n^2)</code></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["java"],"tags":["算法"]},{"title":"如何使Android Studio项目发布到Jcenter中","url":"https://www.rousetime.com/2016/06/13/如何使Android-Studio项目发布到Jcenter中/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p>&#x5199;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5176;&#x5B9E;&#x6211;&#x662F;&#x75DB;&#x82E6;&#x7684;&#xFF0C;&#x54CE;&#xFF01;&#x8BF4;&#x51FA;&#x6765;&#x90FD;&#x662F;&#x6CEA;&#x554A;&#x3002;&#x3002;&#x3002;&#x4ECA;&#x5929;&#x5728;<code>JFrog Bintray</code>&#x4E2D;&#x4E0D;&#x5C0F;&#x5FC3;&#x628A;&#x6211;<code>Repositories</code>&#x4E2D;&#x539F;&#x6765;&#x7684;<code>maven</code>&#x4E2D;&#x7684;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#x7ED9;&#x5220;&#x9664;&#x4E86;&#x3002;&#x5BFC;&#x81F4;&#x539F;&#x6765;&#x7684;&#x4F9D;&#x8D56;&#x5168;&#x90E8;&#x6CA1;&#x4E86;&#xFF0C;&#x627E;&#x4E86;&#x534A;&#x5929;&#x4E5F;&#x6CA1;&#x627E;&#x5230;&#x8981;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x6062;&#x590D;&#x3002;&#x73B0;&#x5728;&#x60F3;&#x5230;&#x7684;&#x4E5F;&#x53EA;&#x80FD;&#x91CD;&#x65B0;&#x53D1;&#x5E03;&#x4E00;&#x4E0B;&#x3002;&#x53EF;&#x80FD;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x4EBA;&#x4E0D;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x50CF;&#x6211;&#x4EEC;&#x65E5;&#x5E38;&#x6DFB;&#x52A0;&#x522B;&#x4EBA;&#x7684;&#x4F9D;&#x8D56;&#x4E00;&#x6837;&#x8FD9;&#x6837;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x5F0F;&#x3002;&#x6240;&#x4EE5;&#x987A;&#x4FBF;&#x5728;&#x8FD9;&#x91CC;&#x7B80;&#x5355;&#x7684;&#x4ECB;&#x7ECD;&#x4E0B;&#x6211;&#x4EEC;&#x5199;&#x7684;&#x9879;&#x76EE;&#x5982;&#x679C;&#x8981;&#x522B;&#x4EBA;&#x4E5F;&#x80FD;&#x968F;&#x65F6;&#x4F7F;&#x7528;&#xFF0C;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x3002;</p>\n<h2 id=\"Android&#x4ED3;&#x5E93;\"><a href=\"#Android&#x4ED3;&#x5E93;\" class=\"headerlink\" title=\"Android&#x4ED3;&#x5E93;\"></a>Android&#x4ED3;&#x5E93;</h2><p>&#x7B80;&#x5355;&#x7684;&#x666E;&#x53CA;&#x4E0B;&#x5173;&#x4E8E;<code>android</code>&#x7684;&#x4F9D;&#x8D56;&#x4ED3;&#x5E93;&#xFF0C;&#x6709;&#x4E24;&#x79CD;&#x5206;&#x522B;&#x662F;<code>Jcenter</code>&#x4E0E;<code>Maven Central</code>&#x5176;&#x5B9E;&#x4E0D;&#x7BA1;&#x662F;<code>Jcenter</code>&#x8FD8;&#x662F;<code>Maven Central</code>&#x90FD;&#x662F;<code>Maven</code>&#x5E93;&#x3002;</p>\n<h3 id=\"Jcenter\"><a href=\"#Jcenter\" class=\"headerlink\" title=\"Jcenter\"></a>Jcenter</h3><p><code>Jcenter</code>&#x662F;&#x7531;<code>bintray.com</code>&#x7EF4;&#x62A4;&#xFF0C;&#x5728;<code>Android Studio</code>&#x7684;&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#x7684;<code>build.gradle</code>&#x4E2D;&#x6211;&#x4EEC;&#x4F1A;&#x770B;&#x5230;&#x81EA;&#x52A8;&#x5E2E;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x7684;<code>Jcenter</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buildscript {</span><br><span class=\"line\">    repositories {</span><br><span class=\"line\">        jcenter()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"Maven-Central\"><a href=\"#Maven-Central\" class=\"headerlink\" title=\"Maven Central\"></a>Maven Central</h3><p>&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;<code>build.gradle</code>&#x4E2D;&#x5B9A;&#x4E49;<code>Maven Central</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buildscript {</span><br><span class=\"line\">    repositories {</span><br><span class=\"line\">        mavenCentral()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x81F3;&#x4E8E;&#x5728;<code>Android Studio</code>&#x4E2D;&#x4E3A;&#x4EC0;&#x4E48;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;<code>Jcenter</code>&#x539F;&#x56E0;&#x8FD8;&#x662F;&#x6709;&#x7684;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x53BB;&#x67E5;&#xFF0C;&#x6211;&#x8981;&#x8BF4;&#x7684;&#x4E00;&#x70B9;&#x5C31;&#x662F;&#xFF0C;&#x8FD9;&#x91CC;&#x4F60;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;<code>Jcenter</code>&#x662F;<code>Maven Central</code>&#x7684;&#x8D85;&#x96C6;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x80FD;&#x66F4;&#x597D;&#x7684;&#x7406;&#x89E3;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x4F7F;&#x7528;<code>Jcenter</code>&#x4E86;&#x3002;</p>\n<h2 id=\"gradle&#x83B7;&#x53D6;library\"><a href=\"#gradle&#x83B7;&#x53D6;library\" class=\"headerlink\" title=\"gradle&#x83B7;&#x53D6;library\"></a>gradle&#x83B7;&#x53D6;library</h2><p>&#x8FD9;&#x91CC;&#x8981;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x7684;&#x4F9D;&#x8D56;&#x6240;&#x5B9A;&#x4E49;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5176;&#x5B9E;&#x662F;&#x6709;&#x683C;&#x5F0F;&#x7684;&#x5E76;&#x4E0D;&#x662F;&#x968F;&#x4FBF;&#x4E71;&#x5199;&#x7684;&#x3002;&#x5176;&#x5B9E;&#x4F60;&#x53EA;&#x8981;&#x5E73;&#x5E38;&#x591F;&#x4ED4;&#x7EC6;&#x5C31;&#x80FD;&#x53D1;&#x73B0;&#x4ED6;&#x4EEC;&#x7684;&#x683C;&#x5F0F;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;<br>&#x7531;<code>GroupId</code>&#x3001;<code>ArtifactId</code>&#x4E0E;<code>VersionId</code>&#x7EC4;&#x6210;&#x3002;&#x4F8B;&#x5982;<code>com.jakewharton:butterknife:6.1.0&apos;</code>&#x5B83;&#x7684;<code>GroupId</code>&#x662F;<code>com.jakewharton</code>&#xFF0C;<code>ArtifactId</code>&#x662F;<code>butterknife</code>&#xFF0C;<code>VersionId</code>&#x662F;<code>6.1.0</code>&#x3002;&#x73B0;&#x5728;&#x770B;&#x8FD9;&#x4E9B;&#x4F9D;&#x8D56;&#x662F;&#x4E0D;&#x662F;&#x66F4;&#x6E05;&#x6670;&#x4E86;&#x5462;&#x3002;&#x5F53;&#x6211;&#x4EEC;&#x6DFB;&#x52A0;&#x4E86;&#x4F9D;&#x8D56;&#x4E4B;&#x540E;<code>gradle</code>&#x4F1A;&#x5148;&#x53BB;<code>Maven</code>&#x4E2D;&#x67E5;&#x627E;&#x662F;&#x5426;&#x6709;&#x8BE5;<code>library</code>&#x5982;&#x679C;&#x6709;&#x5C31;&#x4F1A;&#x4F7F;&#x7528;&#x4E0A;&#x9762;&#x5B9A;&#x4E49;&#x7684;&#x5F62;&#x5F0F;&#x4E0B;&#x8F7D;<code>http://jcenter.bintray.com/GroupId/ArtifactId/VersionId</code></p>\n<p><code>http://jcenter.bintray.com/com/jakewharton/butterknife/6.1.0</code><br>&#x901A;&#x8FC7;&#x8BE5;&#x94FE;&#x63A5;&#x4E0B;&#x8F7D;&#x5230;&#x672C;&#x5730;&#x518D;&#x4E0E;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x7ED3;&#x5408;&#x3002;</p>\n<blockquote>\n<p><em>&#x4E0B;&#x9762;&#x6B63;&#x5F0F;&#x8FDB;&#x884C;&#x5B9E;&#x73B0;&#x4F9D;&#x8D56;&#x7684;&#x5B9E;&#x73B0;</em></p>\n</blockquote>\n<h2 id=\"&#x6CE8;&#x518C;\"><a href=\"#&#x6CE8;&#x518C;\" class=\"headerlink\" title=\"&#x6CE8;&#x518C;\"></a>&#x6CE8;&#x518C;</h2><p>&#x9996;&#x5148;&#x8981;&#x5728;<a href=\"https://bintray.com\" target=\"_blank\" rel=\"noopener\">https://bintray.com</a> &#x4E2D;&#x6CE8;&#x518C;&#x8D26;&#x53F7;&#xFF0C;&#x6CE8;&#x518C;&#x90FD;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x5C31;&#x4E0D;&#x6240;&#x8BF4;&#x4E86;&#x3002;<br>&#x7136;&#x540E;&#x56DE;&#x5230;&#x4E3B;&#x9875;&#x5728;&#x4F60;&#x7684;<code>Owned Repositories</code>&#x4E2D;&#x770B;&#x4E0B;&#x4F60;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x6DFB;&#x52A0;&#x4E86;<code>maven</code>&#x3002;<br><img src=\"/2016/06/13/&#x5982;&#x4F55;&#x4F7F;Android-Studio&#x9879;&#x76EE;&#x53D1;&#x5E03;&#x5230;Jcenter&#x4E2D;/1.png\" alt=\"&#x56FE;\"><br>&#x7B2C;&#x4E00;&#x6B21;&#x6CE8;&#x518C;&#x7684;&#x5E94;&#x8BE5;&#x6CA1;&#x6709;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8981;&#x5148;<code>New Repository</code>&#x521B;&#x5EFA;<code>maven</code><br><img src=\"/2016/06/13/&#x5982;&#x4F55;&#x4F7F;Android-Studio&#x9879;&#x76EE;&#x53D1;&#x5E03;&#x5230;Jcenter&#x4E2D;/2.png\" alt=\"&#x56FE;\"><br>&#x521B;&#x5EFA;&#x4E4B;&#x540E;&#x4F1A;&#x81EA;&#x52A8;&#x8DF3;&#x8F6C;&#x5230;<code>maven</code>&#x4E2D;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x6CA1;&#x6709;<code>package</code>,&#x6211;&#x4EEC;&#x53EF;&#x4EE5;<code>Add New Package</code>&#x8FD9;&#x79CD;&#x76F8;&#x4FE1;&#x90FD;&#x4F1A;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x8981;&#x8BF4;&#x7684;&#x662F;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x5728;<code>Android Studio</code>&#x4E2D;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x7136;&#x540E;&#x4E0A;&#x4F20;&#x5230;<code>Bintray</code>&#x3002;</p>\n<h2 id=\"&#x4EE3;&#x7801;&#x4E2D;&#x914D;&#x7F6E;\"><a href=\"#&#x4EE3;&#x7801;&#x4E2D;&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"&#x4EE3;&#x7801;&#x4E2D;&#x914D;&#x7F6E;\"></a>&#x4EE3;&#x7801;&#x4E2D;&#x914D;&#x7F6E;</h2><h3 id=\"&#x5206;&#x79BB;&#x6210;&#x591A;&#x4E2A;Module\"><a href=\"#&#x5206;&#x79BB;&#x6210;&#x591A;&#x4E2A;Module\" class=\"headerlink\" title=\"&#x5206;&#x79BB;&#x6210;&#x591A;&#x4E2A;Module\"></a>&#x5206;&#x79BB;&#x6210;&#x591A;&#x4E2A;Module</h3><p>&#x4E3A;&#x4E86;&#x4F7F;&#x522B;&#x4EBA;&#x80FD;&#x66F4;&#x597D;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x5728;&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;&#x4F9D;&#x8D56;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x628A;&#x5B9E;&#x73B0;&#x7684;&#x8BE5;&#x4F9D;&#x8D56;&#x7684;&#x6E90;&#x7801;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;<code>Module</code>,&#x518D;&#x628A;&#x5B9E;&#x4F8B;&#x4EE3;&#x7801;&#x4F5C;&#x4E3A;<code>Application Module</code>&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8981;&#x4E8B;&#x5148;&#x5904;&#x7406;&#x597D;<code>Module</code>&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x6211;&#x5F04;&#x597D;&#x7684;&#x793A;&#x4F8B;</p>\n<p><img src=\"/2016/06/13/&#x5982;&#x4F55;&#x4F7F;Android-Studio&#x9879;&#x76EE;&#x53D1;&#x5E03;&#x5230;Jcenter&#x4E2D;/3.png\" alt=\"&#x56FE;\"></p>\n<h3 id=\"&#x6DFB;&#x52A0;bintray&#x63D2;&#x4EF6;\"><a href=\"#&#x6DFB;&#x52A0;bintray&#x63D2;&#x4EF6;\" class=\"headerlink\" title=\"&#x6DFB;&#x52A0;bintray&#x63D2;&#x4EF6;\"></a>&#x6DFB;&#x52A0;bintray&#x63D2;&#x4EF6;</h3><p>&#x5728;&#x5206;&#x4E86;<code>Module</code>&#x4E4B;&#x540E;&#xFF0C;&#x9996;&#x5148;&#x5728;&#x9879;&#x76EE;&#x7684;<code>&#x6839;&#x76EE;&#x5F55;</code>&#x7684;<code>build.gradle</code>&#x7684;<br><code>dependencies</code>&#x4E2D;&#x6DFB;&#x52A0;<code>bintray</code>&#x63D2;&#x4EF6;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">classpath &apos;com.jfrog.bintray.gradle:gradle-bintray-plugin:1.2&apos;</span><br><span class=\"line\">classpath &apos;com.github.dcendents:android-maven-gradle-plugin:1.3</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x6DFB;&#x52A0;bintray&#x8BA4;&#x8BC1;\"><a href=\"#&#x6DFB;&#x52A0;bintray&#x8BA4;&#x8BC1;\" class=\"headerlink\" title=\"&#x6DFB;&#x52A0;bintray&#x8BA4;&#x8BC1;\"></a>&#x6DFB;&#x52A0;bintray&#x8BA4;&#x8BC1;</h3><p>&#x627E;&#x5230;<code>local.properties</code>&#x6587;&#x4EF6;&#x5728;&#x5176;&#x4E2D;&#x6DFB;&#x52A0;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bintray.user=xxxx</span><br><span class=\"line\">bintray.apikey=xxx</span><br></pre></td></tr></table></figure>\n<p><code>bintray.user</code>&#x662F;&#x6CE8;&#x518C;&#x7684;user&#xFF0C;&#x81F3;&#x4E8E;<code>bintray.apikey</code>&#x5728;<code>JFrog Bintray</code>&#x4E2D;&#x7684;<code>Your Profile</code>&#x7684;<code>Edit</code>&#x9875;&#x9762;&#x7684;<code>API Key</code>&#x4E2D;&#x80FD;&#x627E;&#x5230;&#x3002;</p>\n<p><img src=\"/2016/06/13/&#x5982;&#x4F55;&#x4F7F;Android-Studio&#x9879;&#x76EE;&#x53D1;&#x5E03;&#x5230;Jcenter&#x4E2D;/4.png\" alt=\"&#x56FE;\"></p>\n<p><img src=\"/2016/06/13/&#x5982;&#x4F55;&#x4F7F;Android-Studio&#x9879;&#x76EE;&#x53D1;&#x5E03;&#x5230;Jcenter&#x4E2D;/6.png\" alt=\"&#x56FE;\"></p>\n<h3 id=\"&#x4FEE;&#x6539;Module&#x4E2D;&#x7684;build-gradle\"><a href=\"#&#x4FEE;&#x6539;Module&#x4E2D;&#x7684;build-gradle\" class=\"headerlink\" title=\"&#x4FEE;&#x6539;Module&#x4E2D;&#x7684;build.gradle\"></a>&#x4FEE;&#x6539;Module&#x4E2D;&#x7684;build.gradle</h3><p>&#x5728;&#x5176;&#x4E2D;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply plugin: &apos;com.android.library&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">ext {</span><br><span class=\"line\">    bintrayRepo = &apos;maven&apos;</span><br><span class=\"line\">    bintrayName = &apos;mypicker&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">    publishedGroupId = &apos;com.idisfkj.picker&apos;</span><br><span class=\"line\">    libraryName = &apos;MyPicker&apos;</span><br><span class=\"line\">    artifact = &apos;mypicker&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">    libraryDescription = &apos;A pickerView on Android&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">    siteUrl = &apos;https://github.com/idisfkj/idisfkj.picker&apos;</span><br><span class=\"line\">    gitUrl = &apos;https://github.com/idisfkj/idisfkj.picker.git&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">    libraryVersion = &apos;1.2.1&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">    developerId = &apos;idisfkj&apos;</span><br><span class=\"line\">    developerName = &apos;idisfkj&apos;</span><br><span class=\"line\">    developerEmail = &apos;idisfkj@qq.com&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">    licenseName = &apos;The Apache Software License, Version 2.0&apos;</span><br><span class=\"line\">    licenseUrl = &apos;http://www.apache.org/licenses/LICENSE-2.0.txt&apos;</span><br><span class=\"line\">    allLicenses = [&quot;Apache-2.0&quot;]</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x540C;&#x65F6;&#x5728;&#x6700;&#x540E;&#x6DFB;&#x52A0;&#x4E24;&#x4E2A;&#x811A;&#x672C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply from: &apos;https://raw.githubusercontent.com/nuuneoi/JCenter/master/installv1.gradle&apos;</span><br><span class=\"line\">apply from: &apos;https://raw.githubusercontent.com/nuuneoi/JCenter/master/bintrayv1.gradle&apos;</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x662F;&#x6211;&#x8FD9;&#x4E2A;&#x4F9D;&#x8D56;&#x7684;&#x793A;&#x4F8B;&#x3002;&#x5176;&#x4E2D;<code>bintrayRepo</code>&#x662F;&#x9ED8;&#x8BA4;&#x7684;&#x4F7F;&#x7528;<code>maven</code>&#xFF0C;<code>mypicker</code>&#x662F;&#x5EFA;&#x7ACB;&#x7684;<code>package name</code>&#xFF0C;<code>siteUrl</code>&#x662F;&#x4F60;&#x7684;&#x9879;&#x76EE;&#x5730;&#x5740;&#xFF0C;&#x6211;&#x7684;&#x9879;&#x76EE;&#x5728;github&#x4E0A;&#xFF0C;&#x6240;&#x4EE5;&#x662F;github&#x9879;&#x76EE;&#x7684;&#x5730;&#x5740;&#x5F62;&#x5F0F;&#x3002;<code>gitUrl</code>&#x662F;<code>VCS</code>&#x3002;&#x5176;&#x4ED6;&#x5E94;&#x8BE5;&#x6CA1;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF0C;&#x76F8;&#x5E94;&#x7684;&#x6539;&#x6210;&#x81EA;&#x5DF1;&#x7684;&#x4FE1;&#x606F;&#x3002;</p>\n<p>&#x8FD9;&#x6837;&#x5C31;&#x6784;&#x5EFA;&#x597D;&#x4E86;&#x4F9D;&#x8D56;<code>com.idisfkj.picker:mypicker:1.2.1</code></p>\n<h2 id=\"&#x4E0A;&#x4F20;&#x5230;bintray\"><a href=\"#&#x4E0A;&#x4F20;&#x5230;bintray\" class=\"headerlink\" title=\"&#x4E0A;&#x4F20;&#x5230;bintray\"></a>&#x4E0A;&#x4F20;&#x5230;bintray</h2><p>&#x6253;&#x5F00;<code>Android Studio</code>&#x7684;&#x7EC8;&#x7AEF;</p>\n<h3 id=\"&#x7F16;&#x8BD1;library&#x6587;&#x4EF6;\"><a href=\"#&#x7F16;&#x8BD1;library&#x6587;&#x4EF6;\" class=\"headerlink\" title=\"&#x7F16;&#x8BD1;library&#x6587;&#x4EF6;\"></a>&#x7F16;&#x8BD1;library&#x6587;&#x4EF6;</h3><p>&#x5728;&#x7EC8;&#x7AEF;&#x8F93;&#x5165;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew install</span><br></pre></td></tr></table></figure>\n<p>&#x51FA;&#x73B0;<code>BUILD SUCCESSFUL</code>&#x5C31;&#x6CA1;&#x95EE;&#x9898;</p>\n<h3 id=\"&#x4E0A;&#x4F20;\"><a href=\"#&#x4E0A;&#x4F20;\" class=\"headerlink\" title=\"&#x4E0A;&#x4F20;\"></a>&#x4E0A;&#x4F20;</h3><p>&#x5728;&#x7EC8;&#x7AEF;&#x8F93;&#x5165;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew bintrayUpload</span><br></pre></td></tr></table></figure>\n<p>&#x4E00;&#x6837;&#x7684;&#x51FA;&#x73B0;<code>BUILD SUCCESSFUL</code>&#x5C31;&#x6CA1;&#x95EE;&#x9898;<br>&#x7136;&#x540E;&#x4F60;&#x8FDB;&#x5165;<code>JFrog Bintray</code>&#x8FDB;&#x5165;<code>maven</code>&#x4F60;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x5176;&#x4E2D;&#x591A;&#x4E86;&#x4E00;&#x4E2A;<code>package</code>&#xFF0C;&#x5982;&#x679C;&#x6709;&#x7684;&#x8BDD;&#x90A3;&#x5C31;&#x8868;&#x793A;&#x5B8C;&#x7F8E;&#x6210;&#x529F;&#x3002;</p>\n<h2 id=\"&#x540C;&#x6B65;&#x5230;Jcenter\"><a href=\"#&#x540C;&#x6B65;&#x5230;Jcenter\" class=\"headerlink\" title=\"&#x540C;&#x6B65;&#x5230;Jcenter\"></a>&#x540C;&#x6B65;&#x5230;Jcenter</h2><p>&#x5B8C;&#x6210;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#x5E76;&#x4E0D;&#x4EE3;&#x8868;&#x522B;&#x4EBA;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    compile &apos;com.idisfkj.picker:mypicker:1.2.1&apos;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD8;&#x8981;&#x6DFB;&#x52A0;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">repositories {</span><br><span class=\"line\">    maven {</span><br><span class=\"line\">        url &apos;https://dl.bintray.com/idisfkj/maven/&apos;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8981;&#x540C;&#x6B65;&#x5230;<code>Jcenter</code>&#x4E2D;&#xFF0C;&#x600E;&#x4E48;&#x540C;&#x6B65;&#x5462;&#xFF1F;&#x522B;&#x6025;&#xFF0C;&#x53EA;&#x8981;&#x5728;&#x4F60;&#x521A;&#x521A;&#x751F;&#x6210;&#x7684;<code>package</code>&#x4E2D;&#x70B9;&#x51FB;<code>Add to Jcenter</code>&#x5373;&#x53EF;&#x3002;</p>\n<p><img src=\"/2016/06/13/&#x5982;&#x4F55;&#x4F7F;Android-Studio&#x9879;&#x76EE;&#x53D1;&#x5E03;&#x5230;Jcenter&#x4E2D;/5.png\" alt=\"&#x56FE;\"></p>\n<p>&#x8FDB;&#x53BB;&#x4E4B;&#x540E;&#x76F4;&#x63A5;&#x53D1;&#x9001;&#x5C31;&#x53EF;&#x4EE5;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x586B;&#x5199;&#x4EC0;&#x4E48;&#x3002;</p>\n<p><img src=\"/2016/06/13/&#x5982;&#x4F55;&#x4F7F;Android-Studio&#x9879;&#x76EE;&#x53D1;&#x5E03;&#x5230;Jcenter&#x4E2D;/7.png\" alt=\"&#x56FE;\"></p>\n<p>&#x6700;&#x540E;&#x5C31;&#x662F;&#x7B49;&#x5F85;&#x4E86;&#x3002;&#x51E0;&#x4E2A;&#x5C0F;&#x65F6;&#x4E4B;&#x540E;&#x4F60;&#x4F1A;&#x6536;&#x5230;&#x8003;&#x6838;&#x901A;&#x8FC7;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x518D;&#x8FD4;&#x56DE;<code>package</code>&#x5C31;&#x4F1A;&#x53D1;&#x73B0;<code>Linked to</code>&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#x3002;</p>\n<p>&#x73B0;&#x5728;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<a href=\"http://jcenter.bintray.com/com/idisfkj/picker/mypicker/1.2.1\" target=\"_blank\" rel=\"noopener\">http://jcenter.bintray.com/com/idisfkj/picker/mypicker/1.2.1</a> &#x67E5;&#x770B;&#x3002;</p>\n<p><img src=\"/2016/06/13/&#x5982;&#x4F55;&#x4F7F;Android-Studio&#x9879;&#x76EE;&#x53D1;&#x5E03;&#x5230;Jcenter&#x4E2D;/8.png\" alt=\"&#x56FE;\"></p>\n<p>&#x540C;&#x65F6;&#x522B;&#x4EBA;&#x4E5F;&#x80FD;&#x4F7F;&#x7528;&#x4F60;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x7B80;&#x5355;&#x7684;&#x914D;&#x7F6E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    compile &apos;com.idisfkj.picker:mypicker:1.2.1&apos;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x7248;&#x672C;&#x66F4;&#x65B0;\"><a href=\"#&#x7248;&#x672C;&#x66F4;&#x65B0;\" class=\"headerlink\" title=\"&#x7248;&#x672C;&#x66F4;&#x65B0;\"></a>&#x7248;&#x672C;&#x66F4;&#x65B0;</h2><p>&#x5BF9;&#x4E8E;&#x7248;&#x672C;&#x66F4;&#x65B0;&#xFF0C;&#x53EA;&#x8981;&#x66F4;&#x6539;&#x4E0A;&#x9762;&#x914D;&#x7F6E;&#x7684;&#x7248;&#x672C;&#x53F7;<code>libraryVersion = &apos;1.2.1&apos;</code>&#x6539;&#x6210;&#x4F60;&#x8981;&#x66F4;&#x65B0;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x5176;&#x5B83;&#x4E0D;&#x53D8;&#x3002;&#x518D;&#x91CD;&#x65B0;&#x4E0A;&#x4F20;&#x5230;<code>bintray</code>&#x3002;</p>\n<h1 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h1><p>&#x6211;&#x8FD9;&#x91CC;&#x518D;&#x6765;&#x6574;&#x7406;&#x4E0B;&#x4E0A;&#x4F20;&#x7684;&#x601D;&#x8DEF;&#x3002;</p>\n<ul>\n<li>&#x65E2;&#x7136;&#x8981;&#x4E0A;&#x4F20;&#x5230;<code>Jcenter</code>&#x4E0A;&#xFF0C;&#x81EA;&#x7136;&#x8981;&#x53BB;<a href=\"https://bintray.com\" target=\"_blank\" rel=\"noopener\">https://bintray.com</a> &#x4E2D;&#x6CE8;&#x518C;&#x8D26;&#x53F7;</li>\n<li>&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x9700;&#x6C42;&#x521B;&#x5EFA;<code>maven</code>&#x7684;<code>Repository</code></li>\n<li>&#x628A;&#x9879;&#x76EE;&#x5206;&#x79BB;&#x6210;<code>Module</code></li>\n<li>&#x5728;&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#x7684;<code>build.gradle</code>&#x4E2D;&#x6DFB;&#x52A0;<code>bintray</code>&#x63D2;&#x4EF6;</li>\n<li>&#x5728;<code>local.properties</code>&#x4E2D;&#x6DFB;&#x52A0;<code>bintray</code>&#x8BA4;&#x8BC1;</li>\n<li>&#x4FEE;&#x6539;<code>Module</code>&#x4E2D;&#x7684;<code>build.gradle</code>&#x4E2D;&#x7684;&#x914D;&#x7F6E;</li>\n<li>&#x5728;<code>Android Studio</code>&#x7EC8;&#x7AEF;&#x4F7F;&#x7528;<code>./gradlew xxx</code>&#x4E0A;&#x4F20;</li>\n<li>&#x6700;&#x540E;&#x5728;<code>JFrog Bintray</code>&#x4E2D;&#x540C;&#x6B65;&#x5230;<code>Jcenter</code>&#x4E2D;</li>\n</ul>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["Jcenter"]},{"title":"RecyclerView的拖动、滑动删除","url":"https://www.rousetime.com/2016/06/04/RecyclerView的拖动、滑动删除/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p>&#x524D;&#x4E9B;&#x65F6;&#x5019;&#x63D0;&#x5230;&#x4E86;&#x4E0B;<code>RecyclerView</code>&#x7684;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x4ECA;&#x5929;&#x518D;&#x6765;&#x8BF4;&#x8BF4;<code>RecyclerView</code>&#x7684;&#x62D6;&#x52A8;&#x3001;&#x6ED1;&#x52A8;&#x5220;&#x9664;&#x3002;&#x770B;&#x5B8C;&#x4E86;&#x4EE5;&#x540E;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;<code>RecyclerView</code>&#x662F;&#x591A;&#x4E48;&#x7684;&#x7280;&#x5229;&#x3002;&#x6BD4;<code>ListView</code>&#x7B80;&#x5355;&#x7684;&#x591A;&#x4E86;&#x3002;</p>\n<h2 id=\"&#x539F;&#x7406;\"><a href=\"#&#x539F;&#x7406;\" class=\"headerlink\" title=\"&#x539F;&#x7406;\"></a>&#x539F;&#x7406;</h2><p>&#x4E3B;&#x8981;&#x662F;&#x4F7F;&#x7528;<code>ItemTouchHelper.Callback</code>&#x7C7B;&#xFF0C;&#x5728;&#x5176;&#x4E2D;&#x6211;&#x4EEC;&#x8981;&#x7528;&#x5230;&#x7684;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x6709;</p>\n<ul>\n<li>getMovementFlags()</li>\n<li>onMove()</li>\n<li>onSwiped()</li>\n<li>isLongPressDragEnabled()</li>\n<li>onSelectedChanged()</li>\n<li>clearView()</li>\n</ul>\n<p>&#x501F;&#x52A9;&#x8BE5;<code>ItemTouchHelper.Callback</code>&#x4E0E;&#x5176;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x5C31;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x5904;&#x7406;&#x5B9E;&#x73B0;&#x62D6;&#x52A8;&#x3001;&#x5220;&#x9664;&#x3002;<br>&#x4E0B;&#x9762;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x7684;&#x7528;&#x5904;&#x4E0E;&#x529F;&#x80FD;&#x5B9E;&#x73B0;&#x3002;</p>\n<h3 id=\"&#x62D6;&#x52A8;\"><a href=\"#&#x62D6;&#x52A8;\" class=\"headerlink\" title=\"&#x62D6;&#x52A8;\"></a>&#x62D6;&#x52A8;</h3><h4 id=\"getMovementFlags\"><a href=\"#getMovementFlags\" class=\"headerlink\" title=\"getMovementFlags\"></a>getMovementFlags</h4><p>&#x65E2;&#x7136;&#x8981;&#x4F7F;&#x7528;<code>ItemTouchHelper.Callback</code>&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x81EA;&#x5B9A;&#x4E49;&#x81EA;&#x5DF1;&#x7684;&#x7C7B;&#x6765;&#x7EE7;&#x627F;&#x5B83;&#xFF0C;&#x91CD;&#x5199;&#x5176;&#x4E2D;&#x7684;&#x76F8;&#x5173;&#x65B9;&#x6CD5;&#x3002;&#x9996;&#x5148;&#x662F;<code>getMovementFlags()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x662F;&#x5B9A;&#x4E49;&#x79FB;&#x52A8;&#x6807;&#x8BC6;&#xFF0C;&#x6240;&#x4EE5;&#x9488;&#x5BF9;&#x62D6;&#x52A8;&#x6548;&#x679C;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x9996;&#x5148;&#x5B9A;&#x4E49;&#x62D6;&#x52A8;&#x6807;&#x8BC6;,&#x901A;&#x8FC7;<code>ItemTouchHelper</code>&#x63D0;&#x4F9B;&#x7684;&#x53C2;&#x6570;&#x6765;&#x5B9A;&#x4E49;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">        public int getMovementFlags(RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder) {</span><br><span class=\"line\">            dragFlags = 0;</span><br><span class=\"line\">            swipeFlags = 0;</span><br><span class=\"line\">            if (recyclerView.getLayoutManager() instanceof GridLayoutManager</span><br><span class=\"line\">                    || recyclerView.getLayoutManager() instanceof StaggeredGridLayoutManager) {</span><br><span class=\"line\">                dragFlags = ItemTouchHelper.UP | ItemTouchHelper.DOWN</span><br><span class=\"line\">                        | ItemTouchHelper.LEFT | ItemTouchHelper.RIGHT;</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                dragFlags = ItemTouchHelper.UP | ItemTouchHelper.DOWN;</span><br><span class=\"line\">                //if (viewHolder.getAdapterPosition() != 0)</span><br><span class=\"line\">                  //  swipeFlags = ItemTouchHelper.START | ItemTouchHelper.END;</span><br><span class=\"line\">            }</span><br><span class=\"line\">            return makeMovementFlags(dragFlags, swipeFlags);</span><br><span class=\"line\">        }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x4F60;&#x7684;<code>RecyclerView</code>&#x7684;<code>LayoutManager</code>&#x60C5;&#x51B5;&#x6765;&#x5B9A;&#x4E49;&#x62D6;&#x52A8;&#x65B9;&#x5411;&#x3002;<code>LinearLayoutManager</code>&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x4E0A;&#x4E0B;&#x62D6;&#x52A8;<code>dragFlags = ItemTouchHelper.UP | ItemTouchHelper.DOWN;</code>&#x81F3;&#x4E8E;&#x6CE8;&#x91CA;&#x4EE3;&#x7801;<code>swipeFlags</code>&#x8FD9;&#x91CC;&#x5148;&#x4E0D;&#x8981;&#x7BA1;&#xFF0C;&#x8FD9;&#x662F;&#x4E0B;&#x9762;&#x7684;&#x5220;&#x9664;&#x6807;&#x8BC6;&#x3002;&#x6700;&#x540E;&#x518D;&#x8C03;&#x7528;<code>makeMovementFlags</code>&#x8FD4;&#x56DE;&#x3002;</p>\n<h4 id=\"onMove\"><a href=\"#onMove\" class=\"headerlink\" title=\"onMove\"></a>onMove</h4><p>&#x5728;&#x5B9A;&#x4E49;&#x5B8C;<code>MovementFlags</code>&#x4EE5;&#x540E;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x62D6;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x56DE;&#x8C03;&#x7528;<code>onMove</code>&#x65B9;&#x6CD5;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x91CD;&#x5199;&#x8BE5;&#x65B9;&#x6CD5;&#xFF0C;&#x8FDB;&#x884C;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x6539;&#x53D8;&#x64CD;&#x4F5C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">        public boolean onMove(RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder, RecyclerView.ViewHolder target) {</span><br><span class=\"line\">            int fromPosition = viewHolder.getAdapterPosition();</span><br><span class=\"line\">            int toPosition = target.getAdapterPosition();</span><br><span class=\"line\">            if (toPosition != 0) {</span><br><span class=\"line\">                if (fromPosition &lt; toPosition)</span><br><span class=\"line\">                    //&#x5411;&#x4E0B;&#x62D6;&#x52A8;</span><br><span class=\"line\">                    for (int i = fromPosition; i &lt; toPosition; i++) {</span><br><span class=\"line\">                        Collections.swap(mListData, i, i + 1);</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                else {</span><br><span class=\"line\">                    //&#x5411;&#x4E0A;&#x62D6;&#x52A8;</span><br><span class=\"line\">                    for (int i = fromPosition; i &gt; toPosition; i--) {</span><br><span class=\"line\">                        Collections.swap(mListData, i, i - 1);</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }</span><br><span class=\"line\">                recyclerView.getAdapter().notifyItemMoved(fromPosition, toPosition);</span><br><span class=\"line\">            }</span><br><span class=\"line\">            return true;</span><br><span class=\"line\">        }</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x63D0;&#x4F9B;&#x7684;&#x53C2;&#x6570;&#x83B7;&#x53D6;<code>fromPosition</code>&#x521D;&#x59CB;&#x4F4D;&#x7F6E;<code>toPosition</code>&#x76EE;&#x6807;&#x4F4D;&#x7F6E;&#xFF0C;&#x6839;&#x636E;&#x60C5;&#x51B5;&#x505A;&#x76F8;&#x5E94;&#x7684;&#x6570;&#x636E;&#x6539;&#x53D8;&#xFF0C;&#x6700;&#x540E;&#x8C03;&#x7528;<code>recyclerView.getAdapter().notifyItemMoved(fromPosition, toPosition);</code>&#x6765;&#x66F4;&#x65B0;<code>adapter</code>&#x72B6;&#x6001;&#x3002;</p>\n<h4 id=\"&#x7ED1;&#x5B9A;\"><a href=\"#&#x7ED1;&#x5B9A;\" class=\"headerlink\" title=\"&#x7ED1;&#x5B9A;\"></a>&#x7ED1;&#x5B9A;</h4><p>&#x6700;&#x540E;&#x7528;&#x4E0B;&#x9762;&#x4EE3;&#x7801;&#x6765;&#x7ED1;&#x5B9A;&#x76EE;&#x6807;<code>RecyclerView</code>&#x5BF9;&#x8C61;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">final ItemTouchHelper helper = new ItemTouchHelper(new MyCallBack());</span><br><span class=\"line\">        helper.attachToRecyclerView(recyclerView);</span><br></pre></td></tr></table></figure>\n<p><code>(new MyCallBack()</code>&#x5C31;&#x662F;&#x524D;&#x9762;&#x6211;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x7C7B;&#x3002;&#x8FD9;&#x6837;&#x57FA;&#x672C;&#x7684;&#x62D6;&#x52A8;&#x5C31;&#x5B9E;&#x73B0;&#x4E86;&#x3002;&#x4F46;&#x662F;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x5C31;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#x4F60;&#x5728;&#x62D6;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x56DE;&#x6CA1;&#x6709;&#x80CC;&#x666F;&#x6548;&#x679C;&#x7684;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x8FDB;&#x884C;&#x4F18;&#x5316;&#x4E00;&#x4E0B;</p>\n<h4 id=\"onSelectedChanged\"><a href=\"#onSelectedChanged\" class=\"headerlink\" title=\"onSelectedChanged\"></a>onSelectedChanged</h4><p>&#x901A;&#x8FC7;&#x91CD;&#x5199;&#x8BE5;&#x65B9;&#x6CD5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x81EA;&#x5DF1;&#x7684;&#x62D6;&#x52A8;&#x80CC;&#x666F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">        public void onSelectedChanged(RecyclerView.ViewHolder viewHolder, int actionState) {</span><br><span class=\"line\">            if (actionState != ItemTouchHelper.ACTION_STATE_IDLE) {</span><br><span class=\"line\">                viewHolder.itemView.setPressed(true);</span><br><span class=\"line\">            }</span><br><span class=\"line\">            super.onSelectedChanged(viewHolder, actionState);</span><br><span class=\"line\">        }</span><br></pre></td></tr></table></figure>\n<p>&#x5F53;&#x7136;&#x524D;&#x63D0;&#x662F;&#x4F60;&#x7684;<code>RecyclerView</code>&#x7684;<code>Item</code>&#x5DF2;&#x7ECF;&#x6DFB;&#x52A0;&#x4E86;<code>android:background=&quot;@drawable/item_bg</code>&#x5C5E;&#x6027;&#x3002;&#x4F8B;&#x5982;<code>item_bg</code>&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;selector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;</span><br><span class=\"line\">    &lt;item android:state_pressed=&quot;true&quot;&gt;</span><br><span class=\"line\">        &lt;shape android:shape=&quot;rectangle&quot;&gt;</span><br><span class=\"line\">            &lt;solid android:color=&quot;@android:color/darker_gray&quot;/&gt;</span><br><span class=\"line\">        &lt;/shape&gt;</span><br><span class=\"line\">    &lt;/item&gt;</span><br><span class=\"line\">    &lt;item android:state_pressed=&quot;false&quot;&gt;</span><br><span class=\"line\">        &lt;shape android:shape=&quot;rectangle&quot;&gt;</span><br><span class=\"line\">            &lt;solid android:color=&quot;@android:color/white&quot;/&gt;</span><br><span class=\"line\">        &lt;/shape&gt;</span><br><span class=\"line\">    &lt;/item&gt;</span><br><span class=\"line\">&lt;/selector&gt;</span><br></pre></td></tr></table></figure>\n<h4 id=\"clearView\"><a href=\"#clearView\" class=\"headerlink\" title=\"clearView\"></a>clearView</h4><p>&#x6700;&#x540E;&#x518D;&#x91CD;&#x5199;<code>clearViwe()</code>&#x62D6;&#x52A8;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x4F1A;&#x8C03;&#x7528;&#xFF0C;&#x7528;&#x6765;&#x6E05;&#x9664;&#x80CC;&#x666F;&#x72B6;&#x6001;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">        public void clearView(RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder) {</span><br><span class=\"line\">            super.clearView(recyclerView, viewHolder);</span><br><span class=\"line\">            viewHolder.itemView.setPressed(false);</span><br><span class=\"line\">        }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x57FA;&#x672C;&#x4E0A;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x65E5;&#x5E38;&#x6211;&#x4EEC;&#x6240;&#x8981;&#x7684;&#x62D6;&#x52A8;&#x6548;&#x679C;&#x3002;&#x81F3;&#x4E8E;&#x5BF9;&#x4E2A;&#x522B;&#x7684;<code>Item</code>&#x5C4F;&#x853D;&#x62D6;&#x52A8;&#x6548;&#x679C;&#x53EF;&#x4EE5;&#x91CD;&#x5199;<code>isLongPressDragEnabled()</code>&#x65B9;&#x6CD5;</p>\n<h3 id=\"isLongPressDragEnabled\"><a href=\"#isLongPressDragEnabled\" class=\"headerlink\" title=\"isLongPressDragEnabled\"></a>isLongPressDragEnabled</h3><p>&#x8BE5;&#x65B9;&#x6CD5;&#x9ED8;&#x8BA4;&#x8FD4;&#x56DE;<code>true</code>&#x5C31;&#x662F;&#x4E0D;&#x5C4F;&#x853D;&#x62D6;&#x52A8;&#x6548;&#x679C;&#xFF0C;&#x6240;&#x6709;&#x7684;<code>Item</code>&#x90FD;&#x80FD;&#x88AB;&#x62D6;&#x52A8;&#x3002;&#x5982;&#x679C;&#x8981;&#x5B9E;&#x73B0;&#x5C4F;&#x853D;&#x7684;&#x8BDD;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x8FD4;&#x56DE;<code>false</code>&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">        public boolean isLongPressDragEnabled() {</span><br><span class=\"line\">            return false;</span><br><span class=\"line\">        }</span><br></pre></td></tr></table></figure>\n<p>&#x518D;&#x5728;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x6587;&#x7AE0;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;<code>Item</code>&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x7684;&#x5904;&#x7406;&#x4E2D;&#x7684;<code>onItemLongPressClick()</code>&#x65B9;&#x6CD5;&#x4E2D;&#x8C03;&#x7528;<code>helper.startDrag(vh)</code>&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x8981;&#x62D6;&#x52A8;&#x7684;<code>Item</code>,&#x901A;&#x8FC7;&#x4F20;&#x5165;&#x8981;&#x62D6;&#x52A8;&#x7684;<code>ViewHolder</code>&#x6765;&#x6807;&#x8BC6;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">            public void onItemLongPressClick(RecyclerView.ViewHolder vh) {</span><br><span class=\"line\">                if (vh.getAdapterPosition() != 0) {</span><br><span class=\"line\">                    helper.startDrag(vh);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x6211;&#x56FA;&#x5B9A;&#x4E86;&#x7B2C;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;&#x662F;&#x4E0D;&#x80FD;&#x88AB;&#x62D6;&#x52A8;&#x7684;&#x3002;</p>\n<blockquote>\n<p><em>&#x5982;&#x679C;&#x5BF9;&#x4E8E;RecyclerView&#x7684;Item&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x8FD8;&#x4E0D;&#x4E86;&#x89E3;&#x7684;&#x53EF;&#x4EE5;&#x9605;&#x8BFB;&#x6211;&#x524D;&#x9762;&#x7684;&#x6587;&#x7AE0;<a href=\"https://idisfkj.github.io/2016/05/22/RecyclerView-item%E7%82%B9%E5%87%BB%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BC%9A%E4%B9%88/\" target=\"_blank\" rel=\"noopener\">RecyclerView item&#x70B9;&#x51FB;&#x4F60;&#x771F;&#x7684;&#x4F1A;&#x4E48;</a></em></p>\n</blockquote>\n<h3 id=\"&#x6ED1;&#x52A8;&#x5220;&#x9664;\"><a href=\"#&#x6ED1;&#x52A8;&#x5220;&#x9664;\" class=\"headerlink\" title=\"&#x6ED1;&#x52A8;&#x5220;&#x9664;\"></a>&#x6ED1;&#x52A8;&#x5220;&#x9664;</h3><p>&#x5230;&#x8FD9;&#x91CC;&#x76F8;&#x4FE1;&#x6ED1;&#x52A8;&#x5220;&#x9664;&#x5E94;&#x8BE5;&#x6709;&#x70B9;&#x7709;&#x76EE;&#x4E86;&#x5427;&#x3002;&#x5BF9;&#xFF0C;&#x5C31;&#x662F;&#x524D;&#x9762;<code>getMovementFlags()</code>&#x65B9;&#x6CD5;&#x4E2D;&#x6240;&#x5B9A;&#x4E49;&#x7684;<code>swipeFlags</code>&#x6807;&#x8BC6;&#xFF0C;<code>ItemTouchHelper</code>&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x5DE6;&#x53F3;&#x5220;&#x9664;&#x6807;&#x8BC6;<code>ItemTouchHelper.START</code>&#x4E0E;<code>ItemTouchHelper.END</code>,&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5148;&#x6253;&#x5F00;&#x524D;&#x9762;&#x6CE8;&#x91CA;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>\n<h4 id=\"onSwiped\"><a href=\"#onSwiped\" class=\"headerlink\" title=\"onSwiped\"></a>onSwiped</h4><p>&#x6700;&#x540E;&#x53EF;&#x4EE5;&#x5728;<code>onSwiped()</code>&#x4E2D;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5220;&#x9664;&#x64CD;&#x4F5C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">        public void onSwiped(RecyclerView.ViewHolder viewHolder, int direction) {</span><br><span class=\"line\">            int positon = viewHolder.getAdapterPosition();</span><br><span class=\"line\">            recyclerView.getAdapter().notifyItemRemoved(positon);</span><br><span class=\"line\">            mListData.remove(positon);</span><br><span class=\"line\">        }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x57FA;&#x672C;&#x7684;&#x6ED1;&#x52A8;&#x5220;&#x9664;&#x5C31;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x4E86;&#x3002;&#x81F3;&#x4E8E;&#x5BF9;&#x4E2A;&#x522B;&#x7684;<code>Item</code>&#x5C4F;&#x853D;&#x5220;&#x9664;&#x6548;&#x679C;&#x53EF;&#x4EE5;&#x91CD;&#x5199;<code>isItemViewSwipeEnabled()</code>&#x65B9;&#x6CD5;</p>\n<h3 id=\"isItemViewSwipeEnabled\"><a href=\"#isItemViewSwipeEnabled\" class=\"headerlink\" title=\"isItemViewSwipeEnabled\"></a>isItemViewSwipeEnabled</h3><p>&#x8BE5;&#x65B9;&#x6CD5;&#x4E0E;&#x524D;&#x9762;&#x7684;&#x62D6;&#x52A8;&#x7684;&#x5C4F;&#x853D;<code>isItemViewSwipeEnabled()</code>&#x65B9;&#x6CD5;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x5B83;&#x4E5F;&#x662F;&#x9ED8;&#x8BA4;&#x8FD4;&#x56DE;<code>true</code>&#xFF0C;&#x4E0D;&#x5BF9;<code>Item</code>&#x8FDB;&#x884C;&#x5C4F;&#x853D;&#x6ED1;&#x52A8;&#x5220;&#x9664;&#x3002;&#x5982;&#x679C;&#x8981;&#x5C4F;&#x853D;&#x7684;&#x8BDD;&#x4E5F;&#x662F;&#x91CD;&#x5199;&#x65B9;&#x6CD5;&#x518D;&#x8FD4;&#x56DE;<code>false</code>&#xFF0C;&#x6700;&#x540E;&#x5728;&#x901A;&#x8FC7;&#x5BF9;&#x5E94;&#x7684;<code>startSwipe(ViewHolder)</code>&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x6ED1;&#x52A8;&#x5220;&#x9664;&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x524D;&#x9762;&#x7684;&#x5C4F;&#x853D;&#x62D6;&#x52A8;&#x3002;</p>\n<h1 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h1><p>&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x662F;&#x8981;&#x5F04;&#x660E;&#x767D;&#x4E0A;&#x9762;&#x6240;&#x63D0;&#x5230;&#x7684;6&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x4F5C;&#x7528;&#x4E0E;&#x8C03;&#x7528;&#x65F6;&#x673A;&#x3002;&#x4E3B;&#x8981;&#x5C31;&#x662F;<code>getMovementFlags()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5B9A;&#x4E49;&#x597D;&#x62D6;&#x52A8;&#x4E0E;&#x6ED1;&#x52A8;&#x6807;&#x8BC6;&#x3002;&#x62D6;&#x52A8;&#x65F6;&#x4F1A;&#x56DE;&#x8C03;<code>onMove()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x6ED1;&#x52A8;&#x5220;&#x9664;&#x65F6;&#x8981;&#x5904;&#x7406;&#x6570;&#x636E;&#x7684;&#x5220;&#x9664;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x56DE;&#x8C03;<code>onSwiped()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x81F3;&#x4E8E;&#x5176;&#x5B83;&#x7684;&#x72B6;&#x6001;&#x6548;&#x679C;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x89C6;&#x9700;&#x6C42;&#x6765;&#x7075;&#x6D3B;&#x53D8;&#x5316;&#x3002;</p>\n<p>Demo&#x5730;&#x5740;:<a href=\"https://github.com/idisfkj/RecyclerView\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/RecyclerView</a></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["RecyclerView"]},{"title":"Socket的简单通信","url":"https://www.rousetime.com/2016/05/28/Socket的简单通信/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x4ECB;&#x7ECD;<code>Socket</code>&#x901A;&#x4FE1;&#xFF0C;&#x662F;&#x4E00;&#x7BC7;&#x5165;&#x95E8;&#x6587;&#x7AE0;&#x3002;&#x6240;&#x6709;&#x8FD8;&#x6CA1;&#x6709;&#x63A5;&#x89E6;&#xFF0C;&#x4F46;&#x53C8;&#x60F3;&#x4E86;&#x89E3;&#x7684;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x4E0B;&#x3002;&#x5E0C;&#x671B;&#x5BF9;&#x4F60;&#x4EEC;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#x3002;</p>\n<h2 id=\"Socket\"><a href=\"#Socket\" class=\"headerlink\" title=\"Socket\"></a>Socket</h2><p>&#x9996;&#x5148;&#x4E00;&#x53E5;&#x8BDD;&#x7B80;&#x5355;&#x7684;&#x4ECB;&#x7ECD;<code>Socket</code>:&#x7F51;&#x7EDC;&#x4E0A;&#x7684;&#x4E24;&#x4E2A;&#x7A0B;&#x5E8F;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x53CC;&#x5411;&#x7684;&#x901A;&#x4FE1;&#x8FDE;&#x63A5;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x7684;&#x4EA4;&#x6362;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FDE;&#x63A5;&#x7684;&#x4E00;&#x7AEF;&#x79F0;&#x4E3A;&#x4E00;&#x4E2A;<code>socket</code>&#x3002;<br>&#x6240;&#x6709;&#x6211;&#x4EEC;&#x4E0B;&#x9762;&#x8981;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x7AEF;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x901A;&#x4FE1;&#x3002;</p>\n<blockquote>\n<p><em>&#x563F;&#x563F;&#xFF0C;&#x5176;&#x5B9E;&#x4E0A;&#x9762;&#x7684;&#x90A3;&#x53E5;&#x8BDD;&#x662F;&#x767E;&#x5EA6;&#x767E;&#x79D1;&#x7684;&#xFF0C;&#x4E0D;&#x77E5;&#x9053;&#x4F60;&#x4EEC;&#x53D1;&#x73B0;&#x4E86;&#x6CA1;&#x6709;</em></p>\n</blockquote>\n<h2 id=\"&#x670D;&#x52A1;&#x7AEF;\"><a href=\"#&#x670D;&#x52A1;&#x7AEF;\" class=\"headerlink\" title=\"&#x670D;&#x52A1;&#x7AEF;\"></a>&#x670D;&#x52A1;&#x7AEF;</h2><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x65B0;&#x5EFA;&#x4E86;&#x4E2A;&#x7B80;&#x5355;&#x7684;<code>Java</code>&#x7C7B;&#xFF0C;&#x53EA;&#x662F;&#x5B9E;&#x73B0;&#x5F00;&#x542F;&#x540E;&#x7B49;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8FDE;&#x63A5;&#x3002;</p>\n<h3 id=\"&#x5B9E;&#x4F8B;&#x5316;ServerSocket\"><a href=\"#&#x5B9E;&#x4F8B;&#x5316;ServerSocket\" class=\"headerlink\" title=\"&#x5B9E;&#x4F8B;&#x5316;ServerSocket\"></a>&#x5B9E;&#x4F8B;&#x5316;ServerSocket</h3><p>&#x7ED1;&#x5B9A;&#x901A;&#x4FE1;&#x7AEF;&#x53E3;&#xFF0C;&#x6700;&#x597D;&#x7AEF;&#x53E3;&#x8BBE;&#x5927;&#x70B9;&#xFF0C;&#x9632;&#x6B62;&#x7AEF;&#x53E3;&#x88AB;&#x5360;&#x7528;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java.net.ServerSocket serverSocket = new java.net.ServerSocket(30000);</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x7B49;&#x5F85;&#x8FDE;&#x63A5;\"><a href=\"#&#x7B49;&#x5F85;&#x8FDE;&#x63A5;\" class=\"headerlink\" title=\"&#x7B49;&#x5F85;&#x8FDE;&#x63A5;\"></a>&#x7B49;&#x5F85;&#x8FDE;&#x63A5;</h3><p>&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x8BBE;&#x8BA1;&#x4E86;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;&#x53EA;&#x8981;&#x5F00;&#x542F;&#x4E86;&#x5C31;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">while (true) {</span><br><span class=\"line\">                        //&#x63A5;&#x6536;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;</span><br><span class=\"line\">                        Socket s = serverSocket.accept();</span><br><span class=\"line\">                        list.add(s);</span><br><span class=\"line\">                        //&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x7684;&#x7EBF;&#x7A0B;</span><br><span class=\"line\">                        new Thread(new ServiceRunnable(s)).start();</span><br><span class=\"line\">                    }</span><br></pre></td></tr></table></figure>\n<p>&#x56E0;&#x4E3A;&#x6211;&#x5B9E;&#x73B0;&#x7684;&#x662F;&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x4E0B;&#x5F97;&#x901A;&#x4FE1;&#xFF0C;&#x6240;&#x6709;&#x5C06;&#x6BCF;&#x4E2A;<code>Socket</code>&#x52A0;&#x5165;&#x5230;<code>List</code>&#x4E2D;&#x5E76;&#x4E14;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x7684;<code>Socket</code>&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x7EBF;&#x7A0B;&#x3002;</p>\n<h3 id=\"&#x901A;&#x4FE1;\"><a href=\"#&#x901A;&#x4FE1;\" class=\"headerlink\" title=\"&#x901A;&#x4FE1;\"></a>&#x901A;&#x4FE1;</h3><p>&#x5982;&#x4F55;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x6765;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5411;&#x6BCF;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x7684;<code>Socket</code>&#x53D1;&#x9001;&#x8BE5;&#x6D88;&#x606F;&#xFF0C;&#x6240;&#x6709;&#x9996;&#x5148;&#x8981;&#x83B7;&#x53D6;&#x8F93;&#x5165;&#x6D41;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">br = new BufferedReader(new InputStreamReader(s.getInputStream(), &quot;utf-8&quot;));</span><br></pre></td></tr></table></figure>\n<p>&#x8BFB;&#x53D6;&#x6570;&#x636E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public String readContent() {</span><br><span class=\"line\">    try {</span><br><span class=\"line\">        return br.readLine();</span><br><span class=\"line\">    } catch (IOException e) {</span><br><span class=\"line\">        list.remove(s);</span><br><span class=\"line\">        e.printStackTrace();</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return null;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x83B7;&#x53D6;&#x8F93;&#x51FA;&#x6D41;&#x53D1;&#x9001;&#x6D88;&#x606F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">while ((content = readContent()) != null) {</span><br><span class=\"line\">                //&#x904D;&#x5386;&#x6240;&#x6709;&#x8FDE;&#x63A5;&#x4E86;&#x7684;Socket&#xFF0C;&#x5411;&#x6240;&#x6709;&#x5BA2;&#x6237;&#x7AEF;Socket&#x53D1;&#x9001;&#x6D88;&#x606F;</span><br><span class=\"line\">                for (Iterator&lt;Socket&gt; it = list.iterator(); it.hasNext(); ) {</span><br><span class=\"line\">                    Socket socket = it.next();</span><br><span class=\"line\">                    try {</span><br><span class=\"line\">                        pw = new PrintWriter(new BufferedWriter(new OutputStreamWriter(socket.getOutputStream())), true);</span><br><span class=\"line\">                        pw.println(content);</span><br><span class=\"line\">                    } catch (IOException e) {</span><br><span class=\"line\">                        it.remove();</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br></pre></td></tr></table></figure>\n<p>&#x670D;&#x52A1;&#x7AEF;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x5BA2;&#x6237;&#x7AEF;</p>\n<h2 id=\"&#x5BA2;&#x6237;&#x7AEF;\"><a href=\"#&#x5BA2;&#x6237;&#x7AEF;\" class=\"headerlink\" title=\"&#x5BA2;&#x6237;&#x7AEF;\"></a>&#x5BA2;&#x6237;&#x7AEF;</h2><p>&#x5BA2;&#x6237;&#x7AEF;&#x5E03;&#x5C40;&#x53EA;&#x8981;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x53D1;&#x9001;&#x754C;&#x9762;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#x3002;&#x76F4;&#x63A5;&#x8BF4;<code>Socket</code>&#x3002;</p>\n<h3 id=\"&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;\"><a href=\"#&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;\" class=\"headerlink\" title=\"&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;\"></a>&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;</h3><p>&#x6307;&#x5B9A;&#x670D;&#x52A1;&#x4E3B;&#x673A;&#x540D;&#x6216;<code>IP</code>&#x5730;&#x5740;&#x4E0E;&#x8FDE;&#x63A5;&#x7684;&#x7AEF;&#x53E3;&#x53F7;&#xFF0C;&#x5E94;&#x4E3A;&#x662F;&#x672C;&#x5730;&#x670D;&#x52A1;&#x5668;&#x6240;&#x6709;&#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x672C;&#x5730;<code>IP</code>&#x5730;&#x5740;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">socket = new Socket(&quot;192.168.56.1&quot;, 30000);</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x901A;&#x4FE1;-1\"><a href=\"#&#x901A;&#x4FE1;-1\" class=\"headerlink\" title=\"&#x901A;&#x4FE1;\"></a>&#x901A;&#x4FE1;</h3><p>&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x901A;&#x4FE1;&#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x7C7B;&#x4F3C;&#xFF0C;&#x83B7;&#x53D6;&#x8F93;&#x5165;&#x6D41;&#xFF0C;&#x8BFB;&#x53D6;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x6765;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x5E76;&#x663E;&#x793A;&#x5230;&#x754C;&#x9762;&#x4E2D;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">br = new BufferedReader(new InputStreamReader(socket.getInputStream()));</span><br><span class=\"line\"></span><br><span class=\"line\">                new Thread(new Runnable() {</span><br><span class=\"line\">                    String line;</span><br><span class=\"line\"></span><br><span class=\"line\">                    @Override</span><br><span class=\"line\">                    public void run() {</span><br><span class=\"line\">                        try {</span><br><span class=\"line\">                            //&#x8BFB;&#x53D6;&#x670D;&#x52A1;&#x7AEF;&#x53D1;&#x6765;&#x7684;&#x6D88;&#x606F;</span><br><span class=\"line\">                            while ((line = br.readLine()) != null) {</span><br><span class=\"line\">                                Message message = new Message();</span><br><span class=\"line\">                                message.what = 1;</span><br><span class=\"line\">                                message.obj = line;</span><br><span class=\"line\">                                handler.sendMessage(message);</span><br><span class=\"line\">                            }</span><br><span class=\"line\">                        } catch (IOException e) {</span><br><span class=\"line\">                            e.printStackTrace();</span><br><span class=\"line\">                        }</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }).start();</span><br></pre></td></tr></table></figure>\n<p>&#x70B9;&#x51FB;&#x53D1;&#x9001;&#xFF0C;&#x83B7;&#x53D6;&#x8F93;&#x51FA;&#x6D41;&#x5411;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x6D88;&#x606F;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">public void onClick(View v) {</span><br><span class=\"line\">    Message message = new Message();</span><br><span class=\"line\">    message.what = 2;</span><br><span class=\"line\">    message.obj = et.getText().toString();</span><br><span class=\"line\">    clientThread.clientHandler.sendMessage(message);</span><br><span class=\"line\">    et.setText(&quot;&quot;);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">clientHandler = new Handler(Looper.getMainLooper()) {</span><br><span class=\"line\">                    @Override</span><br><span class=\"line\">                    public void handleMessage(Message msg) {</span><br><span class=\"line\">                        if (msg.what == 2) {</span><br><span class=\"line\">                            try {</span><br><span class=\"line\">                                //&#x5411;&#x670D;&#x52A1;&#x7AEF;&#x53D1;&#x9001;&#x6D88;&#x606F;</span><br><span class=\"line\">                                pw = new PrintWriter(new BufferedWriter(new OutputStreamWriter(socket.getOutputStream())), true);</span><br><span class=\"line\">                                pw.println(msg.obj);</span><br><span class=\"line\">                            } catch (IOException e) {</span><br><span class=\"line\">                                e.printStackTrace();</span><br><span class=\"line\">                            }</span><br><span class=\"line\">                        }</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                };</span><br></pre></td></tr></table></figure>\n<p>&#x5230;&#x6B64;&#x6574;&#x4E2A;&#x7684;<code>Socket</code>&#x901A;&#x4FE1;&#x5C31;&#x57FA;&#x672C;&#x4E0A;&#x5B8C;&#x6210;&#x4E86;&#x3002;</p>\n<h2 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h2><p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x4F7F;&#x7528;<code>Socket</code>&#x5B9E;&#x73B0;&#x901A;&#x4FE1;&#xFF0C;&#x4E3B;&#x8981;&#x5206;&#x4E3A;&#x4E09;&#x6B65;</p>\n<ul>\n<li>&#x5B9E;&#x4F8B;&#x5316;<code>Socket</code>,&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;</li>\n<li>&#x83B7;&#x53D6;&#x8F93;&#x5165;&#x6D41;&#xFF0C;&#x8BFB;&#x53D6;&#x6570;&#x636E;</li>\n<li>&#x83B7;&#x53D6;&#x8F93;&#x51FA;&#x6D41;&#xFF0C;&#x53D1;&#x9001;&#x6570;&#x636E;</li>\n</ul>\n<p>&#x5F53;&#x7136;&#x8FD9;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x5E26;&#x9886;&#x6211;&#x4EEC;&#x5165;&#x95E8;&#x800C;&#x5DF2;&#x3002;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x501F;&#x52A9;&#x4E0B;&#x9762;&#x7684;Demo&#x5B66;&#x4E60;&#x3002;</p>\n<p>Demo&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/idisfkj/Socket\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/Socket</a></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["Socket"]},{"title":"android 软键盘显隐","url":"https://www.rousetime.com/2016/05/24/android-软键盘显隐/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p>&#x6700;&#x8FD1;&#x9047;&#x5230;&#x8F6F;&#x952E;&#x76D8;&#x7684;&#x663E;&#x9690;&#x5224;&#x65AD;&#x95EE;&#x9898;&#xFF0C;&#x539F;&#x6765;&#x4E5F;&#x9047;&#x8FC7;&#x4E00;&#x6B21;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x6B21;&#x9488;&#x5BF9;&#x8FD9;&#x7C7B;&#x95EE;&#x9898;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x505A;&#x4E0B;&#x8BB0;&#x5F55;&#xFF0C;&#x4E5F;&#x5E0C;&#x671B;&#x5E2E;&#x52A9;&#x540E;&#x9762;&#x78B0;&#x5230;&#x76F8;&#x540C;&#x95EE;&#x9898;&#x7684;&#x4F60;&#x4EEC;&#x3002;</p>\n<p>&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x7ECF;&#x9A8C;&#xFF0C;&#x8FD9;&#x91CC;&#x6709;&#x4E09;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x5B9E;&#x539F;&#x7406;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x8F6F;&#x4EF6;&#x76D8;&#x7684;&#x5F39;&#x51FA;&#xFF0C;&#x89C6;&#x56FE;&#x7684;&#x5E03;&#x5C40;&#x4F1A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5E03;&#x5C40;&#x7684;&#x6539;&#x53D8;&#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x663E;&#x793A;&#x4E86;&#x8F6F;&#x4EF6;&#x76D8;&#x3002;</p>\n<h2 id=\"&#x81EA;&#x5B9A;&#x4E49;&#x65B9;&#x6CD5;\"><a href=\"#&#x81EA;&#x5B9A;&#x4E49;&#x65B9;&#x6CD5;\" class=\"headerlink\" title=\"&#x81EA;&#x5B9A;&#x4E49;&#x65B9;&#x6CD5;\"></a>&#x81EA;&#x5B9A;&#x4E49;&#x65B9;&#x6CD5;</h2><p>&#x4E2A;&#x4EBA;&#x89C9;&#x5F97;&#x5B83;&#x7684;&#x7075;&#x6D3B;&#x6027;&#x76F8;&#x5BF9;&#x4E8E;&#x522B;&#x7684;&#x66F4;&#x9AD8;&#x3002;&#x56E0;&#x4E3A;&#x8FD9;&#x53EA;&#x662F;&#x5728;&#x7C7B;&#x4E2D;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x8F6F;&#x952E;&#x76D8;&#x89E6;&#x53D1;&#x4E86;&#x3002;&#x8FD9;&#x6837;&#x4F60;&#x53EF;&#x4EE5;&#x8FD0;&#x7528;&#x5230;&#x4EFB;&#x4F55;&#x76D1;&#x542C;&#x4E8B;&#x4EF6;&#x4E2D;&#x6765;&#x83B7;&#x53D6;&#x8F6F;&#x4EF6;&#x76D8;&#x7684;&#x72B6;&#x6001;&#x3002;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>\n<p>&#x5224;&#x65AD;&#x72B6;&#x6001;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private boolean isKeyboardShown(View rootView) {</span><br><span class=\"line\">        final int softKeyboardHeight = 100;</span><br><span class=\"line\">        Rect r = new Rect();</span><br><span class=\"line\">        //&#xA0;&#x83B7;&#x53D6;&#x6839;&#x5E03;&#x5C40;&#x7684;&#x53EF;&#x89C6;&#x533A;&#x57DF;r</span><br><span class=\"line\">        rootView.getWindowVisibleDisplayFrame(r);</span><br><span class=\"line\">        DisplayMetrics dm = rootView.getResources().getDisplayMetrics();</span><br><span class=\"line\">        // &#x672C;&#x6765;&#x7684;&#x5B9E;&#x9645;&#x5E95;&#x90E8;&#x8DDD;&#x79BB; - &#x53EF;&#x89C6;&#x7684;&#x5E95;&#x90E8;&#x8DDD;&#x79BB;</span><br><span class=\"line\">        int heightDiff = rootView.getBottom() - r.bottom;</span><br><span class=\"line\">        return heightDiff &gt; softKeyboardHeight * dm.density;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x4F8B;&#x5982;&#x5728;<code>onTouch</code>&#x4E2D;&#x5224;&#x65AD;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    public boolean onTouch(View v, MotionEvent event) {</span><br><span class=\"line\">        if (event.getAction() == MotionEvent.ACTION_DOWN &amp;&amp; isKeyboardShown(chatContent.getRootView()))</span><br><span class=\"line\">            manager.toggleSoftInput(0, InputMethodManager.HIDE_NOT_ALWAYS);</span><br><span class=\"line\">        return false;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x8C03;&#x7528;Android-API\"><a href=\"#&#x8C03;&#x7528;Android-API\" class=\"headerlink\" title=\"&#x8C03;&#x7528;Android API\"></a>&#x8C03;&#x7528;Android API</h2><p>&#x5176;&#x5B9E;&#x67E5;&#x9605;<code>API</code>&#x53D1;&#x73B0;<code>Android</code>&#x5DF2;&#x7ECF;&#x5E2E;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;&#x5E03;&#x5C40;&#x6539;&#x53D8;&#x7684;&#x76D1;&#x542C;&#x7684;&#x7C7B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>addOnGlobalLayoutListener</code>&#x6765;&#x76D1;&#x542C;&#x6574;&#x4E2A;&#x5E03;&#x5C40;&#x7684;&#x72B6;&#x6001;&#x3002;&#x8FD9;&#x4E2A;&#x76D1;&#x542C;&#x5668;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x5E03;&#x5C40;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x65F6;&#x4F1A;&#x8C03;&#x7528;<code>onGlobalLayout</code>&#x65B9;&#x6CD5;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x5176;&#x4E2D;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002;&#x5F53;&#x7136;&#x5728;&#x4F7F;&#x7528;&#x8BE5;&#x76D1;&#x542C;&#x65F6;&#x8981;&#x5148;&#x83B7;&#x53D6;&#x6574;&#x4E2A;&#x89C6;&#x56FE;&#x6811;&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">final View root = findViewById(R.id.main);</span><br><span class=\"line\">        ViewTreeObserver observer = root.getViewTreeObserver();</span><br></pre></td></tr></table></figure>\n<p>&#x518D;&#x6DFB;&#x52A0;&#x76D1;&#x542C;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">observer.addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onGlobalLayout() {</span><br><span class=\"line\">                int heightDiff = root.getRootView().getHeight() - root.getHeight();</span><br><span class=\"line\">                if (heightDiff &gt; 100){ //&#x4E00;&#x822C;&#x8D85;&#x8FC7;100&#x89C6;&#x4E3A;&#x5F39;&#x51FA;</span><br><span class=\"line\">                \t//&#x663E;&#x793A;&#x64CD;&#x4F5C;</span><br><span class=\"line\">                }else{</span><br><span class=\"line\">                \t//&#x9690;&#x85CF;&#x64CD;&#x4F5C;</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        });</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x81EA;&#x5B9A;&#x4E49;&#x5916;&#x90E8;&#x7C7B;\"><a href=\"#&#x81EA;&#x5B9A;&#x4E49;&#x5916;&#x90E8;&#x7C7B;\" class=\"headerlink\" title=\"&#x81EA;&#x5B9A;&#x4E49;&#x5916;&#x90E8;&#x7C7B;\"></a>&#x81EA;&#x5B9A;&#x4E49;&#x5916;&#x90E8;&#x7C7B;</h2><p>&#x5176;&#x5B9E;&#x4F7F;&#x7528;&#x8BE5;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x5E03;&#x5C40;&#x7EE7;&#x627F;<code>Android</code>&#x57FA;&#x672C;&#x5E03;&#x5C40;&#x63A7;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x5176;&#x4E2D;&#x91CD;&#x5199;<code>onMeasure</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x64CD;&#x4F5C;&#x4E0E;&#x524D;&#x9762;&#x7684;&#x57FA;&#x672C;&#x7C7B;&#x4F3C;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {</span><br><span class=\"line\">        int height = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class=\"line\">        Activity activity = (Activity) getContext();</span><br><span class=\"line\">        Rect rect = new Rect();</span><br><span class=\"line\">        activity.getWindow().getDecorView().getWindowVisibleDisplayFrame(rect);</span><br><span class=\"line\">        int statusBarHeight = rect.top;</span><br><span class=\"line\">        int screenHeight = activity.getWindowManager().getDefaultDisplay().getHeight();</span><br><span class=\"line\">        int diff = (screenHeight - statusBarHeight) - height;</span><br><span class=\"line\">        if (listener != null) {</span><br><span class=\"line\">            listener.onSoftKeyboardShown(diff &gt; 100);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x81EA;&#x5B9A;&#x4E49;&#x4E0E;&#x5B9E;&#x73B0;&#x4E86;&#x76D1;&#x542C;&#x63A5;&#x53E3;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface Listener {</span><br><span class=\"line\">        void onSoftKeyboardShown(boolean isShowing);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    private Listener listener;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setListener(Listener listener) {</span><br><span class=\"line\">        this.listener = listener;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x5728;xml&#x4E2D;&#x4F7F;&#x7528;&#x8BE5;&#x81EA;&#x5B9A;&#x4E49;&#x5E03;&#x5C40;&#xFF0C;&#x76EE;&#x6807;&#x7C7B;&#x4E2D;&#x7ED1;&#x5B9A;&#x8C03;&#x7528;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RelativeLayoutThatDetectsSoftKeyboard chatLayout = (RelativeLayoutThatDetectsSoftKeyboard) findViewById(R.id.chat_bottm);</span><br><span class=\"line\">        chatLayout.setListener(this);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    public void onSoftKeyboardShown(boolean isShowing) {</span><br><span class=\"line\">        if (isShowing)</span><br><span class=\"line\">            //&#x663E;&#x793A;&#x64CD;&#x4F5C;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;&#x7684;&#x597D;&#x5904;&#x5C31;&#x662F;&#x903B;&#x8F91;&#x5BF9;&#x5916;&#x5C01;&#x88C5;&#x3001;&#x89E3;&#x8026;&#x4E86;&#xFF0C;&#x53EA;&#x8981;&#x6839;&#x636E;<code>isShowing</code>&#x7684;&#x503C;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002;</p>\n<blockquote>\n<p><em>&#x597D;&#x4E86;&#xFF0C;&#x6211;&#x53EA;&#x662F;&#x5927;&#x81EA;&#x7136;&#x7684;&#x642C;&#x8FD0;&#x5DE5;&#xFF0C;&#x5230;&#x5E95;&#x8981;&#x7528;&#x54EA;&#x79CD;&#x5C31;&#x81EA;&#x5DF1;&#x89C6;&#x60C5;&#x51B5;&#x800C;&#x5B9A;&#x5427;</em></p>\n</blockquote>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["软键盘"]},{"title":"RecyclerView item点击你真的会么","url":"https://www.rousetime.com/2016/05/22/RecyclerView-item点击你真的会么/","content":"<p>&#x73B0;&#x5728;<code>RecyclerView</code>&#x90FD;&#x4F7F;&#x7528;&#x7684;&#x76F8;&#x5BF9;&#x9891;&#x7E41;&#x4E86;&#xFF0C;&#x5728;&#x5F00;&#x59CB;&#x4F7F;&#x7528;<code>RecyclerView</code>&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5927;&#x5BB6;&#x90FD;&#x5E94;&#x8BE5;&#x90FD;&#x9047;&#x5230;&#x8FC7;<code>RecyclerView</code>&#x5C45;&#x7136;&#x6CA1;&#x6709;&#x5E2E;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;<code>Item</code>&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#xFF0C;&#x987F;&#x65F6;&#x611F;&#x89C9;&#x4E0D;&#x77E5;&#x6240;&#x63AA;&#x4E86;&#x3002;&#x67E5;&#x9605;<code>API</code>&#x53D1;&#x73B0;&#x786E;&#x5B9E;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;&#x8BE5;&#x4E8B;&#x4EF6;&#xFF0C;&#x6700;&#x540E;&#x7ECF;&#x8FC7;&#x82E6;&#x601D;&#x51A5;&#x60F3;&#xFF0C;&#x8FD8;&#x662F;&#x6A21;&#x4EFF;<code>ListView</code>&#x7684;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#xFF0C;&#x5728;<code>onCreateViewHolder</code>&#x4E2D;&#x4E3A;&#x6BCF;&#x4E2A;<code>Item</code>&#x6DFB;&#x52A0;<code>View</code>&#x7684;<code>setOnClickListener</code>&#x4E8B;&#x4EF6;&#xFF0C;&#x5236;&#x5B9A;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x5728;&#x4E3B;&#x51FD;&#x6570;&#x4E2D;&#x8C03;&#x7528;&#x3002;&#x77AC;&#x95F4;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x4E00;&#x4E0B;&#x611F;&#x89C9;<code>so easy</code>&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x771F;&#x7684;&#x597D;&#x5417;&#xFF1F;&#x6211;&#x4EEC;&#x60F3;&#x60F3;&#x4E00;&#x65E6;<code>Item</code>&#x7684;&#x6570;&#x91CF;&#x66B4;&#x589E;&#x8FD9;&#x53EF;&#x4F1A;&#x5F71;&#x54CD;&#x6027;&#x80FD;&#x554A;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x60F3;&#x51FA;&#x522B;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x4EE3;&#x66FF;&#x5B83;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x5C31;&#x4ECB;&#x7ECD;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x9AD8;&#x5927;&#x4E0A;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x6559;&#x4F60;&#x5982;&#x4F55;&#x771F;&#x6B63;&#x7684;&#x4E3A;<code>RecyclerView</code>&#x7684;<code>Item</code>&#x6DFB;&#x52A0;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x3002;</p>\n<h2 id=\"&#x539F;&#x7406;\"><a href=\"#&#x539F;&#x7406;\" class=\"headerlink\" title=\"&#x539F;&#x7406;\"></a>&#x539F;&#x7406;</h2><p>&#x867D;&#x7136;<code>RecyclerView</code>&#x6CA1;&#x6709;&#x5E2E;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x76F8;&#x5E94;&#x7684;&#x70B9;&#x51FB;&#x76D1;&#x542C;&#x4E8B;&#x4EF6;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x67E5;&#x8BE2;&#x5B83;&#x7684;<code>API</code>&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x6709;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x5E2E;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x5C31;&#x662F;<code>addOnItemTouchListener</code>&#x89E6;&#x6478;&#x5B9E;&#x4E8B;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x501F;&#x52A9;&#x8BE5;&#x76D1;&#x542C;&#x6765;&#x6839;&#x636E;&#x6211;&#x4EEC;&#x7684;&#x89E6;&#x6478;&#x53CD;&#x5E94;&#x5E2E;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x76F8;&#x540C;&#x7684;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x6548;&#x679C;&#x3002;&#x5F53;&#x7136;&#x5176;&#x4E2D;&#x6211;&#x4EEC;&#x8FD8;&#x8981;&#x501F;&#x52A9;<code>GestureDetectorCompat</code>&#x6839;&#x636E;&#x89E6;&#x6478;&#x624B;&#x52BF;&#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x3002;</p>\n<h2 id=\"addOnItemTouchListener\"><a href=\"#addOnItemTouchListener\" class=\"headerlink\" title=\"addOnItemTouchListener\"></a>addOnItemTouchListener</h2><p>&#x4E3A;<code>RecyclerView</code>&#x6DFB;&#x52A0;<code>addOnItemTouchListener</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">recyclerView.addOnItemTouchListener(new OnItemTouchListener(recyclerView) {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onItemClick(RecyclerView.ViewHolder vh) {</span><br><span class=\"line\">            //item &#x64CD;&#x4F5C;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        });</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x8981;&#x81EA;&#x5B9A;&#x4E49;&#x53BB;&#x5B9E;&#x73B0;<code>RecyclerView.OnItemTouchListener</code>&#x63A5;&#x53E3;</p>\n<h3 id=\"&#x5B9E;&#x73B0;OnItemTouchListener\"><a href=\"#&#x5B9E;&#x73B0;OnItemTouchListener\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;OnItemTouchListener\"></a>&#x5B9E;&#x73B0;OnItemTouchListener</h3><p>&#x5728;&#x5B9E;&#x73B0;&#x8BE5;&#x63A5;&#x53E3;&#x65F6;&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0;&#x6709;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;</p>\n<ul>\n<li>onTouchEvent</li>\n<li>onInterceptTouchEvent</li>\n<li>onRequestDisallowInterceptTouchEvent</li>\n</ul>\n<p>&#x7B2C;&#x4E00;&#x4E2A;&#x662F;&#x5904;&#x7406;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;&#x7684;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x662F;&#x62E6;&#x622A;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;&#x7684;&#xFF0C;&#x7B2C;&#x4E09;&#x4E2A;&#x662F;&#x5904;&#x7406;&#x89E6;&#x6478;&#x51B2;&#x7A81;&#x7684;&#x3002;&#x7B2C;&#x4E09;&#x4E2A;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x7528;&#x4E0D;&#x5230;&#xFF0C;&#x4E0D;&#x7528;&#x7BA1;&#xFF0C;&#x81F3;&#x4E8E;&#x524D;&#x4E24;&#x4E2A;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x5411;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x7528;&#x5230;&#x7684;<code>GestureDetectorCompat</code>&#x4F20;&#x9012;<code>MotionEvent</code>&#x4E3A;&#x4E86;&#x83B7;&#x53D6;&#x89E6;&#x6478;&#x7684;&#x5750;&#x6807;,&#x6700;&#x540E;&#x518D;&#x5B9A;&#x4E49;&#x4E2A;<code>abstract</code>&#x56DE;&#x8C03;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public abstract class OnItemTouchListener implements RecyclerView.OnItemTouchListener {</span><br><span class=\"line\"></span><br><span class=\"line\">    private GestureDetectorCompat mGestureDetectorCompat;</span><br><span class=\"line\">    private RecyclerView mRecyclerView;</span><br><span class=\"line\"></span><br><span class=\"line\">    public OnItemTouchListener(RecyclerView recyclerView) {</span><br><span class=\"line\">        mRecyclerView = recyclerView;</span><br><span class=\"line\">        mGestureDetectorCompat = new GestureDetectorCompat(mRecyclerView.getContext(),</span><br><span class=\"line\">                new MyGestureListener());</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void onTouchEvent(RecyclerView rv, MotionEvent e) {</span><br><span class=\"line\">        mGestureDetectorCompat.onTouchEvent(e);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public boolean onInterceptTouchEvent(RecyclerView rv, MotionEvent e) {</span><br><span class=\"line\">        mGestureDetectorCompat.onTouchEvent(e);</span><br><span class=\"line\">        return false;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void onRequestDisallowInterceptTouchEvent(boolean disallowIntercept) {</span><br><span class=\"line\"></span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public abstract void onItemClick(RecyclerView.ViewHolder vh);</span><br></pre></td></tr></table></figure>\n<h2 id=\"GestureDetectorCompat\"><a href=\"#GestureDetectorCompat\" class=\"headerlink\" title=\"GestureDetectorCompat\"></a>GestureDetectorCompat</h2><p>&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x5B9E;&#x4F8B;&#x5316;&#x4E86;<code>GestureDetectorCompat</code>&#x7C7B;&#x5176;&#x4E2D;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x624B;&#x52BF;&#x76D1;&#x542C;<code>OnGestureListener</code>&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x4E0D;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5B83;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5B83;&#x7684;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5C01;&#x88C5;&#x7C7B;<code>SimpleOnGestureListener</code>&#x5B83;&#x91CC;&#x9762;&#x5B9E;&#x73B0;&#x7684;&#x90FD;&#x7684;&#x7A7A;&#x64CD;&#x4F5C;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7279;&#x5B9A;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x6267;&#x884C;&#x6211;&#x4EEC;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>\n<h3 id=\"SimpleOnGestureListener\"><a href=\"#SimpleOnGestureListener\" class=\"headerlink\" title=\"SimpleOnGestureListener\"></a>SimpleOnGestureListener</h3><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x5B9E;&#x73B0;&#x5176;&#x4E2D;&#x7684;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;</p>\n<ul>\n<li>onSingleTapUp</li>\n<li>onLongPress</li>\n</ul>\n<p>&#x5176;&#x4E2D;&#x7B2C;&#x4E00;&#x4E2A;&#x662F;&#x7B80;&#x5355;&#x7684;&#x70B9;&#x51FB;&#x5C4F;&#x5E55;&#x65F6;&#x6267;&#x884C;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x662F;&#x957F;&#x6309;&#x5C4F;&#x5E55;&#x65F6;&#x6267;&#x884C;&#x3002;&#x6240;&#x4EE5;&#x6839;&#x636E;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x4ECE;&#x524D;&#x9762;<code>OnItemTouchListener</code>&#x4F20;&#x8FC7;&#x6765;&#x7684;<code>MotionEvent</code>&#x83B7;&#x53D6;&#x70B9;&#x51FB;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x6839;&#x636E;&#x4F4D;&#x7F6E;&#x4F7F;&#x7528;<code>RecyclerView</code>&#x7684;<code>findChildViewUnder</code>&#x83B7;&#x53D6;&#x5230;&#x70B9;&#x51FB;&#x7684;<code>ItemView</code>,&#x518D;&#x901A;&#x8FC7;<code>RecyclerView</code>&#x7684;<code>getChildViewHolder</code>&#x83B7;&#x53D6;<code>ItemView</code>&#x7684;<code>ViewHolder</code>&#x6700;&#x540E;&#x518D;&#x8C03;&#x7528;<code>OnItemClick</code>&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private class MyGestureListener extends GestureDetector.SimpleOnGestureListener {</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public boolean onSingleTapUp(MotionEvent e) {</span><br><span class=\"line\">            View childe = mRecyclerView.findChildViewUnder(e.getX(), e.getY());</span><br><span class=\"line\">            if (childe != null) {</span><br><span class=\"line\">                RecyclerView.ViewHolder VH = mRecyclerView.getChildViewHolder(childe);</span><br><span class=\"line\">                onItemClick(VH);</span><br><span class=\"line\">            }</span><br><span class=\"line\">            return true;</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void onLongPress(MotionEvent e) {</span><br><span class=\"line\">            View childe = mRecyclerView.findChildViewUnder(e.getX(), e.getY());</span><br><span class=\"line\">            if (childe != null) {</span><br><span class=\"line\">                RecyclerView.ViewHolder VH = mRecyclerView.getChildViewHolder(childe);</span><br><span class=\"line\">                onItemClick(VH);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x597D;&#x4E86;&#x6574;&#x4E2A;&#x7684;&#x5B9E;&#x73B0;&#x8FC7;&#x7A0B;&#x5C31;&#x662F;&#x8FD9;&#x4E9B;&#xFF0C;&#x770B;&#x4E86;&#x4EE5;&#x540E;&#x662F;&#x4E0D;&#x662F;&#x611F;&#x89C9;&#x66F4;&#x9AD8;&#x5927;&#x4E0A;&#x4E86;&#x5462;&#x3002;&#x5982;&#x679C;&#x5BF9;<code>RecyclerView</code>&#x8FD8;&#x4E0D;&#x662F;&#x5F88;&#x719F;&#x6089;&#x7684;&#x53EF;&#x4EE5;&#x5148;&#x770B;&#x6211;&#x524D;&#x9762;&#x7684;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;<a href=\"http://idisfkj.github.io/2016/04/02/RecyclerView%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/\" target=\"_blank\" rel=\"noopener\">RecyclerView&#x6DF1;&#x5165;&#x6D45;&#x51FA;</a></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["RecyclerView"]},{"title":"Android高仿微信之mvp实现(四)","url":"https://www.rousetime.com/2016/05/15/Android高仿微信之mvp实现-四/","content":"<p>&#x524D;&#x9762;&#x628A;&#x804A;&#x5929;&#x7684;&#x57FA;&#x672C;&#x529F;&#x80FD;&#x90FD;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x6700;&#x8FD1;&#x6709;&#x70B9;&#x5FD9;&#xFF0C;&#x56E0;&#x4E3A;&#x5FEB;&#x5230;&#x5B66;&#x671F;&#x672B;&#x4E86;&#xFF0C;&#x8003;&#x8BD5;&#x5C31;&#x6765;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x540E;&#x9762;&#x53EF;&#x80FD;&#x4F1A;&#x6162;&#x70B9;&#x3002;&#x5927;&#x5BB6;&#x90FD;&#x53CD;&#x6620;&#x6CA1;&#x6709;&#x6D88;&#x606F;&#x63D0;&#x9192;&#xFF0C;&#x6240;&#x4EE5;&#x62BD;&#x4E86;&#x70B9;&#x65F6;&#x95F4;&#x628A;&#x804A;&#x5929;&#x7684;&#x63D0;&#x9192;&#x7B80;&#x5355;&#x7684;&#x5B9E;&#x73B0;&#x4E86;&#x4E0B;&#xFF0C;&#x4E0B;&#x9762;&#x7B80;&#x5355;&#x7684;&#x4ECB;&#x7ECD;&#x4E0B;&#x3002;</p>\n<h1 id=\"&#x539F;&#x7406;\"><a href=\"#&#x539F;&#x7406;\" class=\"headerlink\" title=\"&#x539F;&#x7406;\"></a>&#x539F;&#x7406;</h1><p>&#x6211;&#x8FD9;&#x91CC;&#x7528;&#x5230;&#x5F97;&#x539F;&#x7406;&#x4E3B;&#x8981;&#x5C31;&#x4E24;&#x4E2A;&#x77E5;&#x8BC6;&#x70B9;</p>\n<ul>\n<li>Notification</li>\n<li>BadgeView</li>\n</ul>\n<p>&#x53EA;&#x8981;&#x4F60;&#x89E3;&#x51B3;&#x4E86;&#x8FD9;&#x4E24;&#x9879;&#x4EE5;&#x540E;&#x7684;&#x6D88;&#x606F;&#x63D0;&#x9192;&#x795E;&#x9A6C;&#x7684;&#x90FD;&#x80FD;&#x8F7B;&#x677E;&#x641E;&#x5B9A;&#x3002;&#x9996;&#x5148;&#x6765;&#x89E3;&#x91CA;&#x4E0B;&#x4ED6;&#x4EEC;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x5BF9;&#x4E8E;<strong>Notification</strong>&#x6211;&#x60F3;&#x5E94;&#x8BE5;&#x5F88;&#x591A;&#x90FD;&#x63A5;&#x89E6;&#x4E86;&#xFF0C;&#x4F46;&#x8FD8;&#x662F;&#x7B80;&#x5355;&#x7684;&#x8BF4;&#x4E0B;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x5B83;&#x5C31;&#x662F;&#x5B9E;&#x73B0;&#x6211;&#x4EEC;&#x65E5;&#x5E38;&#x770B;&#x5230;&#x7684;&#x6D88;&#x606F;&#x901A;&#x77E5;&#x6846;&#x7684;&#x51FA;&#x73B0;&#xFF0C;&#x4E0D;&#x8FC7;&#x5176;&#x4E2D;&#x7684;&#x4F7F;&#x7528;&#x8981;&#x6CE8;&#x610F;&#x51E0;&#x70B9;&#xFF0C;&#x4E0B;&#x9762;&#x4F1A;&#x8BE6;&#x7EC6;&#x6307;&#x51FA;&#x3002;&#x81F3;&#x4E8E;<strong>BadgeView</strong>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x5E93;&#xFF0C;&#x5B83;&#x7684;&#x529F;&#x80FD;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x65E5;&#x5E38;&#x770B;&#x5230;&#x7684;&#x5728;&#x5E94;&#x7528;&#x4E2D;&#x663E;&#x793A;&#x7684;&#x672A;&#x8BFB;&#x6D88;&#x606F;&#x6570;&#x3002;</p>\n<blockquote>\n<p><em>&#x539F;&#x7406;&#x4ECB;&#x7ECD;&#x5B8C;&#x4E86;&#x4E0B;&#x9762;&#x6765;&#x770B;&#x770B;&#x5B9E;&#x73B0;</em></p>\n</blockquote>\n<h2 id=\"&#x901A;&#x77E5;&#x680F;&#x7684;&#x663E;&#x793A;\"><a href=\"#&#x901A;&#x77E5;&#x680F;&#x7684;&#x663E;&#x793A;\" class=\"headerlink\" title=\"&#x901A;&#x77E5;&#x680F;&#x7684;&#x663E;&#x793A;\"></a>&#x901A;&#x77E5;&#x680F;&#x7684;&#x663E;&#x793A;</h2><p>&#x8FD9;&#x91CC;&#x9664;&#x4E86;<strong>Notification</strong>&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x662F;<strong>PendingIntent</strong>&#xFF08;&#x5EF6;&#x8FDF;&#x610F;&#x56FE;&#xFF09;&#x5C31;&#x662F;&#x5B9E;&#x73B0;&#x70B9;&#x51FB;&#x901A;&#x77E5;&#x680F;&#x540E;&#x7684;&#x64CD;&#x4F5C;</p>\n<h3 id=\"&#x5EF6;&#x8FDF;&#x610F;&#x56FE;PendingIntent\"><a href=\"#&#x5EF6;&#x8FDF;&#x610F;&#x56FE;PendingIntent\" class=\"headerlink\" title=\"&#x5EF6;&#x8FDF;&#x610F;&#x56FE;PendingIntent\"></a>&#x5EF6;&#x8FDF;&#x610F;&#x56FE;PendingIntent</h3><p>&#x65E2;&#x7136;&#x662F;&#x610F;&#x56FE;&#x81EA;&#x7136;&#x8981;&#x4F7F;&#x7528;Intent&#x6307;&#x5B9A;&#x6211;&#x4EEC;&#x70B9;&#x51FB;&#x540E;&#x7684;&#x5E94;&#x7528;&#x64CD;&#x4F5C;</p>\n<h4 id=\"&#x914D;&#x7F6E;Intent\"><a href=\"#&#x914D;&#x7F6E;Intent\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;Intent\"></a>&#x914D;&#x7F6E;Intent</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Intent intent = new Intent(App.getAppContext(), MainActivity.class);</span><br><span class=\"line\">                //&#x9632;&#x6B62;&#x5F00;&#x542F;&#x91CD;&#x590D;&#x7684;Activity</span><br><span class=\"line\">                intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);</span><br><span class=\"line\">                Bundle bundle = new Bundle();</span><br><span class=\"line\">                //&#x9632;&#x6B62;pendingIntent&#x76F8;&#x540C;</span><br><span class=\"line\">                intent.setData(Uri.parse(&quot;message://&quot; + regId));</span><br><span class=\"line\">                bundle.putInt(&quot;_id&quot;, _id);</span><br><span class=\"line\">                intent.putExtras(bundle);</span><br></pre></td></tr></table></figure>\n<p>&#x6211;&#x8FD9;&#x91CC;&#x662F;&#x70B9;&#x51FB;&#x90FD;&#x81EA;&#x52A8;&#x8DF3;&#x8F6C;&#x5230;&#x4E3B;&#x754C;&#x9762;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x4E3B;&#x754C;&#x9762;&#x505A;&#x76F8;&#x5E94;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#x8981;&#x6CE8;&#x610F;&#x4E0B;&#x6211;&#x524D;&#x9762;&#x8BF4;&#x7684;&#x6CE8;&#x610F;&#x70B9;&#x3002;</p>\n<h5 id=\"&#x6CE8;&#x610F;&#x70B9;\"><a href=\"#&#x6CE8;&#x610F;&#x70B9;\" class=\"headerlink\" title=\"&#x6CE8;&#x610F;&#x70B9;\"></a>&#x6CE8;&#x610F;&#x70B9;</h5><h6 id=\"&#x7B2C;&#x4E00;&#x70B9;\"><a href=\"#&#x7B2C;&#x4E00;&#x70B9;\" class=\"headerlink\" title=\"&#x7B2C;&#x4E00;&#x70B9;\"></a>&#x7B2C;&#x4E00;&#x70B9;</h6><p><code>intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);</code></p>\n<p>&#x8FD9;&#x53E5;&#x4EE3;&#x7801;&#x662F;&#x9632;&#x6B62;&#x6211;&#x4EEC;&#x70B9;&#x51FB;&#x901A;&#x77E5;&#x680F;&#x540E;&#x5F00;&#x542F;&#x6307;&#x5B9A;&#x7684;&#x754C;&#x9762;&#xFF0C;&#x540E;&#x9000;&#x6808;&#x65F6;&#x754C;&#x9762;&#x91CD;&#x590D;&#x3002;&#x5982;&#x679C;&#x4F60;&#x6CA1;&#x6709;&#x6E05;&#x7A7A;&#x6808;&#xFF0C;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x91CD;&#x590D;&#x521B;&#x5EFA;&#x7684;&#x73B0;&#x8C61;&#x3002;&#x53EF;&#x80FD;&#x8FD9;&#x91CC;&#x6709;&#x4EBA;&#x4F1A;&#x8BF4;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<strong>launchMode</strong>&#x7684;&#x6A21;&#x5F0F;&#xFF0C;&#x6CA1;&#x9519;&#x5F53;&#x6211;&#x4EEC;&#x4F7F;&#x7528;signalTop&#x6216;&#x8005;&#x5176;&#x5B83;&#x7684;&#x5982;<strong>singleTask</strong>&#x80FD;&#x89E3;&#x51B3;&#x91CD;&#x590D;&#x754C;&#x9762;&#x7684;&#x521B;&#x5EFA;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x91CC;&#x6709;&#x4E2A;&#x95EE;&#x9898;&#x5982;<strong>signalTop</strong>&#x5F53;&#x5728;&#x6808;&#x9876;&#x662F;&#x5E76;&#x4E0D;&#x4F1A;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x8BE5;<strong>Activity</strong>&#x800C;&#x662F;&#x4F1A;&#x76F4;&#x63A5;&#x590D;&#x7528;&#x539F;&#x6765;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x6837;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#x9875;&#x9762;&#x4E0D;&#x4F1A;&#x66F4;&#x65B0;&#x672A;&#x8BFB;&#x6D88;&#x606F;&#x6570;&#x3002;</p>\n<h6 id=\"&#x7B2C;&#x4E8C;&#x70B9;\"><a href=\"#&#x7B2C;&#x4E8C;&#x70B9;\" class=\"headerlink\" title=\"&#x7B2C;&#x4E8C;&#x70B9;\"></a>&#x7B2C;&#x4E8C;&#x70B9;</h6><p><code>intent.setData(Uri.parse(&quot;message://&quot; + regId));</code><br>&#x4E3A;<strong>intent</strong>&#x8BBE;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x6570;&#x636E;&#x6E90;&#xFF0C;&#x867D;&#x7136;<strong>PendingIntent</strong>&#x63D0;&#x4F9B;&#x4E86;&#x56DB;&#x4E2A;&#x8FD9;&#x65B9;&#x9762;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x4F46;&#x90FD;&#x662F;&#x9488;&#x5BF9;&#x76F8;&#x540C;&#x5BF9;&#x8C61;&#x7684;&#x5EF6;&#x8FDF;&#x610F;&#x56FE;</p>\n<ul>\n<li>FLAG_ONE_SHOT <code>&#x610F;&#x601D;&#x5C31;&#x662F;&#x4F60;&#x8BBE;&#x7F6E;&#x7684;&#x5EF6;&#x8FDF;&#x610F;&#x56FE;&#x53EA;&#x53EF;&#x4F7F;&#x7528;&#x4E00;&#x6B21;&#xFF0C;&#x8BF4;&#x660E;&#x4EE5;&#x540E;&#x901A;&#x8FC7;&#x5B83;&#x7684;&#x90FD;&#x4E0D;&#x4F1A;&#x5B9E;&#x73B0;</code></li>\n<li>FLAG_NO_CREATE <code>&#x8FD9;&#x4E2A;&#x66F4;&#x7B80;&#x5355;&#x4E86;&#x5C31;&#x662F;&#x4E0D;&#x5B58;&#x5728;&#x4E5F;&#x5C31;&#x4E0D;&#x4F1A;&#x521B;&#x5EFA;&#x4E86;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;null</code> </li>\n<li>FLAG_CANCEL_CURRENT <code>&#x8FD9;&#x4E2A;&#x5C31;&#x662F;&#x5B58;&#x5728;&#x5C31;&#x53D6;&#x6D88;&#x539F;&#x6765;&#x7684;&#xFF0C;&#x4F7F;&#x7528;&#x65B0;&#x7684;&#xFF0C;&#x65B0;&#x7684;&#x53EA;&#x6539;&#x53D8;&#x8981;&#x4F20;&#x9012;&#x7684;&#x6570;&#x636E;</code></li>\n<li>FLAG_UPDATE_CURRENT <code>&#x8DDF;&#x4E0A;&#x9762;&#x7684;&#x76F8;&#x5DEE;&#x4E0D;&#x5927;&#xFF0C;&#x5B83;&#x4F1A;&#x66F4;&#x65B0;&#x539F;&#x6765;&#x7684;&#x6570;&#x636E;</code></li>\n</ul>\n<p>&#x4E0A;&#x9762;&#x7684;&#x5BF9;&#x8981;&#x5F00;&#x542F;&#x4E0D;&#x540C;&#x7684;&#x754C;&#x9762;&#x90FD;&#x6CA1;&#x6709;&#x4F5C;&#x7528;&#xFF0C;&#x90FD;&#x4F1A;&#x8986;&#x76D6;&#x539F;&#x6765;&#x7684;&#x610F;&#x56FE;&#xFF0C;&#x5BFC;&#x81F4;&#x4E0D;&#x540C;&#x7684;&#x4EBA;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x65F6;&#xFF0C;&#x70B9;&#x51FB;&#x901A;&#x77E5;&#x680F;&#x7684;&#x4E0D;&#x540C;&#x901A;&#x77E5;&#x663E;&#x793A;&#x540C;&#x4E00;&#x4E2A;&#x804A;&#x5929;&#x754C;&#x9762;&#x3002;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;<strong>regId</strong>&#x505A;&#x552F;&#x4E00;&#x6807;&#x8BC6;&#x5C31;&#x80FD;&#x6D88;&#x9664;&#x8FD9;&#x65B9;&#x9762;&#x7684;&#x95EE;&#x9898;&#x3002;</p>\n<h4 id=\"&#x521B;&#x5EFA;PendingIntent\"><a href=\"#&#x521B;&#x5EFA;PendingIntent\" class=\"headerlink\" title=\"&#x521B;&#x5EFA;PendingIntent\"></a>&#x521B;&#x5EFA;PendingIntent</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PendingIntent pi = PendingIntent.getActivity(App.getAppContext(), 0, intent, PendingIntent.FLAG_CANCEL_CURRENT);</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x901A;&#x77E5;Notification&#x6784;&#x5EFA;\"><a href=\"#&#x901A;&#x77E5;Notification&#x6784;&#x5EFA;\" class=\"headerlink\" title=\"&#x901A;&#x77E5;Notification&#x6784;&#x5EFA;\"></a>&#x901A;&#x77E5;Notification&#x6784;&#x5EFA;</h3><p>&#x8FD9;&#x91CC;&#x6211;&#x5C31;&#x76F4;&#x63A5;&#x8D34;&#x4EE3;&#x7801;&#x4E86;&#x90FD;&#x662F;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x7684;&#x4E86;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Notification notification = new Notification.Builder(App.getAppContext())</span><br><span class=\"line\">                        .setSmallIcon(R.drawable.icon)</span><br><span class=\"line\">                        .setAutoCancel(true)</span><br><span class=\"line\">                        .setTicker(&quot;&#x9AD8;&#x4EFF;&#x5FAE;&#x4FE1;&#x6709;&#x65B0;&#x6D88;&#x606F;&quot;)</span><br><span class=\"line\">                        .setContentTitle(userName)</span><br><span class=\"line\">                        .setContentText(&quot;[&quot; + unReadNum + &quot;&#x6761;] &quot; + rMessage)</span><br><span class=\"line\">                        .setDefaults(Notification.DEFAULT_SOUND | Notification.DEFAULT_LIGHTS)</span><br><span class=\"line\">                        .setContentIntent(pi)</span><br><span class=\"line\">                        .setWhen(System.currentTimeMillis())</span><br><span class=\"line\">                        .build();</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x53D1;&#x9001;&#x901A;&#x77E5;\"><a href=\"#&#x53D1;&#x9001;&#x901A;&#x77E5;\" class=\"headerlink\" title=\"&#x53D1;&#x9001;&#x901A;&#x77E5;\"></a>&#x53D1;&#x9001;&#x901A;&#x77E5;</h3><p>&#x83B7;&#x53D6;&#x7CFB;&#x7EDF;&#x901A;&#x77E5;&#x7BA1;&#x7406;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">manager = (NotificationManager) App.getAppContext().getSystemService(Context.NOTIFICATION_SERVICE);</span><br></pre></td></tr></table></figure>\n<p>&#x53D1;&#x9001;&#x901A;&#x77E5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">manager.notify(_id, notification);</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x901A;&#x77E5;&#x680F;&#x7684;&#x6784;&#x5EFA;&#x5C31;&#x5B8C;&#x7F8E;&#x7ED3;&#x675F;&#x4E86;</em></p>\n</blockquote>\n<h2 id=\"&#x6D88;&#x606F;&#x6570;&#x7684;&#x663E;&#x793A;\"><a href=\"#&#x6D88;&#x606F;&#x6570;&#x7684;&#x663E;&#x793A;\" class=\"headerlink\" title=\"&#x6D88;&#x606F;&#x6570;&#x7684;&#x663E;&#x793A;\"></a>&#x6D88;&#x606F;&#x6570;&#x7684;&#x663E;&#x793A;</h2><p>&#x65E2;&#x7136;&#x524D;&#x9762;&#x90FD;&#x8BF4;&#x4E86;&#x501F;&#x52A9;&#x4E86;&#x5F00;&#x6E90;&#x5E93;&#xFF0C;&#x6240;&#x4EE5;&#x5B9E;&#x73B0;&#x5C31;&#x76F8;&#x5BF9;&#x6765;&#x8BF4;&#x5C31;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x628A;&#x5B83;&#x603B;&#x7ED3;&#x6210;&#x4E09;&#x6B65;</p>\n<h3 id=\"&#x521B;&#x5EFA;BadgeView&#x5B9E;&#x4F8B;\"><a href=\"#&#x521B;&#x5EFA;BadgeView&#x5B9E;&#x4F8B;\" class=\"headerlink\" title=\"&#x521B;&#x5EFA;BadgeView&#x5B9E;&#x4F8B;\"></a>&#x521B;&#x5EFA;<strong>BadgeView</strong>&#x5B9E;&#x4F8B;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BadgeView badgeView = new BadgeView(context, view);</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;<strong>view</strong>&#x4EE3;&#x8868;&#x4F60;&#x8981;&#x4F9D;&#x9644;&#x7684;&#x89C6;&#x56FE;</p>\n<h3 id=\"&#x6784;&#x5EFA;&#x6587;&#x672C;\"><a href=\"#&#x6784;&#x5EFA;&#x6587;&#x672C;\" class=\"headerlink\" title=\"&#x6784;&#x5EFA;&#x6587;&#x672C;\"></a>&#x6784;&#x5EFA;&#x6587;&#x672C;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">badgeView.setTextColor(Color.WHITE);</span><br><span class=\"line\">        badgeView.setText(textValue);</span><br><span class=\"line\">        badgeView.setBackground(context.getResources().getDrawable(R.drawable.dot_bg));</span><br><span class=\"line\">        badgeView.setTextSize(12);</span><br><span class=\"line\">        badgeView.setBadgePosition(BadgeView.POSITION_TOP_RIGHT);</span><br><span class=\"line\">        badgeView.setBadgeMargin(0, 0);</span><br></pre></td></tr></table></figure>\n<p>&#x4E0A;&#x9762;&#x7684;&#x80AF;&#x5B9A;&#x6CA1;&#x95EE;&#x9898;&#x5427;&#xFF0C;&#x7B80;&#x5355;&#x660E;&#x4E86;&#xFF0C;&#x663E;&#x793A;&#x4F4D;&#x7F6E;<code>badgeView.setBadgePosition</code>&#x9ED8;&#x8BA4;&#x662F;&#x53F3;&#x4E0A;&#x89D2;&#xFF0C;&#x4F46;&#x6211;&#x611F;&#x89C9;&#x6548;&#x679C;&#x4E0D;&#x660E;&#x663E;&#xFF0C;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x8981;&#x5F97;&#x6548;&#x679C;&#xFF0C;&#x6CA1;&#x6709;&#x50CF;&#x5FAE;&#x4FE1;&#x90A3;&#x6837;&#x89C6;&#x56FE;&#x51FA;&#x53BB;&#x4E86;&#x90E8;&#x5206;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x90FD;&#x540E;&#x9762;&#x770B;&#x4E86;&#x4E0B;&#x6E90;&#x7801;&#xFF0C;&#x53D1;&#x73B0;&#x4E86;<code>badgeView.setBadgeMargin(0, 0);</code>&#x80FD;&#x4F7F;&#x8BE5;&#x6548;&#x679C;&#x660E;&#x663E;&#x4E9B;&#x3002;</p>\n<h3 id=\"&#x663E;&#x793A;\"><a href=\"#&#x663E;&#x793A;\" class=\"headerlink\" title=\"&#x663E;&#x793A;\"></a>&#x663E;&#x793A;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">badgeView.show();</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x5230;&#x8FD9;&#x91CC;&#x6240;&#x6709;&#x7684;&#x6D88;&#x606F;&#x63D0;&#x9192;&#x529F;&#x80FD;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x6700;&#x540E;&#x770B;&#x4E0B;&#x6548;&#x679C;</em></p>\n</blockquote>\n<h1 id=\"&#x6548;&#x679C;&#x56FE;\"><a href=\"#&#x6548;&#x679C;&#x56FE;\" class=\"headerlink\" title=\"&#x6548;&#x679C;&#x56FE;\"></a>&#x6548;&#x679C;&#x56FE;</h1><p><img src=\"/2016/05/15/Android&#x9AD8;&#x4EFF;&#x5FAE;&#x4FE1;&#x4E4B;mvp&#x5B9E;&#x73B0;-&#x56DB;/1.gif\" alt=\"&#x6548;&#x679C;\"></p>\n<h1 id=\"&#x4E00;&#x7CFB;&#x5217;&#x6587;&#x7AE0;\"><a href=\"#&#x4E00;&#x7CFB;&#x5217;&#x6587;&#x7AE0;\" class=\"headerlink\" title=\"&#x4E00;&#x7CFB;&#x5217;&#x6587;&#x7AE0;\"></a>&#x4E00;&#x7CFB;&#x5217;&#x6587;&#x7AE0;</h1><p><a href=\"https://idisfkj.github.io/2016/04/23/Android%E9%AB%98%E4%BB%BF%E5%BE%AE%E4%BF%A1%E4%B9%8Bmvp%E5%AE%9E%E7%8E%B0-%E4%B8%80/\" target=\"_blank\" rel=\"noopener\">Android&#x9AD8;&#x4EFF;&#x5FAE;&#x4FE1;&#x4E4B;mvp&#x5B9E;&#x73B0;(&#x4E00;)</a><br><a href=\"https://idisfkj.github.io/2016/05/01/Android%E9%AB%98%E4%BB%BF%E5%BE%AE%E4%BF%A1%E4%B9%8Bmvp%E5%AE%9E%E7%8E%B0-%E4%BA%8C/\" target=\"_blank\" rel=\"noopener\">Android&#x9AD8;&#x4EFF;&#x5FAE;&#x4FE1;&#x4E4B;mvp&#x5B9E;&#x73B0;(&#x4E8C;)</a><br><a href=\"https://idisfkj.github.io/2016/05/08/Android%E9%AB%98%E4%BB%BF%E5%BE%AE%E4%BF%A1%E4%B9%8Bmvp%E5%AE%9E%E7%8E%B0-%E4%B8%89/\" target=\"_blank\" rel=\"noopener\">Android&#x9AD8;&#x4EFF;&#x5FAE;&#x4FE1;&#x4E4B;mvp&#x5B9E;&#x73B0;(&#x4E09;)</a></p>\n<p>&#x9879;&#x76EE;&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/idisfkj/HightCopyWX\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/HightCopyWX</a></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["高仿"]},{"title":"Android高仿微信之mvp实现(三)","url":"https://www.rousetime.com/2016/05/08/Android高仿微信之mvp实现-三/","content":"<p>&#x524D;&#x9762;&#x8BF4;&#x5230;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x5C0F;&#x7C73;&#x7684;&#x63A8;&#x9001;&#x6765;&#x5B9E;&#x73B0;&#x7B80;&#x5355;&#x7684;&#x804A;&#x5929;&#x7CFB;&#x7EDF;&#xFF0C;&#x867D;&#x7136;&#x7B80;&#x5355;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x4F60;&#x4EEC;&#x6765;&#x8BF4;&#x60F3;&#x8981;&#x771F;&#x6B63;&#x7684;&#x4F53;&#x9A8C;&#x6548;&#x679C;&#x5C31;&#x53EA;&#x80FD;&#x8DDF;&#x6211;&#x4E92;&#x52A8;&#xFF0C;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x7F3A;&#x70B9;&#xFF0C;&#x6211;&#x6700;&#x8FD1;&#x5B8C;&#x5584;&#x4E86;&#x4E0B;&#xFF0C;&#x589E;&#x52A0;&#x4E86;&#x6DFB;&#x52A0;&#x670B;&#x53CB;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x8FD9;&#x6837;&#x4F60;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x62FF;&#x4E24;&#x4E2A;&#x6D4B;&#x8BD5;&#x673A;&#x4E92;&#x76F8;&#x6D4B;&#x8BD5;&#x3002;&#x5C31;&#x80FD;&#x4F53;&#x9A8C;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#xFF0C;&#x4E0B;&#x9762;&#x8FD8;&#x662F;&#x7B80;&#x5355;&#x7684;&#x8BF4;&#x4E0B;&#x3002;</p>\n<h2 id=\"&#x539F;&#x7406;\"><a href=\"#&#x539F;&#x7406;\" class=\"headerlink\" title=\"&#x539F;&#x7406;\"></a>&#x539F;&#x7406;</h2><p>&#x5176;&#x5B9E;&#x4E3B;&#x8981;&#x7528;&#x5230;&#x7684;&#x5C31;&#x662F;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x6211;&#x8FD9;&#x91CC;&#x4E0D;&#x8BB2;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x65B9;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x65B9;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x6709;&#x70B9;&#x591A;&#xFF0C;&#x5C31;&#x4E0D;&#x5230;&#x8FD9;&#x91CC;&#x5C55;&#x5F00;&#xFF0C;&#x4EE5;&#x540E;&#x6709;&#x65F6;&#x95F4;&#x518D;&#x5C55;&#x5F00;&#x3002;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;<a href=\"https://idisfkj.github.io/2016/05/01/Android%E9%AB%98%E4%BB%BF%E5%BE%AE%E4%BF%A1%E4%B9%8Bmvp%E5%AE%9E%E7%8E%B0-%E4%BA%8C/\" target=\"_blank\" rel=\"noopener\">Android&#x9AD8;&#x4EFF;&#x5FAE;&#x4FE1;&#x4E4B;mvp&#x5B9E;&#x73B0;(&#x4E8C;)</a>&#x5DF2;&#x7ECF;&#x8BB2;&#x5230;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x8BE5;&#x8F6F;&#x4EF6;&#x662F;&#x5FC5;&#x987B;&#x5148;&#x6CE8;&#x518C;&#xFF0C;&#x5728;&#x6CE8;&#x518C;&#x7684;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5411;&#x6240;&#x6709;&#x5B89;&#x88C5;&#x8BE5;&#x5E94;&#x7528;&#x7684;&#x8BBE;&#x5907;&#x53D1;&#x9001;&#x4E86;&#x4E00;&#x6761;&#x5305;&#x88C5;&#x4E86;&#x6211;&#x4EEC;&#x8BBE;&#x5907;&#x6807;&#x8BC6;<strong>&#xFF08;regId&#xFF09;</strong>&#x3001;&#x7528;&#x6237;&#x540D;<strong>&#xFF08;userName&#xFF09;</strong>&#x3001;&#x8D26;&#x53F7;<strong>&#xFF08;userPhone&#xFF09;</strong>&#x3002;&#x53EA;&#x8981;&#x662F;&#x6CE8;&#x518C;&#x4FE1;&#x606F;&#x6211;&#x4EEC;&#x5C31;&#x4F1A;&#x628A;&#x5B83;&#x5B58;&#x50A8;&#x5230;&#x672C;&#x5730;&#x6570;&#x636E;&#x5E93;<strong>register</strong>&#x8868;&#x3002;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5C31;&#x662F;&#x4ECE;<strong>register</strong>&#x4E2D;&#x901A;&#x8FC7;<strong>userPhone</strong>&#x6807;&#x8BC6;&#x67E5;&#x8BE2;&#x4F60;&#x8981;&#x6DFB;&#x52A0;&#x7684;&#x670B;&#x53CB;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x5B58;&#x5728;&#x5C31;&#x663E;&#x793A;&#xFF0C;&#x5F53;&#x6267;&#x884C;&#x6DFB;&#x52A0;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x4E5F;&#x8981;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x6DFB;&#x52A0;&#x4E86;&#x8BE5;&#x597D;&#x53CB;&#xFF0C;&#x6CA1;&#x6709;&#x7684;&#x8BDD;&#x5C31;&#x6267;&#x884C;&#x6700;&#x540E;&#x7684;&#x6DFB;&#x52A0;&#x64CD;&#x4F5C;&#xFF0C;&#x5411;&#x8BE5;&#x7528;&#x6237;&#x53D1;&#x9001;&#x4E00;&#x6761;&#x6DFB;&#x52A0;&#x597D;&#x53CB;&#x7684;&#x8BF7;&#x6C42;&#x4FE1;&#x606F;&#xFF0C;&#x540C;&#x65F6;&#x628A;&#x8BE5;&#x7528;&#x6237;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x6DFB;&#x52A0;&#x5230;&#x804A;&#x5929;&#x8BB0;&#x5F55;&#x754C;&#x9762;&#x7684;&#x6570;&#x636E;&#x8868;&#x3002;&#x4E3A;&#x4E86;&#x7B80;&#x5355;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x53D6;&#x4E86;&#x4E00;&#x70B9;&#x5DE7;&#xFF0C;&#x53EA;&#x8981;&#x5BF9;&#x65B9;&#x63A5;&#x53D7;&#x5230;&#x6DFB;&#x52A0;&#x597D;&#x53CB;&#x8BF7;&#x6C42;&#x4FE1;&#x606F;&#xFF0C;&#x5BF9;&#x65B9;&#x5C31;&#x9ED8;&#x8BA4;&#x6DFB;&#x52A0;&#x4E86;&#x81EA;&#x5DF1;&#x4E3A;&#x597D;&#x53CB;&#xFF0C;&#x65E0;&#x9700;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x662F;&#x5426;&#x63A5;&#x53D7;&#x8BF7;&#x6C42;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x6574;&#x4E2A;&#x7684;&#x6DFB;&#x52A0;&#x64CD;&#x4F5C;&#xFF0C;&#x4E0B;&#x9762;&#x5C55;&#x793A;&#x4E00;&#x70B9;&#x4EE3;&#x7801;&#x3002;</p>\n<h2 id=\"&#x6DFB;&#x52A0;\"><a href=\"#&#x6DFB;&#x52A0;\" class=\"headerlink\" title=\"&#x6DFB;&#x52A0;\"></a>&#x6DFB;&#x52A0;</h2><p>&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x662F;&#x8F93;&#x5165;&#x8981;&#x6DFB;&#x52A0;&#x7684;&#x8D26;&#x6237;&#x53F7;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4F7F;&#x7528;&#x7684;&#x662F;<strong>MVP</strong>&#x6A21;&#x5F0F;&#xFF0C;&#x4EE3;&#x7801;&#x8FC7;&#x591A;&#x6240;&#x4EE5;&#x6211;&#x8FD9;&#x91CC;&#x628A;&#x4E00;&#x4E9B;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x8D34;&#x51FA;&#x4E86;,&#x5177;&#x4F53;&#x7684;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x6E90;&#x7801;&#x3002;</p>\n<p><strong>View</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface AddFriendsView {</span><br><span class=\"line\">    void showSearch();</span><br><span class=\"line\"></span><br><span class=\"line\">    void goneSearch();</span><br><span class=\"line\"></span><br><span class=\"line\">    void jumpSearchResult(String text);</span><br><span class=\"line\"></span><br><span class=\"line\">    void changeText(CharSequence text);</span><br><span class=\"line\"></span><br><span class=\"line\">    void showToast(String text);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p><strong>Presenter</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface AddFriendsPresenter {</span><br><span class=\"line\">    void switchView(CharSequence text);</span><br><span class=\"line\"></span><br><span class=\"line\">    void switchActicity(TextView searchContent, RegisterDataHelper helper);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x56E0;&#x4E3A;&#x8BE5;&#x754C;&#x9762;&#x6CA1;&#x6709;&#x5BF9;&#x5E94;&#x6570;&#x636E;&#x7684;&#x64CD;&#x4F5C;&#x7B49;&#xFF0C;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x754C;&#x9762;&#x663E;&#x793A;&#xFF0C;&#x6240;&#x4EE5;&#x6CA1;&#x6709;Model</em></p>\n</blockquote>\n<h2 id=\"&#x641C;&#x5BFB;\"><a href=\"#&#x641C;&#x5BFB;\" class=\"headerlink\" title=\"&#x641C;&#x5BFB;\"></a>&#x641C;&#x5BFB;</h2><p>&#x8FD9;&#x91CC;&#x4E5F;&#x662F;&#x63A5;&#x53E3;</p>\n<p><strong>View</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface SearchResultView {</span><br><span class=\"line\">    void succeedToFinish();</span><br><span class=\"line\"></span><br><span class=\"line\">    void hideProgressDialog(ProgressDialog pd);</span><br><span class=\"line\"></span><br><span class=\"line\">    void showSucceedToast();</span><br><span class=\"line\"></span><br><span class=\"line\">    void showErrorToast();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p><strong>Presenter</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface SearchResultPresenter {</span><br><span class=\"line\">    void checkSelection(Context context, String number, View view, SearchResultAdapter mAdapter);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p><strong>Model</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface SearchResultModel {</span><br><span class=\"line\">    void buildDialog(Context context, String number, View view, SearchResultAdapter adapter,SearchResultModelImp.requestListener listener);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x903B;&#x8F91;\"><a href=\"#&#x903B;&#x8F91;\" class=\"headerlink\" title=\"&#x903B;&#x8F91;\"></a>&#x903B;&#x8F91;</h2><p>&#x4E0B;&#x9762;&#x662F;&#x6267;&#x884C;&#x6DFB;&#x52A0;&#x7684;&#x4E3B;&#x8981;&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    public void buildDialog(final Context context, String number, final View view,</span><br><span class=\"line\">                            final SearchResultAdapter adapter, final requestListener listener) {</span><br><span class=\"line\">        new AlertDialog.Builder(context)</span><br><span class=\"line\">                .setIcon(R.drawable.icon)</span><br><span class=\"line\">                .setTitle(R.string.dialog_tip)</span><br><span class=\"line\">                .setMessage(String.format(context.getResources().getString(R.string.dialog_message), number))</span><br><span class=\"line\">                .setPositiveButton(R.string.dialog_positive, new DialogInterface.OnClickListener() {</span><br><span class=\"line\">                    @Override</span><br><span class=\"line\">                    public void onClick(DialogInterface dialog, int which) {</span><br><span class=\"line\">                        Cursor cursor = adapter.getCursor();</span><br><span class=\"line\">                        if (cursor.moveToPosition(view.getId())) {</span><br><span class=\"line\">                            String number = CursorUtils.formatString(cursor, RegisterDataHelper.RegisterDataInfo.NUMBER);</span><br><span class=\"line\">                            String regId = CursorUtils.formatString(cursor, RegisterDataHelper.RegisterDataInfo.REGID);</span><br><span class=\"line\">                            String userName = CursorUtils.formatString(cursor, RegisterDataHelper.RegisterDataInfo.USER_NAME);</span><br><span class=\"line\"></span><br><span class=\"line\">                            WXDataHelper wxHelper = new WXDataHelper(context);</span><br><span class=\"line\">                            Cursor wxCursor = wxHelper.query(number, regId, userName);</span><br><span class=\"line\">                            if (wxCursor.getCount() &gt; 0 || (number.equals(SPUtils.getString(&quot;userPhone&quot;))</span><br><span class=\"line\">                                    &amp;&amp; regId.equals(SPUtils.getString(&quot;regId&quot;)))) {</span><br><span class=\"line\">                                ToastUtils.showShort(&quot;&#x4F60;&#x5DF2;&#x7ECF;&#x6DFB;&#x52A0;&#x4E86;&#x8BE5;&#x597D;&#x53CB;&#xFF01;&quot;);</span><br><span class=\"line\">                            } else {</span><br><span class=\"line\">                                //&#x53D1;&#x9001;&#x6DFB;&#x52A0;&#x597D;&#x53CB;&#x8BF7;&#x6C42;</span><br><span class=\"line\">                                pd = ProgressDialog.show(context, &quot;&#x6DFB;&#x52A0;&#x8BF7;&#x6C42;&#x4E2D;...&quot;, &quot;&#x8BF7;&#x7A0D;&#x540E;...&quot;, true);</span><br><span class=\"line\">                                request(userName, number, regId, listener, cursor);</span><br><span class=\"line\">                            }</span><br><span class=\"line\">                            wxCursor.close();</span><br><span class=\"line\">                        }</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                })</span><br><span class=\"line\">                .setNegativeButton(R.string.dialog_negative, new DialogInterface.OnClickListener() {</span><br><span class=\"line\">                    @Override</span><br><span class=\"line\">                    public void onClick(DialogInterface dialog, int which) {</span><br><span class=\"line\"></span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }).show();</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x6700;&#x540E;&#x770B;&#x4E0B;&#x64CD;&#x4F5C;&#x6548;&#x679C;&#x5427;</em></p>\n</blockquote>\n<h2 id=\"&#x6548;&#x679C;\"><a href=\"#&#x6548;&#x679C;\" class=\"headerlink\" title=\"&#x6548;&#x679C;\"></a>&#x6548;&#x679C;</h2><p><img src=\"/2016/05/08/Android&#x9AD8;&#x4EFF;&#x5FAE;&#x4FE1;&#x4E4B;mvp&#x5B9E;&#x73B0;-&#x4E09;/1.gif\" alt=\"picture\"></p>\n<p>&#x9879;&#x76EE;&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/idisfkj/HightCopyWX\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/HightCopyWX</a></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["高仿"]},{"title":"Android高仿微信之mvp实现(二)","url":"https://www.rousetime.com/2016/05/01/Android高仿微信之mvp实现-二/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p>&#x4E0A;&#x6B21;&#x8BF4;&#x4E86;&#x4E0B;&#x7B80;&#x5355;&#x7684;&#x6846;&#x67B6;&#x6784;&#x67B6;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x89E3;&#x91CA;&#x4E86;&#x4E0B;<strong>MVP</strong>&#x7684;&#x539F;&#x7406;&#x5B9E;&#x73B0;&#x3002;&#x867D;&#x7136;&#x4E0A;&#x6B21;&#x7684;&#x529F;&#x80FD;&#x6CA1;&#x6709;&#x5F88;&#x591A;&#xFF0C;&#x4F46;&#x4E3B;&#x8981;&#x662F;&#x628A;&#x6846;&#x67B6;&#x642D;&#x597D;&#xFF0C;&#x624D;&#x80FD;&#x66F4;&#x597D;&#x7684;&#x8FDB;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x5982;&#x679C;&#x8FD8;&#x6709;&#x4E0D;&#x4E86;&#x89E3;&#x7684;&#x53EF;&#x4EE5;&#x5148;&#x770B;&#x4E0B;&#x6211;&#x524D;&#x9762;&#x7684;&#x6587;&#x7AE0;&#xFF1A;<a href=\"https://idisfkj.github.io/2016/04/23/Android%E9%AB%98%E4%BB%BF%E5%BE%AE%E4%BF%A1%E4%B9%8Bmvp%E5%AE%9E%E7%8E%B0-%E4%B8%80/\" target=\"_blank\" rel=\"noopener\">Android&#x9AD8;&#x4EFF;&#x5FAE;&#x4FE1;&#x4E4B;mvp&#x5B9E;&#x73B0;(&#x4E00;)</a><br>&#x597D;&#x4E86;&#xFF0C;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x8981;&#x4ECB;&#x7ECD;&#x7684;&#x662F;&#x5FAE;&#x4FE1;&#x804A;&#x5929;&#x754C;&#x9762;&#x529F;&#x80FD;&#x7684;&#x7B80;&#x5355;&#x5B9E;&#x73B0;&#x3002;</p>\n<h2 id=\"&#x539F;&#x7406;\"><a href=\"#&#x539F;&#x7406;\" class=\"headerlink\" title=\"&#x539F;&#x7406;\"></a>&#x539F;&#x7406;</h2><p>&#x5176;&#x5B9E;&#x77E5;&#x9053;&#x4E86;&#x539F;&#x7406;&#x4F60;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x662F;&#x591A;&#x4E48;&#x7684;&#x7B80;&#x5355;&#x3002;&#x8FD9;&#x91CC;&#x6CA1;&#x6709;&#x670D;&#x52A1;&#x5668;&#x6240;&#x4EE5;&#x662F;&#x57FA;&#x4E8E;&#x63A8;&#x9001;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x7F51;&#x4E0A;&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x8FD9;&#x65B9;&#x9762;&#x7684;&#x8D44;&#x6599;&#xFF0C;&#x4E00;&#x822C;&#x662F;&#x57FA;&#x4E8E;&#x767E;&#x5EA6;&#x4E91;&#x7684;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x662F;&#x57FA;&#x4E8E;&#x5C0F;&#x7C73;&#x63A8;&#x9001;&#x6765;&#x5B9E;&#x73B0;&#x6D88;&#x606F;&#x7684;&#x4F20;&#x9012;&#x3002;&#x5927;&#x5BB6;&#x90FD;&#x77E5;&#x9053;&#x73B0;&#x5728;&#x63A8;&#x9001;&#x65E0;&#x5904;&#x4E0D;&#x5728;&#xFF0C;&#x5982;&#x679C;&#x8FD8;&#x6CA1;&#x6709;&#x63A5;&#x89E6;&#x63A8;&#x9001;&#x7684;&#x8BDD;&#xFF0C;&#x8FD8;&#x662F;&#x5148;&#x53BB;&#x7B80;&#x5355;&#x7684;&#x8865;&#x4E0B;&#x529F;&#x8BFE;&#x5728;&#x6765;&#x770B;&#x5C31;&#x80FD;&#x66F4;&#x597D;&#x7684;&#x4E86;&#x89E3;&#x4E0B;&#x9762;&#x8BF4;&#x7684;&#x3002;</p>\n<p>&#x8981;&#x60F3;&#x5B9E;&#x73B0;&#x6D88;&#x606F;&#x7684;&#x4F20;&#x9012;&#xFF0C;&#x5C31;&#x8981;&#x6709;&#x53D1;&#x9001;&#x4E0E;&#x63A5;&#x6536;&#x529F;&#x80FD;&#xFF0C;&#x9996;&#x5148;&#x5BF9;&#x4E8E;&#x63A5;&#x6536;so easy &#x4E86;&#x53EA;&#x8981;&#x6211;&#x4EEC;&#x5728;&#x81EA;&#x5DF1;&#x7684;<strong>Android</strong>&#x5E94;&#x7528;&#x4E2D;&#x96C6;&#x6210;&#x5C0F;&#x7C73;&#x7684;I<strong>SDK</strong>(&#x6211;&#x8FD9;&#x91CC;&#x662F;&#x4EE5;&#x5C0F;&#x7C73;&#x63A8;&#x9001;&#x4E3A;&#x4F8B;&#x7684;)&#x3002;&#x5C31;&#x5DF2;&#x7ECF;&#x5B9E;&#x73B0;&#x7684;&#x63A5;&#x6536;&#x529F;&#x80FD;&#xFF0C;&#x5BF9;&#x4E8E;&#x63A5;&#x6536;&#x6211;&#x5206;&#x4E86;&#x4E24;&#x79CD;&#xFF0C;&#x4E00;&#x79CD;&#x7684;&#x6B63;&#x5E38;&#x804A;&#x5929;&#x5F97;&#x4FE1;&#x606F;&#xFF0C;&#x800C;&#x53E6;&#x4E00;&#x79CD;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x6CE8;&#x518C;&#x65F6;&#x53D1;&#x9001;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x5BF9;&#x4E8E;&#x7B2C;&#x4E00;&#x79CD;&#x6D88;&#x606F;&#x6211;&#x4EEC;&#x8981;&#x6839;&#x636E;&#x7528;&#x6237;&#x8BBE;&#x5907;&#x552F;&#x4E00;&#x6807;&#x8BC6;&#x4E0E;&#x7528;&#x6237;&#x8D26;&#x53F7;&#x6765;&#x5B58;&#x50A8;&#x4E0B;&#x53D1;&#x8FC7;&#x6765;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x4E3A;&#x4EE5;&#x540E;&#x663E;&#x793A;&#x4E0D;&#x540C;&#x7528;&#x6237;&#x804A;&#x5929;&#x8BB0;&#x5F55;&#x3002;&#x5BF9;&#x4E8E;&#x7B2C;&#x4E8C;&#x4E2D;&#xFF0C;&#x662F;&#x5728;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x65F6;&#x5FC5;&#x987B;&#x5148;&#x6CE8;&#x518C;&#xFF0C;&#x4E00;&#x65E6;&#x6CE8;&#x518C;&#x6210;&#x529F;&#x5C31;&#x4F1A;&#x5411;&#x6240;&#x6709;&#x7684;&#x7528;&#x6237;&#x53D1;&#x9001;&#x4E00;&#x6761;&#x6CE8;&#x518C;&#x4FE1;&#x606F;&#xFF0C;&#x8BE5;&#x6D88;&#x606F;&#x5305;&#x62EC;&#x7528;&#x6237;&#x7684;&#x57FA;&#x672C;&#x4FE1;&#x606F;&#x4E0E;&#x8BBE;&#x5907;&#x6807;&#x8BC6;&#xFF0C;&#x53EA;&#x8981;&#x5728;&#x4FE1;&#x606F;&#x65F6;&#x95F4;&#x7684;&#x6709;&#x6548;&#x65F6;&#x95F4;&#x4E4B;&#x5185;&#xFF0C;&#x6CE8;&#x518C;&#x4E86;&#x5F97;&#x7528;&#x6237;&#x5C31;&#x80FD;&#x63A5;&#x6536;&#x8BE5;&#x6CE8;&#x518C;&#x6D88;&#x606F;&#x3002;&#x8FD9;&#x4E2A;&#x662F;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x8EAB;&#x4EFD;&#x8BC6;&#x522B;&#xFF0C;&#x5BF9;&#x6D88;&#x606F;&#x7684;&#x53D1;&#x9001;&#xFF0C;&#x7528;&#x6237;&#x7684;&#x6DFB;&#x52A0;&#x90FD;&#x662F;&#x91CD;&#x8981;&#x7684;&#x6807;&#x8BC6;&#x3002;&#x8BF4;&#x4E86;&#x63A5;&#x6536;&#xFF0C;&#x53CD;&#x8FC7;&#x6765;&#x53D1;&#x9001;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#x7684;&#x5206;&#x4E24;&#x79CD;&#xFF0C;&#x53EA;&#x662F;&#x65CB;&#x8F6C;&#x4E00;&#x4E0B;&#x4F4D;&#x7F6E;&#x800C;&#x5DF2;&#x3002;</p>\n<h2 id=\"&#x914D;&#x7F6E;&#x5C0F;&#x7C73;SDK\"><a href=\"#&#x914D;&#x7F6E;&#x5C0F;&#x7C73;SDK\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;&#x5C0F;&#x7C73;SDK\"></a>&#x914D;&#x7F6E;&#x5C0F;&#x7C73;SDK</h2><p>&#x9996;&#x5148;&#x8FDB;&#x5165;&#x5C0F;&#x7C73;&#x5F00;&#x53D1;&#x5E73;&#x53F0;&#xFF0C;&#x4E3A;&#x81EA;&#x5DF1;&#x7684;&#x5E94;&#x7528;&#x5F00;&#x542F;&#x63A8;&#x9001;&#x529F;&#x80FD;&#xFF0C;&#x7136;&#x540E;&#x4E0B;&#x8F7D;<a href=\"http://dev.xiaomi.com/mipush/downpage/\" target=\"_blank\" rel=\"noopener\">SDK</a>&#x6839;&#x636E;<a href=\"http://dev.xiaomi.com/doc/?p=3080\" target=\"_blank\" rel=\"noopener\">&#x5B98;&#x65B9;&#x6587;&#x6863;</a>&#x505A;&#x597D;&#x76F8;&#x5E94;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x524D;&#x671F;&#x5C31;&#x5927;&#x529F;&#x544A;&#x6210;&#x4E86;&#x3002;</p>\n<blockquote>\n<p><em>&#x5982;&#x679C;&#x6CA1;&#x63A5;&#x89E6;&#x8FC7;&#x7684;&#x53EA;&#x8981;&#x8010;&#x5FC3;&#x770B;&#x6587;&#x6863;&#x5C31;&#x6CA1;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF0C;&#x6587;&#x6863;&#x5F88;&#x8BE6;&#x7EC6;</em></p>\n</blockquote>\n<h2 id=\"&#x63A5;&#x6536;\"><a href=\"#&#x63A5;&#x6536;\" class=\"headerlink\" title=\"&#x63A5;&#x6536;\"></a>&#x63A5;&#x6536;</h2><p>&#x524D;&#x9762;&#x6211;&#x5DF2;&#x7ECF;&#x8BF4;&#x4E86;&#x63A5;&#x6536;&#x662F;&#x76F8;&#x5BF9;&#x6765;&#x8BF4;&#x8F83;&#x7B80;&#x5355;&#x7684;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x524D;&#x9762;&#x914D;&#x7F6E;&#x597D;&#x4E86;&#x5C0F;&#x7C73;&#x7684;<strong>SDK</strong>&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x5C31;&#x6709;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<strong>extends</strong> <strong>PushMessageReceiver</strong>&#x7684;&#x7C7B;&#xFF0C;&#x5728;&#x8BE5;&#x7C7B;&#x4E2D;&#x7528;&#x5404;&#x79CD;&#x76F8;&#x5E94;&#x7684;&#x63A5;&#x6536;&#x4FE1;&#x606F;&#x65B9;&#x6CD5;&#xFF0C;&#x5BF9;&#x4E86;&#x5FD8;&#x4E86;&#x8BF4;&#x6D88;&#x606F;&#x7684;&#x53D1;&#x9001;&#x7C7B;&#x578B;&#xFF0C;&#x8FD9;&#x91CC;&#x5206;&#x4E3A;&#x4E24;&#x79CD;</p>\n<ul>\n<li>&#x901A;&#x77E5;&#x680F;&#x663E;&#x793A;&#x7684;&#x6D88;&#x606F;</li>\n<li>&#x900F;&#x4F20;&#x6D88;&#x606F;</li>\n</ul>\n<p>&#x901A;&#x77E5;&#x680F;&#x663E;&#x793A;&#x7684;&#x6D88;&#x606F;&#x4E0D;&#x7528;&#x6211;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x81F3;&#x4E8E;&#x900F;&#x4F20;&#x6D88;&#x606F;&#x7B80;&#x5355;&#x70B9;&#x5C31;&#x662F;&#x4E0D;&#x7528;&#x901A;&#x77E5;&#x680F;&#x663E;&#x793A;&#xFF0C;&#x76F4;&#x63A5;&#x5728;&#x5185;&#x90E8;&#x63A5;&#x6536;&#x53D1;&#x9001;&#x8FC7;&#x6765;&#x7684;&#x6D88;&#x606F;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x804A;&#x5929;&#x4F7F;&#x7528;&#x7684;&#x5F53;&#x7136;&#x7684;&#x900F;&#x4F20;&#x6D88;&#x606F;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x4E0B;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#x4E2D;&#x63A5;&#x6536;&#x5230;&#x900F;&#x4F20;&#x53D1;&#x9001;&#x8FC7;&#x6765;&#x7684;&#x6D88;&#x606F;&#x5BF9;&#x4E8E;&#x4E24;&#x79CD;&#x63A5;&#x6536;&#x6D88;&#x606F;&#x505A;&#x76F8;&#x5E94;&#x7684;&#x5904;&#x7406;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\">     * &#x63A5;&#x6536;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x7684;&#x900F;&#x4F20;&#x6D88;&#x606F;</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * @param context</span><br><span class=\"line\">     * @param message</span><br><span class=\"line\">     */</span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void onReceivePassThroughMessage(Context context, MiPushMessage message) {</span><br><span class=\"line\">        mMessage = message.getContent();</span><br><span class=\"line\">        if (!TextUtils.isEmpty(message.getTopic())) {</span><br><span class=\"line\">            mTopic = message.getTopic();</span><br><span class=\"line\">        } else if (!TextUtils.isEmpty(message.getAlias())) {</span><br><span class=\"line\">            mAlias = message.getAlias();</span><br><span class=\"line\">        }</span><br><span class=\"line\">        Intent intent = new Intent();</span><br><span class=\"line\">        //user information</span><br><span class=\"line\">        if (mMessage.indexOf(&quot;^&quot;) != -1 &amp;&amp; mMessage.indexOf(&quot;@&quot;) != -1) {</span><br><span class=\"line\">            int index1 = mMessage.lastIndexOf(&quot;^&quot;);</span><br><span class=\"line\">            int index2 = mMessage.lastIndexOf(&quot;@&quot;);</span><br><span class=\"line\">            String userName = mMessage.substring(0, index1);</span><br><span class=\"line\">            String regId = mMessage.substring(index1 + 1, index2);</span><br><span class=\"line\">            String number = mMessage.substring(index2 + 1);</span><br><span class=\"line\"></span><br><span class=\"line\">            RegisterInfo info = new RegisterInfo();</span><br><span class=\"line\">            info.setUserName(userName);</span><br><span class=\"line\">            info.setNumber(number);</span><br><span class=\"line\">            info.setRegId(regId);</span><br><span class=\"line\">            RegisterDataHelper helper = new RegisterDataHelper(App.getAppContext());</span><br><span class=\"line\">            Cursor cursor = helper.query(number, regId);</span><br><span class=\"line\">            if (cursor != null &amp;&amp; cursor.getCount() &gt; 0) {</span><br><span class=\"line\">                for (cursor.moveToFirst(); !cursor.isAfterLast(); cursor.moveToNext()) {</span><br><span class=\"line\">                    if (CursorUtils.formatString(cursor, RegisterDataHelper.RegisterDataInfo.REGID).equals(regId)</span><br><span class=\"line\">                            &amp;&amp; CursorUtils.formatString(cursor, RegisterDataHelper.RegisterDataInfo.NUMBER).equals(number)) {</span><br><span class=\"line\">                        if (!CursorUtils.formatString(cursor, RegisterDataHelper.RegisterDataInfo.USER_NAME).equals(userName))</span><br><span class=\"line\">                            // update user information</span><br><span class=\"line\">                            helper.update(info, number, regId);</span><br><span class=\"line\">                        cursor.close();</span><br><span class=\"line\">                        return;</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }</span><br><span class=\"line\">                cursor.close();</span><br><span class=\"line\">            }</span><br><span class=\"line\">            // insert user information</span><br><span class=\"line\">            helper.insert(info);</span><br><span class=\"line\">            if (SPUtils.getString(&quot;regId&quot;).equals(App.DEVELOPER_ID)){</span><br><span class=\"line\">                WXDataHelper wxHelper = new WXDataHelper(App.getAppContext());</span><br><span class=\"line\">                WXItemInfo itemInfo = new WXItemInfo();</span><br><span class=\"line\">                itemInfo.setRegId(regId);</span><br><span class=\"line\">                itemInfo.setTitle(userName);</span><br><span class=\"line\">                itemInfo.setNumber(number);</span><br><span class=\"line\">                itemInfo.setContent(String.format(App.HELLO_MESSAGE, userName));</span><br><span class=\"line\">                itemInfo.setCurrentAccount(SPUtils.getString(&quot;userPhone&quot;));</span><br><span class=\"line\">                itemInfo.setTime(CalendarUtils.getCurrentDate());</span><br><span class=\"line\">                wxHelper.insert(itemInfo);</span><br><span class=\"line\">            }</span><br><span class=\"line\"></span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            // chat information</span><br><span class=\"line\">            int index1 = mMessage.lastIndexOf(&quot;(&quot;);</span><br><span class=\"line\">            String rMessage = mMessage.substring(0, index1);</span><br><span class=\"line\">            String extraMessage = mMessage.substring(index1 + 1);</span><br><span class=\"line\"></span><br><span class=\"line\">            int index2 = extraMessage.indexOf(&quot;@&quot;);</span><br><span class=\"line\">            int index3 = extraMessage.indexOf(&quot;@&quot;, index2 + 1);</span><br><span class=\"line\">            String receiverNumber = extraMessage.substring(0, index2);</span><br><span class=\"line\">            String regId = extraMessage.substring(index2 + 1, index3);</span><br><span class=\"line\">            String sendNumber = extraMessage.substring(index3 + 1);</span><br><span class=\"line\"></span><br><span class=\"line\">            ChatMessageInfo chatMessageInfo = new ChatMessageInfo();</span><br><span class=\"line\">            chatMessageInfo.setMessage(rMessage);</span><br><span class=\"line\">            chatMessageInfo.setFlag(0);</span><br><span class=\"line\">            chatMessageInfo.setTime(CalendarUtils.getCurrentDate());</span><br><span class=\"line\">            chatMessageInfo.setReceiverNumber(receiverNumber);</span><br><span class=\"line\">            chatMessageInfo.setRegId(regId);</span><br><span class=\"line\">            chatMessageInfo.setSendNumber(sendNumber);</span><br><span class=\"line\"></span><br><span class=\"line\">            if (App.mNumber.equals(sendNumber) &amp;&amp; App.mRegId.equals(regId)) {</span><br><span class=\"line\">                //&#x5728;&#x5F53;&#x524D;&#x804A;&#x5929;&#x754C;&#x9762;</span><br><span class=\"line\">                intent.setAction(&quot;com.idisfkj.hightcopywx.chat&quot;);</span><br><span class=\"line\">                Bundle bundle = new Bundle();</span><br><span class=\"line\">                bundle.putSerializable(&quot;chatMessageInfo&quot;, chatMessageInfo);</span><br><span class=\"line\">                intent.putExtras(bundle);</span><br><span class=\"line\">                App.getAppContext().sendBroadcast(intent);</span><br><span class=\"line\">            } else {</span><br><span class=\"line\">                //&#x4E0D;&#x5728;&#x5F53;&#x524D;&#x804A;&#x5929;&#x754C;&#x9762;</span><br><span class=\"line\">                ChatMessageDataHelper helper = new ChatMessageDataHelper(App.getAppContext());</span><br><span class=\"line\">                helper.insert(chatMessageInfo);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x4EE3;&#x7801;&#x5C31;&#x4E0D;&#x89E3;&#x91CA;&#x4E86;&#xFF0C;&#x81EA;&#x5DF1;&#x7814;&#x7A76;&#x7814;&#x7A76;</em></p>\n</blockquote>\n<h2 id=\"&#x53D1;&#x9001;\"><a href=\"#&#x53D1;&#x9001;\" class=\"headerlink\" title=\"&#x53D1;&#x9001;\"></a>&#x53D1;&#x9001;</h2><p>&#x5982;&#x679C;&#x4F60;&#x770B;&#x4E86;&#x6587;&#x6863;&#x7684;&#x8BDD;&#x5C31;&#x5E94;&#x8BE5;&#x6709;&#x70B9;&#x5934;&#x7EEA;&#x4E86;&#xFF0C;&#x53D1;&#x9001;&#x5C31;&#x662F;&#x4F7F;&#x7528;HTTP&#x8BF7;&#x6C42;&#x5411;&#x5C0F;&#x7C73;&#x6240;&#x63D0;&#x4F9B;&#x7684;API&#x6839;&#x636E;&#x4F60;&#x63D0;&#x4F9B;&#x7684;<strong>regId</strong>&#x3001;<strong>userAccount</strong>&#x3001;<strong>alias</strong>&#x3001;<strong>topic</strong>&#x7B49;&#x53D1;&#x9001;&#x4F60;&#x8981;&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;&#x5185;&#x5BB9;&#xFF0C;&#x6211;&#x7528;&#x7684;&#x662F;<strong>regId</strong> API&#xFF1A;<a href=\"https://api.xmpush.xiaomi.com/v2/message/regid\" target=\"_blank\" rel=\"noopener\">https://api.xmpush.xiaomi.com/v2/message/regid</a></p>\n<p><a href=\"http://dev.xiaomi.com/doc/?p=533\" target=\"_blank\" rel=\"noopener\">&#x53C2;&#x8003;&#x6587;&#x6863;</a></p>\n<p>&#x4E0B;&#x9762;&#x662F;&#x53D1;&#x9001;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    public void requestData(final requestListener listener, final String chatContent, final String number, final String regId, final ChatMessageDataHelper helper) {</span><br><span class=\"line\">        JsonObjectRequest jsonObjectRequest = new JsonObjectRequest(Request.Method.POST, UrlUtils.ChatUrl(chatContent, number, regId)</span><br><span class=\"line\">                , null, new Response.Listener&lt;JSONObject&gt;() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onResponse(JSONObject jsonObject) {</span><br><span class=\"line\">                mChatMessageInfo = new ChatMessageInfo();</span><br><span class=\"line\">                mChatMessageInfo.setMessage(chatContent);</span><br><span class=\"line\">                mChatMessageInfo.setFlag(1);</span><br><span class=\"line\">                mChatMessageInfo.setTime(CalendarUtils.getCurrentDate());</span><br><span class=\"line\">                mChatMessageInfo.setReceiverNumber(number);</span><br><span class=\"line\">                mChatMessageInfo.setRegId(regId);</span><br><span class=\"line\">                mChatMessageInfo.setSendNumber(SPUtils.getString(&quot;userPhone&quot;, &quot;&quot;));</span><br><span class=\"line\">                listener.onSucceed(mChatMessageInfo, helper);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }, new Response.ErrorListener() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onErrorResponse(VolleyError volleyError) {</span><br><span class=\"line\">                Log.d(&quot;TAG&quot;, volleyError.getMessage());</span><br><span class=\"line\">                listener.onError(volleyError.getMessage());</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }) {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public Map&lt;String, String&gt; getHeaders() throws AuthFailureError {</span><br><span class=\"line\">                HashMap&lt;String, String&gt; header = new HashMap&lt;&gt;();</span><br><span class=\"line\">                header.put(&quot;Authorization&quot;, &quot;key=&quot; + App.APP_SECRET_KEY);</span><br><span class=\"line\">                return header;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        };</span><br><span class=\"line\">        VolleyUtils.addQueue(jsonObjectRequest, &quot;chatRequest&quot;);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x7531;&#x4E8E;&#x6D89;&#x53CA;&#x7684;&#x4EE3;&#x7801;&#x8FD8;&#x662F;&#x6709;&#x70B9;&#x591A;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x4E00;&#x4E00;&#x5C55;&#x5F00;&#xFF0C;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x6839;&#x636E;&#x540E;&#x9762;&#x7684;&#x5730;&#x5740;<strong>Star</strong>&#x3001;<strong>Fork</strong>&#x4E0B;&#x8F7D;&#x4EE3;&#x7801;&#x67E5;&#x770B;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F60;&#x5B89;&#x88C5;&#x6CE8;&#x518C;&#x4E86;&#xFF0C;&#x7531;&#x4E8E;&#x65F6;&#x95F4;&#x539F;&#x56E0;&#xFF0C;&#x76EE;&#x524D;&#x804A;&#x5929;&#x754C;&#x9762;&#x53EA;&#x4F1A;&#x81EA;&#x52A8;&#x6DFB;&#x52A0;&#x6211;&#x4E3A;&#x597D;&#x53CB;&#xFF0C;&#x4F60;&#x4EEC;&#x5982;&#x679C;&#x7528;&#x4E0D;&#x61C2;&#x5F97;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x7684;&#x53D1;&#x6D88;&#x606F;&#x7ED9;&#x6211;&#xFF0C;&#x4F46;&#x4E0D;&#x4E00;&#x5B9A;&#x90FD;&#x4F1A;&#x56DE;&#x3002;&#x597D;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x770B;&#x770B;&#x6548;&#x679C;&#x5427;</p>\n<h2 id=\"&#x6548;&#x679C;\"><a href=\"#&#x6548;&#x679C;\" class=\"headerlink\" title=\"&#x6548;&#x679C;\"></a>&#x6548;&#x679C;</h2><p><img src=\"/2016/05/01/Android&#x9AD8;&#x4EFF;&#x5FAE;&#x4FE1;&#x4E4B;mvp&#x5B9E;&#x73B0;-&#x4E8C;/1.gif\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p>&#x9879;&#x76EE;&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/idisfkj/HightCopyWX\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/HightCopyWX</a></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["高仿"]},{"title":"Android高仿微信之mvp实现(一)","url":"https://www.rousetime.com/2016/04/23/Android高仿微信之mvp实现-一/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p>&#x4E3A;&#x4E86;&#x5DE9;&#x56FA;&#x4E00;&#x4E0B;&#x81EA;&#x5DF1;&#x5BF9;<strong>mvp</strong>&#x67B6;&#x6784;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x4E8E;&#x662F;&#x7A81;&#x751F;&#x4E00;&#x4E2A;&#x60F3;&#x6CD5;&#xFF0C;&#x7528;<strong>mvp</strong>&#x67B6;&#x6784;&#x6765;&#x5B9E;&#x73B0;&#x4E00;&#x70B9;&#x7C7B;&#x4F3C;&#x4E8E;&#x5FAE;&#x4FE1;&#x7684;&#x529F;&#x80FD;&#x3002;&#x6240;&#x4EE5;&#x5C31;&#x6709;&#x4E86;&#x73B0;&#x5728;&#x7684;&#x6807;&#x9898;&#x9AD8;&#x4EFF;&#x5FAE;&#x4FE1;&#x4E4B;mvp&#x5B9E;&#x73B0;&#x3002;&#x5E0C;&#x671B;&#x81EA;&#x5DF1;&#x5728;&#x5B9E;&#x73B0;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x80FD;&#x719F;&#x7EC3;&#x638C;&#x63E1;<strong>mvp</strong>&#x67B6;&#x6784;&#x7684;&#x7CBE;&#x9AD3;&#xFF0C;&#x540C;&#x65F6;&#x6211;&#x4E5F;&#x5728;&#x8FD9;&#x5199;&#x4E0B;&#x81EA;&#x5DF1;&#x5728;&#x8FD9;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x6210;&#x957F;&#x4E0E;&#x6240;&#x601D;&#x3002;&#x8BE5;&#x7247;&#x6587;&#x7AE0;&#x4E3A;&#x7B2C;&#x4E00;&#x7CFB;&#x5217;&#xFF0C;&#x4EE5;&#x540E;&#x4F1A;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x8FDB;&#x5EA6;&#x6765;&#x5199;&#x4E0B;&#x5269;&#x4F59;&#x7684;&#x7CFB;&#x5217;&#x3002;&#x8FD8;&#x6CA1;&#x63A5;&#x89E6;&#x7684;&#x4E5F;&#x53EF;&#x4EE5;&#x4E00;&#x8D77;&#x6765;&#x5B66;&#x4E60;&#x4E0B;&#xFF0C;&#x5F53;&#x7136;&#x5982;&#x6709;&#x4E0D;&#x5BF9;&#x7684;&#x6B22;&#x8FCE;&#x6765;&#x6307;&#x6559;&#x3002;</p>\n<h2 id=\"MVP\"><a href=\"#MVP\" class=\"headerlink\" title=\"MVP\"></a>MVP</h2><p>&#x9996;&#x5148;&#x6211;&#x6765;&#x7B80;&#x5355;&#x7684;&#x89E3;&#x91CA;&#x4E0B;&#x4F55;&#x4E3A;<strong>mvp</strong></p>\n<ul>\n<li><strong>M</strong>&#x5C31;&#x662F;<strong>Model</strong> &#xFF0C;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x8D1F;&#x8D23;&#x7684;&#x5C31;&#x662F;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#xFF0C;&#x6570;&#x636E;&#x7684;&#x83B7;&#x53D6;&#xFF0C;&#x4F8B;&#x5982;&#x6570;&#x636E;&#x5E93;&#x7684;&#x8BFB;&#x5199;&#xFF0C;<strong>http</strong>&#x7684;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#x7684;&#x5904;&#x7406;&#x3002;</li>\n<li><strong>V</strong>&#x5C31;&#x662F;<strong>View</strong> &#xFF0C;&#x987E;&#x540D;&#x601D;&#x4E49;&#x89C6;&#x56FE;&#x7684;&#x610F;&#x601D;&#xFF0C;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x7684;&#x4EFB;&#x52A1;&#x5C31;&#x662F;&#x5904;&#x7406;&#x5404;&#x4E2A;&#x754C;&#x9762;<strong>ui</strong>&#x63A7;&#x4EF6;&#x7684;&#x5904;&#x7406;&#x3002;</li>\n<li><strong>P</strong>&#x5C31;&#x662F;<strong>Presenter</strong> &#xFF0C;&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x8FD9;&#x91CC;&#x8D1F;&#x8D23;&#x7684;&#x662F;<strong>Model</strong>&#x4E0E;<strong>View</strong>&#x4E4B;&#x95F4;&#x7684;&#x8054;&#x7CFB;&#x64CD;&#x4F5C;&#x3002;</li>\n</ul>\n<p>&#x90A3;&#x4E48;&#x4ED6;&#x4EEC;&#x4E4B;&#x95F4;&#x5230;&#x5E95;&#x662F;&#x5982;&#x4F55;&#x8054;&#x7CFB;&#x5728;&#x4E00;&#x8D77;&#x5DE5;&#x4F5C;&#x7684;&#x5462;&#xFF1F;&#x5F53;&#x4E00;&#x4E2A;&#x754C;&#x9762;&#x88AB;&#x521B;&#x5EFA;&#x65F6;&#x9996;&#x5148;&#x8C03;&#x7528;<strong>View</strong>&#xFF0C;<strong>View</strong>&#x8C03;&#x7528;<strong>Presenter</strong>&#x4E2D;&#x7684;&#x76F8;&#x5E94;&#x64CD;&#x4F5C;&#xFF0C;&#x5728;<strong>Presenter</strong>&#x4E2D;&#x5219;&#x8C03;&#x7528;&#x4E86;<strong>Model</strong>&#x7684;&#x6570;&#x636E;&#x64CD;&#x4F5C;&#x65B9;&#x6CD5;&#xFF0C;<strong>Presenter</strong>&#x4E2D;&#x83B7;&#x5F97;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x5219;&#x53CD;&#x8FC7;&#x6765;&#x8C03;&#x7528;<strong>View</strong>&#x4E2D;&#x63A5;&#x53E3;&#x4F20;&#x56DE;&#x7ED9;<strong>View</strong>&#x5C42;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x7B80;&#x5355;&#x7684;&#x5B9E;&#x73B0;&#x4E86;<strong>MVP</strong>&#x4E2D;&#x7684;&#x5408;&#x4F5C;&#x6D41;&#x7A0B;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x4E00;&#x4E2A;&#x660E;&#x663E;&#x7684;&#x597D;&#x5904;&#x5C31;&#x662F;&#x628A;&#x6570;&#x636E;&#x64CD;&#x4F5C;&#x4E0E;&#x4E3B;&#x754C;&#x9762;&#x5206;&#x79BB;&#xFF0C;&#x5B8C;&#x5168;&#x9694;&#x79BB;&#x6570;&#x636E;&#x64CD;&#x4F5C;&#xFF0C;&#x4F7F;&#x5F97;&#x5404;&#x4E2A;&#x529F;&#x80FD;&#x5B9E;&#x73B0;&#x6A21;&#x5757;&#x5316;&#xFF0C;&#x964D;&#x4F4E;&#x4ED6;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x8026;&#x5408;&#x6027;&#xFF0C;&#x53EA;&#x8981;&#x547D;&#x540D;&#x5408;&#x7406;&#x5C31;&#x80FD;&#x8FC5;&#x901F;&#x660E;&#x767D;&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x4F5C;&#x7528;&#x3002;&#x4E0B;&#x9762;&#x4EE5;&#x8BE5;&#x9879;&#x76EE;&#x4E3A;&#x4F8B;&#x3002;</p>\n<blockquote>\n<p><em>&#x672C;&#x6765;&#x60F3;&#x4EE5;&#x4E3B;&#x6846;&#x67B6;&#x4E3A;&#x4F8B;&#x7684;&#xFF0C;&#x4F46;&#x4E3B;&#x6846;&#x67B6;&#x76EE;&#x524D;&#x6CA1;&#x6709;Model&#x5C42;&#xFF0C;&#x6240;&#x4EE5;&#x4E0B;&#x9762;&#x4EE5;&#x5FAE;&#x4FE1;&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x804A;&#x5929;&#x5FAE;&#x4FE1;&#x7A97;&#x53E3;&#x4E3A;&#x4F8B;&#xFF0C;&#x7528;MVP&#x6765;&#x5B9E;&#x73B0;</em></p>\n</blockquote>\n<h2 id=\"View&#x5C42;\"><a href=\"#View&#x5C42;\" class=\"headerlink\" title=\"View&#x5C42;\"></a>View&#x5C42;</h2><p>&#x5F53;&#x6211;&#x4EEC;&#x6253;&#x5F00;&#x5FAE;&#x4FE1;&#x804A;&#x5929;&#x754C;&#x9762;&#x65F6;&#xFF0C;&#x8981;&#x5148;&#x8C03;&#x7528;&#x8BBE;&#x7F6E;&#x6570;&#x636E;&#x7684;&#x65B9;&#x6CD5;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x5176;&#x4E2D;&#x5B9E;&#x73B0;&#x8BBE;&#x7F6E;&#x6570;&#x636E;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface WXView {</span><br><span class=\"line\">    void setData(List&lt;WXItemInfo&gt; list);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x76F8;&#x4FE1;&#x5927;&#x5BB6;&#x4E00;&#x770B;&#x65B9;&#x6CD5;&#x540D;&#x5C31;&#x80FD;&#x5F88;&#x597D;&#x7406;&#x89E3;&#x8BE5;&#x65B9;&#x6CD5;&#x8981;&#x505A;&#x7684;&#x64CD;&#x4F5C;&#x4E86;</em></p>\n</blockquote>\n<h2 id=\"Model&#x5C42;\"><a href=\"#Model&#x5C42;\" class=\"headerlink\" title=\"Model&#x5C42;\"></a>Model&#x5C42;</h2><p>&#x65E2;&#x7136;&#x8BE5;&#x5C42;&#x662F;&#x5B9E;&#x73B0;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x81EA;&#x7136;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x5B9E;&#x73B0;&#x52A0;&#x8F7D;&#x6570;&#x636E;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface WXModel {</span><br><span class=\"line\">    List&lt;WXItemInfo&gt; initData();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5B9A;&#x4E49;&#x5B8C;&#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x518D;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x7C7B;&#x5B9E;&#x73B0;&#x8BE5;&#x63A5;&#x53E3;&#xFF0C;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x7684;&#x52A0;&#x8F7D;&#xFF1B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class WXModleImp implements WXModel{</span><br><span class=\"line\">    private List&lt;WXItemInfo&gt; mList;</span><br><span class=\"line\">    private WXItemInfo wxItemInfo;</span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public List&lt;WXItemInfo&gt; initData() {</span><br><span class=\"line\">        mList = new ArrayList&lt;&gt;();</span><br><span class=\"line\">        for (int i = 0; i &lt; 10; i++) {</span><br><span class=\"line\">            wxItemInfo = new WXItemInfo();</span><br><span class=\"line\">            wxItemInfo.setTitle(&quot;&#x6D4B;&#x8BD5;&#x6807;&#x9898;&quot; + i);</span><br><span class=\"line\">            wxItemInfo.setContent(&quot;&#x6D4B;&#x8BD5;&#x5185;&#x5BB9;&quot; + i);</span><br><span class=\"line\">            wxItemInfo.setTime(i + &quot;:11&quot;);</span><br><span class=\"line\">            mList.add(wxItemInfo);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        return mList;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x73B0;&#x5728;&#x4E3A;&#x4E86;&#x6D4B;&#x8BD5;&#xFF0C;&#x6240;&#x4EE5;&#x505A;&#x4E86;&#x5047;&#x6570;&#x636E;&#x3002;&#x73B0;&#x5728;&#x662F;&#x4E0D;&#x662F;&#x660E;&#x767D;&#x4E86;&#x4E00;&#x70B9;&#x5462;&#xFF1F;&#x53EA;&#x8981;&#x6211;&#x4EEC;&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#x76F8;&#x5173;&#x64CD;&#x4F5C;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x63A5;&#x53E3;&#x4E2D;&#x5728;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x8BE5;&#x64CD;&#x4F5C;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5728;<strong>WXModelImp</strong>&#x4E2D;&#x5B9E;&#x73B0;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p>\n<h2 id=\"Presenter&#x5C42;\"><a href=\"#Presenter&#x5C42;\" class=\"headerlink\" title=\"Presenter&#x5C42;\"></a>Presenter&#x5C42;</h2><p>&#x5230;&#x8FD9;&#x91CC;&#x662F;&#x4E0D;&#x662F;&#x60F3;&#x5230;&#x4E5F;&#x8981;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x76F8;&#x5173;&#x63A5;&#x53E3;&#xFF0C;&#x4EE5;&#x4FBF;&#x5B9E;&#x73B0;&#x76F8;&#x5173;&#x65B9;&#x6CD5;&#xFF0C;&#x6CA1;&#x9519;&#x5C31;&#x662F;&#x8FD9;&#x6837;&#xFF0C;&#x5B9E;&#x73B0;&#x7684;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x628A;<strong>View</strong>&#x4E0E;<strong>Model</strong>&#x8FDE;&#x63A5;&#x8D77;&#x6765;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface WXPresent {</span><br><span class=\"line\">    void loadData();</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x7C7B;&#x5B9E;&#x73B0;&#x8BE5;&#x63A5;&#x53E3;,&#x5728;&#x5176;&#x4E2D;&#x5F15;&#x7528;<strong>View</strong>&#x4E0E;<strong>Model</strong>&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class WXPresentImp implements WXPresent{</span><br><span class=\"line\"></span><br><span class=\"line\">    private WXModel mWXModle;</span><br><span class=\"line\">    private WXView mWXView;</span><br><span class=\"line\">    private List&lt;WXItemInfo&gt; mList;</span><br><span class=\"line\"></span><br><span class=\"line\">    public WXPresentImp(WXView wxView) {</span><br><span class=\"line\">        mWXView = wxView;</span><br><span class=\"line\">        mWXModle = new WXModleImp();</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void loadData() {</span><br><span class=\"line\">        mList = mWXModle.initData();</span><br><span class=\"line\">        mWXView.setData(mList);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5230;&#x8FD9;&#x91CC;&#x57FA;&#x672C;&#x7684;<strong>MVP</strong>&#x5C31;&#x8981;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x6700;&#x540E;&#x53EA;&#x8981;&#x5728;&#x5FAE;&#x4FE1;&#x804A;&#x5929;&#x754C;&#x9762;&#x5B9E;&#x73B0;<strong>View</strong>&#x5C42;&#x7684;<strong>WXView</strong>&#x63A5;&#x53E3;&#x5728;&#x5176;&#x4E2D;&#x586B;&#x5145;&#x6570;&#x636E;&#xFF0C;&#x5B9E;&#x4F8B;&#x5316;<strong>Presenter</strong>&#x5C42;&#x7684;<strong>WXPresentImp</strong>&#x7C7B;&#xFF0C;&#x8C03;&#x7528;&#x5176;&#x65B9;&#x6CD5;<strong>loadData()</strong>&#xFF1B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class WXFragment extends Fragment implements WXView{</span><br><span class=\"line\">    @InjectView(R.id.wx_recyclerView)</span><br><span class=\"line\">    RecyclerView wxRecyclerView;</span><br><span class=\"line\">    private WXAdapter wxAdapter;</span><br><span class=\"line\">    private WXPresentImp mWXPresentImp;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Nullable</span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {</span><br><span class=\"line\">        View view = LayoutInflater.from(getContext()).inflate(R.layout.wx_layout, null);</span><br><span class=\"line\">        ButterKnife.inject(this, view);</span><br><span class=\"line\">        wxAdapter = new WXAdapter(getContext());</span><br><span class=\"line\">        mWXPresentImp = new WXPresentImp(this);</span><br><span class=\"line\">        mWXPresentImp.loadData();</span><br><span class=\"line\">        wxRecyclerView.setLayoutManager(new LinearLayoutManager(getContext()));</span><br><span class=\"line\">        wxRecyclerView.addItemDecoration(new WXItemDecoration(getContext()));</span><br><span class=\"line\">        wxRecyclerView.setAdapter(wxAdapter);</span><br><span class=\"line\">        return view;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void onDestroyView() {</span><br><span class=\"line\">        super.onDestroyView();</span><br><span class=\"line\">        ButterKnife.reset(this);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void setData(List&lt;WXItemInfo&gt; list) {</span><br><span class=\"line\">       wxAdapter.addData(list);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x5230;&#x8FD9;&#x91CC;&#x6574;&#x4E2A;&#x7684;&#x5FAE;&#x4FE1;&#x804A;&#x5929;&#x7684;<strong>MVP</strong>&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x56DE;&#x8FC7;&#x53BB;&#x518D;&#x6574;&#x7406;&#x4E0B;&#x601D;&#x8DEF;&#x53D1;&#x73B0;&#x662F;&#x4E0D;&#x662F;&#x6E05;&#x695A;&#x4E86;&#x5F88;&#x591A;&#x3002;&#x4E00;&#x65E6;&#x4F60;&#x5B9E;&#x73B0;&#x4E86;<strong>MVP</strong>&#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#x660E;&#x4E86;&#xFF0C;&#x601D;&#x8DEF;&#x6E05;&#x6670;&#x3002;&#x540E;&#x9762;&#x9879;&#x76EE;&#x7684;&#x5DE5;&#x7A0B;&#x91CF;&#x5927;&#x4E86;&#xFF0C;&#x66F4;&#x52A0;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x5F88;&#x597D;&#x7684;&#x6A21;&#x5F0F;&#x4E86;&#x7BA1;&#x7406;&#x9879;&#x76EE;&#x3002;&#x6240;&#x4EE5;&#x8FD8;&#x662F;&#x503C;&#x5F97;&#x63A8;&#x8350;&#x7684;&#x3002;</p>\n<h2 id=\"&#x6548;&#x679C;&#x56FE;\"><a href=\"#&#x6548;&#x679C;&#x56FE;\" class=\"headerlink\" title=\"&#x6548;&#x679C;&#x56FE;\"></a>&#x6548;&#x679C;&#x56FE;</h2><p><img src=\"/2016/04/23/Android&#x9AD8;&#x4EFF;&#x5FAE;&#x4FE1;&#x4E4B;mvp&#x5B9E;&#x73B0;-&#x4E00;/1.gif\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<p>&#x9879;&#x76EE;&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/idisfkj/HightCopyWX\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/HightCopyWX</a></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["高仿"]},{"title":"Android二维码扫描","url":"https://www.rousetime.com/2016/04/16/Android二维码扫描/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p>&#x5FAE;&#x4FE1;&#x7684;&#x4E8C;&#x7EF4;&#x7801;&#x626B;&#x63CF;&#x7528;&#x7684;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#xFF0C;&#x6240;&#x4EE5;&#x6700;&#x8FD1;&#x5C31;&#x60F3;&#x5F04;&#x660E;&#x767D;&#x5B83;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x4E8E;&#x662F;&#x627E;&#x4E86;&#x70B9;&#x8D44;&#x6599;&#xFF0C;&#x53D1;&#x73B0;&#x90FD;&#x662F;&#x8BF4;&#x4F7F;&#x7528;zxing&#x7684;&#x5F00;&#x6E90;&#x5E93;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x5F3A;&#x5927;&#x7684;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#xFF0C;&#x5F15;&#x7528;&#x8BE5;&#x9879;&#x76EE;&#x53EA;&#x8981;&#x7B80;&#x5355;&#x7684;&#x51E0;&#x6B65;&#x4EE3;&#x7801;&#x5C31;&#x80FD;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4E8C;&#x7EF4;&#x7801;&#x626B;&#x63CF;&#x4E0E;&#x751F;&#x6210;&#x7684;&#x6548;&#x679C;&#x3002;&#x8FD9;&#x91CC;&#x505A;&#x70B9;&#x7B14;&#x8BB0;&#x8BB0;&#x4E0B;&#xFF0C;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x7684;&#x4E5F;&#x53EF;&#x4EE5;&#x6765;&#x5B66;&#x4E60;&#x4E0B;&#x3002;</p>\n<h2 id=\"&#x51C6;&#x5907;&#x5DE5;&#x4F5C;\"><a href=\"#&#x51C6;&#x5907;&#x5DE5;&#x4F5C;\" class=\"headerlink\" title=\"&#x51C6;&#x5907;&#x5DE5;&#x4F5C;\"></a>&#x51C6;&#x5907;&#x5DE5;&#x4F5C;</h2><p>&#x5148;&#x4E0B;&#x8F7D;zxing&#x9879;&#x76EE;&#xFF0C;&#x4E0D;&#x8FC7;&#x63A8;&#x8350;&#x4E0B;&#x8F7D;&#x7CBE;&#x7B80;&#x7248;&#xFF0C;<strong>BarCodeTest</strong>&#x8FD9;&#x4E2A;&#x5C31;&#x8DB3;&#x591F;&#x5B9E;&#x73B0;&#x8BE5;&#x529F;&#x80FD;&#x4E86;&#x3002;&#x628A;&#x4E0B;&#x8F7D;&#x7684;&#x9879;&#x76EE;&#x6DFB;&#x52A0;&#x5230;&#x81EA;&#x5DF1;&#x9879;&#x76EE;&#x7684;&#x4F9D;&#x8D56;&#x4E2D;&#xFF0C;&#x5F15;&#x7528;&#x8BE5;&#x9879;&#x76EE;&#x3002;&#x5982;&#x4F55;&#x6DFB;&#x52A0;Module&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#x76F8;&#x4FE1;&#x5927;&#x5BB6;&#x90FD;&#x80FD;&#x81EA;&#x5DF1;&#x89E3;&#x51B3;&#x3002;&#x4E0B;&#x9762;&#x8FDB;&#x884C;&#x5B9E;&#x73B0;&#x64CD;&#x4F5C;&#x3002;</p>\n<h2 id=\"&#x626B;&#x63CF;&#x4E8C;&#x7EF4;&#x7801;\"><a href=\"#&#x626B;&#x63CF;&#x4E8C;&#x7EF4;&#x7801;\" class=\"headerlink\" title=\"&#x626B;&#x63CF;&#x4E8C;&#x7EF4;&#x7801;\"></a>&#x626B;&#x63CF;&#x4E8C;&#x7EF4;&#x7801;</h2><p>&#x56E0;&#x4E3A;&#x662F;&#x5F15;&#x7528;&#x522B;&#x4EBA;&#x7684;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x80FD;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x4F7F;&#x7528;&#x522B;&#x4EBA;&#x5B9A;&#x4E49;&#x597D;&#x7684;&#x7C7B;&#x6765;&#x5B9E;&#x73B0;&#x8BE5;&#x529F;&#x80FD;&#xFF0C;&#x8FD9;&#x91CC;&#x7528;&#x5230;&#x7684;&#x4E3B;&#x8981;&#x662F;<strong>CaptureActivit</strong>&#x7C7B;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x8981;&#x626B;&#x63CF;&#x65F6;&#x8DF3;&#x8F6C;&#x5230;&#x8BE5;&#x7C7B;&#x5F00;&#x542F;&#x626B;&#x63CF;&#x529F;&#x80FD;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//&#x6253;&#x5F00;&#x626B;&#x63CF;&#x754C;&#x9762;&#x626B;&#x63CF;&#x6761;&#x5F62;&#x7801;&#x6216;&#x4E8C;&#x7EF4;&#x7801;</span><br><span class=\"line\">Intent openCameraIntent = new Intent(BarCodeTestActivity.this,CaptureActivity.class);</span><br><span class=\"line\">\t\t\t\tstartActivityForResult(openCameraIntent, 0);</span><br></pre></td></tr></table></figure>\n<p>&#x91CD;&#x5199;<strong>onActivityResult</strong>&#x65B9;&#x6CD5;&#xFF0C;&#x901A;&#x8FC7;<strong>TextView</strong>&#x663E;&#x793A;&#x51FA;&#x626B;&#x63CF;&#x7684;&#x7ED3;&#x679C;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">\tprotected void onActivityResult(int requestCode, int resultCode, Intent data) {</span><br><span class=\"line\">\t\tsuper.onActivityResult(requestCode, resultCode, data);</span><br><span class=\"line\">\t\t//&#x5904;&#x7406;&#x626B;&#x63CF;&#x7ED3;&#x679C;&#xFF08;&#x5728;&#x754C;&#x9762;&#x4E0A;&#x663E;&#x793A;&#xFF09;</span><br><span class=\"line\">\t\tif (resultCode == RESULT_OK) {</span><br><span class=\"line\">\t\t\tBundle bundle = data.getExtras();</span><br><span class=\"line\">\t\t\tString scanResult = bundle.getString(&quot;result&quot;);</span><br><span class=\"line\">\t\t\tresultTextView.setText(scanResult);</span><br><span class=\"line\">\t\t}</span><br><span class=\"line\">\t}</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x901A;&#x8FC7;<strong>bundle.getString(&#x201C;result&#x201D;)</strong>&#x5C31;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x626B;&#x63CF;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;<strong>CaptureActivity</strong>&#x4E2D;&#x7684;<strong>handleDecode</strong>&#x5DF2;&#x7ECF;&#x5BF9;&#x5176;&#x505A;&#x4E86;&#x5904;&#x7406;:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void handleDecode(Result result, Bitmap barcode) {</span><br><span class=\"line\">\t\tinactivityTimer.onActivity();</span><br><span class=\"line\">\t\tplayBeepSoundAndVibrate();</span><br><span class=\"line\">\t\tString resultString = result.getText();</span><br><span class=\"line\">\t\t//FIXME</span><br><span class=\"line\">\t\tif (resultString.equals(&quot;&quot;)) {</span><br><span class=\"line\">\t\t\tToast.makeText(CaptureActivity.this, &quot;Scan failed!&quot;, Toast.LENGTH_SHORT).show();</span><br><span class=\"line\">\t\t}else {</span><br><span class=\"line\">//\t\t\tSystem.out.println(&quot;Result:&quot;+resultString);</span><br><span class=\"line\">\t\t\tIntent resultIntent = new Intent();</span><br><span class=\"line\">\t\t\tBundle bundle = new Bundle();</span><br><span class=\"line\">\t\t\tbundle.putString(&quot;result&quot;, resultString);</span><br><span class=\"line\">\t\t\tresultIntent.putExtras(bundle);</span><br><span class=\"line\">\t\t\tthis.setResult(RESULT_OK, resultIntent);</span><br><span class=\"line\">\t\t}</span><br><span class=\"line\">\t\tCaptureActivity.this.finish();</span><br><span class=\"line\">\t}</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x626B;&#x63CF;&#x7684;&#x529F;&#x80FD;&#x5230;&#x8FD9;&#x91CC;&#x5C31;&#x7ED3;&#x675F;&#x4E86;</em></p>\n</blockquote>\n<h2 id=\"&#x751F;&#x6210;&#x4E8C;&#x7EF4;&#x7801;\"><a href=\"#&#x751F;&#x6210;&#x4E8C;&#x7EF4;&#x7801;\" class=\"headerlink\" title=\"&#x751F;&#x6210;&#x4E8C;&#x7EF4;&#x7801;\"></a>&#x751F;&#x6210;&#x4E8C;&#x7EF4;&#x7801;</h2><p>&#x8FD9;&#x91CC;&#x751F;&#x6210;&#x4E8C;&#x7EF4;&#x7801;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x662F;&#x8981;&#x8C03;&#x7528;&#x8BE5;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#x7684;<strong>EncodingHandler</strong>&#x7684;<strong>createQRCode</strong>&#x65B9;&#x6CD5;&#x751F;&#x6210;Bitmap&#x5BF9;&#x8C61;,&#x901A;&#x8FC7;ImageView&#x663E;&#x793A;&#x51FA;&#x6765;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">try {</span><br><span class=\"line\">                    String contentString = qrStrEditText.getText().toString();</span><br><span class=\"line\">                    if (!contentString.equals(&quot;&quot;)) {</span><br><span class=\"line\">                        //&#x6839;&#x636E;&#x5B57;&#x7B26;&#x4E32;&#x751F;&#x6210;&#x4E8C;&#x7EF4;&#x7801;&#x56FE;&#x7247;&#x5E76;&#x663E;&#x793A;&#x5728;&#x754C;&#x9762;&#x4E0A;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x4E3A;&#x56FE;&#x7247;&#x7684;&#x5927;&#x5C0F;&#xFF08;450*450&#xFF09;</span><br><span class=\"line\">                        Bitmap qrCodeBitmap = EncodingHandler.createQRCode(contentString, 450);</span><br><span class=\"line\">                        qrImgImageView.setImageBitmap(qrCodeBitmap);</span><br><span class=\"line\">                    } else {</span><br><span class=\"line\">                        Toast.makeText(BarCodeTestActivity.this, &quot;Text can not be empty&quot;, Toast.LENGTH_SHORT).show();</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                } catch (WriterException e) {</span><br><span class=\"line\">                    // TODO Auto-generated catch block</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x662F;&#x4E0D;&#x662F;&#x611F;&#x89C9;&#x592A;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x6CA1;&#x9519;&#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#xFF0C;&#x5176;&#x5B9E;&#x521A;&#x5F00;&#x59CB;&#x4E86;&#x89E3;&#x7684;&#x65F6;&#x5019;&#x4E5F;&#x60CA;&#x5446;&#x4E86;&#xFF0C;&#x4E0D;&#x7981;&#x611F;&#x53F9;&#x5F00;&#x6E90;&#x771F;&#x662F;&#x725B;&#x53C9;&#x554A;&#xFF01;</em></p>\n</blockquote>\n<h2 id=\"&#x754C;&#x9762;&#x4FEE;&#x6539;\"><a href=\"#&#x754C;&#x9762;&#x4FEE;&#x6539;\" class=\"headerlink\" title=\"&#x754C;&#x9762;&#x4FEE;&#x6539;\"></a>&#x754C;&#x9762;&#x4FEE;&#x6539;</h2><p>&#x5176;&#x5B9E;&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x5B9E;&#x73B0;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x529F;&#x80FD;&#x662F;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x4F46;&#x754C;&#x9762;&#x771F;&#x662F;&#x770B;&#x4E0D;&#x8FC7;&#x53BB;&#x4E86;&#xFF0C;&#x611F;&#x89C9;&#x77AC;&#x95F4;&#x56DE;&#x5230;&#x4E86;&#x89E3;&#x653E;&#x524D;&#x4F3C;&#x5F97;&#xFF0C;&#x6709;&#x6728;&#x6709;&#x8FD9;&#x79CD;&#x611F;&#x89C9;&#x3002;&#x770B;&#x591A;&#x4E86;&#x5FAE;&#x4FE1;&#x7684;&#x4E8C;&#x7EF4;&#x7801;&#x626B;&#x63CF;&#xFF0C;&#x4E00;&#x4E0B;&#x770B;&#x8FD9;&#x4E48;low&#x6211;&#x5B9E;&#x5728;&#x662F;&#x770B;&#x4E0D;&#x60EF;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x7684;&#x505A;&#x4E0B;&#x4FEE;&#x6539;&#x3002;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x627E;&#x5230;<strong>CameraManager</strong>&#x7C7B;&#xFF0C;&#x5728;&#x8BE5;&#x7C7B;&#x4E2D;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x662F;&#x4FEE;&#x6539;&#x4E0B;&#x626B;&#x63CF;&#x6846;&#x7684;&#x5927;&#x5C0F;&#xFF08;&#x539F;&#x6765;&#x7684;&#x5B9E;&#x5728;&#x662F;&#x611F;&#x89C9;&#x592A;&#x5C0F;&#x6C14;&#x4E86;&#xFF09;&#x628A;&#x76F8;&#x5E94;&#x7684;&#x53C2;&#x6570;&#x6539;&#x5927;&#x70B9;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x6211;&#x81EA;&#x5DF1;&#x4FEE;&#x6539;&#x7684;&#x5927;&#x5C0F;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private static final int MIN_FRAME_WIDTH = 400;</span><br><span class=\"line\">private static final int MIN_FRAME_HEIGHT = 400;</span><br><span class=\"line\">private static final int MAX_FRAME_WIDTH = 600;</span><br><span class=\"line\">private static final int MAX_FRAME_HEIGHT = 600;</span><br></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x8981;&#x8BE5;&#x7684;&#x5C31;&#x662F;&#x6DFB;&#x52A0;&#x8DDF;&#x5FAE;&#x4FE1;&#x4E00;&#x6837;&#x7684;&#x79FB;&#x52A8;&#x6FC0;&#x5149;&#x6761;&#x3001;&#x56DB;&#x4E2A;&#x89D2;&#x7684;&#x7B80;&#x5355;&#x88C5;&#x9970;&#x4E0E;&#x6587;&#x5B57;&#x663E;&#x793A;&#x3002;&#x6211;&#x4EEC;&#x8981;&#x627E;&#x5230;<strong>ViewfinderView</strong>&#x7C7B;&#xFF0C;&#x5728;<strong>onDraw</strong>&#x65B9;&#x6CD5;&#x4E2D;&#x505A;&#x7ED8;&#x5236;&#x7684;&#x4FEE;&#x6539;&#x3002;&#x9996;&#x5148;&#x628A;&#x539F;&#x6765;&#x7684;&#x63CF;&#x8FB9;&#x7684;&#x989C;&#x8272;&#x6539;&#x6210;&#x7070;&#x8272;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">paint.setColor(Color.GRAY);</span><br><span class=\"line\">      canvas.drawRect(frame.left, frame.top, frame.right + 1, frame.top + 2, paint);</span><br><span class=\"line\">      canvas.drawRect(frame.left, frame.top + 2, frame.left + 2, frame.bottom - 1, paint);</span><br><span class=\"line\">      canvas.drawRect(frame.right - 1, frame.top, frame.right + 1, frame.bottom - 1, paint);</span><br><span class=\"line\">      canvas.drawRect(frame.left, frame.bottom - 1, frame.right + 1, frame.bottom + 1, paint);</span><br></pre></td></tr></table></figure>\n<p>&#x9ED8;&#x8BA4;&#x4E3A;&#x7EFF;&#x8272;&#xFF0C;&#x56E0;&#x4E3A;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x8981;&#x753B;&#x8DDF;&#x5FAE;&#x4FE1;&#x4E00;&#x6837;&#x7684;&#x7EFF;&#x8272;&#x7684;&#x56DB;&#x4E2A;&#x89D2;&#xFF0C;&#x989C;&#x8272;&#x4E00;&#x6837;&#x5C31;&#x6709;&#x70B9;&#x4E0D;&#x534F;&#x8C03;&#x4E86;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//&#x753B;&#x626B;&#x63CF;&#x6846;&#x7684;&#x56DB;&#x4E2A;&#x88C5;&#x9970;&#x89D2;</span><br><span class=\"line\">      paint.setColor(FRAME_COLOR);</span><br><span class=\"line\">      canvas.drawRect(frame.left, frame.top, frame.left + FRAME_WIDTH, frame.top + FRAME_HEIGHT, paint);</span><br><span class=\"line\">      canvas.drawRect(frame.left, frame.top, frame.left + FRAME_HEIGHT, frame.top + FRAME_WIDTH, paint);</span><br><span class=\"line\">      canvas.drawRect(frame.right - FRAME_WIDTH, frame.top, frame.right, frame.top + FRAME_HEIGHT, paint);</span><br><span class=\"line\">      canvas.drawRect(frame.right - FRAME_HEIGHT, frame.top, frame.right, frame.top + FRAME_WIDTH, paint);</span><br><span class=\"line\">      canvas.drawRect(frame.right - FRAME_HEIGHT, frame.bottom - FRAME_WIDTH, frame.right, frame.bottom, paint);</span><br><span class=\"line\">      canvas.drawRect(frame.right - FRAME_WIDTH, frame.bottom - FRAME_HEIGHT, frame.right, frame.bottom, paint);</span><br><span class=\"line\">      canvas.drawRect(frame.left,frame.bottom-FRAME_WIDTH,frame.left+FRAME_HEIGHT,frame.bottom,paint);</span><br><span class=\"line\">      canvas.drawRect(frame.left,frame.bottom-FRAME_HEIGHT,frame.left+FRAME_WIDTH,frame.bottom,paint);</span><br></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x7684;&#x6839;&#x636E;<strong>frame</strong>&#x7684;<strong>top</strong>&#x3001;<strong>left</strong>&#x3001;<strong>right</strong>&#x4E0E;<strong>bottom</strong>&#x53C2;&#x6570;&#x6765;&#x7ED8;&#x5236;&#xFF0C;&#x6BCF;&#x4E2A;&#x89D2;&#x8981;&#x7ED8;&#x5236;&#x4E24;&#x6B21;&#x3002;<strong>FRAME_HEIGHT</strong>&#x4E0E;<strong>FRAME_WIDTH</strong>&#x5206;&#x522B;&#x4E3A;&#x81EA;&#x5DF1;&#x8BBE;&#x7F6E;&#x7684;&#x89D2;&#x7684;&#x5BBD;&#x9AD8;&#x3002;&#x53EF;&#x4EE5;&#x62FF;&#x5FAE;&#x4FE1;&#x7684;&#x5BF9;&#x7167;&#x3002;<br>&#x4E0B;&#x9762;&#x4FEE;&#x6539;&#x6FC0;&#x5149;&#x7EBF;&#xFF0C;&#x628A;&#x539F;&#x6765;&#x7684;&#x6FC0;&#x5149;&#x7ED8;&#x5236;&#x53BB;&#x6389;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//&#x521D;&#x59CB;&#x5316;laser</span><br><span class=\"line\">      if (!isStart){</span><br><span class=\"line\">        isStart = true;</span><br><span class=\"line\">        laserTop = frame.top;</span><br><span class=\"line\">        laserBottom = frame.bottom;</span><br><span class=\"line\">      }</span><br><span class=\"line\">//&#x7ED8;&#x5236;laser</span><br><span class=\"line\">      laserTop += LASER_SPEED;//&#x6BCF;&#x6B21;&#x7684;&#x79FB;&#x52A8;&#x8DDD;&#x79BB;</span><br><span class=\"line\">      if (laserTop &gt;= frame.bottom){</span><br><span class=\"line\">        laserTop = frame.top;</span><br><span class=\"line\">      }</span><br><span class=\"line\">      canvas.drawRect(frame.left + LASER_WIDTH, laserTop - LASER_WIDTH / 2, frame.right - LASER_WIDTH, laserTop + LASER_WIDTH / 2, paint);</span><br><span class=\"line\">      //&#x66F4;&#x65B0;laser&#x5B9E;&#x73B0;&#x79FB;&#x52A8;</span><br><span class=\"line\">      postInvalidateDelayed(ANIMATION_DELAY, frame.left, frame.top, frame.right, frame.bottom);</span><br></pre></td></tr></table></figure>\n<p>&#x81F3;&#x4E8E;&#x6587;&#x5B57;&#x7684;&#x7ED8;&#x5236;&#x4E5F;&#x662F;&#x54CD;&#x5E94;&#x7684;&#x539F;&#x7406;&#xFF0C;&#x627E;&#x5230;&#x8981;&#x7ED8;&#x5236;&#x7684;&#x5750;&#x6807;&#xFF0C;&#x8C03;&#x7528;<strong>canvas.drawText</strong>&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x4E0D;&#x8FC7;&#x753B;&#x7B14;<strong>paint.setTextSize()</strong>&#x5355;&#x4F4D;&#x662F;px&#xFF08;&#x50CF;&#x7D20;&#xFF09;&#xFF0C;&#x8FD9;&#x70B9;&#x611F;&#x89C9;&#x6709;&#x70B9;&#x9EBB;&#x70E6;&#xFF0C;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x5206;&#x8FA8;&#x7387;&#x7684;&#x673A;&#x578B;&#x4E0B;&#x5B57;&#x4F53;&#x7684;&#x5927;&#x5C0F;&#x4F1A;&#x76F8;&#x5DEE;&#x5F88;&#x5927;&#x3002;&#x3002;&#x6709;&#x70B9;&#x86CB;&#x75BC;&#x3002;&#x5E0C;&#x671B;&#x6709;&#x597D;&#x7684;&#x89E3;&#x51B3;&#x7684;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x544A;&#x8BC9;&#x6211;&#x3002;</p>\n<h2 id=\"&#x6548;&#x679C;&#x56FE;\"><a href=\"#&#x6548;&#x679C;&#x56FE;\" class=\"headerlink\" title=\"&#x6548;&#x679C;&#x56FE;\"></a>&#x6548;&#x679C;&#x56FE;</h2><p><img src=\"/2016/04/16/Android&#x4E8C;&#x7EF4;&#x7801;&#x626B;&#x63CF;/1.gif\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<blockquote>\n<p><em>&#x6587;&#x5B57;&#x6211;&#x6CA1;&#x6709;&#x8C03;&#xFF0C;&#x81EA;&#x5DF1;&#x53EF;&#x4EE5;&#x8C03;&#x4E0B;&#x3002;&#x6211;&#x662F;&#x6309;&#x6211;&#x624B;&#x673A;&#x5C45;&#x4E2D;&#x6765;&#x8C03;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;768 x 1280&#x7684;&#xFF0C;&#x6587;&#x5B57;&#x5B8C;&#x5168;&#x53D8;&#x6837;&#x4E86;&#x3002;&#x3002;&#x3002;</em> </p>\n</blockquote>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["二维码"]},{"title":"php与android的简单交互","url":"https://www.rousetime.com/2016/04/09/php与android的简单交互/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p><strong>web</strong>&#x5F00;&#x53D1;&#x6709;&#x524D;&#x6BB5;&#x4E0E;&#x540E;&#x7AEF;&#x4E4B;&#x5206;&#xFF0C;&#x5176;&#x5B9E;<strong>android</strong>&#x4E5F;&#x6709;&#x524D;&#x540E;&#x7AEF;&#x4E4B;&#x5206;&#x3002;<strong>android</strong>&#x5F00;&#x53D1;&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x624B;&#x673A;<strong>App</strong>&#x7684;&#x524D;&#x7AEF;&#x3002;&#x4E00;&#x822C;&#x90FD;&#x662F;<strong>php+android</strong>&#x6216;&#x8005;<strong>jsp+android</strong>&#x5F00;&#x53D1;&#xFF0C;&#x6240;&#x4EE5;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5408;&#x683C;&#x7684;<strong>android</strong>&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x6709;&#x5FC5;&#x8981;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;<strong>android</strong>&#x4E0E;&#x540E;&#x7AEF;&#x7684;&#x7B80;&#x5355;&#x4EA4;&#x4E92;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4EE5;<strong>php+android</strong>&#x4EA4;&#x4E92;&#x7684;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x3002;</p>\n<h2 id=\"PHP&#x6570;&#x636E;&#x63A5;&#x53E3;&#x7684;&#x5B9A;&#x4E49;\"><a href=\"#PHP&#x6570;&#x636E;&#x63A5;&#x53E3;&#x7684;&#x5B9A;&#x4E49;\" class=\"headerlink\" title=\"PHP&#x6570;&#x636E;&#x63A5;&#x53E3;&#x7684;&#x5B9A;&#x4E49;\"></a>PHP&#x6570;&#x636E;&#x63A5;&#x53E3;&#x7684;&#x5B9A;&#x4E49;</h2><p><strong>php</strong>&#x7AEF;&#x7684;&#x5F00;&#x53D1;&#x4E3B;&#x8981;&#x662F;&#x5B9E;&#x73B0;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x6570;&#x636E;&#x5236;&#x5B9A;&#x6210;<strong>json</strong>&#x7C7B;&#x578B;&#xFF0C;&#x5236;&#x5B9A;&#x4F9B;<strong>android</strong>&#x83B7;&#x53D6;&#x7684;&#x63A5;&#x53E3;&#x3002;&#x81F3;&#x4E8E;&#x4E3A;&#x4EC0;&#x4E48;&#x5236;&#x5B9A;&#x6210;json&#x7C7B;&#x578B;&#xFF0C;&#x76F8;&#x4FE1;&#x5927;&#x5BB6;&#x90FD;&#x660E;&#x767D;&#xFF0C;&#x73B0;&#x5728;<strong>android</strong>&#x7AEF;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x83B7;&#x53D6;&#x7684;&#x6570;&#x636E;&#x90FD;&#x662F;&#x4EE5;<strong>json</strong>&#x7684;&#x683C;&#x5F0F;&#x5C01;&#x88C5;&#x7684;&#x3002;&#x597D;&#x4E86;&#x4E0B;&#x9762;&#x5F00;&#x59CB;&#x64CD;&#x4F5C;&#x3002;</p>\n<h3 id=\"&#x6570;&#x636E;&#x5E93;&#x8868;&#x7684;&#x5EFA;&#x7ACB;\"><a href=\"#&#x6570;&#x636E;&#x5E93;&#x8868;&#x7684;&#x5EFA;&#x7ACB;\" class=\"headerlink\" title=\"&#x6570;&#x636E;&#x5E93;&#x8868;&#x7684;&#x5EFA;&#x7ACB;\"></a>&#x6570;&#x636E;&#x5E93;&#x8868;&#x7684;&#x5EFA;&#x7ACB;</h3><p>&#x9996;&#x5148;&#x5EFA;&#x8868;&#x5B9A;&#x4E49;&#x597D;&#x63D0;&#x4F9B;&#x8BF7;&#x6C42;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x7B80;&#x5355;&#x70B9;&#xFF0C;&#x4E0A;&#x5F20;&#x56FE;&#xFF1A;</p>\n<p><img src=\"/2016/04/09/php&#x4E0E;android&#x7684;&#x7B80;&#x5355;&#x4EA4;&#x4E92;/1.png\" alt=\"iamge\"></p>\n<h3 id=\"&#x6570;&#x636E;&#x5E93;&#x7684;&#x8FDE;&#x63A5;\"><a href=\"#&#x6570;&#x636E;&#x5E93;&#x7684;&#x8FDE;&#x63A5;\" class=\"headerlink\" title=\"&#x6570;&#x636E;&#x5E93;&#x7684;&#x8FDE;&#x63A5;\"></a>&#x6570;&#x636E;&#x5E93;&#x7684;&#x8FDE;&#x63A5;</h3><p>&#x5EFA;&#x5B8C;&#x8868;&#x540E;&#x6211;&#x4EEC;&#x5C31;&#x5F00;&#x59CB;&#x5728;<strong>PHP</strong>&#x4E2D;&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x4EE5;<strong>pdo</strong>&#x7684;&#x8FDE;&#x63A5;&#x65B9;&#x5F0F;&#x4E3A;&#x4F8B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">/**</span><br><span class=\"line\"> * &#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;</span><br><span class=\"line\"> */</span><br><span class=\"line\"></span><br><span class=\"line\">try{</span><br><span class=\"line\">    $pdo = new PDO(&quot;mysql:host=localhost:3306;dbname=blog;&quot;,&quot;root&quot;,&quot;666666&quot;);</span><br><span class=\"line\">    //&#x8BBE;&#x7F6E;&#x7F16;&#x7801;</span><br><span class=\"line\">    $pdo-&gt;exec(&quot;set names utf8&quot;);</span><br><span class=\"line\">}catch(PDOException $e){</span><br><span class=\"line\">    die(&quot;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x5931;&#x8D25;&quot;.$e-&gt;getMessage());</span><br><span class=\"line\">}</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n<p>&#x53EA;&#x8981;&#x4F20;&#x5165;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x540D;&#xFF0C;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x5BC6;&#x7801;&#x5373;&#x53EF;&#x3002;</p>\n<h3 id=\"&#x83B7;&#x53D6;&#x4E0E;&#x5236;&#x5B9A;json\"><a href=\"#&#x83B7;&#x53D6;&#x4E0E;&#x5236;&#x5B9A;json\" class=\"headerlink\" title=\"&#x83B7;&#x53D6;&#x4E0E;&#x5236;&#x5B9A;json\"></a>&#x83B7;&#x53D6;&#x4E0E;&#x5236;&#x5B9A;json</h3><p>&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x904D;&#x5386;&#x8868;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x6570;&#x636E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$sql = &quot;SELECT * FROM blog&quot;;</span><br></pre></td></tr></table></figure>\n<p>&#x67E5;&#x8BE2;&#x4E0E;&#x904D;&#x5386;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$stmt = $pdo-&gt;query($sql);</span><br><span class=\"line\">while($row = $stmt-&gt;fetch(PDO::FETCH_ASSOC)){</span><br><span class=\"line\">    $list[&quot;blog&quot;][] = $row;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x5C06;&#x83B7;&#x53D6;&#x5230;&#x7684;&#x6570;&#x636E;&#x8F6C;&#x5C01;&#x88C5;&#x6210;json&#x7C7B;&#x578B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print_r(json_encode($list));</span><br></pre></td></tr></table></figure>\n<p>&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#x540E;&#x7684;&#x6570;&#x636E;&#x5C31;&#x662F;json&#x7C7B;&#x578B;&#x4E86;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x8BBF;&#x95EE;&#x7684;&#x662F;&#xFF1A;<a href=\"http://192.168.56.1/WebBlog/json/getBlogJson.php&quot;&#xFF08;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x672C;&#x673A;&#x7684;ip&#x5730;&#x5740;&#x4E0E;&#x9879;&#x76EE;&#x5730;&#x5740;&#xFF09;\" target=\"_blank\" rel=\"noopener\">http://192.168.56.1/WebBlog/json/getBlogJson.php&quot;&#xFF08;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x672C;&#x673A;&#x7684;ip&#x5730;&#x5740;&#x4E0E;&#x9879;&#x76EE;&#x5730;&#x5740;&#xFF09;</a><br><img src=\"/2016/04/09/php&#x4E0E;android&#x7684;&#x7B80;&#x5355;&#x4EA4;&#x4E92;/2.png\" alt=\"iamge\"></p>\n<blockquote>\n<p><em>&#x597D;&#x4E86;PHP&#x7AEF;&#x7684;&#x5C31;&#x53EF;&#x4EE5;&#x5230;&#x8FD9;&#x91CC;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x8FDB;&#x5165;android&#x7AEF;</em></p>\n</blockquote>\n<h2 id=\"Android&#x7AEF;&#x6570;&#x636E;&#x83B7;&#x53D6;\"><a href=\"#Android&#x7AEF;&#x6570;&#x636E;&#x83B7;&#x53D6;\" class=\"headerlink\" title=\"Android&#x7AEF;&#x6570;&#x636E;&#x83B7;&#x53D6;\"></a>Android&#x7AEF;&#x6570;&#x636E;&#x83B7;&#x53D6;</h2><p><strong>Android</strong>&#x7AEF;&#x4E3B;&#x8981;&#x7684;&#x662F;<strong>json</strong>&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5EFA;&#x7ACB;&#x4E0E;&#x4ECE;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x5B9A;&#x4E49;&#x7684;&#x501F;&#x53E3;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x8981;&#x7528;&#x5230;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x663E;&#x793A;&#x51FA;&#x6765;&#xFF0C;&#x4E0B;&#x9762;&#x7B80;&#x5355;&#x7684;&#x4ECB;&#x7ECD;&#x4E0B;&#x3002;</p>\n<h3 id=\"Json&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5B9A;&#x4E49;\"><a href=\"#Json&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5B9A;&#x4E49;\" class=\"headerlink\" title=\"Json&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5B9A;&#x4E49;\"></a>Json&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5B9A;&#x4E49;</h3><p>&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x63A8;&#x8350;&#x4E00;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x628A;<strong>GsonFormat</strong>&#x96C6;&#x6210;&#x5230;<strong>AS</strong>&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x65B9;&#x4FBF;&#x7684;&#x751F;&#x6210;&#x5B9E;&#x4F53;&#x7C7B;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x4F7F;&#x7528;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x8981;&#x6839;&#x636E;&#x524D;&#x9762;&#x5B9A;&#x4E49;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x6765;&#x8FDB;&#x884C;&#x4E00;&#x4E00;&#x5BF9;&#x5E94;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x6211;&#x6309;&#x4E0A;&#x9762;&#x7684;&#x7C7B;&#x578B;&#x5B9A;&#x4E49;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private List&lt;BlogBean&gt; blog;</span><br><span class=\"line\"></span><br><span class=\"line\">public List&lt;BlogBean&gt; getBlog() {</span><br><span class=\"line\">    return blog;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\">public void setBlog(List&lt;BlogBean&gt; blog) {</span><br><span class=\"line\">    this.blog = blog;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\">public static class BlogBean {</span><br><span class=\"line\">    private String id;</span><br><span class=\"line\">    private String title;</span><br><span class=\"line\">    private String time;</span><br><span class=\"line\">    private String content_url;</span><br><span class=\"line\">    private String image_url;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getId() {</span><br><span class=\"line\">        return id;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setId(String id) {</span><br><span class=\"line\">        this.id = id;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getTitle() {</span><br><span class=\"line\">        return title;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setTitle(String title) {</span><br><span class=\"line\">        this.title = title;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getTime() {</span><br><span class=\"line\">        return time;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setTime(String time) {</span><br><span class=\"line\">        this.time = time;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getContent_url() {</span><br><span class=\"line\">        return content_url;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setContent_url(String content_url) {</span><br><span class=\"line\">        this.content_url = content_url;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getImage_url() {</span><br><span class=\"line\">        return image_url;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setImage_url(String image_url) {</span><br><span class=\"line\">        this.image_url = image_url;</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x81EA;&#x5B9A;&#x4E49;GsonRequest\"><a href=\"#&#x81EA;&#x5B9A;&#x4E49;GsonRequest\" class=\"headerlink\" title=\"&#x81EA;&#x5B9A;&#x4E49;GsonRequest\"></a>&#x81EA;&#x5B9A;&#x4E49;GsonRequest</h3><p>&#x6211;&#x4EEC;&#x4F7F;&#x7528;<strong>volley</strong>&#x4E0E;<strong>gson</strong>&#x6765;&#x89E3;&#x6790;<strong>json</strong>&#x6570;&#x636E;&#xFF0C;&#x9996;&#x5148;&#x6211;&#x5148;&#x81EA;&#x5B9A;&#x4E49;<strong>GsonRequest</strong>&#xFF0C;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x7EE7;&#x627F;<strong>volley</strong>&#x7684;<strong>Request</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class GsonRequest&lt;T&gt; extends Request&lt;T&gt; {</span><br><span class=\"line\"></span><br><span class=\"line\">    private Class&lt;T&gt; mClass;</span><br><span class=\"line\">    private final Response.Listener&lt;T&gt; mListener;</span><br><span class=\"line\">    private Gson mGson;</span><br><span class=\"line\">    private List&lt;T&gt; mList;</span><br><span class=\"line\"></span><br><span class=\"line\">    public GsonRequest(int method, String url, Class&lt;T&gt; tClass, Response.Listener&lt;T&gt; listener, Response.ErrorListener errorListener) {</span><br><span class=\"line\">        super(method, url, errorListener);</span><br><span class=\"line\">        mClass = tClass;</span><br><span class=\"line\">        mListener = listener;</span><br><span class=\"line\">        mGson = new Gson();</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public GsonRequest(String url, Class&lt;T&gt; tClass, Response.Listener&lt;T&gt; listener, Response.ErrorListener errorListener) {</span><br><span class=\"line\">        this(Method.GET, url, tClass, listener, errorListener);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    protected Response&lt;T&gt; parseNetworkResponse(NetworkResponse networkResponse) {</span><br><span class=\"line\">        try {</span><br><span class=\"line\">            mList = new ArrayList&lt;&gt;();</span><br><span class=\"line\">            String jsonString = new String(networkResponse.data,</span><br><span class=\"line\">                    HttpHeaderParser.parseCharset(networkResponse.headers));</span><br><span class=\"line\">            return Response.success(mGson.fromJson(jsonString, mClass),</span><br><span class=\"line\">                    HttpHeaderParser.parseCacheHeaders(networkResponse));</span><br><span class=\"line\">        } catch (UnsupportedEncodingException e) {</span><br><span class=\"line\">            return Response.error(new ParseError(e));</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    protected void deliverResponse(T t) {</span><br><span class=\"line\">        mListener.onResponse(t);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<h3 id=\"Volley&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x6570;&#x636E;\"><a href=\"#Volley&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x6570;&#x636E;\" class=\"headerlink\" title=\"Volley&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x6570;&#x636E;\"></a>Volley&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x6570;&#x636E;</h3><p>&#x4F7F;&#x7528;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<strong>GsonRequest</strong>&#x6765;&#x8BF7;&#x6C42;&#x6570;&#x636E;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String url = &quot;http://192.168.56.1/WebBlog/json/getBlogJson.php&quot;;</span><br><span class=\"line\">        GsonRequest&lt;BlogInfo&gt; gsonRequest = new GsonRequest&lt;BlogInfo&gt;(url, BlogInfo.class, new Response.Listener&lt;BlogInfo&gt;() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onResponse(BlogInfo info) {</span><br><span class=\"line\">                mList = info.getBlog();</span><br><span class=\"line\">                BlogAdapter mAdapter = new BlogAdapter(MainActivity.this,mList,R.layout.blog_item);</span><br><span class=\"line\">                blogLv.setAdapter(mAdapter);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }, new Response.ErrorListener() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onErrorResponse(VolleyError volleyError) {</span><br><span class=\"line\">                Log.e(&quot;TAG&quot;, volleyError.getMessage(), volleyError);</span><br><span class=\"line\"></span><br><span class=\"line\">            }</span><br><span class=\"line\">        });</span><br><span class=\"line\">        //&#x6DFB;&#x52A0;&#x5230;&#x8BF7;&#x6C42;&#x961F;&#x5217;&#x4E2D;</span><br><span class=\"line\">        RequestManager.addRequest(gsonRequest, &quot;blogRequest&quot;);</span><br></pre></td></tr></table></figure>\n<p>&#x6570;&#x636E;&#x5728;<strong>onResponse</strong>&#x4E2D;&#x8BF7;&#x6C42;&#x5230;&#x4E86;&#xFF0C;&#x5B58;&#x50A8;&#x5230;<strong>List</strong>&#x96C6;&#x5408;&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;<strong>adapter</strong>&#x663E;&#x793A;&#x83B7;&#x53D6;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x5C55;&#x5F00;adapter&#x7684;&#x4F7F;&#x7528;</p>\n<h3 id=\"&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x56FE;&#x7247;&#x4E0E;&#x7F13;&#x5B58;\"><a href=\"#&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x56FE;&#x7247;&#x4E0E;&#x7F13;&#x5B58;\" class=\"headerlink\" title=\"&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x56FE;&#x7247;&#x4E0E;&#x7F13;&#x5B58;\"></a>&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x56FE;&#x7247;&#x4E0E;&#x7F13;&#x5B58;</h3><p>&#x8FD8;&#x662F;&#x8BF4;&#x4E0B;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x56FE;&#x7247;&#x4E0E;&#x56FE;&#x7247;&#x7684;&#x7F13;&#x5B58;&#x5904;&#x7406;&#xFF0C;&#x4E5F;&#x662F;&#x901A;&#x8FC7;<strong>volley</strong>&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4E00;&#x5957;&#x7684;&#x4F7F;&#x7528;<strong>volley</strong>&#x5C31;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x8BB8;&#x591A;&#x57FA;&#x672C;&#x7684;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x3002;<br>&#x4F7F;&#x7528;&#x5230;&#x7684;&#x662F;<strong>LruCache</strong>&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x53EF;&#x4EE5;&#x7EE7;&#x627F;&#x5B83;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">protected int sizeOf(String key, Bitmap value) {</span><br><span class=\"line\">    if (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.HONEYCOMB_MR1){</span><br><span class=\"line\">        return value.getByteCount();</span><br><span class=\"line\">    }</span><br><span class=\"line\">    return value.getRowBytes() * value.getHeight();</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\">@Override</span><br><span class=\"line\">public Bitmap getBitmap(String s) {</span><br><span class=\"line\">    return get(s);</span><br><span class=\"line\">}</span><br><span class=\"line\">   </span><br><span class=\"line\"></span><br><span class=\"line\">@Override</span><br><span class=\"line\">public void putBitmap(String s, Bitmap bitmap) {</span><br><span class=\"line\">    put(s,bitmap);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x518D;&#x81EA;&#x5B9A;&#x4E49;<strong>ImageCacheManager</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class ImageCacheManager {</span><br><span class=\"line\">    private static final int CACHE_SIZE = 1024 * 1024 * ((ActivityManager) App.getAppContext()</span><br><span class=\"line\">            .getSystemService(Context.ACTIVITY_SERVICE)).getMemoryClass() / 8;</span><br><span class=\"line\"></span><br><span class=\"line\">    public ImageCacheManager() {</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    private static ImageLoader mImageLoader = new ImageLoader(RequestManager.mRequestQueue, new BitmapLruCache(CACHE_SIZE));</span><br><span class=\"line\"></span><br><span class=\"line\">    public static ImageLoader.ImageContainer loadImage(String requestUrl, ImageLoader.ImageListener listener, int maxWidth, int maxHeight) {</span><br><span class=\"line\">        return mImageLoader.get(requestUrl, listener, maxWidth, maxHeight);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public static ImageLoader.ImageContainer loadImage(String requestUrl, ImageLoader.ImageListener listener) {</span><br><span class=\"line\">        return loadImage(requestUrl, listener, 0, 0);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public static ImageLoader.ImageListener getImageListener(final ImageView view, final Drawable defaultImageDrawable, final Drawable errorImageDrawable) {</span><br><span class=\"line\">        return new ImageLoader.ImageListener() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onResponse(ImageLoader.ImageContainer imageContainer, boolean b) {</span><br><span class=\"line\">                if (imageContainer.getBitmap() != null) {</span><br><span class=\"line\">                    if (!b &amp;&amp; defaultImageDrawable != null) {</span><br><span class=\"line\">                        TransitionDrawable transitionDrawable = new TransitionDrawable(</span><br><span class=\"line\">                                new Drawable[]{defaultImageDrawable</span><br><span class=\"line\">                                        , new BitmapDrawable(App.getAppContext().getResources(), imageContainer.getBitmap())}</span><br><span class=\"line\">                        );</span><br><span class=\"line\">                        transitionDrawable.setCrossFadeEnabled(true);</span><br><span class=\"line\">                        view.setImageDrawable(transitionDrawable);</span><br><span class=\"line\">                        transitionDrawable.startTransition(100);</span><br><span class=\"line\">                    } else {</span><br><span class=\"line\">                        view.setImageBitmap(imageContainer.getBitmap());</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                } else if (defaultImageDrawable != null) {</span><br><span class=\"line\">                    view.setImageDrawable(defaultImageDrawable);</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\"></span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onErrorResponse(VolleyError volleyError) {</span><br><span class=\"line\">                if (errorImageDrawable != null) {</span><br><span class=\"line\">                    view.setImageDrawable(errorImageDrawable);</span><br><span class=\"line\">                }</span><br><span class=\"line\">                Log.e(&quot;TAG&quot;,volleyError.getMessage());</span><br><span class=\"line\">            }</span><br><span class=\"line\">        };</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F7F;&#x7528;<strong>ImageCacheManager</strong>&#x6765;&#x52A0;&#x8F7D;&#x7F51;&#x7EDC;&#x56FE;&#x7247;&#x4E0E;&#x7F13;&#x5B58;&#x56FE;&#x7247;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ImageCacheManager.loadImage(mList.get(position).getImage_url()</span><br><span class=\"line\">                , ImageCacheManager.getImageListener((ImageView) holder.getView(R.id.item_image)</span><br><span class=\"line\">                , App.getAppContext().getResources().getDrawable(R.drawable.blog_default), App.getAppContext().getResources().getDrawable(R.drawable.blog_default))</span><br><span class=\"line\">                ,0,0);</span><br></pre></td></tr></table></figure>\n<p>&#x5F53;&#x7136;<strong>volley</strong>&#x7684;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x4E0D;&#x6B62;&#x8FD9;&#x4E9B;&#xFF0C;&#x5C31;&#x62FF;&#x56FE;&#x7247;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD8;&#x6709;&#x76F4;&#x63A5;&#x4F7F;&#x7528;<strong>ImageRequest</strong>&#x4E0E;<strong>NetworkImageView</strong>&#xFF0C;&#x672C;&#x6765;&#x8FD8;&#x60F3;&#x8BF4;&#x70B9;<strong>webview</strong>&#x7684;&#x4E00;&#x70B9;&#x77E5;&#x8BC6;&#xFF0C;&#x4ECA;&#x5929;&#x6709;&#x70B9;&#x665A;&#xFF0C;&#x5728;&#x5BBF;&#x820D;&#x8981;&#x65AD;&#x7535;&#x65AD;&#x7F51;&#x4E86;&#xFF0C;&#x5C31;&#x4E0D;&#x5C55;&#x5F00;&#x4E86;&#x3002;<br>&#x8FD8;&#x662F;&#x6267;&#x884C;&#x6211;&#x4E00;&#x8D2F;&#x7684;&#x505A;&#x6CD5;&#x4E0A;&#x5F20;&#x6548;&#x679C;&#x56FE;&#x5427;</p>\n<h2 id=\"&#x6548;&#x679C;&#x56FE;\"><a href=\"#&#x6548;&#x679C;&#x56FE;\" class=\"headerlink\" title=\"&#x6548;&#x679C;&#x56FE;\"></a>&#x6548;&#x679C;&#x56FE;</h2><p><img src=\"/2016/04/09/php&#x4E0E;android&#x7684;&#x7B80;&#x5355;&#x4EA4;&#x4E92;/3.gif\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["php android"]},{"title":"pickerView的开源依赖","url":"https://www.rousetime.com/2016/04/04/pickerView的开源依赖/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p>&#x4E0A;&#x4E2A;&#x6708;&#x7684;&#x6ED1;&#x8F6E;&#x9009;&#x62E9;&#x5668;&#xFF0C;&#x4ECA;&#x5929;&#x6211;&#x628A;&#x5B83;&#x4FEE;&#x6539;&#x4E86;&#x4E0B;&#xFF0C;&#x4E0A;&#x4F20;&#x5230;&#x4E86;&#x5F00;&#x6E90;&#x5E93;&#x4E2D;&#xFF0C;&#x65B9;&#x4FBF;&#x5927;&#x5BB6;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x4E0B;&#x9762;&#x8BF4;&#x4E0B;&#x7B80;&#x5355;&#x7684;&#x53D8;&#x5316;.</p>\n<h2 id=\"&#x5B9E;&#x4F8B;&#x5316;&#x7C7B;&#x7684;&#x6539;&#x53D8;\"><a href=\"#&#x5B9E;&#x4F8B;&#x5316;&#x7C7B;&#x7684;&#x6539;&#x53D8;\" class=\"headerlink\" title=\"&#x5B9E;&#x4F8B;&#x5316;&#x7C7B;&#x7684;&#x6539;&#x53D8;\"></a>&#x5B9E;&#x4F8B;&#x5316;&#x7C7B;&#x7684;&#x6539;&#x53D8;</h2><p>&#x539F;&#x5148;&#x662F;&#x4F7F;&#x7528;TextPicker&#x7C7B;&#x6765;&#x5B9E;&#x4F8B;&#x5316;&#xFF0C;&#x73B0;&#x5728;&#x4FEE;&#x6539;&#x6210;MyPicker.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MyPicker picker = new MyPicker();</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x5BF9;&#x5916;&#x65B9;&#x6CD5;&#x7684;&#x589E;&#x5220;\"><a href=\"#&#x5BF9;&#x5916;&#x65B9;&#x6CD5;&#x7684;&#x589E;&#x5220;\" class=\"headerlink\" title=\"&#x5BF9;&#x5916;&#x65B9;&#x6CD5;&#x7684;&#x589E;&#x5220;\"></a>&#x5BF9;&#x5916;&#x65B9;&#x6CD5;&#x7684;&#x589E;&#x5220;</h2><ul>\n<li>&#x5220;&#x9664;&#x4E86;&#x539F;&#x6765;&#x7684;&#x83B7;&#x53D6;&#x786E;&#x5B9A;&#x63A7;&#x4EF6; getOK()&#x65B9;&#x6CD5;</li>\n<li>&#x589E;&#x52A0;&#x4E86;&#x663E;&#x793A;&#x6ED1;&#x8F6E;&#x9009;&#x62E9;&#x7684;&#x4E2A;&#x6570; setShowNum()&#x65B9;&#x6CD5;</li>\n<li>&#x589E;&#x52A0;&#x4E86;&#x5B8C;&#x6210;&#x76D1;&#x542C;&#x4E8B;&#x4EF6; setSelectedFinishListener()&#x65B9;&#x6CD5;</li>\n</ul>\n<h2 id=\"&#x4F7F;&#x7528;Demo\"><a href=\"#&#x4F7F;&#x7528;Demo\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;Demo\"></a>&#x4F7F;&#x7528;Demo</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tp = new MyPicker(this);</span><br><span class=\"line\">        //init data</span><br><span class=\"line\">        initData();</span><br><span class=\"line\">        //loding data</span><br><span class=\"line\">        tp.setData(leftList, 1);</span><br><span class=\"line\">        tp.setData(middleList, 2);</span><br><span class=\"line\">        tp.setData(rightList, 3);</span><br><span class=\"line\">        //set title</span><br><span class=\"line\">        tp.setPickerTitle(getResources().getString(R.string.title_name));</span><br><span class=\"line\">        //set the default centered text</span><br><span class=\"line\">        //if not set,show centered text in the data</span><br><span class=\"line\">        tp.setMiddleText(5, 1);</span><br><span class=\"line\">        tp.setMiddleText(2, 2);</span><br><span class=\"line\">        tp.setMiddleText(25, 3);</span><br><span class=\"line\">        //redy</span><br><span class=\"line\">        tp.setPrepare();</span><br><span class=\"line\">        // default show three</span><br><span class=\"line\">//        tp.setShowNum(3);</span><br><span class=\"line\">        tp.setSelectedFinishListener(new MyPicker.SelectedFinishListener() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onFinish() {</span><br><span class=\"line\">                leftText = String.valueOf(tp.getText(1));</span><br><span class=\"line\">                middleText = String.valueOf(tp.getText(2));</span><br><span class=\"line\">                rightText = String.valueOf(tp.getText(3));</span><br><span class=\"line\">                tv.setText(leftText+&quot;-&quot;+middleText+&quot;-&quot;+rightText);</span><br><span class=\"line\">                tp.dismiss();</span><br><span class=\"line\">            }</span><br><span class=\"line\">        });</span><br><span class=\"line\">        tp.showAtLocation(this.findViewById(R.id.main), Gravity.CENTER, 0, 0);</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\"><a href=\"#&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\" class=\"headerlink\" title=\"&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\"></a>&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies {</span><br><span class=\"line\">    compile &apos;com.idisfkj.picker:mypicker:1.2.1&apos;</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x73B0;&#x5728;&#x4F7F;&#x7528;&#x53EA;&#x8981;&#x5982;&#x4E0A;&#x4E00;&#x53E5;&#x4EE3;&#x7801;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x7B80;&#x5355;&#x8BB8;&#x591A;</em></p>\n</blockquote>\n<h2 id=\"&#x7ED3;&#x8BED;\"><a href=\"#&#x7ED3;&#x8BED;\" class=\"headerlink\" title=\"&#x7ED3;&#x8BED;\"></a>&#x7ED3;&#x8BED;</h2><p>&#x5982;&#x679C;&#x8FD8;&#x60F3;&#x8981;&#x77E5;&#x9053;&#x5177;&#x4F53;&#x539F;&#x7406;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x6211;&#x539F;&#x6765;&#x7684;&#x6587;&#x7AE0;&#xFF1A;</p>\n<p><a href=\"http://idisfkj.github.io/2016/03/13/PickerView/\" target=\"_blank\" rel=\"noopener\">&#x6ED1;&#x8F6E;&#x9009;&#x62E9;&#x5668;</a></p>\n<p>Github&#x94FE;&#x63A5;&#xFF1A;<a href=\"https://github.com/idisfkj/idisfkj.picker\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/idisfkj.picker</a><br>&#x6B22;&#x8FCE;Fork Star</p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["开源项目"]},{"title":"RecyclerView深入浅出","url":"https://www.rousetime.com/2016/04/02/RecyclerView深入浅出/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p><strong>RecyclerView</strong>&#x5DF2;&#x7ECF;&#x51FA;&#x6765;&#x597D;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x4E86;&#xFF0C;&#x5BF9;&#x4E8E;&#x65B0;&#x63A5;&#x89E6;<strong>Android</strong>&#x7684;&#x5B66;&#x5458;&#x6765;&#x8BF4;&#x5927;&#x591A;&#x6570;&#x4F7F;&#x7528;&#x7684;&#x662F;<strong>ListView</strong>&#x4E0E;<strong>GridView</strong>&#xFF0C;&#x5BF9;&#x4E8E;<strong>RecyclerView</strong>&#x7684;&#x4F7F;&#x7528;&#x53EF;&#x80FD;&#x90FD;&#x4E0D;&#x662F;&#x5F88;&#x719F;&#x6089;&#xFF0C;&#x76F8;&#x4FE1;&#x8FD9;&#x7247;&#x6587;&#x7AE0;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x5E26;&#x4F60;&#x8FDB;&#x53BB;<strong>RecyclerView</strong>&#x7684;&#x5927;&#x95E8;&#xFF0C;&#x5FEB;&#x901F;&#x4E86;&#x89E3;&#x4E0E;&#x638C;&#x63E1;&#x65B0;&#x6280;&#x672F;&#x3002;</p>\n<h2 id=\"&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\"><a href=\"#&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\" class=\"headerlink\" title=\"&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;\"></a>&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;</h2><p>&#x5927;&#x5BB6;&#x4F7F;&#x7528;<strong>ListView</strong>&#x4E0E;<strong>GridView</strong>&#x53EA;&#x8981;&#x5728;<strong>xml</strong>&#x4E2D;&#x5F15;&#x7528;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x6CA1;&#x9519;<strong>RecyclerView</strong>&#x4E5F;&#x662F;&#x4E00;&#x6837;&#xFF0C;&#x4F46;&#x5728;&#x5F15;&#x7528;&#x524D;&#x8981;&#x5148;&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;,&#x5728;&#x9879;&#x76EE;&#x7684;<strong>app</strong>&#x76EE;&#x5F55;&#x4E0B;&#x7684;<strong>build.gradl</strong>&#x7684;dependencies&#x4E2D;&#x6DFB;&#x52A0;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">compile &apos;com.android.support:recyclerview-v7:23.2.0&apos;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x5B8C;&#x4E86;&#x4E4B;&#x540E;&#x522B;&#x5FD8;&#x4E86;Sync Now</em></p>\n</blockquote>\n<h2 id=\"Adapter&#x53D8;&#x5316;\"><a href=\"#Adapter&#x53D8;&#x5316;\" class=\"headerlink\" title=\"Adapter&#x53D8;&#x5316;\"></a>Adapter&#x53D8;&#x5316;</h2><p>&#x65E2;&#x7136;&#x8981;&#x6709;<strong>ListView</strong>&#x4E0E;<strong>GridView</strong>&#x7684;&#x6548;&#x679C;&#x81EA;&#x7136;&#x4E0D;&#x80FD;&#x5C11;&#x4E86;<strong>adapter</strong>,&#x800C;<strong>RecyclerView</strong>&#x7684;<strong>adapter</strong>&#x4E3B;&#x8981;&#x6709;&#x4E24;&#x4E2A;&#x91CD;&#x5927;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x539F;&#x6765;<strong>adapter</strong>&#x4E2D;&#x7684;<strong>getView()</strong>&#x65B9;&#x6CD5;&#x53D6;&#x6D88;&#x4E86;&#xFF0C;&#x66FF;&#x6362;&#x6210;&#x4E86;<strong>onCreateViewHolder()</strong>&#x4E0E;<strong>onBindViewHolder()</strong>&#x3002;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5206;&#x6210;&#x4E86;&#x4E24;&#x90E8;&#x5206;&#xFF0C;&#x4E00;&#x90E8;&#x5206;&#x521B;&#x5EFA;&#x89C6;&#x56FE;&#x53E6;&#x4E00;&#x90E8;&#x5206;&#x7ED1;&#x5B9A;&#x6570;&#x636E;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x611F;&#x89C9;&#x5C42;&#x6B21;&#x66F4;&#x6E05;&#x6670;&#x4E86;&#x5462;&#xFF0C;&#x4E0B;&#x9762;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x4E4B;&#x4E24;&#x5927;&#x65B9;&#x6CD5;&#x7684;&#x4F7F;&#x7528;&#x3002;</p>\n<h3 id=\"onCreateViewHolder\"><a href=\"#onCreateViewHolder\" class=\"headerlink\" title=\"onCreateViewHolder\"></a>onCreateViewHolder</h3><p>&#x8BF4;&#x767D;&#x4E86;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x521B;&#x5EFA;&#x89C6;&#x56FE;&#xFF0C;&#x5728;&#x521B;&#x5EFA;&#x4E4B;&#x524D;&#x8981;&#x521B;&#x5EFA;&#x4E2A;<strong>ViewHolder</strong>&#x76F8;&#x4FE1;&#x5728;&#x539F;&#x6765;&#x7684;<strong>adapter</strong>&#x4E2D;&#x5E94;&#x8BE5;&#x6709;&#x4F7F;&#x7528;&#x8FC7;&#x5427;.&#x8FD9;&#x91CC;&#x7EE7;&#x627F;<strong>RecyclerView.ViewHolder</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static class NormalViewHolder extends RecyclerView.ViewHolder {</span><br><span class=\"line\">        @Bind(R.id.item_tv)</span><br><span class=\"line\">        TextView itemTv;</span><br><span class=\"line\">        public NormalViewHolder(View itemView) {</span><br><span class=\"line\">            super(itemView);</span><br><span class=\"line\">            ButterKnife.bind(this, itemView);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x5728;<strong>onCreateViewHolder</strong>&#x4E2D;&#x8C03;&#x7528;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">   public NormalViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {</span><br><span class=\"line\">       return new NormalViewHolder(mLayoutInflater.inflate(R.layout.item_text, parent, false));</span><br><span class=\"line\">   }</span><br></pre></td></tr></table></figure>\n<h3 id=\"onBindViewHolder\"><a href=\"#onBindViewHolder\" class=\"headerlink\" title=\"onBindViewHolder\"></a>onBindViewHolder</h3><p>&#x89C6;&#x56FE;&#x521B;&#x5EFA;&#x5B8C;&#x6BD5;&#x5C31;&#x662F;&#x7B80;&#x5355;&#x7684;&#x7ED1;&#x5B9A;&#x4E86;&#xFF0C;&#x4F7F;&#x7528;holder&#x5BF9;&#x63A7;&#x4EF6;&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#x8BBE;&#x7F6E;&#x6570;&#x636E;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">public void onBindViewHolder(NormalViewHolder holder, int position) {</span><br><span class=\"line\">    holder.itemTv.setText((CharSequence) mListData.get(position));</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>OK&#x4E86;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x611F;&#x89C9;&#x5F88;&#x7B80;&#x5355;&#x5462;&#xFF1F;&#x662F;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#xFF0C;&#x81F3;&#x4E8E;&#x8BBE;&#x7F6E;adapter&#x5C31;&#x4E0D;&#x8BF4;&#x4E86;&#x76F8;&#x4FE1;&#x4E4B;&#x540E;&#x7684;&#x6B65;&#x9AA4;&#x5927;&#x5BB6;&#x90FD;&#x4F1A;&#x4E86;&#x3002;</p>\n<h3 id=\"setLayoutManager\"><a href=\"#setLayoutManager\" class=\"headerlink\" title=\"setLayoutManager\"></a>setLayoutManager</h3><p>&#x4F60;&#x662F;&#x4E0D;&#x662F;&#x60F3;&#x8BF4;&#x5982;&#x4F55;&#x8BBE;&#x7F6E;&#x663E;&#x793A;&#x7684;&#x65B9;&#x5F0F;&#x662F;<strong>ListView</strong>&#x4E0E;<strong>GridView</strong>&#xFF0C;&#x8FD9;&#x4E2A;&#x5176;&#x5B9E;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x53EA;&#x9700;&#x4E00;&#x53E5;&#x4EE3;&#x7801;&#xFF0C;<strong>setLayoutManager()</strong>&#x5373;&#x53EF;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">switch (type) {</span><br><span class=\"line\">            case App.LINEAR_LAYOUT:</span><br><span class=\"line\">            \t//ListView</span><br><span class=\"line\">                recyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));</span><br><span class=\"line\">                break;</span><br><span class=\"line\">            case App.GRID_LAYOUT:</span><br><span class=\"line\">            \t//GridView</span><br><span class=\"line\">                gridLayoutManager = new GridLayoutManager(getActivity(),3);</span><br><span class=\"line\">                recyclerView.setLayoutManager(gridLayoutManager);</span><br><span class=\"line\">                break;                </span><br><span class=\"line\">            case App.STAGGERED_GRID_LAYOUT:</span><br><span class=\"line\">            \t//Can customize the waterfall flow</span><br><span class=\"line\">                recyclerView.setLayoutManager(new StaggeredGridLayoutManager(2, OrientationHelper.VERTICAL));</span><br><span class=\"line\">                break;</span><br><span class=\"line\">            default:</span><br><span class=\"line\">                break;</span><br><span class=\"line\">        }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x8BBE;&#x7F6E;&#x4E86;&#x663E;&#x793A;&#x7684;&#x65B9;&#x5F0F;&#x540E;&#x518D;setAdapter()&#x5373;&#x53EF;,&#x6548;&#x679C;&#x56FE;&#x8FD8;&#x662F;&#x653E;&#x5230;&#x6700;&#x540E;&#x4E00;&#x8D77;&#x663E;&#x793A;&#x5427;</em></p>\n</blockquote>\n<h2 id=\"ListView&#x4E0E;GridView&#x5D4C;&#x5957;&#x6548;&#x679C;\"><a href=\"#ListView&#x4E0E;GridView&#x5D4C;&#x5957;&#x6548;&#x679C;\" class=\"headerlink\" title=\"ListView&#x4E0E;GridView&#x5D4C;&#x5957;&#x6548;&#x679C;\"></a>ListView&#x4E0E;GridView&#x5D4C;&#x5957;&#x6548;&#x679C;</h2><p>&#x5982;&#x679C;&#x8981;&#x5B9E;&#x73B0;&#x9996;&#x5C3E;&#x662F;<strong>ListView</strong>&#x5E03;&#x5C40;&#x6548;&#x679C;&#xFF0C;&#x4E2D;&#x95F4;&#x7684;<strong>GridView</strong>&#x6548;&#x679C;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<strong>RecyclerView.Adapter</strong>&#x63D0;&#x4F9B;&#x7684;<strong>getItemViewType(int position)</strong>&#x65B9;&#x6CD5;&#xFF0C;&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x4E0E;<strong>ListView</strong>&#x7684;<strong>adapter</strong>&#x4E0D;&#x540C;&#x53EA;&#x6709;&#x8FD9;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x6CA1;&#x6709;<strong>getViewTypeCount() </strong>&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x9996;&#x5C3E;&#x8981;&#x663E;&#x793A;&#x7684;&#x884C;&#x6570;&#x6765;&#x63A7;&#x5236;&#x663E;&#x793A;&#x7684;&#x5E03;&#x5C40;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    public int getItemViewType(int position) {</span><br><span class=\"line\">        mHeadCount = getHeadCount();</span><br><span class=\"line\">        mContentCount = getContentCount();</span><br><span class=\"line\">        mBottomCount = mHeadCount + mContentCount;</span><br><span class=\"line\">        if (mHeadCount &gt; position) {</span><br><span class=\"line\">            return App.LINEAR_LAYOUT;//ListView</span><br><span class=\"line\">        } else if (mBottomCount &lt;= position) {</span><br><span class=\"line\">            return App.STAGGERED_GRID_LAYOUT;//Can customize the waterfall flow</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            return App.GRID_LAYOUT;//GridView</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;viewtype&#x8FD4;&#x56DE;&#x4E0D;&#x540C;&#x7684;&#x5E03;&#x5C40;</em></p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">    public RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {</span><br><span class=\"line\">        switch (viewType) {</span><br><span class=\"line\">            case App.LINEAR_LAYOUT:</span><br><span class=\"line\">                return onCreateHeadViewHolder(parent);</span><br><span class=\"line\">            case App.GRID_LAYOUT:</span><br><span class=\"line\">                return onCreateContentViewHolder(parent);</span><br><span class=\"line\">            case App.STAGGERED_GRID_LAYOUT:</span><br><span class=\"line\">                return onCreateBottomViewHolder(parent);</span><br><span class=\"line\">            default:</span><br><span class=\"line\">                return null;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<h2 id=\"RecyclerView&#x52A8;&#x753B;\"><a href=\"#RecyclerView&#x52A8;&#x753B;\" class=\"headerlink\" title=\"RecyclerView&#x52A8;&#x753B;\"></a>RecyclerView&#x52A8;&#x753B;</h2><p><strong>RecyclerView</strong>&#x7684;<strong>adapter</strong>&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E9B;&#x7B80;&#x5355;&#x7684;&#x52A8;&#x753B;&#x5B9E;&#x73B0;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x90E8;&#x5206;:</p>\n<ul>\n<li>notifyItemRemoved(int position)</li>\n<li>notifyItemInserted(int position)</li>\n<li>notifyItemChanged(int position)</li>\n<li>notifyItemRangeChanged(int positionStart,int itemCount)</li>\n</ul>\n<p>&#x53EA;&#x8981;&#x5728;&#x6570;&#x636E;&#x6539;&#x53D8;&#x65F6;&#x901A;&#x8FC7;<strong>adapter</strong>&#x8C03;&#x7528;&#x5C31;&#x884C;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@OnClick(R.id.item_tv)</span><br><span class=\"line\">       public void onClick() {</span><br><span class=\"line\">           if (getLayoutPosition() != 1) {</span><br><span class=\"line\">               animationAdapter.mListData.add(&quot;add&quot;+getLayoutPosition());</span><br><span class=\"line\">               animationAdapter.notifyItemInserted(getLayoutPosition());</span><br><span class=\"line\">           } else {</span><br><span class=\"line\">               animationAdapter.mListData.remove(getLayoutPosition());</span><br><span class=\"line\">               animationAdapter.notifyItemRemoved(getLayoutPosition());</span><br><span class=\"line\">           }</span><br><span class=\"line\">       }</span><br></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;<strong>recyclerView</strong>&#x7684;<strong>setItemAnimator()</strong>&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x52A8;&#x753B;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">recyclerView.setItemAnimator(new DefaultItemAnimator());</span><br></pre></td></tr></table></figure>\n<p>&#x5F53;&#x7136;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;&#x52A8;&#x753B;&#xFF0C;&#x53EA;&#x8981;<strong>extends</strong> ItemAnimator&#x91CD;&#x5199;&#x51E0;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x5C55;&#x5F00;&#x4E86;&#xFF0C;&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x53BB;&#x8BD5;&#x8BD5;&#x3002;</p>\n<h2 id=\"RecyclerView&#x7684;CursorAdapter\"><a href=\"#RecyclerView&#x7684;CursorAdapter\" class=\"headerlink\" title=\"RecyclerView&#x7684;CursorAdapter\"></a>RecyclerView&#x7684;CursorAdapter</h2><p>&#x8BB2;&#x5230;&#x8FD9;&#x91CC;&#x4E86;&#x4F60;&#x53EF;&#x4EE5;&#x80FD;&#x4F1A;&#x8BA4;&#x4E3A;<strong>CursorAdapter</strong>&#x4E5F;&#x662F;&#x8DDF;&#x539F;&#x6765;&#x7684;&#x5DEE;&#x4E0D;&#x591A;&#xFF0C;&#x4F46;&#x6211;&#x8981;&#x8BF4;&#x7684;&#x662F;<strong>RecyclerView</strong>&#x5E76;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x6709;&#x5173;&#x4E0E;<strong>CursorAdapter</strong>&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x6240;&#x4EE5;&#x5F53;&#x6211;&#x4EEC;&#x8981;&#x4F7F;&#x7528;<strong>CursorAdapter</strong>&#x65F6;&#x8981;&#x600E;&#x4E48;&#x529E;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x53EA;&#x80FD;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;<strong>CursorAdapter</strong>&#x7684;&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x611F;&#x89C9;&#x5934;&#x75DB;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x770B;&#x8D77;&#x6765;&#x786E;&#x5B9E;&#x6709;&#x70B9;&#x9EBB;&#x70E6;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x544A;&#x8BC9;&#x4F60;&#x4EEC;&#x5B9E;&#x73B0;&#x4E5F;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x4E00;&#x4EF6;&#x4E8B;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x4E48;&#x8BF4;&#x5462;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x4EFF;&#x9020;<strong>ListView</strong>&#x7684;<strong>CursorAdapter</strong>&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p>\n<h3 id=\"CursorFilter\"><a href=\"#CursorFilter\" class=\"headerlink\" title=\"CursorFilter\"></a>CursorFilter</h3><p>&#x8FD9;&#x4E2A;&#x662F;<strong>Cursor</strong>&#x7684;&#x8FC7;&#x6EE4;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x65E0;&#x9700;&#x505A;&#x4EC0;&#x4E48;&#xFF0C;&#x627E;&#x5230;<strong>ListView</strong>&#x7684;<strong>CursorFilter</strong>&#x590D;&#x5236;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;&#x4EE3;&#x7801;&#x6CA1;&#x4EC0;&#x4E48;&#x8D34;&#x7684;&#xFF0C;&#x90FD;&#x662F;&#x6E90;&#x7801;&#xFF0C;&#x81EA;&#x5DF1;&#x53EF;&#x4EE5;&#x53BB;&#x67E5;&#x770B;.</p>\n<h3 id=\"RecyclerBaseCursorAdapter\"><a href=\"#RecyclerBaseCursorAdapter\" class=\"headerlink\" title=\"RecyclerBaseCursorAdapter\"></a>RecyclerBaseCursorAdapter</h3><p>&#x8FD9;&#x4E2A;&#x62BD;&#x8C61;&#x7C7B;&#x5927;&#x90E8;&#x5206;&#x90FD;&#x662F;&#x4E0E;<strong>ListView</strong>&#x7684;<strong>CursorAdapter</strong>&#x76F8;&#x540C;&#xFF0C;&#x53EA;&#x662F;&#x6709;&#x51E0;&#x4E2A;&#x5730;&#x65B9;&#x9700;&#x8981;&#x7279;&#x522B;&#x63D0;&#x9192;&#x4E0B;</p>\n<ul>\n<li>&#x539F;&#x6765;&#x7684;&#x6709;notifyDataSetInvalidated()&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;RecyclerView&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x8BE5;&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;notifyDataSetChanged()&#x66FF;&#x4EE3;</li>\n<li>&#x539F;&#x6765;&#x7684;hasStableIds() &#x65B9;&#x6CD5;&#x4E5F;&#x6CA1;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;setHasStableIds(true)&#x8BBE;&#x7F6E;&#x4E3A;ture&#x6765;&#x5B9E;&#x73B0;&#x76F8;&#x540C;&#x7684;&#x6548;&#x679C;</li>\n<li>&#x539F;&#x6765;&#x7684;<strong>getView()</strong>&#x65B9;&#x6CD5;&#x8981;&#x66FF;&#x6362;&#x6210;<strong>onBindViewHolder()</strong>&#x65B9;&#x6CD5;</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void init(Context context, Cursor c, int flags) {</span><br><span class=\"line\">        boolean cursorPresent = c != null;</span><br><span class=\"line\">        mCursor = c;</span><br><span class=\"line\">        mDataValid = cursorPresent;</span><br><span class=\"line\">        mContext = context;</span><br><span class=\"line\">        mRowIDColumn = cursorPresent ? c.getColumnIndexOrThrow(&quot;_id&quot;) : -1;</span><br><span class=\"line\">        if ((flags &amp; FLAG_REGISTER_CONTENT_OBSERVER) == FLAG_REGISTER_CONTENT_OBSERVER) {</span><br><span class=\"line\">            mChangeObserver = new ChangeObserver();</span><br><span class=\"line\">            mDataSetObserver = new MyDataSetObserver();</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            mChangeObserver = null;</span><br><span class=\"line\">            mDataSetObserver = null;</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        if (cursorPresent) {</span><br><span class=\"line\">            if (mChangeObserver != null) c.registerContentObserver(mChangeObserver);</span><br><span class=\"line\">            if (mDataSetObserver != null) c.registerDataSetObserver(mDataSetObserver);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        //should set true to init</span><br><span class=\"line\">        setHasStableIds(true);</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">        public void onInvalidated() {</span><br><span class=\"line\">            mDataValid = false;</span><br><span class=\"line\">//            notifyDataSetInvalidated();</span><br><span class=\"line\">            //there is no notifyDataSetInvalidated method we should use notifyDataSetChanged method;</span><br><span class=\"line\">            notifyDataSetChanged();</span><br><span class=\"line\">        }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x57FA;&#x672C;&#x4E0A;&#x4E3B;&#x8981;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x4E9B;&#x4E86;&#xFF0C;&#x66F4;&#x591A;&#x8BE6;&#x60C5;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x540E;&#x9762;&#x7684;<strong>Demo</strong>&#x94FE;&#x63A5;&#xFF0C;&#x6700;&#x540E;&#x4F7F;&#x7528;&#x90FD;&#x76F8;&#x540C;&#x7684;&#x5957;&#x8DEF;&#xFF0C;&#x7EE7;&#x627F;&#x8BE5;&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x76F8;&#x4FE1;&#x5E94;&#x8BE5;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;</em></p>\n</blockquote>\n<h1 id=\"&#x6548;&#x679C;&#x56FE;\"><a href=\"#&#x6548;&#x679C;&#x56FE;\" class=\"headerlink\" title=\"&#x6548;&#x679C;&#x56FE;\"></a>&#x6548;&#x679C;&#x56FE;</h1><p><img src=\"/2016/04/02/RecyclerView&#x6DF1;&#x5165;&#x6D45;&#x51FA;/RecyclerView.gif\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<h1 id=\"&#x7ED3;&#x8BED;\"><a href=\"#&#x7ED3;&#x8BED;\" class=\"headerlink\" title=\"&#x7ED3;&#x8BED;\"></a>&#x7ED3;&#x8BED;</h1><p>&#x6E90;&#x7801;&#x5730;&#x5740;&#x94FE;&#x63A5;&#xFF1A;<a href=\"https://github.com/idisfkj/RecyclerView\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/RecyclerView</a><br>&#x6700;&#x540E;&#x611F;&#x8C22;&#x5927;&#x5BB6;&#x7684;&#x9605;&#x8BFB;&#xFF0C;&#x6709;&#x4E0D;&#x8DB3;&#x7684;&#x5730;&#x65B9;&#x6B22;&#x8FCE;&#x6307;&#x51FA;&#x3002;</p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["RecyclerView"]},{"title":"Android 开源SlideSwitch源码分析","url":"https://www.rousetime.com/2016/03/26/Android-开源SlideSwitch源码分析/","content":"<p>&#x5927;&#x5BB6;&#x90FD;&#x77E5;&#x9053;<strong>android</strong>&#x7684;&#x6700;&#x5927;&#x597D;&#x5904;&#x5C31;&#x662F;&#x5F00;&#x6E90;&#xFF0C;&#x5176;&#x5B9E;&#x5F88;&#x591A;&#x9879;&#x76EE;&#x80FD;&#x5168;&#x90E8;&#x7528;&#x5F00;&#x6E90;&#x5C31;&#x80FD;&#x641E;&#x5B9A;&#x3002;&#x4F46;&#x662F;&#x5F53;&#x6211;&#x4EEC;&#x5728;&#x7528;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E0D;&#x61C2;&#x5F97;&#x5B83;&#x4EEC;&#x7684;&#x539F;&#x7406;&#xFF0C;&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x8FC7;&#x773C;&#x4E91;&#x70DF;&#xFF0C;&#x884C;&#x5C38;&#x8D70;&#x8089;&#xFF0C;&#x53EA;&#x6709;&#x7A7A;&#x58F3;&#x6CA1;&#x6709;&#x5B9D;&#x8D35;&#x7684;&#x601D;&#x60F3;&#x3002;&#x5F53;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x4E00;&#x65E6;&#x8981;&#x7EF4;&#x62A4;&#x4E8E;&#x4F18;&#x5316;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9002;&#x5E94;&#x9700;&#x6C42;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x90A3;&#x4E9B;&#x53EA;&#x4F1A;&#x62FF;&#x6765;&#x7528;&#x7684;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#x53EA;&#x80FD;&#x76EE;&#x77AA;&#x53E3;&#x5446;&#x3002;&#x8FD9;&#x6837;&#x4E0D;&#x4EC5;&#x6CA1;&#x6709;&#x52A0;&#x5FEB;&#x6211;&#x4EEC;&#x7684;&#x5F00;&#x53D1;&#x901F;&#x5EA6;&#x800C;&#x4E14;&#x8FD8;&#x4F1A;&#x8BA9;&#x6211;&#x4EEC;&#x5168;&#x76D8;&#x7686;&#x8F93;&#x3002;&#x597D;&#x4E86;&#x5176;&#x5B83;&#x7684;&#x4E5F;&#x4E0D;&#x591A;&#x8BF4;&#xFF0C;&#x6B63;&#x5F0F;&#x8FDB;&#x5165;&#x4E3B;&#x9898;&#xFF0C;&#x5206;&#x4EAB;&#x4E00;&#x4E0B;&#x81EA;&#x5DF1;&#x6700;&#x8FD1;&#x5BF9;<strong>SlideSwitch</strong>&#x5F00;&#x6E90;&#x4EE3;&#x7801;&#x7684;&#x7406;&#x89E3;&#x3002;</p>\n<hr>\n<h1 id=\"&#x8BF4;&#x660E;\"><a href=\"#&#x8BF4;&#x660E;\" class=\"headerlink\" title=\"&#x8BF4;&#x660E;\"></a>&#x8BF4;&#x660E;</h1><p>&#x9996;&#x5148;&#x8FD8;&#x662F;&#x8981;&#x8BF4;&#x660E;&#x4E0B;<strong>SlideSwitch</strong>&#x662F;&#x4EC0;&#x4E48;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#xFF0C;&#x5176;&#x5B9E;&#x5B83;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x6211;&#x4EEC;&#x51E0;&#x4E4E;&#x6BCF;&#x4E2A;&#x9879;&#x76EE;&#x4E2D;&#x90FD;&#x4F1A;&#x9047;&#x5230;&#x7684;&#x6ED1;&#x52A8;&#x5F00;&#x5173;&#xFF0C;&#x8FD8;&#x4E0D;&#x61C2;&#x8BF7;&#x770B;&#x4E0B;&#x56FE;&#xFF1A;</p>\n<h1 id=\"&#x5206;&#x6790;&#x8981;&#x70B9;\"><a href=\"#&#x5206;&#x6790;&#x8981;&#x70B9;\" class=\"headerlink\" title=\"&#x5206;&#x6790;&#x8981;&#x70B9;\"></a>&#x5206;&#x6790;&#x8981;&#x70B9;</h1><ul>\n<li>TypedArray &#x7684;&#x4F7F;&#x7528;</li>\n<li>onMeasure &#x5404;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x521D;&#x59CB;&#x5316;</li>\n<li>onDraw &#x7ED8;&#x5236;&#x56FE;&#x5F62;</li>\n<li>onTouchEvent &#x76D1;&#x542C;&#x89E6;&#x6478;&#x70B9;&#x51FB;</li>\n<li>ValueAnimator &#x52A8;&#x753B;&#x5B9E;&#x73B0;</li>\n<li>SlideSwitchListener &#x63A5;&#x53E3;</li>\n</ul>\n<h2 id=\"TypedArray\"><a href=\"#TypedArray\" class=\"headerlink\" title=\"TypedArray\"></a>TypedArray</h2><p>&#x4E00;&#x822C;&#x81EA;&#x5B9A;&#x4E49;&#x63A7;&#x4EF6;&#x90FD;&#x8981;&#x7528;&#x5230;<strong>TypedArray</strong>&#xFF0C;&#x6240;&#x4EE5;<strong>SlideSwitch</strong>&#x81EA;&#x7136;&#x5C11;&#x4E0D;&#x4E86;&#x3002;&#x5B83;&#x5C31;&#x7EE7;&#x627F;&#x4E86;<strong>Android</strong>&#x539F;&#x751F;&#x7684;<strong>View</strong>&#x3002;&#x800C;<strong>TypedArray</strong>&#x662F;&#x83B7;&#x53D6;&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;&#x7684;&#x53C2;&#x6570;&#x503C;&#x3002;<br>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x4F1A;&#x5728;<strong>styles</strong>&#x6216;&#x8005;<strong>attrs</strong>&#x4E2D;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;&#x53C2;&#x6570;</p>\n<pre><code>&lt;declare-styleable name=&quot;slideswitchview&quot; &gt;\n    &lt;attr name=&quot;themeColor&quot; format=&quot;color&quot;&gt;&lt;/attr&gt;\n    &lt;attr name=&quot;isOpen&quot; format=&quot;boolean&quot;&gt;&lt;/attr&gt;\n    &lt;attr name=&quot;shape&quot; format=&quot;integer&quot;&gt;&lt;/attr&gt;\n&lt;/declare-styleable&gt;      \n</code></pre><p><strong>format</strong>&#x5C5E;&#x6027;&#x7C7B;&#x578B;&#xFF0C;&#x7136;&#x540E;&#x5728;<strong>XML</strong>&#x4E2D;&#x5F15;&#x7528;&#xFF0C;&#x5F15;&#x7528;&#x4E4B;&#x524D;&#x4E00;&#x5B9A;&#x8981;&#x52A0;&#x5165;&#x4E0B;&#x9762;&#x7684;&#x58F0;&#x660E;</p>\n<pre><code>xmlns:slideswitch=&quot;http://schemas.android.com/apk/res/xxx&quot;    \n</code></pre><p>xxx:&#x4EE3;&#x8868;&#x5305;&#x540D;&#x3002;&#x76F4;&#x63A5;&#x5F15;&#x7528;&#x5C31;&#x884C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">slideswitch:themeColor=&quot;#ffaaff&quot;</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x5728;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x4EE3;&#x7801;&#x83B7;&#x53D6;&#x8BBE;&#x7F6E;&#x7684;&#x53C2;&#x6570;&#x503C;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TypedArray ta = context.obtainStyledAttributes(attrs, R.styleable.slideswitchview);</span><br><span class=\"line\">       theme_color = \tta.getColor(R.styleable.slideswitchview_themeColor, DEFAULT_THEME_COLOR);</span><br><span class=\"line\">       ta.recycle();</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x4F7F;&#x7528;&#x5B8C;&#x540E;&#x52A1;&#x5FC5;recycle&#x5426;&#x5219;&#x4F1A;&#x5BF9;&#x4E0B;&#x6B21;&#x7684;&#x4F7F;&#x7528;&#x9020;&#x6210;&#x5F71;&#x54CD;</em></p>\n</blockquote>\n<h2 id=\"onMeasure\"><a href=\"#onMeasure\" class=\"headerlink\" title=\"onMeasure\"></a>onMeasure</h2><p>&#x6BCF;&#x6B21;&#x89C6;&#x56FE;&#x7684;&#x521B;&#x5EFA;&#x90FD;&#x8981;&#x5148;&#x83B7;&#x53D6;&#x89C6;&#x56FE;&#x7684;&#x5BBD;&#x9AD8;&#xFF0C;&#x6B21;&#x65B9;&#x6CD5;&#x5C31;&#x4F1A;&#x88AB;&#x8C03;&#x7528;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x53C2;&#x6570;<strong>widthMeasureSpec</strong>&#x4E0E;<strong>heightMeasuerSpec</strong>&#x4E0D;&#x662F;&#x4E00;&#x822C;&#x7684;&#x5C3A;&#x5BF8;&#xFF0C;&#x800C;&#x662F;&#x5305;&#x62EC;&#x4E86;<strong>size</strong>&#x4E0E;<strong>mode</strong>&#x3002;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x83B7;&#x53D6;&#x5B9E;&#x9645;&#x7684;&#x5BBD;&#x9AD8;&#xFF0C;&#x8981;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x65B9;&#x6CD5;&#x5206;&#x522B;&#x83B7;&#x53D6;<strong>size</strong>&#x4E0E;<strong>mode</strong>&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int size = MeasureSpec.getSize(measureSpec);</span><br><span class=\"line\">int mode = MeasureSpec.getMode(measureSpec);</span><br></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;<strong>mode</strong>&#x6765;&#x83B7;&#x53D6;<strong>size</strong>&#xFF0C;<strong>mode</strong>&#x6709;&#x4E09;&#x79CD;&#xFF1A;</p>\n<ul>\n<li>EXACTLY  &#x7CBE;&#x786E;&#x5C3A;&#x5BF8;&#xFF0C;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x6307;&#x5B9A;&#x7684;&#x5C3A;&#x5BF8;</li>\n<li>UNSPECIFIED &#x4E3A;&#x6307;&#x5B9A;&#x7684; </li>\n<li>AT_MOST    &#x6700;&#x5927;&#x5C3A;&#x5BF8; &#x5F62;&#x5982;&#x6307;&#x5B9A;WRAP_CONTENT&#x5728;&#x7236;&#x63A7;&#x4EF6;&#x5141;&#x8BB8;&#x7684;&#x8303;&#x56F4;&#x5185;</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (mode == MeasureSpec.EXACTLY) {</span><br><span class=\"line\">           result = size;</span><br><span class=\"line\">       } else {</span><br><span class=\"line\">           result = DefaultSize; //UNSPECIFIED</span><br><span class=\"line\">           if (mode == MeasureSpec.AT_MOST) {</span><br><span class=\"line\">               result = Math.min(size, result);</span><br><span class=\"line\">           }</span><br><span class=\"line\">       }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x5176;&#x5B83;&#x7B80;&#x5355;&#x7684;&#x53C2;&#x6570;&#x503C;&#x8BBE;&#x7F6E;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x8BF7;&#x79FB;&#x6B65;&#x6700;&#x540E;&#x7684;&#x6E90;&#x7801;</em></p>\n</blockquote>\n<h2 id=\"onDraw\"><a href=\"#onDraw\" class=\"headerlink\" title=\"onDraw\"></a>onDraw</h2><p>&#x5C3A;&#x5EA6;&#x83B7;&#x53D6;&#x5230;&#x4E86;&#x540E;&#xFF0C;&#x4E0B;&#x9762;&#x81EA;&#x7136;&#x5C31;&#x662F;&#x7ED8;&#x5236;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x9009;&#x62E9;&#x5F00;&#x5173;&#x5F62;&#x72B6;&#x6709;&#x77E9;&#x5F62;&#x7684;&#x4E5F;&#x6709;&#x5706;&#x89D2;&#x77E9;&#x5F62;&#x6240;&#x4EE5;&#x6839;&#x636E;<strong>shpe</strong>&#x7684;&#x503C;&#x6765;&#x7ED8;&#x5236;&#x76F8;&#x5E94;&#x7684;&#x5F62;&#x72B6;&#xFF0C;&#x8FD9;&#x91CC;&#x4EE5;&#x77E9;&#x5F62;&#x4E3A;&#x4F8B;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (shape == 1) {</span><br><span class=\"line\">           mPaint.setColor(Color.GRAY);</span><br><span class=\"line\">           //&#x7ED8;&#x5236;close&#x65F6;&#x7684;&#x7070;&#x8272;&#x80CC;&#x666F;</span><br><span class=\"line\">           canvas.drawRect(backRect, mPaint);</span><br><span class=\"line\">           mPaint.setColor(theme_color);</span><br><span class=\"line\">           mPaint.setAlpha(alpha);</span><br><span class=\"line\">           //&#x7ED8;&#x5236;open&#x65F6;&#x7684;&#x5F69;&#x8272;&#x6E10;&#x53D8;&#x80CC;&#x666F;</span><br><span class=\"line\">           canvas.drawRect(backRect, mPaint);</span><br><span class=\"line\">           mPaint.setColor(Color.WHITE);</span><br><span class=\"line\">           frontRect.set(front_left, pandding, front_left + getMeasuredWidth() / 2 - pandding</span><br><span class=\"line\">                   , getMeasuredHeight() - pandding);</span><br><span class=\"line\">           //&#x7ED8;&#x5236;&#x6ED1;&#x52A8;&#x5668;</span><br><span class=\"line\">           canvas.drawRect(frontRect, mPaint);</span><br><span class=\"line\">       }</span><br></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;<strong>padding</strong>&#x4EE3;&#x8868;&#x5185;&#x8FB9;&#x8DDD;&#xFF0C;&#x5C31;&#x662F;&#x6ED1;&#x52A8;&#x5668;&#x8DDD;&#x8FB9;&#x6846;&#x7684;&#x8DDD;&#x79BB;</p>\n<h2 id=\"onTouchEvent\"><a href=\"#onTouchEvent\" class=\"headerlink\" title=\"onTouchEvent\"></a>onTouchEvent</h2><p>&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x5B9E;&#x73B0;&#x52A8;&#x6001;&#x7684;&#x89E6;&#x6478;&#x6ED1;&#x52A8;&#xFF0C;&#x6839;&#x636E;<strong>ACTION_DOWN</strong>&#xFF0C;<strong>ACTION_MOVE</strong>&#xFF0C;<strong>ACTION_UP</strong>&#x6765;&#x5B9E;&#x73B0;&#x52A8;&#x6001;&#x6548;&#x679C;&#xFF0C;&#x81F3;&#x4E8E;&#x70B9;&#x5750;&#x6807;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x6E90;&#x7801;&#x5F88;&#x6E05;&#x695A;&#x3002;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x63D0;&#x4E0B;<strong>alpha</strong>&#x53C2;&#x6570;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x8BE5;&#x53C2;&#x6570;&#x662F;&#x5B9E;&#x73B0;&#x989C;&#x8272;&#x7684;&#x900F;&#x660E;&#x6548;&#x679C;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x901A;&#x8FC7;&#x89E6;&#x6478;&#x6ED1;&#x52A8;&#x7684;&#x95F4;&#x8DDD;&#xFF0C;&#x52A8;&#x6001;&#x7684;&#x6539;&#x53D8;<strong>alpha</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alpha = (int) (255 * (float) front_left / (float) max_left);</span><br></pre></td></tr></table></figure>\n<h2 id=\"ValueAnimator\"><a href=\"#ValueAnimator\" class=\"headerlink\" title=\"ValueAnimator\"></a>ValueAnimator</h2><p>&#x8FD9;&#x4E2A;&#x7C7B;&#x662F;&#x52A8;&#x753B;&#x6548;&#x679C;&#x7684;&#x6838;&#x5FC3;&#xFF0C;&#x901A;&#x8FC7;&#x7B80;&#x5355;&#x7684;&#x51E0;&#x6B65;&#x5C31;&#x80FD;&#x8FC5;&#x901F;&#x7684;&#x5B9E;&#x73B0;&#x4E00;&#x4E9B;&#x7B80;&#x5355;&#x7684;&#x52A8;&#x753B;<br>&#x9996;&#x5148;&#x5B9E;&#x4F8B;&#x5316;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7684;&#x662F;<strong>ofInt()</strong>&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x6709;<strong>ofFloat()</strong>&#x7B49;&#x9759;&#x6001;&#x5B9E;&#x4F8B;&#x5316;&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ValueAnimator valueAnimator = ValueAnimator.ofInt(front_left, toRight ? max_left : min_left);</span><br></pre></td></tr></table></figure>\n<p>&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x521D;&#x503C;&#x4E0E;&#x7ED3;&#x675F;&#x503C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//&#x8BBE;&#x7F6E;&#x63D2;&#x503C;&#x5668;</span><br><span class=\"line\"> \tvalueAnimator.setInterpolator(new  AccelerateDecelerateInterpolator());</span><br><span class=\"line\">   valueAnimator.setDuration(500);</span><br><span class=\"line\">   valueAnimator.start();</span><br></pre></td></tr></table></figure>\n<p><strong>Interpolator</strong>&#x662F;&#x5B9A;&#x4E49;&#x52A8;&#x753B;&#x7684;&#x53D8;&#x5316;&#x8FC7;&#x7A0B;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x53C2;&#x6570;</p>\n<ul>\n<li>AccelerateDecelerateInterpolator &#x5F00;&#x59CB;&#x7ED3;&#x675F;&#x6162; &#x4E2D;&#x95F4;&#x8FC7;&#x7A0B;&#x5FEB;</li>\n<li>AccelerateInterpolator &#x52A0;&#x901F;&#x72B6;&#x6001;</li>\n<li>AnticipateInterpolator &#x5148;&#x540E;&#x79FB;&#x4E00;&#x70B9;&#xFF0C;&#x518D;&#x5FEB;&#x901F;&#x79FB;&#x52A8;</li>\n<li>BounceInterpolator &#x5728;&#x6700;&#x540E;&#x6709;&#x5F39;&#x7403;&#x6548;&#x679C; </li>\n</ul>\n<p>&#x5F53;&#x7136;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#x6548;&#x679C;&#xFF0C;&#x53EA;&#x8981;&#x7EE7;&#x627F;T<strong>imeInterpolator</strong>&#x7C7B;&#xFF0C;&#x91CD;&#x5199;<strong>getInterpolation</strong>&#x65B9;&#x6CD5;&#x81EA;&#x5B9A;&#x4E49;&#x8BA1;&#x7B97;&#x503C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override  </span><br><span class=\"line\">   public float getInterpolation(float input) {  </span><br><span class=\"line\">       // &#x7F16;&#x5199;&#x76F8;&#x5173;&#x7684;&#x903B;&#x8F91;&#x8BA1;&#x7B97;  </span><br><span class=\"line\">       return input;  </span><br><span class=\"line\">   }</span><br></pre></td></tr></table></figure>\n<p>&#x65E2;&#x7136;&#x662F;&#x52A8;&#x753B;&#x81EA;&#x7136;&#x6709;&#x76D1;&#x542C;&#x8BBE;&#x7F6E;<strong>addUpdateListener</strong>&#x5B9E;&#x65F6;&#x6539;&#x53D8;&#x6ED1;&#x52A8;&#x521D;&#x59CB;&#x503C;&#x96E8;<strong>alpha</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">valueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {</span><br><span class=\"line\">           @Override</span><br><span class=\"line\">           public void onAnimationUpdate(ValueAnimator animation) {</span><br><span class=\"line\">               front_left = (int) animation.getAnimatedValue();</span><br><span class=\"line\">               alpha = (int) (255 * (float) front_left / (float) max_left);</span><br><span class=\"line\">               initloop();</span><br><span class=\"line\">           }</span><br><span class=\"line\">       });</span><br></pre></td></tr></table></figure>\n<p>&#x6700;&#x540E;&#x589E;&#x52A0;<strong>addListener</strong>&#x8C03;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x63A5;&#x53E3;<strong>SlideSwitchListener</strong>&#x4E2D;&#x7684;&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">valueAnimator.addListener(new AnimatorListenerAdapter() {</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onAnimationEnd(Animator animation) {</span><br><span class=\"line\">                if (toRight) {</span><br><span class=\"line\">                    isOpen = true;</span><br><span class=\"line\">                    if (mSlideSwitchListener != null)</span><br><span class=\"line\">                        mSlideSwitchListener.onOpen();</span><br><span class=\"line\">                    front_start_left = max_left;</span><br><span class=\"line\">                } else {</span><br><span class=\"line\">                    isOpen = false;</span><br><span class=\"line\">                    if (mSlideSwitchListener != null)</span><br><span class=\"line\">                        mSlideSwitchListener.onClose();</span><br><span class=\"line\">                    front_start_left = min_left;</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        });</span><br></pre></td></tr></table></figure>\n<h2 id=\"SlideSwitchListener\"><a href=\"#SlideSwitchListener\" class=\"headerlink\" title=\"SlideSwitchListener\"></a>SlideSwitchListener</h2><p>&#x63A5;&#x53E3;&#x7684;&#x5B9A;&#x4E49;&#x4F7F;&#x5F97;&#x5728;&#x64CD;&#x4F5C;&#x7C7B;&#x4E2D;&#x80FD;&#x66F4;&#x597D;&#x7684;&#x5B9E;&#x73B0;&#x72B6;&#x6001;&#x6539;&#x53D8;&#x540E;&#x7684;&#x76F8;&#x5173;&#x64CD;&#x4F5C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void setSlideSwitchListener(SlideSwitchListener sideSwitchListener) {</span><br><span class=\"line\">        mSlideSwitchListener = sideSwitchListener;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    public interface SlideSwitchListener {</span><br><span class=\"line\">        public void onOpen();</span><br><span class=\"line\"></span><br><span class=\"line\">        public void onClose();</span><br><span class=\"line\"></span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x6548;&#x679C;&#x56FE;\"><a href=\"#&#x6548;&#x679C;&#x56FE;\" class=\"headerlink\" title=\"&#x6548;&#x679C;&#x56FE;\"></a>&#x6548;&#x679C;&#x56FE;</h2><p><img src=\"/2016/03/26/Android-&#x5F00;&#x6E90;SlideSwitch&#x6E90;&#x7801;&#x5206;&#x6790;/2.gif\" alt=\"icon\"></p>\n<p>&#x53EA;&#x8981;&#x7A0D;&#x5FAE;&#x590D;&#x6742;&#x7684;&#x5728;&#x8FD9;&#x91CC;&#x90FD;&#x8BB2;&#x5230;&#x4E86;&#xFF0C;&#x8FD8;&#x6709;&#x4E0D;&#x660E;&#x767D;&#x7684;&#x53EF;&#x4EE5;&#x70B9;&#x51FB;&#x67E5;&#x770B;&#x4E0B;&#x9762;&#x6211;&#x6CE8;&#x91CA;&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x6216;&#x8005;&#x7559;&#x8A00;&#xFF0C;&#x8C22;&#x8C22;&#x6D4F;&#x89C8;&#x3002;</p>\n<p>&#x6CE8;&#x91CA;&#x6E90;&#x7801;&#x94FE;&#x63A5;&#xFF1A;<a href=\"https://github.com/idisfkj/SlideSwitchView\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/SlideSwitchView</a></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["源码分析"]},{"title":"圆形头像","url":"https://www.rousetime.com/2016/03/20/circleView/","content":"<p>&#x73B0;&#x5728;&#x7684;App&#x5934;&#x50CF;&#x5927;&#x90E8;&#x5206;&#x90FD;&#x662F;&#x5706;&#x5F62;&#x7684;&#x4E86;&#xFF0C;&#x867D;&#x7136;&#x4E0D;&#x77E5;&#x9053;&#x8FD9;&#x8D8B;&#x52BF;&#x662F;&#x600E;&#x4E48;&#x6D41;&#x884C;&#x8D77;&#x6765;&#x7684;&#xFF0C;&#x4F46;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;<strong>Android</strong>&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x8FD8;&#x662F;&#x8981;&#x968F;&#x7740;&#x6F6E;&#x6D41;&#x524D;&#x8FDB;&#x3002;&#x6240;&#x4EE5;&#x81EA;&#x5DF1;&#x5C31;&#x7814;&#x7A76;&#x4E86;&#x4E00;&#x4E0B;&#x5706;&#x5F62;&#x5934;&#x50CF;&#x7684;&#x5236;&#x4F5C;&#xFF0C;&#x867D;&#x7136;&#x4E5F;&#x6709;&#x8FD9;&#x65B9;&#x9762;&#x7684;&#x5F00;&#x6E90;&#x5E93;&#xFF0C;&#x4F46;&#x81EA;&#x5DF1;&#x61C2;&#x5F97;&#x539F;&#x7406;&#x8FD8;&#x662F;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x5C31;&#x5206;&#x4EAB;&#x4E0B;&#x81EA;&#x5DF1;&#x7684;&#x6240;&#x5F97;&#xFF0C;&#x4E0D;&#x8DB3;&#x4E4B;&#x5904;&#x6B22;&#x8FCE;&#x6307;&#x6559;&#x3002;</p>\n<hr>\n<h1 id=\"&#x539F;&#x7406;\"><a href=\"#&#x539F;&#x7406;\" class=\"headerlink\" title=\"&#x539F;&#x7406;\"></a>&#x539F;&#x7406;</h1><p>&#x5706;&#x5F62;&#x5934;&#x50CF;&#x561B;&#x8BF4;&#x5230;&#x5E95;&#x5C31;&#x662F;&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x6240;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#x5706;&#x5F62;&#x56FE;&#x7247;&#x63A7;&#x4EF6;&#x81EA;&#x7136;&#x8981;&#x7EE7;&#x627F;<strong>Android</strong>&#x539F;&#x751F;&#x7684;<strong>ImgaeView</strong>,&#x5B9E;&#x73B0;&#x5176;&#x4E2D;&#x7684;<strong>setImageBitmap</strong>&#xFF0C;<strong>setImageDrawable</strong>&#xFF0C;<strong>setImageURI</strong>&#xFF0C;<strong>setImageResource</strong>&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5F53;&#x7136;&#x4E3B;&#x8981;&#x7684;<strong>onDraw</strong>&#x65B9;&#x6CD5;&#x4E5F;&#x4E0D;&#x80FD;&#x7F3A;&#x5C11;&#xFF0C;&#x5728;&#x5176;&#x4E2D;&#x8981;&#x5B9E;&#x73B0;&#x5706;&#x5F62;&#x5934;&#x50CF;&#x7684;&#x7ED8;&#x5236;&#x3002;&#x8FD9;&#x91CC;&#x8FD8;&#x8981;&#x501F;&#x52A9;&#x4E24;&#x4E2A;&#x4E3B;&#x8981;&#x7684;&#x7C7B;<strong>Matrix</strong>&#x4E0E;<strong>BitmapShader</strong>&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x4E24;&#x4E2A;&#x7C7B;&#x5B9E;&#x73B0;&#x56FE;&#x7247;&#x7684;&#x7F29;&#x653E;&#x6548;&#x679C;&#x3002;</p>\n<h2 id=\"BitmapShader&#x89E3;&#x91CA;\"><a href=\"#BitmapShader&#x89E3;&#x91CA;\" class=\"headerlink\" title=\"BitmapShader&#x89E3;&#x91CA;\"></a>BitmapShader&#x89E3;&#x91CA;</h2><p><strong>BitmapShader</strong>&#x6709;&#x4E09;&#x4E2A;&#x53C2;&#x6570;  </p>\n<ul>\n<li>bitmap - The bitmap to use inside the shader</li>\n<li>tileX - The tiling mode for x to draw the bitmap in.</li>\n<li>tileY - The tiling mode for y to draw the bitmap in.</li>\n</ul>\n<p><strong>tileX</strong>&#x4E0E;<strong>tileY</strong>&#x90FD;&#x662F;<strong>Shader.TileMode</strong>&#x7C7B;&#x578B;&#xFF0C;&#x6709;&#x4E09;&#x4E2A;&#x9009;&#x62E9;&#x503C;</p>\n<ul>\n<li>CLAMP &#x62C9;&#x4F38; </li>\n<li>PEREAT &#x91CD;&#x590D;</li>\n<li>MIRROR &#x955C;&#x50CF;</li>\n</ul>\n<blockquote>\n<p><em>&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x53EA;&#x8981;&#x4F7F;&#x7528;CLAMP&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x60F3;&#x77E5;&#x9053;&#x5176;&#x5B83;&#x7684;&#x9009;&#x62E9;&#x503C;&#x7684;&#x5177;&#x4F53;&#x6548;&#x679C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x8FD9;&#x4E2A;&#x94FE;&#x63A5;&#xFF1A;<a href=\"http://blog.csdn.net/sjf0115/article/details/7267532\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/sjf0115/article/details/7267532</a></em></p>\n</blockquote>\n<h2 id=\"&#x83B7;&#x53D6;&#x7F29;&#x653E;&#x503C;\"><a href=\"#&#x83B7;&#x53D6;&#x7F29;&#x653E;&#x503C;\" class=\"headerlink\" title=\"&#x83B7;&#x53D6;&#x7F29;&#x653E;&#x503C;\"></a>&#x83B7;&#x53D6;&#x7F29;&#x653E;&#x503C;</h2><p>&#x56FE;&#x7247;&#x8FC7;&#x5927;&#x4E0E;&#x8FC7;&#x5C0F;&#x90FD;&#x4E0D;&#x597D;&#xFF0C;&#x4E0D;&#x53EF;&#x80FD;&#x7EDD;&#x5BF9;&#x7684;&#x9002;&#x4E2D;&#xFF0C;&#x6240;&#x4EE5;&#x7F29;&#x653E;&#x503C;&#x7684;&#x83B7;&#x53D6;&#x662F;&#x6700;&#x91CD;&#x8981;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x8981;&#x6BD4;&#x8F83;&#x56FE;&#x7247;&#x5BBD;&#x9AD8;&#x4E0E;&#x63A7;&#x4EF6;&#x5BBD;&#x9AD8;&#xFF0C;&#x901A;&#x8FC7;&#x9519;&#x4F4D;&#x76F8;&#x4E58;&#x6765;&#x6BD4;&#x8F83;&#x56FE;&#x7247;&#x7684;&#x5BBD;&#x9AD8;&#x54EA;&#x4E2A;&#x4E0E;&#x63A7;&#x4EF6;&#x7684;&#x5BBD;&#x9AD8;&#x76F8;&#x5DEE;&#x66F4;&#x5927;&#x3002;&#x53D6;&#x76F8;&#x5DEE;&#x5927;&#x7684;&#x503C;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x5F97;&#x5230;&#x7F29;&#x653E;&#x503C;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4E3B;&#x8981;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mDrawableRec.set(0, 0, getWidth(), getHeight());</span><br><span class=\"line\">        if (mBitmapWidth * mDrawableRec.height() &gt; mDrawableRec.width() * mBitmapheight) {</span><br><span class=\"line\">            scal = mDrawableRec.height() / mBitmapheight;</span><br><span class=\"line\">        } else {</span><br><span class=\"line\">            scal = mDrawableRec.width() / mBitmapWidth;</span><br><span class=\"line\">        }</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x8BBE;&#x7F6E;BitmapShader\"><a href=\"#&#x8BBE;&#x7F6E;BitmapShader\" class=\"headerlink\" title=\"&#x8BBE;&#x7F6E;BitmapShader\"></a>&#x8BBE;&#x7F6E;BitmapShader</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mBitmapShader = new BitmapShader(mBitmap, \tShader.TileMode.CLAMP, Shader.TileMode.CLAMP);</span><br><span class=\"line\">mPaint.setShader(mBitmapShader);</span><br></pre></td></tr></table></figure>\n<h3 id=\"&#x8BBE;&#x7F6E;&#x7F29;&#x653E;&#x4E0E;&#x77E9;&#x9635;\"><a href=\"#&#x8BBE;&#x7F6E;&#x7F29;&#x653E;&#x4E0E;&#x77E9;&#x9635;\" class=\"headerlink\" title=\"&#x8BBE;&#x7F6E;&#x7F29;&#x653E;&#x4E0E;&#x77E9;&#x9635;\"></a>&#x8BBE;&#x7F6E;&#x7F29;&#x653E;&#x4E0E;&#x77E9;&#x9635;</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mMatrix.setScale(scal, scal);</span><br><span class=\"line\">mBitmapShader.setLocalMatrix(mMatrix);</span><br></pre></td></tr></table></figure>\n<h2 id=\"onDraw&#x7ED8;&#x5236;\"><a href=\"#onDraw&#x7ED8;&#x5236;\" class=\"headerlink\" title=\"onDraw&#x7ED8;&#x5236;\"></a>onDraw&#x7ED8;&#x5236;</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">protected void onDraw(Canvas canvas) {</span><br><span class=\"line\">    if (mBitmap == null) {</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    //&#x586B;&#x5145;</span><br><span class=\"line\">    canvas.drawCircle(getWidth() / 2.0f, getHeight() / 2.0f, mRadius, mFillPaint);</span><br><span class=\"line\">    canvas.drawCircle(getWidth() / 2.0f, getHeight() / 2.0f, mRadius, mPaint);</span><br><span class=\"line\">    //&#x63CF;&#x8FB9;</span><br><span class=\"line\">    if (mStrokeWidth != 0)</span><br><span class=\"line\">    canvas.drawCircle(getWidth() / 2.0f, getHeight() / 2.0f, mRadius, mBorderPaint);</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>&#x8FD9;&#x91CC;&#x7684;&#x987A;&#x5E8F;&#x4E0D;&#x8981;&#x6253;&#x4E71;&#xFF0C;&#x5426;&#x5219;&#x56DE;&#x5F71;&#x54CD;&#x56FE;&#x7247;&#x539F;&#x6709;&#x7684;&#x989C;&#x8272;&#x6548;&#x679C;</em></p>\n</blockquote>\n<p>&#x597D;&#x4E86;&#x4E3B;&#x8981;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x8FD9;&#x4E9B;&#x4E86;&#xFF0C;&#x5176;&#x5B9E;&#x53EA;&#x8981;&#x7406;&#x89E3;&#x4E0A;&#x9762;&#x7684;&#x5C31;&#x57FA;&#x672C;&#x4E0A;&#x638C;&#x63E1;&#x4E86;&#x5706;&#x5F62;&#x5934;&#x50CF;&#x7684;&#x8BBE;&#x7F6E;&#x4E86;&#x3002;</p>\n<h2 id=\"&#x5BF9;&#x5916;&#x65B9;&#x6CD5;\"><a href=\"#&#x5BF9;&#x5916;&#x65B9;&#x6CD5;\" class=\"headerlink\" title=\"&#x5BF9;&#x5916;&#x65B9;&#x6CD5;\"></a>&#x5BF9;&#x5916;&#x65B9;&#x6CD5;</h2><ul>\n<li>setBorderColor(); &#x8BBE;&#x7F6E;&#x8FB9;&#x754C;&#x989C;&#x8272;</li>\n<li>setFillColor();    &#x586B;&#x5145;&#x989C;&#x8272;</li>\n<li>setStrokeWidth(); &#x63CF;&#x8FB9;&#x5BBD;&#x5EA6;</li>\n</ul>\n<h2 id=\"&#x5F15;&#x7528;\"><a href=\"#&#x5F15;&#x7528;\" class=\"headerlink\" title=\"&#x5F15;&#x7528;\"></a>&#x5F15;&#x7528;</h2><p>&#x4F7F;&#x7528;&#x7684;&#x8BDD;&#x76F4;&#x63A5;&#x5728;xml&#x6587;&#x4EF6;&#x4E2D;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<strong>CircleImageView</strong>&#x63A7;&#x4EF6;&#xFF0C;</p>\n<p><strong>&#x6CE8;&#x610F;&#xFF1A;</strong>&#x5982;&#x679C;&#x8981;&#x5728;xml&#x4E2D;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x663E;&#x793A;&#x56FE;&#x7247;&#x65F6;&#x4E0D;&#x8981;&#x4F7F;&#x7528;background&#x8BBE;&#x7F6E;&#xFF0C;&#x5426;&#x5219;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x5DEE;&#x9519;&#xFF0C;&#x4F7F;&#x7528;src&#x5C31;&#x4E0D;&#x4F1A;&#x6709;&#x95EE;&#x9898;&#x4E86;&#x3002;</p>\n<h1 id=\"&#x6548;&#x679C;&#x56FE;\"><a href=\"#&#x6548;&#x679C;&#x56FE;\" class=\"headerlink\" title=\"&#x6548;&#x679C;&#x56FE;\"></a>&#x6548;&#x679C;&#x56FE;</h1><p><img src=\"/2016/03/20/circleView/CircleImageView.gif\" alt=\"&#x6548;&#x679C;&#x56FE;\"></p>\n<hr>\n<p>&#x66F4;&#x591A;&#x6E90;&#x7801;&#xFF1A;<a href=\"https://github.com/idisfkj/CircleImageView\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/CircleImageView</a></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["view"]},{"title":"github中README.md插入图片","url":"https://www.rousetime.com/2016/03/13/github-README/","content":"<p>&#x5728;<strong>Github</strong>&#x4E0A;&#x7684;&#x9879;&#x76EE;&#x4E2D;&#x6709;&#x4E2A;README.md&#x6587;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x5728;&#x5176;&#x4E2D;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x5462;&#xFF1F;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x683C;&#x5F0F;&#x95EE;&#x9898;&#xFF0C;&#x56FA;&#x5B9A;&#x7684;&#x8BB0;&#x4F4F;&#x5C31;&#x884C;</p>\n<h3 id=\"&#x94FE;&#x63A5;&#x683C;&#x5F0F;&#xFF1A;\"><a href=\"#&#x94FE;&#x63A5;&#x683C;&#x5F0F;&#xFF1A;\" class=\"headerlink\" title=\"&#x94FE;&#x63A5;&#x683C;&#x5F0F;&#xFF1A;\"></a>&#x94FE;&#x63A5;&#x683C;&#x5F0F;&#xFF1A;</h3><p>(<a href=\"https://github.com/yourname/your-repository/raw/master/images-folder/xxx.png\" target=\"_blank\" rel=\"noopener\">https://github.com/yourname/your-repository/raw/master/images-folder/xxx.png</a>)</p>\n<hr>\n<h3 id=\"&#x89E3;&#x91CA;\"><a href=\"#&#x89E3;&#x91CA;\" class=\"headerlink\" title=\"&#x89E3;&#x91CA;\"></a>&#x89E3;&#x91CA;</h3><ul>\n<li>yourname Github&#x5E10;&#x53F7;&#x540D;</li>\n<li>your-repository Github&#x5F53;&#x524D;&#x4ED3;&#x5E93;&#x540D;</li>\n<li>raw/master &#x539F;&#x751F; &#x56FA;&#x5B9A;&#x4E0D;&#x53D8;</li>\n<li>images-folder &#x653E;&#x56FE;&#x7247;&#x7684;&#x6587;&#x4EF6;&#x5939; &#x6CE8;&#x610F;&#x8BE5;&#x6587;&#x4EF6;&#x5939;&#x5728;&#x4F60;&#x672C;&#x5730;&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#x4E0B;</li>\n<li>xxx.png &#x56FE;&#x7247;</li>\n</ul>\n<h3 id=\"&#x63D0;&#x4EA4;\"><a href=\"#&#x63D0;&#x4EA4;\" class=\"headerlink\" title=\"&#x63D0;&#x4EA4;\"></a>&#x63D0;&#x4EA4;</h3><p>&#x518D;&#x901A;&#x8FC7;git push &#x63D0;&#x4EA4;&#x5230;<strong>Github</strong>&#x4E0A;</p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["github"],"tags":["github"]},{"title":"滑轮选择器","url":"https://www.rousetime.com/2016/03/13/PickerView/","content":"<p>&#x539F;&#x6765;&#x505A;&#x9879;&#x76EE;&#x65F6;&#x7528;&#x5230;&#x4E86;&#x6ED1;&#x8F6E;&#x9009;&#x62E9;&#x5668;&#xFF0C;&#x4E5F;&#x662F;&#x501F;&#x9274;&#x4E86;&#x522B;&#x4EBA;&#x7684;&#xFF0C;&#x4F46;&#x5F53;&#x65F6;&#x65F6;&#x95F4;&#x7D27;&#x4E5F;&#x5C31;&#x6CA1;&#x81EA;&#x5DF1;&#x600E;&#x4E48;&#x4F18;&#x5316;&#x4E0E;&#x5DE9;&#x56FA;&#xFF0C;&#x6700;&#x8FD1;&#x65F6;&#x95F4;&#x5145;&#x8DB3;&#x5C31;&#x91CD;&#x65B0;&#x5DE9;&#x56FA;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x8BB0;&#x4E0B;&#x81EA;&#x5DF1;&#x7684;&#x5FC3;&#x5F97;&#x4E0E;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x4EE5;&#x514D;&#x4EE5;&#x540E;&#x751F;&#x758F;&#xFF0C;&#x6709;&#x4E0D;&#x8DB3;&#x7684;&#x5730;&#x65B9;&#x6B22;&#x8FCE;&#x6307;&#x6559;&#x3002;</p>\n<hr>\n<h1 id=\"&#x5B9E;&#x73B0;&#x539F;&#x7406;\"><a href=\"#&#x5B9E;&#x73B0;&#x539F;&#x7406;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;&#x539F;&#x7406;\"></a>&#x5B9E;&#x73B0;&#x539F;&#x7406;</h1><ul>\n<li>&#x9996;&#x5148;&#x81EA;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;<font color=\"#FF0000\">PickerView</font>&#x7EE7;&#x627F;android&#x539F;&#x751F;&#x7684;<font color=\"#FF0000\">View</font></li>\n<li>&#x5B9E;&#x73B0;&#x6ED1;&#x52A8;&#x70B9;&#x51FB;&#x76D1;&#x542C;&#x4E8B;&#x4EF6;&#xFF0C;&#x901A;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x89E6;&#x6478;&#x5224;&#x65AD;&#x5B9E;&#x73B0;&#x6ED1;&#x52A8;&#x6548;&#x679C;</li>\n<li>&#x5176;&#x6B21;<font color=\"#FF0000\">TextPicker</font>&#x7EE7;&#x627F;<font color=\"#FF0000\">PopupWindow</font>&#x88C5;&#x8F7D;&#x8FD9;&#x4E2A;<font color=\"#FF0000\">PickerView</font>&#x5B9E;&#x73B0;&#x5C55;&#x793A;</li>\n</ul>\n<blockquote>\n<p><em>&#x539F;&#x7406;&#x8FD8;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x4E3B;&#x8981;&#x7684;&#x5C31;&#x662F;&#x81EA;&#x5B9A;&#x4E49;&#x7684;PickerView</em></p>\n</blockquote>\n<h2 id=\"PickerView&#x7684;&#x5B9E;&#x73B0;\"><a href=\"#PickerView&#x7684;&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"PickerView&#x7684;&#x5B9E;&#x73B0;\"></a>PickerView&#x7684;&#x5B9E;&#x73B0;</h2><p>&#x5176;&#x4E2D;&#x4E3B;&#x8981;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x662F;<font color=\"#FF0000\">onDrawView()</font>&#x4E0E;<font color=\"#FF0000\">drawOtherView</font>&#x7ED8;&#x5236;&#x6ED1;&#x8F6E;&#x9009;&#x62E9;&#x5668;&#x7684;&#x6587;&#x672C;&#x663E;&#x793A;,&#x7136;&#x540E;&#x5C31;&#x662F;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;<font color=\"#FF0000\">onTouchEvent()</font>&#x7684;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x3002;</p>\n<h3 id=\"onDrawView&#x7684;&#x60F3;&#x6CD5;\"><a href=\"#onDrawView&#x7684;&#x60F3;&#x6CD5;\" class=\"headerlink\" title=\"onDrawView&#x7684;&#x60F3;&#x6CD5;\"></a>onDrawView&#x7684;&#x60F3;&#x6CD5;</h3><p>&#x6ED1;&#x8F6E;&#x7684;&#x6587;&#x672C;&#x6548;&#x679C;&#x662F;&#x8981;&#x4E2D;&#x95F4;&#x7684;&#x6587;&#x672C;&#x663E;&#x793A;&#x6B63;&#x5E38;&#x800C;&#x4E0A;&#x9762;&#x4E0E;&#x4E0B;&#x9762;&#x7684;&#x6587;&#x672C;&#x8981;&#x76F8;&#x5E94;&#x7684;&#x7F29;&#x5C0F;&#x5B57;&#x4F53;&#x5927;&#x5C0F;&#x8FBE;&#x5230;&#x8FDC;&#x79BB;&#x7684;&#x611F;&#x89C9;&#xFF0C;&#x6240;&#x7528;&#x9996;&#x5148;&#x7ED8;&#x5236;&#x597D;&#x4E2D;&#x95F4;&#x7684;&#x6587;&#x672C;&#xFF0C;&#x518D;&#x4EE5;&#x4E2D;&#x95F4;&#x7684;&#x6587;&#x672C;&#x4E3A;&#x4E2D;&#x5FC3;&#x7ED8;&#x5236;&#x4E0A;&#x4E0B;&#x7684;&#x6587;&#x672C;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x90E8;&#x5206;&#x6E90;&#x7801;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void onDrawView(Canvas canvas) {</span><br><span class=\"line\">       float scal = getParabola((screenHeight / 4.0f), moveLength);</span><br><span class=\"line\">       //&#x5B57;&#x4F53;&#x5C45;&#x4E2D;&#x663E;&#x793A;</span><br><span class=\"line\">       float x = screenWidth / 2.0f;</span><br><span class=\"line\">       float y = screenHeight / 2.0f + moveLength;</span><br><span class=\"line\">       float size = (maxTextSize - minTextSize) * scal + minTextSize;</span><br><span class=\"line\">       //&#x83B7;&#x5F97;Paint&#x7684;&#x5C5E;&#x6027;&#x53C2;&#x6570;</span><br><span class=\"line\">       Paint.FontMetricsInt pfm = mPaint.getFontMetricsInt();</span><br><span class=\"line\">       //&#x5F97;&#x5230;&#x5C45;&#x4E2D;y</span><br><span class=\"line\">       float baseLine = y - (pfm.top + pfm.bottom) / 2;</span><br><span class=\"line\">       mPaint.setTextSize(size);</span><br><span class=\"line\">       mPaint.setAlpha((int) ((maxAlpha - minAlpha) * scal + minAlpha));</span><br><span class=\"line\">       //&#x753B;&#x4E2D;&#x95F4;&#x4F4D;&#x7F6E;</span><br><span class=\"line\">       canvas.drawText(dataList.get(position), x, baseLine, mPaint);</span><br><span class=\"line\">       //&#x753B;&#x4E0A;&#x9762;&#x4F4D;&#x7F6E;</span><br><span class=\"line\">       for (int i = 1; position - i &gt;= 0; i++) {</span><br><span class=\"line\">           drawOtherView(canvas, i, -1);</span><br><span class=\"line\">       }</span><br><span class=\"line\">       //&#x753B;&#x4E0B;&#x9762;&#x7684;&#x4F4D;&#x7F6E;</span><br><span class=\"line\">       for (int i = 1; position + i &lt; dataList.size(); i++) {</span><br><span class=\"line\">           drawOtherView(canvas, i, 1);</span><br><span class=\"line\">       }</span><br><span class=\"line\">   }  </span><br><span class=\"line\">   </span><br><span class=\"line\">   </span><br><span class=\"line\">private void drawOtherView(Canvas canvas, int i, int direction) {</span><br><span class=\"line\">       float offsetY = (MARGIN * minTextSize * i + moveLength * direction);</span><br><span class=\"line\">       float scal = getParabola(screenHeight / 4.0f, offsetY);</span><br><span class=\"line\">       float x = screenWidth / 2.0f;</span><br><span class=\"line\">       float y = screenHeight / 2.0f + direction * offsetY;</span><br><span class=\"line\">       float size = (maxTextSize - minTextSize) * scal + minTextSize;</span><br><span class=\"line\">       float alpha = (maxAlpha - minAlpha) * scal + minAlpha;</span><br><span class=\"line\">       Paint.FontMetricsInt pfm = mPaint.getFontMetricsInt();</span><br><span class=\"line\">       float baseLine = (float) (y - (pfm.top + pfm.bottom) / 2.0);</span><br><span class=\"line\">       mPaint.setTextSize(size);</span><br><span class=\"line\">       mPaint.setAlpha((int) alpha);</span><br><span class=\"line\">       canvas.drawText(dataList.get(position + direction * i), x, baseLine, mPaint);</span><br><span class=\"line\">   }</span><br></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x5C31;&#x662F;&#x89E6;&#x6478;&#x6ED1;&#x52A8;&#x6548;&#x679C;&#xFF0C;&#x901A;&#x8FC7;<font color=\"#FF0000\">doDown()</font>,<font color=\"#FF0000\">doMove()</font>&#x4E0E;<font color=\"#FF0000\">doUp()</font>&#x6765;&#x64CD;&#x4F5C;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void doMove(MotionEvent event) {</span><br><span class=\"line\">        moveLength += event.getY() - eventY;</span><br><span class=\"line\">        if (moveLength &gt; MARGIN * minTextSize / 2) {</span><br><span class=\"line\">            //&#x624B;&#x6307;&#x5411;&#x4E0B;&#x6ED1;&#x52A8;&#x6ED1;&#x51FA;&#x8FB9;&#x754C;</span><br><span class=\"line\">            moveFootTOHead();</span><br><span class=\"line\">            moveLength = moveLength - MARGIN * minTextSize;</span><br><span class=\"line\">        } else if (moveLength &lt; -MARGIN * minTextSize / 2) {</span><br><span class=\"line\">            //&#x624B;&#x6307;&#x5411;&#x4E0A;&#x6ED1;&#x52A8;&#x6ED1;&#x51FA;&#x8FB9;&#x754C;</span><br><span class=\"line\">            moveHeadToFoot();</span><br><span class=\"line\">            moveLength = moveLength + MARGIN * minTextSize;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        eventY = event.getY();</span><br><span class=\"line\">        invalidate();</span><br><span class=\"line\">    }</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>PickerView&#x7684;&#x4E3B;&#x610F;&#x65B9;&#x6CD5;&#x5C31;&#x8FD9;&#x4E9B;&#x4E86;,&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x7B80;&#x5355;</em></p>\n</blockquote>\n<p>&#x5B9E;&#x73B0;&#x4E86;<font color=\"#FF0000\">PickerView</font>&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x5355;&#x72EC;&#x7684;&#x4E00;&#x4E2A;xml&#x4E2D;&#x5E03;&#x5C40;&#xFF0C;xml&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x4E0D;&#x8D34;&#x4E86;</p>\n<h2 id=\"TextPicker\"><a href=\"#TextPicker\" class=\"headerlink\" title=\"TextPicker\"></a>TextPicker</h2><p>&#x5BF9;&#x4E8E;xml&#x4E2D;<font color=\"#FF0000\">PickerView</font>&#x8FDB;&#x884C;&#x4E86;&#x5C01;&#x88C5;&#xFF0C;&#x56E0;&#x4E3A;&#x53EF;&#x4EE5;&#x9879;&#x76EE;&#x4E2D;&#x8981;&#x7528;&#x5230;&#x591A;&#x6B21;&#xFF0C;&#x6240;&#x7528;&#x5199;&#x4E2A;&#x5C01;&#x88C5;&#x7C7B;&#x8FD8;&#x662F;&#x5FC5;&#x987B;&#x7684;</p>\n<h3 id=\"&#x5BF9;&#x5916;&#x65B9;&#x6CD5;\"><a href=\"#&#x5BF9;&#x5916;&#x65B9;&#x6CD5;\" class=\"headerlink\" title=\"&#x5BF9;&#x5916;&#x65B9;&#x6CD5;\"></a>&#x5BF9;&#x5916;&#x65B9;&#x6CD5;</h3><ul>\n<li>setPickerTitle(String text)    &#x8BBE;&#x7F6E;&#x6807;&#x9898;</li>\n<li>setData(List<string> dataList, int i) &#x586B;&#x5145;&#x6570;&#x636E;</string></li>\n<li>setMiddleText(int position, int i) &#x8BBE;&#x7F6E;&#x5C45;&#x4E2D;&#x6587;&#x672C;</li>\n<li>getText(int i) &#x83B7;&#x53D6;&#x6587;&#x672C;</li>\n<li>getOK() &#x83B7;&#x53D6;&#x786E;&#x5B9A;&#x63A7;&#x4EF6;</li>\n<li>setPrepare() &#x5F00;&#x542F;</li>\n</ul>\n<h2 id=\"&#x5B9E;&#x73B0;\"><a href=\"#&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;\"></a>&#x5B9E;&#x73B0;</h2><p>&#x6700;&#x540E;&#x5C31;&#x662F;&#x5B9E;&#x4F8B;&#x5316;&#x4E2D;<font color=\"#FF0000\">TextPicker</font>&#x8C03;&#x7528;&#x5176;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tp = new TextPicker(this);</span><br><span class=\"line\">        //&#x521D;&#x59CB;&#x5316;&#x6570;&#x636E;</span><br><span class=\"line\">        initData();</span><br><span class=\"line\">        //&#x52A0;&#x8F7D;&#x6570;&#x636E;</span><br><span class=\"line\">        tp.setData(leftList, 1);</span><br><span class=\"line\">        tp.setData(middleList, 2);</span><br><span class=\"line\">        tp.setData(rightList, 3);</span><br><span class=\"line\">        //&#x8BBE;&#x7F6E;&#x6807;&#x9898;</span><br><span class=\"line\">        tp.setPickerTitle(&quot;&#x6807;&#x9898;&quot;);</span><br><span class=\"line\">        //&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x5C45;&#x4E2D;&#x6587;&#x672C;</span><br><span class=\"line\">        tp.setMiddleText(5, 1);</span><br><span class=\"line\">        tp.setMiddleText(2, 2);</span><br><span class=\"line\">        tp.setMiddleText(25, 3);</span><br><span class=\"line\">        //&#x51C6;&#x5907;&#x5B8C;&#x6BD5;</span><br><span class=\"line\">        tp.setPrepare();</span><br><span class=\"line\">        ok = tp.getOK();</span><br><span class=\"line\">        ok.setOnClickListener(new View.OnClickListener(){</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onClick(View v) {</span><br><span class=\"line\">                leftText = tp.getText(1);</span><br><span class=\"line\">                middleText = tp.getText(2);</span><br><span class=\"line\">                rightText = tp.getText(3);</span><br><span class=\"line\">                tv.setText(leftText+&quot;-&quot;+middleText+&quot;-&quot;+rightText);</span><br><span class=\"line\">                tp.dismiss();</span><br><span class=\"line\">            }</span><br><span class=\"line\">        });</span><br><span class=\"line\">        //&#x5C55;&#x793A;</span><br><span class=\"line\">        tp.showAtLocation(this.findViewById(R.id.main), Gravity.CENTER, 0, 0);</span><br></pre></td></tr></table></figure>\n<h2 id=\"&#x6548;&#x679C;&#x56FE;\"><a href=\"#&#x6548;&#x679C;&#x56FE;\" class=\"headerlink\" title=\"&#x6548;&#x679C;&#x56FE;\"></a>&#x6548;&#x679C;&#x56FE;</h2><p><img src=\"/2016/03/13/PickerView/pickerView.png\" alt=\"PickerView\"></p>\n<p>&#x66F4;&#x591A;&#x6E90;&#x4EE3;&#x7801;&#xFF1A;<a href=\"https://github.com/idisfkj/idisfkj.picker\" target=\"_blank\" rel=\"noopener\">https://github.com/idisfkj/idisfkj.picker</a></p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904; idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["android"],"tags":["picker"]},{"title":"Hexo的安装与配置","url":"https://www.rousetime.com/2016/03/04/Hexo-install/","content":"<h1 id=\"&#x524D;&#x8A00;\"><a href=\"#&#x524D;&#x8A00;\" class=\"headerlink\" title=\"&#x524D;&#x8A00;\"></a>&#x524D;&#x8A00;</h1><p>&#x6211;&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x5F00;&#x59CB;&#x5199;&#x535A;&#x5BA2;&#x5462;&#xFF1F;&#x5176;&#x5B9E;&#x662F;&#x6211;&#x4E0D;&#x4E45;&#x524D;&#x5728;<strong>stormzhang</strong>&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x5E73;&#x53F0;&#x4E0A;&#x770B;&#x5230;&#x4ED6;&#x5199;&#x7684;&#x6210;&#x957F;&#x7ECF;&#x5386;&#xFF0C;&#x4ED6;&#x4E0A;&#x9762;&#x8BF4;&#x5199;&#x535A;&#x5BA2;&#x662F;&#x4ED6;&#x6210;&#x529F;&#x7684;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x90E8;&#x5206;&#x3002;&#x6240;&#x7528;&#x5BF9;&#x4E8E;&#x6211;&#x8FD9;&#x79CD;&#x5C0F;&#x767D;&#xFF0C;&#x4E5F;&#x60F3;&#x5C1D;&#x8BD5;&#x7684;&#x5199;&#x81EA;&#x5DF1;&#x7684;&#x535A;&#x5BA2;&#x3002;&#x4E8E;&#x662F;&#x6211;&#x5C31;&#x5F00;&#x59CB;&#x642D;&#x5EFA;<em>hexo</em>&#x7684;&#x76F8;&#x5173;&#x914D;&#x7F6E;&#x3002;&#x597D;&#x4E86;&#x5E9F;&#x8BDD;&#x4E0D;&#x591A;&#x8BF4;&#x5F00;&#x59CB;&#x642D;&#x5EFA;&#x3002;</p>\n<hr>\n<h2 id=\"&#x73AF;&#x5883;&#x914D;&#x7F6E;\"><a href=\"#&#x73AF;&#x5883;&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"&#x73AF;&#x5883;&#x914D;&#x7F6E;\"></a>&#x73AF;&#x5883;&#x914D;&#x7F6E;</h2><h3 id=\"&#x5B89;&#x88C5;Node\"><a href=\"#&#x5B89;&#x88C5;Node\" class=\"headerlink\" title=\"&#x5B89;&#x88C5;Node\"></a>&#x5B89;&#x88C5;Node</h3><p>&#x53EA;&#x8981;&#x5230;<a href=\"https://nodejs.org/en/\" target=\"_blank\" rel=\"noopener\">Node.js</a>&#x7684;&#x5B98;&#x7F51;&#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7248;&#x672C;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;&#x4E0B;&#x8F7D;&#x540E;&#x4E00;&#x8DEF;&#x5B89;&#x88C5;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x3002;</p>\n<h3 id=\"&#x5B89;&#x88C5;git\"><a href=\"#&#x5B89;&#x88C5;git\" class=\"headerlink\" title=\"&#x5B89;&#x88C5;git\"></a>&#x5B89;&#x88C5;git</h3><p><a href=\"http://git-scm.com/\" target=\"_blank\" rel=\"noopener\">git</a>&#x7684;&#x5B89;&#x88C5;&#x4E5F;&#x4E0D;&#x590D;&#x6742;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x7ED9;&#x4E2A;<a href=\"http://git-scm.com/book/zh/v1\" target=\"_blank\" rel=\"noopener\">&#x6559;&#x7A0B;</a>&#x7ED9;&#x4F60;&#x4EEC;&#x5305;&#x62EC;&#x5B89;&#x88C5;&#x4E0E;&#x57FA;&#x672C;&#x7684;&#x4F7F;&#x7528;&#x3002;<br>&#x81F3;&#x4E8E;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5B89;&#x88C5;git&#x4E0B;&#x9762;&#x4F1A;&#x8BB2;&#x5230;&#x3002;</p>\n<h3 id=\"&#x5B89;&#x88C5;Sublime-Text\"><a href=\"#&#x5B89;&#x88C5;Sublime-Text\" class=\"headerlink\" title=\"&#x5B89;&#x88C5;Sublime Text\"></a>&#x5B89;&#x88C5;Sublime Text</h3><blockquote>\n<p><em>&#x4E2A;&#x4EBA;&#x63A8;&#x8350; &#x540E;&#x9762;&#x6587;&#x4EF6;&#x914D;&#x7F6E;&#x7684;&#x65F6;&#x5019;&#x8FD9;&#x4E2A;&#x6587;&#x672C;&#x7F16;&#x8F91;&#x5668;&#x8FD8;&#x662F;&#x5F88;&#x597D;&#x7528;&#x7684;,&#x57FA;&#x672C;&#x4E0A;&#x4EC0;&#x4E48;&#x683C;&#x5F0F;&#x7684;&#x6587;&#x4EF6;&#x90FD;&#x80FD;&#x6253;&#x5F00;&#x7F16;&#x8F91;&#x3002;</em></p>\n</blockquote>\n<p><a href=\"http://www.sublimetext.com/3\" target=\"_blank\" rel=\"noopener\">Sublime Text</a>&#x4E0B;&#x8F7D;</p>\n<h3 id=\"Github&#x8D26;&#x53F7;&#x6CE8;&#x518C;\"><a href=\"#Github&#x8D26;&#x53F7;&#x6CE8;&#x518C;\" class=\"headerlink\" title=\"Github&#x8D26;&#x53F7;&#x6CE8;&#x518C;\"></a>Github&#x8D26;&#x53F7;&#x6CE8;&#x518C;</h3><blockquote>\n<p><em>git&#x5B89;&#x88C5;&#x597D;&#x4E86;&#x540E; &#x5982;&#x679C;&#x6709;github&#x8D26;&#x53F7;&#x4E14;&#x914D;&#x7F6E;&#x4E86;SSH Key&#x8BF7;&#x8DF3;&#x8FC7;&#x8FD9;&#x91CC;</em></p>\n</blockquote>\n<ul>\n<li>&#x9996;&#x5148;&#x53BB;<a href=\"https://github.com/\" target=\"_blank\" rel=\"noopener\">Github</a>&#x6CE8;&#x518C;&#x8D26;&#x53F7;</li>\n<li>&#x521B;&#x5EFA;&#x4ED3;&#x5E93; New repository &#x5728;Repository name&#x4E2D;&#x5FC5;&#x987B;&#x4E3A;&#x4F60;&#x7684;[your_user_name].github.io <img src=\"/2016/03/04/Hexo-install/github.png\" alt=\"github\"></li>\n<li><p>&#x521B;&#x5EFA;SSH Key</p>\n<p>  &#x521B;&#x5EFA;&#x4F60;&#x7684;&#x7528;&#x6237;&#x540D;&#x4E0E;&#x5BC6;&#x7801;:</p>\n<pre><code>git config --global user.email &quot;your email&quot;\n git config --global user.name &quot;your name&quot;\n</code></pre><p>  &#x751F;&#x6210;&#x5BC6;&#x94A5;&#xFF1A;</p>\n<pre><code>ssh-keygen -t rsa -C &quot;your email&quot;\n</code></pre><p>  &#x6700;&#x540E;&#x6839;&#x636E;&#x63D0;&#x793A;&#x5C31;&#x80FD;&#x751F;&#x6210;SSH Key&#x4E86;<a href=\"https://help.github.com/articles/generating-an-ssh-key/\" target=\"_blank\" rel=\"noopener\">&#x6559;&#x7A0B;&#x53C2;&#x8003;</a></p>\n</li>\n<li><p>&#x8FDB;&#x5165;Settings&#x4E2D;&#x7684;SSH Keys &#x6DFB;&#x52A0;&#x5BC6;&#x5319;</p>\n</li>\n</ul>\n<h2 id=\"&#x5B89;&#x88C5;hexo\"><a href=\"#&#x5B89;&#x88C5;hexo\" class=\"headerlink\" title=\"&#x5B89;&#x88C5;hexo\"></a>&#x5B89;&#x88C5;hexo</h2><ul>\n<li><p>&#x8FDB;&#x5165;&#x7EC8;&#x7AEF;&#x6267;&#x884C;</p>\n<pre><code>nmp install -g hexo\n</code></pre></li>\n<li><p>&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x76EE;&#x5F55;&#x4F8B;&#x5982;blog &#x8FDB;&#x5165;blog&#x76EE;&#x5F55;</p>\n<pre><code>init hexo \n</code></pre></li>\n</ul>\n<h2 id=\"hexo&#x914D;&#x7F6E;\"><a href=\"#hexo&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"hexo&#x914D;&#x7F6E;\"></a>hexo&#x914D;&#x7F6E;</h2><h3 id=\"&#x751F;&#x6210;&#x9759;&#x6001;&#x9875;&#x9762;\"><a href=\"#&#x751F;&#x6210;&#x9759;&#x6001;&#x9875;&#x9762;\" class=\"headerlink\" title=\"&#x751F;&#x6210;&#x9759;&#x6001;&#x9875;&#x9762;\"></a>&#x751F;&#x6210;&#x9759;&#x6001;&#x9875;&#x9762;</h3><p><code>hexo gengerate</code></p>\n<h3 id=\"&#x5F00;&#x542F;&#x672C;&#x5730;&#x670D;&#x52A1;\"><a href=\"#&#x5F00;&#x542F;&#x672C;&#x5730;&#x670D;&#x52A1;\" class=\"headerlink\" title=\"&#x5F00;&#x542F;&#x672C;&#x5730;&#x670D;&#x52A1;\"></a>&#x5F00;&#x542F;&#x672C;&#x5730;&#x670D;&#x52A1;</h3><p><code>hexo server</code></p>\n<blockquote>\n<p><em>&#x5F00;&#x542F;&#x540E;&#x6253;&#x5F00;&#x6D4F;&#x89C8;&#x5668; &#x8F93;&#x5165;<a href=\"http://localhost:4000\" target=\"_blank\" rel=\"noopener\">http://localhost:4000</a> &#x5C31;&#x80FD;&#x770B;&#x5230;&#x6548;&#x679C;&#x3002;</em></p>\n</blockquote>\n<h3 id=\"&#x65B0;&#x5EFA;&#x6587;&#x7AE0;\"><a href=\"#&#x65B0;&#x5EFA;&#x6587;&#x7AE0;\" class=\"headerlink\" title=\"&#x65B0;&#x5EFA;&#x6587;&#x7AE0;\"></a>&#x65B0;&#x5EFA;&#x6587;&#x7AE0;</h3><pre><code>hexo new &quot;PostName&quot;\n</code></pre><p>##&#x90E8;&#x7F72;&#x6B65;&#x9AA4;<br>&#x4E00;&#x822C;&#x90E8;&#x7F72;&#x6B65;&#x9AA4;&#xFF1A;</p>\n<p><code>hexo clean</code>              // &#x6E05;&#x7406;<br><code>hexo generate</code>            // &#x751F;&#x6210;<br><code>hexo deploy</code>            // &#x90E8;&#x7F72;</p>\n<p>&#x6216;&#x8005;&#x7B80;&#x5199;&#xFF1A;</p>\n<p><code>hexo c</code><br><code>hexo g</code><br><code>hexo d</code></p>\n<blockquote>\n<p><em>&#x90E8;&#x7F72;&#x5B8C;&#x6210;&#x540E;&#x6253;&#x5F00;&#x6D4F;&#x89C8;&#x5668;&#x8F93;&#x5165;http://[your_user_name].github.io &#x5C31;&#x662F;&#x524D;&#x9762;github&#x4E2D;&#x5EFA;&#x4ED3;&#x5E93;&#x7684;&#x540D;&#x5B57;&#x3002;<br>&#x5230;&#x6B64;&#x6240;&#x7528;&#x7684;&#x5B89;&#x88C5;&#x4E0E;&#x914D;&#x7F6E;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;</em></p>\n</blockquote>\n<h2 id=\"&#x4E0B;&#x8F7D;&#x4E3B;&#x9898;\"><a href=\"#&#x4E0B;&#x8F7D;&#x4E3B;&#x9898;\" class=\"headerlink\" title=\"&#x4E0B;&#x8F7D;&#x4E3B;&#x9898;\"></a>&#x4E0B;&#x8F7D;&#x4E3B;&#x9898;</h2><p>&#x4E3B;&#x9898;&#x7684;&#x8BDD;&#x5C31;&#x8981;&#x770B;&#x4E2A;&#x4EBA;&#x7684;&#x7231;&#x597D;&#x4E86;&#xFF0C;&#x6211;&#x8FD9;&#x6709;&#x4E00;&#x7CFB;&#x5217;&#x7684;<a href=\"https://github.com/hexojs/hexo/wiki/Themes\" target=\"_blank\" rel=\"noopener\">&#x4E3B;&#x9898;</a> &#x559C;&#x6B22;&#x54EA;&#x4E2A;&#x5C31;&#x53BB;&#x91CC;&#x9762;&#x4E0B;&#x8F7D;&#x5C31;&#x884C;&#xFF0C;&#x81F3;&#x4E8E;&#x5982;&#x4F55;&#x4E0B;&#x8F7D;&#x91CC;&#x9762;&#x90FD;&#x8981;&#x8BE6;&#x7EC6;&#x7684;&#x4ECB;&#x7ECD;&#x3002;</p>\n<blockquote>\n<p><em>&#x6211;&#x7684;&#x4E3B;&#x9898;&#x662F;<a href=\"https://github.com/forsigner/fexo\" target=\"_blank\" rel=\"noopener\">Fexo</a>&#x5BF9;&#x6211;&#x8FD9;&#x4E2A;&#x4E3B;&#x9898;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x5C31;&#x4E0D;&#x7528;&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x53BB;&#x67E5;&#x627E;&#x4E86;</em></p>\n</blockquote>\n<h2 id=\"&#x8BC4;&#x8BBA;&#x6846;\"><a href=\"#&#x8BC4;&#x8BBA;&#x6846;\" class=\"headerlink\" title=\"&#x8BC4;&#x8BBA;&#x6846;\"></a>&#x8BC4;&#x8BBA;&#x6846;</h2><p>&#x8BC4;&#x8BBA;&#x6709;Disqus&#x4E0E;&#x591A;&#x8BF4;&#xFF0C;&#x5728;&#x56FD;&#x5185;&#x63A8;&#x8350;&#x591A;&#x8BF4;&#xFF0C;Disqus&#x662F;&#x9762;&#x5411;&#x5168;&#x7403;&#x7684;</p>\n<h3 id=\"Disqus\"><a href=\"#Disqus\" class=\"headerlink\" title=\"Disqus\"></a>Disqus</h3><p><a href=\"https://disqus.com\" target=\"_blank\" rel=\"noopener\">Disqus</a>&#x6CE8;&#x518C;Disqus&#x5E10;&#x53F7;</p>\n<h3 id=\"&#x591A;&#x8BF4;\"><a href=\"#&#x591A;&#x8BF4;\" class=\"headerlink\" title=\"&#x591A;&#x8BF4;\"></a>&#x591A;&#x8BF4;</h3><p><a href=\"http://duoshuo.com\" target=\"_blank\" rel=\"noopener\">&#x591A;&#x8BF4;</a>&#x53EF;&#x4EE5;&#x652F;&#x6301;QQ &#x5FAE;&#x4FE1;&#x7B49;&#x767B;&#x5F55;&#xFF0C;&#x767B;&#x5F55;&#x540E;&#x6CE8;&#x518C;&#x57DF;&#x540D;<br>&#x8FDB;&#x5165;hexo&#x76EE;&#x5F55;&#x6253;&#x5F00;_config.yml&#x6587;&#x4EF6;&#x627E;&#x5230;</p>\n<pre><code>&#xFF03;disqus_shortname: [&#x57DF;&#x540D;]\n duoshuo_shortname: [&#x57DF;&#x540D;]\n</code></pre><blockquote>\n<p><em>Disqus&#x4E5F;&#x662F;&#x4E00;&#x6837;</em></p>\n</blockquote>\n<h2 id=\"&#x7EDF;&#x8BA1;\"><a href=\"#&#x7EDF;&#x8BA1;\" class=\"headerlink\" title=\"&#x7EDF;&#x8BA1;\"></a>&#x7EDF;&#x8BA1;</h2><blockquote>\n<p><em>&#x6211;&#x8FD9;&#x91CC;&#x53EA;&#x8BF4;&#x767E;&#x5EA6;&#x7EDF;&#x8BA1;</em></p>\n</blockquote>\n<p>&#x8FDB;&#x5165;<a href=\"http://sitecenter.baidu.com/\" target=\"_blank\" rel=\"noopener\">&#x767E;&#x5EA6;&#x7EDF;&#x8BA1;</a>&#x6CE8;&#x518C;&#x767B;&#x5F55;&#x5E10;&#x53F7;<br>&#x8FDB;&#x53BB;&#x7F51;&#x7AD9;&#x4E2D;&#x5FC3;&#x7684;&#x4EE3;&#x7801;&#x83B7;&#x53D6;    &#x628A;&#x83B7;&#x53D6;&#x7684;&#x4EE3;&#x7801;&#x653E;&#x5165; hexo/themes/fexo/layout/_partial&#x4E2D;baidu-analytics.ejs&#x6587;&#x4EF6;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;% if (theme.baidu_analytics){ %&gt;</span><br><span class=\"line\">  &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class=\"line\">  //&#x83B7;&#x53D6;&#x7684;&#x4EE3;&#x7801;</span><br><span class=\"line\">   &lt;/script&gt;</span><br><span class=\"line\">&lt;% } %&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"RSS\"><a href=\"#RSS\" class=\"headerlink\" title=\"RSS\"></a>RSS</h2><h3 id=\"feed&#x5B89;&#x88C5;\"><a href=\"#feed&#x5B89;&#x88C5;\" class=\"headerlink\" title=\"feed&#x5B89;&#x88C5;\"></a>feed&#x5B89;&#x88C5;</h3><p><code>npm install hexo-generator-feed</code></p>\n<h3 id=\"&#x5F00;&#x542F;\"><a href=\"#&#x5F00;&#x542F;\" class=\"headerlink\" title=\"&#x5F00;&#x542F;\"></a>&#x5F00;&#x542F;</h3><p>&#x8FDB;&#x5165;hexo_config.yml&#x627E;&#x5230;Plugins</p>\n<pre><code>Plugins:\n - hexo-generator-feed\n</code></pre><p><code>feed:\n    type: atom\n    path: atom.xml\n    limit: 20</code></p>\n<h3 id=\"&#x8BBF;&#x95EE;\"><a href=\"#&#x8BBF;&#x95EE;\" class=\"headerlink\" title=\"&#x8BBF;&#x95EE;\"></a>&#x8BBF;&#x95EE;</h3><p> &#x8BBF;&#x95EE;<a href=\"http://localhost:4000/atom.xml&#x67E5;&#x770B;\" target=\"_blank\" rel=\"noopener\">http://localhost:4000/atom.xml&#x67E5;&#x770B;</a></p>\n<h3 id=\"&#x5347;&#x7EA7;&#x63D2;&#x4EF6;\"><a href=\"#&#x5347;&#x7EA7;&#x63D2;&#x4EF6;\" class=\"headerlink\" title=\"&#x5347;&#x7EA7;&#x63D2;&#x4EF6;\"></a>&#x5347;&#x7EA7;&#x63D2;&#x4EF6;</h3><pre><code>npm update\n</code></pre><h3 id=\"&#x5378;&#x8F7D;&#x63D2;&#x4EF6;\"><a href=\"#&#x5378;&#x8F7D;&#x63D2;&#x4EF6;\" class=\"headerlink\" title=\"&#x5378;&#x8F7D;&#x63D2;&#x4EF6;\"></a>&#x5378;&#x8F7D;&#x63D2;&#x4EF6;</h3><pre><code>nmp uninstall hexo-generator-feed\n</code></pre><h3 id=\"sitemap&#x5B89;&#x88C5;\"><a href=\"#sitemap&#x5B89;&#x88C5;\" class=\"headerlink\" title=\"sitemap&#x5B89;&#x88C5;\"></a>sitemap&#x5B89;&#x88C5;</h3><p><code>npm install hexo-generator-sitemap</code></p>\n<h3 id=\"&#x5F00;&#x542F;-1\"><a href=\"#&#x5F00;&#x542F;-1\" class=\"headerlink\" title=\"&#x5F00;&#x542F;\"></a>&#x5F00;&#x542F;</h3><p>&#x8FDB;&#x5165;hexo_config.yml&#x627E;&#x5230;Plugins</p>\n<pre><code>Plugins:\n - hexo-generator-sitemap\n</code></pre><p><code>sitemap:\n    path: sitemap.xml</code></p>\n<blockquote>\n<p><em>&#x8BBF;&#x95EE; &#x5347;&#x7EA7; &#x5378;&#x8F7D;&#x4E0E;feed&#x4E00;&#x6837;</em> </p>\n</blockquote>\n<h3 id=\"&#x63D0;&#x9192;\"><a href=\"#&#x63D0;&#x9192;\" class=\"headerlink\" title=\"&#x63D0;&#x9192;\"></a>&#x63D0;&#x9192;</h3><p>&#x53EF;&#x80FD;&#x5B89;&#x88C5;&#x4E86;feed&#x4E0E;sitemap &#x8BBF;&#x95EE;<a href=\"http://localhost:4000/atom.xml\" target=\"_blank\" rel=\"noopener\">http://localhost:4000/atom.xml</a> &#x4F1A;&#x663E;&#x793A;&#x201C;Cannot GET atom.xml&#x201D;&#x4E0E;&#x201D;Cannot GET sitemap.xml&#x201D;&#x6253;&#x5F00;hexo&#xFF0F;package.jso &#x6DFB;&#x52A0;</p>\n<pre><code>&quot;hexo-generator-feed&quot;: &quot;1.1.0&quot;,\n&quot;hexo-generator-sitemap&quot;: &quot;1.1.2&quot;,\n</code></pre><blockquote>\n<p><em>&#x7248;&#x672C;&#x53F7;&#x5339;&#x914D;&#x81EA;&#x5DF1;&#x7684;</em></p>\n</blockquote>\n<p>&#x6DFB;&#x52A0;&#x5B8C;&#x540E; hexo g  &#x518D;&#x91CD;&#x65B0;&#x8BBF;&#x95EE;</p>\n<h2 id=\"&#x5199;&#x6587;&#x7AE0;\"><a href=\"#&#x5199;&#x6587;&#x7AE0;\" class=\"headerlink\" title=\"&#x5199;&#x6587;&#x7AE0;\"></a>&#x5199;&#x6587;&#x7AE0;</h2><p>&#x8FDB;&#x5165;hexo&#xFF0F;source&#xFF0F;_posts &#x627E;&#x5230;&#x76F8;&#x5173;&#x6587;&#x7AE0;&#x7684;.md &#x8FDB;&#x884C;&#x7F16;&#x5199;<br>hexo&#x5199;&#x6587;&#x7AE0;&#x662F;&#x4F7F;&#x7528;Markdown&#x7F16;&#x5199;&#x6587;&#x7AE0; <a href=\"http://www.jianshu.com/p/1e402922ee32/\" target=\"_blank\" rel=\"noopener\">Markdown&#x2013;&#x5165;&#x95E8;&#x6307;&#x5357;</a></p>\n<blockquote>\n<p><em>&#x5220;&#x9664;&#x6587;&#x7AE0;&#x53EA;&#x8981;&#x5220;&#x9664;&#x5BF9;&#x5E94;&#x7684;.md&#x6587;&#x4EF6;&#x5C31;&#x884C;</em></p>\n</blockquote>\n<h2 id=\"&#x7ED3;&#x675F;\"><a href=\"#&#x7ED3;&#x675F;\" class=\"headerlink\" title=\"&#x7ED3;&#x675F;\"></a>&#x7ED3;&#x675F;</h2><p>&#x597D;&#x4E86;hexo&#x7684;&#x5B89;&#x88C5;&#x4E0E;&#x914D;&#x7F6E;&#x57FA;&#x672C;&#x4E0A;&#x5C31;&#x662F;&#x8FD9;&#x6837;&#x4E86;&#xFF0C;&#x4ECA;&#x5929;&#x5C31;&#x5230;&#x8FD9;&#x91CC;&#x4E86;&#xFF0C;&#x5E0C;&#x671B;&#x5927;&#x5BB6;&#x591A;&#x591A;&#x652F;&#x6301;&#x3002;</p>\n<blockquote>\n<p><em>&#x8F6C;&#x8F7D;&#x8BF7;&#x6307;&#x660E;&#x51FA;&#x5904;idisfkj&#x535A;&#x5BA2;&#xFF1A;<a href=\"https://idisfkj.github.io\" target=\"_blank\" rel=\"noopener\">https://idisfkj.github.io</a></em></p>\n</blockquote>\n","categories":["hexo"],"tags":["hexo"]},{"title":"category","url":"https://www.rousetime.com/category/index.html","content":"","categories":[],"tags":[]},{"title":"about","url":"https://www.rousetime.com/about/index.html","content":"","categories":[],"tags":[]},{"title":"","url":"https://www.rousetime.com/css/personal-style.css","content":"@font-face {\n    font-family: &quot;SentyPea&quot;;\n    src: url(&quot;/fonts/SentyPea.eot&quot;); /* IE9 */\n    src: url(&quot;/fonts/SentyPea.eot?#iefix&quot;) format(&quot;embedded-opentype&quot;),\n    url(&quot;/fonts/SentyPea.woff&quot;) format(&quot;woff&quot;),\n    url(&quot;/fonts/SentyPea.ttf&quot;) format(&quot;truetype&quot;),\n    url(&quot;/fonts/SentyPea.svg#SentyPea&quot;) format(&quot;svg&quot;); /* iOS 4.1- */\n    font-style: normal;\n    font-weight: normal;\n}\nhtml.page-home {\n   position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-image: url(&apos;/images/bg.jpg&apos;);\n  background-color: transparent;\n  background-size: cover;\n  background-position: center center;\n  background-repeat: no-repeat;\n  background: linear-gradient( #1abc9c, transparent), linear-gradient( 90deg, skyblue, transparent), linear-gradient( -90deg, coral, transparent);\n/*  background-blend-mode: screen;\n  background: linear-gradient(to left, #5f2c82, #49a09d);*/\n}","categories":[],"tags":[]},{"title":"link","url":"https://www.rousetime.com/link/index.html","content":"","categories":[],"tags":[]},{"title":"search","url":"https://www.rousetime.com/search/index.html","content":"","categories":[],"tags":[]},{"title":"tag","url":"https://www.rousetime.com/tag/index.html","content":"","categories":[],"tags":[]}]